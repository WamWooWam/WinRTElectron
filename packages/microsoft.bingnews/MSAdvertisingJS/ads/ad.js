/*!
  Copyright (C) Microsoft. All rights reserved.
  This library is supported for use in Windows Store apps only.
*/
(function(n){"use strict";n.Namespace.define("MicrosoftNSJS.Advertising",{AdControl:n.Class.define(function(t,i){var r=this;msWriteProfilerMark("AdControl:Ctor:s");try{if(t===null||typeof t=="undefined")t=document.createElement("div");else if(this._isElementAllowed(t))t=t;else return;t.winControl=this;this._adsGlobalEventManager=new MicrosoftNSJS.Advertising.AdGlobalEventManager;this._adSettingsControl=new MicrosoftNSJS.Advertising.AdSettingsControl({flyoutHtmlTemplateURI:"ms-appx:///MSAdvertisingJS/ads/MSASettingsPanel.html",resourceLoaderURI:"MicrosoftAdvertising/UIStrings"});try{this._rendererOptions=new MicrosoftAdvertising.Shared.WinRT.RendererOptions}catch(u){}this._rendererOptionsUsedInRequest=null;this._globalAdEngagedHandler=null;this._globalAdDisengagedHandler=null;this._ad=null;this._applicationId="";this._adUnitId="";this._currentAdHeight=null;this._currentAdWidth=null;this._isDisposed=!1;this._errorReportCount=0;this._isAutoRefreshEnabled=!0;this._isUserEngaged=!1;this._placement=null;this._refreshPeriodSeconds=60;this._refreshTimerId=null;this._requestInProgress=!1;this._timeAtLastRotation=null;this._currentCloseBandHeight=this._RESERVED_CLOSE_BAND_HEIGHT;this._adContainer=null;this._enableDefaultImageAd=i.enableDefaultImageAd&&(i.enableDefaultImageAd===!0||i.enableDefaultImageAd==="true")?!0:!1;this._accelerometer={device:null,tiltHandlers:[],shakeHandlers:[]};this._lastCoords={x:0,y:0,z:0};this._viewableChangedTimer=null;this._hasViewablility=!1;this._viewableCheckPeriodMs=500;this._orientationChangedHandler=null;this._fadeOptions={timer:{linear:" cubic-bezier(0,0,1,1)"},fadeInTimeS:.7};this._sensorOptions={accelerometer:{reportIntervalMS:50}};this._adInstanceState=null;this._onAdRefreshedInternal=null;this._onAdRefreshed=null;this._onBeforeAdRender=null;this._onErrorOccurred=null;this._onEngagedChanged=null;this._onPointerDown=null;this._onPointerUp=null;this._onPointerMove=null;this._onMouseWheel=null;this._onManipulationStateChanged=null;this._preventDefaultAppHandlers=!1;this._applicationEventsMask=0;t.style.breakInside="avoid";t.style.overflow="hidden";t.style.position===""&&(t.style.position="relative");n.UI.setOptions(this,i);(t.id===null||t.id==="")&&(t.id=this._generateUniqueId());this._domElement=t;this._showDefaultImageAd();this._setupEvents();setImmediate(function(){r._requestInProgress||r._ad!==null||r._refreshInternal()});msWriteProfilerMark("AdControl:Ctor:e")}catch(u){return}},{_ORMMA_NETWORK_OFFLINE:"offline",_ORMMA_NETWORK_WIFI:"wifi",_ORMMA_NETWORK_CELL:"cell",_ORMMA_NETWORK_UNKNOWN:"unknown",_ORMMA_RESPONSE_IGNORE:"ignore",_ORMMA_RESPONSE_PROXY:"proxy",_HTTP_HEADER_CACHE_CONTROL:"cache-control",_HTTP_HEADER_VALUE_CACHE_CONTROL_NO_CACHE:"no-cache",_RESERVED_CLOSE_BAND_HEIGHT:100,_MIN_AD_REFRESH_INTERVAL_IN_MILLISECONDS_METERED:6e4,_MIN_AD_REFRESH_INTERVAL_IN_MILLISECONDS_UNMETERED:3e4,_MAX_ERROR_REPORT:20,_MAX_ERROR_REPORT_MESSAGE:"error reporting maximum reached, no more errors will be reported",_MAX_URL_LENGTH:2048,_ERROR_ENUM:{Unknown:"Unknown",NoAdAvailable:"NoAdAvailable",NetworkConnectionFailure:"NetworkConnectionFailure",ClientConfiguration:"ClientConfiguration",ServerSideError:"ServerSideError",InvalidServerResponse:"InvalidServerResponse",RefreshNotAllowed:"RefreshNotAllowed",Other:"Other"},_ERROR_MESSAGE:{enableDefaultImageAdAlreadyInitialized:"enableDefaultImageAd property can only be initialized during object creation.",enableDefaultImageAdIncorrectContainerSize:"Default image ad unavailable for the current specified ad control size."},_DEFAULT_IMAGES:{_defaultImageName:"DefaultImageAd.png","300x250":{width:300,height:250,url:"ms-appx:///MSAdvertisingJS/ads/images/defaultimageads/300x250/DefaultImageAd.png"},"160x600":{width:160,height:600,url:"ms-appx:///MSAdvertisingJS/ads/images/defaultimageads/160x600/DefaultImageAd.png"},"250x250":{width:250,height:250,url:"ms-appx:///MSAdvertisingJS/ads/images/defaultimageads/250x250/DefaultImageAd.png"},"728x90":{width:728,height:90,url:"ms-appx:///MSAdvertisingJS/ads/images/defaultimageads/728x90/DefaultImageAd.png"},"300x600":{width:300,height:600,url:"ms-appx:///MSAdvertisingJS/ads/images/defaultimageads/300x600/DefaultImageAd.png"},"250x510":{width:250,height:510,url:"ms-appx:///MSAdvertisingJS/ads/images/defaultimageads/250x510/DefaultImageAd.png"},"1366x768":{width:1366,height:768,url:"ms-appx:///MSAdvertisingJS/ads/images/defaultimageads/1366x768/DefaultImageAd.png"}},_EVENT_TYPE_ENUM:{All:-1,PointerDown:1,PointerUp:2,PointerMove:4,MouseWheel:16,ManipulationStateChanged:32},_USER_TARGETING_OPTION:{AdIdOff:"AdIdOff",GlobalOff:"GlobalOff",LocalOff:"LocalOff",On:"On",NotSignedIn:"NotSignedIn",Unknown:"Unknown"},onAdRefreshed:{get:function(){return this._onAdRefreshed},set:function(n){(typeof n=="function"||n===null||typeof n=="undefined")&&(this._onAdRefreshed=n)}},onBeforeAdRender:{get:function(){return this._onBeforeAdRender},set:function(n){(typeof n=="function"||n===null||typeof n=="undefined")&&(this._onBeforeAdRender=n)}},onErrorOccurred:{get:function(){return this._onErrorOccurred},set:function(n){(typeof n=="function"||n===null||typeof n=="undefined")&&(this._onErrorOccurred=n)}},onEngagedChanged:{get:function(){return this._onEngagedChanged},set:function(n){(typeof n=="function"||n===null||typeof n=="undefined")&&(this._onEngagedChanged=n)}},onPointerDown:{get:function(){return this._onPointerDown},set:function(n){(typeof n=="function"||n===null||typeof n=="undefined")&&(this._onPointerDown=n,typeof n=="function"?(this._addApplicationEventType(this._EVENT_TYPE_ENUM.PointerDown),this._updateApplicationEvents()):(this._removeApplicationEventType(this._EVENT_TYPE_ENUM.PointerDown),this._updateApplicationEvents()))}},onPointerUp:{get:function(){return this._onPointerUp},set:function(n){(typeof n=="function"||n===null||typeof n=="undefined")&&(this._onPointerUp=n,typeof n=="function"?this._addApplicationEventType(this._EVENT_TYPE_ENUM.PointerUp):this._removeApplicationEventType(this._EVENT_TYPE_ENUM.PointerUp),this._updateApplicationEvents())}},onMouseWheel:{get:function(){return this._onMouseWheel},set:function(n){(typeof n=="function"||n===null||typeof n=="undefined")&&(this._onMouseWheel=n,typeof n=="function"?this._addApplicationEventType(this._EVENT_TYPE_ENUM.MouseWheel):this._removeApplicationEventType(this._EVENT_TYPE_ENUM.MouseWheel),this._updateApplicationEvents())}},onPointerMove:{get:function(){return this._onPointerMove},set:function(n){(typeof n=="function"||n===null||typeof n=="undefined")&&(this._onPointerMove=n,typeof n=="function"?this._addApplicationEventType(this._EVENT_TYPE_ENUM.PointerMove):this._removeApplicationEventType(this._EVENT_TYPE_ENUM.PointerMove),this._updateApplicationEvents())}},onManipulationStateChanged:{get:function(){return this._onManipulationStateChanged},set:function(n){(typeof n=="function"||n===null||typeof n=="undefined")&&(this._onManipulationStateChanged=n,typeof n=="function"?this._addApplicationEventType(this._EVENT_TYPE_ENUM.ManipulationStateChanged):this._removeApplicationEventType(this._EVENT_TYPE_ENUM.ManipulationStateChanged),this._updateApplicationEvents())}},preventDefaultApplicationEvents:{get:function(){return this._preventDefaultAppHandlers},set:function(n){this._preventDefaultAppHandlers!==n&&(this._preventDefaultAppHandlers=n)}},applicationId:{get:function(){return this._applicationId},set:function(n){this._applicationId!==n&&(this._applicationId=n)}},adUnitId:{get:function(){return this._adUnitId},set:function(n){this._adUnitId!==n&&(this._adUnitId=n)}},isAutoRefreshEnabled:{get:function(){return this._isAutoRefreshEnabled},set:function(n){this._isAutoRefreshEnabled!==n&&(this._isAutoRefreshEnabled=n,this._isAutoRefreshEnabled?this._scheduleRefresh():this._unscheduleRefresh())}},isEngaged:{get:function(){return this._adContainer&&this._adContainer.mraidState===MicrosoftNSJS.Advertising.AdContainer.MRAID_STATE_TYPE.EXPANDED||this._isUserEngaged}},isSuspended:{get:function(){return this._adContainer&&this._adContainer.state===MicrosoftNSJS.Advertising.AdContainer.STATE_TYPE.SUSPENDED}},latitude:{get:function(){return this._latitude},set:function(n){this._latitude=typeof n=="string"?parseFloat(n):n}},longitude:{get:function(){return this._longitude},set:function(n){this._longitude=typeof n=="string"?parseFloat(n):n}},enableDefaultImageAd:{get:function(){return this._enableDefaultImageAd},set:function(n){n+""!=this._enableDefaultImageAd+""&&this._fireErrorOccurred(this._ERROR_MESSAGE.enableDefaultImageAdAlreadyInitialized,this._ERROR_ENUM.ClientConfiguration)}},element:{get:function(){return this._domElement}},addAdTag:function(n,t){if(typeof n=="string"&&typeof t=="string")try{this._rendererOptions.addRendererOption(n,t)}catch(i){this._fireErrorOccurred("could not add renderer option or value",this._ERROR_ENUM.Other)}else this._fireErrorOccurred("could not add renderer option or value as they were not strings",this._ERROR_ENUM.Other)},removeAdTag:function(n){if(typeof n=="string")try{this._rendererOptions.removeRendererOption(n)}catch(t){this._fireErrorOccurred("could not remove renderer option or value",this._ERROR_ENUM.Other)}},refresh:function(){if(this._isAutoRefreshEnabled){this._fireErrorOccurred("refresh() may not be called when auto-refresh is enabled (isAutoRefreshEnabled=true)",this._ERROR_ENUM.RefreshNotAllowed);return}this._checkIfRefreshIntervalMetAndRaiseError()&&this._refreshInternal()},suspend:function(){this._adContainer&&(this._adContainer.mraidState===MicrosoftNSJS.Advertising.AdContainer.MRAID_STATE_TYPE.EXPANDED&&this._closePopup(),this._adContainer.suspend());this._unscheduleRefresh()},resume:function(){this._adContainer&&this._adContainer.resume();this._scheduleRefresh()},getUserTargetingSetting:function(){return new n.Promise(function(n){if(MicrosoftAdvertising.Shared.WinRT.UserInfoProvider.isUserOptOutControlVisible()===!1)n(this._USER_TARGETING_OPTION.AdIdOff);else return MicrosoftAdvertising.Shared.WinRT.UserInfoProvider.getGlobalTargetingOptInStateAsync().then(function(t){t===MicrosoftAdvertising.Shared.WinRT.TargetingOptInState.optedIn?MicrosoftAdvertising.Shared.WinRT.UserInfoProvider.getLocalTargetingOptInStateAsync().then(function(t){t!==MicrosoftAdvertising.Shared.WinRT.TargetingOptInState.optedOut?n(this._USER_TARGETING_OPTION.On):n(this._USER_TARGETING_OPTION.LocalOff)}.bind(this)):t===MicrosoftAdvertising.Shared.WinRT.TargetingOptInState.optedOut?n(this._USER_TARGETING_OPTION.GlobalOff):t===MicrosoftAdvertising.Shared.WinRT.TargetingOptInState.userNotSignedIn?n(this._USER_TARGETING_OPTION.NotSignedIn):n(this._USER_TARGETING_OPTION.Unknown)}.bind(this))}.bind(this))},dispose:function(){try{msWriteProfilerMark("AdControl:dispose:s");this._closePopup();typeof this._resizeHandler=="function"&&(window.removeEventListener("resize",this._resizeHandler),this._resizeHandler=null);typeof this._domNodeRemovedHandler=="function"&&(this._domElement!==null&&this._domElement.removeEventListener("DOMNodeRemoved",this._domNodeRemovedHandler),this._domNodeRemovedHandler=null);this._adContainer&&(this._adContainer.dispose(),this._adContainer=null);this._disposeAccelerometer();this._stopOrientationMonitoring();this._stopViewableChangeMonitoring();this._onAdRefreshedInternal=null;this._onAdRefreshed=null;this._onBeforeAdRender=null;this._onErrorOccurred=null;this._onEngagedChanged=null;this._onPointerDown=null;this._onPointerUp=null;this._onMouseWheel=null;this._onPointerMove=null;this._onManipulationStateChanged=null;this._unscheduleRefresh();this._stopOrientationMonitoring();this._networkInfo.removeEventListener("networkstatuschanged",this._networkChangedEventHandler);this._disposeAdPlacement();this._applicationEventsMask=0;this._preventDefaultAppHandlers=!1;this._adsGlobalEventManager.removeEventListener(MicrosoftNSJS.Advertising.AdGlobalEventManager.EVENT_TYPE.AD_ENGAGED,this._globalAdEngagedHandler);this._adsGlobalEventManager.removeEventListener(MicrosoftNSJS.Advertising.AdGlobalEventManager.EVENT_TYPE.AD_DISENGAGED,this._globalAdDisengagedHandler);this._adsGlobalEventManager.dispose();this._domElement!==null&&(this._domElement.winControl=null,this._domElement.onresize=null,this._domElement=null);this._rendererOptionsUsedInRequest=null;this._isDisposed=!0;msWriteProfilerMark("AdControl:dispose:e")}catch(n){}},_checkIfRefreshIntervalMetAndRaiseError:function(){var n=!1,t=this._MIN_AD_REFRESH_INTERVAL_IN_MILLISECONDS_UNMETERED,i,r,u;if(this._timeAtLastRotation!==null)try{i=Windows.Networking.Connectivity.NetworkInformation.getInternetConnectionProfile();i!==null&&(r=i.getConnectionCost(),u=r.NetworkCostType===Windows.Networking.Connectivity.NetworkCostType.fixed||r.NetworkCostType===Windows.Networking.Connectivity.NetworkCostType.variable,t=u?this._MIN_AD_REFRESH_INTERVAL_IN_MILLISECONDS_METERED:this._MIN_AD_REFRESH_INTERVAL_IN_MILLISECONDS_UNMETERED)}catch(f){}else return this._timeAtLastRotation=new Date,!0;return n=new Date-this._timeAtLastRotation>t,n||this._fireErrorOccurred("refresh() may not be called more than once every "+t/1e3+" seconds.",this._ERROR_ENUM.RefreshNotAllowed),n},_showDefaultImageAd:function(){if(this._enableDefaultImageAd&&typeof this._domElement=="object"&&typeof this._domElement.style=="object"){var t=this._domElement.offsetWidth,i=this._domElement.offsetHeight,n=t+"x"+i;if(typeof this._DEFAULT_IMAGES[n]!="object")this._fireErrorOccurred(this._ERROR_MESSAGE.enableDefaultImageAdIncorrectContainerSize,this._ERROR_ENUM.ClientConfiguration),this._log("Unable to show default image ad, ad container size mismatch. Width: "+t+" Height: "+i,{fnName:"_showDefaultImageAd"});else try{this._domElement.style.backgroundImage="url('"+this._DEFAULT_IMAGES[n].url+"')";this._domElement.style.backgroundSize="100% 100%";this._log("_domElement backgroundImage url set to "+this._DEFAULT_IMAGES[n].url,{fnName:"_showDefaultImageAd"});this._log("_domElement backgroundSize set to 100% 100%",{fnName:"_showDefaultImageAd"})}catch(r){this._log("Exception error: "+r,{fnName:"_showDefaultImageAd"})}}},_hideDefaultImageAd:function(){if(this._enableDefaultImageAd&&typeof this._domElement=="object"&&typeof this._domElement.style=="object")try{this._domElement.style.backgroundImage="";this._domElement.style.backgroundSize="";this._log("_domElement backgroundImage url  and backgroundSize cleared",{fnName:"_hideDefaultImageAd"})}catch(n){this._log("Exception error: "+n,{fnName:"_hideDefaultImageAd"})}},_getSdkInfo:function(){try{var n=MicrosoftAdvertising.Shared.WinRT.SdkInfoProvider.getSdkInfo();return{sdkVersion:n.sdkVersion,client:n.client,runtimeType:n.runtimeType}}catch(t){return{}}},_refreshInternal:function(){if(this._requestInProgress){this._fireErrorOccurred("refresh triggered but request is already in progress",this._ERROR_ENUM.RefreshNotAllowed);return}this._requestInProgress=!0;try{if(Windows.ApplicationModel.DesignMode.designModeEnabled){this._requestInProgress=!1;return}}catch(t){}if(window!==top){this._requestInProgress=!1;this._fireErrorOccurred("ad control may not be loaded in an iframe",this._ERROR_ENUM.Other);return}if(this._domElement===null||this._domElement.offsetWidth===0||this._domElement.offsetHeight===0){this._requestInProgress=!1;return}if(this._adContainer&&this._adContainer.mraidState===MicrosoftNSJS.Advertising.AdContainer.MRAID_STATE_TYPE.EXPANDED){this._requestInProgress=!1;return}if(this._adContainer&&this._adContainer.state===MicrosoftNSJS.Advertising.AdContainer.STATE_TYPE.SUSPENDED){this._requestInProgress=!1;this._fireErrorOccurred("cannot refresh when suspended",this._ERROR_ENUM.RefreshNotAllowed);return}if(this._isUserEngaged){this._requestInProgress=!1;this._scheduleRefresh();return}if(typeof window._msAdEngaged!="undefined"&&window._msAdEngaged){this._requestInProgress=!1;this._scheduleRefresh();return}if(!this._validateParameters()){this._requestInProgress=!1;this._scheduleRefresh();return}if(this._adContainer!==null&&(document.hidden||!this._adContainer.isOnScreen())){this._requestInProgress=!1;this._fireErrorOccurred("refresh not performed because ad is not on screen",this._ERROR_ENUM.RefreshNotAllowed);this._scheduleRefresh();return}if(this._placement===null)try{this._placement=new MicrosoftAdvertising.Shared.WinRT.AdPlacement}catch(t){this._requestInProgress=!1;this._fireErrorOccurred("could not initialize AdPlacement",this._ERROR_ENUM.Other);return}if(this._placement.applicationId=this._applicationId,this._placement.adUnitId=this._adUnitId,this._placement.latitude=this.latitude,this._placement.longitude=this.longitude,this._placement.width=this._domElement.offsetWidth,this._placement.height=this._domElement.offsetHeight,this._rendererOptions!==null&&typeof this._rendererOptions!="undefined"){try{this._rendererOptionsUsedInRequest=this._rendererOptions.getOptionsJson()}catch(i){this._log("error: could not get renderer options as json")}this._placement.adTags=this._rendererOptions.getOptions()}try{var n=this;msWriteProfilerMark("AdControl:_refreshInternal:Request Ad");this._placement.getAdAsync().done(function(t){if(t!==null)msWriteProfilerMark("AdControl:_refreshInternal:Receive Ad"),n._adRefreshedCallback(t);else if(!n._isDisposed&&n._placement!==null&&typeof n._placement!="undefined"){var i=n._placement.lastError;msWriteProfilerMark("AdControl:_refreshInternal:Receive Error:"+i);n._errorOccurredCallback(i)}},function(){if(!n._isDisposed&&n._placement!==null&&typeof n._placement!="undefined"){var t=n._placement.lastError;msWriteProfilerMark("AdControl:_refreshInternal:Receive Error:"+t);n._errorOccurredCallback(t)}});this._timeAtLastRotation=new Date}catch(t){this._errorOccurredCallback({errorMessage:t.message,errorCode:this._ERROR_ENUM.Other})}},_networkInfo:function(){try{return Windows.Networking.Connectivity.NetworkInformation}catch(n){}}(),_networkChangedEventHandler:function(){},_errorOccurredCallback:function(n){this._isDisposed||(typeof n!="object"||n===null?this._fireErrorOccurred("Other",this._ERROR_ENUM.Other):this._fireErrorOccurred(n.errorMessage,n.errorCode),this._currentAdHeight=null,this._currentAdWidth=null,this._requestInProgress=!1,this._scheduleRefresh())},_adRefreshedCallback:function(n){this._isDisposed||(n!==null&&this._onAdReceived(n),this._requestInProgress=!1,this._scheduleRefresh())},_addApplicationEventType:function(n){n!==null&&typeof n=="number"&&(n&this._applicationEventsMask)==0&&(this._applicationEventsMask=this._applicationEventsMask|n)},_removeApplicationEventType:function(n){var t;n!==null&&typeof n=="number"&&(n&this._applicationEventsMask)!=0&&(t=n^-1,this._applicationEventsMask=this._applicationEventsMask&t)},_updateApplicationEvents:function(){if(this._isDisposed!==!0&&this._requestInProgress!==!0)try{this._adContainer&&this._adContainer.mraidState!==MicrosoftNSJS.Advertising.AdContainer.MRAID_STATE_TYPE.EXPANDED&&this._adContainer.postMessage({msg:MicrosoftNSJS.Advertising.AdContainer.MSG_TYPE_WIREAPPEVENTS+":"+JSON.stringify({events:this._applicationEventsMask,preventDefault:this.preventDefaultApplicationEvents})})}catch(n){return}},_onAdReceived:function(t){if(typeof t!="undefined"&&t!==null){var u=MicrosoftNSJS.Advertising.AdControl.AD_TYPE.poly,i,r;this._resetAdControl();this._ad=t;try{if(i=JSON.parse(t.adParameters),i&&typeof i.type=="string"&&i.type.toLowerCase()===MicrosoftNSJS.Advertising.AdControl.AD_TYPE.rrmr&&(u=MicrosoftNSJS.Advertising.AdControl.AD_TYPE.rrmr,!i.htmlPayload))throw"Ad payload missing.";}catch(f){this._log("Could not parse out adParameters to JSON, defaulting to polymorphic ad type. Error='{0}'",{err:f,fnName:"_onAdReceived"})}this._currentAdHeight=this._placement.height;this._currentAdWidth=this._placement.width;typeof this._onBeforeAdRender=="function"&&(r=this._onBeforeAdRender(this));u===MicrosoftNSJS.Advertising.AdControl.AD_TYPE.poly?n.Promise.is(r)?r.then(function(){this._createPolyContainer(t)}.bind(this)):this._createPolyContainer(t):u===MicrosoftNSJS.Advertising.AdControl.AD_TYPE.rrmr&&(n.Promise.is(r)?r.then(function(){this._createMraidContainer(t,i.htmlPayload)}.bind(this)):this._createMraidContainer(t,i.htmlPayload))}},_readFileContentsAsync:function(t){return new n.Promise(function(n,i){Windows.Storage.StorageFile.getFileFromApplicationUriAsync(t).then(function(n){if(!n)throw"Unable to open file.";return Windows.Storage.FileIO.readTextAsync(n)}).then(function(t){if(!t)throw"Unable to retrieve contents from file.";n(t)},function(n){i(n)}).done(null,function(n){i(n)})})},_readNetworkContentsAsync:function(t){var i;return new n.Promise(function(n,r){if(!t||t.length===0)throw"Missing required uri parameter";i=new Windows.Web.Http.HttpClient;i.getAsync(t).then(function(t){t.ensureSuccessStatusCode();t.content.readAsStringAsync().then(function(t){n(t)}.bind(this)).done(function(){},function(n){r(n)}.bind(this))}.bind(this)).done(function(){},function(n){r(n)}.bind(this))})},_createMraidContainer:function(n,t){var i=new Windows.Foundation.Uri(MicrosoftNSJS.Advertising.AdControl.MRAID_API_URI);this._readFileContentsAsync(i).done(function(i){var r=new MicrosoftNSJS.Advertising.AdContainer(MicrosoftNSJS.Advertising.AdContainer.TYPE.MRAID);if(r.create({containerId:this._domElement.id+"_webFrame_"+ +new Date,sourceHTML:i+t,parentElement:this._domElement}),r.onAdMessageReceived=function(n){this._receiveMessage(n)}.bind(this),r.onExpandedClosed=function(){this._closePopup()}.bind(this),r.state===MicrosoftNSJS.Advertising.AdContainer.STATE_TYPE.ERROR){this._fireErrorOccurred("Unable to create ad container",this._ERROR_ENUM.Other);return}r.onAdContainerLoaded=function(t){this._adContainerLoaded_Handler(t,n)}.bind(this)}.bind(this),function(n){this._log("Could not read bootstrap file. Error='{0}'",{err:n,fnName:"_createMraidContainer"});this._fireErrorOccurred("Unable to create ad container",this._ERROR_ENUM.Other)}.bind(this))},_createPolyContainer:function(n){msWriteProfilerMark("AdControl:CreatePolyContainer:s");var t=new MicrosoftNSJS.Advertising.AdContainer(MicrosoftNSJS.Advertising.AdContainer.TYPE.POLYMORPHIC);if(t.create({containerId:this._domElement.id+"_webFrame_"+ +new Date,sourceUri:MicrosoftNSJS.Advertising.AdControl.POLY_API_URI,parentElement:this._domElement}),t.onAdMessageReceived=function(n){this._receiveMessage(n)}.bind(this),t.onExpandedClosed=function(){this._closePopup()}.bind(this),t.state===MicrosoftNSJS.Advertising.AdContainer.STATE_TYPE.ERROR){this._fireErrorOccurred("Unable to create ad container",this._ERROR_ENUM.Other);return}t.onAdContainerLoaded=function(t){this._adContainerLoaded_Handler(t,n)}.bind(this);msWriteProfilerMark("AdControl:CreatePolyContainer:e")},_adContainerLoaded_Handler:function(n,t){var i,r;if((msWriteProfilerMark("AdControl:AdContainerLoaded_Handler:s"),!this._isDisposed)&&this._domElement&&n){if(i=n.element,(i.type===MicrosoftNSJS.Advertising.AdContainer.TYPE.POLYMORPHIC||i.type===MicrosoftNSJS.Advertising.AdContainer.TYPE.MRAID)&&(i.size=i.maxSize={width:this._domElement.offsetWidth,height:this._domElement.offsetHeight},i.screenSize={height:document.documentElement.offsetHeight-this._currentCloseBandHeight,width:document.documentElement.offsetWidth},i.initializeOrmma({networkState:this._getNetworkState(),sdkInfo:this._getSdkInfo()}),i.mraidState=MicrosoftNSJS.Advertising.AdContainer.MRAID_STATE_TYPE.DEFAULT,i.postMessage({msg:MicrosoftNSJS.Advertising.AdContainer.MSG_TYPE_ORMMA_START})),i.state===MicrosoftNSJS.Advertising.AdContainer.STATE_TYPE.ERROR){this._fireErrorOccurred("could not create ad container",this._ERROR_ENUM.Other);return}r=this._adContainer;this._adContainer=i;this._onAdRefreshedInternal=function(){this._hideDefaultImageAd();this._adContainer&&(r?this._adContainer.fadeIn(this._fadeOptions,function(){r.dispose();r=null}):this._adContainer.show());this._onAdRefreshedInternal=null}.bind(this);i.type===MicrosoftNSJS.Advertising.AdContainer.TYPE.POLYMORPHIC&&this._loadRenderer(this._adContainer,t).done(function(){i.postMessage({msg:MicrosoftNSJS.Advertising.AdContainer.MSG_TYPE_INIT});this._updateApplicationEvents();msWriteProfilerMark("AdControl:LoadRenderer:e")}.bind(this),function(n){this._adContainer&&(this._adContainer.dispose(),this._adContainer=null);this._fireErrorOccurred(n,this._ERROR_ENUM.Other)}.bind(this));i.type===MicrosoftNSJS.Advertising.AdContainer.TYPE.MRAID&&(i.postMessage({msg:MicrosoftNSJS.Advertising.AdContainer.MSG_TYPE_INIT}),this._fireAdRefreshed(),this._updateApplicationEvents());msWriteProfilerMark("AdControl:AdContainerLoaded_Handler:e")}},_loadRenderer:function(t,i){return new n.Promise(function(n,r){if(msWriteProfilerMark("AdControl:LoadRenderer:s"),!i||!i.rendererUrl||!i.adParameters){r("Unable to load ad in ad container.");this._log("Unable to load renderer in container. Missing parameters",{fnName:"_loadRenderer"});this._fireErrorOccurred("Unable to load ad in ad container.",this._ERROR_ENUM.Other);return}var u=new Windows.Foundation.Uri(i.rendererUrl),f=new Windows.Web.Http.HttpClient;f.getAsync(u).then(function(u){u.ensureSuccessStatusCode();u.content.readAsStringAsync().then(function(n){this._rendererContent=n;this._rendererParams=i.adParameters;this._prmParams=i.prmParameters;this._rendererParams!==""&&t.postMessage({msg:MicrosoftNSJS.Advertising.AdContainer.MSG_TYPE_ADPARAMS+":"+this._rendererParams});this._prmParams!==""&&t.postMessage({msg:MicrosoftNSJS.Advertising.AdContainer.MSG_TYPE_PRMPARAMS+":"+this._prmParams});this._rendererOptionsUsedInRequest!==""&&t.postMessage({msg:MicrosoftNSJS.Advertising.AdContainer.MSG_TYPE_APPPARAMS+":"+this._rendererOptionsUsedInRequest});t.postMessage({msg:MicrosoftNSJS.Advertising.AdContainer.MSG_TYPE_SCRIPT+":"+this._rendererContent})}.bind(this)).done(function(){n()},function(n){this._log("Unable to retrieve ad renderer. Error: {0}",{err:n,fnName:"_loadRenderer"});r("Error loading ad renderer from network.")}.bind(this))}.bind(this)).done(function(){n()},function(n){this._log("Unable to retrieve ad renderer. Error: {0}",{err:n,fnName:"_loadRenderer"});r("Error loading ad renderer from network.")}.bind(this))}.bind(this))},_resetAdControl:function(){this._adInstanceState=null;this._disposeAccelerometer();this._stopOrientationMonitoring();this._stopViewableChangeMonitoring();this._setUseCustomClose(!1);this._errorReportCount=0;this._currentCloseBandHeight=this._RESERVED_CLOSE_BAND_HEIGHT},_generateUniqueId:function(){var n=null,t=null;do n="ad"+Math.floor(Math.random()*1e4),t=document.getElementById(n);while(t!==null);return n},_fireErrorOccurred:function(n,t){this._log(n+" ("+t+")",{fnName:"_fireErrorOccurred"});typeof this._onErrorOccurred=="function"&&this._onErrorOccurred(this,{errorMessage:n,errorCode:t})},_firePointerDown:function(n){typeof this._onPointerDown=="function"&&this._onPointerDown(this,n)},_firePointerUp:function(){typeof this._onPointerUp=="function"&&this._onPointerUp(this)},_fireEngagedChanged:function(){typeof this._onEngagedChanged=="function"&&this._onEngagedChanged(this)},_fireMouseWheel:function(n){typeof this._onMouseWheel=="function"&&this._onMouseWheel(this,n)},_firePointerMove:function(n){typeof this._onPointerMove=="function"&&this._onPointerMove(this,n)},_fireManipulationStateChanged:function(n){typeof this._onManipulationStateChanged=="function"&&this._onManipulationStateChanged(this,n)},_fireAdRefreshed:function(){this._adContainer&&this._adContainer.mraidState!==MicrosoftNSJS.Advertising.AdContainer.MRAID_STATE_TYPE.EXPANDED&&(typeof this._onAdRefreshedInternal=="function"&&this._onAdRefreshedInternal(),typeof this._onAdRefreshed=="function"&&this._onAdRefreshed(this))},_receiveMessage:function(n){var t,e,f;if(!this._isDisposed&&(t=this._domElement.winControl,t!==null&&typeof t=="object"&&!t._isDisposed)){var i=null,r=null,u=n.data.indexOf(":");if(u<0?i=n.data:(i=n.data.substr(0,u),r=n.data.substr(u+1)),i===MicrosoftNSJS.Advertising.AdContainer.MSG_TYPE_EXPAND)try{e=JSON.parse(r);t._expand(e.url)}catch(o){t._reportError(MicrosoftNSJS.Advertising.AdContainer.MSG_TYPE_EXPAND,"unable to parse expand properties as json")}else i===MicrosoftNSJS.Advertising.AdContainer.MSG_TYPE_CLOSE?t._closePopup():i===MicrosoftNSJS.Advertising.AdContainer.MSG_TYPE_SETEXPANDPROPERTIES?t._updateExpandProperties(r):i===MicrosoftNSJS.Advertising.AdContainer.MSG_TYPE_SETUSERENGAGED?t._processSetUserEngaged(r):i===MicrosoftNSJS.Advertising.AdContainer.MSG_TYPE_ADRENDERED?t._fireAdRefreshed():i===MicrosoftNSJS.Advertising.AdContainer.MSG_TYPE_INITIALIZED||(i===MicrosoftNSJS.Advertising.AdContainer.MSG_TYPE_TILT?t._processTiltMessage(r):i===MicrosoftNSJS.Advertising.AdContainer.MSG_TYPE_SHAKE?t._processShakeMessage(r):i===MicrosoftNSJS.Advertising.AdContainer.MSG_TYPE_GETORIENTATION?t._processGetOrientationMessage(r):i===MicrosoftNSJS.Advertising.AdContainer.MSG_TYPE_ERROR?t._adContainer&&t._adContainer.type===MicrosoftNSJS.Advertising.AdContainer.TYPE.POLYMORPHIC&&(t._adContainer.dispose(),t._adContainer=null,t._fireErrorOccurred(r,t._ERROR_ENUM.Other)):i===MicrosoftNSJS.Advertising.AdContainer.MSG_TYPE_RESIZE?t._adContainer&&(t._adContainer.mraidState===MicrosoftNSJS.Advertising.AdContainer.MRAID_STATE_TYPE.DEFAULT?(f=JSON.parse(r),t._resize(f.width,f.height)):t._reportError("resize","state is not default, current state is:"+t._adContainer.mraidState)):i===MicrosoftNSJS.Advertising.AdContainer.MSG_TYPE_HIDE?t._adContainer&&(t._adContainer.mraidState===MicrosoftNSJS.Advertising.AdContainer.MRAID_STATE_TYPE.DEFAULT?t._resize(0,0):t._reportError("hide","state is not default, current state is:"+t._adContainer.mraidState)):i===MicrosoftNSJS.Advertising.AdContainer.MSG_TYPE_SHOW?t._adContainer&&(t._adContainer.mraidState===MicrosoftNSJS.Advertising.AdContainer.MRAID_STATE_TYPE.HIDDEN?t._resize(t._adContainer.originalProperties.width,t._adContainer.originalProperties.height):t._reportError("show","state is not hidden, current state is:"+t._adContainer.mraidState)):i===MicrosoftNSJS.Advertising.AdContainer.MSG_TYPE_OPEN?t._processOpenMessage(r):i===MicrosoftNSJS.Advertising.AdContainer.MSG_TYPE_REQUEST?t._request(JSON.parse(r)):i===MicrosoftNSJS.Advertising.AdContainer.MSG_TYPE_VIEWABLECHANGE?t._processViewableChangeMessage(r):i===MicrosoftNSJS.Advertising.AdContainer.MSG_TYPE_STOREADINSTANCESTATE?t._storeAdInstanceState(r):i===MicrosoftNSJS.Advertising.AdContainer.MSG_TYPE_ONPOINTERDOWN?t._firePointerDown(JSON.parse(r)):i===MicrosoftNSJS.Advertising.AdContainer.MSG_TYPE_ONPOINTERUP?t._firePointerUp():i===MicrosoftNSJS.Advertising.AdContainer.MSG_TYPE_USECUSTOMCLOSE?t._setUseCustomClose(JSON.parse(r)):i===MicrosoftNSJS.Advertising.AdContainer.MSG_TYPE_ONMOUSEWHEEL?t._fireMouseWheel(JSON.parse(r)):i===MicrosoftNSJS.Advertising.AdContainer.MSG_TYPE_ONPOINTERMOVE?t._firePointerMove(JSON.parse(r)):i===MicrosoftNSJS.Advertising.AdContainer.MSG_TYPE_ONMANIPSTATECHANGED?t._fireManipulationStateChanged(JSON.parse(r)):t._reportError("unknown","unknown action"))}},_reportError:function(n,t){if(!this._adContainer){this._log("Unable to report error, adContainer missing",{fnName:"_reportError"});return}this._errorReportCount<this._MAX_ERROR_REPORT&&(this._log("Reporting error to ad container. Action:"+n+" , Message: "+t,{fnName:"_reportError"}),this._errorReportCount++,t=this._errorReportCount>=this._MAX_ERROR_REPORT?this._MAX_ERROR_REPORT_MESSAGE:t,this._adContainer.postMessage({msg:MicrosoftNSJS.Advertising.AdContainer.MSG_TYPE_ERROR+":"+JSON.stringify({action:n,message:t}),all:!0}))},_setupEvents:function(){try{window.addEventListener("message",this._receiveMessage);var n=this;this._resizeHandler=this._onDocumentResize.bind(this);window.addEventListener("resize",this._resizeHandler);this._domNodeRemovedHandler=function(n){n.target===this._domElement&&this.dispose()}.bind(this);this._domElement.addEventListener("DOMNodeRemoved",this._domNodeRemovedHandler);this._networkChangedEventHandler=function(){this._adContainer&&this._adContainer.postMessage({msg:MicrosoftNSJS.Advertising.AdContainer.MSG_TYPE_SETNETWORK+":"+n._getNetworkState(),all:!0})}.bind(this);this._networkInfo.addEventListener("networkstatuschanged",this._networkChangedEventHandler);this._adsGlobalEventManager!==null&&typeof this._adsGlobalEventManager!="undefined"&&this._adsGlobalEventManager.isInitialized===!0&&(this._globalAdEngagedHandler=this._adsGlobalEventManager.addEventListener(MicrosoftNSJS.Advertising.AdGlobalEventManager.EVENT_TYPE.AD_ENGAGED,function(t){n.element!==null&&typeof(n.element!=="undefined")&&n.element.id!==t&&n.suspend()}),this._globalAdDisengagedHandler=this._adsGlobalEventManager.addEventListener(MicrosoftNSJS.Advertising.AdGlobalEventManager.EVENT_TYPE.AD_DISENGAGED,function(t){n.element!==null&&typeof(n.element!=="undefined")&&n.element.id!==t&&n.resume()}))}catch(t){}},_setUseCustomClose:function(n){var t=this._currentCloseBandHeight;this._currentCloseBandHeight=n?0:this._RESERVED_CLOSE_BAND_HEIGHT;this._adContainer&&t!==this._currentCloseBandHeight&&(this._adContainer.screenSize={height:document.documentElement.offsetHeight-this._currentCloseBandHeight,width:document.documentElement.offsetWidth})},_disposeAdPlacement:function(){this._placement!==null&&(this._placement.onadrefreshed=null,this._placement.onerroroccurred=null,this._placement=null)},_onDocumentResize:function(){var n,t,i=document.documentElement.offsetWidth,r=document.documentElement.offsetHeight;this._adContainer&&(n=this._adContainer.expandProperties,this._adContainer.screenSize={height:r,width:i},n&&(this._adContainer.type===MicrosoftNSJS.Advertising.AdContainer.TYPE.MRAID?(t=this._getExpandedBounds({width:n.width,height:n.height}),(n.width>t.width||n.height>t.height)&&(n.width=t.width,n.height=t.height)):(t=this._getExpandedBounds({width:i,height:r}),n.width=t.width,n.height=t.height),n.x=t.x,n.y=t.y,this._adContainer.expandProperties=n,this._adContainer.postMessage({msg:MicrosoftNSJS.Advertising.AdContainer.MSG_TYPE_SETSIZE+":"+JSON.stringify({width:n.width,height:n.height})})))},_onResize:function(){var n=this.element.offsetWidth,t=this.element.offsetHeight,i=this._currentAdWidth,r=this._currentAdHeight;n!==i||t!==r?(this._requestInProgress||(this._unscheduleRefresh(),this._refreshInternal()),this._enableDefaultImageAd&&(this._hideDefaultImageAd(),this._showDefaultImageAd()),this._log("oldWidth:"+i+" oldHeight:"+r+" newWidth:"+n+" newHeight: "+t,{fnName:"_onResize"})):(this._scheduleRefresh(),this._log("no size change detected",{fnName:"_onResize"}))},_updateExpandProperties:function(n){var i,t;if(!this._adContainer){this._log("Unable to update expand properties, adContainer missing.",{fnName:"_updateExpandProperties"});return}try{t=JSON.parse(n)}catch(r){this._reportError(MicrosoftNSJS.Advertising.AdContainer.MSG_TYPE_SETEXPANDPROPERTIES,"unable to parse expand properties as json");return}i=this._getExpandedBounds(t);t.width=i.width;t.height=i.height;t.x=i.x;t.y=i.y;this._adContainer.expandProperties=t},_getExpandedBounds:function(n){try{var r=document.documentElement.offsetHeight,u=document.documentElement.offsetWidth,f=0,e=0,t=r-this._currentCloseBandHeight,i=u;return n&&(i=n.width!==undefined?n.width:i,t=n.height!==undefined?n.height:t,t>r-this._currentCloseBandHeight&&(i=Math.floor(i*(r-this._currentCloseBandHeight)/t),t=r-this._currentCloseBandHeight),i>u&&(t=Math.floor(t*(u/i)),i=u),f=(u-i)/2,e=(r-t)/2),{x:f,y:e,width:i,height:t}}catch(o){return this._log("Unable to calculate expand bounds. Error: {0}",{err:o,fnName:"_getExpandedBounds"}),{x:0,y:0,width:0,height:0}}},_expand:function(n){if(!this._adContainer){this._log("Unable to expand, adContainer missing.",{fnName:"_expand"});return}this._adContainer.expandProperties||(this._adContainer.expandProperties=this._getExpandedBounds(this._adContainer.expandProperties));try{this._adContainer.type===MicrosoftNSJS.Advertising.AdContainer.TYPE.POLYMORPHIC?this._expandPolymorphicContainer(n):this._adContainer.type===MicrosoftNSJS.Advertising.AdContainer.TYPE.MRAID&&this._expandMraidContainer(n)}catch(t){this._log("Unable to expand. Error: {0}",{err:t,fnName:"_expandPolymorphicContainer"})}},_expandPolymorphicContainer:function(n){if(!this._adContainer||this._adContainer.type!==MicrosoftNSJS.Advertising.AdContainer.TYPE.POLYMORPHIC){this._log("Unable to expand, adContainer missing or of incorrect type.",{fnName:"_expandPolymorphicContainer"});return}this._adContainer.expand(n,{sourceUri:MicrosoftNSJS.Advertising.AdControl.POLY_API_URI,onAdContainerLoaded:function(){if(!this._adContainer){this._log("Unable to expand, adContainer missing.",{fnName:"_expandPolymorphicContainer"});return}this._adInstanceState!==null&&this._adContainer.postMessage({msg:MicrosoftNSJS.Advertising.AdContainer.MSG_TYPE_SETADINSTANCESTATE+":"+this._adInstanceState});this._adContainer.screenSize=this._adContainer.maxSize={forceUpdate:!0,width:document.documentElement.offsetWidth,height:document.documentElement.offsetHeight-this._currentCloseBandHeight};this._adContainer.size={forceUpdate:!0,width:this._adContainer.expandProperties.width,height:this._adContainer.expandProperties.height};this._adContainer.initializeOrmma({networkState:this._getNetworkState(),sdkInfo:this._getSdkInfo()});this._adContainer.mraidState=MicrosoftNSJS.Advertising.AdContainer.MRAID_STATE_TYPE.EXPANDED;this._adContainer.postMessage({msg:MicrosoftNSJS.Advertising.AdContainer.MSG_TYPE_ORMMA_START});this._loadRenderer(this._adContainer,this._ad).done(function(){if(!this._adContainer){this._log("Unable to expand, adContainer missing.",{fnName:"_expandPolymorphicContainer"});return}this._adContainer.postMessage({msg:MicrosoftNSJS.Advertising.AdContainer.MSG_TYPE_INIT});this._unscheduleRefresh();try{this._adsGlobalEventManager.broadcastEvent(MicrosoftNSJS.Advertising.AdGlobalEventManager.EVENT_TYPE.AD_ENGAGED,this.element.id)}catch(n){this._log("Unable to call this._adsGlobalEventManager. Error: {0}",{err:n,fnName:"_expandPolymorphicContainer"})}window._msAdEngaged=!0;this._fireEngagedChanged()}.bind(this),function(){this._closePopup()}.bind(this))}.bind(this)})},_expandMraidContainer:function(n){var t,i,r;if(!this._adContainer||this._adContainer.type!==MicrosoftNSJS.Advertising.AdContainer.TYPE.MRAID){this._log("Unable to expand, adContainer missing or of incorrect type.",{fnName:"_expandMraidContainer"});return}if(n&&n.length>0){if(t=new Windows.Foundation.Uri(n),n.length>this._MAX_URL_LENGTH||typeof MicrosoftNSJS.Advertising.AdContainer.ALLOWED_URI_SCHEMES[t.schemeName.toLowerCase()]=="undefined"){this._log("Unable to expand, url of incorrect scheme or too long.",{fnName:"_expandMraidContainer"});return}this._readNetworkContentsAsync(t).done(function(u){u&&(r=MicrosoftNSJS.Advertising.AdControl.BASE_ELEMENT_TEMPLATE.replace("{url}",t.schemeName+"://"+t.host),i=new Windows.Foundation.Uri(MicrosoftNSJS.Advertising.AdControl.MRAID_API_URI),this._readFileContentsAsync(i).done(function(t){if(t){if(!this._adContainer){this._log("Unable to expand, adContainer missing.",{fnName:"_expandMraidContainer"});return}this._adContainer.expand(n,{sourceHTML:t+r+u,onAdContainerLoaded:function(){this._adContainer.screenSize=this._adContainer.maxSize={forceUpdate:!0,width:document.documentElement.offsetWidth,height:document.documentElement.offsetHeight-this._currentCloseBandHeight};this._adContainer.size={forceUpdate:!0,width:this._adContainer.expandProperties.width,height:this._adContainer.expandProperties.height};this._adContainer.initializeOrmma({networkState:this._getNetworkState(),sdkInfo:this._getSdkInfo()});this._adContainer.mraidState=MicrosoftNSJS.Advertising.AdContainer.MRAID_STATE_TYPE.EXPANDED;this._adContainer.postMessage({msg:MicrosoftNSJS.Advertising.AdContainer.MSG_TYPE_ORMMA_START});this._adContainer.postMessage({msg:MicrosoftNSJS.Advertising.AdContainer.MSG_TYPE_INIT});this._unscheduleRefresh();window._msAdEngaged=!0;this._fireEngagedChanged()}.bind(this)})}}.bind(this),function(n){this._log("Unable to retrieve mraid API contents. Error: {0}",{err:n,fnName:"_expandMraidContainer"})}.bind(this)))}.bind(this),function(n){this._log("Unable to retrieve url contents. Error: {0}",{err:n,fnName:"_expandMraidContainer"})}.bind(this))}else this._adContainer.expand(n,{onAdContainerLoaded:function(){if(!this._adContainer){this._log("Unable to expand, adContainer missing.",{fnName:"_expandMraidContainer"});return}this._adContainer.mraidState=MicrosoftNSJS.Advertising.AdContainer.MRAID_STATE_TYPE.EXPANDED;this._adContainer.size={width:this._adContainer.expandProperties.width,height:this._adContainer.expandProperties.height};this._unscheduleRefresh();window._msAdEngaged=!0;this._fireEngagedChanged()}.bind(this)})},_disposeElement:function(n){if(n!==null&&typeof n=="object")try{return document.body.removeChild(n),null}catch(t){this._log("unable to remove node")}return n},_closePopup:function(){if(!this._isDisposed&&this._adContainer&&this._adContainer.mraidState===MicrosoftNSJS.Advertising.AdContainer.MRAID_STATE_TYPE.EXPANDED){this._adContainer.close();this._adContainer.maxSize={width:this._domElement.offsetWidth,height:this._domElement.offsetHeight};this._adContainer.mraidState===MicrosoftNSJS.Advertising.AdContainer.MRAID_STATE_TYPE.DEFAULT&&this._scheduleRefresh();window._msAdEngaged=!1;this._fireEngagedChanged();try{this._adsGlobalEventManager.broadcastEvent(MicrosoftNSJS.Advertising.AdGlobalEventManager.EVENT_TYPE.AD_DISENGAGED,this.element.id)}catch(n){this._log("this._adsGlobalEventManager could not be called")}}},_resize:function(n,t){if(n===null||t===null||n===""||t===""||isNaN(n+t)){this._reportError("resize","invalid width or height supplied");return}this._adContainer&&(t===0&&n===0?this._adContainer.close():(this._adContainer.mraidState===MicrosoftNSJS.Advertising.AdContainer.MRAID_STATE_TYPE.HIDDEN&&this._adContainer.show(),this._adContainer.originalProperties.width===n&&this._adContainer.originalProperties.height===t?(this._adContainer.size={height:t,width:n},this._adContainer.mraidState=MicrosoftNSJS.Advertising.AdContainer.MRAID_STATE_TYPE.DEFAULT):(this._adContainer.size={height:t,width:n},this._adContainer.mraidState=MicrosoftNSJS.Advertising.AdContainer.MRAID_STATE_TYPE.RESIZED)))},_processSetUserEngaged:function(n){var t,i;n===null||n.indexOf("=")===-1?this._log("invalid setUserEngaged message: "+n):(t=n.split("="),t[0]==="engaged"?(i=this.isEngaged,this._isUserEngaged=t[1]==="true",this._isAutoRefreshEnabled&&(this._isUserEngaged?this._unscheduleRefresh():this._scheduleRefresh()),i!==this.isEngaged&&this._fireEngagedChanged()):this._log("invalid setUserEngaged message: "+n))},_processTiltMessage:function(n){if(n===null||n.indexOf("=")===-1)this._log("invalid tilt message: "+n);else{var t=n.split("=");t[0]===MicrosoftNSJS.Advertising.AdContainer.MSG_TYPE_LISTENER?t[1]===MicrosoftNSJS.Advertising.AdContainer.MSG_TYPE_VALUESTART?this._startTiltAccelerometer():t[1]===MicrosoftNSJS.Advertising.AdContainer.MSG_TYPE_VALUESTOP?this._stopTiltAccelerometer():this._log("invalid tilt message: "+n):t[0]===MicrosoftNSJS.Advertising.AdContainer.MSG_TYPE_GETTILT&&t[1]===MicrosoftNSJS.Advertising.AdContainer.MSG_TYPE_REFRESH?this._getTilt():this._log("invalid tilt message: "+n)}},_processShakeMessage:function(n){if(n===null||n.indexOf("=")===-1)this._log("invalid shake message: "+n);else{var t=n.split("=");t[0]===MicrosoftNSJS.Advertising.AdContainer.MSG_TYPE_LISTENER?t[1]===MicrosoftNSJS.Advertising.AdContainer.MSG_TYPE_VALUESTART?this._startShakeAccelerometer():t[1]===MicrosoftNSJS.Advertising.AdContainer.MSG_TYPE_VALUESTOP?this._stopShakeAccelerometer():this._log("invalid shake message: "+n):this._log("invalid shake message: "+n)}},_startTiltAccelerometer:function(){if(this._checkAndCreateAccelerometer())try{(typeof this._accelerometer.tiltHandlers[this._ad.guid]=="undefined"||this._accelerometer.tiltHandlers[this._ad.guid]===null)&&this._accelerometer.device.addEventListener("readingchanged",this._generateTiltListener())}catch(n){}},_generateTiltListener:function(){try{var n=function(n){var t=this._generateCoordsMessage(n.reading.accelerationX,n.reading.accelerationY,n.reading.accelerationZ);this._adContainer&&this._adContainer.postMessage({msg:MicrosoftNSJS.Advertising.AdContainer.MSG_TYPE_UPDATETILTCOORDS+":{"+t+"}",all:!0})}.bind(this);return this._accelerometer!==null&&typeof this._accelerometer!="undefined"&&(this._accelerometer.tiltHandlers[this._ad.guid]=n),n}catch(t){return}},_generateCoordsMessage:function(n,t,i){return'"x":"'+n+'","y":"'+t+'","z":"'+i+'"'},_stopTiltAccelerometer:function(){try{var n=this._accelerometer.tiltHandlers[this._ad.guid];n!==null&&typeof n!="undefined"&&(this._accelerometer.device.removeEventListener("readingchanged",n),this._accelerometer.tiltHandlers[this._ad.guid]=null)}catch(t){this._log("could not stop the tilt accelerometer")}},_startShakeAccelerometer:function(){if(this._checkAndCreateAccelerometer())try{(typeof this._accelerometer.shakeHandlers[this._ad.guid]=="undefined"||this._accelerometer.shakeHandlers[this._ad.guid]===null)&&this._accelerometer.device.addEventListener("shaken",this._generateShakeListener())}catch(n){this._log("could not start the shake accelerometer")}},_generateShakeListener:function(){var n=function(){this._adContainer&&this._adContainer.postMessage({msg:MicrosoftNSJS.Advertising.AdContainer.MSG_TYPE_FIRESHAKE,all:!0})}.bind(this);return this._accelerometer!==null&&typeof this._accelerometer!="undefined"&&(this._accelerometer.shakeHandlers[this._ad.guid]=n),n},_stopShakeAccelerometer:function(){try{var n=this._accelerometer.shakeHandlers[this._ad.guid];n!==null&&typeof n!="undefined"&&(this._accelerometer.device.removeEventListener("shaken",n),this._accelerometer.shakeHandlers[this._ad.guid]=null)}catch(t){this._log("could not stop shake accelerometer")}},_getTilt:function(){var n,i,t;if(this._checkAndCreateAccelerometer())try{n=this._lastCoords;i=this._generateCoordsMessage(n.x,n.y,n.z);this._adContainer&&this._adContainer.postMessage({msg:MicrosoftNSJS.Advertising.AdContainer.MSG_TYPE_UPDATETILTCOORDS+":{"+i+"}",all:!0});t=this._accelerometer.device.getCurrentReading();this._lastCoords={x:t.accelerationX,y:t.accelerationY,z:t.accelerationZ}}catch(r){this._log("error in getTilt")}},_disposeAccelerometer:function(){this._accelerometer!==null&&this._accelerometer.device!==null&&typeof this._accelerometer.device=="object"&&(this._stopShakeAccelerometer(),this._stopTiltAccelerometer())},_checkAndCreateAccelerometer:function(){(this._accelerometer===null||typeof this._accelerometer.device!="object")&&(this._accelerometer={});try{return((this._accelerometer.device===null||typeof this._accelerometer.device!="object")&&(this._accelerometer.device=Windows.Devices.Sensors.Accelerometer.getDefault(),this._accelerometer.device.reportInterval=this._sensorOptions.accelerometer.reportIntervalMS),this._accelerometer.device===null||typeof this._accelerometer.device!="object")?(this._log("could not instantiate the accelerometer object, is the sensor online?"),!1):!0}catch(n){return!1}},_processOpenMessage:function(n){var t=null,i=null;try{t=JSON.parse(n);i=new Windows.Foundation.Uri(t.url);t.url.length<=this._MAX_URL_LENGTH&&MicrosoftNSJS.Advertising.AdContainer.ALLOWED_URI_SCHEMES[i.schemeName.toLowerCase()]?Windows.System.Launcher.launchUriAsync(i):this._reportError("open","unable to open URL")}catch(r){this._reportError("open","unable to open URL")}},_processViewableChangeMessage:function(n){if(n===null||n.indexOf("=")===-1)this._log("invalid viewable change message: "+n);else{var t=n.split("=");t[0]===MicrosoftNSJS.Advertising.AdContainer.MSG_TYPE_LISTENER?t[1]===MicrosoftNSJS.Advertising.AdContainer.MSG_TYPE_VALUESTART?this._startViewableChangeMonitoring():t[1]===MicrosoftNSJS.Advertising.AdContainer.MSG_TYPE_VALUESTOP?this._stopViewableChangeMonitoring():this._log("invalid viewable change message: "+n):this._log("invalid viewably change message: "+n)}},_storeAdInstanceState:function(n){this._adInstanceState=n;this._adContainer&&this._adContainer.mraidState===MicrosoftNSJS.Advertising.AdContainer.MRAID_STATE_TYPE.EXPANDED&&this._adContainer.postMessage({msg:MicrosoftNSJS.Advertising.AdContainer.MSG_TYPE_SETADINSTANCESTATE+":"+this._adInstanceState})},_startViewableChangeMonitoring:function(){this._viewableChangedTimer===null&&(this._adContainer&&this._adContainer.postMessage({msg:MicrosoftNSJS.Advertising.AdContainer.MSG_TYPE_VIEWABLECHANGE+":"+JSON.stringify({viewable:this._adContainer.isViewable()})}),this._viewableChangedTimer=window.setInterval(function(){var n=this._adContainer&&this._adContainer.isViewable();this._hasViewablility!==n&&(this._hasViewablility=n,this._adContainer&&this._adContainer.postMessage({msg:MicrosoftNSJS.Advertising.AdContainer.MSG_TYPE_VIEWABLECHANGE+":"+JSON.stringify({viewable:n})}))}.bind(this),this._viewableCheckPeriodMs));this._adContainer&&(this._hasViewablility=this._adContainer.isViewable(),this._adContainer.postMessage({msg:MicrosoftNSJS.Advertising.AdContainer.MSG_TYPE_VIEWABLECHANGE+":"+JSON.stringify({viewable:this._hasViewablility})}))},_stopViewableChangeMonitoring:function(){this._viewableChangedTimer!==null&&typeof this._viewableChangedTimer=="number"&&(window.clearInterval(this._viewableChangedTimer),this._viewableChangedTimer=null)},_processGetOrientationMessage:function(n){if(n!==null&&n.indexOf("=")!==-1){var t=n.split("=");t[0]===MicrosoftNSJS.Advertising.AdContainer.MSG_TYPE_LISTENER?t[1]===MicrosoftNSJS.Advertising.AdContainer.MSG_TYPE_VALUESTART?this._startOrientationMonitoring():t[1]===MicrosoftNSJS.Advertising.AdContainer.MSG_TYPE_VALUESTOP?this._stopOrientationMonitoring():this._log("invalid orientation message: "+n):this._log("invalid orientation message: "+n)}},_updateOrienation:function(){var n=-1;try{switch(Windows.Graphics.Display.DisplayProperties.currentOrientation){case Windows.Graphics.Display.DisplayOrientations.landscape:n=270;break;case Windows.Graphics.Display.DisplayOrientations.landscapeFlipped:n=90;break;case Windows.Graphics.Display.DisplayOrientations.portraitFlipped:n=180;break;case Windows.Graphics.Display.DisplayOrientations.portrait:n=0;break;default:n=-1}this._adContainer&&this._adContainer.postMessage({msg:MicrosoftNSJS.Advertising.AdContainer.MSG_TYPE_UPDATEORIENTATION+":"+JSON.stringify({orientation:n}),all:!0})}catch(t){control._reportError(MicrosoftNSJS.Advertising.AdContainer.MSG_TYPE_UPDATEORIENTATION,"Unable to communicate with orientation sensor.")}},_startOrientationMonitoring:function(){try{typeof this._orientationChangedHandler!="function"&&(this._orientationChangedHandler=function(){this._updateOrienation()}.bind(this),Windows.Graphics.Display.DisplayProperties.addEventListener("orientationchanged",this._orientationChangedHandler))}catch(n){control._reportError(MicrosoftNSJS.Advertising.AdContainer.MSG_TYPE_UPDATEORIENTATION,"Unable to communicate with orientation sensor.")}},_stopOrientationMonitoring:function(){try{typeof this._orientationChangedHandler=="function"&&(Windows.Graphics.Display.DisplayProperties.removeEventListener("orientationchanged",this._orientationChangedHandler),this._orientationChangedHandler=null)}catch(n){control._reportError(MicrosoftNSJS.Advertising.AdContainer.MSG_TYPE_UPDATEORIENTATION,"Unable to communicate with orientation sensor.")}},_scheduleRefresh:function(){if(this._isAutoRefreshEnabled&&this._refreshTimerId===null){var n=this;this._refreshTimerId=setTimeout(function(){n._refreshTimerId=null;n._refreshInternal()},this._refreshPeriodSeconds*1e3)}},_unscheduleRefresh:function(){this._refreshTimerId!==null&&(clearTimeout(this._refreshTimerId),this._refreshTimerId=null)},_request:function(n){if(this._getNetworkState()===this._ORMMA_NETWORK_OFFLINE){this._reportError(MicrosoftNSJS.Advertising.AdContainer.MSG_TYPE_REQUEST,"http request error, network offline");return}try{var i=this,t=new XMLHttpRequest;n.display.toLowerCase()!==this._ORMMA_RESPONSE_IGNORE&&(t.onreadystatechange=function(){if(this.readyState===XMLHttpRequest.DONE)if(this.status===200){var r={url:escape(n.url),response:escape(this.responseText)};i._adContainer&&i._adContainer.postMessage({msg:"ormmaResponse:"+JSON.stringify(r),all:!0})}else i._reportError(MicrosoftNSJS.Advertising.AdContainer.MSG_TYPE_REQUEST,"error on request to url: "+n.url+": code "+t.status)});t.open("GET",n.url,!0);t.setRequestHeader(this._HTTP_HEADER_CACHE_CONTROL,this._HTTP_HEADER_VALUE_CACHE_CONTROL_NO_CACHE);t.timeout=1e4;t.send(null)}catch(r){this._reportError(MicrosoftNSJS.Advertising.AdContainer.MSG_TYPE_REQUEST,"http request error: "+r.message)}},_validateParameters:function(){return this._applicationId===null||this._applicationId===""||this._adUnitId===null||this._adUnitId===""?(this._fireErrorOccurred("ad control requires applicationId and adUnitId properties to be set",this._ERROR_ENUM.ClientConfiguration),!1):typeof this.latitude!="undefined"&&!this._validateNumber("latitude",this.latitude)?!1:typeof this.longitude!="undefined"&&!this._validateNumber("longitude",this.longitude)?!1:!0},_validateNumber:function(n,t){if(typeof t=="number"){if(isNaN(t))return this._fireErrorOccurred(n+" value is not a valid number (NaN)",this._ERROR_ENUM.ClientConfiguration),!1}else return this._fireErrorOccurred(n+" value is not a valid type: "+typeof t,this._ERROR_ENUM.ClientConfiguration),!1;return!0},_getNetworkState:function(){var n,t;try{return n=this._networkInfo.getInternetConnectionProfile(),n&&n.getNetworkConnectivityLevel()!==Windows.Networking.Connectivity.NetworkConnectivityLevel.none?(t=n.networkAdapter.ianaInterfaceType,t===6||t===71?this._ORMMA_NETWORK_WIFI:this._ORMMA_NETWORK_CELL):this._ORMMA_NETWORK_OFFLINE}catch(i){this._log("error getting network state: "+(i!==null&&typeof i=="object"?i.message:"???"))}return this._ORMMA_NETWORK_UNKNOWN},_isElementAllowed:function(n){if(n!==null&&typeof n=="object"&&typeof n.tagName=="string"){var t=n.tagName.toLowerCase();return t==="button"||t==="menu"||t==="ol"||t==="textarea"||t==="ul"||t==="canvas"||t==="embed"||t==="html"||t==="iframe"||t==="img"||t==="input"||t==="select"||t==="video"||t==="a"?!1:!0}return!1},_log:function(){}},{OBJECT_NAME:"MicrosoftNSJS.Advertising.AdControl",POLY_API_URI:"ms-appx-web:///MSAdvertisingJS/ads/bootstrap.html",MRAID_API_URI:"ms-appx:///MSAdvertisingJS/ads/mraidApi.html",BASE_ELEMENT_TEMPLATE:"<base href='{url}'>",AD_TYPE:{rrmr:"rrmr",poly:"poly"},enableWebViewPool:{get:function(){return window._msAdsWebViewPool?!0:!1},set:function(n){n?window._msAdsWebViewPool||(msWriteProfilerMark("AdControl:enableWebViewPool:true"),window._msAdsWebViewPool=[]):(msWriteProfilerMark("AdControl:enableWebViewPool:false"),window._msAdsWebViewPool=null)}},releaseWebViewPool:function(){MicrosoftNSJS.Advertising.AdControl.enableWebViewPool&&(msWriteProfilerMark("AdControl:releaseWebViewPool"),window._msAdsWebViewPool=[])}})})})(WinJS);
/*!
  Copyright (C) Microsoft. All rights reserved.
  This library is supported for use in Windows Store apps only.
*/
(function(n){"use strict";var t=n.Class.define(function(n){if(!this._isNullOrUndefined(window)){if(this._isNullOrUndefined(window._msAdsAdSettingsControl)||window._msAdsAdSettingsControl.isInitialized!==!0){if(this._isNullOrUndefined(window._msAdsAdSettingsControl)||window._msAdsAdSettingsControl._objectName===MicrosoftNSJS.Advertising.AdSettingsControl.OBJECT_NAME){if(!this._isNullOrUndefined(window._msAdsAdSettingsControl)&&window._msAdsAdSettingsControl.isInitialized===!1)return this._logError("warning: window._msAdsAdSettingsControl already exists but is not initialized yet (are all promises complete?). Try again later or dispose and re-create."),window._msAdsAdSettingsControl}else this._logError("window._msAdsAdSettingsControl already exists but is not of correct object type [{0}]. Overwriting.",MicrosoftNSJS.Advertising.AdSettingsControl.OBJECT_NAME);try{this._objectName=MicrosoftNSJS.Advertising.AdSettingsControl.OBJECT_NAME;this._isInitialized=!1;window._msAdsAdSettingsControl=this;this._initialize(n);MicrosoftAdvertising.Shared.WinRT.UserInfoProvider.initialize().then(function(){this._isInitialized=!0;this._addSettingsFlyout()}.bind(this),function(n){this._logError("could not initialize UserInfoProvider. Error:",n);this._dispose()}.bind(this))}catch(t){this._dispose();this._logError("could not initialize AdSettingsControl error: {0}",t)}}return window._msAdsAdSettingsControl}},{_flyoutHtmlTemplateURI:"",_resourceLoader:null,_userInfoProvider:null,_targetingOptInState:null,_eventHandlers:{optToggle_Toggled:null,signInLink_Clicked:null,settingsFlyout_Activated:null},isInitialized:{get:function(){return this._isInitialized}},dispose:function(){try{this._dispose()}catch(n){try{this._logError("Could not dispose, exception thrown [{0}].",n)}catch(n){}}},_initialize:function(n){if(!this._isNullOrUndefined(n)&&(this._isNullOrUndefined(n.flyoutHtmlTemplateURI)||(this._flyoutHtmlTemplateURI=n.flyoutHtmlTemplateURI),!this._isNullOrUndefined(n.resourceLoaderURI)))try{this._resourceLoader=Windows.ApplicationModel.Resources.ResourceLoader(n.resourceLoaderURI)}catch(t){this._logError("Could not initialize, error: [{0}].",t)}this._userInfoProvider=MicrosoftAdvertising.Shared.WinRT.UserInfoProvider;this._targetingOptInState=MicrosoftAdvertising.Shared.WinRT.TargetingOptInState;this._createSettingsFlyoutEvent()},_addSettingsFlyout:function(){n.Application.addEventListener("settings",this._eventHandlers.settingsFlyout_Activated)},_createSettingsFlyoutEvent:function(){this._eventHandlers.settingsFlyout_Activated=function(t){try{if(MicrosoftAdvertising.Shared.WinRT.UserInfoProvider.isUserOptOutControlVisible()===!1)return;var i={name:"msaAdSettings",title:this._resourceLoader.getString("AdSettings_CommandText"),href:this._flyoutHtmlTemplateURI},r=Windows.UI.ApplicationSettings,u=new r.SettingsCommand(i.name,i.title,function(){n.UI.SettingsFlyout.showSettings(i.name,i.href)});t.detail.e.request.applicationCommands.append(u);this._wirePanelScript()}catch(f){this._logError("could not add settings flyout html in WinJS.Application.onsettings handler")}}.bind(this)},_wirePanelScript:function(){this._createPageEvents();var t=n.UI.Pages.define(this._flyoutHtmlTemplateURI,{ready:function(){document.getElementById("optToggle").winControl.addEventListener("change",this._eventHandlers.optToggle_Toggled);document.getElementById("signInLink").addEventListener("click",this._eventHandlers.signInLink_Clicked);this._updateResourceStrings();this._toggleProgress(!0);this._userInfoProvider.getGlobalTargetingOptInStateAsync().then(function(n){this._updateUI(n)}.bind(this),function(){this._showUnknownState()}.bind(this))}.bind(this),unload:function(){document.getElementById("optToggle").winControl.removeEventListener("change",this._eventHandlers.optToggle_Toggled);document.getElementById("signInLink").removeEventListener("click",this._eventHandlers.signInLink_Clicked)}.bind(this)})},_createPageEvents:function(){this._eventHandlers.optToggle_Toggled=function(n){try{this._userInfoProvider.setLocalTargetingOptInStateAsync(n.target.winControl.checked)}catch(i){var t=document.getElementById("optToggle");t.winControl.checked=!t.winControl.checked}}.bind(this);this._eventHandlers.signInLink_Clicked=function(){this._userInfoProvider.requestUserSignInAsync()}.bind(this)},_updateResourceStrings:function(){this._updateElementText("mainLabel","AdSettings_Flyout_Title",this._resourceLoader);this._updateElementText("heading1Label","AdSettings_Flyout_SectionName",this._resourceLoader);this._updateElementText("signInPrompt1","AdSettings_Flyout_SignInPrompt1",this._resourceLoader);this._updateElementText("signInLink","AdSettings_Flyout_SignInPrompt_SignIn",this._resourceLoader);this._updateElementText("signInPrompt2","AdSettings_Flyout_SignInPrompt2",this._resourceLoader);this._updateElementText("optedOutPrompt1","AdSettings_Flyout_OptedOut_Message1",this._resourceLoader);this._updateElementText("optOutMoreInfoLink","AdSettings_Flyout_OptedOut_Message_Here",this._resourceLoader);this._updateElementText("optedOutPrompt2","AdSettings_Flyout_OptedOut_Message2",this._resourceLoader);this._updateElementText("statusUnknownPrompt","AdSettings_Flyout_StatusUnknown_Message",this._resourceLoader);var n=document.getElementById("optToggle").winControl;n.title=this._resourceLoader.getString("AdSettings_Flyout_OptInSwitch_Header");n.labelOff=this._resourceLoader.getString("AdSettings_Flyout_OptInSwitch_Off");n.labelOn=this._resourceLoader.getString("AdSettings_Flyout_OptInSwitch_On");this._updateElementText("privacyStatementLink","AdSettings_Flyout_Privacy",this._resourceLoader)},_updateElementText:function(n,t,i){try{document.getElementById(n).innerText=i.getString(t)}catch(r){}},_updateUI:function(n){this._toggleProgress();var t=document.getElementById("optToggle");n===this._targetingOptInState.optedIn?(document.getElementById("optedOutPrompt").style.display="none",document.getElementById("signInPrompt").style.display="none",document.getElementById("statusUnknownPrompt").style.display="none",this._userInfoProvider.getLocalTargetingOptInStateAsync().then(function(n){t.winControl.checked=n!==this._targetingOptInState.optedOut?!0:!1;t.winControl.disabled=!1;t.style.display="block"}.bind(this))):n===this._targetingOptInState.userNotSignedIn?(document.getElementById("optedOutPrompt").style.display="none",document.getElementById("signInPrompt").style.display="block",document.getElementById("statusUnknownPrompt").style.display="none",t.winControl.disabled=!0,t.winControl.checked=!1,t.style.display="block"):n===this._targetingOptInState.optedOut?(document.getElementById("optedOutPrompt").style.display="block",document.getElementById("signInPrompt").style.display="none",document.getElementById("statusUnknownPrompt").style.display="none",t.winControl.disabled=!0,t.winControl.checked=!1,t.style.display="block"):n===this._targetingOptInState.unknown?this._showUnknownState():this._showUnknownState()},_showUnknownState:function(){var n=document.getElementById("optToggle");document.getElementById("optedOutPrompt").style.display="none";document.getElementById("signInPrompt").style.display="none";document.getElementById("statusUnknownPrompt").style.display="block";n.winControl.disabled=!0;n.winControl.checked=!1;n.style.display="block"},_toggleProgress:function(n){document.getElementById("progressRing").style.display=n?"block":"none"},_dispose:function(){n.Application.removeEventListener("settings",this._eventHandlers.settingsFlyout_Activated);this._isInitialized=!1;window._msAdsAdSettingsControl=null},_isNullOrUndefined:function(n){return typeof n=="undefined"||n===null?!0:!1},_logError:function(){}},{OBJECT_NAME:"MicrosoftNSJS.Advertising.AdSettingsControl"});n.Namespace.define("MicrosoftNSJS.Advertising",{AdSettingsControl:t})})(WinJS);
/*!
  Copyright (C) Microsoft. All rights reserved.
  This library is supported for use in Windows Store apps only.
*/
(function(n){"use strict";var t=n.Class.define(function(n){n&&MicrosoftNSJS.Advertising.AdContainer.TYPE[n.toUpperCase()]?(this._type=n,this._globalContainerManager=window._msAdsGlobalContainerManager,this._globalContainerManager||(this._globalContainerManager=window._msAdsGlobalContainerManager={adContainers:[]}),this._size={width:0,height:0},this._maxSize={width:0,height:0},this._screenSize={width:0,height:0},this._asyncRefCounts={anchor:0,expanded:0},this.state=MicrosoftNSJS.Advertising.AdContainer.STATE_TYPE.INITIALIZED):(this._log("Incorrect container type specified.",{fnName:"AdContainer()"}),this.state=MicrosoftNSJS.Advertising.AdContainer.STATE_TYPE.ERROR)},{onAdMessageReceived:null,onAdContainerLoaded:null,onExpandedClosed:null,mraidState:{get:function(){return this._mraidState},set:function(n){n&&this._mraidState!==n&&(this._mraidState=n,this.type===MicrosoftNSJS.Advertising.AdContainer.TYPE.POLYMORPHIC?this.postMessage({msg:MicrosoftNSJS.Advertising.AdContainer.MSG_TYPE_SETSTATE+":"+n,all:!0}):this.postMessage({msg:MicrosoftNSJS.Advertising.AdContainer.MSG_TYPE_SETSTATE+":"+n}))}},state:{get:function(){return this._state},set:function(n){console.log(this._id+": "+this._state+" -> "+n);msWriteProfilerMark("AdContainer:stateChange:"+this._id+": "+this._state+" -> "+n);this._state=n}},screenSize:{get:function(){return this._screenSize},set:function(n){n&&(n.height<0&&(n.height=0),n.width<0&&(n.width=0),(n.forceUpdate||this._screenSize.width!==n.width||this._screenSize.height!==n.height)&&(this._screenSize={height:n.height,width:n.width},this.postMessage({msg:MicrosoftNSJS.Advertising.AdContainer.MSG_TYPE_SETSCREENSIZE+":"+JSON.stringify(this._screenSize)})))}},size:{get:function(){return this._size},set:function(n){n&&(n.height<1&&(n.height=1),n.width<1&&(n.width=1),(n.forceUpdate||this._size.width!==n.width||this._size.height!==n.height)&&(this._size={width:n.width,height:n.height},this._expandedContainer_DOM||(this._viewContainer_DOM.width=this._size.width,this._viewContainer_DOM.height=this._size.height),this.postMessage({msg:MicrosoftNSJS.Advertising.AdContainer.MSG_TYPE_SETSIZE+":"+JSON.stringify(this._size)})))}},maxSize:{get:function(){return this._maxSize},set:function(n){n&&(n.height<1&&(n.height=1),n.width<1&&(n.width=1),(n.forceUpdate||this._maxSize.width!==n.width||this._maxSize.height!==n.height)&&(this._maxSize={height:n.height,width:n.width},this.postMessage({msg:MicrosoftNSJS.Advertising.AdContainer.MSG_TYPE_SETMAXSIZE+":"+JSON.stringify(this._maxSize)})))}},originalProperties:{get:function(){return this._originalProperties}},expandProperties:{set:function(n){n&&(n.height<1&&(n.height=1),n.width<1&&(n.width=1),this.state===MicrosoftNSJS.Advertising.AdContainer.STATE_TYPE.EXPANDED&&this._expandedContainer_DOM?(this._expandedContainer_DOM.width=n.width,this._expandedContainer_DOM.height=n.height,this._expandedContainer_DOM.style.top=n.y+"px",this._expandedContainer_DOM.style.left=n.x+"px"):this.state===MicrosoftNSJS.Advertising.AdContainer.STATE_TYPE.EXPANDED&&this._viewContainer_DOM&&(this._viewContainer_DOM.width=n.width,this._viewContainer_DOM.height=n.height,this._parentElement_DOM.style.width=n.width+"px",this._parentElement_DOM.style.height=n.height+"px",this._parentElement_DOM.style.top=n.y+"px",this._parentElement_DOM.style.left=n.x+"px"),this._expandProperties=n)},get:function(){return this._expandProperties}},parentElement:{get:function(){return this._parentElement_DOM}},type:{get:function(){return this._type}},_viewContainer_DOM:null,_expandedContainer_DOM:null,_overlayDiv_DOM:null,_parentElement_DOM:null,_id:null,_globalContainerManager:null,_mraidState:null,_type:null,_state:null,_size:{width:0,height:0},_maxSize:{width:0,height:0},_screenSize:{width:0,height:0},_asyncRefCounts:{anchor:0,expanded:0},_expandProperties:null,_originalProperties:null,create:function(n){if(this._state!==MicrosoftNSJS.Advertising.AdContainer.STATE_TYPE.INITIALIZED){this._log("Ad container is not in correct state, expected=initialized, actual="+this._state+".",{fnName:"create"});return}if(!n||typeof n!="object"){this._log("Options parameter is empty.",{fnName:"create"});return}try{msWriteProfilerMark("AdContainer:create:s");this._id=n.containerId;this._parentElement_DOM=n.parentElement;var t=null;if(window._msAdsWebViewPool&&window._msAdsWebViewPool.length>0?(msWriteProfilerMark("AdContainer:create:_msAdsWebViewPool.shift(). #WebViews:"+window._msAdsWebViewPool.length),t=window._msAdsWebViewPool.shift(),this._log("x-ms-webview reused from _webViewPool.",{fnName:"create"})):(msWriteProfilerMark("AdContainer:create:create x-ms-webview"),t=document.createElement("x-ms-webview"),this._log("x-ms-webview new-created.",{fnName:"create"})),t.usage?t.usage++:t.usage=1,t.id=n.containerId,t.frameBorder=0,t.marginwidth=0,t.marginheight=0,t.style.position="absolute",t.style.visibility="hidden",t.style.backgroundColor="transparent",t.style.opacity=0,t.title=MicrosoftNSJS.Advertising.AdContainer.STRINGS.WEBVIEW_TITLE,this._webViewScriptNotify=function(n){this._viewScriptNotify_Handler(n)}.bind(this),t.addEventListener("MSWebViewScriptNotify",this._webViewScriptNotify),this._webViewNavigationStarting=function(n){this._viewContainerNavigationStarting_Handler(n)}.bind(this),t.addEventListener("MSWebViewNavigationStarting",this._webViewNavigationStarting),this._webViewNavigationCompleted=function(n){this._viewNavigationCompleted_Handler(n)}.bind(this),t.addEventListener("MSWebViewNavigationCompleted",this._webViewNavigationCompleted),t.addEventListener("MSWebViewFrameNavigationCompleted",this._webViewNavigationCompleted),n.sourceUri)this.state=MicrosoftNSJS.Advertising.AdContainer.STATE_TYPE.LOADING,t.navigate(n.sourceUri);else if(n.sourceHTML)this.state=MicrosoftNSJS.Advertising.AdContainer.STATE_TYPE.LOADING,t.navigateToString(n.sourceHTML);else{this._log("Either sourceUri or sourceHTML must be specified.",{fnName:"create"});this.state=MicrosoftNSJS.Advertising.AdContainer.STATE_TYPE.ERROR;return}this.mraidState=MicrosoftNSJS.Advertising.AdContainer.MRAID_STATE_TYPE.LOADING;this._originalProperties={width:this._parentElement_DOM.offsetWidth,height:this._parentElement_DOM.offsetHeight,y:this._parentElement_DOM.style.top,x:this._parentElement_DOM.style.left,zIndex:this._parentElement_DOM.style.zIndex,position:this._parentElement_DOM.style.position};this._parentElement_DOM.appendChild(t);this._log("x-ms-webview created and added to DOM.",{fnName:"create"});this._viewContainer_DOM=t;this._addToGlobalContainerManager();msWriteProfilerMark("AdContainer:create:e")}catch(i){this._log("Unable to create view container. Error:{0}",{fnName:"create",err:i})}},remove:function(){try{this._viewContainer_DOM&&this._viewContainer_DOM.parentElement&&this._parentElement_DOM&&(this._parentElement_DOM.removeChild(this._viewContainer_DOM),this._cleanupViewContainer());this._expandedContainer_DOM&&this._expandedContainer_DOM.parentElement&&document.body.removeChild(this._expandedContainer_DOM);this._overlayDiv_DOM&&(document.body.removeChild(this._overlayDiv_DOM),this._overlayDiv_DOM=null)}catch(n){this._log("Unable to remove view container. Error:{0}",{fnName:"remove",err:n});this.state=MicrosoftNSJS.Advertising.AdContainer.STATE_TYPE.ERROR;return}this._log("Ad container elements removed from DOM.",{fnName:"remove"});this.state=MicrosoftNSJS.Advertising.AdContainer.STATE_TYPE.REMOVED},dispose:function(){if(this.state===MicrosoftNSJS.Advertising.AdContainer.STATE_TYPE.DISPOSED||this.state===MicrosoftNSJS.Advertising.AdContainer.STATE_TYPE.DISPOSING){this._log("Ad container already disposed or disposing.",{fnName:"dispose"});return}msWriteProfilerMark("AdContainer:dispose:s");this.state!==MicrosoftNSJS.Advertising.AdContainer.STATE_TYPE.REMOVED&&this.remove();this.state=MicrosoftNSJS.Advertising.AdContainer.STATE_TYPE.DISPOSING;this._asyncRefCounts.anchor<1&&(this._viewContainer_DOM=null);this._asyncRefCounts.expanded<1&&(this._expandedContainer_DOM=null);this._viewContainer_DOM===null&&this._expandedContainer_DOM===null?(this._removeFromGlobalContainerManager(),this._parentElement_DOM=null,this._id=null,this._mraidState=null,this._originalProperties=null,this.state=MicrosoftNSJS.Advertising.AdContainer.STATE_TYPE.DISPOSED,this._log("Ad container disposed.",{fnName:"dispose"})):this._log("Ad container not fully disposed, "+this._asyncRefCounts.anchor+" anchor and "+this._asyncRefCounts.expanded+" expanded async calls outstanding.",{fnName:"dispose"});msWriteProfilerMark("AdContainer:dispose:e[state="+this.state+"]")},suspend:function(){if(this.state===MicrosoftNSJS.Advertising.AdContainer.STATE_TYPE.SUSPENDED){this._log("Cannot suspend. Ad container already suspended.",{fnName:"suspend"});return}this.type===MicrosoftNSJS.Advertising.AdContainer.TYPE.POLYMORPHIC&&this.postMessage({msg:MicrosoftNSJS.Advertising.AdContainer.MSG_TYPE_SETSTATE+":"+MicrosoftNSJS.Advertising.AdContainer.STATE_TYPE.SUSPENDED,all:!0});this.state=MicrosoftNSJS.Advertising.AdContainer.STATE_TYPE.SUSPENDED},resume:function(){if(this.state!==MicrosoftNSJS.Advertising.AdContainer.STATE_TYPE.SUSPENDED){this._log("Cannot resume. Ad container not currently suspended.",{fnName:"resume"});return}this.type===MicrosoftNSJS.Advertising.AdContainer.TYPE.POLYMORPHIC&&this.postMessage({msg:MicrosoftNSJS.Advertising.AdContainer.MSG_TYPE_SETSTATE+":"+this.mraidState,all:!0});this.state=MicrosoftNSJS.Advertising.AdContainer.STATE_TYPE.DEFAULT},show:function(){if(this._state!==MicrosoftNSJS.Advertising.AdContainer.STATE_TYPE.DEFAULT){this._log("Unable to show container in current state. State: ."+this.state,{fnName:"show"});return}this._viewContainer_DOM.style.opacity=1;this._viewContainer_DOM.style.visibility="inherit";this._log("View container set to visible.",{fnName:"show"})},fadeIn:function(n,t){if(this._state!==MicrosoftNSJS.Advertising.AdContainer.STATE_TYPE.DEFAULT){this._log("Unable to fade in container in current state. State: ."+this._state,{fnName:"fadeIn"});return}try{this._viewContainer_DOM?(this._viewContainer_DOM.style.visibility="inherit",this._viewContainer_DOM.style.transition="opacity "+n.fadeInTimeS+"s"+n.timer.linear,this._viewContainer_DOM.style.opacity=1,typeof t=="function"&&window.setTimeout(function(){t(!0)},n.fadeInTimeS*1e3)):typeof t=="function"&&t(!1)}catch(i){this._log("Unable to fade in. Error:{0}",{fnName:"fadeIn",err:i})}},postMessage:function(n){if(this._inActionableState()){if(!n||typeof n!="object"){this._log("Options parameter is empty.",{fnName:"postMessage"});return}if(!n.msg||n.msg===""){this._log("Options.msg parameter is empty. Nothing to send",{fnName:"postMessage"});return}if(this.state===MicrosoftNSJS.Advertising.AdContainer.STATE_TYPE.LOADING||this.state===MicrosoftNSJS.Advertising.AdContainer.STATE_TYPE.EXPANDING){this._log("Cannot post message. Control is in "+this.state+" state. msg="+n.msg,{fnName:"postMessage"});return}var r=n.receiveFunctionName||"receiveMessage",t=null,i="anchor";this.state===MicrosoftNSJS.Advertising.AdContainer.STATE_TYPE.EXPANDED&&this._expandedContainer_DOM&&(i="expanded");try{(i==="anchor"||n.all)&&this._viewContainer_DOM&&(t=this._viewContainer_DOM.invokeScriptAsync(r,n.msg),this._asyncRefCounts.anchor++,t.oncomplete=function(){this._invokeScriptAsyncCompleted_Handler("anchor");t=null;this._log("InvokeScriptAsync mainContainer SUCCESS msg="+n.msg+"",{fnName:"postMessage"})}.bind(this),t.onerror=function(){this._invokeScriptAsyncCompleted_Handler("anchor");t=null;this._log("InvokeScriptAsync mainContainer ERROR msg="+n.msg+"",{fnName:"postMessage"})}.bind(this),t.start());(i==="expanded"||n.all)&&this._expandedContainer_DOM&&(t=this._expandedContainer_DOM.invokeScriptAsync(r,n.msg),this._asyncRefCounts.expanded++,t.oncomplete=function(){this._invokeScriptAsyncCompleted_Handler("expanded");t=null;this._log("InvokeScriptAsync expandedContainer SUCCESS msg="+n.msg+"",{fnName:"postMessage"})}.bind(this),t.onerror=function(){this._invokeScriptAsyncCompleted_Handler("expanded");t=null;this._log("InvokeScriptAsync expandedContainer ERROR msg="+n.msg+"",{fnName:"postMessage"})}.bind(this),t.start())}catch(u){this._log("InvokeScriptAsync Error:{0}",{fnName:"postMessage",err:u})}}},isViewable:function(){if(this._inActionableState()){var n;try{return!this._viewContainer_DOM||!this._viewContainer_DOM.currentStyle?!1:(n=parseInt(this._viewContainer_DOM.currentStyle.opacity,10),isNaN(n)&&(n=0),this.isOnScreen()&&n===1)}catch(t){return this._log("Could not determine if ad container is viewable. Error thrown [{0}]",{fnName:"isViewable",err:t}),!1}}},isOnScreen:function(){var n,t,i;if(this._inActionableState()){if(this._parentElement_DOM===null||this._parentElement_DOM.offsetWidth===0||this._parentElement_DOM.offsetHeight===0||this.isHidden()||this._viewContainer_DOM.offsetWidth===0||this._viewContainer_DOM.offsetHeight===0)return!1;n={};try{n=this._parentElement_DOM.getBoundingClientRect()}catch(r){return this._log("getBoundingClientRect error thrown. [{0}]",{fnName:"isOnScreen",err:r}),!1}return t=this._parentElement_DOM.offsetWidth*MicrosoftNSJS.Advertising.AdContainer.FREACTION_ALLOWED_OFFSCREEN,i=this._parentElement_DOM.offsetHeight*MicrosoftNSJS.Advertising.AdContainer.FREACTION_ALLOWED_OFFSCREEN,n.left>=-t&&n.top>=-i&&n.right<document.documentElement.offsetWidth+t&&n.bottom<document.documentElement.offsetHeight+i}},isHidden:function(){var n,t;if(this._inActionableState()){for(n=this._viewContainer_DOM;n!==null&&typeof n=="object"&&n.nodeName!=="BODY";){if(t=typeof n.style!="undefined"?n.style.visibility:"",t==="hidden"||t==="collapse")return!0;if(t==="visible")break;else n=n.parentNode}return!1}},close:function(){this.mraidState!==MicrosoftNSJS.Advertising.AdContainer.MRAID_STATE_TYPE.HIDDEN&&(this.mraidState===MicrosoftNSJS.Advertising.AdContainer.MRAID_STATE_TYPE.EXPANDED?(this._expandedContainer_DOM?document.body.removeChild(this._expandedContainer_DOM):(this.size={width:this._originalProperties.width,height:this._originalProperties.height},this._parentElement_DOM.style.top=this._originalProperties.y,this._parentElement_DOM.style.left=this._originalProperties.x,this._parentElement_DOM.style.width=this._originalProperties.width+"px",this._parentElement_DOM.style.height=this._originalProperties.height+"px",this._parentElement_DOM.style.zIndex=this._originalProperties.zIndex,this._parentElement_DOM.style.position=this._originalProperties.position),this._overlayDiv_DOM&&(document.body.removeChild(this._overlayDiv_DOM),this._overlayDiv_DOM=null),this.mraidState=MicrosoftNSJS.Advertising.AdContainer.MRAID_STATE_TYPE.DEFAULT,this.state=MicrosoftNSJS.Advertising.AdContainer.STATE_TYPE.DEFAULT):this.mraidState===MicrosoftNSJS.Advertising.AdContainer.MRAID_STATE_TYPE.DEFAULT?(this._viewContainer_DOM.style.visibility="hidden",this.mraidState=MicrosoftNSJS.Advertising.AdContainer.MRAID_STATE_TYPE.HIDDEN):this.mraidState===MicrosoftNSJS.Advertising.AdContainer.MRAID_STATE_TYPE.RESIZED&&(this.size={width:this.originalProperties.width,height:this.originalProperties.height},this.mraidState=MicrosoftNSJS.Advertising.AdContainer.MRAID_STATE_TYPE.DEFAULT))},initializeOrmma:function(n){if(this._inActionableState()){var i="undefined",t=!1;n&&typeof n=="object"&&typeof n.sdkInfo=="object"||this._log("Unable to initialize ormma, missing options arguments.",{fnName:"initializeOrmma"});try{i=Windows.Globalization.ApplicationLanguages.languages[0]}catch(r){this._log("Unable to init locale. Error={0}",{err:r,fnName:"initializeOrmma"})}this.postMessage({msg:MicrosoftNSJS.Advertising.AdContainer.MSG_TYPE_SETLOCALE+":"+i});this.postMessage({msg:MicrosoftNSJS.Advertising.AdContainer.MSG_TYPE_SETNETWORK+":"+n.networkState});this.postMessage({msg:MicrosoftNSJS.Advertising.AdContainer.MSG_TYPE_SETSDKINFO+":"+JSON.stringify(n.sdkInfo)});try{t=Windows.Devices.Sensors.Accelerometer.getDefault()!==null}catch(u){this._log("Could not detect accelerometer. Error={0}",{err:u,fnName:"initializeOrmma"})}this.postMessage({msg:MicrosoftNSJS.Advertising.AdContainer.MSG_TYPE_SETCAPABILITY+":"+JSON.stringify({capability:"tilt",value:t})});this.postMessage({msg:MicrosoftNSJS.Advertising.AdContainer.MSG_TYPE_SETCAPABILITY+":"+JSON.stringify({capability:"shake",value:t})})}},expand:function(n,t){if(this._inActionableState()&&this.mraidState!==MicrosoftNSJS.Advertising.AdContainer.MRAID_STATE_TYPE.HIDDEN){if(this.mraidState===MicrosoftNSJS.Advertising.AdContainer.MRAID_STATE_TYPE.EXPANDED){this._log("Unable to expand, already in expanded state.",{fnName:"expand"});return}if(!t){this._log("Unable to expand, options parameter is empty.",{fnName:"expand"});return}this.type===MicrosoftNSJS.Advertising.AdContainer.TYPE.POLYMORPHIC?this._expandPolymorphic(n,t):this.type===MicrosoftNSJS.Advertising.AdContainer.TYPE.MRAID&&this._expandMraid(t)}},_expandPolymorphic:function(n,t){try{this._overlayDiv_DOM=this._createOverlayDiv();this._expandedContainer_DOM=this._createExpandedContainer();n&&n.length!=0?(this._expandedContainer_DOM.addEventListener("MSWebViewNavigationCompleted",function(){this.state=MicrosoftNSJS.Advertising.AdContainer.STATE_TYPE.EXPANDED}.bind(this)),this.state=MicrosoftNSJS.Advertising.AdContainer.STATE_TYPE.EXPANDING,this._expandedContainer_DOM.navigate(n)):(this._expandedContainer_DOM.addEventListener("MSWebViewNavigationCompleted",function(n){if(this.state=MicrosoftNSJS.Advertising.AdContainer.STATE_TYPE.EXPANDED,typeof t.onAdContainerLoaded=="function")t.onAdContainerLoaded(n)}.bind(this)),this._expandedContainer_DOM.addEventListener("MSWebViewScriptNotify",function(n){this._viewScriptNotify_Handler(n)}.bind(this)),this._expandedContainer_DOM.addEventListener("MSWebViewNavigationStarting",function(n){this._viewContainerNavigationStarting_Handler(n)}.bind(this)),this.state=MicrosoftNSJS.Advertising.AdContainer.STATE_TYPE.EXPANDING,this._expandedContainer_DOM.navigate(t.sourceUri));document.body.appendChild(this._overlayDiv_DOM);document.body.appendChild(this._expandedContainer_DOM)}catch(i){this._log("Unable to expand. Error thrown [{0}]",{fnName:"_expandPolymorphic",err:i})}},_expandMraid:function(n){try{this._overlayDiv_DOM=this._createOverlayDiv();n.sourceHTML&&n.sourceHTML.length>0?(this._expandedContainer_DOM=this._createExpandedContainer(),this._expandedContainer_DOM.addEventListener("MSWebViewNavigationCompleted",function(){this.state=MicrosoftNSJS.Advertising.AdContainer.STATE_TYPE.EXPANDED;typeof n.onAdContainerLoaded=="function"&&n.onAdContainerLoaded()}.bind(this)),this.state=MicrosoftNSJS.Advertising.AdContainer.STATE_TYPE.EXPANDING,this._expandedContainer_DOM.navigateToString(n.sourceHTML),document.body.appendChild(this._expandedContainer_DOM)):(this._parentElement_DOM.style.position="absolute",this._parentElement_DOM.style.width=this._expandProperties.width+"px",this._parentElement_DOM.style.height=this._expandProperties.height+"px",this._parentElement_DOM.style.top=this._expandProperties.y+"px",this._parentElement_DOM.style.left=this._expandProperties.x+"px",this._parentElement_DOM.style.zIndex=MicrosoftNSJS.Advertising.AdContainer.EXPANDED_AD_ZINDEX,this.state=MicrosoftNSJS.Advertising.AdContainer.STATE_TYPE.EXPANDED,typeof n.onAdContainerLoaded=="function"&&n.onAdContainerLoaded());document.body.appendChild(this._overlayDiv_DOM)}catch(t){this._log("Unable to expand. Error thrown [{0}]",{fnName:"_expandPolymorphic",err:t})}},_createExpandedContainer:function(){var n=document.createElement("x-ms-webview");return n.id=this._id+"_expandedContainer",n.style.top=this._expandProperties.y+"px",n.style.left=this._expandProperties.x+"px",n.style.zIndex=MicrosoftNSJS.Advertising.AdContainer.EXPANDED_AD_ZINDEX,n.style.position="absolute",n.width=this._expandProperties.width,n.height=this._expandProperties.height,n.marginwidth=0,n.marginheight=0,n.frameBorder=0,n.title=MicrosoftNSJS.Advertising.AdContainer.STRINGS.WEBVIEW_TITLE,n.onblur=function(n){try{n.currentTarget.focus()}catch(t){}},n.addEventListener("focus",function(){this.postMessage({msg:MicrosoftNSJS.Advertising.AdContainer.MSG_TYPE_SETFOCUS+":true"})}.bind(this)),n},_createOverlayDiv:function(){var n=document.createElement("div");return n.style.zIndex=MicrosoftNSJS.Advertising.AdContainer.EXPANDED_AD_ZINDEX-1,n.style.position="absolute",n.style.top="0px",n.style.left="0px",n.style.width="100%",n.style.height="100%",n.id=this._id+"_overlayDiv",n.style.backgroundColor="#000000",n.style.opacity=.8,n.onclick=function(){this._expandProperties&&!this._expandProperties.useCustomClose&&typeof this.onExpandedClosed=="function"&&this.onExpandedClosed()}.bind(this),n},_viewScriptNotify_Handler:function(n){if(this._inActionableState()&&(this._log("Message received from ad container. Message:'"+n.value+"'",{fnName:"_viewScriptNotify_Handler"}),typeof this.onAdMessageReceived=="function"))this.onAdMessageReceived({containerId:this._id,data:n.value,timeStamp:n.timeStamp})},_viewNavigationCompleted_Handler:function(n){if(this._inActionableState()){if(this._state!==MicrosoftNSJS.Advertising.AdContainer.STATE_TYPE.LOADING){this._log("View container navigation occured in incorrect state. Expected: "+MicrosoftNSJS.Advertising.AdContainer.STATE_TYPE.LOADING+", Actual: "+this._state+".",{fnName:"_viewNavigationCompleted_Handler"});return}if(this.state=MicrosoftNSJS.Advertising.AdContainer.STATE_TYPE.DEFAULT,this._log("View container navigation complete.",{fnName:"_viewNavigationCompleted_Handler"}),typeof this.onAdContainerLoaded=="function")this.onAdContainerLoaded({containerId:this._id,timeStamp:n.timeStamp,element:this})}},_viewContainerNavigationStarting_Handler:function(n){if(this._inActionableState()){var t;if(this.state!==MicrosoftNSJS.Advertising.AdContainer.STATE_TYPE.LOADING&&this.state!==MicrosoftNSJS.Advertising.AdContainer.STATE_TYPE.EXPANDING&&n)try{if(n.preventDefault(),this._log("View container navigation stopped.",{fnName:"_viewContainerNavigationStarting_Handler"}),t=new Windows.Foundation.Uri(n.uri),MicrosoftNSJS.Advertising.AdContainer.ALLOWED_URI_SCHEMES[t.schemeName.toLowerCase()])Windows.System.Launcher.launchUriAsync(t),this._log("View container navigation redirected. Uri:'"+n.uri+"'",{fnName:"_viewContainerNavigationStarting_Handler"});else throw"URI Scheme not allowed.";}catch(i){this._log("View container navigation handler error. Error: {0}",{err:i,fnName:"_viewContainerNavigationStarting_Handler"})}}},_inActionableState:function(){return this.state===MicrosoftNSJS.Advertising.AdContainer.STATE_TYPE.DISPOSED||this.state===MicrosoftNSJS.Advertising.AdContainer.STATE_TYPE.DISPOSING||this.state===MicrosoftNSJS.Advertising.AdContainer.STATE_TYPE.ERROR||this.state===MicrosoftNSJS.Advertising.AdContainer.STATE_TYPE.REMOVED?!1:!0},_invokeScriptAsyncCompleted_Handler:function(n){try{if(this.state===MicrosoftNSJS.Advertising.AdContainer.STATE_TYPE.DISPOSED)return;if(n==="anchor"?this._asyncRefCounts.anchor--:n==="expanded"&&this._asyncRefCounts.expanded--,this.state===MicrosoftNSJS.Advertising.AdContainer.STATE_TYPE.DISPOSING){if(this._asyncRefCounts.anchor<1&&this._viewContainer_DOM&&(this._viewContainer_DOM=null,this._expandedContainer_DOM===null)){this.state=MicrosoftNSJS.Advertising.AdContainer.STATE_TYPE.DISPOSED;this._removeFromGlobalContainerManager();this._log("Ad container fully disposed.",{fnName:"_invokeScriptAsyncCompleted_Handler"});return}if(this._asyncRefCounts.expanded<1&&this._expandedContainer_DOM&&(this._expandedContainer_DOM=null,this._viewContainer_DOM===null)){this.state=MicrosoftNSJS.Advertising.AdContainer.STATE_TYPE.DISPOSED;this._removeFromGlobalContainerManager();this._log("Ad container fully disposed.",{fnName:"_invokeScriptAsyncCompleted_Handler"});return}}}catch(t){this._log("Invoke Script Handler Error: {0}",{err:t,fnName:"_invokeScriptAsyncCompleted_Handler"})}},_addToGlobalContainerManager:function(){if(this._inActionableState())try{this._globalContainerManager.adContainers.push(this)}catch(n){this._log("Unable to add container to global manager. Error: {0}",{err:n,fnName:"_addToGlobalContainerManager"})}},_removeFromGlobalContainerManager:function(){var n;try{for(n=0;n<this._globalContainerManager.adContainers.length;n++)if(this._globalContainerManager.adContainers[n]&&this._globalContainerManager.adContainers[n]._id===this._id){this._globalContainerManager.adContainers.splice(n,1);return}}catch(t){this._log("Unable to remove container from global manager. Error: {0}",{err:t,fnName:"_removeFromGlobalContainerManager"})}},_cleanupViewContainer:function(){if(this._viewContainer_DOM)try{this._viewContainer_DOM.removeEventListener("MSWebViewScriptNotify",this._webViewScriptNotify);this._viewContainer_DOM.removeEventListener("MSWebViewNavigationStarting",this._webViewNavigationStarting);this._viewContainer_DOM.removeEventListener("MSWebViewNavigationCompleted",this._webViewNavigationCompleted);this._viewContainer_DOM.removeEventListener("MSWebViewFrameNavigationCompleted",this._webViewNavigationCompleted);window._msAdsWebViewPool&&this._viewContainer_DOM.usage<5&&(window._msAdsWebViewPool.push(this._viewContainer_DOM),this._log("x-ms-WebView has been pushed to the web view pool",{fnName:"_cleanupViewContainer"}),msWriteProfilerMark("AdContainer:CleanupViewContainer:WebView pushed. #WebViews:"+window._msAdsWebViewPool.length))}catch(n){this._log("Unable to cleanup WebView. Error: {0}",{err:n,fnName:"_cleanupViewContainer"})}},_log:function(){}},{OBJECT_NAME:"MicrosoftNSJS.Advertising.AdContainer",FREACTION_ALLOWED_OFFSCREEN:.4,TYPE:{MRAID:"MRAID",POLYMORPHIC:"POLYMORPHIC"},STRINGS:{WEBVIEW_TITLE:"Advertisement"},MRAID_STATE_TYPE:{LOADING:"loading",DEFAULT:"default",EXPANDED:"expanded",HIDDEN:"hidden",RESIZED:"resized"},STATE_TYPE:{ERROR:"error",INITIALIZED:"initialized",LOADING:"loading",DEFAULT:"default",EXPANDING:"expanding",EXPANDED:"expanded",REMOVED:"removed",DISPOSED:"disposed",DISPOSING:"disposing",SUSPENDED:"suspended"},EXPANDED_AD_ZINDEX:2147483637,ALLOWED_URI_SCHEMES:{http:"http",https:"https","ms-windows-store":"ms-windows-store",skype:"skype",microsoftmusic:"microsoftmusic",xboxsmartglass:"xboxsmartglass",xboxgames:"xboxgames",microsoftvideo:"microsoftvideo",bingtravel:"bingtravel",bingweather:"bingweather",bingmaps:"bingmaps",bingfinance:"bingfinance",bingsports:"bingsports",bingfoodanddrink:"bingfoodanddrink",binghealthnfitness:"binghealthnfitness",bingnews:"bingnews"},MSG_TYPE_ADPARAMS:"adParams",MSG_TYPE_PRMPARAMS:"prmParams",MSG_TYPE_APPPARAMS:"appParams",MSG_TYPE_INIT:"init",MSG_TYPE_ORMMA_START:"ormmaStart",MSG_TYPE_SCRIPT:"script",MSG_TYPE_SETMAXSIZE:"setMaxSize",MSG_TYPE_SETSCREENSIZE:"setScreenSize",MSG_TYPE_SETSIZE:"setSize",MSG_TYPE_SETSTATE:"setState",MSG_TYPE_FIRESHAKE:"fireShake",MSG_TYPE_UPDATETILTCOORDS:"updateTiltCoords",MSG_TYPE_UPDATEORIENTATION:"updateOrienation",MSG_TYPE_SETNETWORK:"setNetwork",MSG_TYPE_VIEWABLECHANGE:"viewableChange",MSG_TYPE_SETLOCALE:"setLocale",MSG_TYPE_SETSDKINFO:"setSdkInfo",MSG_TYPE_SETCAPABILITY:"setCapability",MSG_TYPE_SETADINSTANCESTATE:"setAdInstanceState",MSG_TYPE_WIREAPPEVENTS:"wireAppEvents",MSG_TYPE_SETFOCUS:"setFocus",MSG_TYPE_INITIALIZED:"adInitialized",MSG_TYPE_ADRENDERED:"rendered",MSG_TYPE_OPEN:"web",MSG_TYPE_EXPAND:"expand",MSG_TYPE_CLOSE:"close",MSG_TYPE_RESIZE:"resize",MSG_TYPE_HIDE:"hide",MSG_TYPE_SHOW:"show",MSG_TYPE_SETEXPANDPROPERTIES:"setexpandproperties",MSG_TYPE_SETUSERENGAGED:"setuserengaged",MSG_TYPE_TILT:"tilt",MSG_TYPE_SHAKE:"shake",MSG_TYPE_LISTENER:"listener",MSG_TYPE_VALUESTART:"start",MSG_TYPE_VALUESTOP:"stop",MSG_TYPE_GETTILT:"gettilt",MSG_TYPE_GETORIENTATION:"getorientation",MSG_TYPE_REFRESH:"refresh",MSG_TYPE_REQUEST:"request",MSG_TYPE_STOREADINSTANCESTATE:"storeadinstancestate",MSG_TYPE_ONPOINTERDOWN:"MSPointerDown",MSG_TYPE_ONPOINTERUP:"MSPointerUp",MSG_TYPE_USECUSTOMCLOSE:"usecustomclose",MSG_TYPE_ONMOUSEWHEEL:"MSMouseWheel",MSG_TYPE_ONPOINTERMOVE:"MSPointerMove",MSG_TYPE_ONMANIPSTATECHANGED:"MSManipulationStateChanged",MSG_TYPE_ERROR:"error"});n.Namespace.define("MicrosoftNSJS.Advertising",{AdContainer:t})})(WinJS);
/*!
  Copyright (C) Microsoft. All rights reserved.
  This library is supported for use in Windows Store apps only.
*/
(function(n){"use strict";var t=n.Class.define(function(){if(!this._isNullOrUndefined(window))return(this._isNullOrUndefined(window._msAdsGlobalEventManager)||window._msAdsGlobalEventManager.isInitialized!==!0)&&(this._isNullOrUndefined(window._msAdsGlobalEventManager)||window._msAdsGlobalEventManager._objectName===MicrosoftNSJS.Advertising.AdGlobalEventManager.OBJECT_NAME||this._logError("window._msAdsGlobalEventManager already exists but is not of correct object type [{0}]. Overwriting.",MicrosoftNSJS.Advertising.AdGlobalEventManager.OBJECT_NAME),this._objectName=MicrosoftNSJS.Advertising.AdGlobalEventManager.OBJECT_NAME,this._isInitialized=!0,window._msAdsGlobalEventManager=this),window._msAdsGlobalEventManager},{isInitialized:{get:function(){return this._isInitialized}},_eventListeners:null,_isInitialized:!1,addEventListener:function(n,t){if(this._isNullOrUndefined(n)||this._isNullOrUndefined(t)){this._logError("Could not add listener, eventType or listener null or undefined");return}try{return this._initializeEventListenersContainer(n),this._eventListeners[n].push(t),t}catch(i){return this._logError("Could not add listener type '"+n+"', exception was thrown [{0}]",i),null}},removeEventListener:function(n,t){var r,i,u;if(this._isNullOrUndefined(n)||this._isNullOrUndefined(t)){this._logError("Could not remove listener, eventType or listener null or undefined.");return}if(this._eventArrayExists(n))try{for(r=this._eventListeners[n],i=0;i<r.length;i++)if(r[i]===t)return u=r.splice(i,1),u[0]}catch(f){return this._logError("Could not remove listener, exception was thrown [{0}]",f),null}else return this._logError("Could not remove listener, no listener found for eventType: "+n),null},broadcastEvent:function(n,t){var r,i;if(this._isNullOrUndefined(n)){this._logError("Could not broadcast event, eventType null or undefined");return}if(this._eventArrayExists(n))for(r=this._eventListeners[n],i=0;i<r.length;i++)this._isNullOrUndefined(r[i])||r[i](t);else return},dispose:function(n){var t,i;try{if(n===!0){this._dispose();return}t=!1;for(i in MicrosoftNSJS.Advertising.AdGlobalEventManager.EVENT_TYPE)if(this._eventArrayExists(MicrosoftNSJS.Advertising.AdGlobalEventManager.EVENT_TYPE[i])&&this._eventListeners[MicrosoftNSJS.Advertising.AdGlobalEventManager.EVENT_TYPE[i]].length>0){t=!0;break}t===!1?this._dispose():this._logError("Could not dispose, events collection is not empty.")}catch(r){try{this._logError("Could not dispose, exception thrown [{0}].",r)}catch(r){}}},_dispose:function(){this._eventListeners=null;this._isInitialized=!1;window._msAdsGlobalEventManager=null},_initializeEventListenersContainer:function(n){this._eventListeners===null?(this._eventListeners={},this._eventListeners[n]=[]):this._isNullOrUndefined(this._eventListeners[n])&&(this._eventListeners[n]=[])},_eventArrayExists:function(n){return this._eventListeners===null||this._eventListeners[n]===null||typeof this._eventListeners[n]=="undefined"?!1:!0},_isNullOrUndefined:function(n){return typeof n=="undefined"||n===null?!0:!1},_logError:function(){}},{OBJECT_NAME:"MicrosoftNSJS.Advertising.AdGlobalEventManager",EVENT_TYPE:{AD_ENGAGED:"msAdEngaged",AD_DISENGAGED:"msAdDisengaged"}});n.Namespace.define("MicrosoftNSJS.Advertising",{AdGlobalEventManager:t})})(WinJS);
// SIG // Begin signature block
// SIG // MIIakQYJKoZIhvcNAQcCoIIagjCCGn4CAQExCzAJBgUr
// SIG // DgMCGgUAMGcGCisGAQQBgjcCAQSgWTBXMDIGCisGAQQB
// SIG // gjcCAR4wJAIBAQQQEODJBs441BGiowAQS9NQkAIBAAIB
// SIG // AAIBAAIBAAIBADAhMAkGBSsOAwIaBQAEFItzjMulHHsc
// SIG // qIVMteT/VgVIvApzoIIVejCCBLswggOjoAMCAQICEzMA
// SIG // AABa7S/05CCZPzoAAAAAAFowDQYJKoZIhvcNAQEFBQAw
// SIG // dzELMAkGA1UEBhMCVVMxEzARBgNVBAgTCldhc2hpbmd0
// SIG // b24xEDAOBgNVBAcTB1JlZG1vbmQxHjAcBgNVBAoTFU1p
// SIG // Y3Jvc29mdCBDb3Jwb3JhdGlvbjEhMB8GA1UEAxMYTWlj
// SIG // cm9zb2Z0IFRpbWUtU3RhbXAgUENBMB4XDTE0MDUyMzE3
// SIG // MTMxNVoXDTE1MDgyMzE3MTMxNVowgasxCzAJBgNVBAYT
// SIG // AlVTMQswCQYDVQQIEwJXQTEQMA4GA1UEBxMHUmVkbW9u
// SIG // ZDEeMBwGA1UEChMVTWljcm9zb2Z0IENvcnBvcmF0aW9u
// SIG // MQ0wCwYDVQQLEwRNT1BSMScwJQYDVQQLEx5uQ2lwaGVy
// SIG // IERTRSBFU046QjhFQy0zMEE0LTcxNDQxJTAjBgNVBAMT
// SIG // HE1pY3Jvc29mdCBUaW1lLVN0YW1wIFNlcnZpY2UwggEi
// SIG // MA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQCzISLf
// SIG // atC/+ynJ1Wx6iamNE7yUtel9KWXaf/Qfqwx5YWZUYZYH
// SIG // 8NRgSzGbCa99KG3QpXuHX3ah0sYpx5Y6o18XjHbgt5YH
// SIG // D8diYbS2qvZGFCkDLiawHUoI4H3TXDASppv2uQ49UxZp
// SIG // nbtlJ0LB6DI1Dvcp/95bIEy7L2iEJA+rkcTzzipeWEbt
// SIG // qUW0abZUJpESYv1vDuTP+dw/2ilpH0qu7sCCQuuCc+lR
// SIG // UxG/3asdb7IKUHgLg+8bCLMbZ2/TBX2hCZ/Cd4igo1jB
// SIG // T/9n897sx/Uz3IpFDpZGFCiHHGC39apaQExwtWnARsjU
// SIG // 6OLFkN4LZTXUVIDS6Z0gVq/U3825AgMBAAGjggEJMIIB
// SIG // BTAdBgNVHQ4EFgQUvmfgLgIbrwpyDTodf4ydayJmEfcw
// SIG // HwYDVR0jBBgwFoAUIzT42VJGcArtQPt2+7MrsMM1sw8w
// SIG // VAYDVR0fBE0wSzBJoEegRYZDaHR0cDovL2NybC5taWNy
// SIG // b3NvZnQuY29tL3BraS9jcmwvcHJvZHVjdHMvTWljcm9z
// SIG // b2Z0VGltZVN0YW1wUENBLmNybDBYBggrBgEFBQcBAQRM
// SIG // MEowSAYIKwYBBQUHMAKGPGh0dHA6Ly93d3cubWljcm9z
// SIG // b2Z0LmNvbS9wa2kvY2VydHMvTWljcm9zb2Z0VGltZVN0
// SIG // YW1wUENBLmNydDATBgNVHSUEDDAKBggrBgEFBQcDCDAN
// SIG // BgkqhkiG9w0BAQUFAAOCAQEAIFOCkK6mTU5+M0nIs63E
// SIG // w34V0BLyDyeKf1u/PlTqQelUAysput1UiLu599nOU+0Q
// SIG // Fj3JRnC0ANHyNF2noyIsqiLha6G/Dw2H0B4CG+94tokg
// SIG // 0CyrC3Q4LqYQ/9qRqyxAPCYVqqzews9KkwPNa+Kkspka
// SIG // XUdE8dyCH+ZItKZpmcEu6Ycj6gjSaeZi33Hx6yO/IWX5
// SIG // pFfEky3bFngVqj6i5IX8F77ATxXbqvCouhErrPorNRZu
// SIG // W3P+MND7q5Og3s1C2jY/kffgN4zZB607J7v/VCB3xv0R
// SIG // 6RrmabIzJ6sFrliPpql/XRIRaAwsozEWDb4hq5zwrhp8
// SIG // QNXWgxYV2Cj75TCCBOwwggPUoAMCAQICEzMAAADKbNUy
// SIG // EjXE4VUAAQAAAMowDQYJKoZIhvcNAQEFBQAweTELMAkG
// SIG // A1UEBhMCVVMxEzARBgNVBAgTCldhc2hpbmd0b24xEDAO
// SIG // BgNVBAcTB1JlZG1vbmQxHjAcBgNVBAoTFU1pY3Jvc29m
// SIG // dCBDb3Jwb3JhdGlvbjEjMCEGA1UEAxMaTWljcm9zb2Z0
// SIG // IENvZGUgU2lnbmluZyBQQ0EwHhcNMTQwNDIyMTczOTAw
// SIG // WhcNMTUwNzIyMTczOTAwWjCBgzELMAkGA1UEBhMCVVMx
// SIG // EzARBgNVBAgTCldhc2hpbmd0b24xEDAOBgNVBAcTB1Jl
// SIG // ZG1vbmQxHjAcBgNVBAoTFU1pY3Jvc29mdCBDb3Jwb3Jh
// SIG // dGlvbjENMAsGA1UECxMETU9QUjEeMBwGA1UEAxMVTWlj
// SIG // cm9zb2Z0IENvcnBvcmF0aW9uMIIBIjANBgkqhkiG9w0B
// SIG // AQEFAAOCAQ8AMIIBCgKCAQEAlnFd7QZG+oTLnVu3Rsew
// SIG // 4bQROQOtsRVzYJzrp7ZuGjw//2XjNPGmpSFeVplsWOSS
// SIG // oQpcwtPcUi8MZZogYUBTMZxsjyF9uvn+E1BSYJU6W7lY
// SIG // pXRhQamU4K0mTkyhl3BJJ158Z8pPHnGERrwdS7biD8XG
// SIG // J8kH5noKpRcAGUxwRTgtgbRQqsVn0fp5vMXMoXKb9CU0
// SIG // mPhU3xI5OBIvpGulmn7HYtHcz+09NPi53zUwuux5Mqnh
// SIG // qaxVTUx/TFbDEwt28Qf5zEes+4jVUqUeKPo9Lc/PhJiG
// SIG // cWURz4XJCUSG4W/nsfysQESlqYsjP4JJndWWWVATWRhz
// SIG // /0MMrSvUfzBAZwIDAQABo4IBYDCCAVwwEwYDVR0lBAww
// SIG // CgYIKwYBBQUHAwMwHQYDVR0OBBYEFB9e4l1QjVaGvko8
// SIG // zwTop4e1y7+DMFEGA1UdEQRKMEikRjBEMQ0wCwYDVQQL
// SIG // EwRNT1BSMTMwMQYDVQQFEyozMTU5NStiNDIxOGYxMy02
// SIG // ZmNhLTQ5MGYtOWM0Ny0zZmM1NTdkZmM0NDAwHwYDVR0j
// SIG // BBgwFoAUyxHoytK0FlgByTcuMxYWuUyaCh8wVgYDVR0f
// SIG // BE8wTTBLoEmgR4ZFaHR0cDovL2NybC5taWNyb3NvZnQu
// SIG // Y29tL3BraS9jcmwvcHJvZHVjdHMvTWljQ29kU2lnUENB
// SIG // XzA4LTMxLTIwMTAuY3JsMFoGCCsGAQUFBwEBBE4wTDBK
// SIG // BggrBgEFBQcwAoY+aHR0cDovL3d3dy5taWNyb3NvZnQu
// SIG // Y29tL3BraS9jZXJ0cy9NaWNDb2RTaWdQQ0FfMDgtMzEt
// SIG // MjAxMC5jcnQwDQYJKoZIhvcNAQEFBQADggEBAHdc69eR
// SIG // Pc29e4PZhamwQ51zfBfJD+0228e1LBte+1QFOoNxQIEJ
// SIG // ordxJl7WfbZsO8mqX10DGCodJ34H6cVlH7XPDbdUxyg4
// SIG // Wojne8EZtlYyuuLMy5Pbr24PXUT11LDvG9VOwa8O7yCb
// SIG // 8uH+J13oxf9h9hnSKAoind/NcIKeGHLYI8x6LEPu/+rA
// SIG // 4OYdqp6XMwBSbwe404hs3qQGNafCU4ZlEXcJjzVZudiG
// SIG // qAD++DF9LPSMBZ3AwdV3cmzpTVkmg/HCsohXkzUAfFAr
// SIG // vFn8/hwpOILT3lKXRSkYTpZbnbpfG6PxJ1DqB5XobTQN
// SIG // OFfcNyg1lTo4nNTtaoVdDiIRXnswggW8MIIDpKADAgEC
// SIG // AgphMyYaAAAAAAAxMA0GCSqGSIb3DQEBBQUAMF8xEzAR
// SIG // BgoJkiaJk/IsZAEZFgNjb20xGTAXBgoJkiaJk/IsZAEZ
// SIG // FgltaWNyb3NvZnQxLTArBgNVBAMTJE1pY3Jvc29mdCBS
// SIG // b290IENlcnRpZmljYXRlIEF1dGhvcml0eTAeFw0xMDA4
// SIG // MzEyMjE5MzJaFw0yMDA4MzEyMjI5MzJaMHkxCzAJBgNV
// SIG // BAYTAlVTMRMwEQYDVQQIEwpXYXNoaW5ndG9uMRAwDgYD
// SIG // VQQHEwdSZWRtb25kMR4wHAYDVQQKExVNaWNyb3NvZnQg
// SIG // Q29ycG9yYXRpb24xIzAhBgNVBAMTGk1pY3Jvc29mdCBD
// SIG // b2RlIFNpZ25pbmcgUENBMIIBIjANBgkqhkiG9w0BAQEF
// SIG // AAOCAQ8AMIIBCgKCAQEAsnJZXBkwZL8dmmAgIEKZdlNs
// SIG // PhvWb8zL8epr/pcWEODfOnSDGrcvoDLs/97CQk4j1XIA
// SIG // 2zVXConKriBJ9PBorE1LjaW9eUtxm0cH2v0l3511iM+q
// SIG // c0R/14Hb873yNqTJXEXcr6094CholxqnpXJzVvEXlOT9
// SIG // NZRyoNZ2Xx53RYOFOBbQc1sFumdSjaWyaS/aGQv+knQp
// SIG // 4nYvVN0UMFn40o1i/cvJX0YxULknE+RAMM9yKRAoIsc3
// SIG // Tj2gMj2QzaE4BoVcTlaCKCoFMrdL109j59ItYvFFPees
// SIG // CAD2RqGe0VuMJlPoeqpK8kbPNzw4nrR3XKUXno3LEY9W
// SIG // PMGsCV8D0wIDAQABo4IBXjCCAVowDwYDVR0TAQH/BAUw
// SIG // AwEB/zAdBgNVHQ4EFgQUyxHoytK0FlgByTcuMxYWuUya
// SIG // Ch8wCwYDVR0PBAQDAgGGMBIGCSsGAQQBgjcVAQQFAgMB
// SIG // AAEwIwYJKwYBBAGCNxUCBBYEFP3RMU7TJoqV4ZhgO6gx
// SIG // b6Y8vNgtMBkGCSsGAQQBgjcUAgQMHgoAUwB1AGIAQwBB
// SIG // MB8GA1UdIwQYMBaAFA6sgmBAVieX5SUT/CrhClOVWeSk
// SIG // MFAGA1UdHwRJMEcwRaBDoEGGP2h0dHA6Ly9jcmwubWlj
// SIG // cm9zb2Z0LmNvbS9wa2kvY3JsL3Byb2R1Y3RzL21pY3Jv
// SIG // c29mdHJvb3RjZXJ0LmNybDBUBggrBgEFBQcBAQRIMEYw
// SIG // RAYIKwYBBQUHMAKGOGh0dHA6Ly93d3cubWljcm9zb2Z0
// SIG // LmNvbS9wa2kvY2VydHMvTWljcm9zb2Z0Um9vdENlcnQu
// SIG // Y3J0MA0GCSqGSIb3DQEBBQUAA4ICAQBZOT5/Jkav629A
// SIG // sTK1ausOL26oSffrX3XtTDst10OtC/7L6S0xoyPMfFCY
// SIG // gCFdrD0vTLqiqFac43C7uLT4ebVJcvc+6kF/yuEMF2nL
// SIG // pZwgLfoLUMRWzS3jStK8cOeoDaIDpVbguIpLV/KVQpzx
// SIG // 8+/u44YfNDy4VprwUyOFKqSCHJPilAcd8uJO+IyhyugT
// SIG // pZFOyBvSj3KVKnFtmxr4HPBT1mfMIv9cHc2ijL0nsnlj
// SIG // VkSiUc356aNYVt2bAkVEL1/02q7UgjJu/KSVE+Traeep
// SIG // oiy+yCsQDmWOmdv1ovoSJgllOJTxeh9Ku9HhVujQeJYY
// SIG // XMk1Fl/dkx1Jji2+rTREHO4QFRoAXd01WyHOmMcJ7oUO
// SIG // jE9tDhNOPXwpSJxy0fNsysHscKNXkld9lI2gG0gDWvfP
// SIG // o2cKdKU27S0vF8jmcjcS9G+xPGeC+VKyjTMWZR4Oit0Q
// SIG // 3mT0b85G1NMX6XnEBLTT+yzfH4qerAr7EydAreT54al/
// SIG // RrsHYEdlYEBOsELsTu2zdnnYCjQJbRyAMR/iDlTd5aH7
// SIG // 5UcQrWSY/1AWLny/BSF64pVBJ2nDk4+VyY3YmyGuDVyc
// SIG // 8KKuhmiDDGotu3ZrAB2WrfIWe/YWgyS5iM9qqEcxL5rc
// SIG // 43E91wB+YkfRzojJuBj6DnKNwaM9rwJAav9pm5biEKgQ
// SIG // tDdQCNbDPTCCBgcwggPvoAMCAQICCmEWaDQAAAAAABww
// SIG // DQYJKoZIhvcNAQEFBQAwXzETMBEGCgmSJomT8ixkARkW
// SIG // A2NvbTEZMBcGCgmSJomT8ixkARkWCW1pY3Jvc29mdDEt
// SIG // MCsGA1UEAxMkTWljcm9zb2Z0IFJvb3QgQ2VydGlmaWNh
// SIG // dGUgQXV0aG9yaXR5MB4XDTA3MDQwMzEyNTMwOVoXDTIx
// SIG // MDQwMzEzMDMwOVowdzELMAkGA1UEBhMCVVMxEzARBgNV
// SIG // BAgTCldhc2hpbmd0b24xEDAOBgNVBAcTB1JlZG1vbmQx
// SIG // HjAcBgNVBAoTFU1pY3Jvc29mdCBDb3Jwb3JhdGlvbjEh
// SIG // MB8GA1UEAxMYTWljcm9zb2Z0IFRpbWUtU3RhbXAgUENB
// SIG // MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA
// SIG // n6Fssd/bSJIqfGsuGeG94uPFmVEjUK3O3RhOJA/u0afR
// SIG // TK10MCAR6wfVVJUVSZQbQpKumFwwJtoAa+h7veyJBw/3
// SIG // DgSY8InMH8szJIed8vRnHCz8e+eIHernTqOhwSNTyo36
// SIG // Rc8J0F6v0LBCBKL5pmyTZ9co3EZTsIbQ5ShGLieshk9V
// SIG // UgzkAyz7apCQMG6H81kwnfp+1pez6CGXfvjSE/MIt1Nt
// SIG // UrRFkJ9IAEpHZhEnKWaol+TTBoFKovmEpxFHFAmCn4Tt
// SIG // VXj+AZodUAiFABAwRu233iNGu8QtVJ+vHnhBMXfMm987
// SIG // g5OhYQK1HQ2x/PebsgHOIktU//kFw8IgCwIDAQABo4IB
// SIG // qzCCAacwDwYDVR0TAQH/BAUwAwEB/zAdBgNVHQ4EFgQU
// SIG // IzT42VJGcArtQPt2+7MrsMM1sw8wCwYDVR0PBAQDAgGG
// SIG // MBAGCSsGAQQBgjcVAQQDAgEAMIGYBgNVHSMEgZAwgY2A
// SIG // FA6sgmBAVieX5SUT/CrhClOVWeSkoWOkYTBfMRMwEQYK
// SIG // CZImiZPyLGQBGRYDY29tMRkwFwYKCZImiZPyLGQBGRYJ
// SIG // bWljcm9zb2Z0MS0wKwYDVQQDEyRNaWNyb3NvZnQgUm9v
// SIG // dCBDZXJ0aWZpY2F0ZSBBdXRob3JpdHmCEHmtFqFKoKWt
// SIG // THNY9AcTLmUwUAYDVR0fBEkwRzBFoEOgQYY/aHR0cDov
// SIG // L2NybC5taWNyb3NvZnQuY29tL3BraS9jcmwvcHJvZHVj
// SIG // dHMvbWljcm9zb2Z0cm9vdGNlcnQuY3JsMFQGCCsGAQUF
// SIG // BwEBBEgwRjBEBggrBgEFBQcwAoY4aHR0cDovL3d3dy5t
// SIG // aWNyb3NvZnQuY29tL3BraS9jZXJ0cy9NaWNyb3NvZnRS
// SIG // b290Q2VydC5jcnQwEwYDVR0lBAwwCgYIKwYBBQUHAwgw
// SIG // DQYJKoZIhvcNAQEFBQADggIBABCXisNcA0Q23em0rXfb
// SIG // znlRTQGxLnRxW20ME6vOvnuPuC7UEqKMbWK4VwLLTiAT
// SIG // UJndekDiV7uvWJoc4R0Bhqy7ePKL0Ow7Ae7ivo8KBciN
// SIG // SOLwUxXdT6uS5OeNatWAweaU8gYvhQPpkSokInD79vzk
// SIG // eJkuDfcH4nC8GE6djmsKcpW4oTmcZy3FUQ7qYlw/FpiL
// SIG // ID/iBxoy+cwxSnYxPStyC8jqcD3/hQoT38IKYY7w17gX
// SIG // 606Lf8U1K16jv+u8fQtCe9RTciHuMMq7eGVcWwEXChQO
// SIG // 0toUmPU8uWZYsy0v5/mFhsxRVuidcJRsrDlM1PZ5v6oY
// SIG // emIp76KbKTQGdxpiyT0ebR+C8AvHLLvPQ7Pl+ex9teOk
// SIG // qHQ1uE7FcSMSJnYLPFKMcVpGQxS8s7OwTWfIn0L/gHkh
// SIG // gJ4VMGboQhJeGsieIiHQQ+kr6bv0SMws1NgygEwmKkgk
// SIG // X1rqVu+m3pmdyjpvvYEndAYR7nYhv5uCwSdUtrFqPYmh
// SIG // dmG0bqETpr+qR/ASb/2KMmyy/t9RyIwjyWa9nR2HEmQC
// SIG // PS2vWY+45CHltbDKY7R4VAXUQS5QrJSwpXirs6CWdRrZ
// SIG // kocTdSIvMqgIbqBbjCW/oO+EyiHW6x5PyZruSeD3AWVv
// SIG // iQt9yGnI5m7qp5fOMSn/DsVbXNhNG6HY+i+ePy5VFmvJ
// SIG // E6P9MYIEgzCCBH8CAQEwgZAweTELMAkGA1UEBhMCVVMx
// SIG // EzARBgNVBAgTCldhc2hpbmd0b24xEDAOBgNVBAcTB1Jl
// SIG // ZG1vbmQxHjAcBgNVBAoTFU1pY3Jvc29mdCBDb3Jwb3Jh
// SIG // dGlvbjEjMCEGA1UEAxMaTWljcm9zb2Z0IENvZGUgU2ln
// SIG // bmluZyBQQ0ECEzMAAADKbNUyEjXE4VUAAQAAAMowCQYF
// SIG // Kw4DAhoFAKCBnDAZBgkqhkiG9w0BCQMxDAYKKwYBBAGC
// SIG // NwIBBDAcBgorBgEEAYI3AgELMQ4wDAYKKwYBBAGCNwIB
// SIG // FTAjBgkqhkiG9w0BCQQxFgQUPiBh9D3REC2kev+ySu7b
// SIG // h03tki8wPAYKKwYBBAGCNwIBDDEuMCygDIAKAGEAZAAu
// SIG // AGoAc6EcgBpodHRwOi8vd3d3Lm1pY3Jvc29mdC5jb20v
// SIG // IDANBgkqhkiG9w0BAQEFAASCAQANJbH6eXUKpmWErF6o
// SIG // rWwbYfH+YChGL2ylW7zBL+RShJ7tn3FMsL/hE647Tyns
// SIG // OVC1kBno6qcWXEzOjj2PQ7Gi7RI0e2XCBOcuwyZmQ2hU
// SIG // QjSsfF2eLxZxJ6B/GNjnxWENTbyMgq0v1/OrH441tQpa
// SIG // xxLsMFoZUjK3NMC6sCO1EjR+jRByN6ribtNlyBbstvsg
// SIG // 3BJR+qW94SUzo4YQZYg0agIK062eYmocCoaCDq1Eynbk
// SIG // 3YIAQbD8cr+2fgQOQl2PMbd4sNl6/GVRoE8jp9SvaP/Z
// SIG // P3QMTnybpxQFbsc3soxe/sEPtP3ugT4iNhxyfSqY8UQY
// SIG // 9mV88ZS8tdh3zZqcoYICKDCCAiQGCSqGSIb3DQEJBjGC
// SIG // AhUwggIRAgEBMIGOMHcxCzAJBgNVBAYTAlVTMRMwEQYD
// SIG // VQQIEwpXYXNoaW5ndG9uMRAwDgYDVQQHEwdSZWRtb25k
// SIG // MR4wHAYDVQQKExVNaWNyb3NvZnQgQ29ycG9yYXRpb24x
// SIG // ITAfBgNVBAMTGE1pY3Jvc29mdCBUaW1lLVN0YW1wIFBD
// SIG // QQITMwAAAFrtL/TkIJk/OgAAAAAAWjAJBgUrDgMCGgUA
// SIG // oF0wGAYJKoZIhvcNAQkDMQsGCSqGSIb3DQEHATAcBgkq
// SIG // hkiG9w0BCQUxDxcNMTUwNDAzMTkzNzMwWjAjBgkqhkiG
// SIG // 9w0BCQQxFgQUamZ2g0ZDhxaczav5J16wI+ZW8d8wDQYJ
// SIG // KoZIhvcNAQEFBQAEggEAdWBjf8JOwzl5EPglalxJd3yo
// SIG // WxK+UxDQsdWKke8o3ELmtAJszvX0Ed0ZPBWSuCbRsmR7
// SIG // VmhjCpLowKpRWyvMNetKKCTXA8kGoFTk51o3ldEXhNbV
// SIG // YTkPNg/2kQa/afUgGL6AH5+oSbi+NZkLw5cjnSuxhS12
// SIG // /Op7ZTpwUNTQuheGFLHOtgj4/2znz18ZkYJJqNxWcV9T
// SIG // HoqGfk+eoJPGKXtntTHOOpIFCRhrJkuB50KFMdVX3vkB
// SIG // 7V7p4IPw0v3EYGn2H582klPfhqWnmmViJ2fI9rlo7s3u
// SIG // 0Ya3jPhWBUbGI83fqT7Gd9nMKJFS7c6mhWcexBUpCkjX
// SIG // D2jqNfY5cw==
// SIG // End signature block
