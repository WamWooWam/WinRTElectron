Jx.delayDefine(Chat,"AuthMessageBarPresenter",function(){var i=2,t={msgBar:{accountUpdateRequired:-2138701819,accountLocked:-2138701817},credUI:{passwordUpdateRequired:-2138701820,forceSignIn:-2138701818,parentalConsentRequired:-2138701816,emailVerificationRequired:-2138701815,actionRequired:-2138701812,accountSuspendedCompromise:-2138701814,accountSuspendedAbuse:-2138701813,authRequestThrottled:-2138701808,passwordDoesNotExist:-2146893042,passwordLogonFailure:-2147023570},proxyCanary:{e_HTTP_PROXY_AUTH_REQ:-2063532024},ignored:{success:0,defaultAccountDoesNotExist:-2147023579}},n;Chat.AuthMessageBarPresenter=function(){};n=Chat.AuthMessageBarPresenter.prototype;n._mb=null;n._account=null;n._platform=null;n._className=null;n._isMail=false;n._authErrorMsgId="authErrorMessage";n.init=function(n,t,i,r){this._mb=n;this._account=t.accountManager.defaultAccount;this._platform=t;this._className=i;this._isMail=Boolean(r);this._accountChanged=this._accountChanged.bind(this);this._account.addEventListener("changed",this._accountChanged);this._checkErrorState(this._account.lastAuthResult)};n.shutdown=function(){this._account&&this._account.removeEventListener("changed",this._accountChanged)};n._accountChanged=function(n){var t=n.target;this._checkErrorState(t.lastAuthResult)};n._hasOwnValue=function(n,t){for(var i in n)if(n[i]===t)return true;return false};n._checkErrorState=function(n){var i=null,r;this._hasOwnValue(t.msgBar,n)?(i={messageText:Jx.res.loadCompoundString("/messagebar/messageBarIDCRLError",this._account.emailAddress),button1:{text:Jx.res.getString("/messagebar/messageBarUpdate"),tooltip:Jx.res.getString("/messagebar/messageBarUpdate"),callback:this._fixClicked.bind(this)},button2:{text:Jx.res.getString("/messagebar/messageBarCloseText"),tooltip:Jx.res.getString("/messagebar/messageBarCloseText"),callback:this._closeClicked.bind(this)},cssClass:this._className},this._mb.removeMessage(this._authErrorMsgId),r=2,this._mb.addErrorMessage(this._authErrorMsgId,r,i)):this._hasOwnValue(t.credUI,n)?this._isMail&&n===t.credUI.emailVerificationRequired||this._launchCredUI():this._hasOwnValue(t.ignored,n)?this._mb.removeMessage(this._authErrorMsgId):this._hasOwnValue(t.proxyCanary,n)||this._launchCredUI()};n._closeClicked=function(n,t){this._mb.removeMessage(t)};n._fixClicked=function(n,t){this._mb.removeMessage(t);this._launchCredUI()};n._launchCredUI=function(){var n=new Windows.Security.Authentication.OnlineId.OnlineIdAuthenticator,t=new Windows.Security.Authentication.OnlineId.OnlineIdServiceTicketRequest("ssl.live.com","MBI_SSL"),i=Windows.Security.Authentication.OnlineId.CredentialPromptType.promptIfNeeded;try{n.authenticateUserAsync([t],i).then(this._onCredUiSuccess.bind(this),this._onCredUiFailure.bind(this))}catch(r){Jx.log.exception("Exception from authenticateUserAsync",r)}};n._onCredUiSuccess=function(){this._account.lastAuthResult=0;var n=this._account.getResourceByType(i);Jx.isObject(n)&&(n.isSyncNeeded=true);this._account.commit()};n._onCredUiFailure=function(n){n&&Jx.log.info("authenticateUserAsync failed with "+n.number)}})