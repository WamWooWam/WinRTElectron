window.Chat=window.Chat||{};Chat.Shared=Chat.Shared||{};Jx.delayDefine(Chat,"MessageBar",function(){function r(n){Jx.mark("MessageBar."+n)}function t(n){Jx.mark("MessageBar."+n+",StartTA,Shared")}function i(n){Jx.mark("MessageBar."+n+",StopTA,Shared")}var u=Chat.MessageBar=function(n,r){t("constructor");this._zOrder=Jx.isNullOrUndefined(n)?2:n;Jx.isNullOrUndefined(r)||(this._parentElement=r);i("constructor")},n;u.Priority={superLow:0,low:1,medium:2,high:3};n=u.prototype;n._zOrder=0;n._queue=[];n._disabledIds={};n._currentMessage=null;n._inDOM=false;n._isHiddenGlobally=false;n._parentElement=null;n._isAnimating=false;n.addErrorMessage=function(n,u,f){t("addErrorMessage");r("Adding error message id: "+n+" priority: "+u);var e={id:n,priority:u,options:f,isError:true,canDuplicate:false,showFunc:this._showCurrentErrorMessage.bind(this),hideFunc:this._hideCurrentErrorMessage.bind(this)};this._addItem(e);i("addErrorMessage")};n.addStatusMessage=function(n,u,f){t("addStatusMessage");r("Adding status message id: "+n+" priority: "+u);var e={id:n,priority:u,options:f,isError:false,canDuplicate:true,showFunc:this._showCurrentStatusMessage.bind(this),hideFunc:this._hideCurrentStatusMessage.bind(this)};this._addItem(e);i("addStatusMessage")};n._hideCurrentMessageIfRemoved=function(n){Boolean(this._currentMessage)&&this._currentMessage!==this._getMessageToShow()&&this._hideCurrentMessage(n)};n.removeMessage=function(n){t("removeMessage");r("Removing message id: "+n);this._removeItem(n);this._hideCurrentMessageIfRemoved(false);i("removeMessage")};n.removeMessages=function(n,t){n.forEach(function(n){this._removeItem(n)},this);this._hideCurrentMessageIfRemoved(t)};n.disableMessage=function(n){this._disabledIds[n]=true;for(var t=0;t<this._queue.length;t++)this._queue[t].id===n&&(this._queue[t].isDisabled=true);Boolean(this._currentMessage)&&this._currentMessage.id===n&&this._hideCurrentMessage()};n.unDisableMessage=function(n){var i=this._getMessageToShow(),t,r;for(this._disabledIds[n]=false,t=0;t<this._queue.length;t++)this._queue[t].id===n&&(this._queue[t].isDisabled=false);r=this._getMessageToShow();i?Boolean(i)&&Boolean(r)&&i.id!==r.id&&this._hideCurrentMessage():this._showCurrentMessage(true)};n._getMessageToShow=function(){for(var t=null,n=0;n<this._queue.length;n++)if(!this._queue[n].isDisabled){t=this._queue[n];break}return t};n.clearAllMessages=function(){t("clearAllMessages");this._queue=[];this._hideCurrentMessage();i("clearAllMessages")};n.hide=function(){t("hide");this._isHiddenGlobally||(this._isHiddenGlobally=true,this._hideCurrentMessage());i("hide")};n.unhide=function(){t("unhide");this._isHiddenGlobally&&(this._isHiddenGlobally=false,this._showCurrentMessage(true));i("unhide")};n.getTextButton=function(){return this._elError.querySelector(".mb-textButton")};n.getButton1=function(){return this._elError.querySelector(".mb-button1")};n.getButton2=function(){return this._elError.querySelector(".mb-button2")};n._addItem=function(n){var r,t,i;for(this._disabledIds[n.id]&&(n.isDisabled=true),r=false,t=0;t<this._queue.length;t++)if(this._queue[t].id===n.id){r=true;break}this._inDOM||this._addToDOM();!n.canDuplicate&&(n.canDuplicate||r)||(r?this._queue[t]=n:this._queue.push(n),this._queue.sort(this._sortMessages),this._currentMessage?(i=this._getMessageToShow(),Boolean(this._currentMessage)&&Boolean(i)&&this._currentMessage.id!==i.id?this._hideCurrentMessage():Boolean(i)&&i.canDuplicate&&this._showCurrentMessage(false)):this._showCurrentMessage(true));this._queue.length>15&&Jx.log.warning("MessageBar performance may be impacted negatively for large sets of messages")};n._removeItem=function(n){var t,i,r;for(t=0,i=false,r=this._queue.length;t<r;t++)if(this._queue[t].id===n){i=true;break}i&&this._queue.splice(t,1)};n._showCurrentMessage=function(n){var t=this._getMessageToShow();Boolean(t)&&!this._isAnimating&&t.showFunc(n)};n._hideCurrentMessage=function(n){Boolean(this._currentMessage)&&!this._isAnimating&&this._currentMessage.hideFunc(Boolean(n))};n._sortMessages=function(n,t){return t.isError&&!n.isError?1:!t.isError&&n.isError?-1:t.priority-n.priority};n._showCurrentErrorMessage=function(){var i=this._getMessageToShow(),n,r,t,u,f;Boolean(i)&&!this._isHiddenGlobally&&(this._currentMessage=i,Jx.removeClass(this._elError,"mbhidden"),n=this._elError.querySelector(".mb-message"),this._currentMessage.options.messageHTML?(n.innerHTML=toStaticHTML(this._currentMessage.options.messageHTML),n.title=this._currentMessage.options.messageText?this._currentMessage.options.messageText:n.innerText):(n.innerText=this._currentMessage.options.messageText,n.title=this._currentMessage.options.messageText),r=this.getTextButton(),t=this._currentMessage.options.textButton,this._setButtonValues(r,t,true),Jx.isNullOrUndefined(t)?Jx.addClass(this._elError,"messagebar-errorExtended"):Jx.removeClass(this._elError,"messagebar-errorExtended"),u=this.getButton1(),this._setButtonValues(u,this._currentMessage.options.button1,false),f=this.getButton2(),this._setButtonValues(f,this._currentMessage.options.button2,false),this._currentMessage.options.cssClass&&Jx.addClass(this._elError,this._currentMessage.options.cssClass),this._slideInErrorMessage())};n._setButtonValues=function(n,t,i){t?(Jx.removeClass(n,"mbhidden"),n.innerText=t.text,i&&(n.title=t.tooltip),n.onclick=this._onButtonClick.bind(this),n.onkeydown=this._onKeyDown.bind(this)):Jx.addClass(n,"mbhidden")};n._slideInErrorMessage=function(){var n=this._elError.offsetHeight;this._isAnimating=true;WinJS.UI.Animation.showEdgeUI(this._elError,{top:"-"+n.toString()+"0px",left:"0px"}).done(this._onShowAnimationComplete.bind(this))};n._slideOutErrorMessage=function(n){var t,i;this._isAnimating=true;t=function(){Jx.addClass(this._elError,"mbhidden");this._currentMessage&&this._currentMessage.options.cssClass&&Jx.removeClass(this._elError,this._currentMessage.options.cssClass);this._isAnimating=false;this._currentMessage=null;this._showCurrentMessage(true)}.bind(this);n?t():(i=this._elError.offsetHeight,WinJS.UI.Animation.hideEdgeUI(this._elError,{top:"-"+i.toString()+"px",left:"0px"}).done(t))};n._onShowAnimationComplete=function(){this._isAnimating=false;var n=this._getMessageToShow();Boolean(n)&&this._currentMessage.id===n.id||this._hideCurrentMessage();r("animation complete")};n._hideCurrentErrorMessage=function(n){this._currentMessage&&this._slideOutErrorMessage(n)};n._showCurrentStatusMessage=function(n){var t=this._getMessageToShow();Boolean(t)&&!this._isHiddenGlobally&&(this._currentMessage=t,Jx.removeClass(this._elStatus,"mbhidden"),this._elStatusText.innerText=this._currentMessage.options.messageText,this._elStatusText.title=this._currentMessage.options.tooltip?this._currentMessage.options.tooltip:"",this._currentMessage.options.showIndeterminateBar?(this._elProgress.removeAttribute("value"),this._elProgress.style.visibility="visible"):(this._elProgress.style.visibility="hidden",this._elProgress.value=1),this._currentMessage.options.callback?(this._elStatus.onclick=this._onButtonClick.bind(this),Jx.addClass(this._elStatus,"mb-link")):(this._elStatus.onclick=null,Jx.removeClass(this._elStatus,"mb-link")),this._currentMessage.options.cssClass&&(this._el.className=this._currentMessage.options.cssClass),n&&this._animateStatusMessage(true))};n._animateStatusMessage=function(n){this._isAnimating=true;n?WinJS.UI.Animation.fadeIn(this._elStatus).then(this._onShowAnimationComplete.bind(this)):WinJS.UI.Animation.fadeOut(this._elStatus).then(function(){Jx.addClass(this._elStatus,"mbhidden");this._elProgress.style.visibility="hidden";this._elProgress.value=1;this._currentMessage&&this._currentMessage.options.cssClass&&Jx.removeClass(this._el,this._currentMessage.options.cssClass);this._isAnimating=false;this._currentMessage=null;this._showCurrentMessage(true)}.bind(this))};n._hideCurrentStatusMessage=function(){this._currentMessage&&this._animateStatusMessage(false)};n._onButtonClick=function(n){this._currentMessage&&(Jx.hasClass(n.target,"mb-textButton")?(this._currentMessage.options.textButton.callback(n.target,this._currentMessage.id),n.preventDefault()):Jx.hasClass(n.target,"mb-button1")?this._currentMessage.options.button1.callback(n.target,this._currentMessage.id):Jx.hasClass(n.target,"mb-button2")?this._currentMessage.options.button2.callback(n.target,this._currentMessage.id):Jx.hasClass(n.target,"messagebar-status")&&this._currentMessage.options.callback(n.target,this._currentMessage.id))};n._onKeyDown=function(n){n.keyCode===Jx.KeyCode.space&&Jx.hasClass(n.target,"mb-textButton")&&this._onButtonClick(n)};n._addToDOM=function(){var n=document.createElement("div"),t=this._zOrder.toString(),i;n.innerHTML=Jx.Templates.MessageBar.messageBar();this._elError=n.querySelector(".messagebar-error");this._elError.style.zIndex=t;Jx.addClass(this._elError,"mbhidden");this._elStatus=n.querySelector(".messagebar-status");this._elStatus.style.zIndex=t;Jx.addClass(this._elStatus,"mbhidden");this._elStatusText=this._elStatus.querySelector(".messagebar-status-text");this._elProgress=n.querySelector(".mb-progress");i=Jx.isNullOrUndefined(this._parentElement)?document.body:this._parentElement;i.appendChild(n);this._el=n;this._inDOM=true}})