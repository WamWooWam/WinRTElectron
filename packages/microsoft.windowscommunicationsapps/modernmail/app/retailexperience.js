Jx.delayDefine(Mail,"startRetailExperience",function(){"use strict";function n(){Windows.Storage.ApplicationData.current.localFolder.getFileAsync("RetailExperienceResult.log").then(function(n){return n.deleteAsync()},function(){}).done(MSApp.terminateApp)}function t(){Windows.Storage.ApplicationData.current.localFolder.createFileAsync("RetailExperienceResult.log",Windows.Storage.CreationCollisionOption.replaceExisting).then(function(n){return n.openAsync(Windows.Storage.FileAccessMode.readWrite)}).then(function(n){return n.getOutputStreamAt(0)}).then(function(n){var t=new Windows.Storage.Streams.DataWriter(n);return t.unicodeEncoding=Windows.Storage.Streams.UnicodeEncoding.utf8,t.writeString(Jx.res.getString("mailRetailExperienceFailureMessage")),t.storeAsync()}).done(MSApp.terminateApp)}function i(){var n=Windows.UI.Notifications,t=Windows.Data.Xml.Dom;return Windows.Storage.ApplicationData.current.localFolder.getFileAsync("RetailExperience\\Livecomm_Input.xml").then(function(n){return t.XmlDocument.loadFromFileAsync(n)}).then(function(i){i.selectNodes("/RetailExperience/TileData/Apps/App").forEach(function(i){var r=n.TileUpdateManager.createTileUpdaterForApplication(i.getAttribute("id"));r.enableNotificationQueue(true);i.selectNodes("Tiles/tile").forEach(function(i){var u=new t.XmlDocument;u.loadXml(i.getXml());r.update(new n.TileNotification(u))})})})}Mail.startRetailExperience=function(r){return WinJS.Promise.timeout().then(function(){var u=Mail.Globals.splashScreen;u&&u.dismiss();var n=new Microsoft.WindowsLive.Platform.Client("retailapp",Microsoft.WindowsLive.Platform.ClientCreateOptions.createRetailExperienceUser),r=n.accountManager.defaultAccount,t=n.createVerb("ImportRetailExperienceData","");return n.runResourceVerb(r,"retail",t),t=n.createVerb("ProcessUpdates",""),n.runResourceVerb(r,"peopleAggregator",t),n.runResourceVerb(r,"calendar",t),t=n.createVerb("ProcessUpdates",r.objectId),n.runResourceVerb(r,"mailNotification",t),i().then(function(){if(!Jx.isNullOrUndefined(People.Social.populateDemoDataAsync))return People.Social.populateDemoDataAsync("ms-appdata:///local/RetailExperience/Social_input.xml",n)}).then(function(){n&&n.dispose()})}).then(n,t).then(function(){return r})}})