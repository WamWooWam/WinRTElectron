Jx.delayDefine(Mail,"AppState",function(){"use strict";function f(n){Jx.mark("AppState."+n)}function i(n){Jx.mark("AppState."+n+",StartTA,AppState")}function t(n){Jx.mark("AppState."+n+",StopTA,AppState")}var r=Windows.ApplicationModel.Activation,u=Mail.AppState=function(n,u,f,e){var s,h,c,o;i("ctor");this._platform=n;this._selectedAccount=null;this._selectedMessages=[];this._lastSelectedMessage=null;this._lastActivationType=u.kind;s=this._settings=e.container("AppState");this._restartCheck=new Mail.RestartCheck;h=u.previousExecutionState;c=r.ApplicationExecutionState;(h===c.notRunning||h===c.closedByUser)&&s.remove("selection");o=this._deserialize(u.arguments);o||(o=this._deserialize(s.get("selection")),o||(o={account:f},o.view=o.account.inboxView),this._checkForInactivity()&&(o.view=o.account.inboxView,o.message=null,o.messageIndex=-1));this._startup=o;this.setSelectedView(o.view);this.setSelectedMessages(o.message||null,o.messageIndex,[]);this._hook=new Mail.EventHook(Jx.activation,"activated",this._onActivation,this);t("ctor")},n=u.prototype;Jx.augment(u,Jx.Events);n._onActivation=function(n){if(i("_onActivation"),this._lastActivationType=n.kind,n.kind===r.ActivationKind.protocol)Mail.Utilities.ComposeHelper.onProtocol(n);else{var u=this._deserialize(n.arguments);u?this.raiseEvent("updateSelection",u):this._checkForInactivity()}t("_onActivation")};n._deserialize=function(n){i("_deserialize");try{var u,f,e,o=-1,s=this._platform,r=Mail.Activation.parseArguments(s,n);if(r&&(u=Mail.Account.load(r.accountId,s),u&&u.isMailEnabled&&(f=u.loadView(r.viewId),f))){if(r.messageId){try{e=u.loadMessage(r.messageId)}catch(h){}e&&Jx.isNumber(r.messageIndex)&&(o=r.messageIndex)}return t("_deserialize"),{account:u,view:f,message:e,messageIndex:o}}}catch(h){Jx.log.exception("Failed to deserialize selection",h)}return t("_deserialize"),null};n.getStartupAccount=function(){return this._startup.account};n.getStartupView=function(){return this._startup.view};n.addRestartCheck=function(n,t,i){this._restartCheck.addRestartCheck(n,t,i)};n.onAppVisible=function(){this._restartCheck.onAppVisible();this._checkForInactivity()};n.setAppInvisible=function(){this._settings.set("inactiveTimestamp",String(Date.now()))};n.setSelectedMessages=function(n,r,u){i("setSelectedMessages");this._lastSelectedMessage=n;this._lastSelectedMessageId=n?n.objectId:"";this._lastSelectedMessageIndex=r;this._selectedMessages=u;f("setSelectedMessages-save");var e=Mail.Activation.stringifyArguments(this._selectedView,this._lastSelectedMessage);this._settings.set("selection",e);t("setSelectedMessages")};n.setSelectedView=function(n){i("setSelectedView");var r=n.folder;r&&r.ensureSyncEnabled();this._selectedAccount=n.account;this._selectedView=n;t("setSelectedView")};n._checkForInactivity=function(){i("_checkForInactivity");var n=this._settings.get("inactiveTimestamp");return Jx.isNonEmptyString(n)?(this._settings.remove("inactiveTimestamp"),Mail.Utilities.ComposeHelper.isComposeShowing)?(t("_checkForInactivity"),false):Date.now()-Number(n)>Mail.Utilities.msInOneHour?(this._settings.remove("settings"),this.raiseEvent("updateSelection",{account:this._selectedAccount}),t("_checkForInactivity"),true):(t("_checkForInactivity"),false):(t("_checkForInactivity"),false)};Object.defineProperty(n,"lastSelectedMessageId",{get:function(){return this._lastSelectedMessageId}});Object.defineProperty(n,"lastSelectedMessageIndex",{get:function(){return this._lastSelectedMessageIndex}});Object.defineProperty(n,"lastActivationType",{get:function(){return this._lastActivationType}});Object.defineProperty(n,"selectedAccount",{get:function(){return this._selectedAccount.platformObject},enumerable:true});Object.defineProperty(n,"selectedMessages",{get:function(){return this._selectedMessages},enumerable:true});Object.defineProperty(n,"lastSelectedMessage",{get:function(){return this._lastSelectedMessage},enumerable:true})})