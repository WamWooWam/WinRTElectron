Jx.delayDefine(Mail,"ComboBox",function(){"use strict";Mail.ComboBox=function(n,t,i,r,u){var f,e;this._menuItems=t;this._ariaLabels=r;this._textFormat=u;this._host=n;this._text=this._host.querySelector(".comboboxText");this._disposer=new Mail.Disposer(new Mail.EventHook(n,"click",this._invoke,this),new Mail.EventHook(n,"keypress",this._onKeyPress,this),new Mail.Disposable(Jx.observeAttribute(n,"aria-expanded",function(){this._host.getAttribute("aria-expanded")==="true"&&this._invoke()},this),"disconnect"));this._dropDown=null;this._dropdownElement=null;f=this._host.querySelector(".comboboxArrow");e=this._menuItems.length>1?f.classList.remove:f.classList.add;e.call(f.classList,"hidden");this._currentValue=null;this.updateValue(i,false)};Jx.augment(Mail.ComboBox,Jx.Events);var n=Mail.ComboBox.prototype;n.dispose=function(){this._menuItems=null;this._ariaLabels=null;this._textFormat=null;this._host=null;this._text=null;this._disposer.dispose();this._disposer=null;this._dropDown=null;this._dropdownElement&&(Mail.safeRemoveNode(this._dropdownElement,true),this._dropdownElement=null);this._currentValue=null};n.show=function(){this._host.classList.remove("hidden")};n.hide=function(){this._host.classList.add("hidden");this._dropDown&&this._dropDown.hide()};n.hasFocus=function(){var n=document.activeElement,t=this._dropdownElement;return n===this._host||t&&Mail.isElementOrDescendant(n,t)};n._getItemTextForDropdown=function(n){var t=n.textId;return t?Jx.res.getString(t):n.text};n._getItemTextForComboLabel=function(n){return n.label||n.text||Jx.res.getString(n.textId)};n._makeMenuCommand=function(n){return{label:this._getItemTextForDropdown(n),onclick:this.updateNewValue.bind(this,n.value,true),id:n.id}};n._makeMenuCommands=function(){return this._menuItems.map(function(n){return this._makeMenuCommand(n)},this)};n._ensureDropdown=function(){var n,i,t;Mail.writeProfilerMark("ComboBox._ensureDropdown",Mail.LogEvent.start);this._dropdownElement||(this._dropdownElement=document.createElement("div"),this._dropdownElement.className="dropdownContainer",document.getElementById(Mail.CompApp.rootElementId).appendChild(this._dropdownElement));this._dropDown||(n=this._dropDown=new WinJS.UI.Menu(this._dropdownElement,{commands:this._makeMenuCommands(),sticky:true}),i=this._host,this._disposer.addMany(n,new Mail.EventHook(n,"aftershow",Mail.setAttribute.bind(null,i,"aria-expanded","true"),this),new Mail.EventHook(n,"afterhide",Mail.setAttribute.bind(null,i,"aria-expanded","false"),this)),t=this._ariaLabels,t&&t.getDropdownAriaLabel&&Mail.setAttribute(this._dropdownElement,"aria-label",t.getDropdownAriaLabel()));Mail.writeProfilerMark("ComboBox._ensureDropdown",Mail.LogEvent.stop)};n._invoke=function(){this._menuItems.length>1&&(this._ensureDropdown(),this._dropDown.show(this._host,"bottom",Jx.isRtl()?"right":"left"))};n.updateItem=function(n,t){this._menuItems[n]=t;this._updateUI();var i=this._dropDown;i&&(i.hide(),i.commands=this._makeMenuCommands())};n.updateValue=function(n,t){Mail.writeProfilerMark("ComboBox.updateValue",Mail.LogEvent.start);this._currentValue=n;this._updateUI();t&&this.raiseEvent("changed");Mail.writeProfilerMark("ComboBox.updateValue",Mail.LogEvent.stop)};n.updateNewValue=function(n,t){Mail.writeProfilerMark("ComboBox.updateNewValue",Mail.LogEvent.start);this._currentValue!==n&&this.updateValue(n,t);Mail.writeProfilerMark("ComboBox.updateNewValue",Mail.LogEvent.stop)};n._updateUI=function(){var t=this._menuItems[this._currentValue],r=this._getItemTextForComboLabel(t),i=null,n;i=this._textFormat?Jx.res.loadCompoundString(this._textFormat,r):r;this._text.innerText=i;this._host.title=Jx.isString(t.tooltipId)?Jx.res.getString(t.tooltipId):"";n=this._ariaLabels;n&&n.getHostAriaLabel?Mail.setAttribute(this._host,"aria-label",n.getHostAriaLabel(this._currentValue)):Mail.setAttribute(this._host,"aria-label",i)};n._onKeyPress=function(n){var t=n.keyCode,i=Jx.KeyCode;(t===i.enter||t===i.space)&&this._invoke()};Object.defineProperty(n,"value",{get:function(){return this._currentValue},enumerable:true})})