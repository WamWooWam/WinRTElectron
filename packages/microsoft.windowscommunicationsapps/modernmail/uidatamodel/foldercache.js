Jx.delayDefine(Mail.UIDataModel,"FolderCache",function(){"use strict";var n=self.Mail.UIDataModel,t=Microsoft.WindowsLive.Platform,i={},r={};n.FolderCache={_onFolderChange:function(i){if(Mail.Validators.hasPropertyChanged(i,"specialMailFolderType")){var r=i.target;n.FolderCache._purgeAccount(r.accountId)}},_onAllFolderCollectionChange:function(r){var e,u,f;Mail.writeProfilerMark("FolderCache._onAllFolderCollectionChange",Mail.LogEvent.start);e=r.detail[0].eType;u=t.CollectionChangeType;switch(e){case u.itemAdded:case u.itemRemoved:case u.reset:case u.itemChanged:for(f in i)r.target===i[f].allFolderCollection&&n.FolderCache._purgeAccount(f)}Mail.writeProfilerMark("FolderCache._onAllFolderCollectionChange",Mail.LogEvent.stop)},_purgeFolder:function(r,u){var e=i[r],f,o;e&&(f=e[u],f&&(o=f.objectId,f.removeEventListener("changed",n.FolderCache._onFolderChange),delete e[u],n.FolderCache.raiseEvent(n.FolderCache.Events.folderPurged,o)))},_purgeAccount:function(u){var f,e,o;if(delete r[u],f=i[u],!Jx.isNullOrUndefined(f)){e=f.allFolderCollection;e.removeEventListener("collectionchanged",n.FolderCache._onAllFolderCollectionChange);e.dispose();delete f.allFolderCollection;for(o in f)n.FolderCache._purgeFolder(u,o);delete i[u];n.FolderCache.raiseEvent(n.FolderCache.Events.accountPurged,u)}},dispose:function(){for(var t in i)n.FolderCache._purgeAccount(t)},_initAccount:function(u){var f,o,e;Mail.writeProfilerMark("FolderCache._initAccount",Mail.LogEvent.start);f=u.objectId;Jx.isNullOrUndefined(i[f])&&(o=Mail.Globals.platform,e=o.folderManager.getAllFoldersCollection(t.FolderType.mail,u),e.addEventListener("collectionchanged",n.FolderCache._onAllFolderCollectionChange),e.unlock(),i[f]={allFolderCollection:e},r[f]={});Mail.writeProfilerMark("FolderCache._initAccount",Mail.LogEvent.stop)},getPlatformFolder:function(r,u){var e,f,o;return n.FolderCache._initAccount(r),e=r.objectId,f=i[e][u],Jx.isNullOrUndefined(f)&&(Mail.writeProfilerMark("FolderCache.getPlatformFolder - work",Mail.LogEvent.start),o=Mail.Globals.platform,f=o.folderManager.getSpecialMailFolder(r,u),Jx.isNullOrUndefined(f)||(f.addEventListener("changed",n.FolderCache._onFolderChange),i[e][u]=f),Mail.writeProfilerMark("FolderCache.getPlatformFolder - work",Mail.LogEvent.stop)),f},getPlatformView:function(i,u){var e,f,o;return n.FolderCache._initAccount(i),e=i.objectId,f=r[e][u],Jx.isNullOrUndefined(f)&&(Mail.writeProfilerMark("FolderCache.getPlatformFolder - work",Mail.LogEvent.start),o=Mail.Globals.platform,f=o.mailManager.getMailView(u,i),r[e][u]=f,Mail.writeProfilerMark("FolderCache.getPlatformFolder - work",Mail.LogEvent.stop)),f},getFolder:function(i,r){var u=n.FolderCache.getPlatformFolder(i,r),f=null;return u&&(f=new n.MailFolder(u)),f},Events:{accountPurged:"accountPurged",folderPurged:"folderPurged"}};Jx.mix(n.FolderCache,Jx.Events)})