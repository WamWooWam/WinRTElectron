Jx.delayDefine(Mail,"FilteredCollection",function(){"use strict";function i(n,t){return n.baseIndex-t.baseIndex}function f(n){Jx.mark("Mail.FilteredCollection."+n+",StartTA,Mail")}function e(n){Jx.mark("Mail.FilteredCollection."+n+",StopTA,Mail")}var u=Microsoft.WindowsLive.Platform,n=u.CollectionChangeType,t,r;Mail.FilteredCollection=function(n,t,i){Mail.CollectionWrapper.call(this,t,i||"filter:"+t.name);this._filter=n;this._filter.setCallback(this.update,this);this._init()};Jx.inherit(Mail.FilteredCollection,Mail.CollectionWrapper);Mail.FilteredCollection.prototype.dispose=function(){this._collection&&(this._collection.forEach(this._filter.unhook,this._filter),Mail.CollectionWrapper.prototype.dispose.call(this),this._collection=null)};Object.defineProperty(Mail.FilteredCollection.prototype,"count",{get:function(){return this._filtered.length}});Mail.FilteredCollection.prototype.item=function(n){return this._filtered[n].item};Mail.FilteredCollection.prototype.update=function(n){var t=this.indexOf(n);this._filter.matches(n)?t===-1&&this._add(this._collection.indexOf(n),n):this._remove(n,t)};Mail.FilteredCollection.prototype._onCollectionChanged=function(t){var i=r(this._filtered,t);switch(t.eType){case n.itemRemoved:this._itemRemoved(t,i);break;case n.itemAdded:this._itemAdded(t);break;case n.itemChanged:this._itemChanged(t,i);break;case n.reset:this._reset(t);break;case n.batchBegin:case n.batchEnd:this._raiseChange({eType:t.eType})}};Mail.FilteredCollection.prototype._itemAdded=function(n){var t=this._collection.item(n.index);this._filter.hook(t);this._filter.matches(t)&&this._add(n.index,t)};Mail.FilteredCollection.prototype._add=function(n,r){if(n!==-1){var u={item:r,baseIndex:n},f=t(this._filtered,u,i);this._filtered.splice(f,0,u);this._raiseAdded(r,f)}};Mail.FilteredCollection.prototype._itemRemoved=function(n,t){var i=n.removed[0];this._remove(i,t);this._filter.unhook(i)};Mail.FilteredCollection.prototype._remove=function(n,t){if(t!==-1){var i=this._filtered.splice(t,1)[0];this._raiseRemoved(n,t)}};Mail.FilteredCollection.prototype._itemChanged=function(n,r){if(r!==-1){var u=this._filtered,f=u.splice(r,1)[0],e=t(u,f,i);u.splice(e,0,f);r!==e&&this._raiseMoved(f.item,r,e)}};Mail.FilteredCollection.prototype._reset=function(t){t.removed.forEach(this._filter.unhook,this._filter);var i=this._filtered.map(function(n){return n.item});this._init();this._raiseChange({eType:n.reset,removed:i})};Mail.FilteredCollection.prototype._init=function(){f("_init:"+this._logString);this._filtered=[];this._collection.forEach(function(n,t){this._filter.hook(n);this._filter.matches(n)&&this._filtered.push({item:n,baseIndex:t})},this);e("_init:"+this._logString)};t=Mail.SortedCollection.binarySearch;r=Mail.SortedCollection.adjustEntries})