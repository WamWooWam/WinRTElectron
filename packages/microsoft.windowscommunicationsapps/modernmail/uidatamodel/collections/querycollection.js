Jx.delayDefine(Mail,"QueryCollection",function(){"use strict";function t(n){Jx.mark("Mail.QueryCollection."+n+",StartTA,Mail")}function i(n){Jx.mark("Mail.QueryCollection."+n+",StopTA,Mail")}var n=Mail.QueryCollection=function(n,t,i,r,u){if(Mail.Collection.call(this,u||"<query>"),this._fn=n,this._context=t,this._args=i,this._listener=null,this._collection=null,this._count=0,this._async=r,!r){this.execQuery();var f=this._collection;this._count=f?f.count:0}};Jx.inherit(n,Mail.Collection);n.prototype.dispose=function(){this._collection&&(this._collection.removeEventListener("collectionchanged",this._listener),Jx.dispose(this._collection),this._collection=null)};Object.defineProperty(n.prototype,"count",{get:function(){return this._count},enumerable:true});n.prototype.item=function(n){return this._collection.item(n)};n.prototype.unlock=function(){this.locked&&(Mail.Collection.prototype.unlock.call(this),this._collection&&this._unlock())};n.prototype._unlock=function(){var n=this._collection;n&&(this._async&&n.count>0&&(this._count=n.count,this._raiseChange({eType:Microsoft.WindowsLive.Platform.CollectionChangeType.reset})),n.unlock())};n.prototype._onCollectionChanged=function(n){var t=this._collection;this._count=t?t.count:0;this._raiseChange({eType:n.eType,objectId:n.objectId,index:n.index,previousIndex:n.previousIndex})};n.prototype.execQuery=function(){t("execQuery:"+this._logString);this._listener=this._onCollectionChanged.bind(this);var n=this._collection=this._fn.apply(this._context,this._args);n&&(n.addEventListener("collectionchanged",this._listener),this.locked||this._unlock());i("execQuery:"+this._logString)};n.prototype.keepInView=function(){return this._collection};Mail.ScheduledQueryCollection=function(n,t,i,r,u,f){Mail.QueryCollection.call(this,n,t,i,true,f);this._job=u.addJob(null,r,f,this._onExecQuery,this)};Jx.inherit(Mail.ScheduledQueryCollection,n);Mail.ScheduledQueryCollection.prototype.execQuery=function(){Jx.dispose(this._job);this._job=null;Mail.QueryCollection.prototype.execQuery.call(this)};Mail.ScheduledQueryCollection.prototype._onExecQuery=function(){Mail.QueryCollection.prototype.execQuery.call(this)};Mail.ScheduledQueryCollection.prototype.dispose=function(){Jx.dispose(this._job);this._job=null;Mail.QueryCollection.prototype.dispose.call(this)}})