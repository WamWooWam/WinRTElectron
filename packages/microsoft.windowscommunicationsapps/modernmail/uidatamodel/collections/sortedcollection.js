Jx.delayDefine(Mail,"SortedCollection",function(){"use strict";function t(n,t,i){for(var e=-1,f,r,u=0,o=n.length;u<o;u++)f=n[u],r=f.baseIndex,r===t?(e=u,f.baseIndex=i):r>t&&r<=i?f.baseIndex=r-1:r<t&&r>=i&&(f.baseIndex=r+1);return e}function f(n){Jx.mark("Mail.SortedCollection."+n+",StartTA,Mail")}function e(n){Jx.mark("Mail.SortedCollection."+n+",StopTA,Mail")}var u=Microsoft.WindowsLive.Platform,n=u.CollectionChangeType,r,i;Mail.SortedCollection=function(n,t,i){Mail.CollectionWrapper.call(this,t,i||"sort:"+t.name);this._host=n;this._host.setCallback(this.update,this);this._init();Object.seal(this)};Jx.inherit(Mail.SortedCollection,Mail.CollectionWrapper);Mail.SortedCollection.prototype.dispose=function(){this._sorted&&(Mail.CollectionWrapper.prototype.dispose.call(this),this._sorted.forEach(this._unhook,this),this._sorted=null)};Object.defineProperty(Mail.SortedCollection.prototype,"count",{get:function(){return this._sorted.length}});Mail.SortedCollection.prototype.item=function(n){return this._sorted[n].item};Mail.SortedCollection.prototype.update=function(n){return this.updateById(n.objectId)};Mail.SortedCollection.prototype.updateById=function(n){var t=this.findIndexById(n);t!==-1&&this._updateIndex(t)};Mail.SortedCollection.prototype._updateIndex=function(n){var t=this._sorted,r=t.splice(n,1)[0],u=i(t,r,this._compare,this);t.splice(u,0,r);n!==u&&this._raiseChange({eType:Microsoft.WindowsLive.Platform.CollectionChangeType.itemChanged,objectId:r.item.objectId,index:u,previousIndex:n})};Mail.SortedCollection.prototype._init=function(){f("_init:"+this._logString);this._sorted=[];var n=this._collection.map(function(n,t){return{item:n,baseIndex:t}});n.sort(this._compare.bind(this));n.forEach(this._hook,this);this._sorted=n;e("_init:"+this._logString)};Mail.SortedCollection.prototype._onCollectionChanged=function(t){var e=this._sorted,f=r(e,t),u,o;switch(t.eType){case n.itemAdded:o={item:this._collection.item(t.index),baseIndex:t.index};this._hook(o);f=i(e,o,this._compare,this);e.splice(f,0,o);break;case n.itemRemoved:u=e.splice(f,1);break;case n.reset:u=this._sorted;this._init();break;case n.batchBegin:case n.batchEnd:break;case n.itemChanged:this._updateIndex(f);return;default:return}u&&u.forEach(this._unhook,this);this._raiseChange({eType:t.eType,objectId:t.objectId,index:f,removed:u?u.map(function(n){return n.item}):null})};Mail.SortedCollection.prototype._compare=function(n,t){return this._host.compare(n.item,t.item)||n.baseIndex-t.baseIndex};Mail.SortedCollection.prototype._hook=function(n){this._host.hook(n.item)};Mail.SortedCollection.prototype._unhook=function(n){this._host.unhook(n.item)};r=Mail.SortedCollection.adjustEntries=function(i,r){var u=-1,f=r.target;switch(r.eType){case n.itemAdded:u=t(i,f.count,r.index);break;case n.itemRemoved:u=t(i,r.index,f.count);break;case n.itemChanged:u=t(i,r.previousIndex,r.index)}return u};i=Mail.SortedCollection.binarySearch=function(n,t,i,r){for(var f,o,u=0,e=n.length;e>u;){if(f=u+(e-u>>>1),o=i.call(r,t,n[f]),o===0)return f;o>0?u=f+1:e=f}return u}})