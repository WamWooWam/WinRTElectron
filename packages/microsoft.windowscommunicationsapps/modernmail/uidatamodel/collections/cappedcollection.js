Jx.delayDefine(Mail,"CappedCollection",function(){var t=Microsoft.WindowsLive.Platform,n=t.CollectionChangeType;Mail.CappedCollection=function(n,t,i){Mail.CollectionWrapper.call(this,t,i||"cap:"+t.name);this._cap=n};Jx.inherit(Mail.CappedCollection,Mail.CollectionWrapper);Mail.CappedCollection.prototype.dispose=function(){Mail.CollectionWrapper.prototype.dispose.call(this);Jx.dispose(this._collection);this._collection=null};Mail.CappedCollection.prototype.item=function(n){return this._collection.item(n)};Object.defineProperty(Mail.CappedCollection.prototype,"count",{get:function(){return Math.min(this._cap,this._collection.count)},enumerable:true});Mail.CappedCollection.prototype._onCollectionChanged=function(t){switch(t.eType){case n.itemRemoved:this._itemRemoved(t);break;case n.itemAdded:this._itemAdded(t);break;case n.itemChanged:this._itemChanged(t);break;case n.reset:case n.batchBegin:case n.batchEnd:this._raiseChange({eType:t.eType})}};Mail.CappedCollection.prototype._itemAdded=function(n){var t=this._cap,i;n.index<t&&(this._cap++,i=n.index,this._raiseAdded(this._collection.item(i),i),this._cap--,this._collection&&this._collection.count>t&&this._raiseRemoved(this._collection.item(t),t))};Mail.CappedCollection.prototype._itemRemoved=function(n){var t=this._cap,r,i;n.index<t&&(this._cap--,r=n.index,this._raiseRemoved({objectId:n.objectId},r),this._cap++,this._collection&&this._collection.count>=t&&(i=t-1,this._raiseAdded(this._collection.item(i),i)))};Mail.CappedCollection.prototype._itemChanged=function(n){var t=this._cap;n.index<t&&n.previousIndex<t?this._raiseMoved(this._collection.item(n.index),n.previousIndex,n.index):n.index<t?this._itemAdded({index:n.index,objectId:n.objectId}):n.previousIndex<t&&this._itemRemoved({index:n.previousIndex,objectId:n.objectId})}})