Jx.delayDefine(Mail,["Collection","CollectionWrapper"],function(){"use strict";function n(n){Jx.mark("Mail.Collection."+n)}Mail.Collection=function(t){this.initEvents();this.name=t||"<unnamed>";var i=this._logString="collection="+Jx.uid()+" name="+this.name;this.locked=true;n("ctor:"+i)};Jx.augment(Mail.Collection,Jx.Events);Mail.Collection.prototype.dispose=Jx.fnEmpty;Mail.Collection.prototype.addEventListener=Mail.Collection.prototype.addListener;Mail.Collection.prototype.removeEventListener=Mail.Collection.prototype.removeListener;Mail.Collection.prototype.unlock=function(){this.locked&&(this.locked=false,this.raiseEvent("unlocked",{target:this}))};Mail.Collection.prototype._raiseChange=function(t){n("_raiseChange:"+this._logString+" type="+t.eType+" id="+t.objectId+" index="+t.index+" prev="+t.previousIndex);t.target=t.target||this;t.detail=t.detail||[t];this.raiseEvent("collectionchanged",t)};Mail.Collection.prototype._raiseAdded=function(n,t){this._raiseChange({eType:Microsoft.WindowsLive.Platform.CollectionChangeType.itemAdded,objectId:n.objectId,index:t})};Mail.Collection.prototype._raiseRemoved=function(n,t){this._raiseChange({eType:Microsoft.WindowsLive.Platform.CollectionChangeType.itemRemoved,objectId:n.objectId,index:t,removed:[n]})};Mail.Collection.prototype._raiseMoved=function(n,t,i){this._raiseChange({eType:Microsoft.WindowsLive.Platform.CollectionChangeType.itemChanged,objectId:n.objectId,index:i,previousIndex:t})};Mail.Collection.prototype.forEach=function(n,t){return Mail.Collection.forEach(this,n,t)};Mail.Collection.prototype.indexOf=function(n){return Mail.Collection.indexOf(this,n)};Mail.Collection.prototype.map=function(n,t){return Mail.Collection.map(this,n,t)};Mail.Collection.prototype.reduce=function(n,t){return Mail.Collection.reduce(this,n,t)};Mail.Collection.prototype.find=function(n,t){return Mail.Collection.find(this,n,t)};Mail.Collection.prototype.findIndex=function(n,t){return Mail.Collection.findIndex(this,n,t)};Mail.Collection.prototype.findById=function(n){return Mail.Collection.findById(this,n)};Mail.Collection.prototype.findIndexById=function(n){return Mail.Collection.findIndexById(this,n)};Mail.Collection.forEach=function(n,t,i){for(var r=0,u=n.count;r<u;r++)t.call(i,n.item(r),r,n)};Mail.Collection.indexOf=function(n,t){return t?Mail.Collection.findIndexById(n,t.objectId):-1};Mail.Collection.map=function(n,t,i){for(var u=n.count,f=Array(u),r=0;r<u;r++)f[r]=t.call(i,n.item(r),r,n);return f};Mail.Collection.reduce=function(n,t,i){var f=n.count,r=0,u;for(arguments.length<3?(u=n.item(0),r=1):u=i;r<f;r++)u=t(u,n.item(r),r,n);return u};Mail.Collection.find=function(n,t,i){var r=Mail.Collection.findIndex(n,t,i);return r!==-1?n.item(r):null};Mail.Collection.findIndex=function(n,t,i){for(var r=0,u=n.count;r<u;r++)if(t.call(i,n.item(r),r,n))return r;return-1};Mail.Collection.findById=function(n,t){var i=Mail.Collection.findIndexById(n,t);return i!==-1?n.item(i):null};Mail.Collection.findIndexById=function(n,t){return Mail.Collection.findIndex(n,function(n){return n.objectId===t})};Mail.CollectionWrapper=function(n,t){Mail.Collection.call(this,t||"wrap:"+n.name);this._collection=n;n.addListener("collectionchanged",this._onCollectionChanged,this);this.locked=n.locked;this.locked&&n.addListener("unlocked",this._onCollectionUnlocked,this)};Jx.inherit(Mail.CollectionWrapper,Mail.Collection);Mail.CollectionWrapper.prototype.dispose=function(){this.locked&&this._collection.removeListener("unlocked",this._onCollectionUnlocked,this);this._collection.removeListener("collectionchanged",this._onCollectionChanged,this)};Mail.CollectionWrapper.prototype.unlock=function(){this.locked&&this._collection.unlock()};Object.defineProperty(Mail.CollectionWrapper.prototype,"count",{get:function(){return this._collection.count},enumerable:true});Mail.CollectionWrapper.prototype._onCollectionUnlocked=function(){this._collection.removeListener("unlocked",this._onCollectionUnlocked,this);Mail.Collection.prototype.unlock.call(this)}})