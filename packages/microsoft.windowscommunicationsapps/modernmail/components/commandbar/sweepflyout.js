Jx.delayDefine(Mail,"SweepFlyout",function(){"use strict";var t=Microsoft.WindowsLive.Platform,n=Mail.SweepRules;Mail.SweepFlyout=function(t){Mail.writeProfilerMark("SweepFlyout_constructor",Mail.LogEvent.start);this._account=t.account.platformObject;this._senders=n.getSenders(t);this._view=t.view;this._appRoot=document.getElementById(Mail.CompApp.rootElementId);this._flyoutContainer=null;this._flyout=null;this._form=null;this._handleKeyDown=this._handleKeyDown.bind(this);this._onSweepSubmitted=this._onSweepSubmitted.bind(this);this._afterHide=this._afterHide.bind(this);Mail.writeProfilerMark("SweepFlyout_constructor",Mail.LogEvent.stop)};Jx.augment(Mail.SweepFlyout,Jx.Component);Mail.SweepFlyout._flyoutId="mailSweepFlyout";Mail.SweepFlyout.prototype._getFlyoutHeading=function(){var t=this._senders,n;if(t.length===1){var i=t[0],r=Jx.escapeHtmlToSingleLine(i.calculatedUIName),u=Jx.escapeHtmlToSingleLine(Jx.res.loadCompoundString("mailSweepFlyoutSenderEmail",i.emailAddress));n="<div class='mailSweepHeading' role='heading' aria-labelledby='mailSweepFlyoutHeader, mailSweepSenderName, mailSweepSenderEmail'><div id='mailSweepFlyoutHeader'>"+Jx.escapeHtml(Jx.res.getString("mailSweepFlyoutMessagesFrom"))+"<\/div><div><span id='mailSweepSenderName'>"+r+"<\/span> <span id='mailSweepSenderEmail' class='mailSweepSenderEmail'>"+u+"<\/span><\/div><\/div>"}else n="<div class='mailSweepHeading' role='heading' aria-labelledby='mailSweepFlyoutHeader'><div id='mailSweepFlyoutHeader'>"+Jx.escapeHtml(Jx.res.getString("mailSweepFlyoutMessagesFromPlural"))+"<\/div><\/div>";return n};Mail.SweepFlyout.prototype.getUI=function(i){var o,r,u,f,e;Mail.writeProfilerMark("SweepFlyout_getUI",Mail.LogEvent.start);o=this._getFlyoutHeading();r=n.getScopeFolder(t.MailRuleActionType.move,n.sweepType.moveAll,this._view);r?(e=Mail.UIDataModel.MailFolder.getName(r),u=Jx.res.loadCompoundString("mailSweepFlyoutDeleteAllInFolder",e),f=Jx.res.loadCompoundString("mailSweepFlyoutDeleteAllInFolderAndBlock",e)):(u=Jx.res.getString("mailSweepFlyoutDeleteAllInAccount"),f=Jx.res.getString("mailSweepFlyoutDeleteAllInAccountAndBlock"));i.html="<div class='mailFolderDialog'><form class='mailSweepForm'>"+o+"<label class='mailSweepTypeOption' ><input type='radio' value='moveAll' class='mailSweepRadio' checked='true' >"+Jx.escapeHtmlToSingleLine(u)+"<\/label><label class='mailSweepTypeOption' ><input type='radio' value='moveAllFuture' class='mailSweepRadio'  >"+Jx.escapeHtmlToSingleLine(f)+"<\/label><label class='mailSweepTypeOption' ><input type='radio' value='moveNotMostRecent' class='mailSweepRadio' >"+Jx.escapeHtmlToSingleLine(Jx.res.getString("mailSweepFlyoutDeleteNotMostRecentInAccount"))+"<\/label><label class='mailSweepTypeOption' ><input type='radio' value='moveTenDays' class='mailSweepRadio' >"+Jx.escapeHtmlToSingleLine(Jx.res.getString("mailSweepFlyoutDeleteOlderInAccount"))+"<\/label><button id='mailSweepConfirmButton'>"+Jx.res.getString("mailSweepFlyoutButton")+"<\/button><\/form><\/div>";Mail.writeProfilerMark("SweepFlyout_getUI",Mail.LogEvent.stop)};Mail.SweepFlyout.prototype.activateUI=function(){Mail.writeProfilerMark("SweepFlyout_activateUI",Mail.LogEvent.start);var n=document.getElementById(Mail.SweepFlyout._flyoutId),t=document.getElementById("sweep");n||(this._flyoutContainer=document.createElement("div"),this._flyoutContainer.innerHTML=Jx.getUI(this).html,this._flyoutContainer.id=Mail.SweepFlyout._flyoutId,this._flyout=new WinJS.UI.Flyout(this._flyoutContainer,{}),this._appRoot.appendChild(this._flyoutContainer),this._form=this._flyoutContainer.querySelector(".mailSweepForm"),Array.prototype.forEach.call(this._flyoutContainer.querySelectorAll(".mailSweepRadio"),function(n){n.name="sweepType"}),this._form.addEventListener("keydown",this._handleKeyDown,true),this._form.addEventListener("submit",this._onSweepSubmitted),this._flyout.addEventListener("afterhide",this._afterHide,true),this._flyout.show(t,"top","center"),Mail.writeProfilerMark("SweepFlyout_activateUI",Mail.LogEvent.stop))};Mail.SweepFlyout.prototype._handleKeyDown=function(n){event.key==="Enter"&&this._onSweepSubmitted(n)};Mail.SweepFlyout.prototype._onSweepSubmitted=function(t){Mail.writeProfilerMark("SweepFlyout_onSweepSubmitted",Mail.LogEvent.start);t.preventDefault();this._flyout.hide();var i=this._view,r=this._flyoutContainer.querySelector(".mailSweepRadio:checked"),u=n.sweepType[r.value];this._senders.forEach(function(t){n.runSweepRule(t.emailAddress,i,u)});Mail.writeProfilerMark("SweepFlyout_onSweepSubmitted",Mail.LogEvent.stop)};Mail.SweepFlyout.prototype._afterHide=function(){this._flyout&&this._flyout.removeEventListener("afterhide",this._afterHide);this._form&&(this._form.removeEventListener("keydown",this._handleKeyDown),this._form.removeEventListener("submit",this._onSweepSubmitted));this._appRoot.removeChild(this._flyoutContainer)};Mail.SweepFlyout.onSweepButton=function(n){Mail.writeProfilerMark("SweepFlyout_onSweepButton",Mail.LogEvent.start);var t=new Mail.SweepFlyout(n);Mail.Globals.commandManager.showAppBar().then(function(){t.activateUI()});Mail.writeProfilerMark("SweepFlyout_onSweepButton",Mail.LogEvent.stop)}})