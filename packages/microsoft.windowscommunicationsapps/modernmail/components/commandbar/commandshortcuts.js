Jx.delayDefine(Mail.Commands,"ShortcutManager",function(){"use strict";function n(n){if(n.altKey||n.shiftKey||n.ctrlKey)return false;var t=document.activeElement;return t?Mail.isElementEditable(t):false}Mail.Commands.ShortcutManager=function(n){this._selection=n;this._shortcuts={};var t=document.getElementById(Mail.CompApp.rootElementId);this._disposer=new Mail.Disposer(new Mail.EventHook(t,"keydown",this.onKeyDown,this),new Mail.EventHook(t,"MSPointerUp",this._onMSPointerUp,this),Mail.EventHook.createGlobalHook("mail-messageList-keydown",this._onListViewKeyDown,this));this._isEnabled=true};Mail.Commands.ShortcutManager.prototype.dispose=function(){this._disposer.dispose();this._disposer=null};Mail.Commands.ShortcutManager.prototype._onMSPointerUp=function(n){if(n.button===3){var t={control:false,shift:false,keyCode:Jx.KeyCode.browserback,alt:false};this.executeShortcut(t,n);n.preventDefault();n.stopPropagation();n.stopImmediatePropagation()}};Mail.Commands.ShortcutManager.prototype._onListViewKeyDown=function(n){this.onKeyDown(n.data)};Mail.Commands.ShortcutManager.prototype.enableKeyboardListener=function(){this._isEnabled=true};Mail.Commands.ShortcutManager.prototype.disableKeyboardListener=function(){this._isEnabled=false};Mail.Commands.ShortcutManager.prototype.register=function(n){n.forEach(function(n){var t=n.shortcuts;t.forEach(function(t){var i=t.keyCode,r,u;t.shift=Boolean(t.shift);t.control=Boolean(t.control);t.alt=Boolean(t.alt);i in this._shortcuts||(this._shortcuts[i]=[]);r=this._shortcuts[i];u=r.every(function(i){var r=i.command;return Mail.Commands.ShortcutManager._areModifiersEqual(i.shortcut,t)&&n.id===r.id?false:true});u&&this._shortcuts[i].push({shortcut:t,command:n})},this)},this)};Mail.Commands.ShortcutManager.prototype._findCommandsByShortcut=function(n){var t=this._shortcuts[n.keyCode],i=[];return Jx.isArray(t)&&t.forEach(function(t){var u=t.shortcut,r;Mail.Commands.ShortcutManager._areModifiersEqual(u,n)&&(r=t.command,i.push(r))}),i};Mail.Commands.ShortcutManager.prototype.onKeyDown=function(t){if(this._isEnabled&&t.keyCode!==Jx.KeyCode.alt&&t.keyCode!==Jx.KeyCode.shift&&t.keyCode!==Jx.KeyCode.ctrl&&!n(t)){var i=Mail.Commands.ShortcutManager.mapKeyEvents(t);this.executeShortcut(i,t)&&(t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation())}};Mail.Commands.ShortcutManager.prototype.executeShortcut=function(n,t){var u,f,i,o,r,e;if(!this._isEnabled)return false;for(u=this._findCommandsByShortcut(n),f=false,i=0,o=u.length;i<o;i++)if(r=u[i],r.isEnabled(this._selection)){try{r.onInvoke(this._selection,Mail.Instrumentation.UIEntryPoint.keyboardShortcut,t)}catch(s){e="Error in executing command "+String(r.id)+" due to "+s.message;Jx.log.exception(e,s)}f=true}return f};Mail.Commands.ShortcutManager._areModifiersEqual=function(n,t){return n.shift===t.shift&&n.control===t.control&&n.alt===t.alt};Mail.Commands.ShortcutManager.mapKeyEvents=function(n){return Jx.isNonEmptyString(n.key),{shift:n.shiftKey,control:n.ctrlKey,keyCode:n.keyCode,alt:n.altKey}}})