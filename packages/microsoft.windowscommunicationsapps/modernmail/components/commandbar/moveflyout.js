Jx.delayDefine(Mail,"MoveFlyout",function(){function n(n,t,i){this.initComponent();this._node=n;this._flyout=t;this._selection=i;this._hooks=null}function r(t,i,r,u){this._moveAllDialogContent=t;n.call(this,i,r,u)}function s(n){var t=n.view;return Mail.ViewCapabilities.supportsMoveAll(t)&&Mail.Commands.Contexts.selectedMessagesSupportSweep(n)&&!Mail.SearchHandler.isSearchingAllViews}function u(){this.initComponent()}function e(n,t,r,e,o){function rt(){var t=n.style.maxHeight,i,r;t!==b&&(b=t,t?(i=parseInt(t,10),r=d.getBoundingClientRect(),v.style.maxHeight=i-r.height+"px"):v.style.maxHeight="")}var b,g,nt;var c=Mail.ViewFilters,tt=r.account,y=tt.queryViews(f.MailViewScenario.move,"moveFlyout"),k=c.filterByType(y,c.folders),p=c.filterByType(y,c.categories),it=Mail.TreeFlattener.create(k),w=c.filterPinned(k),s=[];p.count>0&&(s.push(Mail.ViewHierarchy.wrapFlat(p)),s.push(new Mail.ArrayCollection([{objectType:"Splitter",objectId:"categorySplitter"}])));w.count>0&&(s.push(Mail.ViewHierarchy.wrapFlat(w)),s.push(new Mail.ArrayCollection([{objectType:"Splitter",objectId:"pinnedSplitter"}])));s.push(it);var a=new Mail.ConcatenatedCollection(s),l=new WinJS.UI.Flyout(n),h=new Jx.List({factory:function(n){return n.objectType==="Splitter"?new u:e(n,l,r)}}),v=n.querySelector("#moveFolderList"),d=n.querySelector("#moveOptions");return h.setSource(a),v.innerHTML=Jx.getUI(h).html,h.activateUI(),o&&(d.innerHTML=Jx.getUI(o).html,o.activateUI()),b="",g=new Mail.Disposer(y,w,p,a,l,new Jx.KeyboardNavigation(v,"vertical",null,"[disabled]"),new Mail.EventHook(l,"afterhide",function(){h.deactivateUI();o&&o.deactivateUI();h.releaseSource();g.dispose();n.removeNode(true)}),new Mail.Disposable(Jx.observeAttribute(n,"style",rt),"disconnect")),nt=Mail.Promises.waitForEvent(l,"aftershow"),l.show(t,"top","center"),nt.then(function(){var u=i[r.account.objectId],n=a.findIndexById(u),t;n===-1&&(n=0);t=h.getElement(n);t&&t.focus()})}function o(n){return document.getElementById("moveFlyout")?null:(n.insertAdjacentHTML("beforeend","<div id='moveFlyout' class='win-menu'><div id='moveFolderList'><\/div><div id='moveOptions'><\/div><\/div>"),n.lastElementChild)}var f,i,t;Mail.MoveFlyout={};f=Microsoft.WindowsLive.Platform;i={};Jx.augment(n,Jx.Component);n.prototype.getUI=function(n){var t=this._node,i=t.view;n.html="<button id='"+this._id+"' class='win-command moveTarget depth"+t.depth+"'"+(Mail.ViewCapabilities.canMoveTo(i)?"":" disabled")+" tabIndex='-1'>"+Jx.escapeHtml(i.name)+"<\/button>"};n.prototype.activateUI=function(){Jx.Component.prototype.activateUI.call(this);var n=document.getElementById(this._id);this._hooks=new Mail.Disposer(new Mail.EventHook(n,"click",this._onClick,this),new Mail.EventHook(n,"mouseover",n.focus,n),new Mail.EventHook(n,"mouseout",this._flyout.element.focus,this._flyout.element))};n.prototype.deactivateUI=function(){Jx.dispose(this._hooks);Jx.Component.prototype.deactivateUI.call(this)};n.prototype._onClick=function(){var n=this._selection,t=this._node.view;i[n.account.objectId]=t.objectId;Mail.moveWithConfirmation(n,t);this._flyout.hide()};Jx.inherit(r,n);r.prototype._onClick=function(){var t=this._selection,n=this._node.view;i[t.account.objectId]=n.objectId;this._moveAllDialogContent.chosenView=n;this._flyout.hide()};t=function(n){this._selection=n;this._hook=null;this.initComponent()};Jx.augment(t,Jx.Component);t.prototype.getUI=function(n){n.html="<hr class='win-command'><div id='moveAllContainer'><button id='moveAllLink'>"+Jx.escapeHtml(Jx.res.getString("mailMoveAllLink"))+"<\/button><\/div>"};t.prototype.activateUI=function(){this._hook=new Mail.EventHook(document.getElementById("moveAllContainer"),"click",this._onMoveAllClick,this)};t.prototype.deactivateUI=function(){Jx.dispose(this._hook)};t.prototype._onMoveAllClick=function(n){n.preventDefault();Mail.showMoveAllDialog(this._selection)};Jx.augment(u,Jx.Component);u.prototype.getUI=function(n){n.html="<hr class='win-command'>"};Mail.MoveFlyout.showMoveFlyout=function(i,r,u){function c(t,i,r){return new n(t,i,r)}var f=o(i),h;if(f)return h=s(r)?new t(r):null,e(f,u,r,c,h)};Mail.MoveFlyout.showMoveAllChooserFlyout=function(n,t,i){function f(n,i,u){return new r(t,n,i,u)}var u=o(n);if(u)return e(u,"moveAllChooseFolderLink",i,f)}})