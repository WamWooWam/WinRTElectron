Jx.delayDefine(Mail.Commands,"MenuFlyout",function(){"use strict";Mail.Commands.MenuFlyout=function(){this._flyout=null;this._commandToExecute=null;this._registeredCommandIds=this._registeredCommandIds||[];this._label=this._label||null;this._commands=null;this._observer=null;this._uiEntryPoint=Mail.Instrumentation.UIEntryPoint.appBar;Mail.Commands.Host.call(this);Mail.Commands.Host.prototype.activateUI.call(this)};Jx.inherit(Mail.Commands.MenuFlyout,Mail.Commands.Host);Object.defineProperty(Mail.Commands.MenuFlyout.prototype,"placement",{get:function(){return"top"},enumerable:true});Object.defineProperty(Mail.Commands.MenuFlyout.prototype,"alignment",{get:function(){return"center"},enumerable:true});Object.defineProperty(Mail.Commands.MenuFlyout.prototype,"registeredCommandIds",{get:function(){return this._registeredCommandIds},enumerable:true});Object.defineProperty(Mail.Commands.MenuFlyout.prototype,"id",{get:function(){},enumerable:true});Mail.Commands.MenuFlyout.onPointerDown=function(n){n.button===2&&n.preventDefault()};Mail.Commands.MenuFlyout.onContextMenu=function(n){n.preventDefault();this.hide()};Mail.Commands.MenuFlyout.prototype.register=function(){Mail.Globals.commandManager.registerCommandHost(this)};Mail.Commands.MenuFlyout.prototype.activateCommands=function(n){this._commands=n;n=n.map(function(n){var t=n.getOption();return t.onclick=function(){this._commandToExecute=n;this._observer.takeRecords()}.bind(this),t}.bind(this));this._createFlyoutMenu(n)};Mail.Commands.MenuFlyout.prototype._createFlyoutMenu=function(n){var t,i;t=document.createElement("div");t.className="commandMenuFlyout";t.id=this.id;this._label&&t.setAttribute("aria-label",this._label);i=document.getElementById(Mail.CompApp.rootElementId);i.appendChild(t);this._flyout=new WinJS.UI.Menu(t,{commands:n,sticky:true,placement:this.placement,alignment:this.alignment});this._observer=Jx.observeMutation(t,{attributes:true,subtree:true,attributeFilter:["aria-checked"]},this._onMutation,this);this._hooks=new Mail.Disposer(new Mail.EventHook(this._flyout,"MSPointerDown",Mail.Commands.MenuFlyout.onPointerDown),new Mail.EventHook(this._flyout,"contextmenu",Mail.Commands.MenuFlyout.onContextMenu,this),new Mail.EventHook(this._flyout,"afterhide",this._afterHide,this),new Mail.Disposable(this._observer,"disconnect"))};Mail.Commands.MenuFlyout.prototype._onMutation=function(n){n[0].target.winControl.onclick(n[0]);this._flyout.hide()};Mail.Commands.MenuFlyout.prototype._afterHide=function(n){var t=this._commandToExecute;if(t){var i=Mail.Globals.commandManager,r=this._uiEntryPoint,u=i.appBar;t.dismissAfterInvoke&&u&&!u.appBarSelectionSticky?i.hideAppBar().then(function(){i.invokeCommand(t,r,n)}):i.invokeCommand(t,r,n)}this._commandToExecute=null};Mail.Commands.MenuFlyout.prototype.dispose=function(){this._flyout&&(Jx.dispose(this._hooks),this._flyout.hide(),this._flyout=null);Mail.Commands.Host.prototype.deactivateUI.call(this)};Mail.Commands.MenuFlyout.prototype.show=function(n){this._flyout.show(n)};Mail.Commands.MenuFlyout.prototype.hide=function(){this._flyout.hide()};Mail.Commands.MenuFlyout.prototype.showCommands=function(){this._flyout.showOnlyCommands(this.commandsToShow())};Mail.Commands.MenuFlyout.prototype.toggleCommand=function(n){var t=this._flyout.getCommandById(n.id);t.selected=n.showAsSelected;t.icon=n.icon;t.label=n.label;t.tooltip=n.tooltip;this._observer.takeRecords()};Mail.Commands.MenuFlyout.prototype.isEnabled=function(n){var t=0;return this._commands.forEach(function(i){i.isEnabled(n)&&t++},this),t>1}});Jx.delayDefine(Mail.Commands,"FlyoutHandler",function(){Mail.Commands.FlyoutHandler={_instances:{},_constructors:{clipboardMenu:Mail.Commands.ClipboardMenu,compFlyoutCommandHost:Mail.CompFlyoutCommandHost,moreMenu:Mail.Commands.MoreMenu,composeMoreMenu:Mail.Commands.ComposeMoreMenu,fontFlyout:Mail.Commands.FontFlyout,fontColorFlyout:Mail.Commands.FontColorFlyout,highlightColorFlyout:Mail.Commands.HighlightColorFlyout,linkMenu:Mail.Commands.LinkMenu,listMenu:Mail.Commands.ListMenu}};Mail.Commands.FlyoutHandler.ensureFlyout=function(n){var t,i;return t=Mail.Commands.FlyoutHandler._instances[n],Jx.isObject(t)||(i=Mail.Commands.FlyoutHandler._constructors[n],t=new i,t.register(),Mail.Commands.FlyoutHandler._instances[n]=t),t};Mail.Commands.FlyoutHandler.isEnabled=function(n,t){var i=Mail.Commands.FlyoutHandler.ensureFlyout(n);return i.isEnabled(t)};Mail.Commands.FlyoutHandler.onHostButton=function(n,t,i){var r=Mail.Commands.FlyoutHandler.ensureFlyout(n),u;Jx.isHTMLElement(t)||(t=document.getElementById(t));i?r.show(t):(u=Mail.Globals.commandManager,u.showAppBar().then(r.show(t)))}})