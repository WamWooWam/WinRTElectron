Jx.delayDefine(Mail,"CompCanvasCommandBar",function(){Mail.CompCanvasCommandBar=function(n,t){var r,i;r=Mail.Globals.commandManager;for(i in t)r.isValidCommandId(i)||(Mail.log("CanvasCommandBar: Command "+i+" ignored."),delete t[i]);this._rootElement=n;this._elementMapping=t;this._id=String(Jx.uid());this._disposer=new Mail.Disposer;Mail.Commands.Host.call(this);Mail.Commands.Host.prototype.activateUI.call(this)};Jx.inherit(Mail.CompCanvasCommandBar,Mail.Commands.Host);Mail.CompCanvasCommandBar.prototype.dispose=function(){this._rootElement=null;this._disposer.dispose();Mail.Commands.Host.prototype.deactivateUI.call(this)};Mail.CompCanvasCommandBar.prototype.activateCommands=function(n){n.forEach(function(n){var f=this._elementMapping[n.id],t=this._rootElement.querySelector(f),i,r,u;t.title=n.tooltip;n.id==="respond"?(this._ensureFlyoutHost(t),i=Jx.observeAttribute(t,"aria-expanded",function(){if(t.getAttribute("aria-expanded")==="true")Mail.Commands.FlyoutHandler.onHostButton("compFlyoutCommandHost",t,true)}),this._disposer.add(new Mail.Disposable(i,"disconnect"))):(r=Mail.Globals.commandManager,u=function(t){r.invokeCommand(n,Mail.Instrumentation.UIEntryPoint.onCanvas,t)},t.addEventListener("click",u,false))},this)};Mail.CompCanvasCommandBar.prototype._ensureFlyoutHost=function(n){if(!this._respondFlyout){var t=Mail.Commands.FlyoutHandler.ensureFlyout("compFlyoutCommandHost"),i=Mail.setAttribute.bind(null,n,"aria-expanded","true"),r=Mail.setAttribute.bind(null,n,"aria-expanded","false");this._disposer.add(new Mail.EventHook(t,"aftershow",i));this._disposer.add(new Mail.EventHook(t,"afterhide",r));n.addEventListener("click",function(){n.getAttribute("aria-expanded")==="true"?r():i()},false)}};Mail.CompCanvasCommandBar.prototype.showCommands=function(){this._showCommands(this.commandsToShow(),true);this._showCommands(this.commandsToHide(),false)};Mail.CompCanvasCommandBar.prototype._showCommands=function(n,t){n.forEach(function(n){var i=this._elementMapping[n];Jx.setClass(this._rootElement.querySelector(i),"hidden",!t)},this)};Mail.CompCanvasCommandBar.prototype.composeCommands=function(){return["compose","delete"]};Mail.CompCanvasCommandBar.prototype.consumeCommands=function(){return this._sortedRegisteredCommandsIds};Mail.CompCanvasCommandBar.prototype.viewStateCommands=function(){return this._sortedRegisteredCommandsIds};Object.defineProperty(Mail.CompCanvasCommandBar.prototype,"registeredCommandIds",{get:function(){return Object.keys(this._elementMapping)},enumerable:true});Object.defineProperty(Mail.CompCanvasCommandBar.prototype,"id",{get:function(){return this._id},enumerable:true})})