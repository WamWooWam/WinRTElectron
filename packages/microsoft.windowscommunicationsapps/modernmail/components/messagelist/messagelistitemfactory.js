Jx.delayDefine(Mail,"MessageListItemFactory",function(){"use strict";var n=Mail.MessageListItemFactory={_listView:null,_realizedItems:[],_toBeRemoved:{},_lastRealizedItemIndex:0,_finishUpdateJob:null,_unRealizeJob:null,resetAll:function(){this._cancelJobs();this._realizedItems.forEach(function(t){t.markForCleanup();n._toBeRemoved[Jx.uid()]=t});this._realizedItems=[];this._unRealizeJob=Jx.scheduler.addJob(null,Mail.Priority.unrealizeMessageListItem,"MessageListItemFactory.dispose - _toBeRemoved",this._unRealize,this)},resetItemById:function(n){var t,i;t=this._indexOfRealizedItem(n);t>=0&&(i=this._realizedItems[t],this._realizedItems.splice(t,1),i.markForCleanup(),this._toBeRemoved[Jx.uid()]=i)},getElement:function(n,t,i,r){var e,f,u;return e=t.data,f=t.objectId,this.resetItemById(f),u=new Mail.MessageListItem(t,n,i,r),this._realizedItems.push(u),u.getElement()},getElementById:function(n){var t=this._indexOfRealizedItem(n);return t<0?null:this._realizedItems[t].getElement()},_indexOfRealizedItem:function(n){var t,i,r;for(Mail.writeProfilerMark("MessageListItemFactory_indexOfRealizedItem",Mail.LogEvent.start),t=0,i=this._realizedItems.length;t<i;t++)if(r=this._realizedItems[t],r.objectId===n)return Mail.writeProfilerMark("MessageListItemFactory_indexOfRealizedItem",Mail.LogEvent.stop),t;return Mail.writeProfilerMark("MessageListItemFactory_indexOfRealizedItem",Mail.LogEvent.stop),-1},_unRealize:function(){for(var n in this._toBeRemoved)return this._toBeRemoved[n].dispose(),delete this._toBeRemoved[n],Jx.Scheduler.repeat(true);return this._unRealizeJob=null,Jx.Scheduler.repeat(false)},_secondPassJob:function(){for(var t=this._realizedItems.length,r,n=this._lastRealizedItemIndex,i=t+this._lastRealizedItemIndex;n<i;n++)if(r=this._realizedItems[n%t],r.finishUpdates())return this._lastRealizedItemIndex=n%t,Jx.Scheduler.repeat(true);return this._finishUpdateJob=null,Mail.log("MessageListItemFactory_secondPassJob_finished"),Jx.Scheduler.repeat(false)},_cancelJobs:function(){Jx.dispose(this._unRealizeJob);this._unRealizeJob=null;Jx.dispose(this._finishUpdateJob);this._finishUpdateJob=null},_onListViewLoadingStateChanged:function(){var n=this._listView.loadingState;n==="complete"?this._onListViewStateComplete():this._cancelJobs()},_onListViewStateComplete:function(){Mail.log("MessageListItemFactory_onListViewStateComplete",Mail.LogEvent.start);this._cancelJobs();this._unRealizeJob=Jx.scheduler.addJob(null,Mail.Priority.unrealizeMessageListItem,"_onListViewStateComplete - _toBeRemoved",this._unRealize,this);this._lastRealizedItemIndex=0;this._finishUpdateJob=Jx.scheduler.addJob(null,Mail.Priority.finishMessageListItem,"_onListViewStateComplete - _realizedItems",this._secondPassJob,this);Mail.log("MessageListItemFactory_onListViewStateComplete",Mail.LogEvent.stop)}},t=n._onListViewLoadingStateChanged.bind(n);Object.defineProperty(n,"listView",{set:function(i){n._listView!==i&&(n._listView&&n._listView.removeEventListener("loadingstatechanged",t,false),n._listView=i,n._listView&&n._listView.addEventListener("loadingstatechanged",t,false))},get:function(){return n._listView},enumerable:true})})