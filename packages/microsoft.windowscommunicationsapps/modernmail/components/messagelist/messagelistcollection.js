Jx.delayDefine(Mail,"MessageListCollection",function(){"use strict";var i=Microsoft.WindowsLive.Platform,t=i.CollectionChangeType,n;Mail.MessageListCollection=function(n,t,i,r,u){this._deferredCollection=new Mail.MappedDeferredCollection(n,this,i,r,u);this._deferredCollection.addEventListener("collectionchanged",this._onCollectionChanged,this);this._locked=t;this._acceptPendingChangesJob=null;this._treeView=new Mail.EmptyMessageListTreeView};Jx.inherit(Mail.MessageListCollection,Jx.Events);n=Mail.MessageListCollection.prototype;n._start=function(n){Jx.mark("MessageListCollection."+n+":"+this._deferredCollection.name+",StartTA,Mail")};n._stop=function(n){Jx.mark("MessageListCollection."+n+":"+this._deferredCollection.name+",StopTA,Mail")};n._info=function(n){Jx.mark("MessageListCollection."+n+":"+this._deferredCollection.name)};Mail.MessageListCollection.createForMessages=function(n,t,r,u){var f=Boolean(u)?"conversation_children:="+u.objectId:"UnthreadedMessages",e=t.account;return new Mail.MessageListCollection(n,r,function(n){var t=null;return t=Jx.isInstanceOf(n,i.MailMessage)?new Mail.UIDataModel.MailMessage(n,e):n,new Mail.MessageListTreeNode(t,"message",u)},null,f)};Mail.MessageListCollection.createForConversations=function(n,t,r){return new Mail.MessageListCollection(n,r,function(n){var r=null;return r=Jx.isInstanceOf(n,i.MailConversation)?new Mail.UIDataModel.MailConversation(n):n,new Mail.ConversationNode(r,t)},null,"conversation")};Object.defineProperty(n,"count",{get:function(){return this._deferredCollection.count}});Object.defineProperty(n,"isEmpty",{get:function(){return this.count===0}});n.item=function(n){return this._deferredCollection.item(n)};n.findIndexByMessageId=function(n,t){return Mail.CollectionHelper.indexOf(this._deferredCollection,n,t)};n.dispose=function(){this._start("dispose");this._clearAcceptPendingChangesJob();this._deferredCollection.removeEventListener("collectionchanged",this._onCollectionChanged,this);this._deferredCollection.dispose();this._treeView=null;this._stop("dispose")};Mail.MessageListCollection.prototype._clearAcceptPendingChangesJob=function(){this._start("_clearAcceptPendingChangesJob");Jx.dispose(this._acceptPendingChangesJob);this._acceptPendingChangesJob=null;this._stop("_clearAcceptPendingChangesJob")};n.lock=function(){this._info("lock");this._locked=true};n.unlock=function(){this._info("unlock");this._locked=false;this._acceptPendingChanges()};n.onChangesPending=function(){!this._locked&&this._deferredCollection.hasPendingChanges&&(this._start("onChangesPending"),this._clearAcceptPendingChangesJob(),this._acceptPendingChangesJob=Jx.scheduler.addJob(null,Mail.Priority.messageListAcceptPendingChanges,"message list collection - accept pending changes",this._acceptPendingChanges,this),this._stop("onChangesPending"))};n.getTreeView=function(){return this._treeView};n._acceptPendingChanges=function(){this._clearAcceptPendingChangesJob();!this._locked&&this._deferredCollection.hasPendingChanges&&(this._start("_acceptPendingChanges"),this.raiseEvent("beginChanges",{target:this}),this._deferredCollection.acceptPendingChanges(),this.raiseEvent("endChanges",{target:this}),this._stop("_acceptPendingChanges"))};n._onCollectionChanged=function(n){n.target=this;switch(n.eType){case t.itemAdded:this.raiseEvent("itemAdded",n);break;case t.itemRemoved:this.raiseEvent("itemRemoved",n);break;case t.itemChanged:this.raiseEvent("itemMoved",n)}};n.onResetPending=function(){this._start("_onReset");this._clearAcceptPendingChangesJob();this._deferredCollection.acceptPendingChanges();this.raiseEvent("reset",{target:this});this._stop("_onReset")};Object.defineProperty(n,"hasPendingChanges",{get:function(){return this._deferredCollection.hasPendingChanges},enumerable:true})})