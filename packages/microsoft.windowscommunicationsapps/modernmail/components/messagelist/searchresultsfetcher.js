Jx.delayDefine(Mail,["SearchResultsFetcher","ServerSearchResultsFetcher"],function(){"use strict";var n=Mail.SearchResultsFetcherStatus={idle:0,fetching:1,processingNotifications:2};Mail.SearchResultsFetcher=function(t,i){Mail.writeProfilerMark("Mail.SearchResultsFetcher_Ctor",Mail.LogEvent.start);this._collection=t;this._status=n.idle;this._fetchJob=null;this._scheduler=i;Mail.writeProfilerMark("Mail.SearchResultsFetcher_Ctor",Mail.LogEvent.stop)};Mail.SearchResultsFetcher.prototype.beginChanges=function(){this._setStatus(n.processingNotifications)};Mail.SearchResultsFetcher.prototype.endChanges=function(){this._setStatus(n.idle);this._fetchAsync(false)};Mail.SearchResultsFetcher.prototype.localSearchComplete=function(){this._fetchAsync(false)};Mail.SearchResultsFetcher.prototype.serverSearchComplete=function(){this._setStatus(n.idle)};Mail.SearchResultsFetcher.prototype.serverSearchError=function(){this._setStatus(n.idle)};Mail.SearchResultsFetcher.prototype.fetchMoreItems=function(){};Mail.SearchResultsFetcher.prototype.dispose=function(){Jx.dispose(this._fetchJob);this._fetchJob=null;this._collection=null;this._scheduler=null};Mail.SearchResultsFetcher.prototype._setStatus=function(n){this._status=n};Mail.SearchResultsFetcher.prototype._fetchMoreItems=function(t){(this._fetchJob=null,t||this._collection.totalCount!==this._collection.count)&&(Mail.log("SearchCollection_fetch",Mail.LogEvent.start),this._setStatus(n.fetching),this._collection.fetchMoreItems(Mail.SearchCollection.pageSize))};Mail.SearchResultsFetcher.prototype._fetchAsync=function(n){this._fetchJob||(this._fetchJob=this._scheduler.addJob(null,Mail.Priority.searchResultsFetch,"Mail.SearchResultsFetcher.fetchMoreItems",this._fetchMoreItems,this,[n]))};Mail.ServerSearchResultsFetcher=function(t,i){Mail.writeProfilerMark("Mail.ServerSearchResultsFetcher",Mail.LogEvent.start);this._collection=t;this._collection.beginServerSearch();this._scheduler=i;this._fetchJob=null;this._status=n.idle;this._localResultsCount=-1;this._hasPendingFetch=false;this._serverSearchCompleted=false;Mail.writeProfilerMark("Mail.ServerSearchResultsFetcher",Mail.LogEvent.stop)};Jx.inherit(Mail.ServerSearchResultsFetcher,Mail.SearchResultsFetcher);Mail.ServerSearchResultsFetcher.prototype.endChanges=function(){this._setStatus(n.idle);(this._hasPendingFetch||!this._isFirstServerBatchFetched)&&this._scheduleFetch(!this._isFirstServerBatchFetched)};Mail.ServerSearchResultsFetcher.prototype.localSearchComplete=function(){this._localResultsCount=this._collection.totalCount;this._scheduleFetch(true)};Mail.ServerSearchResultsFetcher.prototype.serverSearchComplete=function(){this._setStatus(n.idle);this._serverSearchCompleted=true};Mail.ServerSearchResultsFetcher.prototype.fetchMoreItems=function(){this._scheduleFetch(true)};Object.defineProperty(Mail.ServerSearchResultsFetcher.prototype,"_isFirstServerBatchFetched",{get:function(){return this._serverSearchCompleted||this._collection.count>this._localResultsCount}});Mail.ServerSearchResultsFetcher.prototype._scheduleFetch=function(t){switch(this._status){case n.idle:this._hasPendingFetch=false;this._fetchAsync(t);break;case n.processingNotifications:this._hasPendingFetch=true}}})