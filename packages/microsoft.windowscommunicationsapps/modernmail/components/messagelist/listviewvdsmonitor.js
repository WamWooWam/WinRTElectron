Jx.delayDefine(Mail,"ListViewVDSMonitor",function(){"use strict";function n(n){Jx.mark("ListViewVDSMonitor:"+n)}function t(n){Jx.mark("ListViewVDSMonitor."+n+",StartTA,ListViewVDSMonitor")}function i(n){Jx.mark("ListViewVDSMonitor."+n+",StopTA,ListViewVDSMonitor")}var r=Mail.ListViewVDSMonitor=function(n,r,u){t("Ctor");this._collection=n;this._listView=r;this._editor=u;this._invalidateAllPromise=null;i("Ctor")};r.prototype={beginNotifications:function(){this._editor&&(this._editor.beginNotifications(),n("beginNotifications count:="+this._collection.count))},endNotifications:function(){this._editor&&(this._editor.endNotifications(),n("endNotifications count:="+this._collection.count),this._ensureCountInSync())},inserted:function(t,i,r,u){this._editor&&(this._editor.inserted(t,i,r),n("inserted index:="+u+" key:="+t.key+" prevKey:= "+i+" nextKey:= "+r+" count:="+this._collection.count))},moved:function(t,i,r,u,f){this._editor&&(this._editor.moved(t,i,r,u,f),n("moved  key:="+t.key+" prevKey:= "+i+" nextKey:= "+r+" prevIndex:="+u+" index:="+f+" count:="+this._collection.count))},removed:function(t){this._editor&&(this._editor.removed(t),n("removed objectId:="+t+" count:="+this._collection.count))},_getListViewCount:function(){return this._listView._cachedCount},_ensureCountInSync:function(){var n,t,i;this._editor&&(n=this._getListViewCount(),t=this._collection.count,n!==t&&(Jx.log.error("Mail.ListViewVDSMonitor count mismatch listView:="+n+" collection:="+t),i=this._editor,this._editor=null,this._invalidateAllPromise=i.invalidateAll(),this._invalidateAllPromise.then(function(n){this._invalidateAllPromise=null;this._editor=n}.bind(this,i))))},dispose:function(){t("dispose");this._invalidateAllPromise&&(this._invalidateAllPromise.cancel(),this._invalidateAllPromise=null);i("dispose")}}})