Jx.delayDefine(Mail,"SearchHandler",function(){"use strict";var n=null,i={notSearching:0,enteredSearch:1,executedSearch:2},t;Mail.SearchHandler=function(t,r){this._searchState=i.notSearching;this._searchCollection=null;var u=this._searchHeader=new Mail.SearchHeader(t,r);this._disposer=new Mail.Disposer(u,new Mail.EventHook(u,"querySubmitted",this._executeSearch,this),new Mail.EventHook(u,"startSearchInvoked",this.startSearch,this),new Mail.EventHook(u,"dismissSearchInvoked",this.dismissSearch,this),new Mail.EventHook(u,"scopeChanged",this._rescope,this));this._onSearchCompleted=this.raiseEvent.bind(this,"searchComplete");Mail.Globals.commandManager.registerShortcuts(["enterSearch","dismissSearch"]);n=this;this._selection=t;this._searchTerm="";this._language=""};t=Mail.SearchHandler.prototype;Jx.augment(Mail.SearchHandler,Jx.Events);Mail.SearchHandler.enterSearch=function(){n&&n.startSearch()};Mail.SearchHandler.dismissSearch=function(){n&&n.dismissSearch()};Object.defineProperty(Mail.SearchHandler,"isSearching",{get:function(){return n&&n.isSearching},enumerable:true});Object.defineProperty(Mail.SearchHandler,"isSearchingAllViews",{get:function(){return Mail.SearchHandler.isSearching&&n.scopeSwitcher.current.isSearchingAllViews},enumerable:true});Object.defineProperty(Mail.SearchHandler,"isSearchHeaderVisible",{get:function(){return n&&n.isSearchHeaderVisible},enumerable:true});Object.defineProperty(Mail.SearchHandler,"searchResultsEditable",{get:function(){return n&&n.isSearching&&n.searchResultsEditable},enumerable:true});t.dispose=function(){this._clearPendingSearches();Jx.dispose(this._disposer);this._disposer=null;this._searchHeader=null;n=null};t._rescope=function(){Jx.EventManager.fireDirect(null,"isSearchingChanged");this._searchState===i.executedSearch&&this._executeSearch({queryText:this._searchTerm,language:this._language})};t._executeSearch=function(n){this._searchTerm=n.queryText;this._language=n.language;this._clearPendingSearches();var t=this._searchHeader.scope;this._searchCollection=new Mail.SearchCollection(t,this._selection.account,n.queryText,n.language);this._searchCollectionHooks=this._disposer.add(new Mail.Disposer(new Mail.EventHook(this._searchCollection,"localSearchComplete",this._localSearchComplete,this),new Mail.EventHook(this._searchCollection,"searchComplete",this._onSearchCompleted,this)));this._searchCollection.execute();this._setSearchState(i.executedSearch)};t.hideSearchHeader=function(){this._searchHeader.hide()};t.startSearch=function(n){this._setSearchState(i.enteredSearch,n)};t.dismissSearch=function(n){this._clearPendingSearches();this._setSearchState(i.notSearching,n||{reason:"userInvoked"})};Object.defineProperty(t,"scopeSwitcher",{get:function(){return this._searchHeader.scopeSwitcher},enumerable:true});Object.defineProperty(t,"isSearching",{get:function(){return this._searchState===i.executedSearch},enumerable:true});Object.defineProperty(t,"isSearchHeaderVisible",{get:function(){return this._searchState===i.enteredSearch},enumerable:true});Object.defineProperty(t,"searchResultsEditable",{get:function(){return this._searchCollection&&this._searchCollection.searchResultsEditable},enumerable:true});t._clearPendingSearches=function(){this._disposer.disposeNow(this._searchCollectionHooks);this._searchCollectionHooks=null;this._searchCollection=null};t._setSearchState=function(n,t){var r,u,f;this._searchState!==n&&(r=this._searchState,u=this.isSearching,this._searchState=n,n===i.notSearching?r===i.executedSearch?this.raiseEvent("exitSearch",t):this.hideSearchHeader():n===i.enteredSearch?(f=!t||t.invokeType!=="typeToSearch",this._searchHeader.show(f),this.raiseEvent("enterSearch",t)):this.raiseEvent("executeSearch",t),Mail.writeProfilerMark("Mail.SearchHandler._setSearchState : "+this._searchState),this.isSearching!==u&&Jx.EventManager.fireDirect(null,"isSearchingChanged"))};t._localSearchComplete=function(){this.raiseEvent("localSearchComplete",this._searchCollection)}})