Jx.delayDefine(Mail,"MessageListFilter",function(){"use strict";function t(n){Jx.mark("MessageListFilter:"+n)}function e(n){Jx.mark("MessageListFilter."+n+",StartTA,MessageListFilter")}function o(n){Jx.mark("MessageListFilter."+n+",StopTA,MessageListFilter")}var f=Microsoft.WindowsLive.Platform,i=f.FilterCriteria,u=[{value:i.all,textId:"mailFilterAll",tooltipId:"mailFilterTooltipAll"},{value:i.unread,textId:"mailFilterUnread",tooltipId:"mailFilterTooltipUnread"}],n,r;Mail.MessageListFilter=function(n,t,i){e("ctor");this._selection=t;this._settings=i;this._container=null;this._combobox=new Mail.ComboBox(n,u,this._getLastAppliedFilter(),{getDropdownAriaLabel:this._getDropdownAriaLabel.bind(this),getHostAriaLabel:this._getHostAriaLabel.bind(this)});var r=Mail.Commands.Events;this._disposer=new Mail.Disposer(this._combobox,new Mail.EventHook(this._combobox,"changed",this._onComboBoxChanged,this),Mail.EventHook.createGlobalHook(r.allFilterApplied,this._onKeyboardShortcut,this),Mail.EventHook.createGlobalHook(r.unreadFilterApplied,this._onKeyboardShortcut,this),Mail.EventHook.createGlobalHook(r.reapplyFilter,this._onKeyboardShortcut,this));o("ctor")};Jx.augment(Mail.MessageListFilter,Jx.Events);n=Mail.MessageListFilter.prototype;n.dispose=function(){this._disposer.dispose()};n._getHostAriaLabel=function(n){return Jx.res.getString(u[n].textId)};n._getDropdownAriaLabel=function(){return Jx.res.getString("mailFilterDropdownMenuAriaLabel")};Object.defineProperty(n,"currentFilter",{get:function(){return this._combobox.value},enumerable:true});r={appliedViewId:"mail-filter-appliedViewId",lastAppliedFilter:"mail-filter-lastAppliedFilter"};n._getLastAppliedFilter=function(){var u,f,n,e;return(this._container=this._settings.getLocalSettings(),u=this._selection.view.objectId,f=this._container.get(r.appliedViewId),t("_getLastAppliedFilter - views: "+u+", "+f),f===u&&(n=this._container.get(r.lastAppliedFilter),n===i.unread||n===i.all))?(t("_getLastAppliedFilter - last applied filter is "+n),n):(t("_getLastAppliedFilter - stored view/filter pair is out of date, defaulting to All"),e=i.all,this._saveAppliedFilter(e),e)};n._onComboBoxChanged=function(){t("_onComboBoxChanged");this._saveAppliedFilter(this.currentFilter);this.raiseEvent("changed")};n._saveAppliedFilter=function(n){var i=this._selection.view.objectId,u=this._container;t("_onComboBoxChanged - storing view and filter: "+i+", "+n);u.set(r.appliedViewId,i);u.set(r.lastAppliedFilter,n)};n.setToAll=function(){t("setToAll");var n=i.all;this._saveAppliedFilter(n);this._combobox.updateNewValue(n,false)};n.apply=function(n,i){var r=this.currentFilter;return t("apply - applying "+r+"; threaded = "+i),i?n.getConversations(r):n.getMessages(r)};n._onKeyboardShortcut=function(n){var f=Mail.Commands.Events,r=null,u=this._combobox.updateNewValue;switch(n.type){case f.allFilterApplied:r=i.all;t("_onKeyboardShortcut - applying All filter");break;case f.unreadFilterApplied:r=i.unread;t("_onKeyboardShortcut - applying Unread filter");break;case f.reapplyFilter:Mail.ViewCapabilities.isFiltered(this._selection.view,this.currentFilter)?(r=this.currentFilter,u=this._combobox.updateValue,t("_onKeyboardShortcut - reapplying filter "+r)):(u=null,t("_onKeyboardShortcut - not changing filter"))}u&&u.call(this._combobox,r,true)};n.hide=function(){t("hide");this._combobox.hide()};n.show=function(){t("show");this._combobox.show()}})