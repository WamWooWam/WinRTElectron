Jx.delayDefine(Mail,"ConversationSelection",function(){"use strict";var t=Mail.ConversationSelection=function(n,t,i){this._markStart("Ctor",n.objectId);this._node=n;this._customChildSelection={};this._selected=false;this._view=t;this._aggregator=i;this._itemRemovedEventHook=new Mail.EventHook(this._node,"itemRemoved",this._onItemRemoved,this);this._markStop("Ctor")},n=t.prototype;n.dispose=function(){Jx.dispose(this._itemRemovedEventHook);this._itemRemovedEventHook=null};n.getSelectedChildren=function(n){return this.hasCustomSelection?this._getCustomChildSelection(n):this._getDefaultChildSelection(n)};n.notifyChildDeleted=function(n,t,i){var r=this._node.findIndexById(n);r===-1&&this.notifyChildSelectionChanged(n,false,t,i)};n.notifyChildSelectionChanged=function(n,t,i,r){var f="notifyChildSelectionChanged childId:"+n+" isSelected:= "+t+" parentIndex:="+i,u;this._markStart(f);this._initCustomChildSelection();u=this._selected;t?(this._selected=t,this._customChildSelection[n]=true):delete this._customChildSelection[n];this.hasCustomSelection!==u&&(this._selected=t,u?r.deselectParent(i,this.objectId):r.select(i));this._markStop(f)};n.notifyParentSelectionChanged=function(n,t,i){var r="notifyParentSelectionChanged isSelected:= "+n+" parentIndex:="+t,u;this._markStart(r);this._selected=n;this._node.expanded&&(n?(u=this._getDefaultChildSelection(t),i.select(u.indices)):(this._customChildSelection={},i.collapseParent(t,this.objectId)));this._markStop(r)};Object.defineProperty(n,"hasCustomSelection",{get:function(){return Object.keys(this._customChildSelection).length>0},enumerable:true});Object.defineProperty(n,"objectId",{get:function(){return this._node.objectId},enumerable:true});Object.defineProperty(n,"selected",{get:function(){return this._selected},enumerable:true});Object.defineProperty(n,"expanded",{get:function(){return this._node.expanded},enumerable:true});Object.defineProperty(n,"selectedItems",{get:function(){var n=[];return this.hasCustomSelection?this._node.forEach(function(t){t.objectId in this._customChildSelection&&n.push(t)},this):n.push(this._node),n},enumerable:true});n._onItemRemoved=function(n){if(!this._node.expanded)this._aggregator.onChildItemDeleted(this,n.objectId)};n._initCustomChildSelection=function(){if(this._selected&&!this.hasCustomSelection){var n=this._getDefaultChildSelection(0);n.ids.map(function(n){this._customChildSelection[n]=true},this)}};n._getDefaultChildSelection=function(n){var t=[],i=[],r=this._node.data,u=Mail.ViewCustomizations;return this._node.forEach(function(f,e){!f.pendingRemoval&&u.shouldBeDefaultSelection(r,f.data,this._view)&&(t.push(n+e+1),i.push(f.objectId))},this),{indices:t,ids:i}};n._getCustomChildSelection=function(n){var t=[],i=[];return this._node.forEach(function(r,u){var f=r.objectId;f in this._customChildSelection&&(t.push(n+u+1),i.push(f))},this),{indices:t,ids:i}};n._markStart=function(n,t){t=Jx.isNonEmptyString(t)?t:this.objectId;Mail.writeProfilerMark("Mail.ConversationSelection."+n+" - "+t,Mail.LogEvent.start)};n._markStop=function(n){Mail.writeProfilerMark("Mail.ConversationSelection."+n+" - "+this.objectId,Mail.LogEvent.stop)}})