Jx.delayDefine(Mail,"DisplayedItem",function(){"use strict";function n(n){this._node=n}n.prototype={get parentId(){return this._node.parentId},get objectId(){return this._node.objectId},get message(){return this._node.pendingRemoval?null:this._node.data},updateMessage:Jx.fnEmpty,dispose:Jx.fnEmpty,addListener:Jx.fnEmpty,removeListener:Jx.fnEmpty};Mail.DisplayedItem=function(n,t,i,r){this._node=t;this._itemRetriever=Mail.DisplayedItemRetriever.create(n,this._node);this._nodeSelection=r;this.updateMessage(i);this._itemAddedId=null;this._messageDeleted=false;this._parentId=t.objectId;this._hooks=new Mail.Disposer(new Mail.EventHook(this._node,"itemAdded",this._onItemAdded,this),new Mail.EventHook(this._node,"itemRemoved",this._onItemRemoved,this),new Mail.EventHook(this._node,"endChanges",this._onEndChanges,this));this._node.unlock()};Mail.DisplayedItem.prototype={get parentId(){return this._parentId},get objectId(){return this._node.objectId},get message(){return this._message&&!this._message.pendingRemoval?this._message.data:null},dispose:function(){Jx.dispose(this._hooks);this._hooks=null;this._itemRetriever=null;this._node=null;this._nodeSelection=null},updateMessage:function(n){var t=this._nodeSelection;if(t&&t.hasCustomSelection){var i=t.getSelectedChildren(-1),r=i.ids.indexOf(n),u=r===-1?i.indices[0]:i.indices[r];this._message=this._node.item(u)}else this._message=this._itemRetriever.findMessage(n).item},_onItemRemoved:function(n){this._message&&this._message.objectId===n.objectId&&(this._messageDeleted=true)},_onItemAdded:function(n){this._itemAddedId=n.objectId},_onEndChanges:function(){this._itemAddedId?this.raiseEvent("requestExpansion",{messageId:this._itemAddedId}):this._messageDeleted&&this._node.children.count>0&&(this.updateMessage(),this.raiseEvent("messageChanged"));this._messageDeleted=false}};Jx.augment(Mail.DisplayedItem,Jx.Events);Mail.DisplayedItem.create=function(t,i,r,u){return i.type==="conversation"?new Mail.DisplayedItem(t,i,r,u):new n(i)}})