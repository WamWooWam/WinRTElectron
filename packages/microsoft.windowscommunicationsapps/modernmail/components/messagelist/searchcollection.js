Jx.delayDefine(Mail,"SearchCollection",function(){"use strict";var t=Microsoft.WindowsLive.Platform,n=t.CollectionChangeType,i;Mail.SearchCollection=function(n,r,u,f){Mail.writeProfilerMark("SearchCollection.Ctor",Mail.LogEvent.start);this._collection=n.search(u,f,i);this._account=r;this._isServerSearchEnabled=n.canServerSearch;this._searchResultsEditable=r.accountType===t.AccountType.imap;this._isServerSearchCompleted=!this._isServerSearchEnabled;var e=this._isServerSearchEnabled?Mail.ServerSearchResultsFetcher:Mail.SearchResultsFetcher;this._fetcher=new e(this._collection,Jx.scheduler);this._collectionChanged=this._collectionChanged.bind(this);this._collection.addEventListener("collectionchanged",this._collectionChanged);this._treeView=new Mail.EmptyMessageListTreeView;Mail.writeProfilerMark("SearchCollection.Ctor",Mail.LogEvent.stop)};Jx.inherit(Mail.SearchCollection,Jx.Events);i=Mail.SearchCollection.pageSize=50;Object.defineProperty(Mail.SearchCollection.prototype,"isEmpty",{get:function(){return this.count===0&&this.isServerSearchCompleted}});Object.defineProperty(Mail.SearchCollection.prototype,"count",{get:function(){return this._collection.count}});Object.defineProperty(Mail.SearchCollection.prototype,"totalCount",{get:function(){return this._collection.totalCount}});Mail.SearchCollection.prototype.findIndexByMessageId=function(n,t){return Mail.CollectionHelper.indexOf(this,n,t)};Mail.SearchCollection.prototype.getTreeView=function(){return this._treeView};Mail.SearchCollection.prototype.lock=Jx.fnEmpty;Mail.SearchCollection.prototype.unlock=Jx.fnEmpty;Mail.SearchCollection.prototype.item=function(n){var t=this._collection.item(n),i=new Mail.UIDataModel.MailMessage(t,this._account);return new Mail.MessageListTreeNode(i,"message",null)};Mail.SearchCollection.prototype.dispose=function(){this._collection.removeEventListener("collectionchanged",this._collectionChanged);this._collection.dispose();this._collection=null;this._fetcher.dispose();this._fetcher=null};Mail.SearchCollection.prototype.execute=function(){this._collection.unlock()};Mail.SearchCollection.prototype._collectionChanged=function(i){switch(i.eType){case n.localSearchComplete:this.raiseEvent("localSearchComplete",{target:this,totalCount:this.totalCount});this._fetcher.localSearchComplete();break;case n.batchBegin:this.raiseEvent("beginChanges",{target:this});break;case n.itemAdded:this._onItemAdded(i);break;case n.itemRemoved:this.raiseEvent("beginChanges",{target:this});this.raiseEvent("itemRemoved",{target:this,index:i.index,objectId:i.objectId,eType:i.eType});this.raiseEvent("endChanges",{target:this});break;case n.batchEnd:this._fetcher.endChanges();this.raiseEvent("endChanges",{target:this});this._isServerSearchEnabled||this.totalCount!==this.count||this.raiseEvent("searchComplete");break;case n.serverSearchComplete:i.index===t.SearchStatusCode.success?(this._isServerSearchCompleted=true,this._fetcher.serverSearchComplete(),this.raiseEvent("searchComplete")):(this._fetcher.serverSearchError(),this.raiseEvent("searchError",i.index))}};Mail.SearchCollection.prototype._onItemAdded=function(n){var t=this.item(n.index),i=t.objectId;this.raiseEvent("itemAdded",{target:this,index:n.index,objectId:i,eType:n.eType})};Mail.SearchCollection.prototype.fetchMoreItems=function(){this._fetcher.fetchMoreItems()};Object.defineProperty(Mail.SearchCollection.prototype,"isServerSearchCompleted",{get:function(){return this._isServerSearchCompleted},enumerable:true});Object.defineProperty(Mail.SearchCollection.prototype,"isServerSearchEnabled",{get:function(){return this._isServerSearchEnabled},enumerable:true});Object.defineProperty(Mail.SearchCollection.prototype,"searchResultsEditable",{get:function(){return!this._isServerSearchEnabled||this._searchResultsEditable},enumerable:true})})