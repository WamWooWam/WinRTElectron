Jx.delayDefine(Mail,"SearchHeader",function(){"use strict";function t(n){Jx.mark("SearchHeader."+n+",StartTA,SearchHeader")}function i(n){Jx.mark("SearchHeader."+n+",StopTA,SearchHeader")}Mail.SearchHeader=function(n,r){t("Ctor");this._selection=n;this._animator=r;this._searchHeader=document.getElementById("mailMessageListSearchHeader");this._messageListElement=document.getElementById("messageList");this._filterHeader=document.getElementById("mailMessageListFilterHeader");var u=this._startSearchButton=document.getElementById("mailMessageListStartSearch");this._disposer=new Mail.Disposer(new Mail.EventHook(this._searchHeader,"focusout",this._onFocusOut,this,false),new Mail.EventHook(u,"click",this._onStartSearchInvoked,this,false),new Mail.EventHook(n,"navChanged",this._onViewChanged,this));this._enterSearchAnimation=null;this._exitSearchAnimation=null;this._scopeSwitcher=null;this._box=null;this._inputElement=null;this._createSearchBox();this._updateScopeSwitcher();this._isVisible=false;this._hasIssuedQuery=false;this._scopeChangedEventHook=null;i("Ctor")};Jx.augment(Mail.SearchHeader,Jx.Events);var n=Mail.SearchHeader.prototype;n.dispose=function(){t("dispose");this._cancelAnimations();this._hasIssuedQuery=false;Jx.dispose(this._scopeChangedEventHook);this._disposer.dispose();i("dispose")};n.show=function(n){this._isVisible||(t("show"),this._hasIssuedQuery=false,this._isVisible=true,this._box.searchHistoryContext=this._selection.account.objectId,this._scopeSwitcher.rescopeToCurrentView(),this._cancelAnimations(),this._showHeader(n),i("show"))};n._showHeader=function(n){this._inputElement.style.display="inherit";n?this._enterSearchAnimation=this._animator.shortFadeOut(this._filterHeader).then(function(){return this._messageListElement.classList.add("searchMode"),Mail.setActiveHTMLElement(this._inputElement),this._animator.shortFadeIn(this._searchHeader)}.bind(this)).then(function(){this._filterHeader.style.removeAttribute("opacity");this._enterSearchAnimation=null}.bind(this)):(this._searchHeader.style.removeAttribute("opacity"),this._messageListElement.classList.add("searchMode"))};n.hide=function(){this._isVisible&&(t("hide"),this._isVisible=false,this._hasIssuedQuery?this._exitSearchWithoutAnimation():this._exitSearchWithAnimation(),i("hide"))};Object.defineProperty(n,"scope",{get:function(){return this._scopeSwitcher.current},enumerable:true});Object.defineProperty(n,"scopeSwitcher",{get:function(){return this._scopeSwitcher},enumerable:true});n._addTooltips=function(n,t){var i=Mail.Globals.commandManager,r=i.getCommand("enterSearch"),u=i.getCommand("dismissSearch");n.setAttribute("title",r.tooltip);t.setAttribute("title",u.tooltip)};n._cancelAnimations=function(){this._enterSearchAnimation&&(this._enterSearchAnimation.cancel(),this._enterSearchAnimation=null);this._exitSearchAnimation&&(this._exitSearchAnimation.cancel(),this._exitSearchAnimation=null)};n._resetElements=function(){this._messageListElement.classList.remove("searchMode");this._box.queryText="";this._inputElement.style.display="none"};n._exitSearchWithoutAnimation=function(){t("_exitSearchWithoutAnimation");this._cancelAnimations();this._resetElements();i("_exitSearchWithoutAnimation")};n._exitSearchWithAnimation=function(){t("_exitSearchWithAnimation");this._cancelAnimations();this._exitSearchAnimation=this._animator.shortFadeOut(this._searchHeader).then(function(){return this._resetElements(),this._animator.shortFadeIn(this._filterHeader)}.bind(this)).then(function(){this._searchHeader.style.removeAttribute("opacity");this._exitSearchAnimation=null}.bind(this)).then(function(){Mail.setActiveHTMLElement(this._startSearchButton);i("_exitSearchWithAnimation")}.bind(this))};n._updateScopeSwitcher=function(){t("_updateScopeSwitcher");var n=document.getElementById("mailMessageListSearchScope");this._scopeSwitcher=this._disposer.replace(this._scopeSwitcher,new Mail.SearchScopeSwitcher(this._selection,n));Jx.dispose(this._scopeChangedEventHook);this._scopeChangedEventHook=new Mail.EventHook(this._scopeSwitcher,"changed",this._onScopeChanged,this);i("_updateScopeSwitcher")};n._createSearchBox=function(){var n,r;t("_createSearchBox");n=document.getElementById("mailMessageListSearchBox");this._box=new WinJS.UI.SearchBox(n,{searchHistoryDisabled:false,chooseSuggestionOnEnterDisabled:false,searchHistoryContext:this._selection.account.objectId});this._inputElement=n.querySelector("input");this._typeToSearch=this._disposer.add(new Mail.TypeToSearch(this._box,document.getElementById("idCompApp")));r=document.getElementById("mailMessageListDismissSearch");this._disposer.addMany(new Mail.EventHook(this._inputElement,"keypress",this._onTextBoxKeyPress,this),new Mail.EventHook(this._box,"querysubmitted",this._onQuerySubmitted,this),new Mail.EventHook(this._typeToSearch,"typetosearch",this._onTypeToSearch,this),new Mail.EventHook(r,"click",this._onDismissSearchInvoked,this),Jx.scheduler.addJob(null,Mail.Priority.addSearchTooltips,"Add tooltips for search buttons",this._addTooltips,this,[this._startSearchButton,r]));i("_createSearchBox")};n._onFocusOut=function(n){var t=!this._hasIssuedQuery&&!this._box.queryText,i=n.relatedTarget&&Mail.isElementOrDescendant(n.relatedTarget,this._searchHeader);!t||i||this._scopeSwitcher.hasFocus()||this._onDismissSearchInvoked()};n._onStartSearchInvoked=function(){this.raiseEvent("startSearchInvoked",{invokeType:"startSearchButton"})};n._onDismissSearchInvoked=function(){this.raiseEvent("dismissSearchInvoked")};n._onQuerySubmitted=function(n){t("_onQuerySubmitted");var r=n.detail,u=r.queryText.trim();Jx.isNonEmptyString(u)&&(this._hasIssuedQuery=true,this.raiseEvent("querySubmitted",{queryText:u,language:r.language}));i("_onQuerySubmitted")};n._onTypeToSearch=function(){this._isVisible||this.raiseEvent("startSearchInvoked",{invokeType:"typeToSearch"})};n._onScopeChanged=function(n){this.raiseEvent("scopeChanged",n)};n._onTextBoxKeyPress=function(n){n.keyCode!==Jx.KeyCode.escape||n.ctrlKey||n.altKey||n.shiftKey?n.keyCode===Jx.KeyCode.enter&&(n.stopPropagation(),n.preventDefault()):this._onDismissSearchInvoked()};n._onViewChanged=function(n){if(n.viewChanged){var t=n.target.view;t&&this._updateScopeSwitcher()}}})