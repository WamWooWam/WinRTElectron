Jx.delayDefine(Mail,"UnseenMonitor",function(){"use strict";function n(n){Jx.mark("Mail.UnseenMonitor."+n)}var i=Microsoft.WindowsLive.Platform,r=Mail.UnseenMonitor=function(t,r,u){n("ctor:view="+t.objectId);this._view=t;this._list=r;this._hidden=u.hidden;var e=this._disposer=new Mail.Disposer,f=this._collection=t.getMessages(i.FilterCriteria.unseen);f&&(f.unlock(),e.addMany(f,new Mail.EventHook(f,"collectionchanged",this._onCollectionChanged,this),new Mail.EventHook(u,"visibilitychange",this._onVisibilityChange,this)));this._hidden||this._clearUnseen()},t=r.prototype;t.dispose=function(){n("dispose");Jx.dispose(this._disposer)};t._onCollectionChanged=function(t){n("_onCollectionChanged:ev.eType="+t.eType+";hidden="+this._hidden);this._hidden||i.CollectionChangeType.itemAdded!==t.eType&&i.CollectionChangeType.reset!==t.eType||this._clearUnseen()};t._onVisibilityChange=function(t){this._hidden=t.target.hidden;var i=this._collection;i&&(n("_onVisibilityChange:hidden="+this._hidden+";count="+i.count),!this._hidden&&i.count>0&&(this._list.ensureVisible(0),this._clearUnseen()))};t._clearUnseen=function(){n("_clearUnseen");this._timer=this._disposer.replace(this._timer,new Jx.Timer(1500,this._onTimer,this))};t._onTimer=function(){n("_onTimer");this._view.clearUnseenMessages()}})