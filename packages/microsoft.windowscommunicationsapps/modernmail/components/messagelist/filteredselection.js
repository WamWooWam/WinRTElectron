Jx.delayDefine(Mail,["FilteredSelection"],function(){"use strict";function t(n){Jx.mark("FilteredSelection."+n+",StartTA,FilteredSelection")}function i(n){Jx.mark("FilteredSelection."+n+",StopTA,FilteredSelection")}var r=Mail.FilteredSelection=function(n,r){t("Ctor");this._selectedIndices=n;this._collection=r;this._collectionEventHook=new Mail.Disposer(new Mail.EventHook(this._collection,"itemAdded",this._onCollectionChanged,this),new Mail.EventHook(this._collection,"itemRemoved",this._onCollectionChanged,this),new Mail.EventHook(this._collection,"itemMoved",this._onCollectionChanged,this),new Mail.EventHook(this._collection,"reset",this._onCollectionChanged,this));this._deletedItems=[];this._selectedItems=[];this._selectedIndices=[];this._logicalSelectedItems=null;this._objectIndexMap={};n.forEach(function(n){if(n>=0&&n<this._collection.count){var t=this._collection.item(n);!t.pendingRemoval&&t.selectable&&(this._selectedItems.push(t),this._selectedIndices.push(n),this._objectIndexMap[t.objectId]=n)}},this);this._dirty=false;i("Ctor")},n=r.prototype;n._ensure=function(){var n,s,f,r;if(t("_ensure"),this._dirty){var u=this._objectIndexMap,e=this._selectedItems,o=e.length;for(this._objectIndexMap={},this._selectedIndices=[],this._selectedItems=[],n=0,s=this._collection.count;n<s;n++)if(f=this._collection.item(n),r=f.objectId,r in u&&(this._objectIndexMap[r]=n,this._selectedIndices.push(n),this._selectedItems.push(f),delete u[r],o--),o===0)break;e.forEach(function(n){n.objectId in u&&this._deletedItems.push(n)},this)}this._dirty=false;i("_ensure")};n.dispose=function(){this._collectionEventHook.dispose()};n._onCollectionChanged=function(){this._dirty=true};n.indexOfObject=function(n){this._ensure();var t=this._objectIndexMap[n];return Jx.isNumber(t)?t:-1};n.isIndexSelected=function(n){return this._ensure(),this._selectedIndices.indexOf(n)!==-1};r.diff=function(n,r){t("diff");for(var e=[],o=[],u=0,f=0;u<r.length||f<n.length;)u>=r.length?(e.push(n[f]),f++):f>=n.length?(o.push(r[u]),u++):r[u]===n[f]?(u++,f++):r[u]<n[f]?(o.push(r[u]),u++):r[u]>n[f]&&(e.push(n[f]),f++);return i("diff"),{added:o,removed:e}};n.diff=function(n){this._ensure();var t=Mail.FilteredSelection.diff(this._selectedIndices,n);return t.deletedItems=this._deletedItems,t};Object.defineProperty(n,"length",{get:function(){return this._ensure(),this._selectedIndices.length},enumerable:true});Object.defineProperty(n,"indices",{get:function(){return this._ensure(),this._selectedIndices},enumerable:true});Object.defineProperty(n,"items",{get:function(){return this._ensure(),this._selectedItems},enumerable:true});Object.defineProperty(n,"logicalItems",{get:function(){return this._logicalSelectedItems?this._logicalSelectedItems:this._selectedItems},set:function(n){this._logicalSelectedItems=n},enumerable:true})})