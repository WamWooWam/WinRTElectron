Jx.delayDefine(Mail,"SearchEndOfListItem",function(){"use strict";function r(n,t){var i=t?"win-interactive":"";return"<div class='mailMessageListEntryContainer typeSizeNormal "+i+"' aria-hidden='false'><div class='mailSearchEndOfListContainer'>"+n+"<\/div><\/div>"}function i(n){return Jx.escapeHtml(Jx.res.getString(n))}var n={progress:0,error:1,complete:2,moreResults:3},t;Mail.SearchEndOfListItem=function(t,i,r){this._listView=r;this._collection=t;this._hooks=null;this._isVisible=true;this._element=null;this._scopeSwitcher=i;this._element=document.createElement("div");this._element.classList.add("win-nondraggable");this._element.classList.add("win-nonswipeable");this._element.classList.add("win-nonselectable");this._initStatusHandlers();this._updateSearchStatus(n.progress);this._onLoadingStateChanged=this._onLoadingStateChanged.bind(this)};Jx.inherit(Mail.SearchEndOfListItem,Mail.EndOfListItem);Mail.SearchEndOfListItem.prototype.getElement=function(){return Mail.writeProfilerMark("SearchEndOfListItem.getElement",Mail.LogEvent.start),this._listenForUpdates(),Mail.writeProfilerMark("SearchEndOfListItem.getElement",Mail.LogEvent.stop),this._element};Mail.SearchEndOfListItem.prototype.fetchMoreItems=function(){this._collection.fetchMoreItems();this._updateSearchStatus(n.progress)};Mail.SearchEndOfListItem.prototype.onInvoke=function(){this._current.onInvoke()};Mail.SearchEndOfListItem.prototype.dispose=function(){Jx.dispose(this._hooks);this._hooks=null;this._element=null;this._collection=null};Mail.SearchEndOfListItem.prototype._initStatusHandlers=function(){this._initStatusHandlers=Jx.fnEmpty;this._handlers={};this._handlers[n.progress]=new Mail.SearchProgressHandler;this._handlers[n.error]=new Mail.SearchErrorHandler(this);this._handlers[n.complete]=new Mail.SearchCompleteHandler(this._scopeSwitcher);this._handlers[n.moreResults]=new Mail.SearchMoreResultsHandler};Mail.SearchEndOfListItem.prototype._getStatusHandler=function(){return this._handlers[this._searchStatus]};Mail.SearchEndOfListItem.prototype._updateSearchStatus=function(n){this._searchStatus!==n&&(this._searchStatus=n,this._current=this._getStatusHandler(),this._adjustVisibility(),this._isVisible&&(this._element.innerHTML=this._current.getUI()),this._fireEtwEvents())};Mail.SearchEndOfListItem.prototype._adjustVisibility=function(){var n=this._current.calculateVisibility();n!==this._isVisible&&(this._isVisible=n,Mail.writeProfilerMark("The visibility of the end of list item is changed to _isVisible"+String(n)),this.raiseEvent("visibilityChanged",this._isVisible))};t={};t[n.progress]="SearchEndOfListItem_showSearchProgress";t[n.error]="SearchEndOfListItem_showSearchError";t[n.moreResults]="SearchEndOfListItem_showMoreResults";t[n.complete]="SearchEndOfListItem_showSearchComplete";Mail.SearchEndOfListItem.prototype._fireEtwEvents=function(){var n=t[this._searchStatus];Mail.writeProfilerMark(n)};Mail.SearchEndOfListItem.prototype._onServerSearchError=function(t){var i=Microsoft.WindowsLive.Platform.SearchStatusCode,r=i.endOfRetrievableRange===t?n.moreResults:n.error;this._updateSearchStatus(r)};Mail.SearchEndOfListItem.prototype._listenForUpdates=function(){Jx.dispose(this._hooks);this._hooks=new Mail.Disposer(new Mail.EventHook(this._collection,"searchComplete",function(){this._updateSearchStatus(n.complete)},this),new Mail.EventHook(this._collection,"searchError",this._onServerSearchError,this),new Mail.EventHook(this._listView,"loadingstatechanged",this._onLoadingStateChanged,this))};Mail.SearchEndOfListItem.prototype._onLoadingStateChanged=function(){var t=this._listView.indexOfLastVisible>=this._collection.count-1,i=this._searchStatus===n.progress;this._listView.loadingState==="complete"&&t&&i&&this._collection.fetchMoreItems()};Object.defineProperty(Mail.SearchEndOfListItem.prototype,"visible",{get:function(){return this._isVisible},enumerable:true});Object.defineProperty(Mail.SearchEndOfListItem.prototype,"objectId",{get:function(){return"Mail.SearchEndOfListItem.objectId"},enumerable:true});Object.defineProperty(Mail.SearchEndOfListItem.prototype,"selectable",{get:function(){return false},enumerable:true});Mail.SearchStatusHandler=function(){};Mail.SearchStatusHandler.prototype.getUI=function(){return""};Mail.SearchStatusHandler.prototype.onInvoke=function(){};Mail.SearchStatusHandler.prototype.calculateVisibility=function(){return true};Mail.SearchCompleteHandler=function(n){this._scopeSwitcher=n;Mail.SearchStatusHandler.call(this)};Jx.inherit(Mail.SearchCompleteHandler,Mail.SearchStatusHandler);Mail.SearchCompleteHandler.prototype._getFirstRow=function(){if(this._scopeSwitcher.canServerSearch)return"";var n=i("mailMessageListSearchShowRecentResults");return"<div class='mailSearchEndOfListErrorLabel typeSizeNormal'>"+n+"<\/div>"};Mail.SearchCompleteHandler.prototype._getSecondRow=function(){if(!this._scopeSwitcher.canUpsell())return"";var n=this._scopeSwitcher.upsell;return"<div class='mailSearchEndOfListErrorTryAgain typeSizeNormal'>"+n.description+"<\/div>"};Mail.SearchCompleteHandler.prototype.getUI=function(){var n=this._scopeSwitcher.canUpsell();return r(this._getFirstRow()+this._getSecondRow(),!n)};Mail.SearchCompleteHandler.prototype.calculateVisibility=function(){return!this._scopeSwitcher.canServerSearch||this._scopeSwitcher.canUpsell()};Mail.SearchCompleteHandler.prototype.onInvoke=function(){this._scopeSwitcher.rescopeToUpsell()};Mail.SearchProgressHandler=function(){Mail.SearchStatusHandler.call(this)};Jx.inherit(Mail.SearchProgressHandler,Mail.SearchStatusHandler);Mail.SearchProgressHandler.prototype.getUI=function(){var n=i("mailSearchProgress");return"<div class='mailMessageListEntryContainer win-interactive' aria-hidden='false'><progress class='mailSearchEndOfListProgressElement'><\/progress><div class='mailSearchEndOfListProgressLabel typeSizeNormal'>"+n+"<\/div><\/div>"};Mail.SearchErrorHandler=function(n){this._controller=n;Mail.SearchStatusHandler.call(this)};Jx.inherit(Mail.SearchErrorHandler,Mail.SearchStatusHandler);Mail.SearchErrorHandler.prototype.getUI=function(){var n=i("mailSearchError"),t=i("mailSearchEndOfListItemRetryLabel");return r("<div class='mailSearchEndOfListErrorLabel typeSizeNormal'>"+n+"<\/div><div class='mailSearchEndOfListErrorTryAgain typeSizeNormal'>"+t+"<\/div>")};Mail.SearchErrorHandler.prototype.onInvoke=function(){this._controller.fetchMoreItems()};Mail.SearchMoreResultsHandler=function(){Mail.SearchStatusHandler.call(this)};Jx.inherit(Mail.SearchMoreResultsHandler,Mail.SearchStatusHandler);Mail.SearchMoreResultsHandler.prototype.getUI=function(){var n=i("mailSearchEndofListItemMoreResultsLabel");return r(n,true)}})