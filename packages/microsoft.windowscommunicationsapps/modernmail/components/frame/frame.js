Jx.delayDefine(Mail,"CompFrame",function(){"use strict";Mail.CompFrame=function(n,t){var l;Mail.log("Frame_Ctor",Mail.LogEvent.start);this._name="Mail.CompFrame";Mail.log("Frame_Ctor_InitComp",Mail.LogEvent.start);this.initComponent();Mail.log("Frame_Ctor_Children",Mail.LogEvent.start);var i=this._selection=new Mail.Selection(n,t),u=Mail.guiState=new Mail.GUIState(i),r=this._animator=Mail.Globals.animator=new Mail.Animator(u),o=this._glomManager=new Mail.GlomManager(i,u),f=Mail.Globals.commandManager=new Mail.Commands.Manager(this._glomManager,i),e=Mail.Globals.appSettings;this._platform=n;var s=this._readingPaneSection=new Mail.ReadingPaneSection(i,r,o),h=this._commandBar=new Mail.CompCommandBar(f),c=this._messageList=new Mail.CompMessageList(this,i,h,r,e),a=this._navPane=new Mail.NavPaneManager(this,i,u,r,n,e),v=this._welcomeMessage=new Mail.WelcomeMessage(this,i,r,e,[c,s],f);this.append(c,s,h,a,v);Mail.Utilities.ComposeHelper.registerSelection(i);l=new Mail.WorkerOwner(i);this._disposer=new Mail.Disposer(i,l,Mail.UIDataModel.FolderCache,u,r,o,f);this._frameElement=null;Mail.log("Frame_Ctor_Children",Mail.LogEvent.stop);Mail.log("Frame_Ctor",Mail.LogEvent.stop)};Mail.CompFrame.frameElementId="mailFrame";Jx.augment(Mail.CompFrame,Jx.Component);Mail.CompFrame.prototype.getUI=function(n){Mail.log("Frame_getUI",Mail.LogEvent.start);var t=Jx.getUI(this._navPane),i=Jx.getUI(this._messageList),r=Jx.getUI(this._readingPaneSection),u=Jx.getUI(this._commandBar);n.html="<div id='"+Mail.CompFrame.frameElementId+'\'><div id="fakePeekBar"><\/div>'+t.html+i.html+r.html+"<\/div><div id='mailFrameCommandBar'>"+u.html+"<\/div>";Mail.log("Frame_getUI",Mail.LogEvent.stop)};Mail.CompFrame.prototype.onActivateUI=function(){var i=this._frameElement=document.getElementById(Mail.CompFrame.frameElementId),n=Mail.Globals.appState,t;this._disposer.addMany(new Mail.DragDrop(i,this._selection,this._messageList),new Mail.SuspendResumeHelper(this._platform,n),new Mail.EventHook(n,"updateSelection",this._updateSelection,this),new Mail.EventHook(this._selection,"navChanged",this._onNavigation,this),Mail.EventHook.createEventManagerHook(this,People.DialogEvents.closed,this._onDialogClosed,this));t=Mail.Promises.waitForEvent(this._animator,Mail.Animator.appLaunchAnimated).then(function(){n.lastActivationType!==Windows.ApplicationModel.Activation.ActivationKind.protocol&&this._messageList.focus()}.bind(this));this._disposer.add(new Mail.Disposable(t,"cancel"));Mail.guiState.updateViewState()};Mail.CompFrame.prototype.onDeactivateUI=function(){Jx.dispose(this._disposer)};Mail.CompFrame.prototype.selectAccount=function(n,t){var i=new Mail.Account(n,this._platform);t?this._selection.updateNav(i):this._selection.updateNavAsync(i)};Mail.CompFrame.prototype.selectViewAsync=function(n){var t=this._selection;t.updateNavAsync(t.account,n)};Mail.CompFrame.prototype._updateSelection=function(n){this._selection.updateNav(n.account,n.view,n.message)};Mail.CompFrame.prototype._onNavigation=function(n){n.accountChanged?this._animator.animateSwitchAccount():n.viewChanged&&this._animator.animateSwitchView()};Mail.CompFrame.prototype._onDialogClosed=function(){Jx.safeSetActive(this._frameElement)};Mail.CompFrame.prototype._initializeMessageBar=function(){var i,n;Mail.writeProfilerMark("CompFrame._initializeMessageBar",Mail.LogEvent.start);var t=new Chat.MessageBar(5,document.getElementById("appBody")),r=new Chat.AuthMessageBarPresenter,u=new Chat.ProxyAuthenticator,f=new Mail.DefaultAccountAuthPresenter,e=new Mail.SyncMessageBarHelper,o=new Mail.OutboxMonitor,s=new Mail.SelectedAccountOofPresenter,h=new Mail.RulesMessageBarPresenter,c=Jx.appData.localSettings().get("LiveDemoMode")||false;this._disposer.add(s);i=this._selection;s.init(t,i,"mailMessageBar");n=this._platform;c||(this._disposer.addMany(o,f,e,h,new Mail.Disposable(r,"shutdown"),new Mail.Disposable(u,"shutdown"),new Mail.AccountSyncStatus(t,i,n)),r.init(t,n,"mailMessageBar",true),u.init(n,Microsoft.WindowsLive.Platform.ApplicationScenario.mail),f.init(t,n,"mailMessageBar"),e.init(t,"mailMessageBar"),o.init(t,n,new Mail.GenericQueueHandler(i,n)),h.init(t,n,"mailMessageBar"));Mail.writeProfilerMark("CompFrame._initializeMessageBar",Mail.LogEvent.stop)};Mail.CompFrame.prototype.postStartupWork=function(){this._postStartupQueue=new Jx.ScheduledQueue(null,Mail.Priority.framePostStartupWork,"CompFrame.postStartupWork",[function(){this._commandBar.register()},this._initializeMessageBar],this)};Mail.CompFrame.prototype.hostComponent=function(n){this.appendChild(n);var t=Jx.getUI(n).html;t&&this._frameElement.insertAdjacentHTML("beforeEnd",t);n.activateUI()}})