Jx.delayDefine(Mail,"SuspendResumeHelper",function(){"use strict";Mail.SuspendResumeHelper=function(n,t){this._platform=n;this._appState=t;this._lastTelemetryReport=0;this._telemetryJob=null;this._suspended=false;this._disposer=new Mail.Disposer(new Mail.EventHook(Jx.activation,Jx.activation.suspending,this._suspendingListener,this),new Mail.EventHook(Jx.activation,Jx.activation.resuming,this._resumingListener,this),new Mail.EventHook(document,"msvisibilitychange",this._updateAppVisibility,this,false));this._updateAppVisibility()};Mail.SuspendResumeHelper.prototype._updateAppVisibility=function(){if(Mail.log("SuspendResumeHelper._updateAppVisibility",Mail.LogEvent.start),this._platform&&!this._suspended){var n=!document.msHidden;this._platform.mailManager.setMailVisible(n);n?(this._reportTelemetryOnMailVisible(),this._appState.onAppVisible()):this._appState.setAppInvisible()}Mail.log("SuspendResumeHelper._updateAppVisibility",Mail.LogEvent.stop)};Mail.SuspendResumeHelper.prototype._suspendingListener=function(){Mail.log("Mail_platform_suspend",Mail.LogEvent.start);this._updateAppVisibility();this._suspended=true;this._platform.suspend();Mail.log("Mail_platform_suspend",Mail.LogEvent.stop)};Mail.SuspendResumeHelper.prototype._resumingListener=function(){Mail.log("Mail_platform_resume",Mail.LogEvent.start);this._suspended=false;this._platform.resume();this._updateAppVisibility();var t=Windows.ApplicationModel.Background,n=null;try{n=t.BackgroundExecutionManager.getAccessStatus()}catch(i){Jx.log.exception("BackgroundExecutionManager.getAccessStatus() failed.",i)}Jx.isValidNumber(n)&&n!==t.BackgroundAccessStatus.allowedWithAlwaysOnRealTimeConnectivity&&n!==t.BackgroundAccessStatus.allowedMayUseActiveRealTimeConnectivity&&Jx.startupSync(this._platform,Microsoft.WindowsLive.Platform.ApplicationScenario.mail);Mail.log("Mail_platform_resume",Mail.LogEvent.stop);Jx.ptStopResume(Jx.TimePoint.responsive)};Mail.SuspendResumeHelper.prototype._reportTelemetryOnMailVisible=function(){Mail.writeProfilerMark("SuspendResumeHelper._reportTelemetryOnMailVisible",Mail.LogEvent.start);Date.now()-this._lastTelemetryReport>Mail.Utilities.msInFourHours&&!this._telemetryJob&&(this._telemetryJob=Jx.scheduler.addJob(null,Mail.Priority.reportTelemetryOnVisible,"Mail telemetry reporting on visible",function(){Mail.Instrumentation.instrumentConversationThreading();Mail.Instrumentation.instrumentEmailProviders();this._lastTelemetryReport=Date.now();this._telemetryJob=null},this));Mail.writeProfilerMark("SuspendResumeHelper._reportTelemetryOnMailVisible",Mail.LogEvent.stop)};Mail.SuspendResumeHelper.prototype.dispose=function(){this._appState.setAppInvisible();this._appState=null;this._platform=null;Jx.dispose(this._telemetryJob);this._telemetryJob=null;Jx.dispose(this._disposer);this._disposer=null}})