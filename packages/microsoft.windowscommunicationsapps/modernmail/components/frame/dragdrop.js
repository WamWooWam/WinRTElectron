Jx.delayDefine(Mail,"DragDrop",function(){"use strict";var n=Mail.DragDrop=function(n,t,i){this._root=n;this._selection=t;this._dragSource=i;this._detail=null;this._hovered=[];this._disposer=new Mail.Disposer(new Mail.EventHook(n,"itemdragstart",this._onDragStart,this),new Mail.EventHook(n,"itemdragend",this._onDragEnd,this),new Mail.EventHook(document,"msvisibilitychange",this._onVisibilityChange,this));this._hooks=null};n.prototype.dispose=function(){Jx.dispose(this._disposer);Jx.dispose(this._hooks)};n.prototype._onDragStart=function(n){var i,t;i=this._detail={dragElement:n.target,selection:this._selection,messages:this._dragSource.resolveDrag(n.detail.dragInfo)};i.messages.length>0?(t=this._root,this._hooks=new Mail.Disposer(new Mail.EventHook(t,"dragenter",this._onDragEnter,this),new Mail.EventHook(t,"dragleave",this._onDragLeave,this),new Mail.EventHook(t,"dragover",this._onDragOver,this),new Mail.EventHook(t,"drop",this._forwardEvent,this)),t.classList.add("dragging"),this._forwardEvent(n)):n.preventDefault()};n.prototype._onDragEnd=function(n){this._detail&&(this._forwardEvent(n),this._endDrag())};n.prototype._onDragEnter=function(n){this._updateHover(n.target);this._forwardEvent(n)};n.prototype._onDragLeave=function(n){this._forwardEvent(n)};n.prototype._onDragOver=function(n){this._forwardEvent(n);this._hovered.length?(n.dataTransfer.effectAllowed="move",n.preventDefault()):n.dataTransfer.effectAllowed="none"};n.prototype._updateHover=function(n){for(var i=[],r=this._root.parentElement,t=n;t&&t!==r;)t.classList.contains("draghoverable")&&(t.classList.add("hover"),i.push(t)),t=t.parentElement;this._hovered.forEach(function(n){i.indexOf(n)===-1&&n.classList.remove("hover")});this._hovered=i};n.prototype._endDrag=function(){Jx.dispose(this._hooks);this._detail=null;this._updateHover(null);this._root.classList.remove("dragging")};n.prototype._forwardEvent=function(n){var t=document.createEvent("CustomEvent");t.initCustomEvent("mail"+n.type,true,true,this._detail);n.target.dispatchEvent(t)};n.prototype._onVisibilityChange=function(n){var t=this._detail,i;n.target.msHidden&&t&&(i=document.createEvent("CustomEvent"),i.initCustomEvent("maildragend",true,true,t),t.dragElement.dispatchEvent(i),this._endDrag())}})