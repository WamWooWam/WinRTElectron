Jx.delayDefine(Mail,"GUIState",function(){"use strict";var u=Mail.GUIState=function(n){this._frameElement=null;this._viewState=null;this._layout=null;this._defaultOnePaneLayout=t.navAndMessageList;this._lastVisibility=this._getVisibility();this._width=window.innerWidth;this._devicePixelRatio=window.devicePixelRatio;this._newGlomTimer=null;this._handleSizeDownInternal=this._sizeDownToReadingPane;this._disposer=new Mail.Disposer(new Mail.EventHook(window,"resize",this.updateViewState,this),new Mail.EventHook(document,"msvisibilitychange",function(){this._lastVisibility=this._getVisibility()},this));this._selection=n;this._resizePerf=this._disposer.add(new Mail.ResizePerfReport(this))},n;Jx.augment(u,Jx.Events);Mail.ParentGUIState=Mail.GUIState;n=u.prototype;var t={full:0,navAndMessageList:1,readingPane:2},i={snap:320,minimum:502,portrait:844,more:1025},r={minimum:502,portrait:1030,more:1031},f=1.395;Object.defineProperty(n,"isSnapped",{get:function(){return this._width<=i.snap},enumerable:true});Object.defineProperty(n,"isOnePane",{get:function(){return!this.isThreePane},enumerable:true});Object.defineProperty(n,"isThreePane",{get:function(){return this._devicePixelRatio>f?this._width>=r.portrait:this._width>=i.portrait},enumerable:true});Object.defineProperty(n,"isNavPaneWide",{get:function(){return this._devicePixelRatio>f?this._width>=r.minimum&&this._width<r.portrait||this._width>=r.more:this._width>=i.minimum&&this._width<i.portrait||this._width>=i.more},enumerable:true});Object.defineProperty(n,"isNavPaneActive",{get:function(){return this._layout===t.navAndMessageList},enumerable:true});Object.defineProperty(n,"isMessageListActive",{get:function(){return this.isNavPaneActive},enumerable:true});Object.defineProperty(n,"isReadingPaneActive",{get:function(){return this._layout===t.readingPane},enumerable:true});Object.defineProperty(n,"isNavPaneVisible",{get:function(){return this.isThreePane||this.isNavPaneActive},enumerable:true});Object.defineProperty(n,"isMessageListVisible",{get:function(){return this.isThreePane||this.isMessageListActive},enumerable:true});Object.defineProperty(n,"isReadingPaneVisible",{get:function(){return this.isThreePane||this.isReadingPaneActive},enumerable:true});Object.defineProperty(n,"width",{get:function(){return this._width},enumerable:true});n._updateLayout=function(n){this._layout=n;this.isOnePane&&(this._defaultOnePaneLayout=n);this.raiseEvent("layoutChanged")};n._initializeFrame=function(n){Mail.writeProfilerMark("GUIState._initializeFrame",Mail.LogEvent.start);this._width=n;this._frameElement=document.getElementById(Mail.CompFrame.frameElementId);this._appBodyElement=document.getElementById("appBody");this._viewState=Jx.ApplicationView.getState();this.isThreePane?this._layout=t.full:(this._layout=this._defaultOnePaneLayout,this._appBodyElement.classList.add("navMessageListActive"));this._disposer.add(new Mail.EventHook(Jx.glomManager,Jx.GlomManager.Events.glomShowing,this._onGlomShowing,this));Mail.writeProfilerMark("GUIState._initializeFrame",Mail.LogEvent.stop)};n.updateViewState=function(){var n,i,r;if(Mail.writeProfilerMark("GUIState._updateViewState",Mail.LogEvent.start),n=this._getWidth(),!this._frameElement){this._initializeFrame(n);Mail.writeProfilerMark("GUIState._updateViewState",Mail.LogEvent.stop);return}i=this.isThreePane;r=Jx.ApplicationView.getState();this._width=n;this._devicePixelRatio=window.devicePixelRatio;r!==this._viewState&&(this._viewState=r,this.raiseEvent("viewStateChanged",this._viewState),i!==this.isThreePane&&(this.isOnePane&&!this._lastVisibility&&this._getVisibility()&&(this._handleSizeDownInternal=this._defaultOnePaneLayout===t.navAndMessageList?this._sizeDownToNavMessageList:this._sizeDownToReadingPane),(i?this._handleSizeDown:this._handleSizeUp).call(this)));this._resizePerf.viewStateComplete();Mail.writeProfilerMark("GUIState._updateViewState",Mail.LogEvent.stop)};n._restoreSizeDownHandler=function(){this._handleSizeDownInternal=this._sizeDownToReadingPane;this._disposer.disposeNow(this._newGlomTimer);this._newGlomTimer=null};n._onGlomShowing=function(n){var t=n.glom.getStartingContext();t.isEmlMessage||(this._handleSizeDownInternal=this._sizeDownToNavMessageList,this._newGlomTimer=this._disposer.replace(this._newGlomTimer,new Jx.Timer(5e3,this._restoreSizeDownHandler,this)))};n.handleGlomVisible=function(){this._restoreSizeDownHandler()};n._sizeDownToReadingPane=function(){this._showReadingPane()||this._sizeDownToNavMessageList();Mail.writeProfilerMark("GUIState._handleSizeDown_ReadingPane")};n._sizeDownToNavMessageList=function(){this._frameElement.classList.remove("readingPaneActive");this._appBodyElement.classList.add("navMessageListActive");this._updateLayout(t.navAndMessageList);Mail.writeProfilerMark("GUIState._handleSizeDown_NavMessage")};n._handleSizeDown=function(){Mail.writeProfilerMark("GUIState._handleSizeDown",Mail.LogEvent.start);this._handleSizeDownInternal();Mail.writeProfilerMark("GUIState._handleSizeDown",Mail.LogEvent.stop)};n._handleSizeUp=function(){Mail.writeProfilerMark("GUIState._handleSizeUp",Mail.LogEvent.start);this._frameElement.classList.remove("readingPaneActive");this._appBodyElement.classList.remove("navMessageListActive");this._updateLayout(t.full);Mail.writeProfilerMark("GUIState._handleSizeUp",Mail.LogEvent.stop)};n._showReadingPane=function(){return this._selection.message?(this._frameElement.classList.add("readingPaneActive"),this._appBodyElement.classList.remove("navMessageListActive"),this._updateLayout(t.readingPane),true):false};n.navigateForward=function(){Mail.writeProfilerMark("GUIState.navigateForward",Mail.LogEvent.start);this._layout===t.navAndMessageList&&this._showReadingPane();Mail.writeProfilerMark("GUIState.navigateForward",Mail.LogEvent.stop)};n.navigateBackward=function(){Mail.writeProfilerMark("GUIState.navigateBackward",Mail.LogEvent.start);this._frameElement.classList.remove("readingPaneActive");this._layout===t.readingPane&&(this._appBodyElement.classList.add("navMessageListActive"),this._updateLayout(t.navAndMessageList));Mail.writeProfilerMark("GUIState.navigateBackward",Mail.LogEvent.stop)};n.ensureNavMessageList=function(){Mail.writeProfilerMark("GUIState.ensureNavMessageList",Mail.LogEvent.start);this.navigateBackward();this._getVisibility()||(this._defaultOnePaneLayout=t.navAndMessageList);Mail.writeProfilerMark("GUIState.ensureNavMessageList",Mail.LogEvent.stop)};n.dispose=function(){this._disposer.dispose();this._disposer=null;this._newGlomTimer=null};n._getWidth=function(){return window.innerWidth};n._getVisibility=function(){return!document.msHidden}})