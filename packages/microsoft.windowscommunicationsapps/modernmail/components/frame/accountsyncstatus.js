Jx.delayDefine(Mail,"AccountSyncStatus",function(){"use strict";function u(n){Jx.mark("AccountSyncStatus:"+n)}function t(n){Jx.mark("AccountSyncStatus."+n+",StartTA,Mail,AccountSyncStatus")}function i(n){Jx.mark("AccountSyncStatus."+n+",StopTA,Mail,AccountSyncStatus")}var n=Microsoft.WindowsLive.Platform,r=Mail.AccountSyncStatus=function(r,u,f){t("ctor");this._messageBar=r;this._selection=u;this._disposer=new Mail.Disposer(new Mail.EventHook(u,"navChanged",this._onNavChanged,this),new Mail.EventHook(Jx.activation,Jx.activation.resuming,this._onResume,this));this._cleanupTimer=null;this._messageDuration=(new Windows.UI.ViewManagement.UISettings).messageDuration*500;this._accounts=this._disposer.add(new Mail.QueryCollection(f.accountManager.getConnectedAccountsByScenario,f.accountManager,[n.ApplicationScenario.mail,n.ConnectedFilter.normal,n.AccountSort.name]));this._accounts.unlock();this._lastViewed={};Object.seal(this);this._showMessage();i("ctor")};r._getNow=function(){return Date.now()};r.prototype={dispose:function(){t("dispose");this._disposer.dispose();this._disposer=null;i("dispose")},_onResume:function(){t("_onResume");this._showMessage();i("_onResume")},_onNavChanged:function(n){t("_onNavChanged");n.accountChanged&&this._showMessage();i("_onNavChanged")},_showMessage:function(){var f=r._getNow(),e=this._selection.account,o=e.objectId,s=this._lastViewed,c=s[o]||0,h=f-c,n;if(h<6e4){u("_showMessage: already seen before: "+h);return}t("_showMessage");s[o]=f;n=this._getStringForAccount(e);Jx.isNonEmptyString(n)&&(this._messageBar.addStatusMessage("AccountSyncStatus",Chat.MessageBar.Priority.superLow,{messageText:n,tooltip:n,cssClass:"mailMessageBar"}),this._cleanupTimer=this._disposer.replace(this._cleanupTimer,new Jx.Timer(this._messageDuration,this._hideMessage,this)));i("_showMessage")},_hideMessage:function(){this._messageBar.removeMessage("AccountSyncStatus")},_getStringForAccount:function(t){var r,f,i;return(u("_getStringForAccount"),r=t.mailResource,!r)?null:r.lastPushResult===n.Result.success&&t.syncType===n.SyncType.push?this._accounts.count<=1?Jx.res.getString("mailSyncUpToDate"):Jx.res.loadCompoundString("mailSyncUpToDate_withEmail",t.emailAddress):(f=r.lastSyncTime,i=this._getTimeString(f),u("_getStringForAccount: time="+f+", timeString="+i),i===null)?null:this._accounts.count<=1?Jx.res.loadCompoundString("mailSyncLastUpdated",i):Jx.res.loadCompoundString("mailSyncLastUpdated_withEmail",t.emailAddress,i)},_getTimeString:function(n){var t,i;return(u("_getTimeString"),t=(r._getNow()-n)/1e3,t<30)?Jx.res.getString("mailSyncInterval_seconds"):t<90?Jx.res.getString("mailSyncInterval_minute"):t<60*59.5?Jx.res.loadCompoundString("mailSyncInterval_minutes",Math.round(t/60)):t<60*89.5?Jx.res.loadCompoundString("mailSyncInterval_hour"):t<3600*23.5?Jx.res.loadCompoundString("mailSyncInterval_hours",Math.round(t/3600)):t<3600*47.5?Jx.res.loadCompoundString("mailSyncInterval_day"):(i=Math.round(t/86400),i<366)?Jx.res.loadCompoundString("mailSyncInterval_days",i):null}}})