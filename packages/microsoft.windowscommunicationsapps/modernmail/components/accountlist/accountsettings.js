Jx.delayDefine(Mail,"AccountSettings",function(){"use strict";var n=Microsoft.WindowsLive.Platform,t;Mail.AccountSettings={};t=false;Mail.AccountSettings.onDialogOpened=function(){t=true};Mail.AccountSettings.onDialogClosed=function(){t=false};Mail.AccountSettings._launchUpdateAccountDialog=function(n,i){if(!t){var r=Microsoft.WindowsLive.Platform.ApplicationScenario.mail,u=new window.People.Accounts.AccountDialog(n,i,r,Mail.Globals.platform);u.show()}};Mail.AccountSettings._launchGmailDowngradeDialog=function(n){if(!t){var i=new People.Accounts.AccountBarricadeDialog(n);i.showGmailDowngradeDialog(Mail.Globals.platform)}};Mail.AccountSettings.launchPerAccountSettings=function(n,i){!t&&i&&setTimeout(function(){People.Accounts.showAccountSettingsPage(Mail.Globals.platform,Microsoft.WindowsLive.Platform.ApplicationScenario.mail,People.Accounts.AccountSettingsPage.perAccountSettings,{launchedFromApp:true,account:n})},300)};var u=[n.Result.ixp_E_IMAP_LOGINFAILURE,n.Result.ixp_E_SMTP_535_AUTH_FAILED,n.Result.e_HTTP_DENIED,n.Result.autoDiscoveryFailed,n.Result.nteDecryptionFailure,n.Result.credentialMissing],f=[n.Result.e_SYNC_IGNORABLE_SERVER_CERT_FAILURE,n.Result.e_SYNC_CBA_FAILED],i=function(){var n=Jx.res.getString("/accountsStrings/alc-errorText");return i=function(){return n},n},r=function(){var n=Jx.res.getString("/accountsStrings/alc-attentionNeededText");return r=function(){return n},n};Mail.AccountSettings.createErrorHandler=function(t,e){var h;Mail.writeProfilerMark("AccountSettings_doesAccountRequireAttention",Mail.LogEvent.start);e=e||t.getResourceByType(n.ResourceType.mail);var o=e?e.lastSyncResult:0,l=e?e.lastPushResult:0,c=e&&e.lastSendMailResult?e.lastSendMailResult:0,s={hasError:false,handler:Jx.fnEmpty,errorText:""};return t.isDefault||(o===n.Result.e_GOOGLE_APPS?(Jx.log.info("Account "+t.objectId+" requires reconnection due to errorCode - e_GOOGLE_APPS"),s={hasError:true,handler:Mail.AccountSettings._launchGmailDowngradeDialog.bind(null,t),errorText:r()}):f.indexOf(o)!==-1||l===n.Result.e_SYNC_PUSH_FAILED?(Jx.log.info("Account "+t.objectId+" requires attention due to errorCode - "+o),s={hasError:true,handler:Mail.AccountSettings.launchPerAccountSettings.bind(null,t),errorText:i()}):u.indexOf(o)===-1||Mail.AccountSettings.isSetupCompleted(t)?c===n.Result.ixp_E_SMTP_535_AUTH_FAILED&&(Jx.log.info("Account "+t.objectId+" requires attention due to errorCode - "+c),h=t.supportsOAuth?r():i(),s={hasError:true,handler:Mail.AccountSettings._launchUpdateAccountDialog.bind(null,t,People.Accounts.AccountDialogMode.updateSmtp),errorText:h}):(Jx.log.info("Account "+t.objectId+" requires attention due to errorCode - "+o),h=t.supportsOAuth?r():i(),s={hasError:true,handler:Mail.AccountSettings._launchUpdateAccountDialog.bind(null,t,People.Accounts.AccountDialogMode.update),errorText:h})),Mail.writeProfilerMark("AccountSettings_doesAccountRequireAttention",Mail.LogEvent.stop),s};Mail.AccountSettings.isSetupCompleted=function(t){return t.settingsResult===n.Result.success}})