Jx.delayDefine(Mail,"ShareHandler",function(){"use strict";Mail.ShareHandler=function(){Mail.writeProfilerMark("ShareHandler.Constructor",Mail.LogEvent.start);this._enabled=true;this._onShareSourceDataRequested=this._onShareSourceDataRequested.bind(this);this._disposer=new Mail.Disposer(new Mail.EventHook(Mail.guiState,"layoutChanged",this._onLayoutChanged,this),new Mail.EventHook(Windows.ApplicationModel.DataTransfer.DataTransferManager.getForCurrentView(),"datarequested",this._onShareSourceDataRequested,this));Mail.writeProfilerMark("ShareHandler.Constructor",Mail.LogEvent.stop)};Mail.ShareHandler.prototype._onShareSourceDataRequested=function(n){var t,u,i,r;Mail.writeProfilerMark("ShareHandler._onShareSourceDataRequested",Mail.LogEvent.start);t=n.request;u=this._getBestReadingBody();this._enabled?(i=document,window.getSelection().isCollapsed&&(i=u.contentWindow.document),r=ModernCanvas.Component.prototype.createDataPackageFromSelection(i),r?(t.data=r,t.data.properties.title=Jx.res.getString("mailShareTitle")):(Jx.log.error("Unable to create Share package from selection"),this._failRequest(t))):this._failRequest(t);Mail.writeProfilerMark("ShareHandler._onShareSourceDataRequested",Mail.LogEvent.stop)};Mail.ShareHandler.prototype._failRequest=function(n){n.failWithDisplayText(Jx.res.getString("mailShareFail"))};Mail.ShareHandler.prototype._getBestReadingBody=function(){var n=document.getElementById("mailFrameReadingPane");return n.querySelector(Mail.ReadingPaneBody._Selectors.bodyFrameElementSelector)};Mail.ShareHandler.prototype._onLayoutChanged=function(){var n=Mail.guiState;this._enabled=n.isReadingPaneVisible};Mail.ShareHandler.prototype.dispose=function(){this._disposer.dispose();this._disposer=null}})