Jx.delayDefine(Mail,"BodyLinkFlyout",function(){"use strict";Mail.BodyLinkFlyout={_flyout:null,_flyoutDiv:null,_appRoot:null,_selectedElement:null,_copySelectedElement:function(){Jx.scheduler.addJob(null,Mail.Priority.bodyLinkFlyout,"BodyLinkFlyout - Copy link html to clipboard",function(){this._selectedElement.ownerDocument.execCommand("Copy")},this)},_getClipboard:function(){return window.clipboardData},_copySelectedLink:function(){var t,n,i;if(Mail.writeProfilerMark("BodyLinkFlyout._copySelectedLink",Mail.LogEvent.start),t=this._selectedElement,n=Jx.isHTMLElement(t)?t.href:null,Jx.isNonEmptyString(n)){i=this._getClipboard();try{i.setData("URL",n)}catch(r){Jx.log.exception("Failed to copy URL to clipboard",r);try{i.setData("Text",n)}catch(u){Jx.log.exception("Failed to copy TEXT to clipboard",u)}}}Mail.writeProfilerMark("BodyLinkFlyout._copySelectedLink",Mail.LogEvent.stop)},ensureFlyout:function(n){var t,u,i,r;this._flyout||(Mail.writeProfilerMark("BodyLinkFlyout.ensureFlyout",Mail.LogEvent.start),t=this._flyoutDiv=document.createElement("div"),t.id="ReadingPaneBodyLinkFlyout",u=this._appRoot=document.getElementById(Mail.CompApp.rootElementId),u.appendChild(t),i=[],r=Jx.res,n&&i.push({id:"ReadingPaneBodyLink.Copy",label:r.getString("mailReadingPaneBodyContextMenuCopy"),onclick:this._copySelectedElement.bind(this)}),i.push({id:"ReadingPaneBodyLink.CopyLink",label:r.getString("mailReadingPaneBodyContextMenuCopyLink"),onclick:this._copySelectedLink.bind(this)}),this._flyout=new WinJS.UI.Menu(t,{commands:i,sticky:true}),this._afterHideHook=new Mail.EventHook(this._flyout,"afterhide",this.dispose,this,true),Mail.writeProfilerMark("BodyLinkFlyout.ensureFlyout",Mail.LogEvent.stop))},dispose:function(){Jx.dispose(this._afterHideHook);this._flyoutDiv.parentElement.removeChild(this._flyoutDiv);this._flyout=null;this._flyoutDiv=null;this._selectedElement=null},onContextMenu:function(n){var t,f,i,e,o,h;for(Mail.writeProfilerMark("BodyLinkFlyout.onContextMenu",Mail.LogEvent.start),t=n.target;!Jx.isNullOrUndefined(t)&&t.nodeName!=="AREA"&&t.nodeName!=="A";)t=t.parentNode;if(!Jx.isNullOrUndefined(t)&&Jx.isNonEmptyString(t.href)){this.ensureFlyout(Jx.isNonEmptyString(t.innerHTML));f=t.ownerDocument.parentWindow;i=f.getSelection();(i.rangeCount===0||i.getRangeAt(0).collapsed)&&(i.removeAllRanges(),e=document.createRange(),e.selectNodeContents(t),i.addRange(e));n.stopPropagation();n.preventDefault();this._flyout.show(this._appRoot,"top","left");var c=f.frameElement,r=n.clientX,u=n.clientY;c&&(o=c.getBoundingClientRect(),r=n.clientX+o.left,u=n.clientY+o.top);var l=document.body,a=l.offsetWidth,v=l.offsetHeight,s=this._flyoutDiv,y=s.offsetWidth,p=s.offsetHeight;r>a-y&&(r=a-y-10);u>v-p&&(u=v-p-10);h=s.style;h.left=r.toString()+"px";h.top=u.toString()+"px";this._selectedElement=t;Mail.writeProfilerMark("BodyLinkFlyout.onContextMenu",Mail.LogEvent.stop)}}}})