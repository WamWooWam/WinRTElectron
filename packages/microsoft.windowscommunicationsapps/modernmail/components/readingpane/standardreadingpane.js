Jx.delayDefine(Mail,"StandardReadingPane",function(){"use strict";function n(n){Jx.mark("StandardReadingPane:"+n)}function t(n){Jx.mark("StandardReadingPane."+n+",StartTA,Mail,StandardReadingPane")}function i(n){Jx.mark("StandardReadingPane."+n+",StopTA,Mail,StandardReadingPane")}Mail.StandardReadingPane=function(n,r,u,f){t("ctor");this._name="Mail.StandardReadingPane";t("ctor_InitComp");this.initComponent();i("ctor_InitComp");this._applicationView=null;this._onNewSelectedMessageAsyncJob=null;this._messagesChangedHandler=this._onMessagesChangedBeforeViewChange;this._disposer=null;this._readingPane=new Mail.CompReadingPane(n,r,u,f);this._selection=r;this._glomManager=u;this.append(this._readingPane);i("ctor")};Jx.augment(Mail.StandardReadingPane,Jx.Component);Mail.StandardReadingPane.prototype.getUI=function(n){t("getUI");n.html=Jx.getUI(this._readingPane).html;i("getUI")};Mail.StandardReadingPane.prototype.activateUI=function(){t("activateUI");Jx.Component.prototype.activateUI.call(this);var n=this._selection;this._disposer=new Mail.Disposer(new Mail.EventHook(n,"navChanged",this._onNavChanged,this),new Mail.EventHook(n,"messagesChanged",this._onMessagesChanged,this));this._applicationView=Windows.UI.ViewManagement.ApplicationView.getForCurrentView();Jx.glomManager.getIsParent()&&this._disposer.addMany(new Mail.EventHook(Jx.glomManager,Jx.GlomManager.Events.glomCreated,this._onGlomCreated,this),new Mail.EventHook(this._glomManager,"releasingMessage",this._onReleasingMessage,this),Mail.EventHook.createGlobalHook("composeVisibilityChanged",function(){var n=this._selection.message;n&&!n.isDraft&&this._readingPane.showPane(true)},this));this._onNewSelectedMessageSynchronous();i("activateUI")};Mail.StandardReadingPane.prototype.deactivateUI=function(){t("deactivateUI");Jx.Component.deactivateUI.call(this);Jx.dispose(this._disposer);this._disposer=null;this._onNewSelectedMessageAsyncJob=null;this._applicationView=null;i("deactivateUI")};Mail.StandardReadingPane.prototype._onNavChanged=function(t){!t.accountChanged&&t.viewChanged?(n("_onNavChanged - only view changed - using one-off handler"),this._messagesChangedHandler=this._onMessagesChangedAfterViewChange):n("_onNavChanged - account and view changed / view did not change")};Mail.StandardReadingPane.prototype._onMessagesChanged=function(n){t("_onMessagesChanged");this._messagesChangedHandler(n);i("_onMessagesChanged")};Mail.StandardReadingPane.prototype._onMessagesChangedBeforeViewChange=function(t){t.messageChanged?(n("_onMessagesChangedBeforeViewChange - message changed"),this._onNewSelectedMessage(t.keyboard)):n("_onMessagesChangedBeforeViewChange - message did not change")};Mail.StandardReadingPane.prototype._onMessagesChangedAfterViewChange=function(t){t.messageChanged?(n("_onMessagesChangedAfterViewChange - message changed"),this._onNewSelectedMessage(t.keyboard)):(n("_onMessagesChangedAfterViewChange - message did not change"),Jx.EventManager.fireDirect(null,"readingPaneHeaderLoaded"),Jx.EventManager.fireDirect(null,"readingPaneBodyLoaded"));n("_onMessagesChangedAfterViewChange - restoring original handler");this._messagesChangedHandler=this._onMessagesChangedBeforeViewChange};Mail.StandardReadingPane.prototype._onNewSelectedMessage=function(r){t("_onNewSelectedMessage");var u=null;r&&Jx.isObject(this._selection.message)?(n("_onNewSelectedMessage - setting timeout"),u=Jx.scheduler.addTimerJob(null,Mail.Priority.readingPaneNewSelectedMessage,null,250,this._onNewSelectedMessageSynchronous,this)):(n("_onNewSelectedMessage - scheduling a job"),u=Jx.scheduler.addJob(null,Mail.Priority.readingPaneNewSelectedMessage,null,this._onNewSelectedMessageSynchronous,this));this._onNewSelectedMessageAsyncJob=this._disposer.replace(this._onNewSelectedMessageAsyncJob,u);i("_onNewSelectedMessage")};Mail.StandardReadingPane.prototype._onNewSelectedMessageSynchronous=function(){var r,n,u,f;if(t("_onNewSelectedMessageSynchronous"),r=Mail.Utilities.ComposeHelper,n=null,!r.isComposeLaunching)if(n=this._selection.message,n&&n.isDraft&&!Mail.GlomManager.messageOpenInAnotherWindow(n))this._openCompose(n);else{r.isComposeShowing&&r.hideCurrent();document.getElementById("idCompCompose").classList.add("invisible");this._readingPane.onNewSelectedMessageSynchronous(n);this._readingPane.showPane(true)}u=true;n&&(u=n.irmCanExtractContent);f=this._applicationView;f.isScreenCaptureEnabled!==u&&(f.isScreenCaptureEnabled=u);i("_onNewSelectedMessageSynchronous")};Mail.StandardReadingPane.prototype._openCompose=function(t,i){n("_openCompose");this._readingPane.showPane(false);Mail.Utilities.ComposeHelper.onEdit(t,i)};Mail.StandardReadingPane.prototype._onGlomCreated=function(t){n("_onGlomCreated");var i=this._selection.message,r=t.glom.getGlomId();i&&i.objectId===r&&i.isDraft&&this._onNewSelectedMessageSynchronous()};Mail.StandardReadingPane.prototype._onReleasingMessage=function(r){var e,o;t("_onReleasingMessage");var s=this._selection,u=s.message,h=r.context,f=h.messageId;u&&u.objectId===f&&u.isDraft&&(e=Mail.Globals.platform.mailManager,o=e.waitForInstanceNumberOnMessage(f,h.instanceNumber),o&&(n("_onReleasingMessage - start waiting for instance number"),o.done(function(){n("_onReleasingMessage - got instance number");var t=e.loadMessage(f);this._openCompose(new Mail.UIDataModel.MailMessage(t,s.account),true)}.bind(this))));i("_onReleasingMessage")}})