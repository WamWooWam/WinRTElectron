Jx.delayDefine(Mail,"ReadingPaneSubjectArea",function(){"use strict";Mail.ReadingPaneSubjectArea=function(n){this._message=null;this._messageHook=null;this._isCopyNested=false;this._selection=n;this._disposer=null;this._host=null;this._subjectElement=null;this._flagElement=null};Mail.ReadingPaneSubjectArea.prototype.initialize=function(n){this._host=n;this._host.innerHTML="<div class='mailReadingPaneSubject'><\/div><div class='mailReadingPaneFlagGlyph' role='button' tabindex='-1'><span aria-hidden='true'>&#xE129;<\/span><\/div>";this._subjectElement=this._host.querySelector(".mailReadingPaneSubject");this._flagElement=this._host.querySelector(".mailReadingPaneFlagGlyph");this._disposer=new Mail.Disposer;this._disposer.addMany(new Mail.EventHook(this._host,"copy",this._onHostCopy,this,true),new Mail.EventHook(this._flagElement,"click",this._onFlagGlyphClick,this),new Mail.EventHook(this._flagElement,"mouseout",this._onFlagGlyphMouseOut,this))};Mail.ReadingPaneSubjectArea.prototype._onHostCopy=function(n){if(!this._isCopyNested){Mail.writeProfilerMark("ReadingPaneSubjectArea._onHostCopy",Mail.LogEvent.start);this._isCopyNested=true;document.execCommand("Copy");this._isCopyNested=false;var i=null,t=Windows.ApplicationModel.DataTransfer;try{i=t.Clipboard.getContent()}catch(r){Jx.log.exception("Copy failed",r);Mail.writeProfilerMark("ReadingPaneSubjectArea._onHostCopy",Mail.LogEvent.stop);return}i.contains(t.StandardDataFormats.html)&&i.getHtmlFormatAsync().then(function(n){var i,r;n=t.HtmlFormatHelper.getStaticFragment(n);i=new t.DataPackage;i.properties.applicationName=window.location.href;i.setHtmlFormat(t.HtmlFormatHelper.createHtmlFormat(n));r=document.createElement("div");r.innerHTML=toStaticHTML(n);i.setText(r.innerText.replace(/\r\n\r\n/g,"\r\n"));try{t.Clipboard.setContent(i)}catch(u){Jx.log.exception("Copy failed",u);Mail.writeProfilerMark("ReadingPaneSubjectArea._onHostCopy",Mail.LogEvent.stop)}}).done(null,function(){});n.preventDefault();Mail.writeProfilerMark("ReadingPaneSubjectArea._onHostCopy",Mail.LogEvent.stop)}};Mail.ReadingPaneSubjectArea.prototype._onFlagGlyphClick=function(){var t=this._message,n=Mail.Instrumentation,i=t.flagged?n.Commands.unflag:n.Commands.flag;this._selection.setFlagState(!t.flagged,[t]);this._flagElement.classList.add("pressed");n.instrumentTriageCommand(i,n.UIEntryPoint.onCanvas,this._selection)};Mail.ReadingPaneSubjectArea.prototype._onFlagGlyphMouseOut=function(){this._flagElement.classList.remove("pressed")};Mail.ReadingPaneSubjectArea.prototype.dispose=function(){Jx.dispose(this._disposer)};Mail.ReadingPaneSubjectArea.prototype.setMessage=function(n){Mail.writeProfilerMark("ReadingPaneSubjectArea.setMessage",Mail.LogEvent.start);this._message=n;var t=null;n&&(t=new Mail.EventHook(n,"changed",this._messageChanged,this),this._update(),this._host.classList.remove("hidden"));this._messageHook=this._disposer.replace(this._messageHook,t);Mail.writeProfilerMark("ReadingPaneSubjectArea.setMessage",Mail.LogEvent.stop)};Mail.ReadingPaneSubjectArea.prototype._messageChanged=function(n){var t=Mail.Validators;t.hasPropertyChanged(n,"subject")&&this._updateSubject();t.hasPropertyChanged(n,"flagged")&&this._updateFlagGlyph()};Mail.ReadingPaneSubjectArea.prototype._update=function(){this._updateSubject();this._updateFlagGlyph()};Mail.ReadingPaneSubjectArea.prototype._updateSubject=function(){var n=this._message,t=this._subjectElement;Mail.applyDirection(t,n.subject);t.innerHTML=this._getDraftPrefix()+n.subjectHTML;Jx.setClass(t,"unread",!n.read);Mail.setAttribute(t,"aria-label",n.subject);Jx.setClass(t,"mailReadingPaneSubjectSelection",n.irmCanExtractContent)};Mail.ReadingPaneSubjectArea.prototype._updateFlagGlyph=function(){var u=this._message,n=this._flagElement,f=u.canFlag,t=u.flagged,i=null,r;f?(n.removeAttribute("disabled"),n.classList.remove("hidden"),i=t?"mailReadingPaneUnflagTooltip":"mailReadingPaneFlagTooltip"):(Mail.setAttribute(n,"disabled","disabled"),t||n.classList.add("hidden"),i="mailReadingPaneFlaggedTooltip");Jx.setClass(n,"flagged",t);r=Jx.res.getString(i);Mail.setAttribute(n,"title",r);Mail.setAttribute(n,"aria-label",r)};Mail.ReadingPaneSubjectArea.prototype._getDraftPrefix=function(){return this._message.isDraft?"<span aria-hidden='true' class='hideOnReload mailReadingPaneSubjectDraftPrefix typeSize16pt'>"+Jx.escapeHtml(Jx.res.getString("mailMessageListDraftPrefix"))+"<\/span>":""}})