Jx.delayDefine(Mail,"ViewItems",function(){"use strict";function n(n,t){if(this.initComponent(),this._switcher=n,this._view=t,this._activated=false,this._selected=false,t){var i=this._count=new y.ViewCount(t);this.appendChild(i)}}function h(t,i,r){n.call(this,t,i);this._className=r}function a(t,i){n.call(this,t,i);var r=this._name=new y.ViewName(i);this.appendChild(r)}function o(t,i,r,u,f){this._className=i;this._title=r;this._flyout=u;this._viewTypes=f;n.call(this,t)}function u(t,i){n.call(this,t,i);var r=this._name=new y.ViewName(i);this.appendChild(r)}function s(n,t){u.call(this,n,t);var r=t.platform.mailManager,i=this._stuck=new Mail.CollectionCounter(new Mail.ScheduledQueryCollection(r.getPermanentlyFailedMessageCollection,r,[t.account.objectId],Mail.Priority.updateView,Jx.scheduler,"stuck-in-outbox"));i.unlock();this._disposer=new Mail.Disposer(i,new Mail.EventHook(i,"collectionchanged",this._onCollectionChanged,this))}function t(t,i,r,u,f,e){var o,s;n.call(this,t,r);this._className=f;this._title=e;o=this._settingName=f+"Collapsed";this._userExpanded=!this._switcher.getSettings().get(o);this._collection=u;u.unlock();s=this._list=new Jx.List({role:null,factory:l.create.bind(null,t,i,false),requestAnimation:this._requestAnimation.bind(this)});this._list.setSource(this._collection);this.appendChild(s);this._hooks=null;this._isExpanded()||this._list.disableAnimations();this._animation=null}function w(n){return n?"":""}function c(t){n.call(this,t)}function e(n,r,u){var f=new Mail.ConcatenatedCollection([i.sortPeople(i.filterByType(n.getViewCollection(),i.people,i.topLevel),r),new Mail.ArrayCollection([{objectType:"MorePeople",objectId:"MorePeople"}])]);this._account=u.account;t.call(this,n,r,u,f,"favorites","mailViewsFavorites")}function v(n,u,f){var e=new Mail.ConcatenatedCollection([i.topLevelSort(i.filterByType(n.getViewCollection(),i.categories)),i.sortFolders(i.filterByType(n.getViewCollection(),i.folders,[r.inbox])),new Mail.ArrayCollection([{objectType:"MoreFolders",objectId:"MoreFolders"}])]);t.call(this,n,u,f,e,"inbox","mailFolderNameInbox")}function p(n){return Jx.isRtl()&&(n=n==="Left"?"Right":"Left"),n}function k(n){Jx.mark("Mail.ViewItems."+n+",StartTM,Mail")}function d(n){Jx.mark("Mail.ViewItems."+n+",StopTM,Mail")}var b=Microsoft.WindowsLive.Platform,r=b.MailViewType,f=Mail.UIDataModel.MailView,i=Mail.ViewFilters,y=Mail.BoundElements,l=Mail.ViewItems={create:function(n,t,f,l){var y=null;if(l)switch(l.objectType){case"MailView":switch(l.type){case r.inbox:y=new v(n,t,l);break;case r.flagged:y=new h(n,l,"flagged");break;case r.newsletter:y=f?new h(n,l,"newsletter"):new u(n,l);break;case r.social:y=f?new h(n,l,"social"):new u(n,l);break;case r.allPinnedPeople:y=new e(n,t,l);break;case r.person:y=new a(n,l);break;case r.outbox:y=new s(n,l);break;default:y=new u(n,l)}break;case"FoldersIcon":y=new c(n,t);break;case"MorePeople":y=new o(n,"morePeople","mailViewsMorePeople","people",i.people);break;case"MoreFolders":y=new o(n,"moreFolders","mailViewsMoreFolders","folders",i.folders.concat(i.categories))}return y}};l.getLabel=function(n,t){var i=n.notificationCount,u=i===1?"mailFolderListAriaTemplateSingular":"mailFolderListAriaTemplatePlural";return[r.draft,r.outbox,r.flagged].indexOf(n.type)!==-1&&(u=i===1?"mailFolderListOutboxDraftAriaTemplateSingular":"mailFolderListOutboxDraftAriaTemplatePlural"),Jx.res.loadCompoundString(u,n.name,i,t||"")};Jx.augment(n,Jx.Component);n.prototype._getClassName=function(n){var t=this._view;return n+" item"+(this._selected?" selected":"")+(t?Mail.ViewCapabilities.canMoveTo(t)?" draghoverable":" inhibitDrop":"")};n.prototype.activateUI=function(){Jx.Component.prototype.activateUI.call(this);this._activated=true};n.prototype._getComponentElement=function(){return document.getElementById(this._id)};n.prototype._getActiveElement=function(){return this._getComponentElement()};n.prototype._getElement=function(n){var t=this._getComponentElement();return t&&t.querySelector(n)};n.prototype.setSelected=function(n){var t=null;return this._selected=n,this._activated&&(t=this._getActiveElement(),t&&(Jx.setClass(t,"selected",n),Mail.setAttribute(t,"aria-selected",n?"true":"false"))),t};n.prototype._onInvoke=function(n){n.type==="contextmenu"&&this._selected||this._switcher.selectView(this._view)};n.prototype.onClick=function(n){Mail.isElementOrDescendant(n.target,this._getActiveElement())&&this._onInvoke(n)};n.prototype.onKeyDown=function(n){var t=n.key;(t==="Spacebar"||t==="Enter")&&(this._onInvoke(n),n.stopPropagation(),n.preventDefault())};n.prototype.onAttributeChange=function(n){if(n.attributeName==="aria-selected"){var t=this._getActiveElement(),i=t.getAttribute("aria-selected")==="true";i!==this._selected&&(i?this._onInvoke(n):Mail.setAttribute(t,"aria-selected","true"))}};n.prototype.onDrop=function(n){var i=this._view,t;i&&(t=n.detail,Mail.moveWithConfirmation(t.selection,i,t.messages))};n.prototype.offerSelection=function(n,t){return t&&f.areEqual(t,this._view)?this:null};n.prototype.updateLabel=function(){Mail.setAttribute(this._getActiveElement(),"aria-label",this._getLabel())};n.prototype._getLabel=function(){return this._view?l.getLabel(this._view):""};n.prototype._getAttributes=function(n,t){var i=this._getLabel();return" class='"+this._getClassName(n)+"'"+(i?" aria-label='"+Jx.escapeHtml(i)+"'":"")+(t?" title='"+Jx.escapeHtml(t)+"'":"")+" aria-selected='"+(this._selected?"true":"false")+"' role='option' tabIndex='-1'"};Jx.inherit(h,n);h.prototype.getUI=function(n){n.html="<div id='"+this._id+"'"+this._getAttributes(this._className,this._view.name)+"><div class='content'><div class='icon icon-"+this._className+"'><\/div>"+Jx.getUI(this._count).html+"<\/div><\/div>"};Jx.inherit(a,n);a.prototype.getUI=function(n){n.html="<div id='"+this._id+"'"+this._getAttributes("person",this._view.name)+"><div class='content'>"+Jx.getUI(this._name).html+Jx.getUI(this._count).html+"<\/div><\/div>"};a.prototype.updateLabel=function(){n.prototype.updateLabel.call(this);Mail.setAttribute(this._getActiveElement(),"title",this._view.name)};Jx.inherit(o,n);o.prototype.getUI=function(n){var t=Jx.res.getString(this._title);n.html="<div id='"+this._id+"'"+this._getAttributes(this._className+" inhibitDrop",t)+"><div class='content'><div class='name'>"+Jx.escapeHtml(t)+"<\/div><\/div><\/div>"};o.prototype._onInvoke=function(n){n.type!=="contextmenu"&&this._switcher.getFlyout(this._flyout).show({viaKeyboard:n.type==="keydown"})};o.prototype.offerSelection=function(n){return this._viewTypes.indexOf(n)!==-1?this:null};Jx.inherit(u,n);u.prototype.getUI=function(n){n.html="<div id='"+this._id+"'"+this._getAttributes("folder",this._view.name)+"><div class='content'>"+Jx.getUI(this._name).html+Jx.getUI(this._count).html+"<\/div><\/div>"};u.prototype.updateLabel=function(){n.prototype.updateLabel.call(this);Mail.setAttribute(this._getActiveElement(),"title",this._view.name)};Jx.inherit(s,u);s.prototype.shutdownComponent=function(){Jx.dispose(this._disposer);u.prototype.shutdownComponent.call(this)};s.prototype._getLabel=function(){var n=this._stuck.count>0?Jx.res.getString("mailAttentionNeeded"):"";return l.getLabel(this._view,n)};s.prototype._getClassName=function(n){return u.prototype._getClassName.call(this,n)+(this._stuck.count>0?" error":"")};s.prototype._onCollectionChanged=function(){Jx.setClass(this._getComponentElement(),"error",this._stuck.count>0);this.updateLabel()};Jx.inherit(t,n);t.prototype._canExpand=function(){return this._switcher.isWide};t.prototype._isExpanded=function(){return this._canExpand()&&this._userExpanded};t.prototype.getUI=function(n){var i=this._canExpand(),t=this._isExpanded(),r="";i&&(r=" aria-expanded='"+t+"'");n.html="<div id='"+this._id+"' class='group'><div"+this._getAttributes(this._className)+r+"><div class='chevron"+(i?"":" hidden")+"' title='"+Jx.escapeHtml(this._getChevronLabel(t))+"'>"+Jx.escapeHtml(w(t))+"<\/div><div class='content' title='"+Jx.escapeHtml(Jx.res.getString(this._title))+"'><div class='icon icon-"+this._className+"'><\/div>"+Jx.getUI(this._count).html+"<\/div><\/div><div class='children"+(t?"":" collapsed-wide")+"'>"+Jx.getUI(this._list).html+"<\/div><\/div>"};t.prototype.activateUI=function(){n.prototype.activateUI.call(this);var t=this._switcher;this._hooks=new Mail.Disposer(new Mail.EventHook(t,"widthChanged",this._onWidthChanged,this))};t.prototype.deactivateUI=function(){var t=this._animation;t&&t.cancel();n.prototype.deactivateUI.call(this);Jx.dispose(this._hooks)};t.prototype.shutdownComponent=function(){n.prototype.shutdownComponent.call(this);Jx.dispose(this._collection)};t.prototype._getActiveElement=function(){return this._getElement("."+this._className)};t.prototype.onClick=function(t){var i=this._list.getTarget(t);if(i)i.onClick(t);else t.target.classList.contains("chevron")?this._setExpanded(!this._isExpanded()):n.prototype.onClick.call(this,t)};t.prototype.onKeyDown=function(t){var i=t.key,u,r,f,e;if(i==="Left"||i==="Right"){if(this._canExpand()&&Mail.isElementOrDescendant(t.target,this._getActiveElement())&&(u=i===p("Right"),u!==this._isExpanded())){this._setExpanded(u);t.stopPropagation();t.preventDefault();return}f=this._getActiveElement();f.tabIndex===0?i===p("Right")&&(r=this._list.getElement(0)):i===p("Left")&&(r=f);r&&(r.tabIndex=0,r.focus());t.stopPropagation();t.preventDefault()}else if(e=this._list.getTarget(t),e)e.onKeyDown(t);else n.prototype.onKeyDown.call(this,t)};t.prototype.onDrop=function(t){var i=this._list.getTarget(t);if(i){i.onDrop(t);return i}return n.prototype.onDrop.call(this,t),this};t.prototype.offerSelection=function(t,i){var r,e,u,o;if(r=n.prototype.offerSelection.call(this,t,i),!r){for(e=this._list,u=0,o=e.getChildrenCount();u<o;++u)if(r=e.getChild(u).offerSelection(t,i),r)break;r&&!this._isExpanded()&&(r=this)}return r};t.prototype._requestAnimation=function(){return this._switcher.requestAnimation(this).then(function(n){return n.concat(this._getActiveElement())}.bind(this))};t.prototype.onAttributeChange=function(t){var f=this._getActiveElement(),i,r,u;if(t.target===f&&t.attributeName==="aria-expanded")this._canExpand()&&(i=f.getAttribute("aria-expanded"),Jx.isNonEmptyString(i)&&(r=i==="true",this._userExpanded!==r&&this._setExpanded(r)));else if(u=this._list.getTarget(t),u)u.onAttributeChange(t);else n.prototype.onAttributeChange.call(this,t)};t.prototype._setExpanded=function(n){this._userExpanded=n;this._switcher.getSettings().set(this._settingName,!n);this._expandCollapse()};t.prototype._expandCollapse=function(){var u=this._canExpand(),t=this._isExpanded(),i=this._getActiveElement(),n,f,r;u?Mail.setAttribute(i,"aria-expanded",String(t)):i.removeAttribute("aria-expanded");n=i.querySelector(".chevron");Jx.setClass(n,"hidden",!u);n.innerText=w(t);Mail.setAttribute(n,"title",this._getChevronLabel(t));this._animation||(f=this._animation=this._switcher.requestAnimation(this).then(this._runAnimation.bind(this)),r=function(){this._animation=null}.bind(this),f.done(r,r))};t.prototype._runAnimation=function(n){var u;if(!this._switcher.isWide)return null;var i=this._getElement(".children"),t=i.classList,f=!t.contains("collapsed-wide"),r=this._isExpanded();if(f!==r)return r?(u=WinJS.UI.Animation.createExpandAnimation(i,n),t.remove("collapsed-wide"),this._list.enableAnimations()):(u=WinJS.UI.Animation.createCollapseAnimation(i,n),t.add("collapsing")),this.fire("contentUpdated"),k("BaseGroup._runAnimation"),Jx.Promise.cancelable(u.execute()).then(function(){return r||(t.add("collapsed-wide"),t.remove("collapsing"),this.fire("contentUpdated"),this._list.disableAnimations()),d("BaseGroup._runAnimation"),this._runAnimation(n)}.bind(this))};t.prototype.waitForAnimation=function(){return WinJS.Promise.join([this._list.waitForAnimation(),Jx.Promise.fork(this._animation)])};t.prototype._onWidthChanged=function(){Jx.setClass(this._getElement(".children"),"collapsed-skinny",!this._switcher.isWide);this.fire("contentUpdated");this._expandCollapse()};Jx.inherit(c,n);c.prototype.getUI=function(n){n.html="<div id='"+this._id+"'"+this._getAttributes("folders",Jx.res.getString("mailViewsFolders"))+"><div class='content'><div class='icon icon-folders'><\/div><\/div><\/div>"};c.prototype._onInvoke=function(n){n.type!=="contextmenu"&&this._switcher.getFlyout("folders").show({viaKeyboard:n.type==="keydown"})};c.prototype.offerSelection=function(n){return i.folders.indexOf(n)!==-1||i.categories.indexOf(n)!==-1?this:null};Jx.inherit(e,t);e.prototype.activateUI=function(){t.prototype.activateUI.call(this);this._hooks.addMany(new Mail.EventHook(this._collection,"collectionchanged",this._onCollectionChange,this),new Mail.EventHook(this._account,"changed",this._onAccountChange,this))};e.prototype._canExpand=function(){return t.prototype._canExpand.call(this)&&this._collection.count>1&&this._account.peopleViewComplete};e.prototype._requestAnimation=function(){return this._expandCollapse(),t.prototype._requestAnimation.call(this)};e.prototype._onCollectionChange=function(){this._expandCollapse()};e.prototype._onAccountChange=function(n){Mail.Validators.hasPropertyChanged(n,"peopleViewComplete")&&this._expandCollapse()};e.prototype._onInvoke=function(n){this._canExpand()||!this._view.account.peopleViewComplete?t.prototype._onInvoke.call(this,n):n.type!=="contextmenu"&&this._switcher.getFlyout("people").show({viaKeyboard:n.type==="keydown"})};e.prototype._getChevronLabel=function(n){return Jx.res.getString(n?"mailViewsFavoritesChevronCollapse":"mailViewsFavoritesChevronExpand")};Jx.inherit(v,t);v.prototype.offerSelection=function(i,r){return this._switcher.isWide?t.prototype.offerSelection.call(this,i,r):n.prototype.offerSelection.call(this,i,r)};v.prototype._getChevronLabel=function(n){return Jx.res.getString(n?"mailViewsInboxChevronCollapse":"mailViewsInboxChevronExpand")}})