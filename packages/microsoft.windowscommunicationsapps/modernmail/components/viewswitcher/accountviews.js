Jx.delayDefine(Mail,"AccountViews",function(){"use strict";function u(n){Jx.mark("Mail.AccountViews."+n+",StartTA,Mail")}function f(n){Jx.mark("Mail.AccountViews."+n+",StopTA,Mail")}var i=Microsoft.WindowsLive.Platform,r=Mail.ViewFilters,t=[{name:"people",viewType:i.MailViewType.person},{name:"folders",viewType:i.MailViewType.userGeneratedFolder}],e=".collapsed-wide .item, .collapsed-skinny .item, .collapsing .item",o=Mail.AccountViews=function(n,o,s,h){var l,c,a,v;u("ctor");this.initComponent();this._switcher=o;this._settings=s;l=this._allViews=n.queryViews(i.MailViewScenario.navPane,"navPane");c=this._views=r.topLevelSort(new Mail.ConcatenatedCollection([r.filterByType(l,r.topLevel),new Mail.ArrayCollection([{objectType:"FoldersIcon",objectId:"FoldersIcon"}])]));c.unlock();a=this._list=new Jx.List({role:null,factory:Mail.ViewItems.create.bind(null,this,n.platform,true),requestAnimation:this.requestAnimation.bind(this,null)});a.setSource(c);v=this._ariaFlows=new Mail.AriaFlows(a,e);this.appendChild(v);this._flyouts=t.map(function(t){return new Mail.ViewFlyout(this,n,t.name,h)},this);this._disposer=new Mail.Disposer(c,l,this._flyouts);this._selectedChild=null;this._selectedView=null;this._hooks=null;this._element=null;this._dragListener=null;f("ctor")},n;Jx.augment(o,Jx.Component);n=o.prototype;n.getUI=function(n){n.html="<div id='"+this._id+"' class='accountViews' role='listbox'><div class='inhibitTouchHover'><\/div>"+Jx.getUI(this._ariaFlows).html+"<\/div>"};n.activateUI=function(){Jx.Component.prototype.activateUI.call(this);var n=this._element=document.getElementById(this._id);this._hooks=new Mail.Disposer(new Jx.PressEffect(n,".item, .chevron, .content",["className"],".inhibitTouchHover"),new Mail.EventHook(n,"click",this._onClick,this),new Mail.EventHook(n,"contextmenu",this._onClick,this),new Mail.EventHook(n,"MSHoldVisual",function(n){n.preventDefault()}),new Mail.EventHook(n,"keydown",this._onKeyDown,this),new Mail.EventHook(n,"maildragenter",this._onDragEnter,this),new Mail.EventHook(n,"maildrop",this._onDrop,this),new Jx.KeyboardNavigation(n,"vertical",this,e),new Mail.Disposable(Jx.observeMutation(n,{attributes:true,subtree:true,attributeFilter:["aria-selected","aria-expanded"]},this._onAttributeChange,this),"disconnect"));this._flyouts.forEach(function(n){this._hooks.addMany(new Mail.EventHook(n,"beforeShow",this._updateSelection,this),new Mail.EventHook(n,"afterHide",this._updateSelection,this))},this);this.on("contentUpdated",this._updateSelection,this);this._updateSelection()};n._onClick=function(n){var t=this._list.getTarget(n);if(t)t.onClick(n)};n._onAttributeChange=function(n){n.forEach(function(n){var t=this._list.getTarget(n);if(t)t.onAttributeChange(n)},this)};n._onKeyDown=function(n){var t=this._list.getTarget(n);if(t)t.onKeyDown(n)};n._onDragEnter=function(n){this._dragListener||(this.getFlyout("folders").show({sticky:true,abovePeekBar:true}),this._dragListener=new Mail.EventHook(n.detail.dragElement,"dragend",this._onDragEnd,this))};n._onDragEnd=function(){Jx.dispose(this._dragListener);this._dragListener=null;this.getFlyout("folders").hide()};n._onDrop=function(n){var t=this._list.getTarget(n);if(t)t.onDrop(n)};n.deactivateUI=function(){Jx.Component.prototype.deactivateUI.call(this);Jx.dispose(this._disposer);Jx.dispose(this._hooks);this.detach("contentUpdated",this._updateSelection,this)};n.selectView=function(n){this.onViewSelected(n);this._switcher.selectViewAsync(n)};n.onViewSelected=function(n){u("onViewSelected");this._flyouts.forEach(function(n){n.hide()});this._selectedView=n;this._updateSelection();this._selectedId!==n.objectId&&(this._selectedId=n.objectId,Jx.scheduler.addJob(null,Mail.Priority.reportTelemetryOnNavigation,"Mail telemetry reporting on navigation",Mail.Instrumentation.instrumentNavigation,null,[n]));f("onViewSelected")};n._updateSelection=function(){var r,e,i,n,h,o,l,c,s;if(u("updateSelection"),i=this._flyouts.reduce(function(n,i,r){return n||(i.isVisible?{flyout:i,type:t[r].viewType}:null)},null),i?e=i.type:(r=this._selectedView,r&&(e=r.type)),n=null,Jx.isDefined(e))for(h=this._list,o=0,l=h.getChildrenCount();o<l;++o)if(n=h.getChild(o).offerSelection(e,r),n)break;s=this._selectedChild;n!==s&&(s&&s.setSelected(false),n&&(c=n.setSelected(true)),this._selectedChild=n);i&&c&&i.flyout.setEntryPoint(c);f("updateSelection")};n.getFlyout=function(n){return this._flyouts.reduce(function(i,r,u){return i||(t[u].name===n?r:null)},null)};n.getViewCollection=function(){return this._allViews};n.getSettings=function(){return this._settings.container("viewSwitcher")};Object.defineProperty(n,"isWide",{get:function(){return this._switcher.isWide},enumerable:true});n.addListener=function(n,t,i){return this._switcher.addListener(n,t,i)};n.removeListener=function(n,t,i){return this._switcher.removeListener(n,t,i)};n.waitForAnimation=function(){return this._list.waitForAnimation()};n.requestAnimation=function(n){return this.waitForAnimation().then(function(){return this._list.getAffectedElements(n)}.bind(this))}})