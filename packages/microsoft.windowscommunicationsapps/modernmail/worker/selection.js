Jx.delayDefine(Mail.Worker,"Selection",function(){"use strict";function r(n){Jx.mark("Selection:"+n)}function n(n){Jx.mark("Selection."+n+",StartTA,Selection")}function t(n){Jx.mark("Selection."+n+",StopTA,Selection")}var i=Mail.Worker.Selection=function(i){n("ctor");this._platform=i;this._scores=[];this._conversationId=null;this._viewId=null;this._accountId=null;this._currentScrubber=null;this._disposer=new Mail.Disposer;t("ctor")};i.prototype={dispose:function(){this._disposer.dispose();this._scores=[]},onSelectionChanged:function(i){var f,u,h,s,e,c,o;u=i.message.newValue;h="onSelectionChanged-"+i.messageType;n(h);switch(i.messageType){case"accountChanged":Jx.isNonEmptyString(u)&&this._accountId!==u&&(f=this._accountId,this._accountId=u,this._updateProperty("accountId",f,u));break;case"viewChanged":Jx.isNonEmptyString(u)&&this._viewId!==u&&(f=this._viewId,this._viewId=u,this._updateViewProperty(f,u));break;case"messageChanged":Jx.isNonEmptyString(u)&&(this._currentScrubber&&(this._disposer.disposeNow(this._currentScrubber),this._currentScrubber=null),s=this._platform,e=s.mailManager.loadMessage(u),e&&!e.pendingRemoval&&(c=Mail.Account.load(e.accountId,s),this._currentScrubber=this._disposer.add(new Mail.Worker.AsyncMessageScrubber(s,new Mail.UIDataModel.MailMessage(e,c),null,null,Mail.Priority.workerCurrentSelectionScrubber)),o=e.parentConversationId,Jx.isNonEmptyString(o)||(o=null),this._conversationId!==o&&(f=this._conversationId,this._conversationId=o,this._updateProperty("parentConversationId",f,o))));break;default:r("onSelectionChanged: Unknown messageType: "+i.messageType)}t(h)},_updateProperty:function(n,t,i){this._scores.forEach(function(r){var u=r[n];u==i&&r.adjust(n,false);u==t&&r.adjust(n,true)})},_updateViewProperty:function(n,t){this._scores.forEach(function(i){Jx.isNonEmptyString(t)&&i.message.isInView(t)&&i.adjust("viewId",false);Jx.isNonEmptyString(n)&&i.message.isInView(n)&&i.adjust("viewId",true)})},get viewId(){return this._viewId},get accountId(){return this._accountId},get parentConversationId(){return this._conversationId},addScore:function(n){this._scores.push(n)},removeScore:function(n){var t=this._scores.indexOf(n);this._scores.splice(t,1)}}})