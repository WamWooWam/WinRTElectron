Jx.delayGroup("MailCompose",function(){Mail.FullscreenComposeUI=function(){Compose.Component.call(this)};Jx.augment(Mail.FullscreenComposeUI,Compose.Component);Compose.util.defineClassName(Mail.FullscreenComposeUI,"Mail.FullscreenComposeUI");var n=Mail.FullscreenComposeUI.prototype;Mail.FullscreenComposeUI.template=function(n,t,i,r,u,f,e){return'<div class="composeWindow"><div class="before-compose-tab-anchor compose-tab-anchor" aria-hidden="true" tabIndex="0"><\/div><div class="composeMainFrame"><div class="composeEmojiAnchor"><\/div><div class="composeButtonArea"><div class="compose-before-back-tab-anchor compose-tab-anchor" aria-hidden="true" tabIndex="0"><\/div>'+t.getFullHTML()+'<div class="compose-after-back-tab-anchor compose-tab-anchor" aria-hidden="true" tabIndex="0"><\/div><div class="composeFromArea"><div class="compose-before-from-tab-anchor compose-tab-anchor" aria-hidden="true" tabIndex="0"><\/div>'+Jx.getUI(e.getComponent("Compose.From")).html+'<div class="compose-after-from-tab-anchor compose-tab-anchor" aria-hidden="true" tabIndex="0"><\/div><\/div><div class="compose-before-new-tab-anchor compose-tab-anchor" aria-hidden="true" tabIndex="0"><\/div>'+i.getFullHTML()+r.getFullHTML()+f.getFullHTML()+u.getFullHTML()+'<div class="compose-after-delete-tab-anchor compose-tab-anchor" aria-hidden="true" tabIndex="0"><\/div><div class="composeSnapButtons"><div class="compose-before-backSnap-tab-anchor compose-tab-anchor" aria-hidden="true" tabIndex="0"><\/div>'+t.getSnapHTML()+'<div class="compose-after-backSnap-tab-anchor compose-tab-anchor" aria-hidden="true" tabIndex="0"><\/div><div class="compose-before-newSnap-tab-anchor compose-tab-anchor" aria-hidden="true" tabIndex="0"><\/div>'+i.getSnapHTML()+r.getSnapHTML()+f.getSnapHTML()+u.getSnapHTML()+'<div class="compose-after-deleteSnap-tab-anchor compose-tab-anchor" aria-hidden="true" tabIndex="0"><\/div><\/div><\/div><div class="composeContentScrollArea" aria-hidden="false"><div class="compose-before-readOnlyHeader-tab-anchor compose-tab-anchor" aria-hidden="true" tabIndex="0"><\/div>'+Jx.getUI(e.getComponent("Compose.ReadOnlyHeader")).html+'<div class="composeAddressFieldArea"><div class="compose-before-to-tab-anchor compose-tab-anchor" aria-hidden="true" tabIndex="0"><\/div><div class="compose-after-toccbcc-tab-anchor compose-tab-anchor" aria-hidden="true" tabIndex="5"><\/div>'+Jx.getUI(e.getComponent("Compose.ToCcBcc")).html+'<div class="compose-before-toccbcc-tab-anchor compose-tab-anchor" aria-hidden="true" tabIndex="1"><\/div><div class="compose-after-bcc-tab-anchor compose-tab-anchor" aria-hidden="true" tabIndex="0"><\/div><div class="composeExtraFieldArea"><div class="compose-before-priority-tab-anchor compose-tab-anchor" aria-hidden="true" tabIndex="0"><\/div>'+Jx.getUI(e.getComponent("Compose.Priority")).html+'<div class="compose-after-priority-tab-anchor compose-tab-anchor" aria-hidden="true" tabIndex="0"><\/div><div class="compose-before-irm-tab-anchor compose-tab-anchor" aria-hidden="true" tabIndex="0"><\/div>'+Jx.getUI(e.getComponent("Compose.IrmChooser")).html+'<div class="compose-after-irm-tab-anchor compose-tab-anchor" aria-hidden="true" tabIndex="0"><\/div><\/div><div class="compose-before-expand-tab-anchor compose-tab-anchor" aria-hidden="true" tabIndex="0"><\/div>'+Jx.getUI(e.getComponent("Mail.ExpandButton")).html+'<\/div><div class="composeContentArea"><div class="compose-to-subject-tab-anchor compose-tab-anchor" aria-hidden="true" tabIndex="0"><\/div><div class="compose-before-subject-tab-anchor compose-tab-anchor" aria-hidden="true" tabIndex="0"><\/div>'+Jx.getUI(e.getComponent("Compose.Subject")).html+'<div class="composeLineDividerParent"><div class="composeLineDivider"><\/div><\/div>'+Jx.getUI(e.getComponent("Compose.WarningMessage")).html+n.getAttachmentAreaHTML()+Jx.getUI(e.getComponent("Compose.BodyComponent")).html+"<\/div><\/div><\/div>"+n.getProgressBarHTML()+"<\/div>"};n.composeGetUI=function(n){Compose.log("getUI",Compose.LogEvent.start);var t=this.getComponentCache(),i=t.getComponent("Compose.AttachmentWell"),r=t.getComponent("Compose.BackButton"),u=t.getComponent("Compose.SendButton"),f=t.getComponent("Compose.AttachButton"),e=t.getComponent("Compose.DeleteButton"),o=t.getComponent("Compose.NewButton");n.html=Mail.FullscreenComposeUI.template(i,r,u,f,e,o,t);Compose.log("getUI",Compose.LogEvent.stop)}});Jx.delayGroup("MailCompose",function(){Mail.ValidationViewController=function(){};Jx.inherit(Mail.ValidationViewController,Jx.Events);var n=Mail.ValidationViewController.prototype;n.display=function(n){var i,r,t;if(i=null,n.length>1){for(r=["Compose.ToCcBcc","Compose.BodyComponent","Compose.AttachmentWell"],t=0;t<r.length;t++)if(n.indexOf(r[t])!==-1){i=[r[t]];break}}else i=n;this.raiseEvent("displayvalidstate",{invalidControls:i})}});Jx.delayGroup("MailCompose",function(){Mail.ComposeActionHandler=function(n){this._animator=n};Mail.ComposeActionHandler.instance=function(n){return new Mail.ComposeActionHandler(n)};var n=Mail.ComposeActionHandler.prototype;n.runAnimation=function(n){var t=WinJS.Promise.as(null),i=document.activeElement;return i&&i.blur(),Jx.isObject(this._animator)&&(t=this._animator.animateOut(n)),t};n.beforeAction=function(n,t){Compose.markAsync("closeCompose",Compose.LogEvent.start);var i=t.getComponent("Compose.AutoSaver");i&&i.clear()};n.afterAction=function(){var r=Mail.composeBuilder,i=r.getFullscreenComposeBuilder(),t,n;t=i.getCurrent();n=t.getMailMessageModel();n.isNew()&&n.isCommitted()&&!n.isSent()&&!t.isDirty()&&Jx.glomManager.getIsParent()&&!Jx.glomManager.isGlomOpen(n.get("objectId"))&&n.deletePlatformMessage();i.closeCurrent();Compose.markAsync("closeCompose",Compose.LogEvent.stop)};Mail.ComposeSaveActionHandler={instance:function(){return Mail.ComposeActionHandler.instance()}};Mail.ComposeSendActionHandler={instance:function(n){return Mail.ComposeActionHandler.instance(n)}};Mail.ComposeDiscardActionHandler={instance:function(n){return Mail.ComposeActionHandlerAggregator.instance([{beforeAction:function(n,t){var i=t.getComponent("Compose.AttachmentWell");Jx.isObject(i)&&i.discard()}},Mail.ComposeActionHandler.instance(n)])}}});Jx.delayGroup("MailCompose",function(){Mail.ComposeActionHandlerAggregator=function(n){this._actionHandlers=n};Mail.ComposeActionHandlerAggregator.instance=function(n){return new Mail.ComposeActionHandlerAggregator(n)};Mail.ComposeActionHandlerAggregator.prototype={beforeAction:function(n,t){return this._callHandlers("beforeAction",n,t)},afterAction:function(n,t){return this._callHandlers("afterAction",n,t)},runAnimation:function(n){var t=[];return this._actionHandlers.filter(function(n){return Jx.isFunction(n.runAnimation)}).forEach(function(i){t.push(i.runAnimation(n))}),WinJS.Promise.join(t)},_callHandlers:function(n,t,i){this._actionHandlers.filter(function(t){return Jx.isFunction(t[n])}).forEach(function(r){r[n](t,i)})}}});Jx.delayGroup("MailCompose",function(){Mail.ComposeAnimators=function(n,t){this._rootElement=n;this._closeCommand=t};var n=Mail.ComposeAnimators.prototype;n.animateOut=function(n){var u;Compose.log("animateOut",Compose.LogEvent.start);var i=this._closeCommand,t=document.getElementById("idCompCompose"),r=document.querySelector(".composeEmojiAnchor");return Mail.composeUtil.prepareForAnimation(n,t,r),Jx.bici.increment(i,1),u=n.getComponent("Compose.ComposeImpl"),new WinJS.Promise(function(n){var r=function(){Compose.mark("animateOut_done",Compose.LogEvent.start);n();Compose.mark("animateOut_done",Compose.LogEvent.stop)},s=function(n){Jx.log.error("Animation out failed during execution with error: "+n);r()},e,u,f;try{i===Microsoft.WindowsLive.Instrumentation.Ids.Mail.composeCommandSend?(u="composeExitUp",f="matrix(0.75, 0.0, 0.0, 0.75, 0, -500)"):(u="composeExitDown",f="matrix(0.75, 0.0, 0.0, 0.75, 0, 500)");t.style.msTransform=f;t.style.opacity="0";e=Compose.WinJsUI.executeAnimation(t,{property:"transform",delay:0,duration:532,timing:"linear",keyframe:u});e.done(r,s)}catch(o){Jx.log.error("Animation out failed with error: "+o);r()}Compose.log("animateOut",Compose.LogEvent.stop)})}});Jx.delayGroup("MailCompose",function(){Mail.BodyError=function(){Compose.Component.call(this);this._bindings=null;this._sendButton=null;this._canvasErrorFlyout=null};Jx.augment(Mail.BodyError,Compose.Component);Compose.util.defineClassName(Mail.BodyError,"Mail.BodyError");var n=Mail.BodyError.prototype;n.composeActivateUI=function(){var n=this.getComposeRootElement();this._sendButton=n.querySelector(".cmdSend");this._sendButtonSnap=n.querySelector(".cmdSendSnap");this._bindings=this.getComponentBinder().attach(this,[{on:"displayvalidstate",fromComponent:Compose.ComponentBinder.validationViewControllerClassName,then:this._displayValidState}])};n.composeDeactivateUI=function(){this.getComponentBinder().detach(this._bindings)};n._displayValidState=function(n){var i,t,r;n.invalidControls.indexOf("Compose.BodyComponent")!==-1&&(i=this._sendButton,i.style.display==="none"&&(i=this._sendButtonSnap),Jx.isNullOrUndefined(this._canvasErrorFlyout)&&(t=Compose.doc.createElement("div"),t.id="canvasErrorFlyout",t.className="compose-flyout",t.innerText=Jx.res.getString("composeCanvasError"),r=Compose.ComposeImpl.getComposeWindow(this.getComponentCache()),r.appendChild(t),this._canvasErrorFlyout=new Compose.WinJsUI.Flyout(t)),this._canvasErrorFlyout.show(i,"bottom","center"))}});Jx.delayGroup("MailCompose",function(){function r(n){var t=n.messageModel;return t||(t=Mail.getComposeMessageModelFactory().build(n.factorySpec)),t}var n,t,i;Mail.ComposeBuilder=function(){this._fullscreenComposeBuilder=null;this._currentComposeBuilder=null;this._validationViewController=null};Mail.ComposeBuilder.instance=function(){return new Mail.ComposeBuilder};n=Mail.ComposeBuilder.prototype;n.getCurrent=function(){var n=null,t=this._currentComposeBuilder;return Boolean(t)&&(n=this._currentComposeBuilder.getCurrent()),n};n.getFullscreenComposeBuilder=function(){return this._getFullscreenComposeBuilder()};n.hideFullscreenCompose=function(){this._getFullscreenRoot().classList.add("hidden")};n.unhideFullscreenCompose=function(){this._getFullscreenRoot().classList.remove("hidden")};n.createBackgroundCompose=function(){return this._buildFullscreen({components:this._getFullScreenComponents(),validationViewController:this._getValidationViewController(),mailMessageModel:Compose.MailMessageModel.stubInstance()})};n.createFullScreenCompose=function(n){n=n||{};this.unhideFullscreenCompose();var t=n.messageModel||r(n),i=this._buildFullscreen(this._augmentFullScreenSpec({mailMessageModel:t}));return this._currentComposeBuilder=this._fullscreenComposeBuilder,i};n.showCompose=function(n,t){var i=this._currentComposeBuilder.getCurrent();return this.unhideFullscreenCompose(),Mail.Utilities.ComposeHelper.setComposeShowing(true),this._runFullScreenEnterAnimation(i.getComponentCache(),n.factorySpec.initAction,n.factorySpec.moveFocus,t)};n.ensureFullscreenInDOM=function(n){this.ensureFullscreenInDOM=Jx.fnEmpty;var t=n.getComponentCache().getComponent("Mail.FullscreenComposeUI");this._getFullscreenRoot().innerHTML=Jx.getUI(t).html};n.getFullscreenRoot=function(){return this._getFullscreenRoot()};n._buildFullscreen=function(n){var t=this._getFullscreenComposeBuilder(),i=t.build(n);return this.ensureFullscreenInDOM(i),t.activateCurrent(),i};n._augmentFullScreenSpec=function(n){return n.components=this._getFullScreenComponents(),n.validationViewController=this._getValidationViewController(),n.actionHandlers=this._getFullScreenActionHandlers(Mail.getComposeActionHandlerFactory().build(n.mailMessageModel)),n};n._getBaseFullScreenActionHandlers=function(){var n=Microsoft.WindowsLive.Instrumentation.Ids.Mail,t=this._getFullscreenRoot(),i={save:Mail.ComposeSaveActionHandler.instance(),hideCurrent:Mail.ComposeSaveActionHandler.instance(),send:Mail.ComposeSendActionHandler.instance(new Mail.ComposeAnimators(t,n.composeCommandSend)),discard:Mail.ComposeDiscardActionHandler.instance(new Mail.ComposeAnimators(t,n.composeCommandDiscard))};return this._getBaseFullScreenActionHandlers=function(){return i},this._getBaseFullScreenActionHandlers()};t=function(n,t){return Boolean(t)?Mail.ComposeActionHandlerAggregator.instance([n,t]):n};i=function(n,i){return{save:t(n.save,i.save),send:t(n.send,i.send),discard:t(n.discard,i.discard)}};n._getFullScreenActionHandlers=function(n){return i(this._getBaseFullScreenActionHandlers(),n||{})};n._getFullScreenComponents=function(){var n=[Mail.FullscreenComposeUI,Compose.Subject,Compose.IrmChooser,Compose.HeaderController,Compose.ReadOnlyHeader,Compose.ToCcBcc,Compose.From,Compose.AttachmentWell,Compose.Priority,Compose.BodyComponent,Mail.ExpandButton,Compose.KeyboardResizer,Mail.KeyboardShortcutHandler,Compose.BackButton,Compose.DeleteButton,Compose.AttachButton,Compose.SendButton,Compose.NewButton,Compose.AutoSaver,Mail.BodyError,Compose.DOMFocus,Mail.ComposeSizeUpdater,Mail.IrmManager,Compose.WarningMessage,Compose.Selection,Mail.ComposeInstrumentation];return this._getFullScreenComponents=function(){return n},this._getFullScreenComponents()};n._getFullscreenRoot=function(){var n=Compose.doc.getElementById("idCompCompose");return this._getFullscreenRoot=function(){return n},this._getFullscreenRoot()};n._getFullscreenComposeBuilder=function(){var n=this._fullscreenComposeBuilder=Compose.ComposeBuilder.instance();return n.setRootElement(this._getFullscreenRoot()),this._getFullscreenComposeBuilder=function(){return this._fullscreenComposeBuilder},this._getFullscreenComposeBuilder()};n._getValidationViewController=function(){return this._validationViewController=new Mail.ValidationViewController,this._getValidationViewController=function(){return this._validationViewController},this._getValidationViewController()};n._runFullScreenEnterAnimation=function(n,t,i,r){var s,e;Compose.log("fullScreenAnimation",Compose.LogEvent.start);var u=document.getElementById("idCompCompose"),o=document.querySelector(".composeEmojiAnchor"),f=t!==Compose.ComposeAction.openDraft;return Mail.composeUtil.prepareForAnimation(n,u,o),u.style.msTransform="",u.style.opacity="",s=this,e=function(){var a;if(Jx.isObject(Compose.ComposeImpl.getComposeImpl(n))){if((f||i||Jx.glomManager.getIsChild())&&(Jx.glomManager.getIsChild()?Jx.scheduler.addJob(null,Mail.Priority.focusCompose,"initial focus of compose",Mail.composeUtil.setInitialFocus,null,[n,f?t:null,r]):Mail.composeUtil.setInitialFocus(n,f?t:null,r)),f){var v=s._currentComposeBuilder.getCurrent(),h=v.getMailMessageModel(),y=h.get("objectId"),e=Mail.Utilities.ComposeHelper._selection;if(!Jx.isNullOrUndefined(e.message)&&e.message.objectId!==y){var c=h.getPlatformMessage(),p=Mail.Account.load(c.accountId,Compose.platform),l=new Mail.UIDataModel.MailMessage(c,p);e.updateMessages(l,-1,[l])}}a=n.getComponent("Compose.ToCcBcc");a.onEntranceComplete();Mail.composeUtil.restoreFromAnimation(n,u,o)}Compose.log("fullScreenAnimation",Compose.LogEvent.stop)},f?WinJS.UI.Animation.enterContent(u).then(e):WinJS.Promise.as(e())};Mail.composeBuilder=Mail.ComposeBuilder.instance()});Jx.delayGroup("MailCompose",function(){Mail.ComposeUtil=function(){};Mail.ComposeUtil.ptScenarioToString={};Mail.ComposeUtil.ptScenarioToString[Compose.ComposeAction.createNew]="Compose-NewMail";Mail.ComposeUtil.ptScenarioToString[Compose.ComposeAction.reply]="Compose-Reply";Mail.ComposeUtil.ptScenarioToString[Compose.ComposeAction.replyAll]="Compose-ReplyAll";Mail.ComposeUtil.ptScenarioToString[Compose.ComposeAction.forward]="Compose-Forward";Mail.ComposeUtil.prototype={prepareForAnimation:function(n,t,i){Compose.mark("prepareForAnimation",Compose.LogEvent.start);t.style.position="absolute";i.style.position="";var r=n.getComponent("Compose.BodyComponent"),u=n.getComponent("Compose.Subject");r.prepareForAnimation();u.pauseScrollingIntoView();Compose.mark("prepareForAnimation",Compose.LogEvent.stop)},restoreFromAnimation:function(n,t,i){Compose.mark("restoreFromAnimation",Compose.LogEvent.start);t.style.position="";i.style.position="-ms-device-fixed";var r=n.getComponent("Compose.BodyComponent"),u=n.getComponent("Compose.Subject");r.restoreFromAnimation();u.resumeScrollingIntoView();Compose.mark("restoreFromAnimation",Compose.LogEvent.stop)},setInitialFocus:function(n,t,i){var u,r,f,e,s,o;if(Mail.writeProfilerMark("ComposeUtil.setInitialFocus",Mail.LogEvent.start),Jx.isObject(Compose.ComposeImpl.getComposeImpl(n))){for(u=Compose.ComposeImpl.getComposeWindow(n),r=Compose.doc.activeElement;Boolean(r)&&Boolean(r.parentNode)&&r!==u;)r=r.parentNode;r!==u&&(f=n.getComponent("Compose.ToCcBcc"),f.isToEmpty()?f.focus("to"):(e=n.getComponent("Compose.Subject"),e.getSubject().length===0?e.focus():(s=n.getComponent("Compose.BodyComponent"),s.focus())),o=u.querySelector(".composeContentScrollArea"),o.scrollTop=0,o.scrollLeft=0);t&&!i&&Jx.ptStop(Mail.ComposeUtil.ptScenarioToString[t]);Mail.writeProfilerMark("ComposeUtil.setInitialFocus",Mail.LogEvent.stop)}},isValidAction:function(n){return["send","save","hideCurrent"].indexOf(n)!==-1}};Mail.composeUtil=new Mail.ComposeUtil});Jx.delayGroup("MailCompose",function(){Mail.EmojiPicker=function(){Compose.Component.call(this);this._emojiPicker=null;this._peekBarHeight=Jx.PeekBar.height};Jx.augment(Mail.EmojiPicker,Jx.Events);Jx.augment(Mail.EmojiPicker,Compose.Component);Compose.util.defineClassName(Mail.EmojiPicker,"Mail.EmojiPicker");var n=Mail.EmojiPicker.prototype;n.show=function(){this.getComponentCache().getComponent("Compose.KeyboardResizer").pause();this._ensureEmojiPicker();this._emojiPicker.show()};n._ensureEmojiPicker=function(){var n,t;Boolean(this._emojiPicker)||(n=this._getCanvasControl(),t=n.insertElement,this._emojiPicker=new EmojiPicker.EmojiPicker(t,n,this.getComposeRootElement().querySelector(".composeEmojiAnchor")),this._emojiPicker.addEventListener("afterhide",function(){this._updatePadding(true)}.bind(this),false),this._emojiPicker.addEventListener("aftershow",function(){this.getComponentCache().getComponent("Compose.KeyboardResizer").resume();this._updatePadding(false);this.raiseEvent("aftershow")}.bind(this),false))};n._getCanvasControl=function(){var n=this.getComponentCache().getComponent("Compose.BodyComponent");return n.getCanvasControl()};n._updatePadding=function(n){var i=this.getComposeRootElement(),t=i.querySelector(".composeContentScrollArea");if(n)t.style.removeProperty("margin-bottom");else{var r=this.getComponentCache().getComponent("Compose.KeyboardResizer").isAdjustingForKeyboard(),u=r?0:this._peekBarHeight,f=String(this._emojiPicker.offsetHeight-u)+"px";t.style.setProperty("margin-bottom",f);this._getCanvasControl().scrollSelectionIntoView()}}});Jx.delayGroup("MailCompose",function(){Mail.ExpandButton=function(){Compose.Component.call(this)};Jx.inherit(Mail.ExpandButton,Jx.Events);Jx.augment(Mail.ExpandButton,Compose.Component);Compose.util.defineClassName(Mail.ExpandButton,"Mail.ExpandButton");var n=Mail.ExpandButton.prototype;n.composeGetUI=function(n){n.html="<button id='composeExpandBtn' class='cmdExpand typeSizeNormal composeLinkButton' type='button'><span data-win-res='innerText:composeExpandLabel'>WMoreL<\/span><\/button>"};n.composeActivateUI=function(){this._expandButton=this.getComposeRootElement().querySelector(".cmdExpand");this._bindings=Compose.binder.attach(this,[{on:"click",from:this._expandButton,then:this._expandHeader}])};n.composeDeactivateUI=function(){Compose.binder.detach(this._bindings);this._bindings=null};n.isVisible=function(){var n=Compose.util.getHeaderController(this.getComponentCache());return n.getCurrentState()===Compose.HeaderController.State.editCondensed};n.focus=function(){this._expandButton.focus()};n.focusableElementId=function(){return this._expandButton.id};n._expandHeader=function(){var t=Compose.util.getHeaderController(this.getComponentCache()),n;t.changeState(Compose.HeaderController.State.editFull);n=this.getComponentCache().getComponent("Compose.Priority");n.focus();this.raiseEvent("expand")}});Jx.delayGroup("MailCompose",function(){Mail.ComposeInstrumentation=function(){Compose.Component.call(this);this._bindings=null;this._composeCommandsUsed={}};Jx.augment(Mail.ComposeInstrumentation,Compose.Component);Compose.util.defineClassName(Mail.ComposeInstrumentation,"Mail.ComposeInstrumentation");var n=Mail.ComposeInstrumentation.prototype;n.composeActivateUI=function(){this._bindings=this.getComponentBinder().attach(this,[{on:"changed",fromComponent:Compose.ComponentBinder.messageModelClassName,then:this._onModelChanged},{on:"expand",fromComponent:"Mail.ExpandButton",then:function(){this._composeCommandsUsed.showDetails=true}}])};n.composeDeactivateUI=function(){this.getComponentBinder().detach(this._bindings);this._bindings=null};n.composeUpdateUI=function(){this._resetComposeCommands()};n.updateModel=function(n){return n==="send"&&this._reportComposeInstrumentation(),Compose.Component.prototype.updateModel.call(this,n)};n._onModelChanged=function(){this._updatePriority()};n._updatePriority=function(){var n=Microsoft.WindowsLive.Platform.MailMessageImportance,t=this.getMailMessageModel().get("importance");t===n.high?this._composeCommandsUsed.highPriority=true:t===n.low?this._composeCommandsUsed.lowPriority=true:this._composeCommandsUsed.normalPriority=true};n._resetComposeCommands=function(){this._composeCommandsUsed={highPriority:false,lowPriority:false,normalPriority:false,showDetails:false}};n._reportComposeInstrumentation=function(){var u,e,t,r;Compose.log("reportInstrumentation",Compose.LogEvent.start);var f=this.getMailMessageModel(),i=this.getComponentCache(),o=f.getInitAction();var s=f.get("subject").length===0?1:0,h=i.getComponent("Compose.Subject");u=i.getComponent("Compose.ToCcBcc");var c=this.getMailMessageModel().get("htmlBody").length,l=h.getSubject().length,a=u.getRecipients("to").length,v=u.getRecipients("cc").length,y=u.getRecipients("bcc").length,p=i.getComponent("Compose.AttachmentWell").getCount()>0,w=i.getComponent("Compose.From").getAccount(),n=Microsoft.WindowsLive.Instrumentation.Ids.Mail;Jx.bici.addToStream(n.composeMailSent,o,15,s,0,c,l,a,v,y,p?1:0,Mail.Instrumentation.getServerDomain(w));e=i.getComponent("Compose.BodyComponent");t=e.getUsageData().commandManager;Boolean(t.bold)&&Jx.bici.increment(n.composeBoldUseCount,1);Boolean(t.italic)&&Jx.bici.increment(n.composeItalicsUseCount,1);Boolean(t.underline)&&Jx.bici.increment(n.composeUnderlineUseCount,1);Boolean(t.setFontFamily)&&Jx.bici.increment(n.composeFontFamilyUseCount,1);Boolean(t.setFontSize)&&Jx.bici.increment(n.composeFontSizeUseCount,1);Boolean(t.setFontColor)&&Jx.bici.increment(n.composeFontColorUseCount,1);Boolean(t.alignLeft)&&Jx.bici.increment(n.composeLeftAlignUseCount,1);Boolean(t.alignCenter)&&Jx.bici.increment(n.composeCenterUseCount,1);Boolean(t.alignRight)&&Jx.bici.increment(n.composeRightAlignUseCount,1);Boolean(t.numbers)&&Jx.bici.increment(n.composeNumberedListUseCount,1);Boolean(t.bullets)&&Jx.bici.increment(n.composeBulletedListUseCount,1);Boolean(t.setFontHighlightColor)&&Jx.bici.increment(n.composeHighlightUseCount,1);Boolean(t.redo)&&Jx.bici.increment(n.composeRedoUseCount,1);Boolean(t.undo)&&Jx.bici.increment(n.composeUndoUseCount,1);Boolean(t.indent)&&Jx.bici.increment(n.composeIndentUseCount,1);Boolean(t.outdent)&&Jx.bici.increment(n.composeOutdentUseCount,1);Boolean(t.clearFormatting)&&Jx.bici.increment(n.composeClearFormattingUseCount,1);Boolean(t.selectAll)&&Jx.bici.increment(n.composeSelectAllUseCount,1);Boolean(t.insertHyperlink)&&Jx.bici.increment(n.composeInsertLinkUseCount,1);r=this._composeCommandsUsed;r.showDetails&&Jx.bici.increment(n.composeToggleBccUseCount,1);r.lowPriority&&Jx.bici.increment(n.composePriorityLowUseCount,1);r.normalPriority&&Jx.bici.increment(n.composePriorityNormalUseCount,1);r.highPriority&&Jx.bici.increment(n.composePriorityHighUseCount,1);Compose.log("reportInstrumentation",Compose.LogEvent.stop)}});Jx.delayGroup("MailCompose",function(){"use strict";Mail.ComposeSizeUpdater=function(){Compose.Component.call(this);this._bindings=null;this._job=null;this._updatePromise=null};Jx.augment(Mail.ComposeSizeUpdater,Compose.Component);Compose.util.defineClassName(Mail.ComposeSizeUpdater,"Mail.ComposeSizeUpdater");var n=Mail.ComposeSizeUpdater.prototype;n.composeActivateUI=function(){this._bindings=Compose.binder.attach(this,[{on:"viewStateChanged",from:Mail.guiState,then:this._onResize}])};n.composeDeactivateUI=function(){Compose.binder.detach(this._bindings);this._bindings=null;Jx.dispose(this._job);this._updatePromise&&(this._updatePromise.cancel(),this._updatePromise=null)};n.composeUpdateUI=function(){this._updateComposeWidth()};n._onResize=function(){Compose.mark("SizeUpdater._onResize",Compose.LogEvent.start);Mail.Utilities.ComposeHelper.isComposeShowing?this._updateComposeWidth():this._job=Jx.scheduler.addJob(null,Mail.Priority.updateComposeWidth,"update compose width",this._updateComposeWidth,this);Compose.mark("SizeUpdater._onResize",Compose.LogEvent.stop)};n._updateComposeWidth=function(){Compose.mark("SizeUpdater._updateComposeWidth",Compose.LogEvent.start);Jx.dispose(this._job);var n=this.getComponentCache().getComponent("Compose.BodyComponent");this._updatePromise&&this._updatePromise.cancel();this._updatePromise=n.updateCanvasStylesAsync(Mail.guiState.width);this._updatePromise.done(function(){this._updatePromise=null}.bind(this));Compose.mark("SizeUpdater._updateComposeWidth",Compose.LogEvent.stop)}});Jx.delayGroup("MailCompose",function(){Mail.KeyboardShortcutHandler=function(){Compose.Component.call(this);this._bindings=null;this._contentScrollArea=null;this._commandManager=Mail.Globals.commandManager};Jx.augment(Mail.KeyboardShortcutHandler,Compose.Component);Compose.util.defineClassName(Mail.KeyboardShortcutHandler,"Mail.KeyboardShortcutHandler");var n=Mail.KeyboardShortcutHandler.prototype;n.composeActivateUI=function(){this._contentScrollArea=this.getComposeRootElement().querySelector(".composeContentScrollArea");var n=Compose.ComposeImpl.getComposeWindow(this.getComponentCache());this._bindings=this.getComponentBinder().attach(this,[{on:"keydown",from:n,then:this._onKeyDown},{on:"keydown",fromComponent:"Compose.BodyComponent",then:this._onKeyDownNoFocus},{on:"MSPointerDown",from:n,then:this._onMSPointerDown}])};n.composeDeactivateUI=function(){this.getComponentBinder().detach(this._bindings);this._bindings=null};n._tryDismiss=function(){var t=Array.prototype.every.call(Compose.doc.querySelectorAll(".win-flyout"),function(n){return n.getComputedStyle().visibility==="hidden"}),n;return Jx.glomManager.getIsParent()?Mail.Globals.animator.animateNavigateBack():(n=Mail.Utilities.ComposeHelper,n.handleHomeButton()),t};n._onMSPointerDown=function(n){n.button===3&&(n.preventDefault(),n.stopPropagation(),n.stopImmediatePropagation(),this._tryDismiss())};n._onKeyDownNoFocus=function(n){n.keyCode!==117&&this._onKeyDown(n)};n._onKeyDown=function(n){var u=0,e,f,o;n.altKey&&(u|=1);n.ctrlKey&&(u|=2);n.shiftKey&&(u|=4);var r=true,t=Jx.key.mapKeyCode(n.keyCode),i=Jx.KeyCode;if(u===1)t===i.t?r=this._callWithComponentIfExists("Compose.ToCcBcc",function(n){n.isVisible("to")&&n.focus("to")}):t===i.c?r=this._callWithComponentIfExists("Compose.ToCcBcc",function(n){n.isVisible("cc")&&n.launchPeoplePicker("cc")}):t===i.b?r=this._callWithComponentIfExists("Compose.ToCcBcc",function(n){n.isVisible("bcc")&&n.launchPeoplePicker("bcc")}):t===i.s?r=this._callWithComponentIfExists("Compose.SendButton",function(n){n.performClick()}):t===i.i?r=this._callWithComponentIfExists("Compose.AttachButton",function(n){n.performClick()}):t===i.period?r=this._callWithComponentIfExists("Compose.ToCcBcc",function(n){n.isVisible("to")&&n.launchPeoplePicker("to")}):t===i.m?this._callWithComponentIfExists("Compose.From",function(n){n.performClick()}):r=false;else if(t===i.enter)e=this.getComponentCache().getComponent("Compose.Subject"),r=Jx.isObject(e)&&e.isActivated()&&e.isActiveElement()?this._callWithComponentIfExists("Compose.BodyComponent",function(n){n.focus()}):false;else if(t===i.pageup||t===i.pagedown)f=this._contentScrollArea,u===2?f.scrollTop=t===i.pageup?0:f.scrollHeight:(o=f.clientHeight,t===i.pageup?f.scrollTop-=o:f.scrollTop+=o);else if(t===i.f6)r=this._callWithComponentIfExists("Compose.BodyComponent",function(n){n.focus()});else if(u===2)if(t===i.n&&Jx.glomManager.getIsParent())Mail.Utilities.ComposeHelper.onNewButton(Mail.Instrumentation.UIEntryPoint.keyboardShortcut);else r=t===i.d?this._callWithComponentIfExists("Compose.DeleteButton",function(n){n.performClick()}):false;else r=false;if(r||n.defaultPrevented)n.preventDefault(),n.stopPropagation(),n.stopImmediatePropagation();else if(t!==i.delete&&t!==i.insert&&t!==i.backspace)this._commandManager.onKeyDown(n)};n._callWithComponentIfExists=function(n,t){var i=this.getComponentCache().getComponent(n);return Jx.isObject(i)&&i.isActivated()?(t(i),true):false}});Jx.delayGroup("MailCompose",function(){Mail.IrmManager=function(){Compose.Component.call(this);this._bindings=null;this._isCalendarCancel=false;this._isCalendarMessage=false};Jx.augment(Mail.IrmManager,Jx.Events);Jx.augment(Mail.IrmManager,Compose.Component);Compose.util.defineClassName(Mail.IrmManager,"Mail.IrmManager");var n=Mail.IrmManager.prototype;n.composeActivateUI=function(){this._bindings=this.getComponentBinder().attach(this,[{on:"changed",fromComponent:Compose.ComponentBinder.messageModelClassName,then:this._onMessageModelChange}])};n.composeDeactivateUI=function(){this.getComponentBinder().detach(this._bindings);this._bindings=null};n.updateUI=function(){var n=this.getMailMessageModel().getPlatformMessage().calendarMessageType;this._isCalendarMessage=n!==Microsoft.WindowsLive.Platform.CalendarMessageType.none;this._isCalendarCancel=n===Microsoft.WindowsLive.Platform.CalendarMessageType.cancelled;this._onMessageModelChange()};n._onMessageModelChange=function(){this._updateFrom();this._updateToCcBcc();this._updateIrm()};n._updateFrom=function(){var n=this.getComponentCache().getComponent("Compose.From"),t,i;Jx.isNullOrUndefined(n)||(t=this.getMailMessageModel().get("irmHasTemplate"),i=this.getMailMessageModel().get("irmIsContentOwner"),n.setDisabled(t&&!i||this._isCalendarMessage))};n._updateToCcBcc=function(){var n=this.getComponentCache().getComponent("Compose.ToCcBcc"),t;Jx.isNullOrUndefined(n)||(t=!this.getMailMessageModel().get("irmCanModifyRecipients"),n.setDisabled(t||this._isCalendarCancel))};n._updateIrm=function(){var n=this.getComponentCache().getComponent("Compose.IrmChooser");Jx.isNullOrUndefined(n)||n.setDisabled(this._isCalendarMessage)}});Jx.delayGroup("MailCompose",function(){Mail.ChainOfResponsibility=function(n){this._handlers=n};Mail.ChainOfResponsibility.prototype={handle:function(n){for(var r,i,t=0;t<this._handlers.length;t++)if(r=this._handlers[t],i=r.handle(n),!Jx.isNullOrUndefined(i))return i;return null}};Mail.ChainOfResponsibilityUtil={factoryize:function(n){return{build:n.handle.bind(n)}}}});Jx.delayGroup("MailCompose",function(){Mail.MessageModelFactory=function(){};Mail.MessageModelFactory.prototype={handle:function(n){var t=this._validateSpec(n),i=t.initAction;switch(i){case Compose.ComposeAction.createNew:return Compose.MailMessageModel.instance({initAction:Compose.ComposeAction.createNew,signatureLocation:ModernCanvas.SignatureLocation.start},{accountId:t.accountId,fromEmail:this._getPreferredSendAsAddress(t.accountId)});case Compose.ComposeAction.openDraft:return Compose.MailMessageModel.instance({messageCreator:t.messageCreator,initAction:Compose.ComposeAction.openDraft});case Compose.ComposeAction.forward:return Compose.mailMessageModelForwardFactory.instance(t.messageCreator);case Compose.ComposeAction.reply:return Compose.mailMessageModelReplyFactory.instance(t.messageCreator);case Compose.ComposeAction.replyAll:return Compose.mailMessageModelReplyAllFactory.instance(t.messageCreator)}return null},_validateSpec:function(n){var i=n.initAction,r,t;return r=n.messageCreator,Boolean(r)||i===Compose.ComposeAction.createNew||(t=n.originalMessage,i===Compose.ComposeAction.openDraft&&t.isInSpecialFolderType(Microsoft.WindowsLive.Platform.MailFolderType.drafts)&&(t=null),n.messageCreator=Compose.MessageReturner.instance(t)),n},_getPreferredSendAsAddress:function(n){var t=Compose.platform,i=t.accountManager.loadAccount(n);return i.preferredSendAsAddress}}}),function(){Mail.getComposeMessageModelFactory=function(){var n=Mail.ChainOfResponsibilityUtil.factoryize(new Mail.ChainOfResponsibility([new Mail.CalendarMessageModelFactory,new Mail.MessageModelFactory]));return Mail.getComposeMessageModelFactory=function(){return n},Mail.getComposeMessageModelFactory()}}();Jx.delayGroup("MailCompose",function(){Mail.CalendarMessageModelFactory=function(){};Mail.CalendarMessageModelFactory.prototype={handle:function(n){var t=null,i=n.calendarAction;if((Boolean(n.originalEvent)||Boolean(n.originalMessage))&&Jx.isNonEmptyString(i)){switch(i){case Compose.CalendarActionType.reply:case Compose.CalendarActionType.replyAll:t=Compose.calendarReplyMessageModelFactory.instance(n.originalEvent,i);break;case Compose.CalendarActionType.forward:t=Compose.calendarForwardMessageModelFactory.instance(n.originalEvent);break;case Compose.CalendarActionType.cancel:t=Compose.calendarCancelMessageModelFactory.instance(n.originalEvent);break;case Compose.CalendarActionType.accept:case Compose.CalendarActionType.tentative:case Compose.CalendarActionType.decline:Jx.isObject(n.originalMessage)||Compose.CalendarUtil.PreEditResponseActionsforCalendar(n.originalEvent,i);t=Compose.calendarEditResponseMessageModelFactory.instance(n.originalMessage,n.originalEvent,i)}t||(Jx.log.info("Mail.CalendarMessageModelFactory failed to handle calendar message as requested - switching to createNew"),n.originalEvent=null,n.calendarAction=null,n.initAction=Compose.ComposeAction.createNew,n.accountId=Mail.Globals.appState.selectedAccount.objectId)}return t}}});Jx.delayGroup("MailCompose",function(){function i(i){var r=t(i);n(r)}function n(n){n&&n.canDelete&&n.deleteObject()}function r(i){var f=i.getPlatformMessage(),e=t(f),o=Compose.platform,u=o.accountManager.loadAccount(f.accountId),r=Compose.mailMessageFactoryUtil.getSourceMessage(i.getPlatformMessage()),s=e||r&&r.calendarEvent;s&&o.invitesManager.sendMeetingResponse(s,r,Microsoft.WindowsLive.Platform.Calendar.ResponseType.declined,u);n(e);r&&(u=Mail.Account.load(r.accountId,Compose.platform),Compose.CalendarUtil.MoveMessageToDeleted(new Mail.UIDataModel.MailMessage(r,u)))}function u(n){var t=n.getPlatformMessage();i(t)}function t(n){var i=Compose.platform,t=null,r=n.eventHandle;if(r)try{t=i.calendarManager.getEventFromHandle(n.eventHandle)}catch(u){Jx.log.exception("Unable to load event in order to delete it after sending mail",u)}return t}Mail.CalendarActionHandlerFactory=function(){};Mail.CalendarActionHandlerFactory.prototype={handle:function(n){var i=n.getPlatformMessage().calendarMessageType,t=Microsoft.WindowsLive.Platform.CalendarMessageType;switch(i){case t.cancelled:return{send:{afterAction:u}};case t.responseDeclined:return{send:{afterAction:r}}}return null}};Mail.getComposeActionHandlerFactory=function(){var n=Mail.ChainOfResponsibilityUtil.factoryize(new Mail.CalendarActionHandlerFactory);return Mail.getComposeActionHandlerFactory=function(){return n},Mail.getComposeActionHandlerFactory()}});Jx.delayGroup("MailCompose",function(){Compose.Selection=function(){Compose.Component.call(this);this._focusJob=null;this._selectionChangeJob=null;this._composeInFocus=false;this._canvasInFocus=false;this._frameInFocus=false;this._lastFocus=null;this._lastFocusFired="notfired";this._bindings=null;this._body=null;this._canvas=null;this._composeWindow=null;this._frameElement=null;this._pauseAppBarPadding=false;this._peekBarHeight=Jx.PeekBar.height;this._selectionStateCache=null;this._selectionStyleCache=null};Jx.augment(Compose.Selection,Jx.Events);Jx.augment(Compose.Selection,Compose.Component);Compose.util.defineClassName(Compose.Selection,"Compose.Selection");var n=Compose.Selection.prototype;n.composeGetUI=function(){};n.composeActivateUI=function(){this._selectionStateCache=null;this._selectionStyleCache=null;this._body=this.getComponentCache().getComponent("Compose.BodyComponent");this._composeWindow=Compose.ComposeImpl.getComposeWindow(this.getComponentCache());this._frameElement=document.getElementById(Mail.CompFrame.frameElementId);var t=Mail.Globals.commandManager,n=[{on:"focusin",from:this._frameElement,then:this._focusIn},{on:"focusout",from:this._frameElement,then:this._focusOut},{on:"contextmenu",fromComponent:"Compose.BodyComponent",then:this._onContextMenu},{on:"aftercommand",fromComponent:"Compose.BodyComponent",then:this._afterCommand},{on:"selectionchange",fromComponent:"Compose.BodyComponent",then:this._selectionChange},{on:"font",fromComponent:"Compose.BodyComponent",then:this._showFontFlyout},{on:"mspointerdown",fromComponent:"Compose.BodyComponent",then:this._canvasClick},{on:"layoutChanged",from:Mail.guiState,then:this._updateFocus}];t.appBar?(n.push({on:"afterhide",from:this._getAppBar(),then:this._updatePaddingFromAppBar}),n.push({on:"aftershow",from:this._getAppBar(),then:this._updatePaddingFromAppBar}),n.push({on:"beforeshow",from:this._getAppBar(),then:this._updatePaddingFromAppBar}),n.push({on:"resize",from:window,then:this._updatePaddingFromAppBar}),this._updatePaddingFromAppBar()):n.push({on:"appBarSubscription",from:t,then:this._addAppBarBindings});this._isActivated=true;this._body.getCanvasAsync().done(function(i){this._canvas=i;this._bindings=this.getComponentBinder().attach(this,n);t.addContext("composeSelection",this);this._focusIn({target:document.activeElement})}.bind(this))};n.composeDeactivateUI=function(){Jx.dispose(this._focusJob);Jx.dispose(this._selectionChangeJob);this.getComponentBinder().detach(this._bindings);this._bindings=null;this._body=null;this._canvas=null;this._composeWindow=null;this._frameElement=null;this._composeInFocus=false;this._canvasInFocus=false;this._lastFocus=null;this._isActivated=false;this.raiseEvent("focuschange");Mail.Globals.commandManager.removeContext("composeSelection")};n.composeUpdateUI=function(){Mail.Globals.commandManager.appBar&&this._updatePaddingFromAppBar()};n._addAppBarBindings=function(){this.getComponentBinder().addAttach(this._bindings,this,[{on:"afterhide",from:this._getAppBar(),then:this._updatePaddingFromAppBar},{on:"aftershow",from:this._getAppBar(),then:this._updatePaddingFromAppBar},{on:"beforeshow",from:this._getAppBar(),then:this._updatePaddingFromAppBar},{on:"resize",from:window,then:this._updatePaddingFromAppBar}]);this._updatePaddingFromAppBar()};n._onContextMenu=function(n){this._isActivated&&this.raiseEvent("contextmenu",n)};n._updateFocus=function(){if(this._isActivated){var n=Mail.guiState;n.isReadingPaneVisible&&Mail.Utilities.ComposeHelper.isComposeShowing&&Mail.composeUtil.setInitialFocus(this.getComponentCache())}};n._focusIn=function(n){this._isActivated&&(Compose.mark("Selection._focusIn",Compose.LogEvent.start),this._canvas.getIframeElement()===n.target?(this._composeInFocus=true,this._canvasInFocus=true,this._lastFocus="canvas"):this._isChildElement(this._composeWindow,n.target)?(this._composeInFocus=true,this._lastFocus="compose"):this._isChildElement(this._frameElement,n.target)&&(this._frameInFocus=true,this._lastFocus="frame"),Jx.dispose(this._focusJob),this._focusJob=Jx.scheduler.addJob(null,Mail.Priority.focusCompose,"focus in for compose",function(){this._focusHasChanged()&&this.raiseEvent("focuschange",n)},this),Compose.mark("Selection._focusIn",Compose.LogEvent.stop))};n._focusOut=function(n){this._isActivated&&(Compose.mark("Selection._focusOut",Compose.LogEvent.start),this._isChildElement(this._composeWindow,n.target)?(this._composeInFocus=false,this._canvasInFocus=false):this._isChildElement(this._frameElement,n.target)&&(this._frameInFocus=false),Jx.dispose(this._focusJob),this._focusJob=Jx.scheduler.addJob(null,Mail.Priority.focusCompose,"focus out for compose",function(){this._focusHasChanged()&&this.raiseEvent("focuschange",n)},this),Compose.mark("Selection._focusOut",Compose.LogEvent.stop))};n._focusHasChanged=function(){var n=this._lastFocus!==this._lastFocusFired;return this._lastFocusFired=this._lastFocus,n};n._canvasClick=function(n){this._isActivated&&this.raiseEvent("mspointerdown",n)};n._afterCommand=function(n){this._isActivated&&(this._selectionStateCache=null,this._selectionStyleCache=null,this.raiseEvent("aftercommand",n))};n._selectionChange=function(n){this._isActivated&&(this._selectionStateCache=null,this._selectionStyleCache=null,Jx.dispose(this._selectionChangeJob),this._selectionChangeJob=Jx.scheduler.addTimerJob(null,Mail.Priority.composeSelection,"selection change for compose",200,this.raiseEvent,this,["selectionchange",n]))};n._updatePaddingFromAppBar=function(){if(this._isActivated){if(this._pauseAppBarPadding){this._pauseAppBarPadding=false;return}Compose.mark("Selection.updatePaddingFromAppBar",Compose.LogEvent.start);var i=this.getComposeRootElement(),t=i.querySelector(".composeContentScrollArea"),n=this._getAppBar();if(n.hidden&&n.winAnimating!=="showing")t.style.removeProperty("margin-bottom");else{var r=this.getComponentCache().getComponent("Compose.KeyboardResizer").isAdjustingForKeyboard(),u=r?0:this._peekBarHeight,f=String(n.offsetHeight-u)+"px";t.style.setProperty("margin-bottom",f);this._canvas&&this._canvas.scrollSelectionIntoView()}Compose.mark("Selection.updatePaddingFromAppBar",Compose.LogEvent.stop)}};n.getSelectionState=function(){if(!this._selectionStateCache){var n=this._canvas.getSelectionRange(),t=Boolean(n);this._selectionStateCache={hasSelection:t,hasNonEmptySelection:t&&!n.collapsed,isLink:Boolean(this._canvas.getParentElementForSelection("a"))}}return this._selectionStateCache};n.getSelectionStyles=function(){return this._selectionStyleCache||(this._selectionStyleCache=this._canvas.getSelectionStyles()),this._selectionStyleCache};n._isChildElement=function(n,t){while(t){if(t===n)return true;t=t.parentNode}return false};n._getAppBar=function(){return Mail.Globals.commandManager.appBar};n.getCanvasDocument=function(){return this._canvas.getDocument()};n._showFontFlyout=function(){var n,i,t;if(this._isActivated){if(n=false,this._getAppBar().hidden&&(i=this.getComponentCache().getComponent("Compose.BodyComponent"),t=i.getSelectionAnchorElement(),t)){Mail.Commands.FlyoutHandler.onHostButton("fontFlyout",t,true);n=true}if(!n)Mail.Commands.FlyoutHandler.onHostButton("fontFlyout","font")}};Object.defineProperty(n,"composeInFocus",{enumerable:true,get:function(){return this._lastFocus==="compose"||this._lastFocus==="canvas"||this._composeInFocus}});Object.defineProperty(n,"canvasInFocus",{enumerable:true,get:function(){return this._lastFocus==="canvas"||this._canvasInFocus}});Object.defineProperty(n,"appBarHidden",{enumerable:true,get:function(){return this._getAppBar().hidden}});n.focusAppBar=function(){this._getAppBar().focus()};n.focusBody=function(){this._body.focus()};n.fireCommandEvent=function(n,t){this._body.dispatchEvent(n,t)};n.saveCommand=function(){Compose.ComposeImpl.quietSave(this.getComponentCache())};n.pauseAppBarPadding=function(){this._pauseAppBarPadding=true};n.showEmojiPicker=function(){var t=this.getComponentCache(),n=t.getComponent("Mail.EmojiPicker");Boolean(n)||(n=this.getComponentCreator().getInstance(Mail.EmojiPicker),Compose.ComposeImpl.getComposeImpl(t).addComponent(n),n.activateUI());n.show()}})