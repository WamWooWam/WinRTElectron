Jx.delayGroup("MailCompose",function(){function t(n){var t=Compose.platform.accountManager;return t.loadAccount(n)}Compose.BodyComponent=function(){Compose.Component.call(this);this._bindings=null;this._canvas=null;this._canvasControl=null;this._createCanvasPromise=null;this._irmQuotedBody=null;this._dirtyTracker=null;this._lastAccountId=null};Jx.augment(Compose.BodyComponent,Jx.Events);Jx.augment(Compose.BodyComponent,Compose.Component);Compose.util.defineClassName(Compose.BodyComponent,"Compose.BodyComponent");var n=Compose.BodyComponent.prototype;n.composeGetUI=function(n){n.html=Compose.Templates.body()};n.composeActivateUI=function(){var n=this;this.getCanvasAsync().done(function(t){n._bindings=n.getComponentBinder().attach(n,[{on:"changed",fromComponent:Compose.ComponentBinder.messageModelClassName,then:n._onMessageModelChange},{on:"beforecommand",from:t,then:function(t){n.raiseEvent("beforecommand",t)}},{on:"aftercommand",from:t,then:function(t){n.raiseEvent("aftercommand",t)}},{on:"selectionchange",from:t.getDocument(),then:function(t){n.raiseEvent("selectionchange",t)}},{on:"blur",from:t.getIframeElement(),then:function(t){n.raiseEvent("blur",t)}},{on:"focus",from:t.getIframeElement(),then:function(t){n.raiseEvent("focus",t)}},{on:"keydown",from:t.getDocument(),then:function(t){n.raiseEvent("keydown",t)}},{on:"MSPointerDown",from:t.getDocument(),then:function(t){n.raiseEvent("mspointerdown",t)}}])})};n.composeDeactivateUI=function(){this.getComponentBinder().detach(this._bindings);this._bindings=null;this._canvasControl.deactivate()};n.composeUpdateUI=function(){var t=this,n=this.getMailMessageModel();this.getCanvasAsync().done(function(i){var h,e,u,f;i.reset(true,true);i.setMailMessage(n.getPlatformMessage());t._setMailAccount(n.get("accountId"));var l=n.getBodyContents(),s=true,r=null;if(l.forEach(function(n){Jx.isNullOrUndefined(n.content)?r=n.signatureLocation:(i.addContent(n.content,n.format,n.location),(n.format!==ModernCanvas.ContentFormat.text||n.content!=="")&&(s=false))}),t._irmQuotedBody.setContent(null),h=n.get("irmCanEdit"),e=n.get("irmCanExtractContent"),(!h||!e)&&(u=Compose.mailMessageFactoryUtil.getSourceMessage(n.getPlatformMessage()),Boolean(u))){var a=Mail.Account.load(u.accountId,Compose.platform),v=Mail.getScrubbedDocument(Compose.platform,new Mail.UIDataModel.MailMessage(u,a)),o=ModernCanvas.Mail.convertDocumentToDocumentFragment(v),y=Compose.mailMessageFactoryUtil.prepareReplyInfoFromOriginalMessage(u),c=document.createElement("div");try{c.innerHTML=window.toStaticHTML(y);o.insertBefore(c,o.firstChild)}catch(p){Jx.log.exception("toStaticHTML threw",p)}t._irmQuotedBody.setContent(o)}t._irmQuotedBody.disableCopy=!e;Jx.isNullOrUndefined(r)&&(r=n.getSignatureLocation());Compose.log("activateCanvas",Compose.LogEvent.start);i.activate(r);Compose.log("activateCanvas",Compose.LogEvent.stop);f=n.getInitAction();f===Compose.ComposeAction.forward||f===Compose.ComposeAction.createNew&&s?setImmediate(i.showCueText.bind(i)):f===Compose.ComposeAction.openDraft&&Mail.guiState.isOnePane&&document.activeElement===i.getIframeElement()&&i.setSelection(null)})};n.prepareForAnimation=function(){Compose.log("body.prepareForAnimation",Compose.LogEvent.start);this.getCanvasAsync().done(function(n){var t=n.components.autoResize;t.suspendEvents();Compose.log("body.prepareForAnimation",Compose.LogEvent.stop)})};n.restoreFromAnimation=function(){Compose.log("body.restoreFromAnimation",Compose.LogEvent.start);this.getCanvasAsync().done(function(n){var t=n.components.autoResize;t.resumeEvents();Compose.log("body.restoreFromAnimation",Compose.LogEvent.stop)})};n.clear=function(){this._canvasControl&&(this._canvasControl.getDocument().getSelection().removeAllRanges(),this._canvasControl.clearContent())};n.setIsAddedToDOM=function(n){Compose.Component.prototype.setIsAddedToDOM.call(this,n);n||(this._canvasControl.dispose(),this._canvasControl=null,this._createCanvasPromise=null)};n.updateModel=function(n){var i,t,u,f;i=this._canvasControl;t=this.getMailMessageModel();n==="send"&&!t.get("irmCanExtractContent")&&Boolean(t.get("irmCanEdit"))&&(u=Compose.mailMessageFactoryUtil.getSourceMessage(t.getPlatformMessage()),Boolean(u)&&(f=Compose.mailMessageFactoryUtil.prepareReplyInfoFromOriginalMessage(u),t.prependBodyContents([{content:f,format:ModernCanvas.ContentFormat.htmlString,location:ModernCanvas.ContentLocation.end}]),this._dirtyTracker.pause(),i.addContent(f,ModernCanvas.ContentFormat.htmlString,ModernCanvas.ContentLocation.end),this._dirtyTracker.resume()));n!=="save"&&i.finalizeMailMessage();var r=ModernCanvas.ContentFormat,o=n==="send"?ModernCanvas.ContentDestination.external:ModernCanvas.ContentDestination.internal,e=i.getContent([r.htmlString,r.text],o);return t.set({htmlBody:e[r.htmlString],textBody:e[r.text],sanitizedVersion:Microsoft.WindowsLive.Platform.SanitizedVersion.locallyCreatedMessage}),Compose.Component.prototype.updateModel.call(this,n)};n.composeValidate=function(){return Jx.isObject(this._canvasControl)&&this._canvasControl.isContentReady()};n.dispatchEvent=function(n,t){var i=this.getSelectionRange();i&&this._canvasControl.replaceSelection(i);Jx.raiseEvent(this._canvasControl,"command",{command:n,value:t})};n.getCanvasControl=function(){return this._canvasControl};n.getCanvasDiv=function(){return this._canvas=this._canvas||this.getComposeRootElement().querySelector(".composeCanvas"),this._canvas};n.getSelectionRange=function(){return this._canvasControl.getSelectionRange()};n.getSelectionAnchorElement=function(){var n=this._canvasControl.getSelectionRange();return n?this._canvasControl.getAnchorElement(n):null};n.getUsageData=function(){return this._canvasControl.getUsageData()};n.focus=function(){this.getCanvasAsync().done(function(n){n.focus()})};n.getSelectedLink=function(){return this._canvasControl.getParentElementForSelection("a")};n.updateEnabledStates=function(n){this._canvasControl.components.commandManager.updateEnabledStates(n)};n.getCommand=function(n){return this._canvasControl.components.commandManager.getCommand(n)};n.isDirty=function(){return this._dirtyTracker.isDirty};n._onMessageModelChange=function(){this._setMailAccount(this.getMailMessageModel().get("accountId"))};n._setMailAccount=function(n){if(Jx.isNonEmptyString(n)){if(n!==this._lastAccountId){var i=t(n);Boolean(i)?(this._lastAccountId=n,this._canvasControl.setMailAccount(i)):this._lastAccountId=null}}else this._lastAccountId=null};n.getCanvasAsync=function(){var n=this;return Jx.isNullOrUndefined(this._createCanvasPromise)&&(this._irmQuotedBody=new ModernCanvas.Plugins.IrmQuotedBody,this._dirtyTracker=new ModernCanvas.Plugins.DirtyTracker,this._createCanvasPromise=ModernCanvas.createCanvasAsync(this.getCanvasDiv(),{className:"mail",delayActivation:true,autoReplaceManager:Mail.Utilities.ComposeHelper.createAutoReplaceManager(),plugins:{indent:new ModernCanvas.Plugins.Indent,irmQuotedBody:this._irmQuotedBody,dirtyTracker:this._dirtyTracker,defaultFont:new ModernCanvas.Plugins.DefaultFont,imageResize:new ModernCanvas.Plugins.ImageResize},contextMenuManager:{getUsageData:function(){return{}},onContextMenu:this.raiseEvent.bind(this,"contextmenu")}}).then(function(t){n._canvasControl=t;t.setCueText(Jx.res.getString("composeCanvasCueText"));var i=n._canvasControl.components.commandManager;return i.setCommand(new ModernCanvas.Command("focusNext",n._focusNext.bind(n),{undoable:false})),i.setCommand(new ModernCanvas.Command("focusPrevious",n._focusPrevious.bind(n),{undoable:false})),i.setCommand(new ModernCanvas.Command("font",function(t){n.raiseEvent("font",t)},{undoable:false})),i.setCommand(new ModernCanvas.Command("openLink",n._openLink.bind(n),{undoable:false})),t})),this._createCanvasPromise};n.updateCanvasStylesAsync=function(n){var t=false;return new WinJS.Promise(function(i){Jx.log.info("Compose.BodyComponent.updateCanvasStylesAsync: about to set Canvas styles for width "+n);this.getCanvasAsync().done(function(r){if(!t){Jx.log.info("Compose.BodyComponent.updateCanvasStylesAsync: setting Canvas styles for width "+n);var e=r.getDocument().body,o=Jx.ApplicationView,u=o.State,f=o.getStateFromWidth(n);Jx.glomManager.getIsChild()?(Jx.setClass(e,"composeLarge",f===u.large||f===u.full||f===u.wide),Jx.setClass(e,"composeMedium",f===u.more),Jx.setClass(e,"composeSmall",f===u.snap||f===u.minimum)):(Jx.setClass(e,"composeLarge",f===u.wide),Jx.setClass(e,"composeMedium",f===u.full),Jx.setClass(e,"composeSmall",f===u.snap||f===u.minimum||f===u.more));i()}})}.bind(this),function(){Jx.log.info("Compose.BodyComponent.updateCanvasStylesAsync: Canvas style update canceled for width "+n);t=true})};n._focusNext=function(){var n=this.getComponentCache().getComponent("Compose.Selection"),t;n&&n.isActivated()&&!n.appBarHidden?n.focusAppBar():(t=this.getComponentCache().getComponent("Compose.SendButton"),t.focus())};n._focusPrevious=function(){var n=this.getComponentCache().getComponent("Compose.AttachmentWell"),t;Boolean(n)&&n.isActivated()&&!n.isHidden()?n.focus():(t=this.getComponentCache().getComponent("Compose.Subject"),t.focus())};n._openLink=function(n){var t,i;if(t=this.getSelectedLink()||n.target,Boolean(t)&&(i=t.getAttribute("href"),Boolean(i)))try{Windows.System.Launcher.launchUriAsync(new Windows.Foundation.Uri(i)).done()}catch(r){}}});Jx.delayGroup("MailCompose",function(){Compose.From=function(){Compose.Component.call(this);this._fromControl=new FromControl.FromControl(Compose.platform.accountManager,Compose.platform.peopleManager);this._fromArea=null;this._fromControlActivated=false;this._initialValue=null;this._updateModelHelper=this._updateModelHelper.bind(this)};Jx.augment(Compose.From,Compose.Component);Compose.util.defineClassName(Compose.From,"Compose.From");var n=Compose.From.prototype;n.composeGetUI=function(n){n.html=Compose.Templates.from({from:Jx.getUI(this._fromControl).html})};n.composeActivateUI=function(){this._fromArea=this.getComposeRootElement().querySelector(".addressbarFromField");this._fromControlActivated||(this._fromControlActivated=true,this._fromControl.activateUI(),this._fromControl.onAccountChanged=this._updateModelHelper)};n.composeDeactivateUI=function(){this._fromArea=null;this._fromControl.onAccountChanged=null};n.composeUpdateUI=function(){this._fromControl.onAccountChanged=null;this._fromControl.refresh()&&(this._fromControl.initUI(this._fromArea),Jx.res.processAll(this._fromArea));var n=this.getMailMessageModel();this._initialValue=n.get("fromEmail");this._fromControl.select(n.get("accountId"),this._initialValue);this._fromControl.onAccountChanged=this._updateModelHelper;this._updateModelHelper()};n.updateModel=function(n){return this._updateModelHelper(),Compose.Component.prototype.updateModel.call(this,n)};n.setDisabled=function(n){this._fromControl.disabled!==n&&(this._fromControl.disabled=n,this.composeUpdateUI())};n.isDirty=function(){return this._fromControl.selectedEmailAddress!==this._initialValue};n.isVisible=function(){var n=Compose.util.getHeaderController(this.getComponentCache());return n.getCurrentState()===Compose.HeaderController.State.editFull};n._updateModelHelper=function(n){try{n=n||this._fromControl.selectedAccount;this.getMailMessageModel().set({accountId:n.objectId,fromEmail:this._fromControl.selectedEmailAddress})}catch(t){Jx.fault("from.js","_updateMessage",t)}};n.performClick=function(){this._fromControl.click()};n.getAccount=function(){return this._fromControl.selectedAccount}});Jx.delayGroup("MailCompose",function(){Compose.Priority=function(){Compose.Component.call(this);this._priorityField=null;this._priorityArea=null;this._currentPriority=null;this._initialValue=null;this._bindings=null};Jx.augment(Compose.Priority,Compose.Component);Compose.util.defineClassName(Compose.Priority,"Compose.Priority");var n=Compose.Priority.prototype;n.composeGetUI=function(n){n.html=Compose.Templates.priority()};n.composeActivateUI=function(){this._priorityField=this.getComposeRootElement().querySelector(".composePriorityField");this._bindings=this.getComponentBinder().attach(this,[{on:"change",from:this._priorityField,then:this._priorityValueChanged},{on:"changed",fromComponent:"Compose.HeaderController",then:this._onHeaderStateChange}])};n.composeDeactivateUI=function(){this.getComponentBinder().detach(this._bindings);this._bindings=null};n.composeUpdateUI=function(){var r=Microsoft.WindowsLive.Platform.MailMessageImportance,t=this.getMailMessageModel(),i=t.get("importance"),n;this._priorityField.value=this._currentPriority=this._initialValue=i;n=Compose.util.getHeaderController(this.getComponentCache());this._updateFieldVisibility(n.getCurrentState())};n.updateModel=function(n){return this._updateModelHelper(),Compose.Component.prototype.updateModel.call(this,n)};n.isDirty=function(){return this._initialValue!==this._currentPriority};n.isVisible=function(){var n=Compose.util.getHeaderController(this.getComponentCache());return n.getCurrentState()!==Compose.HeaderController.State.readOnly&&!this._getPriorityArea().classList.contains("hidden")};n.focus=function(){this._priorityField.focus()};n.focusableElementId=function(){return this._priorityField.id};n._updateModelHelper=function(){var n=this.getMailMessageModel();n.set({importance:this._currentPriority})};n._priorityValueChanged=function(){this._currentPriority=this._getPriorityFieldValue();this._updateModelHelper()};n._getPriorityFieldValue=function(){return parseInt(this._priorityField.value,10)};n._onHeaderStateChange=function(n){this._updateFieldVisibility(n.newState)};n._updateFieldVisibility=function(n){var t=Compose.doc.querySelectorAll(".priorityElement"),i=n===Compose.HeaderController.State.editCondensed&&this.getMailMessageModel().get("importance")===1;Array.prototype.forEach.call(t,function(n){i?n.classList.add("hidden"):n.classList.remove("hidden")})};n._getPriorityArea=function(){return this._priorityArea||(this._priorityArea=this.getComposeRootElement().querySelector(".composePriority")),this._priorityArea}});Jx.delayGroup("MailCompose",function(){Compose.IrmChooser=function(){Compose.Component.call(this);this._accountId=null;this._irmTemplateField=null;this._templates=null;this._currentTemplate=null;this._isDirty=false;this._bindings=null;this._isDisabled=true;this._chooserElement=null;this._descriptionElement=null};Jx.augment(Compose.IrmChooser,Compose.Component);Compose.util.defineClassName(Compose.IrmChooser,"Compose.IrmChooser");var n=Compose.IrmChooser.prototype;n.composeGetUI=function(n){n.html=Compose.Templates.irmChooser()};n.composeActivateUI=function(){this._irmTemplateField=Compose.doc.querySelector(".composeIrmField");this._bindings=this.getComponentBinder().attach(this,[{on:"change",from:this._irmTemplateField,then:this._irmValueChanged},{on:"changed",fromComponent:Compose.ComponentBinder.messageModelClassName,then:this._onMessageModelChange},{on:"changed",fromComponent:"Compose.HeaderController",then:this._setElementVisibility}])};n.composeDeactivateUI=function(){this.getComponentBinder().detach(this._bindings);this._bindings=null};n.composeUpdateUI=function(){var i=this.getMailMessageModel(),e,u,n,r,f,t,o;if(this._accountId=i.get("accountId"),this._isDirty=false,this._currentTemplate=null,e=this._getDescriptionElement(),e.innerText="",this._templates=this._getTemplates(),u=i.get("irmTemplateId"),(Jx.isNullOrUndefined(this._templates)||this._templates.count===0)&&!Jx.isNonEmptyString(u))i.set({irmHasTemplate:false});else{for(this._irmTemplateField.innerHTML="",n=document.createElement("option"),n.innerText=Jx.res.getString("composeIrmNoRestrictions"),n.value=this._noRestrictionValue,n.classList.add("composeFieldOption"),this._irmTemplateField.add(n),r=0;r<this._templates.count;r++)f=this._templates.item(r),t=document.createElement("option"),t.innerText=f.name,t.value=f.id,t.classList.add("composeFieldOption"),this._irmTemplateField.add(t);o=i.get("irmHasTemplate");o&&this._selectTemplate(u);this._updateIrmTemplateField()}this._setElementVisibility()};n._updateIrmTemplateField=function(){var n=this.getMailMessageModel();this._irmTemplateField.disabled=this._isDisabled||n.get("irmHasTemplate")&&!n.get("irmIsContentOwner")&&!n.get("irmCanRemoveRightsManagement")?true:false};n.setDisabled=function(n){n!==this._isDisabled&&(this._isDisabled=n,this._updateIrmTemplateField())};n.updateModel=function(n){return this._updateModel(),Compose.Component.prototype.updateModel.call(this,n)};n.isDirty=function(){return this._isDirty};n.isVisible=function(){return!this._getChooserElement().classList.contains("hidden")};n.focus=function(){this._irmTemplateField.focus()};n.focusableElementId=function(){return this._irmTemplateField.id};n._updateModel=function(){var n=this.getMailMessageModel(),i=n.get("irmTemplateId"),t;(this._currentTemplate===null&&Jx.isNonEmptyString(i)||this._currentTemplate!==null&&i!==this._currentTemplate.id)&&(t=n.getPlatformMessage(),n.get("irmIsContentOwner")||t.removeRightsManagementTemplate(),t.setRightsManagementTemplate(this._currentTemplate),this._isDirty=true)};n._onMessageModelChange=function(){var n=this.getMailMessageModel(),i=n.get("accountId"),t;this._accountId!==i&&(this._currentTemplate=null,t=n.getPlatformMessage(),t.setRightsManagementTemplate(null),n.set({irmHasTemplate:n.get("irmHasTemplate"),irmTemplateId:""}),this.composeUpdateUI())};n._getChooserElement=function(){return this._chooserElement||(this._chooserElement=Compose.doc.querySelector(".composeIrmChooser")),this._chooserElement};n._getDescriptionElement=function(){return this._descriptionElement||(this._descriptionElement=Compose.doc.querySelector(".composeIrmDescription")),this._descriptionElement};n._getTemplates=function(){var t=null,r=Compose.platform.accountManager,i=r.loadAccount(this._accountId),n=null;return i&&(n=i.getServerByType(Microsoft.WindowsLive.Platform.ServerType.eas)),n&&(t=n.rightsManagementTemplates),t};n._findTemplate=function(n){for(var i,t=0;t<this._templates.count;t++)if(i=this._templates.item(t),i.id===n)return i;return null};n._irmValueChanged=function(){this._updateIrm()};n._updateIrm=function(n){var i=this._irmTemplateField.value,t;i===this._noRestrictionValue?this._currentTemplate=null:Jx.isNullOrUndefined(n)?(n=this._findTemplate(i),this._currentTemplate=n):this._currentTemplate=n;this._updateModel();t=this._getDescriptionElement();t.innerText=this._currentTemplate?this._currentTemplate.description:"";Jx.isNonEmptyString(t.innerText)?t.classList.remove("hidden"):t.classList.add("hidden")};n._selectTemplate=function(n){var i,t,r;var f=false,u=0,e=null;for(i=0;i<this._irmTemplateField.options.length;i++)if(this._irmTemplateField.options[i].value===n){u=i;f=true;break}f||(t=this.getMailMessageModel(),r=document.createElement("option"),r.innerText=t.get("irmTemplateName"),r.value=t.get("irmTemplateId"),this._irmTemplateField.add(r),e={id:t.get("irmTemplateId"),name:t.get("irmTemplateName"),description:t.get("irmTemplateDescription")},u=this._irmTemplateField.options.length-1);this._irmTemplateField.selectedIndex=u;this._updateIrm(e)};n._setElementVisibility=function(){var r=this.getMailMessageModel(),u=this.getComponentCache().getComponent("Compose.HeaderController"),n;var t=r.get("irmTemplateId")==="",f=Jx.isNullOrUndefined(this._templates)||this._templates.count===0,e=u.getCurrentState()===Compose.HeaderController.State.editCondensed,i=(f||e)&&t,o=i||t,s=Compose.doc.querySelectorAll(".irmElement");Array.prototype.forEach.call(s,function(n){i?n.classList.add("hidden"):n.classList.remove("hidden")});n=this._getDescriptionElement();o?n.classList.add("hidden"):n.classList.remove("hidden")};n._noRestrictionValue="-1"});Jx.delayGroup("MailCompose",function(){Compose.Subject=function(){Compose.Component.call(this);this._subjectLine=null;this._initialValue=null;this._bindings=null;this._scrollingIntoViewPaused=false};Jx.augment(Compose.Subject,Compose.Component);Compose.util.defineClassName(Compose.Subject,"Compose.Subject");var n=Compose.Subject.prototype;n.composeGetUI=function(n){n.html=Compose.Templates.subject()};n.composeActivateUI=function(){var n=this._subjectLine=this.getComposeRootElement().querySelector(".composeSubjectLine"),t=this.getComposeRootElement().querySelector(".composeSubjectParent");this._bindings=Compose.binder.attach(this,[{on:"click",from:t,then:function(){setImmediate(function(){n.focus()})}},{on:"blur",from:n,then:function(){var t=n.createTextRange();t.offsetTop>=0&&!this._scrollingIntoViewPaused&&(Compose.mark("Subject.scrollIntoView",Compose.LogEvent.start),t.scrollIntoView(),Compose.mark("Subject.scrollIntoView",Compose.LogEvent.stop))}},{on:"change",from:n,then:function(){Jx.EventManager.fire(null,"subjectChanged",{subject:this.getSubject()})}}])};n.composeDeactivateUI=function(){Compose.binder.detach(this._bindings);this._bindings=null};n.composeUpdateUI=function(){var n=this.getMailMessageModel();Compose.mark("setSubject",Compose.LogEvent.start);this._subjectLine.value=this._initialValue=n.get("subject");Compose.mark("setSubject",Compose.LogEvent.stop)};n.updateModel=function(n){return this.getMailMessageModel().set({subject:this.getSubject().replace(/^\s+|\s+$/g,"")}),Compose.Component.prototype.updateModel.call(this,n)};n.getSubject=function(){return this._subjectLine.value};n.focus=function(){this._subjectLine.focus()};n.isActiveElement=function(){return Compose.doc.activeElement===this._subjectLine};n.isDirty=function(){return this.getSubject()!==this._initialValue};n.pauseScrollingIntoView=function(){this._scrollingIntoViewPaused=true};n.resumeScrollingIntoView=function(){this._scrollingIntoViewPaused=false}});Jx.delayGroup("MailCompose",function(){function t(n){var t=Compose.platform.accountManager;return t.loadAccount(n)}Compose.ToCcBcc=function(){Compose.Component.call(this);var n=Compose.platform;this._controls={to:new AddressWell.Controller("to",null,n,true),cc:new AddressWell.Controller("cc",null,n,true),bcc:new AddressWell.Controller("bcc",null,n,true)};this._errorElement=null;this._bccElement=null;this._labelElements={to:null,cc:null,bcc:null};this._errorAriaElements={to:null,cc:null,bcc:null};this._lastAccountId=null;this._bindings=null;this._controlsActivated=false};Jx.inherit(Compose.ToCcBcc,Jx.Events);Jx.augment(Compose.ToCcBcc,Compose.Component);Compose.util.defineClassName(Compose.ToCcBcc,"Compose.ToCcBcc");var n=Compose.ToCcBcc.prototype;n.composeGetUI=function(n){var t=this._controls;n.html=Compose.Templates.toCcBcc({to:Jx.getUI(t.to).html,cc:Jx.getUI(t.cc).html,bcc:Jx.getUI(t.bcc).html})};n.composeActivateUI=function(){var t=this,n,u,r;if(!this._controlsActivated){n=Compose.doc;u=this.getComposeRootElement();this._controlsActivated=true;var s=this._errorElement=u.querySelector(".addressWellError"),i=Jx.res.getString("/addresswellstrings/awPickerLink"),f=Jx.res.getString("composeTo"),e=Jx.res.getString("composeCc"),o=Jx.res.getString("composeBcc");this._labelElements.to=n.getElementById("addressbarToFieldLabel");this._labelElements.to.setAttribute("aria-label",Jx.res.loadCompoundString("composePickerLabel",f,i));this._labelElements.cc=n.getElementById("addressbarCcFieldLabel");this._labelElements.cc.setAttribute("aria-label",Jx.res.loadCompoundString("composePickerLabel",e,i));this._labelElements.bcc=n.getElementById("addressbarBccFieldLabel");this._labelElements.bcc.setAttribute("aria-label",Jx.res.loadCompoundString("composePickerLabel",o,i));r=this._controls;Object.keys(r).forEach(function(n){var i=r[n];i.activateUI();i.addListener(AddressWell.Events.addressWellBlur,function(){var r,u;i.getIsDirty()&&(r=t.getMailMessageModel(),r&&(u={},u[n]=i.getRecipientsStringInNameEmailPairs(),r.set(u),i.getError()?t._errorAriaElements[n].innerText=Jx.res.getString("composeToErrorDescription"):(t._errorAriaElements[n].innerText="",s.innerText="")))});i.addListener(AddressWell.Events.autoResolveSuccessful,function(){t.raiseEvent("autoresolvecompleted",{type:n})})});this._errorAriaElements.to=n.getElementById("addressbarToErrorDescription");this._errorAriaElements.cc=n.getElementById("addressbarCcErrorDescription");this._errorAriaElements.bcc=n.getElementById("addressbarBccErrorDescription");n.getElementById("addressbarToDescription").innerText=Jx.res.loadCompoundString("composeToDescription",f);n.getElementById("addressbarCcDescription").innerText=Jx.res.loadCompoundString("composeToDescription",e);n.getElementById("addressbarBccDescription").innerText=Jx.res.loadCompoundString("composeToDescription",o);this._controls.to.setLabelledBy("addressbarToDescription addressbarToErrorDescription");this._controls.cc.setLabelledBy("addressbarCcDescription addressbarCcErrorDescription");this._controls.bcc.setLabelledBy("addressbarBccDescription addressbarBccErrorDescription");this._controls.to.setAriaFlow(this._labelElements.to.id,this._labelElements.cc.id)}this._bindings=this.getComponentBinder().attach(this,[{on:"displayvalidstate",fromComponent:Compose.ComponentBinder.validationViewControllerClassName,then:this._displayValidState},{on:"changed",fromComponent:Compose.ComponentBinder.messageModelClassName,then:this._onMessageModelChange},{on:"changed",fromComponent:"Compose.HeaderController",then:this._onHeaderStateChange},{on:"click",from:this._labelElements.to,then:function(){t.launchPeoplePicker("to")}},{on:"click",from:this._labelElements.cc,then:function(){t.launchPeoplePicker("cc")}},{on:"click",from:this._labelElements.bcc,then:function(){t.launchPeoplePicker("bcc")}}])};n.composeDeactivateUI=function(){var n=this._controls;Object.keys(n).forEach(function(t){n[t].cancelPendingSearches()});this.getComponentBinder().detach(this._bindings);this._bindings=null};n.composeUpdateUI=function(){this.clear();this._onMessageModelChange();this._updateCcAndBccAriaFlow()};n.clear=function(){var n=this._controls,t=this._errorAriaElements;Object.keys(n).forEach(function(i){n[i].clear();t[i].innerText=""});this._errorElement.innerText=""};n.onEntranceComplete=function(){var t;Compose.log("addRecipients",Compose.LogEvent.start);var n=this._controls,i=this._errorAriaElements,r=this.getMailMessageModel();Object.keys(n).forEach(function(t){var u=r.get(t);Jx.isNonEmptyString(u)&&(n[t].addRecipientsByString(u),n[t].getError()&&(i[t].innerText=Jx.res.getString("composeToErrorDescription")));n[t].resetIsDirty()});Compose.log("addRecipients",Compose.LogEvent.stop);t=Compose.util.getHeaderController(this.getComponentCache());t.setDefaultState()};n.ensureUpdateModel=function(){var n=this.getMailMessageModel();n.set({to:this.getRecipientsStringInNameEmailPairs("to"),cc:this.getRecipientsStringInNameEmailPairs("cc"),bcc:this.getRecipientsStringInNameEmailPairs("bcc")})};n.updateModel=function(n){return this.ensureUpdateModel(),Compose.Component.prototype.updateModel.call(this,n)};n.composeValidate=function(n){return n==="save"?true:this._validateRecipients()};n.isToEmpty=function(){var n=this.getMailMessageModel().get("to");return!Jx.isNonEmptyString(n)};n.getRecipients=function(n){return this._controls[n].getRecipients()};n.getRecipientsStringInNameEmailPairs=function(n){return this._controls[n].getRecipientsStringInNameEmailPairs()};n.focus=function(n,t){t&&this._controls[n].setAutoSuggestOnFocus(false);this._controls[n].focusInput()};n.launchPeoplePicker=function(n){this._controls[n].launchPeoplePicker()};n.setDisabled=function(n){var t,i;t=this._controls;Object.keys(t).forEach(function(i){t[i].setDisabled(n)});i=this._labelElements;Object.keys(i).forEach(function(t){i[t].disabled=n})};n.isDirty=function(){var n=this._controls;return Object.keys(n).reduce(function(t,i){return t||n[i].getIsDirty()},false)};n.isVisible=function(n){var i=Compose.util.getHeaderController(this.getComponentCache()),t=i.getCurrentState();return n==="bcc"?t===Compose.HeaderController.State.editFull||t===Compose.HeaderController.State.editCondensed&&!this._getBccElement().classList.contains("hidden"):t!==Compose.HeaderController.State.readOnly};n.hasError=function(n){return this._controls[n].getRecipients().length>0&&this._controls[n].getError()};n._onMessageModelChange=function(){this._setMailAccount(this.getMailMessageModel().get("accountId"))};n._onHeaderStateChange=function(n){var t=this.getComposeRootElement().querySelectorAll(".bccElement"),i=n.newState===Compose.HeaderController.State.editCondensed&&!Boolean(this.getMailMessageModel().get("bcc"));Array.prototype.forEach.call(t,function(n){i?n.classList.add("hidden"):n.classList.remove("hidden")});setImmediate(function(){this._updateCcAndBccAriaFlow()}.bind(this))};n._updateCcAndBccAriaFlow=function(){var t=this.getComponentCache().getComponent("Compose.DOMFocus"),n;Jx.isObject(t)&&(n=t.getAfterBccFocusComponent(),Jx.isObject(n)&&(this._labelElements.bcc.classList.contains("hidden")?this._controls.cc.setAriaFlow(this._labelElements.cc.id,n.focusableElementId()):(this._controls.cc.setAriaFlow(this._labelElements.cc.id,this._labelElements.bcc.id),this._controls.bcc.setAriaFlow(this._labelElements.bcc.id,n.focusableElementId()))))};n._getBccElement=function(){return this._bccElement||(this._bccElement=Compose.doc.getElementById("addressbarBccField")),this._bccElement};n._setMailAccount=function(n){var i,r;Jx.isNonEmptyString(n)?n!==this._lastAccountId&&(i=t(n),Boolean(i)?(this._lastAccountId=n,r=this._controls,Object.keys(r).forEach(function(n){r[n].setContextualAccount(i)})):this._lastAccountId=null):this._lastAccountId=null};n._displayValidState=function(n){var r,u;if(n.invalidControls.indexOf(this.getClassName())!==-1){var t=this._getControlErrors(),i=this._errorElement,f=Compose.util.getHeaderController(this.getComponentCache());f.changeState(Compose.HeaderController.State.editFull);r=false;u=this;Object.keys(t).filter(function(n){return!Jx.isNullOrUndefined(t[n])}).forEach(function(n){r||(u.focus(n,true),r=true)});i.innerText="";Object.keys(t).forEach(function(n){i.innerText===""&&(i.innerText=t[n]||"")})}};n._validateRecipients=function(){var n=this._getControlErrors(),t=Object.keys(n).every(function(t){return!Jx.isNonEmptyString(n[t])});return t&&(this._errorElement.innerText=""),t};n._getControlErrors=function(){var i=this._controls,n={to:null,cc:null,bcc:null},t;return Object.keys(i).forEach(function(t){n[t]=this.getRecipientsStringInNameEmailPairs(t)}.bind(this)),t={to:null,cc:null,bcc:null},n.cc&&(t.cc=i.cc.getError()),n.bcc&&(t.bcc=i.bcc.getError()),!Boolean(n.to)&&(n.cc||n.bcc)||(t.to=i.to.getError()),t};Debug.ToCcBcc={isValidControlType:function(n){return["to","cc","bcc"].indexOf(n)!==-1},assertIsValidControlType:function(){}}});Jx.delayGroup("MailCompose",function(){Compose.AttachmentWell=function(){Compose.Component.call(this);this._filePickerShowing=false;this._attachmentWellModule=null;this._attachmentArea=null};Jx.augment(Compose.AttachmentWell,Compose.Component);Compose.util.defineClassName(Compose.AttachmentWell,"Compose.AttachmentWell");var n=Compose.AttachmentWell.prototype;n.getProgressBarHTML=function(){return Compose.Templates.attachmentWellProgressBar()};n.getAttachmentAreaHTML=function(){return Compose.Templates.attachmentWellArea()};n.composeActivateUI=function(){var n=this.getComposeRootElement(),t;t=this.getComponentCache();this._attachButton=t.getComponent("Compose.AttachButton");this._neighborElement=t.getComponent("Compose.BodyComponent").getCanvasDiv();this._attachmentArea=n.querySelector(".composeAttachmentArea");this._contentScrollArea=n.querySelector(".composeContentScrollArea");this._statusProgressBar=n.querySelector(".compose-progress-bar");Jx.EventManager.addListener(null,"attachcomplete",this._onAttachComplete,this);Jx.EventManager.addListener(null,"attachstarted",this._onAttachStarted,this);Jx.EventManager.addListener(null,"hide",this._onHide,this)};n.deactivateUI=function(){Jx.EventManager.removeListener(null,"attachcomplete",this._onAttachComplete,this);Jx.EventManager.removeListener(null,"attachstarted",this._onAttachStarted,this);Jx.EventManager.removeListener(null,"hide",this._onHide,this);this._hideProgressBar();this._shutdownAttachmentWellFrame();Compose.Component.prototype.deactivateUI.call(this)};n.composeUpdateUI=function(){this._shutdownAttachmentWellFrame();this.getMailMessageModel().get("hasOrdinaryAttachments")&&this._ensureAttachmentWellFrame()};n.attachAnyFiles=function(){this._attachFiles(["*"])};n.discard=function(){this._hideProgressBar();this._attachmentWellModule&&this._attachmentWellModule.discard()};n.updateModel=function(n){var t=this.getMailMessageModel();return n==="send"?this._attachmentWellModule&&this._attachmentWellModule.finalizeForSend():t.set({photoMailFlags:t.get("photoMailFlags")&-2}),Compose.Component.prototype.updateModel.call(this,n)};n.composeValidate=function(n){return n==="save"?true:!Jx.isObject(this._attachmentWellModule)||this._attachmentWellModule.validate()};n.isDirty=function(){return this._attachmentWellModule?this._attachmentWellModule.isDirty:false};n.isHidden=function(){return!Jx.isObject(this._attachmentWellModule)||this._attachmentWellModule.isHidden()};n.focus=function(){Jx.isObject(this._attachmentWellModule)&&this._attachmentWellModule.focus()};n.getCount=function(){var n=this._attachmentWellModule;return n?n.getMetrics().count:0};n._onHide=function(){this._attachButton.focus()};n._onAttachStarted=function(){Jx.mark("Mail.Compose.AttachmentWell._onAttachStarted,Info,Compose.AttachmentWell");this._contentScrollArea.scrollTop=0;this._showProgressBar()};n._onAttachComplete=function(){Jx.mark("Mail.Compose.AttachmentWell._onAttachComplete,Info,Compose.AttachmentWell");this._hideProgressBar()};n._showProgressBar=function(){this._statusProgressBar&&this._statusProgressBar.setAttribute("aria-hidden","false")};n._hideProgressBar=function(){this._statusProgressBar&&this._statusProgressBar.setAttribute("aria-hidden","true")};n._attachFiles=function(n){var r,i,t;this._filePickerShowing||(this._filePickerShowing=true,this._ensureAttachmentWellFrame(),r=this.getComponentCache().getComponent("Compose.Subject"),Jx.EventManager.fire(null,"subjectChanged",{subject:r.getSubject()}),i=Windows.Storage.Pickers,t=new i.FileOpenPicker,t.fileTypeFilter.replaceAll(n),t.settingsIdentifier="ModernCompose.ComposeWindow",t.suggestedStartLocation=i.PickerLocationId.picturesLibrary,t.viewMode=i.PickerViewMode.list,t.commitButtonText=Jx.res.getString("attachCommand"),t.pickMultipleFilesAsync().then(function(n){Jx.isObject(this._attachmentWellModule)&&n.size!==0&&this._attachmentWellModule.add(n)}.bind(this)).done(function(){this._filePickerShowing=false}.bind(this),function(){this._filePickerShowing=false}.bind(this)))};n._shutdownAttachmentWellFrame=function(){Jx.isObject(this._attachmentWellModule)&&(this._attachmentWellModule.shutdownUI(),this._attachmentWellModule=null)};n._ensureAttachmentWellFrame=function(){var n,t;Compose.log("ensureAttachmentWellFrame",Compose.LogEvent.start);Jx.isObject(this._attachmentWellModule)||(n=this.getMailMessageModel(),n.isCommitted()||n.commit(),t=n.getPlatformMessage(),this._attachmentWellModule=new AttachmentWell.Compose.Module(Compose.platform.mailManager,t,this._neighborElement),this._attachmentWellModule.initUI(this._attachmentArea),Jx.res.processAll(this._attachmentArea),WinJS.UI.Animation.createExpandAnimation(this._attachmentArea).execute());Compose.log("ensureAttachmentWellFrame",Compose.LogEvent.stop)}});Jx.delayGroup("MailCompose",function(){Compose.AutoSaver=function(){Compose.Component.call(this);this._autoSaveTimerId=null;this._lastSaveTime=null;this._autoSaveJob=null;this._bindings=null;this._suspended=false};Jx.augment(Compose.AutoSaver,Compose.Component);Compose.util.defineClassName(Compose.AutoSaver,"Compose.AutoSaver");Compose.AutoSaver.Delay=18e4;var n=Compose.AutoSaver.prototype;n.composeActivateUI=function(){this._bindings=this.getComponentBinder().attach(this,[{on:"msvisibilitychange",from:Compose.doc,then:this._visibilityChanged},{on:"aftercommit",fromComponent:Compose.ComponentBinder.messageModelClassName,then:this._updateLastSaveTime},{on:"suspending",from:Jx.activation,then:this._onSuspending},{on:"resuming",from:Jx.activation,then:this._onResuming}])};n.composeDeactivateUI=function(){this.getComponentBinder().detach(this._bindings);this._bindings=null};n.composeUpdateUI=function(){this._updateLastSaveTime();this._onAutoSaveTimer()};n.clear=function(){Jx.dispose(this._autoSaveJob);this._autoSaveJob=null;this._autoSaveTimerId&&(window.clearTimeout(this._autoSaveTimerId),this._autoSaveTimerId=null)};n._updateLastSaveTime=function(){this._lastSaveTime=Date.now()};n._onAutoSaveTimer=function(){if(this.clear(),!Compose.doc.msHidden){var n=Compose.AutoSaver.Delay,t=Date.now()-this._lastSaveTime;t>=n?(Mail.Utilities.ComposeHelper.isComposeShowing&&(this._autoSaveJob=Jx.scheduler.addJob(null,Mail.Priority.composeAutoSave,"Compose.AutoSaver - run auto save",this._save,this)),this._autoSaveTimerId=window.setTimeout(this._onAutoSaveTimer.bind(this),n)):this._autoSaveTimerId=window.setTimeout(this._onAutoSaveTimer.bind(this),n-t)}};n._onSuspending=function(){this.clear();this._suspended=true};n._onResuming=function(){this._suspended=false;this._onAutoSaveTimer()};n._visibilityChanged=function(){if(!this._suspended)if(Compose.doc.msHidden){var n=Mail.Utilities.ComposeHelper;n.isComposeShowing&&(n.setDirty(),this._save())}else this._updateLastSaveTime(),Boolean(this._autoSaveTimerId)||this._onAutoSaveTimer()};n._save=function(){Compose.ComposeImpl.quietSave(this.getComponentCache())}});Jx.delayGroup("MailCompose",function(){Compose.DOMFocus=function(){Compose.Component.call(this);this._bindings=null};Jx.augment(Compose.DOMFocus,Compose.Component);Compose.util.defineClassName(Compose.DOMFocus,"Compose.DOMFocus");var n=Compose.DOMFocus.prototype;n.composeActivateUI=function(){var n=Compose.ComposeImpl.getComposeWindow(this.getComponentCache()),t;n.addEventListener("MSPointerDown",this._onMSPointerDown,true);n.addEventListener("focus",this._onFocus,true);n.addEventListener("beforedeactivate",this._onBeforeDeactivate,true);t=[{selector:".compose-after-delete-tab-anchor",fn:this._onAfterDeleteAnchorFocus},{selector:".compose-before-readOnlyHeader-tab-anchor",fn:this._onBeforeReadOnlyHeaderFocus},{selector:".compose-before-to-tab-anchor",fn:this._onBeforeToFocus},{selector:".compose-before-toccbcc-tab-anchor",fn:this._deleteButtonFocus},{selector:".compose-after-toccbcc-tab-anchor",fn:this._onAfterToCcBccFocus},{selector:".compose-after-bcc-tab-anchor",fn:this._onAfterBccFocus},{selector:".compose-before-expand-tab-anchor",fn:this._onBeforeExpandButtonFocus},{selector:".compose-to-subject-tab-anchor",fn:this._subjectFocus},{selector:".compose-before-priority-tab-anchor",fn:this._onBeforePriorityFocus},{selector:".compose-after-priority-tab-anchor",fn:this._onAfterPriorityFocus},{selector:".compose-before-irm-tab-anchor",fn:this._onBeforeIrmFocus},{selector:".compose-after-irm-tab-anchor",fn:this._onAfterIrmFocus},{selector:".compose-before-subject-tab-anchor",fn:this._onBeforeSubjectFocus},{selector:".compose-before-back-tab-anchor",fn:this._onBeforeBackButtonFocus},{selector:".compose-after-back-tab-anchor",fn:this._onAfterBackButtonFocus},{selector:".compose-before-newSnap-tab-anchor",fn:this._onBeforeButtonAreaFocus},{selector:".compose-before-from-tab-anchor",fn:this._onBeforeFromFocus},{selector:".compose-after-from-tab-anchor",fn:this._toAWFocus},{selector:".compose-after-backSnap-tab-anchor",fn:this._onAfterBackButtonFocus},{selector:".compose-before-backSnap-tab-anchor",fn:this._onBeforeBackButtonFocus},{selector:".compose-after-deleteSnap-tab-anchor",fn:this._onAfterDeleteAnchorFocus},{selector:".compose-before-new-tab-anchor",fn:this._onBeforeButtonAreaFocus},{selector:".before-compose-tab-anchor",fn:this._bodyFocus}];this._bindings=[];t.forEach(function(n){var t=Compose.doc.querySelector(n.selector);this._bindings.push(Compose.binder.attach(this,[{on:"focus",from:t,then:n.fn}])[0])}.bind(this))};n.composeDeactivateUI=function(){var n=Compose.ComposeImpl.getComposeWindow(this.getComponentCache());n.removeEventListener("MSPointerDown",this._onMSPointerDown,true);n.removeEventListener("focus",this._onFocus,true);n.removeEventListener("beforedeactivate",this._onBeforeDeactivate,true);Compose.binder.detach(this._bindings);this._bindings=null};n._onMSPointerDown=function(n){n.target.setAttribute("data-focusfrompointer","true")};n._onFocus=function(n){var t=n.target.querySelector("[data-focusfrompointer='true']");t&&(t.removeAttribute("data-focusfrompointer"),n.target.setAttribute("data-focusfrompointer","true"))};n._onBeforeDeactivate=function(n){n.target.removeAttribute("data-focusfrompointer")};n._isSmallerView=function(){var r=Mail.guiState.width,i=Jx.ApplicationView,n=i.State,t=i.getStateFromWidth(r);return t===n.snap||t===n.minimum||t===n.less||t===n.more||t===n.large};n._focusOnElementWithSelector=function(n){var t=Compose.doc.querySelector(n);t&&t.focus()};n._onAfterDeleteAnchorFocus=function(){var n=this.getComponentCache().getComponent("Compose.ToCcBcc"),t;n.isVisible("bcc")?this._focusOnElementWithSelector("#addressbarBccFieldLabel"):n.isVisible("cc")?this._focusOnElementWithSelector("#addressbarCcFieldLabel"):n.isVisible("to")?this._focusOnElementWithSelector("#addressbarToFieldLabel"):this._focusOnComponentIfVisible("Compose.BackButton")||(t=this.getComponentCache().getComponent("Compose.ReadOnlyHeader"),t.focus())};n._onBeforeToFocus=function(){var n=this.getComponentCache().getComponent("Compose.From");n.isVisible()?this._fromControlFocus():this._focusOnComponentIfVisible("Compose.BackButton")||this._toPickerFocus()};n._onAfterBackButtonFocus=function(){if(!this._focusOnComponentIfVisible("Compose.ReadOnlyHeader")){var n=this.getComponentCache().getComponent("Compose.From");n.isVisible()?this._fromControlFocus():this._toAWFocus()}};n._fromControlFocus=function(){this._focusOnElementWithSelector(".fromControl-wrapper")};n._onBeforeReadOnlyHeaderFocus=function(){this._focusOnComponentIfVisible("Compose.BackButton")||this._deleteButtonFocus()};n._deleteButtonFocus=function(){var n=this._focusOnComponentIfVisible("Compose.DeleteButton")};n._onAfterToCcBccFocus=function(){if(!this._focusOnComponentIfVisible("Compose.BackButton")){var n=this.getComponentCache().getComponent("Compose.From");n.isVisible()?this._fromControlFocus():this._toAWFocus()}};n._onBeforeBackButtonFocus=function(){var n=this.getComponentCache().getComponent("Compose.ToCcBcc");n.isVisible("to")?this._toPickerFocus():this._deleteButtonFocus()};n._toPickerFocus=function(){this._focusOnElementWithSelector("#addressbarToFieldLabel")};n._awFocus=function(n){var t=this.getComponentCache().getComponent("Compose.ToCcBcc");t.focus(n)};n._toAWFocus=function(){this._awFocus("to")};n._subjectFocus=function(){this._focusOnElementWithSelector(".composeSubjectLine")};n._focusOnComponentIfVisible=function(n){var t=this.getComponentCache().getComponent(n);return t.isVisible()?(t.focus(),true):false};n._onAfterBccFocus=function(){var n=this.getAfterBccFocusComponent();n.focus()};n._getFirstVisibleComponent=function(n){var t=null,i=this.getComponentCache();return n.some(function(n){var r=i.getComponent(n);return r.isVisible()?(t=r,true):false}),t};n.getAfterBccFocusComponent=function(){return this._isSmallerView()?this._getFirstVisibleComponent(["Compose.Priority","Compose.IrmChooser","Mail.ExpandButton"]):this._getFirstVisibleComponent(["Compose.IrmChooser","Compose.Priority","Mail.ExpandButton"])};n._focusOnLowestAddressWell=function(){var n=this.getComponentCache().getComponent("Compose.ToCcBcc");n.isVisible("bcc")?n.focus("bcc"):n.focus("cc")};n._onBeforePriorityFocus=function(){this._isSmallerView()?this._focusOnLowestAddressWell():this._focusOnComponentIfVisible("Compose.IrmChooser")||this._focusOnLowestAddressWell()};n._onAfterPriorityFocus=function(){this._isSmallerView()?this._focusOnComponentIfVisible("Compose.IrmChooser")||this._focusOnComponentIfVisible("Mail.ExpandButton")||this._subjectFocus():this._focusOnComponentIfVisible("Mail.ExpandButton")||this._subjectFocus()};n._onBeforeIrmFocus=function(){this._isSmallerView()&&this._focusOnComponentIfVisible("Compose.Priority")||this._focusOnLowestAddressWell()};n._onAfterIrmFocus=function(){if(this._isSmallerView())this._focusOnComponentIfVisible("Mail.ExpandButton")||this._subjectFocus();else if(!this._focusOnComponentIfVisible("Compose.Priority"))var n=this._focusOnComponentIfVisible("Mail.ExpandButton")};n._onBeforeExpandButtonFocus=function(){this._isSmallerView()?this._focusOnComponentIfVisible("Compose.IrmChooser")||this._focusOnComponentIfVisible("Compose.Priority")||this._focusOnLowestAddressWell():this._focusOnComponentIfVisible("Compose.Priority")||this._focusOnComponentIfVisible("Compose.IrmChooser")||this._focusOnLowestAddressWell()};n._onBeforeSubjectFocus=function(){var n,t=this.getComponentCache().getComponent("Compose.ReadOnlyHeader");t.isVisible()?this._focusOnElementWithSelector(".cmdEditHeader"):this._focusOnComponentIfVisible("Mail.ExpandButton")||(this._isSmallerView()?this._focusOnComponentIfVisible("Compose.IrmChooser")||(n=this._focusOnComponentIfVisible("Compose.Priority")):n=this._focusOnComponentIfVisible("Compose.Priority"))};n._bodyFocus=function(){var n=this.getComponentCache().getComponent("Compose.BodyComponent");n.focus()};n._onBeforeFromFocus=function(){this._focusOnComponentIfVisible("Compose.BackButton")||this._toPickerFocus()};n._onBeforeButtonAreaFocus=function(){if(Mail.guiState.isOnePane)this._bodyFocus();else{var n=document.getElementById("mailMessageListCollection");n.focus()}}});Jx.delayGroup("MailCompose",function(){Compose.KeyboardResizer=function(){Compose.Component.call(this);this._inputPaneHandle=null;this._peekBarHeight=Jx.PeekBar.height;this._keyboardAdjusted=false;this._mainFrame=null;this._bindings=null;this._paused=false};Jx.augment(Compose.KeyboardResizer,Compose.Component);Compose.util.defineClassName(Compose.KeyboardResizer,"Compose.KeyboardResizer");var n=Compose.KeyboardResizer.prototype;n.composeActivateUI=function(){var i=this.getComposeRootElement(),n,t;this._mainFrame=i.querySelector(".composeContentScrollArea");n=this._inputPaneHandle=Compose.InputPane.getForCurrentView();t=n.occludedRect.height;t>0?(t-=this._peekBarHeight,this._keyboardAdjusted=true):this._keyboardAdjusted=false;this._mainFrame.style.bottom=t+"px";this._bindings=Compose.binder.attach(this,[{on:"showing",from:n,then:this._keyboardUp},{on:"hiding",from:n,then:this._keyboardDown}])};n.composeDeactivateUI=function(){Compose.binder.detach(this._bindings)};n.pause=function(){this._paused=true};n.resume=function(){this._paused=false;var n=this._inputPaneHandle.occludedRect.height;n>0?(n-=this._peekBarHeight,this._keyboardAdjusted=true):this._keyboardAdjusted=false;this._mainFrame.style.bottom=n+"px"};n.isAdjustingForKeyboard=function(){return this._keyboardAdjusted};n._keyboardUp=function(n){if(Mail.isElementOrDescendant(document.activeElement,document.getElementById(Mail.CompApp.rootElementId))&&(n.ensuredFocusedElementInView=true),!this._paused){var t=n.occludedRect.height-this._peekBarHeight+"px";this._mainFrame.style.bottom=t;this._keyboardAdjusted=true;Compose.WinJsUI.executeAnimation(this._mainFrame,{property:"bottom",delay:0,duration:367,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",from:"0px",to:t}).done(null,function(){})}};n._keyboardDown=function(){if(!this._paused){var n=this._mainFrame.style.bottom;this._mainFrame.style.bottom="0px";this._keyboardAdjusted=false;Compose.WinJsUI.executeAnimation(this._mainFrame,{property:"bottom",delay:0,duration:367,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",from:n,to:"0px"}).done(null,function(){})}}});Jx.delayGroup("MailCompose",function(){Compose.HeaderController=function(){Compose.Component.call(this);this._currentState=null};Jx.inherit(Compose.HeaderController,Jx.Events);Jx.augment(Compose.HeaderController,Compose.Component);Compose.util.defineClassName(Compose.HeaderController,"Compose.HeaderController");Compose.HeaderController.State={readOnly:"header-readonly",editCondensed:"header-edit-condensed",editFull:"header-edit-full"};var n=Compose.HeaderController.prototype;n.composeUpdateUI=function(){var n=this.getDefaultState();this.changeState(n)};n.changeState=function(n){if(this._currentState!==n){Compose.mark("HeaderController.changeState",Compose.LogEvent.start);var i={oldState:this._currentState,newState:n},t=Compose.ComposeImpl.getComposeWindow(this.getComponentCache());Jx.isNullOrUndefined(this._currentState)||t.classList.remove(this._currentState);Jx.isNullOrUndefined(n)||t.classList.add(n);this._currentState=n;this.raiseEvent("changed",i);Compose.mark("HeaderController.changeState",Compose.LogEvent.stop)}};n.getCurrentState=function(){return this._currentState};n.getDefaultState=function(){var t=this.getMailMessageModel(),r=t.get("to"),u=t.get("cc"),f=t.get("bcc"),i=this.getComponentCache().getComponent("Compose.ToCcBcc"),e=r.length===0&&u.length===0&&f.length===0,n,o;return n=Compose.HeaderController.State,o=null,i.hasError("bcc")?n.editFull:e||i.hasError("to")||i.hasError("cc")?n.editCondensed:n.readOnly};n.setDefaultState=function(){var i=Compose.HeaderController.State,n=this.getDefaultState(),t;n!==this.getCurrentState()&&(t=function(){this.changeState(n)}.bind(this),n===i.readOnly?Compose.ComposeImpl.quietSave(this.getComponentCache()).done(t):t())}});Jx.delayGroup("MailCompose",function(){Compose.ReadOnlyHeader=function(){Compose.Component.call(this);this._bindings=null;this._editButton=null;this._header=new Mail.HeaderControl(Mail.Utilities.ComposeHelper._selection);this._headerRootDiv=null;this._initializedHeader=false;this._headerControllerComponent=null;this._autoCollapsesHeader=false};Jx.augment(Compose.ReadOnlyHeader,Compose.Component);Compose.util.defineClassName(Compose.ReadOnlyHeader,"Compose.ReadOnlyHeader");var n=Compose.ReadOnlyHeader.prototype;n.composeGetUI=function(n){n.html="<div class='composeReadOnlyHeader'><\/div>"};n.composeActivateUI=function(){if(this._headerRootDiv=this.getComposeRootElement().querySelector(".composeReadOnlyHeader"),!this._initializedHeader){this._header.initialize(this._headerRootDiv);var n=this._headerRootDiv.querySelector(".mailReadingPaneHeaderDetails");this._createEditButton(n);this._initializedHeader=true}this._bindings=this.getComponentBinder().attach(this,[{on:"aftercommit",fromComponent:Compose.ComponentBinder.messageModelClassName,then:this._onPlatformMessageChange},{on:"autoresolvecompleted",fromComponent:"Compose.ToCcBcc",then:this._onRecipientResolution},{on:"click",from:this._editButton,then:this._editHeader}])};n.composeDeactivateUI=function(){this.getComponentBinder().detach(this._bindings);this._bindings=null};n.composeUpdateUI=function(){var t,n,i,r;for(t=this._headerRootDiv.querySelectorAll(".hideOnReload"),n=0,i=t.length;n<i;n++)t[n].classList.add("hidden");r=this.getMailMessageModel();this._autoCollapsesHeader=true;r.isCommitted()&&this._onPlatformMessageChange();this._autoCollapsesHeader=false};n.isVisible=function(){return this._getHeaderControllerComponent().getCurrentState()===Compose.HeaderController.State.readOnly};n.focus=function(){this._headerRootDiv.querySelector(".mailReadingPaneHeaderIC").focus()};n._createEditButton=function(n){var t=Compose.doc.createElement("div");t.className="editHeaderButtonParent";this._editButton=Compose.doc.createElement("button");this._editButton.setAttribute("type","button");this._editButton.className="cmdEditHeader typeSizeNormal composeLinkButton";this._editButton.innerHTML="<span data-win-res='innerText:composeEditLabel'>WChangeL<\/span>";t.appendChild(this._editButton);n.appendChild(t)};n._onPlatformMessageChange=function(){var n=this.getMailMessageModel(),t=n.get("fromRecipient"),i=Jx.isNullOrUndefined(t)?[]:[t],r=Mail.UIDataModel.MailItem.convertVectorToArray(n.get("toRecipients")),u=Mail.UIDataModel.MailItem.convertVectorToArray(n.get("ccRecipients")),f=Mail.UIDataModel.MailItem.convertVectorToArray(n.get("bccRecipients")),e=this._autoCollapsesHeader?false:this._header.isExpanded();this._header.updateIrmInfo(n.get("irmHasTemplate"),n.get("irmTemplateName"),n.get("irmTemplateDescription"));this._header.updateHeader(r,u,f,i,Jx.res.getString("mailUIMailMessageNoSender"),e,false,false,null)};n._getHeaderControllerComponent=function(){var n=this._headerControllerComponent;return Jx.isNullOrUndefined(n)&&(n=this._headerControllerComponent=this.getComponentCache().getComponent("Compose.HeaderController")),n};n._onRecipientResolution=function(){var n=this._getHeaderControllerComponent().getCurrentState();n===Compose.HeaderController.State.readOnly&&Compose.ComposeImpl.quietSave(this.getComponentCache())};n._editHeader=function(){this._getHeaderControllerComponent().changeState(Compose.HeaderController.State.editCondensed);var n=this.getComponentCache().getComponent("Compose.ToCcBcc");n.focus("to",true)}});Jx.delayGroup("MailCompose",function(){Compose.Button=function(){Compose.Component.call(this);this._normalButton=null;this._snapButton=null};Jx.augment(Compose.Button,Compose.Component);var n=Compose.Button.prototype;n.getFullHTML=function(){return""};n.getSnapHTML=function(){return""};n.getQuerySelector=function(){return""};n.getSnapQuerySelector=function(){return""};n.getClickHandler=function(){return function(){}};n.composeActivateUI=function(){var n=this.getComposeRootElement();this._normalButton=n.querySelector(this.getQuerySelector());this._snapButton=n.querySelector(this.getSnapQuerySelector());this._bindings=Compose.binder.attach(this,[{on:"click",from:this._normalButton,then:this.getClickHandler()},{on:"click",from:this._snapButton,then:this.getClickHandler()}]);this.buttonActivateUI()};n.buttonActivateUI=function(){};n.buttonDeactivateUI=function(){};n.composeDeactivateUI=function(){Compose.binder.detach(this._bindings);this._bindings=null;this.buttonDeactivateUI()};n.isVisible=function(){return true};n.focus=function(){if(this.isActivated()){var n=this._normalButton;n.getComputedStyle().display==="none"&&(n=this._snapButton);n.focus()}};n.performClick=function(){this.getClickHandler().call(this)}});Jx.delayGroup("MailCompose",function(){Compose.BackButton=function(){Compose.Button.call(this);this._extraBindings=null;this._hideKeyboardDisposer=null};Jx.augment(Compose.BackButton,Compose.Button);Compose.util.defineClassName(Compose.BackButton,"Compose.BackButton");var n=Compose.BackButton.prototype;n.getFullHTML=function(){return Compose.Templates.backButton()};n.getSnapHTML=function(){return Compose.Templates.backButtonSnap()};n.getQuerySelector=function(){return".cmdBack"};n.getSnapQuerySelector=function(){return".cmdBackSnap"};n.getClickHandler=function(){return this._handleBack};n.buttonActivateUI=function(){this._extraBindings=Compose.binder.attach(this,[{on:"resize",from:window,then:this._updateVisibility}]);this._hideKeyboardDisposer=new Mail.Disposer(new Mail.KeyboardDismisser(Compose.doc.querySelector(this.getQuerySelector())),new Mail.KeyboardDismisser(Compose.doc.querySelector(this.getSnapQuerySelector())))};n.buttonDeactivateUI=function(){Compose.binder.detach(this._extraBindings);this._extraBindings=null;Jx.dispose(this._hideKeyboardDisposer);this._hideKeyboardDisposer=null};n.show=function(n){Jx.setClass(Compose.doc.querySelector(this.getQuerySelector()),"hidden",!n);Jx.setClass(Compose.doc.querySelector(this.getSnapQuerySelector()),"hidden",!n)};n.isVisible=function(){return(!Compose.doc.querySelector(this.getQuerySelector()).classList.contains("hidden")||!Compose.doc.querySelector(this.getSnapQuerySelector()).classList.contains("hidden"))&&!Compose.doc.querySelector("#mailFrameReadingPaneSection").classList.contains("parentVisible")};n.composeUpdateUI=function(){this._updateVisibility()};n._handleBack=function(){if(Jx.glomManager.getIsParent())Mail.Globals.animator.animateNavigateBack();else{var n=Mail.Utilities.ComposeHelper;n.handleHomeButton()}};n._updateVisibility=function(){this.show(Mail.guiState.isOnePane)}});Jx.delayGroup("MailCompose",function(){Compose.AttachButton=function(){Compose.Button.call(this)};Jx.augment(Compose.AttachButton,Compose.Button);Compose.util.defineClassName(Compose.AttachButton,"Compose.AttachButton");var n=Compose.AttachButton.prototype;n.getFullHTML=function(){return Compose.Templates.attachButton()};n.getSnapHTML=function(){return Compose.Templates.attachButtonSnap()};n.getQuerySelector=function(){return".cmdAttach"};n.getSnapQuerySelector=function(){return".cmdAttachSnap"};n.getClickHandler=function(){return this._attachAnyFiles};n._attachAnyFiles=function(){var n=this.getComponentCache().getComponent("Compose.AttachmentWell");n.attachAnyFiles()}});Jx.delayGroup("MailCompose",function(){Compose.DeleteButton=function(){Compose.Button.call(this);this._extraBindings=null};Jx.augment(Compose.DeleteButton,Compose.Button);Compose.util.defineClassName(Compose.DeleteButton,"Compose.DeleteButton");var n=Compose.DeleteButton.prototype,t=Mail.Instrumentation;n.getFullHTML=function(){return Compose.Templates.deleteButton()};n.getSnapHTML=function(){return Compose.Templates.deleteButtonSnap()};n.getQuerySelector=function(){return".cmdDelete"};n.getSnapQuerySelector=function(){return".cmdDeleteSnap"};n.getClickHandler=function(){return this._deleteAndExit};n.buttonActivateUI=function(){this._extraBindings=Compose.binder.attach(this,[{on:"messagesChanged",from:Mail.Utilities.ComposeHelper._selection,then:this._show}]);this._show()};n.composeUpdateUI=function(){this._show()};n.buttonDeactivateUI=function(){Compose.binder.detach(this._extraBindings);this._extraBindings=null};n._deleteAndExit=function(){var n=Compose.ComposeImpl.getComposeImpl(this.getComponentCache()),e=function(){n.discard()},i=Mail.Utilities.ComposeHelper._selection,r=i.messages,o=r.filter(function(n){return n.hasDraft}),u=o.length,f=this.getMailMessageModel();r.length===1&&(u=n.isDirty()?1:0);Mail.Commands.Handlers.deleteMessages(u,e,t.UIEntryPoint.onCanvas,i)};n._show=function(){var r=this.getMailMessageModel(),n=r.get("objectId"),t=Mail.Utilities.ComposeHelper._selection.message,i=n!=="0"&&t&&t.objectId===n;Compose.doc.querySelector(this.getQuerySelector()).disabled=!i;Compose.doc.querySelector(this.getSnapQuerySelector()).disabled=!i}});Jx.delayGroup("MailCompose",function(){Compose.SendButton=function(){Compose.Button.call(this)};Jx.augment(Compose.SendButton,Compose.Button);Compose.util.defineClassName(Compose.SendButton,"Compose.SendButton");var n=Compose.SendButton.prototype;n.getFullHTML=function(){return Compose.Templates.sendButton()};n.getSnapHTML=function(){return Compose.Templates.sendButtonSnap()};n.getQuerySelector=function(){return".cmdSend"};n.getSnapQuerySelector=function(){return".cmdSendSnap"};n.getClickHandler=function(){return this._sendMail};n._sendMail=function(){Mail.writeProfilerMark("Compose.SendButton._sendMail",Mail.LogEvent.start);Compose.ComposeImpl.getComposeImpl(this.getComponentCache()).send().done(function(n){n.success&&Mail.guiState.ensureNavMessageList();Mail.writeProfilerMark("Compose.SendButton._sendMail",Mail.LogEvent.stop)})}});Jx.delayGroup("MailCompose",function(){Compose.NewButton=function(){Compose.Button.call(this)};Jx.augment(Compose.NewButton,Compose.Button);Compose.util.defineClassName(Compose.NewButton,"Compose.NewButton");var n=Compose.NewButton.prototype;n.getFullHTML=function(){return Compose.Templates.newButton()};n.getSnapHTML=function(){return Compose.Templates.newButtonSnap()};n.getQuerySelector=function(){return".cmdNew"};n.getSnapQuerySelector=function(){return".cmdNewSnap"};n.getClickHandler=function(){return this._newClicked};n.composeUpdateUI=function(){var n=Jx.glomManager.getIsParent();Jx.setClass(Compose.doc.querySelector(this.getQuerySelector()),"hidden",!n);Jx.setClass(Compose.doc.querySelector(this.getSnapQuerySelector()),"hidden",!n)};n._newClicked=function(){Mail.Utilities.ComposeHelper.onNewButton(Mail.Instrumentation.UIEntryPoint.onCanvas)}});Jx.delayGroup("MailCompose",function(){Compose.WarningMessage=function(){Compose.Component.call(this)};Jx.augment(Compose.WarningMessage,Compose.Component);Compose.util.defineClassName(Compose.WarningMessage,"Compose.WarningMessage");var n=Compose.WarningMessage.prototype;n.composeGetUI=function(n){n.html=Compose.Templates.warningMessage()};n.composeUpdateUI=function(){var r=Compose.doc.querySelector(".warningMessage"),n=this.getMailMessageModel(),u=n.get("irmCanEdit"),f=n.get("irmCanExtractContent"),t=false,i;u&&f||(i=Compose.mailMessageFactoryUtil.getSourceMessage(n.getPlatformMessage()),Boolean(i)&&i.hasOrdinaryAttachments&&n.get("sourceVerb")===Microsoft.WindowsLive.Platform.MailMessageLastVerb.forward&&(t=true));r.innerText=t?Jx.res.getString("composeIrmAttachmentWarning"):"";Jx.setClass(r,"hidden",!t)}})