Share.ShareService=function(){this._transcoder=Microsoft.WindowsLive.Photomail.PhotomailTranscoder;this._helper=null};Share.ShareService.prototype._album="";Share.ShareService.prototype._resourceId="";Share.ShareService.prototype._shareObject=null;Share.ShareService.prototype.initiateShare=function(n){if(Jx.isObject(n)){var t=this._helper=new Share.RequestHelper(n.config,n.shareOperation,n.quickLink);Jx.isNonEmptyString(n.mailMessage.to)?t.sendMessageToOutbox(n.mailMessage,n.platform):t.mailSent=true;Jx.isArray(n.networks)&&n.networks.length>0?n.networkShareType!==Share.Data.NetworkType.document&&n.networkShareType!==Share.Data.NetworkType.video&&n.networkShareType!==Share.Data.NetworkType.photo&&t.saStatusUpdate(this._constructStatusMessage(n)):t.networkShareSent=true}else Jx.log.error("shareObject is null or undefined")};Share.ShareService.prototype.cancelShare=function(n){this._helper.cancel(n.mailMessage)};Share.ShareService.prototype._constructStatusMessage=function(n){var t="",r="",i;Jx.isNonEmptyString(n.messageHtml)&&(n.messageHtml.length>520&&Jx.log.error("Text length exceeds limit"),t="<title>"+Jx.escapeHtml(n.messageHtml)+"<\/title> ");switch(n.networkShareType){case Share.Data.NetworkType.link:t=this._createLinkMessage(n.linkData,t);break;case Share.Data.NetworkType.videoEmbed:t=this._createVideoEmbedMessage(n.linkData,t);break;case Share.Data.NetworkType.photo:t+="<live:photo> <live:resourceId>"+this._resourceId+"<\/live:resourceId> <\/live:photo>";break;case Share.Data.NetworkType.video:case Share.Data.NetworkType.document:t+="<live:document> <live:resourceId>"+this._resourceId+"<\/live:resourceId> <\/live:document>";break;default:Jx.log.error("Unsupported Share Object Type: "+n.networkShareType.toString())}for(r+="<live:networks>",i=0;i<n.networks.length;i++)Jx.isObject(n.networks[i])&&Jx.isNonEmptyString(n.networks[i].id)&&(r+="<live:sourceId>"+n.networks[i].id+"<\/live:sourceId>");return r+="<\/live:networks><\/entry>",'<?xml version="1.0" encoding="utf-8"?> <entry xmlns="http://www.w3.org/2005/Atom" xmlns:live="http://api.live.com/schemas" xmlns:ab="http://www.msn.com/webservices/AddressBook" xmlns:georss="http://www.georss.org/georss"> '+t+r};Share.ShareService.prototype._createLinkMessage=function(n,t){var i=Jx.escapeHtml;return Jx.isNonEmptyString(n.url)?t+='<link rel="related" href="'+i(n.url)+'" /> <live:page> ':Jx.log.error("Url is undefined or null"),Jx.isNonEmptyString(n.description)&&(t+="<content>"+i(n.description)+"<\/content> "),Jx.isNonEmptyString(n.thumbnailUrl)&&(t+='<link rel="http://api.live.com/schemas#thumbnail" href="'+i(n.thumbnailUrl)+'" /> '),Jx.isNonEmptyString(n.title)&&(t+="<title>"+i(n.title)+"<\/title> "),t+"<\/live:page> "};Share.ShareService.prototype._createVideoEmbedMessage=function(n,t){var r=Jx.escapeHtml,i;return Jx.isNonEmptyString(n.url)?t+='<link rel="related" href="'+r(n.url)+'" /> <live:videoEmbed> ':Jx.log.error("Url is undefined or null"),Jx.isNonEmptyString(n.thumbnailUrl)&&(t+='<link rel="http://api.live.com/schemas#thumbnail" href="'+r(n.thumbnailUrl)+'" /> '),Jx.isNonEmptyString(n.description)&&(t+="<summary>"+r(n.description)+"<\/summary> "),Jx.isNonEmptyString(n.title)&&(t+="<title>"+r(n.title)+"<\/title> "),t+="<live:embedParams>src=",i=encodeURIComponent(n.videoUrl),Jx.isNonEmptyString(n.videoWidth)&&Jx.isNonEmptyString(n.videoHeight)&&(i+="&width="+encodeURIComponent(n.videoWidth)+"&height="+encodeURIComponent(n.videoHeight)),Jx.isNonEmptyString(n.flashParams)&&(i+="&flashParams="+encodeURIComponent(n.flashParams)),i=r(i),t+=i,t+("<\/live:embedParams> <live:embedType>"+n.embedType+"<\/live:embedType> <\/live:videoEmbed> ")};Share.ShareService.prototype._continueFileShare=function(n){Jx.log.info("Received response from skydrive.");this._resourceId=n.resourceId};Share.ShareService.prototype.beginFileShare=function(n,t){var i=Windows.Storage.ApplicationData.current.temporaryFolder,r={resizeOption:Microsoft.WindowsLive.Photomail.ImageResizeOption.large,targetSize:0,stripMetadata:false,copyOnFail:true};t===Share.Data.NetworkType.photo?(this._album="quickphotos",Jx.log.info("Began transcoding the file"),this._transcoder.transcodeFileAsync(r,n,i).then(this._transcodeComplete.bind(this),this._resizeError.bind(this))):t===Share.Data.NetworkType.video?(this._album="quickdocuments",Jx.log.info("Began transcoding the file"),this._transcoder.transcodeFileAsync(r,n,i).then(this._transcodeComplete.bind(this),this._transcodeError.bind(this))):(Jx.log.info("Non-photo Non-video upload started."),this._helper.uploadFile(n,"quickdocuments",this._continueFileShare.bind(this)))};Share.ShareService.prototype._transcodeComplete=function(n){Jx.log.info("TranscodeResize completed starting upload.");this._helper.uploadFile(n,this._album,this._continueFileShare.bind(this))};Share.ShareService.prototype._resizeError=function(n){Jx.log.error("Resize error has occured: "+n)};Share.ShareService.prototype._transcodeError=function(n){Jx.log.error("Transcode error has occured: "+n)}