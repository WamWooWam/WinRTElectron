Jx.delayDefine(window,"MenuArrowKeyHandler",function(){window.MenuArrowKeyHandler=function(n,t){var r,u,f,i;for(t=t||{},t.querySelector=Jx.isString(t.querySelector)?t.querySelector:"[id][role='menuitem']",t.itemsTabbable=("itemsTabbable"in t)?Boolean(t.itemsTabbable):false,t.firstOnFocus=("firstOnFocus"in t)?Boolean(t.firstOnFocus):false,t.enableUp=("enableUp"in t)?Boolean(t.enableUp):true,t.enableDown=("enableDown"in t)?Boolean(t.enableDown):true,t.enableLeft=("enableLeft"in t)?Boolean(t.enableLeft):true,t.enableRight=("enableRight"in t)?Boolean(t.enableRight):true,this._config=t,this._onKeyDown=this._onKeyDown.bind(this),this._focusFirst=this._focusFirst.bind(this),this._menuElement=n,this._menuItemElements=[],this._menuItemElementsMap={},r=n.querySelectorAll(t.querySelector),f=r.length,i=0;i<f;i++)u=r[i],this.pushElement(u);this._hasUI=true};Jx.augment(window.MenuArrowKeyHandler,Jx.Component);MenuArrowKeyHandler.prototype.activateUI=function(){this._menuElement.addEventListener("keydown",this._onKeyDown,false);this._config.firstOnFocus&&this._menuElement.addEventListener("focus",this._focusFirst,false)};MenuArrowKeyHandler.prototype.pushElement=function(n){n.id||(n.id=Jx.uid());var t=this._menuItemElements.push(n);this._menuItemElementsMap[n.id]=t-1;this._config.itemsTabbable||(n.tabIndex=-1)};MenuArrowKeyHandler.prototype.reset=function(){this._menuItemElements=[];this._menuItemElementsMap={}};MenuArrowKeyHandler.prototype._focusFirst=function(){this._setFocus(this._menuItemElements[0])};MenuArrowKeyHandler.prototype.dispose=function(){this._menuElement.removeEventListener("keydown",this._onKeyDown,false);this._config.firstOnFocus&&this._menuElement.removeEventListener("focus",this._focusFirst,false);this._menuItemElements=null;this._menuItemElementsMap=null};MenuArrowKeyHandler.prototype._findMenuItemFromRect=function(n,t,i,r){for(var e=document.msElementsFromRect(n,t,i,r),f,u=0,o=e.length;u<o;u++)if(f=e[u],this._menuItemElementsMap[f.id]!==undefined)return f;return null};MenuArrowKeyHandler.prototype._setFocus=function(n){try{n.classList.add("keyboardFocused");n.focus();var t=function(){n.classList.remove("keyboardFocused");n.removeEventListener("blur",t,false)};n.addEventListener("blur",t,false)}catch(i){}};MenuArrowKeyHandler.prototype._onKeyDown=function(n){var t=n.key,r,i,u,e;if(t==="Right"&&this._config.enableRight||t==="Left"&&this._config.enableLeft||t==="Up"&&this._config.enableUp||t==="Down"&&this._config.enableDown){if(Jx.isRtl()&&(t==="Left"?t="Right":t==="Right"&&(t="Left")),r=document.activeElement,i=this._menuItemElements,!r)return;if(r.id===this._menuElement.id){if(t==="Right"||t==="Up"){this._setFocus(i[0]);return}this._setFocus(i[i.length-1]);return}if(u=this._menuItemElementsMap[r.id],u===undefined)return;if(t==="Right")++u<i.length?(this._setFocus(i[u]),n.preventDefault()):(this._setFocus(i[0]),n.preventDefault());else if(t==="Left")--u>=0?(this._setFocus(i[u]),n.preventDefault()):this._setFocus(i[i.length-1]);else{var f=r.getBoundingClientRect(),h=f.left,o,c=f.width/2,s=f.height-2;o=t==="Up"?f.top-(s+1):f.bottom+1;e=this._findMenuItemFromRect(h,o,c,s);Boolean(e)&&e!==r&&(this._setFocus(e),n.preventDefault())}}}})