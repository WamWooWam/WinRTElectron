Jx.delayDefine(Calendar.Controls,"MonthGrid",function(){function f(n){Jx.mark("Calendar:MonthGrid."+n+",StartTA,Calendar")}function e(n){Jx.mark("Calendar:MonthGrid."+n+",StopTA,Calendar")}function r(n,t){return Array.prototype.slice.call(n.querySelectorAll(t))}function u(n,t,i,r,u,f){for(var s="",e=u;e<f;++e)s+='<div class="day '+n,e<i||r<e?s+=' hidden"':(s+='" aria-label="'+Jx.escapeHtml(o.format(t))+'"',t.setDate(t.getDate()+1)),s+=' role="button"><span>'+e+"<\/span><\/div>";return s}var t=Calendar.Helpers,i={},o=new Jx.DTFormatter("longDate"),n=Calendar.Controls.MonthGrid=function(){this.initComponent();this._today=Calendar.getToday();this._date=new Date(this._today);this._highlightDates=[];this._paused=true;this._changeTimeout=null;this.showFreeBusy=true;this.autoUpdate=true;this.splitSelectFocus=false;this._onClick=this._onClick.bind(this);this._onKeyDown=this._onKeyDown.bind(this);this._onCollectionChanged=this._onCollectionChanged.bind(this);this._handleCollectionChanged=this._handleCollectionChanged.bind(this);n._header||(t.ensureFormats(),n._dayName=new Jx.DTFormatter("{dayofweek.abbreviated(2)}"),n._dayNameAcc=new Jx.DTFormatter("dayofweek"),n._header=new Jx.DTFormatter("month year"))};Jx.augment(n,Jx.Component);n.PREV_MONTH_DAYS=10;n.PREV_MONTH_FIRST_DAY=22;n.MAX_DAYS_PER_MONTH=31;n.NEXT_MONTH_DAYS=13;n.getItem=function(n,t){return new Date(n.getFullYear(),n.getMonth()+t)};n.getIndex=function(n,i){return t.getMonthsBetween(n,i)};n.getLeft=function(n){return t.getMonthsBetween(Calendar.FIRST_DAY,n)};n.getRight=function(n){return t.getMonthsBetween(n,Calendar.LAST_DAY)};n.mergeDates=function(n,t){f("mergeDates");var i=new Date(n),r=i.getMonth();return i.setDate(t.getDate()),r!==i.getMonth()&&i.setDate(0),e("mergeDates"),i};n.prototype.setActive=function(n){if(n)if(this._paused)this._setActive=true;else try{this._focused.setAttribute("aria-live","polite");this._focused.setActive()}catch(t){}else this._focused.setAttribute("aria-live","off")};n.prototype.focus=function(){this._focused.focus()};n.prototype.getToday=function(){return new Date(this._today)};n.prototype.setToday=function(n){this._updateToday(new Date(n));this._updateUiForToday()};n.prototype.getFocusedDay=function(){return new Date(this._date)};n.prototype.setFocusedDay=function(n){var i=this._date;this._date=new Date(n);this._paused?this._dirty=true:(t.isSameMonth(i,n)||(this._jobset.cancelAllChildJobs(),clearTimeout(this._changeTimeout),this._events&&(this._events.removeEventListener("collectionchanged",this._onCollectionChanged),this._events.dispose(),this._events=null),this._updateUiForMonth(n),this._updateUiForToday(),this._updateUiForHighlightedElements(),this.showFreeBusy&&this._jobset.addUIJob(this,this._getEvents,null,People.Priority.perfHighFidelity)),this._updateFocusedElement(n.getDate()))};n.prototype.getFocusedElement=function(){var n=null;return this._daysEl&&(n=this._daysEl.querySelector(":focus")),n};n.prototype.setHighlightDates=function(n){this._highlightDates=[].concat(n);this._host&&this._updateUiForHighlightedElements()};n.prototype.getUI=function(n){var t=this._getMonthInfo(this._date);this._info=t;n.html=i.grid(t)};n.prototype.activateUI=function(n){this._host=document.getElementById(this._id);this._focused=document.createElement("div");this._focused.className="focused";this._focused.tabIndex=0;this._focused.setAttribute("role","listitem");this._header=this._host.querySelector(".header");this._daysEl=this._host.querySelector(".days");this._days=r(this._host,".day");this._previous=r(this._host,".previous");this._current=r(this._host,".current");this._next=r(this._host,".next");this.resume(n)};n.prototype.resume=function(n){f("resume");this._jobset=n;this._paused&&(this._paused=false,this._dirty&&(this._updateUiForMonth(this._date),this._dirty=false),this.autoUpdate&&this._updateToday(Calendar.getToday()),this._updateUiForToday(),this._updateUiForHighlightedElements(),this._updateFocusedElement(this._date.getDate()),this._setActive&&(this._focused.setActive(),this._setActive=false),this.autoUpdate&&Calendar.addListener("dayChanged",this._onDayChanged,this),this._host.addEventListener("click",this._onClick,false),this._host.addEventListener("keydown",this._onKeyDown,false),this.showFreeBusy&&this._jobset.addUIJob(this,this._getEvents,null,People.Priority.perfHighFidelity));e("resume")};n.prototype.pause=function(){this._paused||(this._paused=true,this._host.removeEventListener("keydown",this._onKeyDown,false),this._host.removeEventListener("click",this._onClick,false),this.autoUpdate&&Calendar.removeListener("dayChanged",this._onDayChanged,this),this._events&&(this._events.removeEventListener("collectionchanged",this._onCollectionChanged),this._events.dispose(),this._events=null),this._jobset.cancelAllChildJobs(),clearTimeout(this._changeTimeout))};n.prototype.deactivateUI=function(){this.pause();this._jobset=null;this._host=null};n.prototype.ensureFocusRect=function(){var n=this._focused;n.classList.contains("win-hidefocus")&&$(n).removeClass("win-hidefocus")};n.prototype._onDayChanged=function(n){this._updateToday(n);this._updateUiForToday();this._updateUiForHighlightedElements()};n.prototype._onClick=function(n){for(var r,i,t=n.target;t!==n.currentTarget;t=t.parentNode)if(Jx.hasClass(t,"day")){r=parseInt(t.innerText,10);i=this._date.getMonth();Jx.hasClass(t,"previous")?--i:Jx.hasClass(t,"next")&&++i;this.fire("daySelected",new Date(this._date.getFullYear(),i,r));return}};n.prototype._onKeyDown=function(n){var i=this._date.getDate(),r=true,t,u;this.ensureFocusRect();n.keyCode===Jx.KeyCode.uparrow?t=i-7:n.keyCode===Jx.KeyCode.rightarrow?t=i+1:n.keyCode===Jx.KeyCode.downarrow?t=i+7:n.keyCode===Jx.KeyCode.leftarrow?t=i-1:(n.keyCode===Jx.KeyCode.enter||n.keyCode===Jx.KeyCode.space)&&(t=i,r=false);t!==undefined&&(u=r&&this.splitSelectFocus?"dayFocused":"daySelected",this.fire(u,new Date(this._date.getFullYear(),this._date.getMonth(),t)),n.preventDefault())};n.prototype._onCollectionChanged=function(n){n.target===this._events&&(this._changeTimeout||(this._jobset.cancelAllChildJobs(),this._changeTimeout=setTimeout(this._handleCollectionChanged,1e3)))};n.prototype._handleCollectionChanged=function(){this._events.lock();this._daysWithEvents={};this._jobset.addUIJob(this,this._processEvents,null,People.Priority.perfHighFidelity)};n.prototype._updateToday=function(n){t.isSameDate(n,this._today)||(t.isSameDate(this._date,this._today)&&(this._date=n),this._today=n)};i.dayNames=function(){var i=new Date,u="",r;for(i.setDate(i.getDate()-i.getDay()+t.firstDayOfWeek),r=0;r<7;++r)u+="<div class='dayName' role='columnheader' aria-label='"+Jx.escapeHtml(n._dayNameAcc.format(i))+"'>"+Jx.escapeHtml(n._dayName.format(i))+"<\/div>",i.setDate(i.getDate()+1);return u};i.days=function(t){var i="",r=new Date(t.start);return i+=u("previous",r,t.previousFirst,t.previousLast,n.PREV_MONTH_FIRST_DAY,n.MAX_DAYS_PER_MONTH+1),i+=u("current",r,1,t.last,1,n.MAX_DAYS_PER_MONTH+1),i+u("next",r,t.nextFirst,t.nextLast,1,n.NEXT_MONTH_DAYS+1)};i.grid=function(n){return'<div id="'+n.id+'" class="monthGrid"><div class="header" role="heading">'+Jx.escapeHtml(n.header)+'<\/div><div class="dayNames">'+i.dayNames(n)+'<\/div><div class="days">'+i.days(n)+'<\/div><div class="daysEnd"><\/div><\/div>'};n.prototype._getMonthInfo=function(i){var f=i.getFullYear(),e=i.getMonth(),u=7,y=new Date(f,e),c=new Date(f,e+1,0),o=(y.getDay()-t.firstDayOfWeek+u)%u,p=(c.getDay()-t.firstDayOfWeek+u)%u,r={id:this._id,header:n._header.format(i)},l,s,a,v,h;return o=o===0?u:o,l=new Date(f,e,1-o),r.start=l,r.previousFirst=new Date(f,e,1-o).getDate(),r.previousLast=new Date(f,e,0).getDate(),r.last=c.getDate(),s=r.previousLast-r.previousFirst+1,s+=r.last,a=6*u-s,v=Math.floor(a/u)+1,h=new Date(f,e+1,v*u-1-p),r.end=h,r.nextFirst=1,r.nextLast=h.getDate(),r.end.setDate(r.end.getDate()+1),r};n.prototype._updateUiForMonth=function(t){var i=this._getMonthInfo(t),r,u,f;for(this._info=i,this._header.firstChild.nodeValue=i.header,r=new Date(i.start),this._updateDayArray(this._previous,r,i.previousFirst,i.previousLast,n.PREV_MONTH_FIRST_DAY),this._updateDayArray(this._current,r,1,i.last,1),this._updateDayArray(this._next,r,i.nextFirst,i.nextLast,1),u=0,f=this._days.length;u<f;++u)this._days[u].classList.remove("hasEvents")};n.prototype._updateUiForToday=function(){this._todayEl&&(Jx.removeClass(this._header,"today"),Jx.removeClass(this._todayEl,"today"),this._todayEl=null);this._current&&t.isSameMonth(this._today,this._date)&&(this._todayEl=this._current[this._today.getDate()-1],Jx.addClass(this._todayEl,"today"),Jx.addClass(this._header,"today"))};n.prototype._updateDayArray=function(n,t,i,r,u){for(var e,s,f=0,h=n.length;f<h;++f,++u)e=n[f],s=e.classList,i<=u&&u<=r?(s.remove("hidden"),e.setAttribute("aria-label",o.format(t)),t.setDate(t.getDate()+1)):s.add("hidden")};n.prototype._updateFocusedElement=function(n){var i=document.activeElement===this._focused,t=this._current[n-1],r=t.getAttribute("aria-label");t.appendChild(this._focused);this._focused.innerText=r;i&&(this._focused.setAttribute("aria-live","polite"),this._focused.focus())};n.prototype._updateUiForHighlightedElements=function(){var f,i,o=this._info;if(this._highlightEls&&this._highlightEls.length>0)for(i=0,f=this._highlightEls.length;i<f;++i)Jx.removeClass(this._highlightEls[i],"highlightDate");for(this._highlightEls=[],i=0,f=this._highlightDates.length;i<f;++i){var e=this._highlightDates[i],u=e.getDate(),r=null;t.isSameMonth(e,this._date)?r=this._current[u-1]:t.isPreviousMonth(e,this._date)&&o.previousFirst<=u?r=this._previous[u-n.PREV_MONTH_FIRST_DAY]:t.isNextMonth(e,this._date)&&u<=o.nextLast&&(r=this._next[u-1]);r&&(Jx.addClass(r,"highlightDate"),this._highlightEls.push(r))}};n.prototype._getEvents=function(){var t={},i,n;this.fire("getPlatform",t);i=t.platform.calendarManager;n=i.getEvents(this._info.start,this._info.end);n.addEventListener("collectionchanged",this._onCollectionChanged);this._events=n;this._daysWithEvents={};this._jobset.addUIJob(this,this._processEvents,null,People.Priority.perfHighFidelity)};n.prototype._processEvents=function(){for(var h=this._daysWithEvents,i=0,a=h.length,e=false,c=this._events,f,o,r,s,u=0,l=c.count;u<l&&!e;++u)if(f=c.item(u),f!==null&&(o=f.endDate,i<o))for(r=f.startDate,i<r&&(i=new Date(r.getFullYear(),r.getMonth(),r.getDate()));i<o&&!e;)s=t.isSameMonth(i,this._date)?i.getDate()-1+n.PREV_MONTH_DAYS:i<this._date?i.getDate()-n.PREV_MONTH_FIRST_DAY:i.getDate()-1+(n.MAX_DAYS_PER_MONTH+n.PREV_MONTH_DAYS),s>=a?e=true:(h[s]=true,i.setDate(i.getDate()+1));this._jobset.addUIJob(this,this._setHasEventsClasses,null,People.Priority.perfHighFidelity)};n.prototype._setHasEventsClasses=function(){for(var n=0,t=this._days.length;n<t;++n)n in this._daysWithEvents?Jx.addClass(this._days[n],"hasEvents"):Jx.removeClass(this._days[n],"hasEvents");this._events.unlock();this._changeTimeout=null}})