Jx.delayDefine(Calendar.Controls,"YearGrid",function(){function r(n){Jx.mark("Calendar:YearGrid."+n+",StartTA,Calendar")}function u(n){Jx.mark("Calendar:YearGrid."+n+",StopTA,Calendar")}function f(n,t){return Array.prototype.slice.call(n.querySelectorAll(t))}var t=Calendar.Helpers,i={},n=Calendar.Controls.YearGrid=function(){this.initComponent();this._today=Calendar.getToday();this._date=new Date(this._today);this._highlightDates=[];this._paused=true;this._changeTimeout=null;this.autoUpdate=true;this.splitSelectFocus=false;this._onClick=this._onClick.bind(this);this._onKeyDown=this._onKeyDown.bind(this);n._header||(t.ensureFormats(),n._header=new Jx.DTFormatter("year"),n._monthYear=new Jx.DTFormatter("month year"),n._month=new Jx.DTFormatter("month.abbreviated"))};Jx.augment(n,Jx.Component);n.getItem=function(n,t){return new Date(n.getFullYear()+t,0,1)};n.getIndex=function(n,i){return t.getYearsBetween(n,i)};n.getLeft=function(n){return t.getYearsBetween(Calendar.FIRST_DAY,n)};n.getRight=function(n){return t.getYearsBetween(n,Calendar.LAST_DAY)};n.mergeDates=function(n,t){r("mergeDates");var i=new Date(n.getFullYear(),t.getMonth(),1);return u("mergeDates"),i};n.prototype.setActive=function(n){if(n)if(this._paused)this._setActive=true;else try{this._focused.setAttribute("aria-live","polite");this._focused.setActive()}catch(t){}else this._focused.setAttribute("aria-live","off")};n.prototype.focus=function(){this._focused.focus()};n.prototype.getToday=function(){return new Date(this._today)};n.prototype.setToday=function(n){this._updateToday(new Date(n));this._updateUiForToday()};n.prototype.getFocusedDay=function(){return new Date(this._date)};n.prototype.setFocusedDay=function(n){var i=this._date;this._date=new Date(n);this._paused?this._dirty=true:(t.isSameYear(i,n)||(this._jobset.cancelAllChildJobs(),this._updateUiForYear(n),this._updateUiForToday(),this._updateUiForHighlightedElements()),this._updateFocusedElement(n.getMonth()))};n.prototype.getFocusedElement=function(){var n=null;return this._monthsEl&&(n=this._monthsEl.querySelector(":focus")),n};n.prototype.setHighlightDates=function(n){this._highlightDates=[].concat(n);this._host&&this._updateUiForHighlightedElements()};n.prototype.getUI=function(n){var t=this._getYearInfo(this._date);this._info=t;n.html=i.grid(t)};n.prototype.activateUI=function(n){this._host=document.getElementById(this._id);this._focused=document.createElement("div");this._focused.className="focused";this._focused.tabIndex=0;this._focused.setAttribute("role","listitem");this._header=this._host.querySelector(".header");this._monthsEl=this._host.querySelector(".months");this._months=f(this._host,".month");this.resume(n)};n.prototype.resume=function(n){r("resume");this._jobset=n;this._paused&&(this._paused=false,this._dirty&&(this._updateUiForYear(this._date),this._dirty=false),this.autoUpdate&&this._updateToday(Calendar.getToday()),this._updateUiForToday(),this._updateUiForHighlightedElements(),this._updateFocusedElement(this._date.getMonth()),this._setActive&&(this._focused.setActive(),this._setActive=false),this.autoUpdate&&Calendar.addListener("dayChanged",this._onDayChanged,this),this._host.addEventListener("click",this._onClick,false),this._host.addEventListener("keydown",this._onKeyDown,false));u("resume")};n.prototype.pause=function(){this._paused||(this._paused=true,this._host.removeEventListener("keydown",this._onKeyDown,false),this._host.removeEventListener("click",this._onClick,false),this.autoUpdate&&Calendar.removeListener("dayChanged",this._onDayChanged,this),this._jobset.cancelAllChildJobs())};n.prototype.deactivateUI=function(){this.pause();this._jobset=null;this._host=null};n.prototype.ensureFocusRect=function(){var n=this._focused;n.classList.contains("win-hidefocus")&&$(n).removeClass("win-hidefocus")};n.prototype._onDayChanged=function(n){this._updateToday(n);this._updateUiForToday();this._updateUiForHighlightedElements()};n.prototype._onClick=function(n){for(var i,r,t=n.target;t!==n.currentTarget;t=t.parentNode)if(Jx.hasClass(t,"month")){i=parseInt(t.getAttribute("data-month"),10);r=this._date.getFullYear();this.fire("daySelected",new Date(r,i,1));return}};n.prototype._onKeyDown=function(n){var i=this._date.getMonth(),r=true,t,u;this.ensureFocusRect();n.keyCode===Jx.KeyCode.uparrow?t=i-3:n.keyCode===Jx.KeyCode.rightarrow?t=i+1:n.keyCode===Jx.KeyCode.downarrow?t=i+3:n.keyCode===Jx.KeyCode.leftarrow?t=i-1:(n.keyCode===Jx.KeyCode.enter||n.keyCode===Jx.KeyCode.space)&&(t=i,r=false);t!==undefined&&(u=r&&this.splitSelectFocus?"dayFocused":"daySelected",this.fire(u,new Date(this._date.getFullYear(),t,1)),n.preventDefault())};n.prototype._updateToday=function(n){t.isSameMonth(n,this._today)||(t.isSameMonth(this._date,this._today)&&(this._date=n),this._today=n)};i.months=function(t){for(var u="",r,i=0;i<12;++i)r=new Date(t.date.getFullYear(),i,1),u+='<div class="month" aria-label="'+Jx.escapeHtml(n._monthYear.format(r))+'" role="button" data-month="'+i+'"><span>'+Jx.escapeHtml(n._month.format(r))+"<\/span><\/div>";return u};i.grid=function(t){return'<div id="'+t.id+'" class="yearGrid"><div class="header" role="heading">'+Jx.escapeHtml(n._header.format(t.date))+'<\/div><div class="months">'+i.months(t)+"<\/div><\/div>"};n.prototype._getYearInfo=function(n){return{id:this._id,date:n}};n.prototype._updateUiForYear=function(t){var f=this._getYearInfo(t),i,r,u;for(this._info=f,this._header.firstChild.nodeValue=Jx.escapeHtml(n._header.format(t)),i=0;i<12;++i)r=new Date(t.getFullYear(),i,1),u=this._months[i],u.setAttribute("aria-label",Jx.escapeHtml(n._monthYear.format(r)))};n.prototype._updateUiForToday=function(){var n=null,i=this._todayEl;this._months&&t.isSameYear(this._today,this._date)&&(n=this._months[this._today.getMonth()]);i!==n&&(i&&(Jx.removeClass(this._header,"today"),Jx.removeClass(i,"today"),this._todayEl=null),n&&(this._todayEl=n,Jx.addClass(n,"today"),Jx.addClass(this._header,"today")))};n.prototype._updateFocusedElement=function(n){var i=document.activeElement===this._focused,t=this._months[n],r=t.getAttribute("aria-label");t.appendChild(this._focused);this._focused.innerText=r;i&&(this._focused.setAttribute("aria-live","polite"),this._focused.focus())};n.prototype._updateUiForHighlightedElements=function(){var i,n;if(this._highlightEls&&this._highlightEls.length>0)for(n=0,i=this._highlightEls.length;n<i;++n)Jx.removeClass(this._highlightEls[n],"highlightDate");for(this._highlightEls=[],n=0,i=this._highlightDates.length;n<i;++n){var u=this._highlightDates[n],f=u.getMonth(),r=null;t.isSameYear(u,this._date)&&(r=this._months[f]);r&&(Jx.addClass(r,"highlightDate"),this._highlightEls.push(r))}}})