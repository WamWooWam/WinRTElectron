Jx.delayDefine(Calendar.Views,"EventDetails",function(){function i(n){Jx.mark("Calendar.ED."+n+",Info,Calendar")}function u(n){Jx.mark("Calendar.ED."+n+",StartTA,Calendar")}function f(n){Jx.mark("Calendar.ED."+n+",StopTA,Calendar")}function v(n){var t=n.getAttribute("aria-hidden");return t?t==="true":false}function e(n,t){n.setAttribute("aria-hidden",t)}function c(n){var t=Jx.isHTMLElement(n)?n:this,i,r;t.setAttribute("aria-readonly",true);t.setAttribute("readonly","readonly");$(t).addClass("readonly");i=t.getAttribute("aria-labelledby");r=i?$.id(i):null;r&&r.setAttribute("readonly","readonly")}function b(n){var i=Jx.isHTMLElement(n)?n:this,t,r,u;t=document.createElement("input");t.type="text";t.value=i.options[i.selectedIndex].text;t.id=i.id;t.className=i.className;t.setAttribute("aria-hidden",i.getAttribute("aria-hidden"));t.setAttribute("data-value-override",i.value);t.setAttribute("data-selectedIndex",i.selectedIndex);t.setAttribute("aria-readonly",true);t.setAttribute("role","combobox");t.setAttribute("readonly","readonly");$(t).addClass("readonly");i.getAttribute("aria-labelledby")!==null&&t.setAttribute("aria-labelledby",i.getAttribute("aria-labelledby"));i.getAttribute("aria-label")!==null&&t.setAttribute("aria-label",i.getAttribute("aria-label"));r=i.getAttribute("aria-labelledby");u=r?$.id(r):null;u&&u.setAttribute("readonly","readonly");i.parentNode.replaceChild(t,i)}function ut(n){var t=n.getAttribute("data-value-override");return parseInt(t!==null?t:n.value,10)}function nt(n){var t=n.getAttribute("data-selectedIndex");return t!==null?parseInt(t,10):n.selectedIndex}function it(n,i,r){new ct.Tooltip($.id(n),{innerHTML:t.loadCompoundString(i,Jx.key.getLabel(r))})}function lt(n){return n<0||n>120||n%30}function pt(n,t){while(n&&n!==t)n=n.parentNode;return n===t}function at(n,t){var i=n.getMinutes();return i=Math.round(i/t)*t,new Date(n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),i)}function wt(n,t){var i=this[n],u=this[n]=t(),r;delete i.unmock;for(r in i)i.hasOwnProperty(r)&&(u[r]=i[r]);return u}function bt(n,t,i){n[t]={unmock:wt.bind(n,t,i)}}function st(n,t){var i=new Date(n);return i.setHours(t.getHours()),i.setMinutes(t.getMinutes()),i}var k=Microsoft.WindowsLive.Platform,y=k.Calendar,g=y.DataType,o=y.ResponseType,p=y.Sensitivity,l=y.RecurrenceType,s=y.DayOfWeek,ft=y.AttendeeType,tt=y.Status,a=y.BusyStatus,d=y.MeetingStatus,h=y.ServerCapability,ct=WinJS.UI,r=Calendar.Helpers,t=Calendar.Loc,et=Calendar.Views.CalendarSelector,vt=-100,yt=-200,ot=new Jx.DTFormatter("longDate"),n=Calendar.Views.EventDetails=function(){this.initComponent();this._id="eventDetails";this._close=this._close.bind(this);this._onCancel=this._onCancel.bind(this);this._onDelete=this._onDelete.bind(this);this._onSave=this._onSave.bind(this);this._onSaveButton=this._onSaveButton.bind(this);this._onSend=this._onSend.bind(this);this._onRespond=this._onRespond.bind(this);this._onHintReset=this._onHintReset.bind(this);this._onKeyDown=this._onKeyDown.bind(this);this._onGuestsChanged=this._onGuestsChanged.bind(this);this._onCalendarSelected=this._onCalendarSelected.bind(this);this._onShowMoreSetFocus=this._onShowMore.bind(this,true);this._onFreeBusy=this._onFreeBusy.bind(this);this._onFreeBusyBack=this._onFreeBusyBack.bind(this);this._onAccountChanged=this._onAccountChanged.bind(this);this._onAccountResourceChanged=this._onAccountResourceChanged.bind(this);this._showDatePicker=this._showDatePicker.bind(this);r.ensureFormats();this._calendarSelector=new et;this._endOccurrence=new w(this);this._attendeeResponses=new rt;this._selectedCalendarIndex=0;this._calendars=[];this._recipients=[];this._readOnlyEndDate=false;this._outerWidth=0;this._parseAttendeesCache=null;this._idsCalendar=null;this._isSkinny=null;this._isSnap=null;this._datePickerPattern=null;this._lastSelectedCalendarId=null;this._clickAnchor=null;this._datePicker=null;this._datePickerAnchor=null;this._lastCancelDate=null;this._startedAsMeeting=false;this._forceDirty=false;this._providerBiciInfo={locationChanged:0,recurrenceChanged:0,notesChanged:0}},ht,rt,w;Jx.augment(n,Jx.Component);n.reminder18=6;n.statusFree=0;n.statusBusy=1;n.durationAllDay=5;n.durationCustom=6;n.recurrences={None:0,Daily:1,Weekdays:2,MWF:3,TTH:4,Weekly:5,Monthly:6,Yearly:7,Custom:8};n.mwfDays=s.monday|s.wednesday|s.friday;n.tthDays=s.tuesday|s.thursday;n.weekDays=s.monday|s.tuesday|s.wednesday|s.thursday|s.friday;n.allDays=s.monday|s.tuesday|s.wednesday|s.thursday|s.friday|s.saturday|s.sunday;n.eventType={Event:0,Series:1,Instance:2,Exception:3};n.CloseCommands={cancel:0,del:1,save:2,send:3};n.BiciResponseType={Edit:0,Send:1,NoSend:2};n.BiciResponse={3:0,2:1,4:2};n.InfiniteDate=-116444736e5;n.prototype.createEvent=function(t){this._lastSelectedCalendarId=t.calendarId;var f=t.endDate,u=t.startDate,e=!!t.allDayEvent;f||(e?(u=new Date(u.getFullYear(),u.getMonth(),u.getDate()),f=new Date(u.getFullYear(),u.getMonth(),u.getDate()+1)):(f=new Date(u.getTime()+r.hourInMilliseconds),f>=Calendar.LAST_DAY&&(f=u)));this._initEvent={subject:t.subject?t.subject:"",location:t.location?t.location:"",startDate:u,endDate:f,allDayEvent:e,busyStatus:e?a.free:a.busy,reminder:e?Calendar.DEFAULT_ALLDAY_EVENT_REMINDER:Calendar.DEFAULT_EVENT_REMINDER,sensitivity:p.normal,description:"",dataType:g.html,responseType:o.organizer,recurring:false,attendeeList:[],recurrenceIndex:0};this._eventType=n.eventType.Event;this._targetEvent=null;this._organizer=true};n.prototype.editEvent=function(n,t){this._eventType=null;try{return this._getEvent(null,n),this._cacheEvent(),this._forceDirty=t,true}catch(r){}return false};n.prototype.getUI=function(n){var i,r;u("getUI");this._who||(u("getUI:AW"),i=this._targetEvent&&this._targetEvent.calendar.readOnly||!this._organizer,this._who=new AddressWell.Controller("who",null,this._getPlatform(),false,t.getString("EventGuestsPlaceholder"),null),AddressWell.dropdownToContainerWidthPercentage=1,this._who.setDisabled(i),this.append(this._who),f("getUI:AW"));r=this._organizer?t.getString("EventGuestsLabel"):t.getString("EventGuestsLabelAttendee");n.html=this._mainTemplate(Jx.getUI(this._who).html,Jx.getUI(this._calendarSelector).html,r);f("getUI")};n.prototype.activateUI=function(i){var r,o,s;u("activateUI");r=$.id(this._id);r.style.visibility="hidden";Jx.Component.prototype.activateUI.call(this);this._jobset=i;u("activateUI:AW");this._whoElement=$.id(this._who.getInputElementId());this._who._scrollableElement=$.id("schedule");this._who.setLabelledBy("GuestsDescrip");f("activateUI:AW");this._isCustomDuration=false;this._prevValues=null;this._hasAttendee=false;this._targetEventCommitting=false;this._selectedCalendarIndex=0;this._calendars=[];this._recipients=[];this._parseAttendeesCache=null;this._canAddSignature=false;this._account=null;o={};this.fire("getSettings",o);this._settings=o.settings;t.processAll(this._whoElement);$("#cedCancel").on("click",this._onCancel);$("#FreeBusyButton").on("click",this._onFreeBusy);this._calendarSelector.activateUI();this._setupCalendarCombo();this._setupStatus(this._initEvent.busyStatus);this._who.setContextualAccount(this._calendars[this._selectedCalendarIndex].calendar.account);u("activateUI:Canvas");this._canvas=$.id("NotesTextbox");this._dirtyTracker=new ModernCanvas.Plugins.DirtyTracker;ModernCanvas.createCanvasAsync(this._canvas,{className:"calendar",delayActivation:true,plugins:{dirtyTracker:this._dirtyTracker}}).done(function(n){if(this._canvasControl=n,n.setCueText(Jx.res.getString("cedCanvasCueText")),u("activateUI:CanvasContent"),!this.isNewEvent()&&this._initEvent.description.length>0){var t=this._initEvent.description,i=ModernCanvas.ContentFormat.text;this._initEvent.dataType===g.html?(t=t.replace(/[\r\n]/g,""),i=ModernCanvas.ContentFormat.htmlString):this._initEvent.dataType===g.plainText?this._initEvent.dataType=g.html:t="";n.addContent(t,i,ModernCanvas.ContentLocation.all)}n.activate();this._updateCanvasStyles();n.addEventListener("keydown",this._onKeyDown,false);f("activateUI:CanvasContent")}.bind(this));f("activateUI:Canvas");u("activateUI:Duration");ct.processAll($.id("schedule"));s=this._setupDuration(this._initEvent.startDate,this._initEvent.endDate,this._initEvent.allDayEvent);f("activateUI:Duration");this._initEvent.recurrence&&this._setupRecurrence(this._initEvent.recurrence);(!this._organizer||this._initEvent.recurring&&this._eventType!==n.eventType.Series)&&b($.id("RecurrenceCombo"));this._setupAttendees();e($.id("OrganizerDescrip"),!!this._organizer);this._organizer?this._hasAttendee&&this._hasAttendeeStatus()&&this._attendeeResponses.activateUI(this._who,this._initEvent.attendeeList,this._targetEvent.organizerEmail):(this._insertOrganizer(this._who),this._showYourResponse());$.id("ReminderCombo").value=this._initEvent.reminder;$.id("EventTitleTextbox").value=this._initEvent.subject;$.id("LocationTextbox").value=this._initEvent.location;this.isNewEvent()||($.id("ReminderCombo").selectedIndex<0&&this._addOption($.id("ReminderCombo"),t.getString("EventReminderCustom"),this._initEvent.reminder,true),this._initEvent.sensitivity!==p.normal&&($.id("PrivateCheckbox").checked=true));this._startedAsMeeting=this._isMeeting();this._updateButtons();it("cedCancel","cedCancelTooltip","Escape");it("cedDelete","cedDeleteTooltip","Ctrl+D");it("cedSave","cedSaveTooltip","Ctrl+S");it("cedSend","cedSendTooltip","Alt+S");it("cedRespond","RespondCommand","Ctrl+P");this._updateAppBar();this.on("resizeWindow",this._onResizeWindow);if(this._outerWidth=0,this._onResizeWindow({data:{outerWidth:window.outerWidth}}),!s)$("#EventDuration").on("change",this._onDurationChanged.bind(this));if(this._targetEvent&&this._targetEvent.calendar.readOnly)$("input:not(#"+this._who.getInputElementId()+")",$.id("schedule")).each(c),$("select",$.id("schedule")).each(b),c($.id("StartDateCombo")),c($.id("GuestsDescrip")),c($.id("PrivateCheckbox")),c($.id("AlldayCheckbox")),$.id("PrivateCheckbox").disabled=true,$.id("AlldayCheckbox").disabled=true;else{$("#AlldayCheckbox").on("change",this._onAllDayChanged.bind(this));this._organizer?(this._who.addListener(AddressWell.Events.recipientsAdded,this._onGuestsChanged),this._who.addListener(AddressWell.Events.recipientRemoved,this._onGuestsChanged),this._whoIsListening=true):c($.id("GuestsDescrip"));$("#EventTitleTextbox").on("blur",this._onHintReset);$("#PrivateCheckboxDescrip").click(function(){$.id("PrivateCheckbox").click()});$("#AlldayCheckboxDescrip").click(function(){$.id("AlldayCheckbox").click()})}$("#GuestsCombo").on("keydown",function(n){n.key==="Esc"&&(n.stopImmediatePropagation(),n.target.blur())});this._endOccurrence.activateUI();$("#ShowMoreButton").on("click",this._onShowMoreSetFocus).on("keyup",this._onShowMoreSetFocus);this._eventType===n.eventType.Event||this._organizer||(c($.id("StartDateCombo")),$("select",$.id("StartTimeCombo")).each(b),s||$("select#EventDuration").each(b));$(document).on("keydown",this._onKeyDown);this.isNewEvent()?Jx.ptStop("Calendar-EventDetails-NoData"):Jx.ptStop("Calendar-EventDetails-Data");$("#StartDateCombo,#EndDateCombo,#EndOccurrenceCombo").on("click",this._showDatePicker);$("#StartDateCombo,#EndDateCombo,#EndOccurrenceCombo").on("keydown",this._showDatePicker);r.style.visibility="";this._animateIn();f("activateUI")};n.prototype._getDatePicker=function(){if(!this._datePicker){var n=this._datePicker=new Calendar.Controls.DatePicker(Calendar.Controls.DatePicker.PickMode.monthGrid),t=Calendar.getToday();this.appendChild(n);n.showFreeBusy=false;n.showJumpTargets=false;n.setIdSuffix("");n.addCustomClass("eventDetailsPicker");n.setToday(t);n.setFocusDate(t);n.clientView=Calendar.Controls.DatePicker.ClientView.day;n.activateUI(this._jobset);n.on("dateSelected",this._onDatePickerDateSelected,this)}return this._datePicker};n.prototype._updateCanvasStyles=function(){var t=this._getLayout(),n;this._canvasControl&&(n=this._canvasControl.getDocument().body,Jx.setClass(n,"skinny",t.isSkinny),Jx.setClass(n,"snap",t.isSnap))};n.prototype._onShowMore=function(n,t){t&&t.key&&t.key!=="Enter"&&t.key!=="Spacebar"||v($.id("ShowMoreButton"))||(e($.id("ShowMoreButton"),true),e($.id("ShowMore"),false),this._updateWhoAriaFlow(),n&&$.id("RecurrenceCombo").focus(),this._endOccurrence.update())};n.prototype.deactivateUI=function(){if(this._unhookAccount(),this._unhookAccountResource(),this._freeBusy&&(this._freeBusy.removeListener("back",this._onFreeBusyBack,this),this._freeBusy.shutdownUI(),this.removeChild(this._freeBusy),this._freeBusy=null,this._freeBusyHost=null),$("#StartDateCombo,#EndDateCombo,#EndOccurrenceCombo").off("click",this._showDatePicker),$("#StartDateCombo,#EndDateCombo,#EndOccurrenceCombo").off("keydown",this._showDatePicker),this._datePicker&&(this._datePicker.detach("dateSelected",this._onDatePickerDateSelected,this),this.removeChild(this._datePicker),this._datePicker.shutdownUI(),this._datePickerAnchor=null,this._datePicker=null),this._calendarSelector.detach("calendarSelected",this._onCalendarSelected),this._calendarSelector.deactivateUI(),Jx.Component.prototype.deactivateUI.call(this),$(document).off("keydown",this._onKeyDown),$("#ShowMoreButton").off("click",this._onShowMoreSetFocus).off("keyup",this._onShowMoreSetFocus),this.detach("resizeWindow",this._onResizeWindow),this._whoIsListening&&(this._who.removeListener(AddressWell.Events.recipientsAdded,this._onGuestsChanged),this._who.removeListener(AddressWell.Events.recipientRemoved,this._onGuestsChanged),this._whoIsListening=false),this._appBar&&(this._appBar.disabled=false),this._peekBar&&this._peekBar.show(),this._canvasControl&&(this._canvasControl.removeEventListener("keydown",this._onKeyDown,false),this._canvasControl.dispose(),this._canvasControl=null),this._buttonStyle){var n=document.getElementsByTagName("head")[0];n.removeChild(this._buttonStyle);this._buttonStyle=null}};n.prototype._setStartDate=function(n){this._controls.startDate=n;var i=ot.format(n),r=t.getString("EventDateLabel");$.id("StartDateCombo").setAttribute("aria-label",r+", "+i);$("#StartDateCombo .value").text(i)};n.prototype._setEndDate=function(n){this._controls.endDate=n;var i=ot.format(n),r=t.getString("EventEndLabel");$.id("EndDateCombo").setAttribute("aria-label",r+", "+i);$("#EndDateCombo .value").text(i)};n.prototype._onDatePickerDateSelected=function(n){if(this._datePickerAnchor===$.id("StartDateCombo")){this._setStartDate(n.data);var t=this.getDuration();t.startDate>t.endDate&&this._setEndDate(this._controls.startDate)}else this._datePickerAnchor===$.id("EndDateCombo")?this._setEndDate(n.data):this._datePickerAnchor===$.id("EndOccurrenceCombo")&&this._endOccurrence.setDate(n.data)};n.prototype._showDatePicker=function(n){var i=n.target,l=i.className,r,o,t,s,e,c,a;if(((l==="check"||l==="value")&&(i=i.parentNode),!i.getAttribute("readonly"))&&(r=n.keyCode,o=Jx.KeyCode,!r||r===o.enter||r===o.space)&&(this._datePickerAnchor=i,n.stopPropagation(),n.preventDefault(),t=this._getDatePicker(),!t.getActive())){if(s="bottom",e=false,t.setToday(Calendar.getToday()),this._datePickerAnchor===$.id("StartDateCombo")?(t.setFocusDate(this._controls.startDate),t.setHighlightDates([this._controls.startDate])):this._datePickerAnchor===$.id("EndDateCombo")?(t.setFocusDate(this._controls.endDate),t.setHighlightDates([this._controls.endDate]),e=true):this._datePickerAnchor===$.id("EndOccurrenceCombo")&&(t.setFocusDate(this._endOccurrence.date()),t.setHighlightDates([this._endOccurrence.date()]),e=true),e){u("_showDatePicker:checkPosition");var h=369,v=$.id("schedule"),y=$.id("eventDetails");c=this._datePickerAnchor;a=c.offsetTop+c.offsetHeight-v.scrollTop-y.scrollTop;window.outerHeight-a<h&&(s="top");f("_showDatePicker:checkPosition")}t.show(this._datePickerAnchor,s,Jx.isRtl()?"right":"left")}};n.prototype._showYourResponse=function(){var n;if(this._initEvent.responseType!==o.organizer&&(n=this._targetEvent.responseRequested,!n||this._hasResponseStatus())){var i=$.id("yourResponse"),r=[t.getString("EventYourResponseNoResponse"),"organizer",t.getString("EventYourResponseTentative"),t.getString("EventYourResponseAccepted"),t.getString("EventYourResponseDeclined"),t.getString("EventYourResponseNoResponse"),],u=!n&&!this.hasResponded();i.innerText=u?t.getString("EventYourResponseNoResponseRequested"):r[this._initEvent.responseType];e(i,false)}};n.prototype.getEvent=function(){return this._targetEvent};n.prototype.getTitle=function(){return $.id("EventTitleTextbox").value};n.prototype._animateIn=function(){u("_animateIn");this.isNewEvent()||($.id("EventTitleTextbox").value=$.id("EventTitleTextbox").value);var t=[$.id("nav"),$.id("schedule")],r=[$.id("cedTitle"),$.id("cedNotes")],n=function(){this.hasUI()&&(document.activeElement&&pt(document.activeElement,$.id(this._id))||$.id("EventTitleTextbox").focus(),$.id("cedBackground").style.opacity=1,this.fire("viewReady"),i("eventDetailsReady"))}.bind(this);WinJS.UI.Animation.enterPage([t,r]).done(n,n);f("_animateIn")};n.prototype._animateOut=function(t,r){var u,c,a,v,y;this._closing=true;u=n.CloseCommands;t===u.save?Jx.bici.addToStream(this._getIdsCalendar().calendarEventExit,0):t===u.cancel&&Jx.bici.addToStream(this._getIdsCalendar().calendarEventExit,1);var h=$.id("cedBackground"),f=$.id("cedWrapper"),l=$.id("nav"),e=null,s=null,o={property:"opacity",delay:0,duration:333,timing:"cubic-bezier(0.1, 0.9, 0.2, 1)",keyframe:"cedExitFade"};if(t===u.send||t===u.del?(o.duration=166,o.delay=366,o.timing="linear",c=this._outerWidth,c>440&&(f.style.msTransformOrigin=Jx.isRtl()?String(c-580)+"px":"580px"),t===u.send?(e={property:"transform",delay:0,duration:532,timing:"linear",keyframe:"cedExitUp"},f.style.msTransform="matrix(0.75, 0.0, 0.0, 0.75, 0, -500)"):t===u.del&&(e={property:"transform",delay:0,duration:532,timing:"linear",keyframe:"cedExitDown"},f.style.msTransform="matrix(0.75, 0.0, 0.0, 0.75, 0, 500)")):(e=o,a=this._getLayout(),a.isSkinny&&(s=e)),h.style.opacity=0,f.style.opacity=0,s&&(l.style.opacity=0),v=function(n){this._close(n);t===u.save&&i("save_complete")}.bind(this,r),y=function(n,t){Jx.log.error("Animation out failed during execution with error: "+t);this._close(n)}.bind(this,r),document.activeElement)try{document.activeElement.blur()}catch(w){}h.style.zIndex="auto";try{WinJS.UI.executeAnimation(h,o);s&&WinJS.UI.executeAnimation(l,s);WinJS.UI.executeAnimation(f,e).done(v,y)}catch(p){Jx.log.error("Animation out failed with error: "+p);this.close(r)}};n.prototype._hookAccountResource=function(n){this._hookedAccountResource=n;n.addEventListener("changed",this._onAccountResourceChanged)};n.prototype._unhookAccountResource=function(){this._hookedAccountResource&&(this._hookedAccountResource.removeEventListener("changed",this._onAccountResourceChanged),this._hookedAccountResource=null)};n.prototype._hookAccount=function(n){this._hookedAccount=n;n.addEventListener("changed",this._onAccountChanged)};n.prototype._unhookAccount=function(){this._hookedAccount&&(this._hookedAccount.removeEventListener("changed",this._onAccountChanged),this._hookedAccount=null)};n.prototype._onHintReset=function(n){var t=n.srcElement;t.value=t.value===""?"":t.value};n.prototype._onKeyDown=function(n){var r,t,u,f,e,o;if(!this._closing)if(this._clickAnchor=null,r=n.keyCode,t=Jx.KeyCode,n.shiftKey&&n.ctrlKey&&!n.altKey)r===t.r&&this._showForwardReplyOptions().reply&&this._replyForward(Calendar.MailAction.replyAll);else if(n.shiftKey||!n.ctrlKey||n.altKey)if(n.shiftKey||n.ctrlKey||!n.altKey){if(!n.shiftKey&&!n.ctrlKey&&!n.altKey&&r===t.escape){for(var s=$(".win-flyout"),h=false,c=s.length;c--;)if(s[c].getComputedStyle().visibility!=="hidden"){h=true;break}h||(n.preventDefault(),this._onCancel({currentTarget:$.id("cedCancel")}))}}else r===t.period?this._who&&this._who.launchPeoplePicker():r===t.s&&(e=$.id("cedSend"),o=!v(e),o&&this._onSend({}));else switch(r){case t.r:this._showForwardReplyOptions().reply&&this._replyForward(Calendar.MailAction.reply);break;case t.f:this._showForwardReplyOptions().forward&&this._replyForward(Calendar.MailAction.forward);break;case t.s:this._targetEvent&&this._targetEvent.calendar.readOnly||(this._shouldShowSendButton()?this._onSend({}):this._onSaveButton({}));break;case t.d:this._targetEvent&&!this._targetEvent.calendar.readOnly&&this._onDelete({});break;case t.p:u=$.id("cedRespond");f=!v(u);f&&this._onRespond({currentTarget:$.id("cedRespond")})}};n.prototype._getLayout=function(n){var t=n||this._outerWidth;return{outerWidth:t,isSkinny:t<=1023,isSnap:t<=499}};n.prototype._onResizeWindow=function(n){var i=this._getLayout(n.data.outerWidth),e,o;this._outerWidth!==i.outerWidth&&(u("_onResizeWindow"),e=document.activeElement,e&&e!==document.querySelector(".modernCanvas-frame")&&setImmediate(function(){document.activeElement||e.focus()}),this._lastCancelDate&&Date.now()-this._lastCancelDate.getTime()<2e3&&r.isPopupVisible()&&this._onCancel({}),this._outerWidth=i.outerWidth,i.isSkinny!==this._isSkinny&&(o=$.id("EventTitleTextbox"),o.value=o.value,o.placeholder=i.isSkinny?"":t.getString("EventTitlePlaceholder"),[{full:"cedButtonsFull",skinny:"cedButtonsSnap"},{full:"cedTitleFull",skinny:"cedTitleSnap"},{full:"cedBackFull",skinny:"cedBackSnap"},].forEach(function(n){for(var r=$.id(n.full),u=$.id(n.skinny),e=i.isSkinny?r:u,o=i.isSkinny?u:r,t=e.firstChild,f;t;)f=t.nextSibling,o.appendChild(t),t=f}),this._isSkinny=i.isSkinny),i.isSnap!==this._isSnap&&(u("_onResizeWindow:pickers"),u("_onResizeWindow:pickers-aria"),$("#StartTimeCombo select").each(function(){this.setAttribute("aria-labelledby","StartTimeDescrip")}),$("#EndTimeCombo select").each(function(){this.setAttribute("aria-labelledby","EndDateDescrip")}),f("_onResizeWindow:pickers-aria"),f("_onResizeWindow:pickers"),this._targetEvent&&this._targetEvent.calendar.readOnly&&($("select",$.id("schedule")).each(b),i.isSnap?$("#EventTitleTextbox").each(c):$.id("EventTitleTextbox").removeAttribute("readonly")),u("_onResizeWindow:who.resize"),this._who.resize(),f("_onResizeWindow:who.resize"),this._isSnap=i.isSnap),this._updateCanvasStyles(),this._updateFreeBusyButton(),f("_onResizeWindow"))};n.prototype.cancel=function(){this._lastCancelDate=new Date;this._freeBusyOpen&&this._onFreeBusyBack(this._freeBusy.getState());this._onCancel({})};n.prototype._getPlatform=function(){if(!this._platform){var n={};this.fire("getPlatform",n);this._platform=n.platform}return this._platform};n.prototype._getIdsCalendar=function(){return this._idsCalendar||(this._idsCalendar=Microsoft.WindowsLive.Instrumentation.Ids.Calendar),this._idsCalendar};n.prototype._onCancel=function(u){var e,f,o;this._clickAnchor=u.currentTarget;e=this._isDirty();e?(r.hideFocusRectangleOnNextFocusOnly(u.target),this._targetEvent&&this._targetEvent.calendar.readOnly?r.showFlyout({anchor:this._clickAnchor||$.id("cedCancel"),message:t.getString("ReadOnlyDialog"),commands:[{label:t.getString("CloseButton"),onclick:this._animateOut.bind(this,n.CloseCommands.cancel,this._targetEvent)}]}):(f=$.id("EventTitleTextbox").value,o=f.length?t.loadCompoundString("EventSaveConfirmationTitled",f):t.getString("EventSaveConfirmationUntitled"),r.showMenu({anchor:this._clickAnchor||$.id("cedCancel"),message:o,commands:[{label:t.getString("EventButtonSave"),onclick:this._onSave},{label:t.getString("EventButtonDontSave"),onclick:this._animateOut.bind(this,n.CloseCommands.cancel,this._targetEvent)}]}))):this._animateOut(n.CloseCommands.cancel,this._targetEvent)};n.prototype._onDelete=function(n){var u,f,e,s,h;if(!this._targetEventCommitting){r.hideFocusRectangleOnNextFocusOnly(n.target);var c=this._initEvent.attendeeList.length>0,l=!this._isInPast(),a=this._targetEvent.meetingStatus&d.isCanceled;if(a)return this._deleteEvent();u=v($.id("cedDelete"))?$.id("cedRespond"):$.id("cedDelete");c&&l?this._organizer?this._canCancelSupport()&&(s=this._initEvent.recurring&&!this.seriesInstance()?t.getString("EventCancelPromptMeeting"):t.getString("EventCancelPromptEvent"),e=[{label:t.getString("EventButtonOK"),onclick:this._cancelEvent.bind(this)}]):this._canRespondSupport()&&(f=[{label:t.getString("EventButtonSendResponse"),onclick:this._respondEx.bind(this,o.declined,true)},{label:t.getString("EventButtonDontSendResponse"),onclick:this._deleteEvent.bind(this)}]):(h=$.id("EventTitleTextbox").value,s=h.length?t.loadCompoundString("EventDeleteConfirmationTitled",h):t.getString("EventDeleteConfirmationUntitled"),e=[{label:t.getString("EventButtonDelete"),onclick:this._deleteEvent.bind(this)}]);f?r.showMenu({message:t.getString("EventResponseOptions"),anchor:u,commands:f}):r.showFlyout({anchor:u,message:s,commands:e})}};n.prototype._showForwardReplyOptions=function(){var n=this._isMailEnabled();return{respond:this._shouldShowResponseOptions(),reply:n,forward:!this._organizer&&this._canForwardSupport()&&n&&!this._isInPast()&&!this._isCanceled()}};n.prototype._onRespond=function(n){if(this._clickAnchor=n.currentTarget,r.hideFocusRectangleOnNextFocusOnly(n.target),this._saveFailedBecauseOfDelete){this._showAlreadyDeletedDialog();return}var u=this._showForwardReplyOptions(),f=[];u.respond&&(f=[{label:t.getString("EventAccept"),onclick:this._respond.bind(this,o.accepted)},{label:t.getString("EventTentative"),onclick:this._respond.bind(this,o.tentative)},{label:t.getString("EventDecline"),onclick:this._respond.bind(this,o.declined)}],(u.reply||u.forward)&&f.push({type:"separator"}));u.reply&&f.push({label:t.loadCompoundString("EventReply",Jx.key.getLabel("Ctrl+R")),onclick:this._replyForward.bind(this,Calendar.MailAction.reply)},{label:t.loadCompoundString("EventReplyAll",Jx.key.getLabel("Ctrl+Shift+R")),onclick:this._replyForward.bind(this,Calendar.MailAction.replyAll)});u.forward&&f.push({label:t.loadCompoundString("EventForward",Jx.key.getLabel("Ctrl+F")),onclick:this._replyForward.bind(this,Calendar.MailAction.forward)});r.showMenu({anchor:n.currentTarget,message:t.loadCompoundString("RespondCommand",Jx.key.getLabel("Ctrl+P")),commands:f})};n.prototype._shouldShowResponseOptions=function(){var n=this._isInPast(),t=this._isCanceled();return!this._organizer&&this._canRespondSupport()&&!n&&!t};n.prototype._onSaveButton=function(t){this._clickAnchor=t.currentTarget;r.hideFocusRectangleOnNextFocusOnly(t.target);var u=this._isDirty()||this._forceDirty;u?this._onSave():this._animateOut(n.CloseCommands.cancel,this._targetEvent)};n.prototype._onSave=function(){if(!this._targetEventCommitting&&(i("save_start"),this._validate())){var t=this._updateEvent();this._commitEvent(t)&&this._animateOut(n.CloseCommands.save,this._targetEvent)}};n.prototype._onSend=function(t){this._targetEventCommitting||(this._clickAnchor=t.currentTarget,r.hideFocusRectangleOnNextFocusOnly(t.target),this._sendEvent()&&this._animateOut(n.CloseCommands.send,this._targetEvent))};n.prototype._onFreeBusy=function(){var n,t,i,u,r;this._freeBusy||(this._freeBusy=new Calendar.Views.FreeBusy,this.appendChild(this._freeBusy),this._freeBusy.addListener("back",this._onFreeBusyBack,this));n=this.getDuration();n.endDate<n.startDate&&(n.endDate=new Date(n.startDate.getTime()));this._freeBusy.setRange(n.startDate,n.endDate);this._freeBusy.setCalendar(this._getSelectedCalendar());t=this._who.getRecipients();this._organizer||t.push({emailAddress:this._targetEvent.organizerEmail,calculatedUIName:this._targetEvent.organizerName});this._freeBusy.setAttendees(t);$(document).off("keydown",this._onKeyDown);i=$.id("eventDetails");i.disabled=true;i.setAttribute("aria-hidden",true);this._appBar.disabled=false;this._freeBusyHost?(this._freeBusy.resume(),requestAnimationFrame(function(){this._freeBusyHost.removeAttribute("aria-hidden");var n=this._freeBusyHost.style;n.zIndex="";n.opacity=""}.bind(this))):(u=Jx.getUI(this._freeBusy),r=document.getElementById("cedContainer"),r.insertAdjacentHTML("beforeend",u.html),this._freeBusyHost=r.lastElementChild,this._freeBusy.activateUI(this._jobset));this._freeBusyOpen=true};n.prototype._onFreeBusyBack=function(n){var t,i,r;this._updateDuration(n.start,n.end);this._freeBusyHost.setAttribute("aria-hidden",true);t=this._freeBusyHost.style;t.zIndex="-1";t.opacity="0";this._freeBusy.pause();i=$.id("eventDetails");i.setAttribute("aria-hidden",false);i.disabled=false;$(document).on("keydown",this._onKeyDown);this._appBar.hide();this._appBar.disabled=true;this._peekBar.hide();r=$.id("FreeBusyButton");r.offsetWidth&&r.focus();this._freeBusyOpen=false};n.prototype._onAccountResourceChanged=function(n){for(var i=n.detail[0],t=0,r=i.length;t<r;t++)if(i[t]==="signatureType"){this._unhookAccountResource();this._canAddSignature=true;this._hasAttendee&&this._addSignatureIfPossible();break}};n.prototype._onAccountChanged=function(n){for(var i=n.detail[0],t=0,r=i.length;t<r;t++)i[t]==="mailScenarioState"&&this._updateButtons()};n.prototype._removeResource=function(){if(this._resource){this._who.deleteRecipientByEmail(this._resource.email);var n=$.id("LocationTextbox");n.value===this._resource.name&&(n.value="");this._resource=null}};n.prototype._showPlatformError=function(u){var e,o,f,s;switch(u){case tt.errorExceptionsStartOnSameDay:e=t.getString("EventErrorInstanceExists");break;case tt.errorExceptionsOverlap:e=t.getString("EventErrorRecurrenceDate");break;case tt.errorRecurrenceInvalid:e=t.getString("EventErrorRecurrencePattern");break;case tt.errorEventExceptionDeleteRequired:o={anchor:this._clickAnchor||$.id("cedCancel"),message:t.getString(this._isMeeting()?"EventConfirmExceptions":"EventConfirmExceptionsNoAttendees"),commands:[{label:t.getString("EventButtonSave"),onclick:function(){this._targetEvent.deleteExceptions();this._sendEvent()&&this._animateOut(n.CloseCommands.send,this._targetEvent)}.bind(this)}]};break;default:o={anchor:this._clickAnchor||$.id("cedSave"),message:t.getString("EventErrorSaveGeneric"),commands:[]}}o?r.showFlyout(o):($.id("showError")||(f=document.createElement("div"),f.setAttribute("role","status"),f.className="error",f.id="showError",s=$.id("schedule"),s.insertBefore(f,s.firstChild)),$.id("showError").innerHTML=e)};n.prototype._close=function(n){this._who&&this._who.cancelPendingSearches();this.fire("finishedEditing",n)};n.prototype._isDirty=function(){var r=this._parseAttendees(),t,i,n;return r.added.length||r.deleted.length?true:this._isCanvasDirty()?true:(t=$.id("EventTitleTextbox").value,i=$.id("LocationTextbox").value,this.isNewEvent()&&(t!==""||i!==""))?true:t!==this._initEvent.subject||i!==this._initEvent.location||ut($.id("ReminderCombo"))!==this._initEvent.reminder||ut($.id("StatusCombo"))!==this._initEvent.busyStatus?true:(n=this.getDuration(),n.isAllDay&&!this._initEvent.allDayEvent||Math.abs(this._initEvent.startDate-n.startDate)>=3e5||Math.abs(this._initEvent.endDate-n.endDate)>=3e5)?true:$.id("PrivateCheckbox").checked^this._initEvent.sensitivity!==p.normal?true:this._initEvent.recurrenceIndex!==nt($.id("RecurrenceCombo"))?true:this._endOccurrence.isDirty()?true:false};n.prototype._updateAppBar=function(){u("_updateAppBar");var n={};this.fire("getAppBar",n);this._appBar=n.appBar;this._peekBar=n.peekBar;this._appBar&&(this._appBar.hide(),this._appBar.disabled=true);this._peekBar&&this._peekBar.hide();f("_updateAppBar")};n.prototype._shouldShowSendButton=function(){return this._organizer&&this._isMeeting()};n.prototype._shouldShowRespondButton=function(){return!this.isNewEvent()&&this._startedAsMeeting&&this._isMeeting()&&(this._shouldShowResponseOptions()||this._isMailEnabled())};n.prototype._isMeeting=function(){return!this._organizer||this._whoElement.value!==""||this._hasAttendee||this._initEvent.attendeeList.length};n.prototype._isMailEnabled=function(){return this._selectedAccount.mailScenarioState===k.ScenarioState.connected};n.prototype._isCanceled=function(){var n=this._targetEvent&&this._targetEvent.meetingStatus;return n&d.isCanceled};n.prototype._isInPast=function(){var t,i=false;return this.isNewEvent()||(this._initEvent.recurring&&this._eventType===n.eventType.Series?(t=this._initEvent.recurrence,+t.until<Date.now()&&+t.until!==n.InfiniteDate&&(i=true)):i=+this._initEvent.endDate<Date.now()),i};n.prototype._updateButtons=function(){u("_updateButtons");var t=$.id("cedSend"),p=!v(t),r=this._shouldShowSendButton(),o=$.id("cedSave"),w=!v(o),h=!this._targetEvent,y=!h&&this._targetEvent.calendar.readOnly,c=!r&&(h||!y),n=$.id("cedRespond"),b=!v(n),l=this._shouldShowRespondButton(),s=$.id("cedDelete"),k=!v(s),a=!h&&!y&&(this._organizer||!this._shouldShowResponseOptions());if(a!==k)if(e(s,!a),a)$(s).on("click",this._onDelete);else $(s).off("click",this._onDelete);if(r!==p)if(e(t,!r),r)$(t).on("click",this._onSend);else $(t).off("click",this._onSend);if(l!==b)if(e(n,!l),l){WinJS.UI.Animation.fadeIn(n);$(n).on("click",this._onRespond)}else WinJS.UI.Animation.fadeOut(n),$(n).off("click",this._onRespond);if(c!==w)if(e(o,!c),c)$(o).on("click",this._onSaveButton);else $(o).off("click",this._onSaveButton);f("_updateButtons")};n.prototype._showErrorMessage=function(n){var t=$.id(n.id);t||(t=document.createElement("div"),t.setAttribute("role","status"),t.id=n.id,t.className="error",n.before.parentNode.insertBefore(t,n.before));t.innerText=n.text};n.prototype._hideErrorMessage=function(n){var t=$.id(n);t&&t.parentNode.removeChild(t)};n.prototype._validate=function(){var r=this.getDuration(),i;return r.endDate<r.startDate?(i={id:"showError",text:t.getString("EventErrorEndDate"),before:$.id("schedule").firstChild},this._showErrorMessage(i)):this._hideErrorMessage("showError"),(this._whoElement.value!==""||this._hasAttendee)&&this._who.getError()!==null?(i={id:"addressWellError",text:this._who.getError(),before:$.id("GuestsDescrip")},this._showErrorMessage(i)):this._hideErrorMessage("addressWellError"),nt($.id("RecurrenceCombo"))!==0&&r.startDate>this._endOccurrence.date()&&+this._endOccurrence.date()!==n.InfiniteDate?(this._onShowMore(false),i={id:"endOccurrenceError",text:t.getString("OccurrenceEndDateBeforeStartDateError"),before:$.id("EndOccurrence")},this._showErrorMessage(i)):this._hideErrorMessage("endOccurrenceError"),!i};n.prototype._onDurationChanged=function(t){if(t.target.selectedIndex===n.durationAllDay)$.id("AlldayCheckbox").checked=true,this._toggleAllDay(true);else if(t.target.selectedIndex===n.durationCustom){var u=this._getDateFromControls(this._controls.startDate,this._controls.startTime),i=new Date(u.getTime()+($.id("AlldayCheckbox").checked?0:r.hourInMilliseconds));i>Calendar.LAST_DAY&&(i=u);this._controls.endTime.unmock&&this._controls.endTime.unmock();this._setEndDate(i);this._controls.endTime.current=i;this._showCustomDuration(true);$.id("EndDateCombo").focus()}else this._previousEventDuration=$.id("EventDuration").value,$.id("AlldayCheckbox").checked=false,this._toggleAllDay(false)};n.prototype._onAllDayChanged=function(n){this._toggleAllDay(n.target.checked)};n.prototype._onGuestsChanged=function(){this._hasAttendee=this._who.getRecipients().length!==0;this._parseAttendeesCache=null;this._updateButtons()};n.prototype.getDuration=function(){var t,i,u=this._controls.startTime.disabled,f;return t=this._getDateFromControls(this._controls.startDate,this._controls.startTime),this._isCustomDuration?(i=this._getDateFromControls(this._controls.endDate,this._controls.endTime),u&&t<=i&&i.setDate(i.getDate()+1)):(f=$.id("EventDuration"),f.selectedIndex===n.durationAllDay||u?(u=true,i=new Date(t.getFullYear(),t.getMonth(),t.getDate()+1)):i=new Date(t.getTime()+this._previousEventDuration*r.minuteInMilliseconds)),{startDate:t,endDate:i,isAllDay:u}};n.prototype.getStartTime=function(){return this._controls.startTime.current};n.prototype._updateStartDate=function(n){this._controls.startDate=n;var t=this.getDuration();this._targetEvent?(this._targetEvent.startDate=t.startDate,this._targetEvent.endDate=t.endDate):(this._initEvent.startDate=t.startDate,this._initEvent.endDate=t.endDate)};n.prototype.setRecurrence=function(t){var i=this._controls.startDate,r=nt($.id("RecurrenceCombo"));switch(r){case n.recurrences.Daily:t.recurrenceType=l.daily;break;case n.recurrences.Weekdays:for(t.recurrenceType=l.weekly,t.dayOfWeek=n.weekDays;i.getDay()===6||i.getDay()===0;)i.setDate(i.getDate()+1);this._updateStartDate(i);break;case n.recurrences.MWF:for(t.recurrenceType=l.weekly,t.dayOfWeek=n.mwfDays;i.getDay()!==1&&i.getDay()!==3&&i.getDay()!==5;)i.setDate(i.getDate()+1);this._updateStartDate(i);break;case n.recurrences.TTH:for(t.recurrenceType=l.weekly,t.dayOfWeek=n.tthDays;i.getDay()!==2&&i.getDay()!==4;)i.setDate(i.getDate()+1);this._updateStartDate(i);break;case n.recurrences.Weekly:t.recurrenceType=l.weekly;t.dayOfWeek=Math.pow(2,i.getDay());break;case n.recurrences.Monthly:t.recurrenceType=l.monthly;t.dayOfMonth=i.getDate();break;case n.recurrences.Yearly:t.recurrenceType=l.yearly;t.monthOfYear=i.getMonth()+1;t.dayOfMonth=i.getDate()}r!==n.recurrences.None&&(this._eventType===n.eventType.Event||this.isNewEvent())&&(t.interval=1);t.occurrences!==0&&(t.occurrences=0)};n.prototype._setupDuration=function(t,i,e){var o,s,l,h;return u("_setupDuration"),o=false,t=new Date(t.getTime()),i=new Date(i.getTime()),e?i-t<=r.dayInMilliseconds?$.id("EventDuration").selectedIndex=n.durationAllDay:(o=true,i.setDate(i.getDate()-1)):(s=Math.floor((i-t)/r.minuteInMilliseconds),o=lt(s),o||($.id("EventDuration").value=s.toString(),this._previousEventDuration=s.toString())),o||(i=new Date(t.getTime()+r.hourInMilliseconds)),l=at(t,5),h=at(i,5),this._controls={startTime:new WinJS.UI.TimePicker($.id("StartTimeCombo"),{current:l,minuteIncrement:5})},bt(this._controls,"endTime",function(){return setImmediate(function(){$("#EndTimeCombo select").each(function(){this.setAttribute("aria-labelledby","EndDateDescrip")})}),new WinJS.UI.TimePicker($.id("EndTimeCombo"),{current:h,minuteIncrement:5})}),this._setStartDate(t),this._setEndDate(i),this._controls.endTime.current=h,e&&(this._controls.startTime.disabled=true,this._controls.endTime.disabled=true,$.id("AlldayCheckbox").checked=true),o&&this._controls.endTime.unmock(),this._eventType===n.eventType.Event||this._organizer||(c($.id("StartDateCombo")),$("select",$.id("StartTimeCombo")).each(b),o?(c($.id("EndDateCombo")),$("select",$.id("EndTimeCombo")).each(b)):$("select#EventDuration").each(b),c($.id("AlldayCheckbox")),$.id("AlldayCheckbox").disabled=true,this._readOnlyEndDate=true),this._showCustomDuration(o),f("_setupDuration"),o};n.prototype._updateDuration=function(n,t){var e,i,f;u("_updateDuration");e=$.id("AlldayCheckbox");i=e.checked;i&&(n.getHours()||n.getMinutes()||t.getHours()||t.getMinutes()?(i=false,e.checked=false,this._toggleAllDay(false)):t.setDate(t.getDate()-1));this._isCustomDuration||(i?n.getTime()<t.getTime()&&(this._controls.endTime.unmock(),this._showCustomDuration(true)):(f=Math.floor((t-n)/r.minuteInMilliseconds),lt(f)?(this._controls.endTime.unmock(),this._showCustomDuration(true)):($.id("EventDuration").value=f.toString(),this._previousEventDuration=f)));this._setStartDate(n);this._controls.startTime.current=n;this._setEndDate(t);this._controls.endTime.current=t};n.prototype._setupStatus=function(n){var r,i,t,e;for(r=$.id("StatusCombo").options,i=[a.free,a.busy,a.tentative,a.outOfOffice],t=0,e=i.length;t<e;t++)r[t].value=i[t],i[t]===n&&(r[t].selected=true)};n.prototype._setupRecurrence=function(i){u("_setupRecurrence");var r;if(i.interval===1)switch(i.recurrenceType){case l.daily:case l.weekly:i.dayOfWeek===0||i.dayOfWeek===n.allDays?r=n.recurrences.Daily:i.dayOfWeek===n.mwfDays?r=n.recurrences.MWF:i.dayOfWeek===n.tthDays?r=n.recurrences.TTH:i.dayOfWeek===n.weekDays?r=n.recurrences.Weekdays:i.dayOfWeek&i.dayOfWeek-1||(r=n.recurrences.Weekly);break;case l.monthly:r=n.recurrences.Monthly;break;case l.yearly:r=n.recurrences.Yearly}r&&!i.occurrences?($.id("RecurrenceCombo").selectedIndex=r,this._initEvent.recurrenceIndex=r):(this._addOption($.id("RecurrenceCombo"),t.getString("EventRecurrenceCustom"),"",true),this._initEvent.recurrenceIndex=$("#RecurrenceCombo option").length-1);f("_setupRecurrence")};n.prototype._setupCalendarCombo=function(){var n,t;u("_setupCalendarCombo");this._calendars=[];n=null;this.isNewEvent()?(n=this._lastSelectedCalendarId||this._settings.get("lastCalendarId"),t=this._getPlatform(),this._calendars=et.getCalendarsForSelector(t)):this._calendars.push(et.createCalendarOption(this._targetEvent.calendar,false));this._calendarSelector.on("calendarSelected",this._onCalendarSelected);this._calendarSelector.setCalendars(this._calendars);this._calendarSelector.updateSelectionById(n);f("_setupCalendarCombo")};n.prototype._onCalendarSelected=function(n){var r,t,u;this._selectedCalendarIndex=n.data.index;r=this._calendars[this._selectedCalendarIndex];t=r.calendar.account;this._updateColors(r.colorRaw);u=k.ScenarioState.connected===t.mailScenarioState;e($.id("GuestsDescrip"),!u);e($.id("GuestsCombo"),!u);u&&this._who.setContextualAccount(t);this._capabilities=r.calendar.capabilities;this._updateFreeBusyButton();t!==this._selectedAccount&&(this._unhookAccount(),this._selectedAccount=t,this._hookAccount(t));this._updateWhoAriaFlow()};n.prototype._updateWhoAriaFlow=function(){v($.id("FreeBusy"))?v($.id("ShowMore"))?this._who.setAriaFlow("GuestDescrip","ShowMoreButton"):this._who.setAriaFlow("GuestDescrip","RecurrenceDescrip"):this._who.setAriaFlow("GuestDescrip","FreeBusyButton")};n.prototype._updateFreeBusyButton=function(){var n=this._requestFreeBusySupport()&&!this.isReadOnly()&&this._organizer&&this._outerWidth>499;e($.id("FreeBusy"),!n)};n.prototype._fadeOutColor=function(n,t){var i=n>>16&255,r=n>>8&255,u=n&255;return"rgba("+i+","+r+","+u+","+t+")"};n.prototype._updateColors=function(n){var t,e,o;u("_updateColors");t=r.processEventColor(n);e=this._platform.calendarManager.colorTable.computeLinkValue(n);AddressWell.updateColor(n);$.id("ShowMoreButton").style.color=e;$.id("ToggleResponsesButton").style.color=e;o=document.getElementsByTagName("head")[0];this._buttonStyle&&(o.removeChild(this._buttonStyle),this._buttonStyle=null);var h=this._fadeOutColor(n,.13),s=document.createElement("style"),c="#eventDetails button:hover:active .win-commandimage,        #eventDetails button:-ms-keyboard-active .win-commandimage, #eventDetails input:hover:active::-ms-check,                #eventDetails input:-ms-keyboard-active::-ms-check {            color: rgba(255, 255, 255, 1.0);                        }                                                           #eventDetails input::-ms-check,                             #eventDetails .win-commandimage,                            #eventDetails #cedTitle {                                       color: "+t+";                                }                                                           #eventDetails .win-commandring,                             #eventDetails input:active::-ms-check,                      #eventDetails input:focus::-ms-check,                       #eventDetails input[type=text]:active,                      #eventDetails input[type=text]:focus,                       #eventDetails select:focus,                                 #eventDetails select:active {                                   border-color: "+t+";                         }                                                           #eventDetails input[readonly],                              #eventDetails input:disabled::-ms-check,                    #eventDetails select:disabled {                                 border-color: rgba(0, 0, 0, 0.15);                      }                                                           #eventDetails > #cedNotes {                                     border-top-color: "+t+";                     }                                                           #eventDetails button:hover .win-commandring {                   background-color: "+h+";                   }                                                           #eventDetails button:hover:active .win-commandring,         #eventDetails button:-ms-keyboard-active .win-commandring,  #eventDetails input:hover:active::-ms-check,                #eventDetails input:-ms-keyboard-active::-ms-check,         #eventDetails option:checked,                               #eventDetails ::selection,                                  #eventDetails select:focus::-ms-value {                         background-color: "+t+";                     }                                                           .messageBar .messagebar-status {                                top: 5px;                                               }                                                           ",l=document.createTextNode(c);s.appendChild(l);o.appendChild(s);this._buttonStyle=s;f("_updateColors")};n.prototype._setupAttendees=function(){var n,t;var i=this._initEvent.attendeeList,r=i.length,e=[],o=this._getPlatform();if(r){for(n=0;n<r;n++)t=i[n],e.push(AddressWell.Recipient.fromEmail(t.email,t.name,o));this._who.addRecipients(e,true);this._hasAttendee=true}};n.prototype._showCustomDuration=function(n){this._isCustomDuration=n;n&&$("#EventDurationDescrip, #EventDuration").remove();$(".durationCustom").each(function(){e(this,!n)});this._resizeCanvas()};n.prototype._toggleAllDay=function(t){this._controls.startTime.disabled=t;this._controls.endTime.disabled=t;t?(this._prevValues={},this._prevValues.reminder=$.id("ReminderCombo").selectedIndex,this._prevValues.status=$.id("StatusCombo").selectedIndex,this._prevValues.startTime=this._controls.startTime.current,this._prevValues.endTime=this._controls.endTime.current,$.id("ReminderCombo").selectedIndex=n.reminder18,this._prevValues.status===n.statusBusy&&($.id("StatusCombo").selectedIndex=n.statusFree),this._controls.startTime.current="12:00 AM",this._controls.endTime.current="12:00 AM"):this._prevValues&&($.id("ReminderCombo").selectedIndex===n.reminder18&&($.id("ReminderCombo").selectedIndex=this._prevValues.reminder),$.id("StatusCombo").selectedIndex===n.statusFree&&($.id("StatusCombo").selectedIndex=this._prevValues.status),this._controls.startTime.current=this._prevValues.startTime,this._controls.endTime.current=this._prevValues.endTime,this._prevValues=null)};n.prototype._resizeCanvas=function(){var n=5;this._isCustomDuration&&(n+=1);this._calendarSelector.hasDropdown()&&n--;this._canvas.style.minHeight=n*32+(n-1)*27-20+"px"};n.prototype._getDateFromControls=function(n,t){return st(n,t.current)};n.prototype._addOption=function(n,t,i,r){var u=document.createElement("option");return u.text=t,u.value=i,u.selected=r,n.appendChild(u),u};n.prototype._addSignatureIfPossible=function(){var t;if(this._canAddSignature&&!this._addedSignature){var e=this._getSelectedCalendar(),i=e.account,r=i.getResourceByType(k.ResourceType.calendar);if(r.signatureType===k.SignatureType.enabled){if(t=i.getResourceByType(k.ResourceType.mail),t)if(t.signatureType===k.SignatureType.enabled){var n=document.createElement("div"),u=document.createElement("div"),o=t.signatureText,f=false;u.innerText=o;n.setAttribute("class","wl-calendar-signature");n.appendChild(document.createElement("br"));n.appendChild(u);n.appendChild(document.createElement("br"));this._canvasControl.getCharacterCount()||(n.insertBefore(document.createElement("br"),n.firstChild),f=true);this._dirtyTracker.pause();this._canvasControl.addContent(n,ModernCanvas.ContentFormat.documentFragment,ModernCanvas.ContentLocation.end);this._addedSignature=true;this._dirtyTracker.resume();f&&this._canvasControl.showCueText()}else this._hookAccountResource(t)}else this._hookAccountResource(r);this._canAddSignature=false}};n.prototype._removeOldSignature=function(){var t=this._canvasControl.getCanvasElement(),n=t.querySelector(".wl-calendar-signature");n&&(n.outerHTML="");this._addedSignature=false};n.prototype._updateSignatureForAccount=function(){this._canAddSignature=this.isNewEvent();this._unhookAccountResource();this._addedSignature&&this._removeOldSignature();this._hasAttendee&&this._addSignatureIfPossible()};n.prototype._isCalendarAccountEmail=function(n){var t,u;if(!this._calendarAccountEmails){var i=[],f=this._targetEvent?this._targetEvent.calendar.account:this._selectedAccount,r=f.allEmailAddresses;for(t=0,u=r.size;t<u;++t)i[t]=r[t].toUpperCase();this._calendarAccountEmails=i}return this._calendarAccountEmails.indexOf(n.toUpperCase())!==-1};n.prototype._sendEvent=function(){var c,l,a,w,f,e,b,o,v;if(!this._validate())return false;var y=this._updateEvent(),s=this._getAccount(this._targetEvent),h=this._getPlatform(),u=this._parseAttendees(),p=r.formatEmailAddress,i,n;if(this._canCancelSupport()&&(c=u.deleted.length,c)){for(l="",n=0;n<c;n++)a=u.deleted[n],l+=p(a.name,a.email)+"; ";w=this._targetEvent.meetingStatus;this._targetEvent.meetingStatus=d.isAMeeting|d.isCanceled;i=h.invitesManager.mailFromEvent(this._targetEvent,s,u.deleted);i.to=l;i.subject=t.getString("EventCancelledPrefix")+this._initEvent.subject;this._targetEvent.meetingStatus=w}if(!this._commitEvent(y))return false;if(i&&this._canCancelSupport()&&this._sendMail(i),this._targetEvent=h.calendarManager.getEventFromHandle(this._targetEvent.handle),this._targetEvent===null)return this._saveFailedBecauseOfDelete=true,this._showAlreadyDeletedDialog(),false;if(f="",y||u.added.length>0){for(e=this._targetEvent.getAttendees(),b=e.count,n=0;n<b;n++)o=e.item(n),this._isCalendarAccountEmail(o.email)||(f+=p(o.name,o.email)+"; ");e.dispose()}return f!==""&&(v=h.invitesManager.mailFromEvent(this._targetEvent,s),v.to=f,this._sendMail(v,s)),true};n.prototype._cancelEvent=function(){this._targetEventCommitting||(this._reloadPlatformEvent(),this._saveFailedBecauseOfDelete?this._showAlreadyDeletedDialog():this._initEvent.attendeeList.length>0?(r.launchMail(Calendar.MailAction.cancel,this._targetEvent),this._close(this._targetEvent)):this._deleteEvent())};n.prototype._respond=function(n){this._isMailEnabled()&&this._targetEvent.responseRequested?r.showMenu({anchor:$.id("respondCommand")||$.id("cedRespond"),message:t.getString("EventResponseOptions"),commands:[{label:Jx.res.getString("EventEditBeforeSend"),onclick:this._editResponseInMail.bind(this,n)},{label:t.getString("EventSendNow"),onclick:this._respondEx.bind(this,n,true)},{label:t.getString("EventDontSend"),onclick:this._respondEx.bind(this,n,false)}]}):this._respondEx(n,false)};n.prototype._editResponseInMail=function(t){var i;switch(t){case o.accepted:i=Calendar.MailAction.accept;break;case o.tentative:i=Calendar.MailAction.tentative;break;case o.declined:i=Calendar.MailAction.decline}this._initEvent.responseType=t;this._showYourResponse();Jx.bici.addToStream(this._getIdsCalendar().inviteResponse,n.BiciResponse[t],n.BiciResponseType.Edit,1);r.launchMail(i,this._targetEvent);t===o.declined&&this._close(this._targetEvent)};n.prototype._respondEx=function(t,i){var r,e,h;if(Jx.bici.addToStream(this._getIdsCalendar().inviteResponse,n.BiciResponse[t],i?n.BiciResponseType.Send:n.BiciResponseType.NoSend,1),!this._targetEventCommitting){var f=this._getAccount(this._targetEvent),u=null,s=this._getPlatform();s.invitesManager.sendMeetingResponse(this._targetEvent,null,t,f);i&&(u=s.invitesManager.createResponseMail(this._targetEvent,null,t,f),r=null,u?Jx.isNonEmptyString(u.to)?this._sendMail(u,f):r={message:"Unable to send response mail due to lack of organizer email",number:vt}:this._targetEvent.responseRequested&&(r={message:"Failed to get mail from platform even though a response was requested",number:yt}),r&&Jx.fault("eventDetails.js","_respondEx",r));t===o.declined?this._deleteEvent():this._validate()&&(e=this._updateEvent(),this._initEvent.responseType!==t&&(e=true,this._targetEvent.responseType=t,h=t===o.accepted?this._targetEvent.allDayEvent?a.free:a.busy:a.tentative,this._setProp("busyStatus",h)),this._commitEvent(e)&&this._animateOut(n.CloseCommands.send,this._targetEvent))}};n.prototype._replyForward=function(n){var t,i;if(!this._targetEventCommitting){if(t=false,n===Calendar.MailAction.reply||n===Calendar.MailAction.replyAll){r.launchMail(n,this._targetEvent);return}this._validate()&&(this._shouldShowSendButton()?t=this._sendEvent():(i=this._updateEvent(),t=this._commitEvent(i)));t&&(r.launchMail(n,this._targetEvent),this._close(this._targetEvent))}};n.prototype._loadAttendees=function(){for(var i=this._targetEvent.getAttendees(),r=[],n,t=0,u=i.count;t<u;t++)n=i.item(t),n.attendeeType===ft.resource&&(this._resource=n),this._isCalendarAccountEmail(n.email)||r.push(n);return i.dispose(),r};n.prototype._parseAttendees=function(){var f,h,u,c;if(!this._parseAttendeesCache){var e=this._initEvent.attendeeList,l=e.length,t={},o=[],s=[],r,n;if(this._who)for(f=this._who.getRecipients(),h=f.length,n=0;n<h;++n)u=f[n],this._isCalendarAccountEmail(u.emailAddress)||(t[u.emailAddress]=u);for(n=0;n<l;++n)r=e[n],t[r.email]?delete t[r.email]:o.push(r);for(c in t)s.push(t[c]);this._parseAttendeesCache={added:s,deleted:o}}return this._parseAttendeesCache};n.prototype._updateAttendees=function(){var e=this._initEvent.attendeeList.length,t=this._parseAttendees(),i=t.added.length,u=t.deleted.length,s=null,n,r,f;for(this._resource&&(s=this._resource.email),n=0;n<i;n++)r=t.added[n],f=this._targetEvent.addAttendee(r.calculatedUIName,r.emailAddress),f.responseType=o.notResponded,f.attendeeType=r.emailAddress===s?ft.resource:ft.required;for(n=0;n<u;n++)t.deleted[n].canDelete&&t.deleted[n].deleteObject();return this._targetEvent.meetingStatus&d.isAMeeting?e+i-u==0&&(this._targetEvent.meetingStatus=d.notAMeeting):!e&&Boolean(i)&&(this._targetEvent.meetingStatus=d.isAMeeting),i||u};n.prototype._sendMail=function(n){n.moveToOutbox();n.commit()};n.prototype._getSelectedCalendar=function(){return this.isNewEvent()?this._calendars[this._selectedCalendarIndex].calendar:this._targetEvent.calendar};n.prototype._createEvent=function(){var n=this._getSelectedCalendar();return n.createEvent()};n.prototype._getEvent=function(n,t){var r=t||this._getPlatform().calendarManager.getEventFromHandle(n);this._eventType=r.eventType;this._organizer=r.isOrganizer;this._targetEvent=r};n.prototype._sameRecurrence=function(n,t){return n.recurrenceType===t.recurrenceType&&n.interval===t.interval&&n.dayOfWeek===t.dayOfWeek&&n.dayOfMonth===t.dayOfMonth&&n.monthOfYear===t.monthOfYear&&r.isSameDate(n.until,t.until)};n.prototype._updateEvent=function(){var r=false,u=this._initEvent,t,f;u.id?t=this._targetEvent:(t=this._targetEvent=this._createEvent(),r=true,t.responseRequested=true);var e=this.getDuration(),o=e.startDate,s=e.endDate,y=e.isAllDay,h=false;this._setProp("allDayEvent",y)&&(r=true,h=true);f=false;(h||o-u.startDate&&o-t.startDate||!u.id)&&(r=true,f=true,t.startDate=o);(h||s-u.endDate&&s-t.endDate||!u.id)&&(t.endDate=s,r=true);this._setProp("subject",$.id("EventTitleTextbox").value)&&(r=true);this._setProp("location",$.id("LocationTextbox").value)&&(this._providerBiciInfo.locationChanged=1,r=true);this._setProp("reminder",ut($.id("ReminderCombo")))&&(r=true);this._setProp("busyStatus",ut($.id("StatusCombo")))&&(r=true);$.id("PrivateCheckbox").checked?u.sensitivity===p.normal&&t.sensitivity!==p.private&&(t.sensitivity=p.private,r=true):u.sensitivity!==p.normal&&t.sensitivity!==p.normal&&(t.sensitivity=p.normal,r=true);var l=nt($.id("RecurrenceCombo")),a=l!==0,v=this._eventType===n.eventType.Series,c=this._endOccurrence.isDirty();return this._initEvent.recurrenceIndex!==l?(a?(this._initEvent.recurrenceIndex===0&&(t.recurring=true,t.recurrence.until=this._endOccurrence.date()),this.setRecurrence(t.recurrence)):t.recurring=false,this._providerBiciInfo.recurrenceChanged=1,r=true):v&&a&&f&&(this.setRecurrence(t.recurrence),r=true),(v&&(c||f)||this.isNewEvent()&&c)&&(t.recurrence&&(t.recurrence.until=this._endOccurrence.date()),this._providerBiciInfo.recurrenceChanged=this._providerBiciInfo.recurrenceChanged||c?1:0,r=true),this._isCanvasDirty()&&(t.data=this._getCanvasContent(),t.dataType=this._htmlBodySupport()?g.html:g.plainText,this._providerBiciInfo.notesChanged=1,r=true),r};n.prototype._getCanvasContent=function(){var n=this._htmlBodySupport()?ModernCanvas.ContentFormat.htmlString:ModernCanvas.ContentFormat.text,t=this._canvasControl.getContent([n]);return t[n]};n.prototype.getCanvasWindow=function(){return this._canvasControl.getWindow()};n.prototype._isCanvasDirty=function(){return this._dirtyTracker.isDirty};n.prototype._setProp=function(n,t){return(this.isNewEvent()||this._initEvent[n]!==t)&&this._targetEvent[n]!==t?(this._targetEvent[n]=t,true):false};n.prototype._writeWLINewEventData=function(){var n=this._targetEvent,t=Math.ceil((r.roundDateDown(n.startDate)-r.roundDateDown(new Date))/864e5),u=nt($.id("RecurrenceCombo")),f=this._parseAttendees().added.length,e=n.location===""?0:1,o=v($.id("FreeBusy"))?0:this._freeBusy?1:2;t>=0&&Jx.bici.addToStream(this._getIdsCalendar().calendarCreateEvent,t,u,f,e,o)};n.prototype._writeWLIUpdatedEventData=function(){var r=this._targetEvent;if(r.uid===this._settings.get("lastProviderUid")){var t=this._parseAttendees(),u=t.added.length>0||t.deleted.length>0?1:0,n=this._providerBiciInfo;this._settings.set("lastProviderUid",false);Jx.bici.addToStream(this._getIdsCalendar().calendarProviderCreateEventUpdate,n.recurrenceChanged,u,n.locationChanged,n.notesChanged)}};n.prototype._commitEvent=function(n){if(!this._saveFailedBecauseOfDelete){var t=this._targetEvent.validate();if(t!==tt.success)return this._showPlatformError(t),this._reloadPlatformEvent(),false;if(this._organizer&&this._updateAttendees()&&(n=true),this._forceDirty&&(this._targetEvent.markDirty(),n=true),n){this._targetEventCommitting=true;try{this._targetEvent.commit()}catch(i){Jx.log.exception("EventDetails._commitEvent: Error committing event, assume the event was deleted.",i);this._targetEventCommitting=false;this._saveFailedBecauseOfDelete=true}this._saveFailedBecauseOfDelete||(this.isNewEvent()?this._writeWLINewEventData():this._writeWLIUpdatedEventData())}}return this._saveFailedBecauseOfDelete?(this._showAlreadyDeletedDialog(),false):(this._settings.set("lastCalendarId",this._targetEvent.calendar.id),true)};n.prototype._reloadPlatformEvent=function(){this._targetEvent=null;try{this.isNewEvent()||(this._getEvent(this._initEvent.handle,null),this._initEvent.attendeeList=this._loadAttendees(),this._parseAttendeesCache=null)}catch(n){Jx.log.exception("Failed to load event, assume event is deleted",n);this._targetEvent=null}this._targetEvent===null&&(this._saveFailedBecauseOfDelete=true)};n.prototype._showAlreadyDeletedDialog=function(){r.showFlyout({anchor:this._clickAnchor||$.id("cedCancel"),message:t.getString("cedAlreadyDeleted"),commands:[{label:t.getString("CloseButton"),onclick:this._animateOut.bind(this,n.CloseCommands.del,null)}]})};n.prototype._deleteEvent=function(){try{this._targetEvent&&this._targetEvent.canDelete&&this._targetEvent.deleteObject();this._animateOut(n.CloseCommands.del,null)}catch(t){t.number===-2067070973&&this._animateOut(n.CloseCommands.del,null)}};n.prototype._cacheEvent=function(){var t=this._initEvent={},i=this._targetEvent,r,u;t.id=i.id;t.handle=i.handle;t.startDate=i.startDate;t.endDate=i.endDate;t.allDayEvent=i.allDayEvent;t.subject=i.subject;t.location=i.location;t.reminder=i.reminder;t.busyStatus=i.busyStatus===a.workingElsewhere?a.outOfOffice:i.busyStatus;t.sensitivity=i.sensitivity;t.attendeeList=this._loadAttendees();t.description=i.data;t.dataType=i.dataType;t.responseType=i.responseType;t.recurrenceIndex=0;i.recurring?(t.recurring=true,r={},u=i.recurrence,r.recurrenceType=u.recurrenceType,r.interval=u.interval,r.dayOfWeek=u.dayOfWeek,r.dayOfMonth=u.dayOfMonth,r.monthOfYear=u.monthOfYear,r.until=u.until,r.occurrences=u.occurrences,t.recurrence=r):this._eventType=n.eventType.Event};n.prototype._getAccount=function(n){var t=this._account;return t||(t=n.calendar.account,this.isNewEvent()||(this._account=t)),t};n.prototype.isNewEvent=function(){return!this._initEvent.id};n.prototype.isReadOnly=function(){return!this.isNewEvent()&&this._targetEvent.calendar.readOnly};n.prototype.hasResponded=function(){var n=this._initEvent.responseType;return n!==o.notResponded&&n!==o.organizer&&n!==o.none};n.prototype._hasAttendeeStatus=function(){return this._capabilities&&this._capabilities&h.attendeeStatus};n.prototype._hasResponseStatus=function(){return this._capabilities&&this._capabilities&h.responseType};n.prototype._canRespondSupport=function(){return!this._capabilities||(this._capabilities&h.canRespond)===h.canRespond};n.prototype._canForwardSupport=function(){return!this._capabilities||(this._capabilities&h.canForward)===h.canForward&&(this._capabilities&h.canReplaceMime)===h.canReplaceMime};n.prototype._canCancelSupport=function(){return!this._capabilities||(this._capabilities&h.canCancel)===h.canCancel};n.prototype._htmlBodySupport=function(){return!this._capabilities||(this._capabilities&h.htmlBody)===h.htmlBody};n.prototype._requestFreeBusySupport=function(){return!this._capabilities||(this._capabilities&h.requestFreeBusy)===h.requestFreeBusy};n.prototype.seriesInstance=function(){var t=this._targetEvent;return t&&(t.eventType===n.eventType.Instance||t.eventType===n.eventType.Exception)};ht=function(n,t){var i=document.createElement("div"),u=document.createElement("div"),r=n.name,f=n.email;return i.className="attendee",i.setAttribute("aria-label",(r===f?r:r+", "+f)+(t?", "+t:"")),i.setAttribute("role","option"),i.innerHTML="<div class='name' aria-hidden='true'>"+Jx.escapeHtml(r)+"<\/div><div class='email' aria-hidden='true'>"+Jx.escapeHtml(f)+"<\/div>",i.insertBefore(u,i.firstChild),u.className="avatar",u.style.background="url('"+(n.image!==""?n.image:"/modernaddresswell/UserPawn.png")+"')",i};n.prototype._insertOrganizer=function(){var n=AddressWell.Recipient.fromEmail(this._targetEvent.organizerEmail,this._targetEvent.organizerName,this._getPlatform());$.id("GuestsDescrip").parentNode.insertBefore(ht({email:n.emailAddress,name:n.calculatedUIName,image:AddressWell.getUserTileUrl(n.person,Microsoft.WindowsLive.Platform.UserTileSize.extraSmall)}),$.id("GuestsDescrip"))};rt=function(){this._responsesInserted=false;this._visible=false;this._onToggleVisibility=this._onToggleVisibility.bind(this)};rt.prototype.activateUI=function(n,t,i){(t.length!==1||t[0].email!==i)&&(this._insertResponses=this._insertResponses.bind(this,n,t,i),$("#ToggleResponsesButton").click(this._onToggleVisibility),e($.id("ToggleResponsesButton"),false))};rt.prototype._onToggleVisibility=function(){var n=!this._visible,i;this._visible=n;n&&!this._responsesInserted&&this._insertResponses();i=$.id("ToggleResponsesButton");i.innerText=t.getString(n?"HideResponsesButton":"ShowResponsesButton");i.setAttribute("aria-expanded",n);e($.id("AttendeeResponses"),!n)};rt.prototype._insertResponses=function(n,i){for(var a=[t.getString("EventResponseTypeNoResponse"),"organizer",t.getString("EventResponseTypeTentative"),t.getString("EventResponseTypeAccepted"),t.getString("EventResponseTypeDeclined"),],v=n.getRecipients(),y={},l,s,u,p,w,e,h,c,r=0,f=v.length;r<f;++r)l=v[r],y[l.emailAddress]=AddressWell.getUserTileUrl(l.person,Microsoft.WindowsLive.Platform.UserTileSize.extraSmall);for(s=[[],[],[],[],[]],r=0,f=i.length;r<f;++r)u=i[r],u.responseType!==o.organizer&&(p=u.responseType>4?0:u.responseType,s[p].push({email:u.email,name:u.name,image:y[u.email]}));for(w=$.id("AttendeeResponses"),r=0,f=a.length;r<f;++r){var b=s[r],k=b.length,d=a[r];if(k>0)for(e=document.createElement("div"),e.setAttribute("role","listbox"),w.insertBefore(e,null),h=document.createElement("div"),h.className="responseHeader",h.innerText=d+" - "+s[r].length,e.insertBefore(h,null),c=0;c<k;++c)e.insertBefore(ht(b[c],d),null)}this._responsesInserted=true};w=function(n){this.update=this.update.bind(this);this.hasEndOccurrence=null;this._readonly=null;this._date=null;this._readonly=null;this._eventDetails=n;this._startEndOccurrence=null};w.prototype.activateUI=function(){if(this._readonly=this._eventDetails.seriesInstance()||!this._eventDetails._organizer||this._eventDetails.isReadOnly(),!this._readonly){this._setEndOccurance=function(){this._setHasEndOccurance(true);setImmediate(function(){var n=$.id("EndOccurrenceCombo");n&&n.focus()})}.bind(this);this._clearEndOccurance=function(){this._setHasEndOccurance(false);this._eventDetails._validate();setImmediate(function(){var n=$.id("SetEndOccurrenceButton");n&&n.focus()})}.bind(this);$("#SetEndOccurrenceButton").on("click",this._setEndOccurance);$("#ClearEndOccurrenceButton").on("click",this._clearEndOccurance);$("#RecurrenceCombo").change(this.update);this.update()}};w.prototype.deactivateUI=function(){this._readonly||($("#SetEndOccurrenceButton").off("click",this._setEndOccurance),$("#ClearEndOccurrenceButton").off("click",this._clearEndOccurance))};w.prototype._setHasEndOccurance=function(t){if(t){var i=this.date();+i===n.InfiniteDate&&(i=this._eventDetails.getDuration().startDate);this._startEndOccurrence===null&&(this._startEndOccurrence=i);this.setDate(i);this._readonly&&$("#EndCustom, #EndOccurrence, #EndOccurrenceCombo").each(c)}else this._date=null,this._startEndOccurrence===null&&(this._startEndOccurrence=n.InfiniteDate);this.hasEndOccurrence=t;e($.id("SetEndOccurrenceButton"),t||this._readonly);e($.id("ClearEndOccurrenceButton"),!t||this._readonly);e($.id("EndOccurrenceCombo"),!t);e($.id("EndOccurrence"),!t)};w.prototype.setDate=function(n){this._date=new Date(n);var i=ot.format(n),r=t.getString("OccurrenceEndDateLabel");$.id("EndOccurrenceCombo").setAttribute("aria-label",r+", "+i);$("#EndOccurrenceCombo .value").text(i)};w.prototype.date=function(){if(this._date)if(this.hasEndOccurrence)this._date=st(this._date,this._eventDetails.getStartTime());else return new Date(n.InfiniteDate);else if(this._eventDetails.isNewEvent())this._date=this._eventDetails.getDuration().startDate;else{var t=this._eventDetails._initEvent;this._date=t.recurring?+t.recurrence.until===n.InfiniteDate?t.recurrence.until:st(t.recurrence.until,this._eventDetails.getStartTime()):this._eventDetails.getDuration().startDate}return this._date};w.prototype.update=function(){if(nt($.id("RecurrenceCombo"))===0)e($.id("EndCustom"),true);else{if(e($.id("EndCustom"),false),this._date)this.hasEndOccurrence&&this._readonly&&this._setHasEndOccurance(true);else if(this._eventDetails.isNewEvent())this._setHasEndOccurance(false);else{var t=this._eventDetails._initEvent;this._setHasEndOccurance(t.recurring&&+t.recurrence.until!==n.InfiniteDate)}this.hasEndOccurrence&&this.setDate(this.date())}};w.prototype.isDirty=function(){return!this._readonly&&this._date&&+this._startEndOccurrence!=+this.date()};n.prototype._mainTemplate=function(n,t,i){function r(n){return Jx.escapeHtml(Jx.res.getString(n))}var u='<div id="eventDetails" aria-labelledby="cedDetails" aria-hidden="false"><div id="nav"><div class="cedHeader"><div id="cedBackSnap"><button id="cedCancel" class="win-command mirrorInRTL" aria-hidden="false" aria-label="'+r("EventButtonBack")+'" type="button"><span class="win-commandicon win-commandring"><span class="win-commandimage">&#xE0D5;<\/span><\/span><\/button><\/div><div id="cedButtonsSnap"><\/div><\/div><div id="cedBackFull"><\/div>'+t+'<\/div><div id="schedule"><div id="cedTitleSnap" class="fullWidth"><\/div><label id="StartDateDescrip">'+r("EventDateLabel")+'<\/label><div id="StartDateCombo" tabindex="0" role="button" aria-expanded="false"><div class="check" aria-hidden="false"><\/div><div class="value" aria-hidden="true"><\/div><\/div><div id="StartTimeHolder"><label id="StartTimeDescrip">'+r("EventStartLabel")+'<\/label><span id="StartTimeCombo" aria-labelledby="StartTimeDescrip"><\/span><div id="allDayHolder"><input id="AlldayCheckbox" aria-labelledby="AlldayCheckboxDescrip" class="durationCustom" type="checkbox" aria-hidden="true"/><label id="AlldayCheckboxDescrip" class="durationCustom" aria-hidden="true">'+r("AllDay")+'<\/label><\/div><\/div><div class="durationCustom" aria-hidden="true"><label id="EndDateDescrip">'+r("EventEndLabel")+'<\/label><div id="EndDateCombo" tabindex="0" role="button" aria-expanded="false"><div class="check" aria-hidden="false"><\/div><div class="value" aria-hidden="true"><\/div><\/div><label><\/label><div id="EndTimeCombo" aria-label="'+r("EventStartLabel")+'"><\/div><\/div><div class="fullWidth"><label id="EventDurationDescrip">'+r("EventDurationLabel")+'<\/label><select id="EventDuration" aria-labelledby="EventDurationDescrip"><option value="0">'+r("EventDuration0")+'<\/option><option value="30">'+r("EventDuration30")+'<\/option><option value="60">'+r("EventDuration60")+'<\/option><option value="90">'+r("EventDuration90")+'<\/option><option value="120">'+r("EventDuration120")+'<\/option><option value="All day">'+r("EventDurationDay")+'<\/option><option value="Custom">'+r("EventDurationCustom")+'<\/option><\/select><label id="LocationDescrip">'+r("EventLocationLabel")+'<\/label><input id="LocationTextbox" spellcheck="true" aria-labelledby="LocationDescrip" maxlength="1000" type="text"/><label id="OrganizerDescrip" aria-hidden="false">'+r("OrganizerLabel")+'<\/label><label id="GuestsDescrip">'+Jx.escapeHtml(i)+'<\/label><div id="GuestsCombo" class="compose-address-editbox typeSizeNormal">'+n+'<\/div><div id="yourResponse" aria-hidden="true"><\/div><div id="FreeBusy"><button id="FreeBusyButton" type="button">'+r("FreeBusyButton")+'<\/button><\/div><button id="ToggleResponsesButton" aria-hidden="true" aria-expanded="false" type="button"><span>'+r("ShowResponsesButton")+'<\/span><\/button><div id="AttendeeResponses" aria-hidden="true" role="group"><\/div><button id="ShowMoreButton" aria-hidden="false" type="button"><span>'+r("ShowMoreLabel")+'<\/span><\/button><div id="ShowMore" aria-hidden="true"><label id="RecurrenceDescrip">'+r("EventRecurrenceLabel")+'<\/label><select id="RecurrenceCombo" aria-labelledby="RecurrenceDescrip"><option id="RecurrenceOnce" value="none">'+r("EventRecurrenceOnce")+'<\/option><option id="RecurrenceDay" value="daily">'+r("EventRecurrenceDay")+'<\/option><option id="RecurrenceWeekday" value="weekdays">'+r("EventRecurrenceWeekday")+'<\/option><option id="RecurrenceMWF" value="mwf">'+r("EventRecurrenceMWF")+'<\/option><option id="RecurrenceTTH" value="tth">'+r("EventRecurrenceTTH")+'<\/option><option id="RecurrenceWeek" value="weekly">'+r("EventRecurrenceWeek")+'<\/option><option id="RecurrenceMonth" value="monthly">'+r("EventRecurrenceMonth")+'<\/option><option id="RecurrenceYear" value="yearly">'+r("EventRecurrenceYear")+'<\/option><\/select><div id="EndCustom" aria-hidden="true"><label id="EndOccurrence" aria-hidden="true">'+r("OccurrenceEndDateLabel")+'<\/label><div id="EndOccurrenceCombo" tabindex="0" role="button" aria-expanded="false"><div class="check" aria-hidden="false"><\/div><div class="value" aria-hidden="true"><\/div><\/div><button id="SetEndOccurrenceButton" aria-hidden="true" type="button"><span>'+r("SetOccurrenceEndDateButton")+'<\/span><\/button><button id="ClearEndOccurrenceButton" aria-hidden="true" type="button"><span>'+r("ClearOccurrenceEndDateButton")+'<\/span><\/button><\/div><label id="ReminderDescrip">'+r("EventReminderLabel")+'<\/label><select id="ReminderCombo" aria-labelledby="ReminderDescrip"><option id="ReminderNone" value="-1">'+r("EventReminderNone")+'<\/option><option id="Reminder0" value="0">'+r("EventReminder0")+'<\/option><option id="Reminder5" value="5">'+r("EventReminder5")+'<\/option><option id="Reminder15" value="15">'+r("EventReminder15")+'<\/option><option id="Reminder30" value="30">'+r("EventReminder30")+'<\/option><option id="ReminderHour" value="60">'+r("EventReminder60")+'<\/option><option id="Reminder18Hours" value="1080">'+r("EventReminder1080")+'<\/option><option id="ReminderDay" value="1440">'+r("EventReminder1440")+'<\/option><option id="ReminderWeek" value="10080">'+r("EventReminder10080")+'<\/option><\/select><label id="StatusDescrip">'+r("EventBusyStatusLabel")+'<\/label><select id="StatusCombo" aria-labelledby="StatusDescrip"><option id="StatusFree">'+r("EventStatusFree")+'<\/option><option id="StatusBusy">'+r("EventStatusBusy")+'<\/option><option id="StatusTentative">'+r("EventStatusTentative")+'<\/option><option id="StatusOut">'+r("EventStatusOOF")+'<\/option><\/select><div id="PrivateHolder"><input id="PrivateCheckbox" class="privateEvent" type="checkbox" aria-labelledby="PrivateCheckboxDescrip"/><label id="PrivateCheckboxDescrip" class="privateEvent">'+r("EventPrivateCheckbox")+'<\/label><\/div><\/div><\/div><\/div><div id="cedTitle"><div id="cedTitleFull"><label id="EventTitleDescrip">'+r("EventTitleLabel")+'<\/label><input id="EventTitleTextbox" spellcheck="true" aria-label="'+r("EventTitleLabel")+'" maxlength="255" type="text"/><div id="cedButtonsFull"><button id="cedRespond" class="win-command" aria-hidden="true" aria-label="'+r("EventRespond")+'" type="button"><span class="win-commandicon win-commandring"><span class="win-commandimage">&#xE1DB;<\/span><\/span><\/button><button id="cedSend" class="win-command useCustomFont" aria-hidden="true" aria-label="'+r("EventSendNow")+'" type="button"><span class="win-commandicon win-commandring"><span class="win-commandimage new-icon">&#xE122;<\/span><\/span><\/button><button id="cedSave" class="win-command" aria-hidden="true" aria-label="'+r("EventButtonSave")+'" type="button"><span class="win-commandicon win-commandring"><span class="win-commandimage">&#xE105;<\/span><\/span><\/button><button id="cedDelete" class="win-command" aria-hidden="true" aria-label="'+r("EventButtonDelete")+'" type="button"><span class="win-commandicon win-commandring"><span class="win-commandimage">&#xE107;<\/span><\/span><\/button><\/div><\/div><\/div><div id="cedNotes"><div id="NotesTextbox" aria-label="'+r("EventNotesLabel")+'"><\/div><\/div><\/div>';return'<div id="cedContainer"><div id="cedBackground"><\/div><div id="cedWrapper">'+u+"<\/div><\/div>"}})