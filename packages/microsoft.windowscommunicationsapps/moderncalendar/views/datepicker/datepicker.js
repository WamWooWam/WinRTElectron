Jx.delayDefine(Calendar.Controls,"DatePicker",function(){function t(n){Jx.mark("Calendar:DatePicker."+n+",StartTA,Calendar")}function i(n){Jx.mark("Calendar:DatePicker."+n+",StopTA,Calendar")}function f(n){Jx.mark("Calendar:DatePicker."+n+",Info,Calendar")}var o=Calendar.Helpers,u={},e=Calendar.Loc,r=Calendar.Controls.DatePicker=function(n){t("ctor");this.initComponent();this._pager=null;this._index=0;this._idSuffix=null;this._pendingFocus=null;this._highlightDates=[];this._datesWereSet=false;this._dateSelected=false;this._isVisible=false;this._isReady=false;this._isActive=false;this._focusDate=new Date;this._addClasses=[];this._renderer=this._renderer.bind(this);this._recycler=this._recycler.bind(this);this._onKeyDown=this._onKeyDown.bind(this);this._onClick=this._onClick.bind(this);this._finishShow=this._finishShow.bind(this);this._prepareHide=this._prepareHide.bind(this);this._finishHide=this._finishHide.bind(this);this.pickMode=n||r.PickMode.monthGrid;this.showJumpTargets=true;this.showFreeBusy=true;this.clientView=r.ClientView.unknown;this._ensurePager();this._updateToday(Calendar.getToday());this._focusDate=new Date(this._today);i("ctor")},n;Jx.augment(r,Jx.Component);n=r.prototype;r.PickMode={monthGrid:0,yearGrid:1};r.ClientView={unknown:0,day:1,workWeek:2,week:3,month:4,eventDetails:5};n.getItem=function(n){return this._pager.getItem(this._today,n)};n.left=function(){return this._left};n.right=function(){return this._right};n._renderer=function(n){var e,f,o;return t("_renderer"),e=this._calculateFocusedDay(n),f=null,this.pickMode===r.PickMode.monthGrid?(f=new Calendar.Controls.MonthGrid,f.splitSelectFocus=true):this.pickMode===r.PickMode.yearGrid&&(f=new Calendar.Controls.YearGrid,f.splitSelectFocus=true),n._grid=f,f.setToday(this._today),f.setFocusedDay(e),f.showFreeBusy=this.showFreeBusy,f.autoUpdate=false,f.setHighlightDates(this._highlightDates),this.appendChild(n._grid),o=u.grid({grid:Jx.getUI(n._grid).html}),i("_renderer"),o};n._recycler=function(n,r){t("_recycler");var f=r.item,u=r.el,e=r.jobset,o=this._calculateFocusedDay(f);u._grid.setToday(Calendar.getToday());u._grid.setFocusedDay(o);u._grid.setHighlightDates(this._highlightDates);u._grid.resume(e);i("_recycler")};n._calculateFocusedDay=function(n){t("_calculateFocusedDay");var r=this._pager.mergeDates(n,this._focusDate);return i("_calculateFocusedDay"),r};n._updateToday=function(n){if(t("_updateToday"),!this._today||!o.isSameDate(n,this._today)){this._today=n;var r=this._left;this._left=this._pager.getLeft(n);this._right=this._pager.getRight(n);this._timeline&&r!==this._left&&this._timeline.initialize(this._index)}i("_updateToday")};n._updateHighlightedDays=function(){if(t("_updateHighlightedDays"),this._host&&this._datesWereSet){this._datesWereSet=false;for(var n=0,r=this._children.length;n<r;++n)this._children[n].setHighlightDates(this._highlightDates)}i("_updateHighlightedDays")};n._getIdsCalendar=function(){return this._idsCalendar||(this._idsCalendar=Microsoft.WindowsLive.Instrumentation.Ids.Calendar),this._idsCalendar};u.grid=function(n){return'<div class="grid">'+n.grid+"<\/div>"};u.dphost=function(n){return'<div class="dp-flyout '+n.pickClass+'" style="position:absolute;visibility:hidden;" aria-label="'+Jx.escapeHtml(e.getString("DatePickerSelectDate"))+'"><div id="'+n.id+'" class="dp-host"><\/div><div id="dp-focusEater-'+n.id+'" class="dp-focusEater" aria-hidden="true" tabindex="0"><\/div><\/div>'};n.setFocusedDay=function(n,r){var f,u,e;if(t("setFocusedDay"),f=this._index,this._index=this._pager.getIndex(this._today,n),this._focusDate=new Date(n),this._host){for(u=0,e=this._children.length;u<e;++u){var o=this._children[u],s=o.getFocusedDay(),h=this._calculateFocusedDay(s);o.setFocusedDay(h)}(this._index!==f||r===true)&&this._timeline.setFocusedIndex(this._index)}i("setFocusedDay")};n.show=function(n,r,u){t("show");this._isReady&&!this._isActive&&(this._isActive=true,this._biciLaunched(this.clientView),this._dateSelected=false,this._ensureFlyout(),this._updateHighlightedDays(),this._flyoutHost.show(n,r,u));i("show")};n._ensureFlyout=function(){if(t("_ensureFlyout"),!this._flyoutHost){var n=this._dpHidden;this.showJumpTargets&&(n.insertAdjacentHTML("beforeend","<div class='dp-jump'><span class='dp-today' role='button' tabindex='0'>"+Jx.escapeHtml(e.getString("TodayCommand"))+"<\/span><\/div>"),this._todayButton=n.querySelector(".dp-today"));n.id=this._makeWinJsId();this._flyoutHost=new WinJS.UI.Flyout(n);this._timeline.resetArrowHost(n);this._flyoutHost.addEventListener("aftershow",this._finishShow);this._flyoutHost.addEventListener("beforehide",this._prepareHide);this._flyoutHost.addEventListener("afterhide",this._finishHide)}i("_ensureFlyout")};n._ensurePager=function(){t("_ensurePager");this.pickMode===r.PickMode.monthGrid?this._pager=Calendar.Controls.MonthGrid:this.pickMode===r.PickMode.yearGrid&&(this._pager=Calendar.Controls.YearGrid);i("_ensurePager")};n.hide=function(){t("hide");this._flyoutHost&&this._flyoutHost.hide();i("hide")};n._finishShow=function(){t("_finishShow");this._isVisible||(this._isVisible=true,this.fire("visibilityChanged"));i("_finishShow")};n._prepareHide=function(){t("_prepareHide");this._isVisible&&(this._isVisible=false);i("_prepareHide")};n._biciClosed=function(n){Jx.bici&&Jx.bici.addToStream(this._getIdsCalendar().calendarDatePickerClosed,n?1:0)};n._biciLaunched=function(n){Jx.bici&&Jx.bici.addToStream(this._getIdsCalendar().calendarDatePickerLaunch,n)};n._finishHide=function(){t("_finishHide");this._isActive&&(this._isActive=false,this._biciClosed(this._dateSelected),this._dateSelected&&this.fire("dateSelected",this._focusDate),this.fire("visibilityChanged"));i("_finishHide")};n._makeWinJsId=function(){t("_makeWinJsId");var n,r="dp-flyout";return n=this._idSuffix===null||this._idSuffix===undefined?this._id:this._idSuffix,n.length>0&&(r+="-"+n),i("_makeWinJsId"),r};n._getFixedWidth=function(){return this.pickMode===r.PickMode.yearGrid?316:313};n.setIdSuffix=function(n){this._idSuffix=n};n.getIdSuffix=function(){return this._idSuffix};n.getToday=function(){return new Date(this._today)};n.setToday=function(n){if(t("setToday"),this._updateToday(new Date(n)),this._children)for(var r=0,u=this._children.length;r<u;++r)this._children[r].setToday(new Date(n));i("setToday")};n.getFocusDate=function(){return new Date(this._focusDate)};n.setFocusDate=function(n){t("setFocusDate");this.setFocusedDay(n);i("setFocusDate")};n.setHighlightDates=function(n){t("setHighlightDates");this._datesWereSet=true;this._highlightDates=[].concat(n);i("setHighlightDates")};n.getVisible=function(){return this._isVisible};n.getActive=function(){return this._isActive};n.addCustomClass=function(n){if(this._dpHidden)this._dpHidden.classList.add(n);else{var t=this._addClasses;t.indexOf(n)===-1&&t.push(n)}};n.removeCustomClass=function(n){if(this._dpHidden)this._dpHidden.classList.remove(n);else{var t=this._addClasses,i=t.indexOf(n);i!==-1&&t.splice(i,1)}};n._onFocusChanged=function(n){t("_onFocusChanged");this._index=n.index;var r=n.el;this._grid&&this._grid.setActive(false);this._grid=r._grid;this._grid.setActive(true);i("_onFocusChanged")};n._onItemRealized=function(n){t("_onItemRealized");var u=n.item,r=n.el,f=n.jobset;r._grid=u._grid;r._grid.activateUI(f);i("_onItemRealized")};n._onItemRemoved=function(n){t("_onItemRemoved");var r=n.el;r._grid.pause();i("_onItemRemoved")};n._onDaySelected=function(n){t("_onDaySelected");n.handled||(n.handled=true,this._prepareToSelectDate(n.data));i("_onDaySelected")};n._prepareToSelectDate=function(n){t("_prepareToSelectDate");this._dateSelected||(this._dateSelected=true,this._focusDate=n,this.hide());i("_prepareToSelectDate")};n._onDayFocused=function(n){t("_onDayFocused");n.handled||(this.setFocusedDay(n.data),n.handled=true);t("_onDayFocused")};n._onShowArrows=function(n){this._timeline.setAlwaysShowArrows(n.data.value)};n._onClick=function(n){if(t("_onClick"),!n.handled)for(var r=n.target;r!==n.currentTarget;r=r.parentNode)if(r.classList.contains("dp-today")){n.preventDefault();this._prepareToSelectDate(this._today);break}i("_onClick")};n._onKeyDown=function(n){var f,r,u;t("_onKeyDown");n.keyCode===Jx.KeyCode.tab?(f=null,r=this._grid,r&&(f=r.getFocusedElement()),!r||f&&this._todayButton?this._todayButton.focus():r&&(u=this._dpFocusEater,u.style.display="",u.focus(),u.style.display="none",r.focus()),n.preventDefault()):(n.keyCode===Jx.KeyCode.enter||n.keyCode===Jx.KeyCode.space)&&(this._todayButton&&document.activeElement===this._todayButton&&this._prepareToSelectDate(this._today),n.preventDefault());i("_onKeyDown")};n.getUI=function(n){n.html=u.dphost({id:this._id,pickClass:"dp-pick-"+this.pickMode})};n.activateUI=function(n){var u,o,f,e,s,h,r;for(t("activateUI"),Jx.Component.prototype.activateUI.call(this),document.body.insertAdjacentHTML("beforeend",Jx.getUI(this).html),this._dpHidden=document.body.lastElementChild,f=this._addClasses,u=0,o=f.length;u<o;++u)this.addCustomClass(f[u]);this._addClasses=[];this._jobset=n;this._host=document.getElementById(this._id);this._dpFocusEater=document.getElementById("dp-focusEater-"+this._id);this.on("daySelected",this._onDaySelected);this.on("dayFocused",this._onDayFocused);e={};this.fire("getSettings",e);s=this._getFixedWidth();h={hookWheel:true,strictOrder:true,noFocusOnResize:true,fixedWidth:s};r=this._timeline=new Calendar.Controls.Timeline(this._host,this._jobset,this,this._renderer,this._recycler,h);r.setAlwaysShowArrows(e.settings.get("alwaysShowArrows"));this.on("showArrows",this._onShowArrows);r.addListener("focusChanged",this._onFocusChanged,this);r.addListener("itemRealized",this._onItemRealized,this);r.addListener("itemRemoved",this._onItemRemoved,this);r.initialize(this._index);this._dpHidden.addEventListener("keydown",this._onKeyDown,false);this._dpHidden.addEventListener("click",this._onClick,false);this._isReady=true;i("activateUI")};n.deactivateUI=function(){t("deactivateUI");this._flyoutHost&&(this._flyoutHost.removeEventListener("aftershow",this._finishShow),this._flyoutHost.removeEventListener("beforehide",this._prepareHide),this._flyoutHost.removeEventListener("afterhide",this._finishHide),this._flyoutHost.hide(),this._flyoutHost=null);this._dpHidden.removeEventListener("keydown",this._onKeyDown,false);this._dpHidden.removeEventListener("click",this._onClick,false);this._dpHidden.parentNode.removeChild(this._dpHidden);this._dpHidden=null;this._timeline.shutdown();this._timeline.removeListener("itemRemoved",this._onItemRemoved,this);this._timeline.removeListener("itemRealized",this._onItemRealized,this);this._timeline.removeListener("focusChanged",this._onFocusChanged,this);this.detach("daySelected",this._onDaySelected);this.detach("dayFocused",this._onDayFocused);this.detach("showArrows",this._onShowArrows);this._timeline=null;this._host=null;Jx.Component.prototype.deactivateUI.call(this);i("deactivateUI")}})