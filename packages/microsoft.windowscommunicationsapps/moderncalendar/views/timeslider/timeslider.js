Jx.delayDefine(Calendar.Views,"TimeSlider",function(){function t(n){Jx.mark("Calendar:TimeSlider."+n+",StartTA,Calendar")}function i(n){Jx.mark("Calendar:TimeSlider."+n+",StopTA,Calendar")}var r=Calendar.Helpers,u=new Jx.DTFormatter("shortTime"),n=Calendar.Views.TimeSlider=function(n,r){t("ctor");this.initComponent();this._hasUI=true;this._resetUiMembers();this._isHorizontal=r;this._hourLengthInPixels=n;this._halfLengthInPixels=n/2;this._quarterLengthInPixels=n/4;this._minuteLengthInPixels=n/60;this._dayLengthInPixels=n*24;this._hourOffset=0;this._hoursPerDay=24;this._scrollLengthInPixels=this._dayLengthInPixels;this._minEventLengthInPixels=this._hourLengthInPixels;this._allowStartStopSwap=true;this._allowSliderJump=true;this._eventsHooked=false;this._enableSliderFocus=false;this._anchor=Calendar.getToday();this._start=this._anchor;this._end=this._anchor;this._onPointerDown=this._onPointerDown.bind(this);this._onPointerMove=this._onPointerMove.bind(this);this._onPointerUp=this._onPointerUp.bind(this);this._onAttrModifed=this._onAttrModified.bind(this);this._onClickSlider=this._onClickSlider.bind(this);this._onKeyDown=this._onKeyDown.bind(this);this._rangeFormatter=Jx.res.getFormatFunction("DateRange");this._startLabel=Jx.res.getString("EventStartLabel");this._endLabel=Jx.res.getString("EventEndLabel");i("ctor")};Jx.augment(n,Jx.Component);Jx.augment(n,Jx.Events);n.prototype.getUI=function(n){t("getUI");n.html=this._templateTimeSlider();i("getUI")};n.prototype._templateTimeSlider=function(){var n=this._isHorizontal?"left":"top",t=this._isHorizontal?"right":"bottom",i=this._isHorizontal?"horizontal":"vertical",r=this._enableSliderFocus?' tabindex="0" role="slider" aria-live="assertive" aria-valuemin="0" aria-valuemax="10" aria-valuenow="5"':"",u=this._extraSrollContent?this._extraSrollContent:"";return'<div id="'+this._id+'" class="scroller timeSlider"><div class="surface '+i+'">'+u+'<div class="slider"><div class="'+n+' start line"><\/div><div class="'+t+' stop line"><\/div><div class="focus-region"'+r+'><\/div><div class="'+n+' start grabberTouch" id="startgrabberTouch" role="slider" aria-live="assertive" tabindex="0" aria-valuemin="0" aria-valuemax="10" aria-valuenow="5"><div class="grabber"><\/div><\/div><div class="'+t+' stop grabberTouch" id="stopgrabberTouch" role="slider" aria-live="assertive" tabindex="0" aria-valuemin="0" aria-valuemax="10" aria-valuenow="5"><div class="grabber"><\/div><\/div><\/div><\/div><\/div>'};n.prototype.activateUI=function(n){t("activateUI");this._isRtl=Jx.isRtl();this._element=n||document.getElementById(this._id);this._surface=this._element.querySelector(".surface");this._slider=this._element.querySelector(".slider");this._sliderFocus=this._slider.querySelector(".focus-region");this._surface._onPointerDown=this._onSurfacePointerDown;this._surface._onPointerUp=this._onSurfacePointerUp;this._grabberTouchStart=this._slider.querySelector(".start.grabberTouch");this._grabberTouchStop=this._slider.querySelector(".stop.grabberTouch");this._grabberStart=this._grabberTouchStart.firstElementChild;this._grabberStop=this._grabberTouchStop.firstElementChild;this._grabberTouchStart._onPointerDown=this._onGrabberTouchPointerDown;this._grabberTouchStart._onPointerMove=this._onGrabberPointerMoveStart;this._grabberTouchStart._onPointerUp=this._onGrabberPointerUpStart;this._grabberTouchStop._onPointerDown=this._onGrabberTouchPointerDown;this._grabberTouchStop._onPointerMove=this._onGrabberPointerMoveStop;this._grabberTouchStop._onPointerUp=this._onGrabberPointerUpStop;this._grabberStart._onPointerMove=this._onGrabberPointerMoveStart;this._grabberStart._onPointerUp=this._onGrabberPointerUpStart;this._grabberStop._onPointerMove=this._onGrabberPointerMoveStop;this._grabberStop._onPointerUp=this._onGrabberPointerUpStop;this._hookEvents();i("activateUI")};n.prototype.deactivateUI=function(){t("deactivateUI");this._element&&(this.unhookEvents(),this._resetUiMembers(),this._element.parentNode&&this._element.parentNode.removeChild(this._element),this._element=null);i("deactivateUI")};n.prototype._hookEvents=function(){this._eventsHooked=true;this._allowSliderJump&&this._surface.addEventListener("MSPointerDown",this._onPointerDown,false);this._sliderFocus.addEventListener("DOMAttrModified",this._onAttrModifed,false);window.addEventListener("keydown",this._onKeyDown,false);this._grabberTouchStart.addEventListener("MSPointerDown",this._onPointerDown,false);this._grabberTouchStop.addEventListener("MSPointerDown",this._onPointerDown,false);this._grabberStart.addEventListener("MSPointerDown",this._onPointerDown,false);this._grabberStop.addEventListener("MSPointerDown",this._onPointerDown,false);this._grabberTouchStart.addEventListener("DOMAttrModified",this._onAttrModifed,false);this._grabberTouchStop.addEventListener("DOMAttrModified",this._onAttrModifed,false);this._slider.addEventListener("click",this._onClickSlider,false)};n.prototype.unhookEvents=function(){this._eventsHooked&&(this._eventsHooked=false,this._unhookPointerEvents(),this._allowSliderJump&&this._surface.removeEventListener("MSPointerDown",this._onPointerDown,false),this._sliderFocus.removeEventListener("DOMAttrModified",this._onAttrModifed,false),window.removeEventListener("keydown",this._onKeyDown,false),this._grabberTouchStop.removeEventListener("DOMAttrModified",this._onAttrModifed,false),this._grabberTouchStart.removeEventListener("DOMAttrModified",this._onAttrModifed,false),this._grabberStop.removeEventListener("MSPointerDown",this._onPointerDown,false),this._grabberStart.removeEventListener("MSPointerDown",this._onPointerDown,false),this._grabberTouchStop.removeEventListener("MSPointerDown",this._onPointerDown,false),this._grabberTouchStart.removeEventListener("MSPointerDown",this._onPointerDown,false),this._slider.removeEventListener("click",this._onClickSlider,false))};n.prototype._resetUiMembers=function(){this._isRtl=null;this._surface=null;this._slider=null;this._sliderFocus=null;this._grabberTouchStart=null;this._grabberTouchStop=null;this._grabberStart=null;this._grabberStop=null;this._start=null;this._end=null;this._lastActive=null;this._eventStartAtStartOfMove=null;this._eventStopAtStartOfMove=null};n.prototype.getState=function(){t("getState");this._updateState();var n={start:new Date(this._start),end:new Date(this._end)};return i("getState"),n};n.prototype.setAllowStartStopSwap=function(n){this._allowStartStopSwap=n};n.prototype.setAllowSliderJump=function(n){this._allowSliderJump=n};n.prototype.setMinEventLengthInPixels=function(n){this._minEventLengthInPixels=n};n.prototype.setScrollLengthInPixels=function(n){this._scrollLengthInPixels=n};n.prototype.getScrollLengthInPixels=function(){return this._scrollLengthInPixels};n.prototype.setExtraSrollContent=function(n){return this._extraSrollContent=n};n.prototype.setEnableSliderFocus=function(n){return this._enableSliderFocus=n};n.prototype.setRange=function(n,r,u){t("setRange");this._anchor=n;this._start&&this._stop&&r.getTime()===this._start.getTime()&&u.getTime()===this._end.getTime()||(this._start=r,this._end=u,this.fire("rangeChange"),this._element&&(this._updateSlider(),this._setScrollPos()));this._updateAria();i("setRange")};n.prototype.getTouchTargets=function(){return[this._grabberTouchStart,this._grabberTouchStop]};n.prototype.getElement=function(){return this._element};n.prototype.getContentRegion=function(){return this._sliderFocus};n.prototype._onClickSlider=function(n){n.target.releaseCapture();n.stopPropagation();n.preventDefault()};n.prototype._swapPointerListener=function(n){var t=this._pointerId;this._unhookPointerEvents();this._hookPointerEvents(n,t)};n.prototype._onGrabberTouchPointerDown=function(n){return n.pointerType==="touch"};n.prototype._onGrabberPointerMoveStart=function(n){var e;t("_onGrabberPointerMoveStart");e=this._isHorizontal?n.offsetX:n.offsetY;this._isHorizontal&&this._isRtl&&(e*=-1);var f=this._slider.style,r=this._getStart(f)+e,u=this._getStop(f);r<this._scrollStart?r=this._scrollStart:r>this._scrollLengthInPixels-this._minEventLengthInPixels&&(r=this._scrollLengthInPixels-this._minEventLengthInPixels);this._allowStartStopSwap?r>u&&(this._swapPointerListener(this._grabberStop),r=u):r>u-this._minEventLengthInPixels?(u=r+this._minEventLengthInPixels,this._setStop(f,u)):u>this._eventStopAtStartOfMove&&(u=Math.max(r+this._minEventLengthInPixels,this._eventStopAtStartOfMove),this._setStop(f,u));this._setStart(f,r);i("_onGrabberPointerMoveStart")};n.prototype._onGrabberPointerMoveStop=function(n){var e;t("_onGrabberPointerMoveStop");e=this._isHorizontal?n.offsetX:n.offsetY;this._isHorizontal&&this._isRtl&&(e*=-1);var f=this._slider.style,u=this._getStart(f),r=this._getStop(f)+e;r>this._scrollLengthInPixels?r=this._scrollLengthInPixels:r<this._scrollStart+this._minEventLengthInPixels&&(r=this._scrollStart+this._minEventLengthInPixels);this._allowStartStopSwap?r<u&&(this._swapPointerListener(this._grabberStart),r=u):r<u+this._minEventLengthInPixels?(u=r-this._minEventLengthInPixels,this._setStart(f,u)):u<this._eventStartAtStartOfMove&&(u=Math.min(r-this._minEventLengthInPixels,this._eventStartAtStartOfMove),this._setStart(f,u));this._setStop(f,r);i("_onGrabberPointerMoveStop")};n.prototype._onGrabberPointerUpStart=function(n){t("_onGrabberPointerUpStart");n.target.setCapture();var f=this._slider.style,r=this._getStart(f),u=this._getStop(f);r+=this._minEventLengthInPixels/2;r-=r%this._minEventLengthInPixels;u+=this._minEventLengthInPixels/2;u-=u%this._minEventLengthInPixels;this._allowStartStopSwap?u<r&&(r-=this._minEventLengthInPixels):r>u-this._minEventLengthInPixels&&(u=r+this._minEventLengthInPixels);this._setStart(f,r);this._setStop(f,u);this._updateState();i("_onGrabberPointerUpStart")};n.prototype._onGrabberPointerUpStop=function(n){t("_onGrabberPointerUpStop");n.target.setCapture();var f=this._slider.style,u=this._getStart(f),r=this._getStop(f);u+=this._minEventLengthInPixels/2;u-=u%this._minEventLengthInPixels;r+=this._minEventLengthInPixels/2;r-=r%this._minEventLengthInPixels;this._allowStartStopSwap?r<u&&(r+=this._minEventLengthInPixels):r<u+this._minEventLengthInPixels&&(r=u+this._minEventLengthInPixels);this._setStart(f,u);this._setStop(f,r);this._updateState();i("_onGrabberPointerUpStop")};n.prototype._getStart=function(n){var t;return t=this._isHorizontal?this._isRtl?n.right:n.left:n.top,parseInt(t,10)};n.prototype._getStop=function(n){var t;return t=this._isHorizontal?this._isRtl?n.left:n.right:n.bottom,-parseInt(t,10)};n.prototype._setStart=function(n,t){var i=t+"px";this._isHorizontal?this._isRtl?n.right=i:n.left=i:n.top=i};n.prototype._setStop=function(n,t){var i=-t+"px";this._isHorizontal?this._isRtl?n.left=i:n.right=i:n.bottom=i};n.prototype._handleDecrement=function(n){t("_handleDecrement");var e=this._slider.style,r=this._getStart(e),u=this._getStop(e),f;n===this._sliderFocus?r&&(f=r%this._minEventLengthInPixels||this._minEventLengthInPixels,r-=f,u-=f,r<this._scrollStart&&this._setScrollStart(r)):n===this._grabberTouchStart?r&&(f=r%this._minEventLengthInPixels||this._minEventLengthInPixels,r-=f,r<this._scrollStart&&this._setScrollStart(r)):n===this._grabberTouchStop&&(f=u%this._minEventLengthInPixels||this._minEventLengthInPixels,u-=f,u-r<this._minEventLengthInPixels?(r-=1,r-=r%this._minEventLengthInPixels,r<=0&&(r=0,u=this._minEventLengthInPixels),r<this._scrollStart&&this._setScrollStart(r)):u<=this._scrollStart&&this._setScrollStart(u-this._minEventLengthInPixels));this._setStart(e,r);this._setStop(e,u);this._updateState();i("_handleDecrement")};n.prototype._handleIncrement=function(n){var h;t("_handleIncrement");var s=this._slider.style,u=this._getStart(s),r=this._getStop(s),f,o=this._scrollStart+this._element.offsetLengthInPixels,e=this._element.scrollLengthInPixels;n===this._sliderFocus?(f=u+this._minEventLengthInPixels,f-=f%this._minEventLengthInPixels,r+=f-u,u=f,e<r&&(u-=r-e,r=e),o<r&&this._setScrollStart(this._scrollStart+r-o)):n===this._grabberTouchStart?(f=u+this._minEventLengthInPixels,f-=f%this._minEventLengthInPixels,u=f,r=Math.max(r,u+this._minEventLengthInPixels),e<r&&(u-=r-e,r=e),h=u+this._minEventLengthInPixels,o<h&&this._setScrollStart(h-(this._isHorizontal?this._element.offsetHeight:this._element.offsetWidth))):n===this._grabberTouchStop&&(r+=this._minEventLengthInPixels,r-=r%this._minEventLengthInPixels,e<r&&(r=e),o<r&&this._setScrollStart(this._scrollStart+r-o));this._setStart(s,u);this._setStop(s,r);this._updateState();i("_handleIncrement")};n.prototype._onKeyDown=function(n){var i=n.key,t=n.target;(t===this._sliderFocus||t===this._grabberTouchStart||t===this._grabberTouchStop)&&(this._isHorizontal?i==="Left"?(this._isRtl?this._handleIncrement(t):this._handleDecrement(t),n.preventDefault()):i==="Right"&&(this._isRtl?this._handleDecrement(t):this._handleIncrement(t),n.preventDefault()):i==="Up"?(this._handleDecrement(t),n.preventDefault()):i==="Down"&&(this._handleIncrement(t),n.preventDefault()))};n.prototype._updateSlider=function(){var t=Math.floor((this._start-this._anchor)/r.dayInMilliseconds),i=(this._start.getHours()-this._hourOffset)*60+this._start.getMinutes(),u=Math.floor((this._end-this._anchor)/r.dayInMilliseconds),f=(this._end.getHours()-this._hourOffset)*60+this._end.getMinutes(),e=t*this._hoursPerDay*this._hourLengthInPixels+i*this._minuteLengthInPixels,o=u*this._hoursPerDay*this._hourLengthInPixels+f*this._minuteLengthInPixels,n=this._slider.style;this._setStart(n,e);this._setStop(n,o)};n.prototype._onPointerDown=function(n){if(this._lastActive=document.activeElement,n.preventDefault(),n.stopPropagation(),!this._pointerTarget&&n.button===0){this.fire("timeSliderBegin");var t=n.currentTarget,i=this._slider.style,r=this._getStart(i),u=this._getStop(i);this._eventStartAtStartOfMove=r;this._eventStopAtStartOfMove=u;(!t._onPointerDown||t._onPointerDown.call(this,n))&&this._hookPointerEvents(t,n.pointerId)}};n.prototype._onPointerMove=function(n){var t=this._pointerTarget;t&&n.pointerId===this._pointerId&&t._onPointerMove&&t._onPointerMove.call(this,n)};n.prototype._hookPointerEvents=function(n,t){n.addEventListener("MSPointerMove",this._onPointerMove,false);n.addEventListener("MSPointerUp",this._onPointerUp,false);n.addEventListener("MSPointerCancel",this._onPointerUp,false);n.addEventListener("MSLostPointerCapture",this._onPointerUp,false);n.msSetPointerCapture(t);this._pointerTarget=n;this._pointerId=t};n.prototype._unhookPointerEvents=function(){var n=this._pointerTarget;n&&(n.msReleasePointerCapture(this._pointerId),n.removeEventListener("MSLostPointerCapture",this._onPointerUp,false),n.removeEventListener("MSPointerCancel",this._onPointerUp,false),n.removeEventListener("MSPointerUp",this._onPointerUp,false),n.removeEventListener("MSPointerMove",this._onPointerMove,false),this._pointerId=null,this._pointerTarget=null)};n.prototype._onPointerUp=function(n){n.preventDefault();n.stopPropagation();var t=this._pointerTarget;t&&n.pointerId===this._pointerId&&(t._onPointerUp&&t._onPointerUp.call(this,n),this._unhookPointerEvents(),this.fire("timeSliderEnd"))};n.prototype._calculateOffset=function(n){for(var t=n.target,r=n.currentTarget,i=this._isHorizontal?n.offsetX:n.offsetY;t!==r;)i+=this._isHorizontal?t.offsetLeft:t.offsetTop,t=t.parentNode;return this._isHorizontal&&this._isRtl&&(i+=this._minEventLengthInPixels),i-i%this._minEventLengthInPixels};n.prototype._onSurfacePointerDown=function(n){return this._initialSurface=this._calculateOffset(n),true};n.prototype._onSurfacePointerUp=function(n){var f,t;if(n.type!=="MSPointerCancel"&&n.type!=="pointercancel"&&(f=this._isHorizontal?n.offsetY:n.offsetX,0<=f&&f<=(this._isHorizontal?this._pointerTarget.offsetHeight:this._pointerTarget.offsetWidth)&&(t=this._calculateOffset(n),t===this._initialSurface))){this._isRtl&&(t=this.getScrollLengthInPixels()-t);var r=this._slider.style,u=this._getStart(r),i=this._getStop(r),e=t-u;u=t;i-=e;i<0&&(u+=i,i=0);this._setStart(r,u);this._setStop(r,i);this._updateState()}};n.prototype._updateState=function(){var r=this._slider.style,n=this._getStart(r),t=this._getStop(r),c=Math.floor(n/this._dayLengthInPixels),l=n%this._dayLengthInPixels/this._minuteLengthInPixels,u=Math.floor(t/this._dayLengthInPixels),i=t%this._dayLengthInPixels/this._minuteLengthInPixels;n<t&&(i||(u-=1,i=this._dayLengthInPixels/this._minuteLengthInPixels));var f=this._anchor.getFullYear(),e=this._anchor.getMonth(),o=this._anchor.getDate(),s=new Date(f,e,o+c,this._hourOffset,Math.round(l)),h=new Date(f,e,o+u,this._hourOffset,Math.round(i));(s.getTime()!==this._start.getTime()||h.getTime()!==this._end.getTime())&&(this._start=s,this._end=h);this._updateAria()};n.prototype._setScrollStart=function(n){this._isHorizontal?this._element.scrollLeft=n:this._element.scrollTop=n};n.prototype._setScrollPos=function(){var i=Math.floor((this._start-this._anchor)/r.dayInMilliseconds),n=this._anchor.getHours()-this._hourOffset,t=i*this._hoursPerDay+n;n&&(t-=1);this._scrollStart=t*this._hourLengthInPixels;this._setScrollStart(this._scrollStart)};n.prototype._onAttrModified=function(n){if(n.attrName==="aria-valuenow"){var t=n.target,i=parseInt(n.newValue,10);i!==5&&(t.setAttribute("aria-valuenow",5),i<5?this._handleDecrement(t):this._handleIncrement(t),this._updateState())}};n.prototype._updateAria=function(){var i=this._start,t=this._end,f=r.isSameDate(i,t),e=r.dateAndTime.format(i),o=f?u.format(t):r.dateAndTime.format(t),n=this._rangeFormatter(e,o);this._enableSliderFocus&&(this._sliderFocus.setAttribute("aria-label",n),this._sliderFocus.setAttribute("aria-valuetext",n));this._grabberTouchStart.setAttribute("aria-label",this._startLabel);this._grabberTouchStart.setAttribute("aria-valuetext",n);this._grabberTouchStop.setAttribute("aria-label",this._endLabel);this._grabberTouchStop.setAttribute("aria-valuetext",n)}})