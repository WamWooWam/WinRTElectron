Jx.delayDefine(Calendar,"ProviderPage",function(){function t(n){Jx.mark("Calendar.ProviderPage."+n+",StartTA,Calendar,App")}function i(n){Jx.mark("Calendar.ProviderPage."+n+",StopTA,Calendar,App")}function u(n){Jx.mark("Calendar.ProviderPage."+n+",Info,Calendar,App")}var r=Calendar.ProviderPage=function(){t("constructor");this.initComponent();this._isShutdown=false;this._model=null;this._view=null;this._close=this._close.bind(this);this._onRestartNeeded=this._onRestartNeeded.bind(this);var n=Jx.activation;n.addListener(n.appointmentsProvider,this._onAppActivate,this);this._createPlatform();Calendar.Helpers.ensureFormats();window.addEventListener("beforeunload",this._close,false);Jx.EventManager.addListener(null,"dismissUI",this._onDismissUI,this);i("constructor")},n;Jx.augment(r,Jx.Component);n=r.prototype;n.getUI=function(n){var t=Jx.getUI(this._view).html;n.html=t};n._onRestartNeeded=function(n){if(!this._isShutdown){t("onRestartNeeded");var i=null;u("onRestartNeeded:reason:"+n.reason);n.reason===Microsoft.WindowsLive.Platform.RestartNeededReason.accountDisconnected&&(i=Microsoft.WindowsLive.Platform.Result.forceSignIn);this._model?(this._model.setPlatformError(i),this._view.displayErrorUI()):this._createPlatform();t("onRestartNeeded")}};n._createPlatform=function(){var u,r,n;t("_createPlatform");try{u=Microsoft.WindowsLive.Platform;r=u.ClientCreateOptions;this._platform=new u.Client("calendar",r.failIfNoUser|r.delayResources|r.failIfUnverified)}catch(f){Jx.log.exception("Unable to create platform",f);this._platformError=f.number;Jx.isValidNumber(this._platformError)&&f.number!==0||(this._platformError=-2147467259)}n=this;setTimeout(function(){n._platform&&(n._platform.addEventListener("restartneeded",n._onRestartNeeded),n._platform.requestDelayedResources())},500);i("_createPlatform")};n._onAppActivate=function(n){var i=document.getElementById("providerRoot"),t=this._model=new Calendar.ProviderModel;this._platform?t.initialize(n,this._platform):t.initialize(n,null,this._platformError);this._view=new Calendar.ProviderEventView(t);this.append(this._view);this.initUI(i)};n._onDismissUI=function(){this._close(true)};n._close=function(n){t("close");Jx.EventManager.removeListener(null,"dismissUI",this._onDismissUI,this);var r=Jx.app;r&&(r.shutdownUI(),r.shutdown(),r=null);this._isShutdown=true;this._model&&(this._model.dispose(n),this._model=null);this._platform&&(this._platform.dispose(),this._platform=null);this._view=null;i("close")}})