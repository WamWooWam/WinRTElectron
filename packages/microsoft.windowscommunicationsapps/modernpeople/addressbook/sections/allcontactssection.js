Jx.delayDefine(People,"AllContactsSection",function(){function r(t,i,r){var u=Microsoft.WindowsLive.Platform.OnlineStatusFilter,f=this._filterOnline?u.notOffline:u.all;return new n.Callback(t.getPeopleNameBetween,t,[f,i,true,r,false])}var n=window.People,i,t;n.AllContactsSection=function(t,i,r,u){this._platformCache=t;this._filterOnline=false;n.ContactGridSection.call(this,"allSection",this._getTitle(),t.getPlatform().peopleManager);this._appBar=r;this._allContacts=null;this._totalCounter=null;this._keyboardListenerElement=i;this._keyboardJump=null;this._alphabetIndex=u};Jx.inherit(n.AllContactsSection,n.ContactGridSection);i=n.ContactGridSection.prototype;n.AllContactsSection.prototype.shutdownComponent=function(){var n=this._allContacts;n&&n.removeListener("queriesChanged",this._queriesChanged,this);Jx.dispose(this._totalCounter);Jx.dispose(this._keyboardJump);i.shutdownComponent.apply(this,arguments);this._immediateHandle&&clearImmediate(this._immediateHandle)};n.AllContactsSection.prototype.onPrepareSaveBackState=function(){n.Nav.setPageLastScrollPosition("AllContactsScrollPosition",this.getScrollPosition())};n.AllContactsSection.prototype.activateUI=function(){n.ContactGridSection.prototype.activateUI.call(this)};n.AllContactsSection.prototype._scrollToAlphabetHeader=function(){var t=n.Nav.getPageLastScrollPosition("AllContactsScrollPosition"),i,r;t||(i=this._grid._groupGridIndices[this._alphabetIndex],r=this._grid._layout.getPositionFromGridIndex(i),t=r.scrollPos-this._gridScrollableOffset);this.setScrollPosition(t)};n.AllContactsSection.prototype.extentReady=function(){var r=this._placeholder.querySelector("#btnClearFilter"),t;r.addEventListener("click",this._toggleOnlineFilter.bind(this),false);this._totalCounter=new n.TotalCounter(this._collection,this);this.totalCountChanged(this._totalCounter.count);i.extentReady.apply(this,arguments);t=this;this._immediateHandle=setImmediate(function(){t._scrollToAlphabetHeader()})};n.AllContactsSection.prototype.hydratePosition=function(){this._scrollToAlphabetHeader()};n.AllContactsSection.prototype._toggleOnlineFilter=function(){var n=!this._filterOnline;this._allContacts.setFilterOnline(n);Jx.setClass(this._placeholder,"filterOnline",n);Jx.appData.localSettings().container("People").set("abFilterOnline",n);this._appBar.updateCommand({commandId:"onlineFilter",selected:n,tooltip:n?"/strings/abOnlineFilterEnabledTooltip":"/strings/abOnlineFilterDisabledTooltip"});this._filterOnline=n;this.setTitle(this._getTitle())};n.AllContactsSection.prototype._getTitle=function(){return this._filterOnline?"/strings/abAllSectionTitleOnline":"/strings/abAllSectionTitle"};n.AllContactsSection.prototype.totalCountChanged=function(n){var t=Jx.hasClass(this._contentElement,"zeroContacts");Jx.setClass(this._contentElement,"zeroContacts",n===0);n>0&&t&&this._grid.onResize()};n.AllContactsSection.prototype.hide=function(){};n.AllContactsSection.prototype._getPlaceholderUI=function(){return"<div class='barricade' ><div class='unfilteredBarricade' >"+Jx.res.getString("/strings/abEmptyTitle")+"<\/div><div class='onlineFilterBarricade' ><div>"+Jx.res.getString("/strings/abOnlineFilterEmptyTitle")+"<\/div><button id='btnClearFilter' type='button'>"+Jx.res.getString("/strings/abOnlineFilterEmptyMessage")+"<\/button><\/div><\/div>"};n.AllContactsSection.prototype._getCollection=function(){var n=this._allContacts=this._platformCache.getCollection(this.name,function(n,i){return new t(n,i,this._filterOnline)},this);return n.setFilterOnline(this._filterOnline),n.addListener("queriesChanged",this._queriesChanged,this),n.getCollection()};n.AllContactsSection.prototype._getFactories=function(){var t=new n.IdentityControlNodeFactory(n.IdentityElements.BillboardLayout,{className:"ic-listItem ic-hoverListItem",fontSize:this.getOrientation()===n.Orientation.horizontal?"medium":"normal",tilePriority:n.Priority.userTileRender});return{person:new n.Callback(t.create,t),nameGrouping:new n.Callback(function(){return new n.AlphabeticHeader}),otherGrouping:new n.Callback(function(){return new n.OtherHeader})}};n.AllContactsSection.prototype._queriesChanged=function(){this._grid.resetAnimationTimeout()};n.AllContactsSection.prototype.appendSemanticZoomCollection=function(t){for(var r=new n.ArrayCollection("AllSection"),u,i=0;i<this._collection.length;i++)u=this._collection.getItem(i),r.appendItem({type:"zoomedOutAlphabeticHeader",data:u,collection:null});r.loadComplete();t.appendItem({collection:r})};t=n.AllContactsCollection=function(t,i,u){this._platform=t;this._jobSet=i;this._filterOnline=u;this._getQuery=r.bind(this);var f=this._groupings=new n.ArrayCollection("alphabet");n.AddressBookCollections.appendAlphabeticCollection(t.peopleManager,f,this._getQuery);f.loadComplete();Jx.EventManager.addListener(Jx.root,"personSortChanged",this._sortChanged,this)};Jx.augment(t,Jx.Events);t.prototype.dispose=function(){Jx.EventManager.removeListener(Jx.root,"personSortChanged",this._sortChanged,this);this._groupings.dispose();this._groupings=null};t.prototype.hydrate=function(n){this._groupings.hydrate(n)};t.prototype.dehydrate=function(){return this._groupings.dehydrate()};t.prototype.getCollection=function(){return this._groupings};t.prototype.setFilterOnline=function(n){this._filterOnline!==n&&(this._filterOnline=n,this._requery())};t.prototype._sortChanged=function(){this._requery()};t.prototype._requery=function(){n.AddressBookCollections.replaceAlphabeticCollection(this._platform.peopleManager,this._groupings,this._getQuery,this._jobSet).done(function(){this.raiseEvent("queriesChanged")}.bind(this))}})