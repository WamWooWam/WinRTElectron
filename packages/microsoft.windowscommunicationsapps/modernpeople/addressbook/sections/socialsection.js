Jx.delayDefine(People,"SocialSection",function(){function t(){}function i(){}var n=window.People,u=Microsoft.WindowsLive.Platform,r;n.SocialSection=function(t,i){n.StaticSection.call(this,"socialSection","/strings/abSocialSectionTitle");this._platformCache=t;this._animation=null;this._isEntering=false;var r={getAssetText:function(n){return n.serviceContactsName},delayRender:true,phase1Ctor:Jx.Component};this._upsellControl=new n.Accounts.UpsellControl(t.getPlatform(),u.ApplicationScenario.people,i,{phase1InstructionsId:"/strings/upsellInstructions",phase1DismissId:"/strings/upsellPhase1Dismiss",phase2InstructionsId:"/strings/upsellPhase2Instructions"},r);People.loadSocialModel();People.loadSocialUICore();Jx.EventManager.addListener(this._upsellControl,"upsellDismissed",this._onUpsellDismissed.bind(this),this)};Jx.inherit(n.SocialSection,n.StaticSection);n.SocialSection.prototype._onUpsellDismissed=function(){var n=this._contentElement.querySelector(".upsell-container");Jx.addClass(n,"upsell-hidden");this._upsellControl.shutdownUI();this._upsellControl=null};n.SocialSection.prototype.getContent=function(){var u,f=this.getJobSet(),o=this._identityControl=new n.IdentityControl(null,f),r,e;return this._unreadNotifications=n.Social.unreadNotifications,Jx.addListener(this._unreadNotifications,"changed",this._onNotificationCountChanged,this),r=this._getNotificationsContent(),e=Jx.isNonEmptyString(r)?"ab-notifications-container":"ab-notifications-container ab-notifications-disabled",u=o.getUI(n.IdentityElements.TileLayout,{className:"ic-me",size:this.getOrientation()===n.Orientation.horizontal?120:80,primaryContent:t,secondaryContent:{element:i,className:e,content:r}}),this._latestNotification=new People.RecentActivity.UI.Modules.Feed.LatestNotification(f,this._platformCache),"<div class='socialSectionGrid'><div class='socialSectionBackground'><\/div>"+u+this._latestNotification.getUI()+Jx.getUI(this._upsellControl).html+"<\/div>"};n.SocialSection.prototype.render=function(){n.StaticSection.prototype.render.call(this);this._notificationCountContainer=this._contentElement.querySelector(".ab-notifications-container");this._notificationCountContainer.tabIndex=0;this._notificationCountContainer.addEventListener("click",this._onNotificationTextClicked,false);this._notificationCountContainer.addEventListener("keypress",this._onKeyPress,false);this._identityControl.activateUI(this._contentElement);this._identityControl.updateDataSource(this._platformCache.getDefaultMeContact());this._latestNotification.activateUI(this._contentElement.querySelector(".notificationList"));var t=this.getJobSet();t.addUIJob(this._unreadNotifications,this._unreadNotifications.refreshCount,null,n.Priority.notifications);this._upsellControl.activateUI()};n.SocialSection.prototype.deactivateUI=function(){n.StaticSection.prototype.deactivateUI.call(this);this._pendingChange=false;this._animation&&this._animation.cancel();this._identityControl&&this._identityControl.shutdownUI();this._unreadNotifications&&Jx.removeListener(this._unreadNotifications,"changed",this._onNotificationCountChanged,this);this._latestNotification&&this._latestNotification.deactivateUI();this._notificationCountContainer&&(this._notificationCountContainer.removeEventListener("click",this._onNotificationTextClicked,false),this._notificationCountContainer.removeEventListener("keypress",this._onKeyPress,false),this._notificationCountContainer=null)};n.SocialSection.prototype._onNotificationTextClicked=function(){People.Nav.navigate(People.Nav.getNotificationUri(null))};n.SocialSection.prototype._onKeyPress=function(n){(n.keyCode===WinJS.Utilities.Key.enter||n.keyCode===WinJS.Utilities.Key.space)&&People.Nav.navigate(People.Nav.getNotificationUri(null))};r=[{singleLine:"/strings/abNotificationsSingleLineNone"},{singleLine:"/strings/abNotificationsSingleLineSingular"},{singleLine:"/strings/abNotificationsSingleLinePlural"}];n.SocialSection.prototype._getNotificationsContent=function(){if(this._unreadNotifications.isEnabled()){var n=this._unreadNotifications.getCount(),t=r[Math.min(n,2)];return"<div class='ab-notifications-content'><div class='ab-notifications-singleLine ab-tooltip-check'>"+Jx.escapeHtml(Jx.res.loadCompoundString(t.singleLine,n))+"<\/div><\/div>"}return""};n.SocialSection.prototype.contentReadyAsync=function(){var n,t,i,r;return this._isEntering=true,n=[],t=this._contentElement.querySelector(".ic-me"),t&&n.push(t),i=this._contentElement.querySelector(".notificationList"),i&&n.push(i),r=this._contentElement.querySelector(".upsell-container"),r&&n.push(r),n};n.SocialSection.prototype.onEnterComplete=function(){this._isEntering=false;this._onAnimationComplete()};n.SocialSection.prototype._onNotificationCountChanged=function(){var t,n,i,f,e,r,u;Boolean(this._animation)||this._isEntering?this._pendingChange=true:(n=this._notificationCountContainer,i=this._unreadNotifications.isEnabled(),Jx.hasClass(n,"ab-notifications-disabled")===i?i?(n.innerHTML=this._getNotificationsContent(),f=WinJS.UI.Animation.createExpandAnimation(n,this._contentElement.children),Jx.removeClass(n,"ab-notifications-disabled"),t=f.execute()):(e=WinJS.UI.Animation.createCollapseAnimation(n,this._contentElement.children),n.style.position="absolute",n.style.opacity="0",t=e.execute().then(function(){n.style.position="";n.style.opacity="";Jx.addClass(n,"ab-notifications-disabled")})):i&&(r=n.lastChild,r.style.position="absolute",n.insertAdjacentHTML("beforeend",this._getNotificationsContent()),u=n.lastChild,u.style.opacity="0",t=WinJS.UI.Animation.crossFade(u,r).then(function(){n.removeChild(r)})),t&&(this._animation=t,t.done(this._onAnimationComplete.bind(this))))};n.SocialSection.prototype._onAnimationComplete=function(){this._animation=null;this._pendingChange?(this._pendingChange=false,this._onNotificationCountChanged()):this.getJobSet().addUIJob(this,this._tooltipCheck,null,n.Priority.accessibility)};n.SocialSection.prototype._tooltipCheck=function(){var n=this._contentElement.querySelectorAll(".ab-tooltip-check");Array.prototype.forEach.call(n,function(n){n.style.overflow="visible";n.title=n.scrollWidth>n.clientWidth?n.innerText:"";n.style.overflow=""},this)};n.SocialSection.prototype.appendSemanticZoomCollection=function(t){var i=new n.ArrayCollection("SocialSection");i.appendItem({type:"zoomedOutSocialHeader",data:null,collection:null});i.loadComplete();t.appendItem({collection:i})};n.SocialSection.prototype.dehydrate=function(){};t.prototype.getUI=function(t,i,r){var u=Jx.isRtl()?"":"";return n.IdentityElements.makeElement("a",i,"ic-meName ic-text",r,Jx.escapeHtml(Jx.res.getString("/strings/abMe")))+"<a class='ic-meName ic-text ic-chevron' aria-hidden='true'>"+u+"<\/a>"};t.prototype.activateUI=function(){};t.prototype.shutdownUI=function(){};i.prototype.getUI=function(t,i,r){return n.IdentityElements.makeElement("div",i,"ic-text",r,r.content)};i.prototype.activateUI=function(){};i.prototype.shutdownUI=function(){}})