Jx.delayDefine(People,"FavoriteContactsSection",function(){var n=window.People,i=Windows.ApplicationModel.Contacts,r=Microsoft.WindowsLive.Instrumentation.Ids,t;n.FavoriteContactsSection=function(t){n.ContactGridSection.call(this,"favoritesSection","/strings/abFavoritesSectionTitle",t.getPlatform().peopleManager);this._totalCounter=null;this._platformCache=t;this._accountSync=null;this._whatsNew=null;this._isActive=false};Jx.inherit(n.FavoriteContactsSection,n.ContactGridSection);t=n.ContactGridSection.prototype;n.FavoriteContactsSection.prototype.getContent=function(){var r=this.getJobSet(),i;return this._accountSync=new n.Accounts.AccountSynchronization(this._platformCache.getPlatform()),i=this._accountSync.areAccountsAvailable(),i&&(this._whatsNew=new n.RecentActivity.UI.Modules.Feed.FeedModule(r)),"<div class='favoritesSectionGrid'><div class='favoritesSectionBackground'><\/div>"+t.getContent.apply(this,arguments)+"<div class='ab-whatsNew'>"+(i?this._whatsNew.getUI():"")+"<\/div><\/div>"};n.FavoriteContactsSection.prototype._getPlaceholderUI=function(){return"<div class='placeholder'>"+Jx.res.getString("/strings/abFavoritesPlaceholder")+"<\/div>"};n.FavoriteContactsSection.prototype.totalCountChanged=function(n){var t=Jx.hasClass(this._contentElement,"zeroContacts");Jx.setClass(this._contentElement,"zeroContacts",n<=1);n>1&&t&&this._grid.onResize()};n.FavoriteContactsSection.prototype.extentReady=function(){this._isActive=true;this._totalCounter=new n.TotalCounter(this._collection,this);this.totalCountChanged(this._totalCounter.count);t.extentReady.apply(this,arguments)};n.FavoriteContactsSection.prototype.hide=function(){};n.FavoriteContactsSection.prototype.render=function(){n.ContactGridSection.prototype.render.call(this);this._whatsNew&&this._whatsNew.activateUI(this._contentElement.querySelector(".ab-whatsNew"))};n.FavoriteContactsSection.prototype.contentReadyAsync=function(){if(this._whatsNew&&this._whatsNew.suppressUxUpdates(),this.isInView()){var n=[this._contentElement.querySelector(".gridContainer")];return this._whatsNew&&n.push(this._contentElement.querySelector(".ab-whatsNew")),this._placeholder&&this._placeholder.display!=="none"&&n.push(this._placeholder),n}return[]};n.FavoriteContactsSection.prototype.onEnterComplete=function(){n.ContactGridSection.prototype.onEnterComplete.call(this);this._whatsNew?this._whatsNew.enableUxUpdates():this._accountSync.areAccountsAvailable(this._showWhatsNew,this)&&this._showWhatsNew()};n.FavoriteContactsSection.prototype._showWhatsNew=function(){var i,t,r;i=this._whatsNew=new n.RecentActivity.UI.Modules.Feed.FeedModule(this.getJobSet());t=this._contentElement.querySelector(".ab-whatsNew");t.innerHTML=i.getUI();i.activateUI(t);Jx.removeClass(t,"ab-whatsNewHidden");r=this;WinJS.UI.Animation.fadeIn(t)};n.FavoriteContactsSection.prototype._getCollection=function(){var t=this;return this._platformCache.getCollection(this.name,function(i){return n.AddressBookCollections.makeFavoritesCollection(i.peopleManager,t.getJobSet())})};n.FavoriteContactsSection.prototype._getFactories=function(){var t,i,r,u;return this.getOrientation()===n.Orientation.horizontal?(t=n.IdentityElements.TileLayout,i={className:"ic-favorite",size:180,useInnerHighlight:true,primaryContent:{element:n.IdentityElements.Name,className:"ic-favoriteName"},tilePriority:n.Priority.userTileRender}):(t=n.IdentityElements.TileLayout,i={className:"ic-favorite",size:140,useInnerHighlight:true,primaryContent:{element:n.IdentityElements.Name,className:"ic-favoriteName"},tilePriority:n.Priority.userTileRender}),r=new n.IdentityControlNodeFactory(t,i,{getLabel:function(n,t){return t+"\n"+Jx.res.getString("/strings/abFavoritesGroupingHeader")}}),u=new n.Callback(this.addFavoritesButtonClicked,this),{favoritesGrouping:new n.Callback(function(){return new n.FavoritesHeader}),person:new n.Callback(r.create,r),addFavoritesButton:new n.Callback(function(){return new n.AddFavoritesButton(u)})}};n.FavoriteContactsSection.prototype.addFavoritesButtonClicked=function(){var t=new i.ContactPicker,u;t.commitButtonText=Jx.res.getString("/strings/abAddFavoritesPeoplePickerText");t.selectionMode=i.ContactSelectionMode.contacts;u=this;t.pickContactsAsync().then(function(t){for(var e,f,i=0;i<t.size;i++)e=t[i].id,f=u._platformCache.getPlatform().peopleManager.tryLoadPerson(e),f.isFavorite||(f.insertFavorite(Microsoft.WindowsLive.Platform.FavoriteInsertPosition.insertLast,null),Jx.bici.addToStream(r.People.socialReactionUpdated,"",n.Bici.landingPage,0,n.Bici.ReactionType.favorite));n.AppTile.pushTiles(u._platformCache.getPlatform())},function(){})};n.FavoriteContactsSection.prototype.appendSemanticZoomCollection=function(t){var i=new n.ArrayCollection("FavoritesSection");i.appendItem({type:"zoomedOutFavoritesHeader",data:this._collection.getItem(0),collection:null});i.loadComplete();t.appendItem({collection:i})};n.FavoriteContactsSection.prototype.shutdownComponent=function(){n.ContactGridSection.prototype.shutdownComponent.call(this);this._isActive=false;this._accountSync&&this._accountSync.dispose();this._whatsNew&&this._whatsNew.deactivateUI()}})