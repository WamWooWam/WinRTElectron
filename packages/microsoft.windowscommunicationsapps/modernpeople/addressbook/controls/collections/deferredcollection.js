Jx.delayDefine(People,"DeferredCollection",function(){"use strict";var r=window.People,t=Microsoft.WindowsLive.Platform,n=r.DeferredCollection=function(n,t){this._realCollection=new r.PlatformCollectionWatcher(n,new r.Callback(this._collectionChanged,this));this._pendingChanges=[];this._length=n.count;this._listener=t;this._pendingBatchNotifications=0;n.unlock()},i;Object.defineProperty(n.prototype,"length",{get:function(){return this._length}});n.updateIndex=function(t,i){return n.updateIndexEx(t,i).index};n.updateIndexEx=function(i,r){for(var u,f=0,e=i.length;f<e;f++){u=i[f];switch(u.eType){case t.CollectionChangeType.reset:return{removedObjectId:"",index:n.removed};case t.CollectionChangeType.itemRemoved:if(u.index===r)return{removedObjectId:u.objectId,index:n.removed};u.index<r&&r--;break;case t.CollectionChangeType.itemAdded:u.index<=r&&r++;break;case t.CollectionChangeType.itemChanged:u.previousIndex===r?r=u.index:(u.previousIndex<r&&r--,u.index<=r&&r++)}}return{removedObjectId:"",index:r}};n.prototype.getItemId=function(t){var i="",r=n.updateIndexEx(this._pendingChanges,t),u;return r.index===n.removed?i=r.removedObjectId:(u=this._realCollection.item(r.index),i=u.objectId),i};n.prototype.getItem=function(t){var i=n.updateIndex(this._pendingChanges,t);return i!==n.removed?this._realCollection.item(i):null};i={};i[t.CollectionChangeType.itemAdded]=1;i[t.CollectionChangeType.itemRemoved]=-1;i[t.CollectionChangeType.itemChanged]=0;n.prototype.acceptPendingChanges=function(){this._length=this._realCollection.getCount();var n=this._pendingChanges;return this._pendingChanges=[],n};n.prototype.getFirstPendingChange=function(){var n=this._pendingChanges.shift(),t;return this._isReset()?this._length=this._realCollection.getCount():(t=i[n.eType],this._length+=t),n};n.prototype.dispose=function(){this._realCollection.dispose()};n.prototype._getAugmentedChange=function(n){return n};n.prototype._reportReset=function(n){return(this._pendingChanges=[n],Jx.isFunction(this._listener.onResetPending))?(this._listener.onResetPending(),true):false};n.prototype._collectionChanged=function(n,i){var r=this._pendingChanges.length===0;if((i.eType!==t.CollectionChangeType.reset||!this._reportReset(i))&&(this._isReset()||i.eType===t.CollectionChangeType.batchBegin||i.eType===t.CollectionChangeType.batchEnd?i.eType===t.CollectionChangeType.batchBegin?this._pendingBatchNotifications++:i.eType===t.CollectionChangeType.batchEnd&&this._pendingBatchNotifications--:this._pendingChanges.push(this._getAugmentedChange(i)),r))this._listener.onChangesPending(n,this)};n.prototype._isReset=function(){return this._pendingChanges.length===1&&this._pendingChanges[0].eType===t.CollectionChangeType.reset};Object.defineProperty(n.prototype,"hasPendingChanges",{get:function(){return this._pendingChanges.length!==0}});Object.defineProperty(n.prototype,"isProcessingBatchNotifications",{get:function(){return this._pendingBatchNotifications!==0}});n.removed=-1})