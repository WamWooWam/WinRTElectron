Jx.delayDefine(People,"ArrayCollection",function(){"use strict";function i(n){this._changeHandlers[n.eType].apply(this,arguments)}var n=window.People,t=Microsoft.WindowsLive.Platform;n.ArrayCollection=function(t){n.Collection.call(this,t);this._items=[];this._pendingDelta=0;this._pendingChanges=[];this._pendingItems={}};Jx.inherit(n.ArrayCollection,n.Collection);n.ArrayCollection.prototype.getItem=function(n){return this._items[n]};n.ArrayCollection.prototype.hydrate=function(t){this.isHydrated=true;this._items.forEach(function(i){var r=i.collection;Jx.isObject(r)&&(r.hydrate(n.Hydration.get(t,r.name)),r.isHydrated||(this.isHydrated=false))},this)};n.ArrayCollection.prototype.dehydrate=function(){return this._items.reduce(function(t,i){var r=i.collection;return r!==null&&n.Hydration.set(t,r.name,r.dehydrate()),t},{})};n.ArrayCollection.prototype.dispose=function(){this._items.forEach(function(n){var t=n.collection;t!==null&&t.dispose()})};n.ArrayCollection.prototype._raiseChangesPending=function(){this._pendingChanges.length===1&&this.raiseEvent("changesPending",{target:this})};n.ArrayCollection.prototype.addItem=function(n,i){if(i>=0&&i<=this.length+this._pendingDelta)this._pendingItems[this._pendingChanges.length]=n,this._pendingChanges.push({eType:t.CollectionChangeType.itemAdded,index:i}),++this._pendingDelta,this._raiseChangesPending();else throw new Error("Collection index out of bounds")};n.ArrayCollection.prototype.removeItem=function(n){if(n>=0&&n<this.length+this._pendingDelta)this._pendingChanges.push({eType:t.CollectionChangeType.itemRemoved,index:n}),--this._pendingDelta,this._raiseChangesPending();else throw new Error("Collection index out of bounds")};n.ArrayCollection.prototype.moveItem=function(n,i){var r=this.length+this._pendingDelta;if(n>=0&&n<r&&i>=0&&i<r)this._pendingChanges.push({eType:t.CollectionChangeType.itemChanged,previousIndex:n,index:i}),this._raiseChangesPending();else throw new Error("Collection index out of bounds")};n.ArrayCollection.prototype.appendItem=function(n){this._items.push(n)};n.ArrayCollection.prototype.loadComplete=function(){this.length=this._items.length;this.isLoaded=true;this.raiseEvent("load",{target:this,length:this.length})};n.ArrayCollection.prototype._changeHandlers={};n.ArrayCollection.prototype._changeHandlers[t.CollectionChangeType.itemAdded]=function(n,t){this._items.splice(n.index,0,this._pendingItems[t])};n.ArrayCollection.prototype._changeHandlers[t.CollectionChangeType.itemRemoved]=function(n){this._items.splice(n.index,1)};n.ArrayCollection.prototype._changeHandlers[t.CollectionChangeType.itemChanged]=function(n){var i=n.previousIndex,t=n.index,r=this._items.splice(i,1)[0];this._items.splice(t>i?t-1:t,0,r)};n.ArrayCollection.prototype.acceptPendingChanges=function(){var n=this._pendingChanges;return n.forEach(i,this),this.length=this._items.length,this._pendingChanges=[],this._pendingItems={},this._pendingDelta=0,this.raiseEvent("changesApplied",{target:this,changes:n}),n};n.TotalCounter=function(n,t){var i,u,r;for(this._collection=n,this._listener=t,this.count=0,i=0,u=n.length;i<u;i++)r=n.getItem(i).collection,r.addListener("load",this._onLoaded,this),r.addListener("changesApplied",this._onChanges,this),this.count+=r.length};n.TotalCounter.prototype.dispose=function(){var i=this._collection,n,r,t;for(this._collection=null,this._listener=null,n=0,r=i.length;n<r;n++)t=i.getItem(n).collection,t.removeListener("load",this._onLoaded,this),t.removeListener("changesApplied",this._onChanges,this)};n.TotalCounter.prototype._onLoaded=function(){this._reset();this._listener.totalCountChanged(this.count)};n.TotalCounter.prototype._reset=function(){var t,n,i,r;for(this.count=0,t=this._collection,n=0,i=t.length;n<i;n++)r=t.getItem(n).collection,this.count+=r.length};n.TotalCounter.prototype._onChanges=function(n){n.changes.length===1&&n.changes[0].eType===t.CollectionChangeType.reset?this._reset():n.changes.forEach(function(n){n.eType===t.CollectionChangeType.itemAdded?this.count++:n.eType===t.CollectionChangeType.itemRemoved&&this.count--},this);this._listener.totalCountChanged(this.count)}})