Jx.delayDefine(People,"QueryCollection",function(){"use strict";var n=People,t=Microsoft.WindowsLive.Platform;n.QueryCollection=function(t,i,r){n.Collection.call(this,r);this._itemType=t;this._queryCallback=i;this._pendingReplace=null;this._deferredCollection=null};Jx.inherit(n.QueryCollection,n.Collection);n.QueryCollection.prototype.getItem=function(n){var t=this._deferredCollection.getItem(n);return t===null?{type:"none"}:{type:this._itemType,data:t}};n.QueryCollection.prototype.hydrate=function(n){Jx.isNumber(n)&&(this.length=n,this.isHydrated=true)};n.QueryCollection.prototype.dehydrate=function(){return this.isLoaded?this.length:null};n.QueryCollection.prototype.dispose=function(){this._deferredCollection!==null&&this._deferredCollection.dispose();this._queryCallback=null};n.QueryCollection.prototype.load=function(t){t.addUIJob(this,this._query,null,n.Priority.query)};n.QueryCollection.prototype.replace=function(t,i){if(!this.isLoaded)return this._queryCallback=t,WinJS.Promise.wrap();var r=this;return new WinJS.Promise(function(u){i.addUIJob(r,function(){this._pendingReplace=t.invoke();this.raiseEvent("changesPending",{target:this});u()},null,n.Priority.query)})};n.QueryCollection.prototype._acceptPendingReplace=function(){var e=[],i,r,o,u=new n.DeferredCollection(this._pendingReplace,this),f=this._deferredCollection;if(this._pendingReplace=null,u.length<f.length){for(i=f.length-1,r=u.length-1;i>=0;i--)r<0||f.getItemId(i)!==u.getItemId(r)?e.push({index:i,eType:t.CollectionChangeType.itemRemoved}):r--;r!==-1&&(e=[{eType:t.CollectionChangeType.reset}])}else{for(i=0,r=0,o=u.length;i<o;i++)r>=f.length||u.getItemId(i)!==f.getItemId(r)?e.push({index:i,eType:t.CollectionChangeType.itemAdded}):r++;r!==f.length&&(e=[{eType:t.CollectionChangeType.reset}])}return Jx.dispose(this._deferredCollection),this._deferredCollection=u,e};n.QueryCollection.prototype._query=function(){var t=this._queryCallback.invoke(),i=this._deferredCollection=new n.DeferredCollection(t,this);this.length=i.length;this.isLoaded=true;this.raiseEvent("load",{target:this,length:this.length})};n.QueryCollection.prototype.onChangesPending=function(){this.raiseEvent("changesPending",{target:this})};n.QueryCollection.prototype.acceptPendingChanges=function(){var n;return n=this._pendingReplace?this._acceptPendingReplace():this._deferredCollection.acceptPendingChanges(),this.length=this._deferredCollection.length,this.raiseEvent("changesApplied",{target:this,changes:n}),n}})