Jx.delayDefine(People,"ConcatenatedCollection",function(){"use strict";var n=window.People,t=Microsoft.WindowsLive.Platform;n.ConcatenatedCollection=function(t,i){n.Collection.call(this,i);this._subCollections=t;this._changesPending=false;this._unloadedCollections=0};Jx.inherit(n.ConcatenatedCollection,n.Collection);n.ConcatenatedCollection.prototype.getItem=function(n){for(var r=this._subCollections,i,t=0,u=r.length;t<u;++t){if(i=r[t],n<i.length)return i.getItem(n);n-=i.length}return null};n.ConcatenatedCollection.prototype.hydrate=function(t){this.isHydrated=true;this._subCollections.forEach(function(i){i.hydrate(n.Hydration.get(t,i.name));i.isHydrated||(this.isHydrated=false)},this);var i=0,r=0;this._subCollections.forEach(function(n){r+=n.length;n.isLoaded||(i++,n.addListener("load",this._onLoad,this))},this);this.length=r;this._unloadedCollections=i;i===0&&this._allLoaded()};n.ConcatenatedCollection.prototype.dehydrate=function(){return this._subCollections.reduce(function(t,i){return n.Hydration.set(t,i.name,i.dehydrate()),t},{})};n.ConcatenatedCollection.prototype.dispose=function(){var t=this._subCollections,n,i;for(this._subCollections=null,n=0,i=t.length;n<i;++n)t[n].dispose()};n.ConcatenatedCollection.prototype.load=function(n){this._subCollections.forEach(function(t){t.isLoaded||t.load(n)})};n.ConcatenatedCollection.prototype._allLoaded=function(){this.isLoaded=true;var n=0;this._subCollections.forEach(function(t){t.addListener("changesPending",this._onChangesPending,this);n+=t.length},this);this.length=n;this.raiseEvent("load",{target:this,length:n})};n.ConcatenatedCollection.prototype._onLoad=function(n){n.target.removeListener("load",this._onLoad,this);--this._unloadedCollections==0&&this._allLoaded()};n.ConcatenatedCollection.prototype._onChangesPending=function(){this._changesPending||(this._changesPending=true,this.raiseEvent("changesPending",{target:this}))};n.ConcatenatedCollection.prototype.acceptPendingChanges=function(){var n=[],i=0,r;return this._subCollections.forEach(function(u){u.acceptPendingChanges().forEach(function(u){u.index+=i;u.eType===t.CollectionChangeType.reset?r=u:u.eType===t.CollectionChangeType.itemChanged&&(u.previousIndex+=i);n.push(u)});i+=u.length}),r&&(n=[r]),this.length=i,this._changesPending=false,this.raiseEvent("changesApplied",{target:this,changes:n}),n};n.ConcatenatedCollection.prototype.replace=function(n,t){var i=this._subCollections;return WinJS.Promise.join(i.map(function(i,r){return i.replace(n[r],t)}))}})