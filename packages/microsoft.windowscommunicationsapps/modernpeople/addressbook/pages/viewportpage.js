Jx.delayDefine(People,"ViewportPage",function(){var t=window.People,n=t.ViewportPage=function(n){this._host=n;$include("$(cssResources)/AddressBook.css")};n.prototype.load=function(n){var r=this._host,e=r.getJobSet(),o=this._jobSet=e.createChild(),s=this._element=n.element,c,f,i,l,a,v;this._semanticZoomActivated&&Jx.addClass(s,"semanticZoomEnabled");var u=this._layout=r.getLayout(),y=this._layoutState=u.getLayoutState(),h=this._orientation=y===t.Layout.layoutState.snapped?t.Orientation.vertical:t.Orientation.horizontal;return Jx.addListener(u,u.layoutChanged,this._onLayoutChange,this),r.getCommandBar().addCommand(new t.Command("addContact","/strings/abAddContactCommandText","/strings/abAddContactCommandTooltip","",true,true,null,null,t.Nav.getCreateContactUri())),c=this._zoomedOutJobSet=e.createChild(),o.setOrder(0),c.setOrder(1),f=this._createViewportChild(n.data,n.fields),i=this._viewport=new t.ScrollingViewport(o,f,h),this._initViewportChild(f,h),l=Jx.getUI(i),s.innerHTML=l.html,i.activateUI(),Jx.mark("People.Viewport.load:abBuildHtml,StopTA,People"),Jx.mark("People.Viewport.load:abHydrate,StartTA,People"),i.hydrate(n.state,!(n.fields&&n.fields.pos==="home")),Jx.mark("People.Viewport.load:abHydrate,StopTA,People"),this._semanticZoomActivated&&n.isZoomedOut&&this._initializeSemanticZoom(true),a=i.contentReadyAsync(),v=function(r){return{elements:r,onEnterComplete:function(){i===this._viewport&&(this._semanticZoomActivated&&!n.isZoomedOut&&this._jobSet.addUIJob(this,this._initializeSemanticZoom,[false],t.Priority.semanticZoom),i.onEnterComplete())}}},WinJS.Promise.as(a).then(v)};n.prototype._initializeSemanticZoom=function(n){if(document.getElementById(this._element.id)){var i={initiallyZoomedOut:n};this._zoom=t.ZoomHost.create(this._viewport,this._jobSet,this._zoomedOutJobSet,this._orientation,this._host,i,this._element)}};n.prototype.resetScrollPosition=function(){this._viewport!==null&&this._viewport.setScrollPosition(0)};n.prototype.prepareSaveState=function(){return this._viewport!==null?this._viewport.dehydrate():null};n.prototype.prepareSuspension=function(){return null};n.prototype.activate=function(){};n.prototype.deactivate=function(){var n=this._jobSet,t=this._zoomedOutJobSet;return n&&n.cancelAllChildJobs(),t&&t.cancelAllChildJobs(),this._layout!==null&&(Jx.removeListener(this._layout,this._layout.layoutChanged,this._onLayoutChange,this),this._layout=null),this._unhookNavigationCompletedEvent(),true};n.prototype.unload=function(){var n=this._zoom||this._viewport;n!==null&&(n.shutdownUI(),n.shutdownComponent());this._zoom=null;this._viewport=null;Jx.dispose(this._jobSet);Jx.dispose(this._zoomedOutJobSet);this._jobSet=this._zoomedOutJobSet=null;this._element=null};n.prototype._onLayoutChange=function(){var n=this._host;n.isNavigating()?this._navigationCompletedListener||(this._navigationCompletedListener=this._onNavigationCompleted.bind(this),Jx.addListener(n,n.navigationCompleted,this._navigationCompletedListener,null)):this._reload()};n.prototype._onNavigationCompleted=function(){this._unhookNavigationCompletedEvent();this._reload()};n.prototype._unhookNavigationCompletedEvent=function(){if(this._navigationCompletedListener){var n=this._host;Jx.removeListener(n,n.navigationCompleted,this._navigationCompletedListener,null);this._navigationCompletedListener=null}};n.prototype._reload=function(){var i=this._element,r=!Jx.isNullOrUndefined(this._zoom)&&this._zoom.zoomedOut,u=this.prepareSaveState(),n,t;this.deactivate();this.unload();n=this;t=this.load({element:i,state:u,isZoomedOut:r});WinJS.Promise.wrap(t).done(function(t){t.onEnterComplete.call(n)});this.activate();this._host.getCommandBar().refresh()};n.prototype._host=null;n.prototype._element=null;n.prototype._viewport=null;n.prototype._jobSet=null;n.prototype._zoom=null;n.prototype._semanticZoomActivated=false;n.prototype._navigationCompletedListener=null})