Jx.delayDefine(People,"PickerIdentityElements",function(){function o(n){var f=t.Contact.createUniqueFields(n.linkedContacts,"mapLocation"),r=f.map(function(n){return{value:n.fieldValue}}),i,u;return r.length>0?(i=t.Location.getBestLocation(r),u=i?i.value:null,t.Location.chooseBestDisplayField(u)):null}var t=window.People,r=t.PickerIdentityElements={},i=r.DisambiguatedProperty=function(){this._textNode=null;this._selectionManager=null;this._person=null;this._types=[]},n,u,f,e;Jx.inherit(i,People.IdentityElements.BaseElement);i.prototype.getUI=function(n,t,i){return this._types=i.types,People.IdentityElements.makeElement("span",t,"",i," ")};i.prototype.clone=function(){var n=new i;return n._types=this._types,n};i.prototype.activateUI=function(n,i){this._textNode=i.firstChild;var r=this._selectionManager=n.getSelectionManager();r.addListener("selectionchange",this._updateSelectedProperty,this);n.bind(this._reset,this,t.Priority.synchronous);n.bind(this._update,this,t.Priority.slowData)};i.prototype.shutdownUI=function(){var n=this._selectionManager;n&&(this._selectionManager=null,n.removeListener("selectionchange",this._updateSelectedProperty,this));this._person=null};i.prototype._updateSelectedProperty=function(n){var t=this._person;Jx.isNullOrUndefined(t)||Jx.isNullOrUndefined(t.getPlatformObject())||t.objectId!==n.id||this._update(t)};i.prototype._update=function(n){var i,u,r,f;for(this._person=n,i=this._selectionManager.getSelectedPropertyValue(n.getPlatformObject()),u=this._types,r=0,f=u.length;r<f&&!Jx.isNonEmptyString(i);r++)switch(u[r]){case t.PeopleProvider.SupportedPropertyType.email:i=n.mostRelevantEmail;break;case t.PeopleProvider.SupportedPropertyType.location:i=o(n);break;case t.PeopleProvider.SupportedPropertyType.phone:i=n.mostRelevantPhone}this._textNode.nodeValue=i||""};i.prototype._reset=function(){this._textNode.nodeValue=""};i.prototype.getTooltip=function(){return this._textNode.nodeValue};n=r.Disambiguator=function(n){this._selectionManager=null;this._disambiguatorNode=null;this._fieldType=n;this._visible=false};n.prototype._fieldNames=[];Jx.inherit(n,People.IdentityElements.BaseElement);n.prototype.getUI=function(n,t,i){return People.IdentityElements.makeElement("div",t,"pp-disambiguatorContainer pp-hidden",i,"<div class='pp-disambiguator'><\/div>")};n.prototype.activateUI=function(n,i){this._selectionManager=n.getSelectionManager();this._disambiguatorNode=i;n.bind(this._reset,this,t.Priority.synchronous);n.bind(this._onPropertyListChanged,this,t.Priority.slowData);i.addEventListener("click",this._onClick.bind(this),false)};n.prototype.shutdownUI=function(){this._selectionManager=null};n.prototype._reset=function(){this._visible&&(Jx.addClass(this._disambiguatorNode,"pp-hidden"),this._visible=false)};n.prototype._onPropertyListChanged=function(n){this._person=n;var r=t.Contact.createUniqueFields(n.linkedContacts,this._fieldType),i=r.length>1;i!==this._visible&&(this._visible=i,Jx.setClass(this._disambiguatorNode,"pp-hidden",!i))};n.prototype._createMenuItem=function(n,t){var i=this._selectionManager;return new Windows.UI.Popups.UICommand(n,function(){i.setSelectedProperty(n,n,t)})};n.prototype._onClick=function(n){var r;if(n.stopPropagation(),r=this._person,r){var o=t.Contact.createUniqueFields(r.linkedContacts,this._fieldType),s=o.map(function(n){return n.fieldValue}),u=new Windows.UI.Popups.PopupMenu;if(s.forEach(function(n){var t=this._createMenuItem(n,r.getPlatformObject());try{u.commands.append(t)}catch(i){Jx.log.exception("Error adding menu item",i)}},this),u.commands.size>0){var f=this._disambiguatorNode,i=f.getBoundingClientRect(),e=f.parentNode;try{Jx.addClass(e,"menuOpened");u.showForSelectionAsync({x:i.left+i.width,y:i.top,width:i.width,height:i.height},Windows.UI.Popups.Placement.below).done(function(){Jx.removeClass(e,"menuOpened")},Jx.fnEmpty)}catch(h){Jx.log.exception("Failed to show menu",h)}}}};u=r.LocationDisambiguator=function(){n.call(this,"mapLocation")};Jx.inherit(u,n);u.prototype._createMenuItem=function(n,i){var u=this._selectionManager,r=t.Location.chooseBestDisplayField(n);return new Windows.UI.Popups.UICommand(r,function(){u.setSelectedProperty(n,r,i)})};f=r.EmailDisambiguator=function(){n.call(this,"email")};Jx.inherit(f,n);e=r.PhoneNumberDisambiguator=function(){n.call(this,"tel")};Jx.inherit(e,n)})