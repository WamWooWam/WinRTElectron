Jx.delayDefine(People,"AppNav",function(){var n=window.People,t=window.People.Nav;n.AppNav=function(n,t,i,r){Jx.log.info("People.AppNav");this._defaultLocation=n;var u=this._nav=new Jx.Nav;u.addListener(u.beforeNavigate,t,r);u.addListener(u.navigate,i,r);this._urlHash=new Jx.UrlHash;this._hashToNav=new Jx.HashToNav(this._urlHash,u)};n.AppNav.prototype.dispose=function(){Jx.log.info("People.AppNav.dispose");this._nav.dispose();this._hashToNav.dispose();this._urlHash.dispose()};n.AppNav._areSameLocations=function(n,t){function i(n,t){return!Jx.isNonEmptyString(n)&&!Jx.isNonEmptyString(t)||n===t}return["page","id","query","data"].every(function(r){return i(n[r],t[r])})};n.AppNav.markLocationAsDeepLinking=function(n){n.trigger="deepLinking"};n.AppNav.isLocationDeepLinking=function(n){return n.trigger==="deepLinking"};n.AppNav.prototype.isLastLocationDeepLinking=function(){var t=this._nav.backStack,i=t.length;return i>0&&n.AppNav.isLocationDeepLinking(t[i-1])};n.AppNav.prototype.isSameAsCurrentLocation=function(t){var i=this._nav.getLocation();return Jx.isObject(i)&&n.AppNav._areSameLocations(i,t)};n.AppNav.prototype.isSameAsLastLocation=function(t){var i=this._nav.backStack;return i.length>0&&n.AppNav._areSameLocations(t,i[i.length-1])};n.AppNav.prototype.removeLastLocation=function(){var u=this._nav,n=u.backStack,t,i,r;n.length>0&&(n.pop(),t=n.length,t>0&&(i=u.getLocation(),r=this._defaultLocation.page,i&&i.page===r&&n[t-1].page===r&&this.removeLastLocation()))};n.AppNav.prototype.go=function(n){Jx.log.info("People.AppNav.go");this._nav.go(n?n:this._defaultLocation)};n.AppNav.prototype.back=function(){var n,t;if(Jx.log.info("People.AppNav.back"),n=this._nav,!n.canGoBack())if(t=n.getLocation(),t.page!==this._defaultLocation.page)n.backStack.push(this._defaultLocation),n.forwardStack=[];else{Jx.log.error("People.AppNav.back: Trying to go back with an empty back stack when current page is not an edit page");return}n.backStack[n.backStack.length-1].trigger="back";n.back()};n.AppNav.prototype.canGoBack=function(){var n=this._nav,t=n.getLocation();return n.canGoBack()||t.page!==this._defaultLocation.page};n.AppNav.prototype.getLocation=function(){return this._nav.getLocation()};n.AppNav.prototype.clearBackStack=function(){Jx.log.info("People.AppNav.clearBackStack");this._nav.backStack=[]};n.AppNav.prototype.pushUriToBackStack=function(n){Jx.log.info("People.AppNav.pushUriToBackStack");Jx.log.pii("uri="+n);Jx.isNonEmptyString(n)&&n[0]==="#"&&this.pushLocToBackStack(Jx.parseHash(n.slice(1)))};n.AppNav.prototype.pushLocToBackStack=function(n){Jx.log.info("People.AppNav.pushLocToBackStack: loc = { page: "+n.page+"; id: "+n.id+" }");var t=this._nav,i=t.backStack;this.isSameAsCurrentLocation(n)||this.isSameAsLastLocation(n)||(i.push(n),t.forwardStack=[]);i.length>t.maxStack&&i.shift()};n.AppNav.prototype.setBackStateOfTopItem=function(n){var t=this._nav;t.backStack[t.backStack.length-1].state=n};n.AppNav.prototype.convertBackStackToObject=function(){return Jx.log.info("People.AppNav.convertBackStackToObject"),n.AppNav._convertBackStackToObject(this._nav.backStack)};n.AppNav._convertBackStackToObject=function(n){for(var i={},t=0;t<n.length;t++)i[String(t)]=JSON.stringify(n[t]);return i.size=n.length,i};n.AppNav.prototype.rebuildBackStackFromObject=function(t){Jx.log.info("People.AppNav.rebuildBackStackFromObject");this._nav.backStack=n.AppNav._rebuildBackStackFromObject(t)};n.AppNav._rebuildBackStackFromObject=function(n){var u,t,i,r;if(u=[],Jx.isObject(n)){for(t=0;t<n.size;t++)if(i=n[String(t)],Jx.isNonEmptyString(i)){r=null;try{r=JSON.parse(i)}catch(f){Jx.log.exception("People.AppNav._rebuildBackStackFromObject: failed parsing back stack item.",f);Jx.log.pii("Failed item: '"+i+"'.")}Jx.isObject(r)&&u.push(r)}}else Jx.log.error("People.AppNav._rebuildBackStackFromObject: invalid object. Object="+n);return u};n.AppNav.prototype.fallbackOnFail=function(n){Jx.log.info("People.AppNav.fallbackOnFail: failed loc = { page: "+n.page+"; id: "+n.id+" }");n.trigger==="back"&&this.canGoBack()?this.back():this._nav.go(this._defaultLocation)}})