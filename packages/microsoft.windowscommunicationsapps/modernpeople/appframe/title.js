Jx.delayDefine(People,"CpTitle",function(){var n=window.People,u=n.Nav,f=n.Animation;n.CpTitle=function(n){this._name="People.CpTitle";this.initComponent();this._jobSet=n;this._animation=null;this._onPersonNameChangedListener=this._onPersonNameChanged.bind(this);this._flyout=null;this._flyoutListener=null;this._person=null;this._element=null;this._titleAndChevronElement=null;this._titleElement=null;this._chevronElement=null;this._secondaryTitleElement=null;this._page=""};Jx.augment(n.CpTitle,Jx.Component);var t=n.CpHeader.Scenes,i=n.CpHeader.TitleTypes,r=n.CpTitle.PageToScene={allcontacts:t.allcontacts,createcontact:t.create,editmepicture:t.editphoto,editprofile:t.edit,galsearchresults:t.galsearchresults,linkperson:t.link,notification:t.notification,search:t.search,viewab:t.ab,viewme:t.ct,viewmephoto:t.ct,viewmeprofile:t.ct,viewmera:t.ct,viewperson:t.ct,viewphoto:t.ct,viewprofile:t.ct,viewra:t.ct,viewraitem:t.none,whatsnew:t.whatsnew};n.CpTitle.prototype.getUI=function(n){n.html='<div class="grid-header-title"><div class="header-title" id="idPeopleTitle"><div class="header-title-text singleLineText" id="idPeopleTitleText"><\/div><div class="header-title-chevron hidden" id="idPeopleTitleChevron"><\/div><\/div><div class="header-secondaryTitle singleLineText" id="idPeopleSecondaryTitle"><\/div><\/div>'};n.CpTitle.prototype.deactivateUI=function(){this._clearAnimationAndEventListeners();Jx.Component.prototype.deactivateUI.call(this)};n.CpTitle.prototype.getElement=function(){return this._element};n.CpTitle.prototype.activateUI=function(){Jx.Component.prototype.activateUI.call(this);var n=this._element=document.querySelector(".grid-header-title");this._titleAndChevronElement=n.querySelector(".header-title");this._titleElement=n.querySelector(".header-title-text");this._chevronElement=n.querySelector(".header-title-chevron");this._secondaryTitleElement=n.querySelector(".header-secondaryTitle")};n.CpTitle.prototype._clearAnimationAndEventListeners=function(){this._person&&this._person.removeEventListener("changed",this._onPersonNameChangedListener);this._person=null;Jx.dispose(this._flyout);Jx.dispose(this._flyoutListener);this._flyout=null;this._flyoutListener=null;this._animation&&this._animation.cancel()};n.CpTitle.prototype._hookPersonEventListener=function(n){n.addEventListener("changed",this._onPersonNameChangedListener);this._person=n};n.CpTitle.prototype._onPersonNameChanged=function(n){for(var u=n.target,i=n.detail[0],t=0;t<i.length;t++)if(i[t]==="calculatedUIName"||i[t]==="calculatedYomiDisplayName"){this._titleElement&&this._secondaryTitleElement&&this._setTitleTextsForPerson(r[this._page],u);break}};n.CpTitle.prototype._needsUpdate=function(n,i){var u=this._page,f=this._person;return!(Jx.isNonEmptyString(u)&&Jx.isObject(f)&&n.id===t.ct.id&&r[u].id===t.ct.id&&i.objectId===f.objectId&&i.isInAddressBook)};n.CpTitle.prototype.update=function(t,i,f,e){var h,o,s;h=r[t];this._needsUpdate(h,i)&&(this._clearAnimationAndEventListeners(),this._setTitleText(h,i,e),o=!Jx.isNullOrUndefined(f)&&!Jx.isNullOrUndefined(f.hasFilter)&&f.hasFilter(),s=this._titleAndChevronElement,s.tabIndex=o?0:-1,s.setAttribute("role",o?"button":"heading"),Jx.setClass(s,"hasFilter",o),Jx.setClass(this._chevronElement,"hidden",!o),o&&this._setTitleFilter(f),this._jobSet.addUIJob(this,this._addTooltips,null,n.Priority.tooltip));this._page=t};n.CpTitle.prototype._addTooltips=function(){[this._titleElement,this._secondaryTitleElement].forEach(function(n){var i=new WinJS.UI.Tooltip(n),t=this._onTooltip.bind(this,n);n.addEventListener("beforeopen",t,false)},this)};n.CpTitle.prototype._onTooltip=function(n){var t=n.winControl;t.innerHTML=n.scrollWidth>Math.ceil(n.getBoundingClientRect().width)?"<div>"+Jx.escapeHtml(n.innerText)+"<\/div>":""};n.CpTitle.prototype._setTitleText=function(n,t){this.setSecondaryTitleText("");var r="";if(n.id!=="none")switch(n.type){case i.res:r=Jx.res.getString(n.resId);break;case i.personName:case i.resWithName:r=null;this._setTitleTextsForPerson(n,t);this._hookPersonEventListener(t)}Jx.isNullOrUndefined(r)||(this._titleElement.innerText=r)};n.CpTitle.prototype._setTitleFilter=function(n){var t=this._titleAndChevronElement;this.setSecondaryTitleText(n.getCurrentFilterName());f.addPressStyling(t);this._flyoutListener=new Jx.Clicker(t,this._onFilterFlyout.bind(this,n))};n.CpTitle.prototype._onFilterFlyout=function(t){var i=this._flyout,r,u;Jx.dispose(i);i=this._flyout=new n.Flyout(t.getFilterItems());r=i.getFlyoutElement();this._setWidth(r,this._titleAndChevronElement.getBoundingClientRect().width);Jx.addClass(r,"whatsNewFilter");u=this._afterFlyoutClosed.bind(this,t,t.getCurrentFilterName(),this._page);i.show(this._titleAndChevronElement,"bottom","left",u)};n.CpTitle.prototype._afterFlyoutClosed=function(t,i,r){var e=t.getCurrentFilterName(),s,h;if(i!==e&&this._page===r){var o=this._element,f=this._secondaryTitleElement,u=f.cloneNode(true);this._setText(u,e);u.style.opacity="0";o.appendChild(u);s=n.Animation.exitContent(f);h=n.Animation.enterContent(u);this._animation=WinJS.Promise.join([s,h]);this._animation.done(function(){o.removeChild(f);this._secondaryTitleElement=u;u.style.opacity="1";this._animation=null}.bind(this))}};n.CpTitle.prototype._setWidth=function(n,t){n.style.width=String(t)+"px"};n.CpTitle.prototype._setTitleTextsForPerson=function(n,t){var r="",u=n.type;u===i.personName?(r=t.calculatedUIName,this.setSecondaryTitleText(t.calculatedYomiDisplayName)):u===i.resWithName&&(r=Jx.res.loadCompoundString(n.resId,t.calculatedUIName));this._titleElement.innerText=r};n.CpTitle.prototype.setSecondaryTitleText=function(n){Jx.isNullOrUndefined(n)||this._setText(this._secondaryTitleElement,n)};n.CpTitle.prototype._setText=function(n,t){n.innerText=t;n.setAttribute("aria-label",t)}})