Jx.delayDefine(People,"CpAppBar",function(){function i(n){return n&&(Jx.isNonEmptyString(n)&&(n=document.getElementById(n)),n&&!n.show&&(n=n.winControl)),n&&n.show?n:null}function r(n){return"idCmdBtn_"+n}function u(n,t){n.label=t.getLabel()}function f(n,t){n.tooltip=t.getTooltip()}function h(n,t){n.icon=t.iconSymbol}function c(n,t){n.disabled=!t.enabled}function l(n,t){n.selected=t.selected}function a(n,t){n.flyout=t.flyout}function e(n,t){v(n.element,t.visible)}function v(n,t){n&&Jx.setClass(n,"hidden",!t)}function o(n,t){var u="",i=parseInt(t.number),r,f,e;i>0&&i<100?u=String(i):i>99&&(u="99+");r=n.element;f=r.querySelector(".win-commandimage");e=t.iconSymbol;i>0?(Jx.addClass(r,"show-number-on-commandimage"),f.innerHTML='<div class="commandimage-uppernumber">'+u+'<\/div><div class="commandimage-lower">'+e+"<\/div>"):(Jx.removeClass(r,"show-number-on-commandimage"),f.innerText=e)}var n=window.People,s=Microsoft.WindowsLive.Instrumentation.Ids,t;n.CpAppBar=function(t,i){Jx.log.info("People.CpAppBar");this._name="People.CpAppBar";this.initComponent();this._appCommands=new n.AppCommands;this._jobSet=t;this._host=i;this._sasCommand=null;this._needBeforeShowHandler=false};Jx.augment(n.CpAppBar,Jx.Component);n.CpAppBar.prototype._afterHideHandler=null;n.CpAppBar.globalCommandLength=1;n.CpAppBar.prototype._beforeShowHandler=null;n.CpAppBar.prototype._winappbar=null;n.CpAppBar.prototype.deactivateUI=function(){Jx.Component.prototype.deactivateUI.call(this)};n.CpAppBar.prototype.getWinappbar=function(){return this._winappbar};n.CpAppBar.prototype.activateUI=function(){Jx.log.info("People.CpAppBar.activateUI");Jx.Component.prototype.activateUI.call(this)};n.CpAppBar.prototype._createAppBar=function(){var n=document.createElement("div"),t;n.id="AppBarID";Jx.addClass(n,"win-ui-dark");document.body.appendChild(n);t=new WinJS.UI.AppBar(n,{commands:[]});this._winappbar=t;this._afterHideHandler=this._updateCommandsAfterHide.bind(this);this._beforeShowHandler=this._updateCommandsBeforeShow.bind(this);this._addSasButton()};n.CpAppBar.prototype._sasButtonHandler=function(){this.updateCommand({commandId:"cmdid_sas",visible:SasManager&&SasManager.showInAppBar()})};n.CpAppBar.prototype._addSasButton=function(){var t=this._sasCommand=new n.Command("cmdid_sas","",null,"",true,true,null,Jx.fnEmpty);this._appCommands.insertCommand(t,0);t.setIsLocked(true);this._host.getLayout().addLayoutChangedEventListener(this._sasButtonHandler,this)};n.CpAppBar.prototype._initSasButton=function(){SasManager.init(Jx.res.getString("/strings/peopleAppName"),"idCmdBtn_cmdid_sas",this._host.getPlatform());this._sasButtonHandler(this._host.getLayout().getLayoutState())};n.CpAppBar.prototype.getUI=function(n){n.html=""};n.CpAppBar.prototype._resetBeforeShowHandler=function(){this._needBeforeShowHandler&&(this._winappbar.removeEventListener("beforeshow",this._beforeShowHandler),this._needBeforeShowHandler=false)};n.CpAppBar.prototype.reset=function(){this._appCommands.reset();this._winappbar&&(this._resetBeforeShowHandler(),this.hide())};n.CpAppBar.prototype.load=function(t){if(!this._winappbar)if(t)this._createAppBar();else{this._jobSet.addUIJob(this,this.refresh,null,n.Priority.appbar);return}this._winappbar.sticky=t;this._updateCommands()};n.CpAppBar.prototype._updateCommands=function(){this._winappbar.hidden?this._updateCommandsAfterHide():(this._winappbar.addEventListener("afterhide",this._afterHideHandler),this.hide())};n.CpAppBar.prototype._updateCommandsAfterHide=function(){this._setCommands();this._enableOrDisableAppbar();this._initSasButton();this._winappbar.sticky&&this._havePageCommands()&&this._winappbar.show();this._winappbar.removeEventListener("afterhide",this._afterHideHandler)};n.CpAppBar.prototype.refresh=function(){this._winappbar||this._createAppBar();this._updateCommands()};n.CpAppBar.prototype._enableOrDisableAppbar=function(){this._winappbar.disabled=this._shouldKeepHidden()};n.CpAppBar.prototype._shouldKeepHidden=function(){var n=this._appCommands.getCommandsLength();return n===1?this._sasCommand!==null&&this._appCommands.getCommandByIndex(0).commandId===this._sasCommand.commandId:n===0};n.CpAppBar.prototype._havePageCommands=function(){return this._appCommands.getCommandsLength()>n.CpAppBar.globalCommandLength?true:false};n.CpAppBar.prototype.addCommand=function(n){this._appCommands.addCommand(n)};n.CpAppBar.prototype.removeCommand=function(n){this._appCommands.removeCommand(n)};n.CpAppBar.prototype.insertCommand=function(n,t){return this._appCommands.insertCommand(n,t)};n.CpAppBar.prototype.insertCommandBeforeLast=function(n){var t=this._appCommands,i=t.getCommandsLength()-1;return t.insertCommand(n,i<0?0:i)};n.CpAppBar.prototype._setCommands=function(){var f;this._resetBeforeShowHandler();for(var s=[],t,u=this._appCommands,h=u.getCommandsLength(),i=0;i<h;i++)t=u.getCommandByIndex(i),t&&s.push({id:r(t.commandId),label:t.getLabel(),section:t.section,icon:t.iconSymbol,type:t.type===n.Command.Types.customFlyout?n.Command.Types.button:t.type,onclick:this._onClick.bind(this,t),tooltip:t.getTooltip(),disabled:!t.enabled,selected:t.selected,flyout:t.flyout});for(this._winappbar.commands=s,i=0;i<h;i++)t=u.getCommandByIndex(i),Jx.isObject(t)&&(t.useCustomLayout||!t.visible)&&(f=this._getCommandOnAppBar(t.commandId),t.visible?t.useCustomLayout&&o(f,t):e(f,t)),!this._needBeforeShowHandler&&Jx.isObject(t)&&Jx.isFunction(t.beforeShowUpdate)&&(this._needBeforeShowHandler=true);this._needBeforeShowHandler&&this._winappbar.addEventListener("beforeshow",this._beforeShowHandler);this._hostLoc=this._host.getLocation()};n.CpAppBar.prototype._updateCommandsBeforeShow=function(){var i,r,n,t;if(this._needBeforeShowHandler)for(i=this._appCommands,r=i.getCommandsLength(),n=0;n<r;n++)t=i.getCommandByIndex(n),Jx.isObject(t)&&Jx.isFunction(t.beforeShowUpdate)&&t.beforeShowUpdate()};n.CpAppBar.prototype._onClick=function(t){var f,r;if(t.enabled)if(t.isLocked||!t.isLocked&&this._host.isSameAsCurrentLocation(this._hostLoc)){if(f=null,r=this._getCommandOnAppBar(t.commandId),t.type===n.Command.Types.toggle&&(t.selected=r.selected),t.onInvoke)try{r.element&&(f=t.onInvoke.call(t.context,t.commandId,r.element,this),Jx.log.info("Command + "+t.commandId+" invoked"))}catch(h){Jx.log.exception("Invoking command "+t.commandId+" failed.",h)}else t.link&&n.Nav.navigate(t.link);if(!this._winappbar.sticky){var e=n.Command.Types,o=t.type,u=o===e.flyout?i(t.flyout):null;u===null&&(u=i(f));u?u.addEventListener("afterhide",this.hide.bind(this)):o!==e.customFlyout&&this.hide()}t.biciIndex!==-1&&Jx.bici.addToStream(s.People.socialReactionUpdated,"",0,0,t.biciIndex)}else Jx.log.error("Invoking command "+t.commandId+" failed. Current location is "+JSON.stringify(this._host.getLocation())+". Expected location is "+JSON.stringify(this._hostLoc))};n.CpAppBar.prototype.hideAppBar=function(){this._winappbar&&this._winappbar.hide()};n.CpAppBar.prototype.hide=function(){this.hideAppBar();this._host.hideNavBar()};n.CpAppBar.prototype.show=function(){this._winappbar&&this._winappbar.show()};t={iconSymbol:h,name:u,formattedName:u,tooltip:f,formattedTooltip:f,enabled:c,visible:e,number:o,selected:l,flyout:a};n.CpAppBar.prototype.updateCommand=function(i){var r,u,f,e;Jx.log.info("People.CpAppBar.updateCommand: "+i.commandId);r=this._appCommands.updateCommand(i);u=r.props;u.length>0&&(f=r.command,this._winappbar&&(e=this._getCommandOnAppBar(f.commandId),e&&u.forEach(function(n){n in t&&t[n].call(window,e,f)})))};n.CpAppBar.prototype._getCommandOnAppBar=function(n){return this._winappbar.getCommandById(r(n))};n.CpAppBar.prototype.updateCommandName=function(n,t,i){Jx.log.info("People.CpAppBar.updateCommandName: updating commandId="+n);this.updateCommand({commandId:n,name:t,formattedName:i})};n.CpAppBar.prototype.updateCommandIcon=function(n,t){Jx.log.info("People.CpAppBar.updateCommandIcon: updating commandId="+n);this.updateCommand({commandId:n,iconSymbol:t})};n.CpAppBar.prototype.updateNumberOnButton=function(n,t){Jx.log.info("People.CpAppBar.updateNumberOnButton: updating commandId="+n+",number="+t);Jx.isNumber(t)||(t=parseInt(t));this.updateCommand({commandId:n,number:t})};n.CpAppBar.prototype.showCommand=function(n){Jx.log.info("P.CpAppBar.showCommand: "+n);this.updateCommand({commandId:n,visible:true})};n.CpAppBar.prototype.hideCommand=function(n){Jx.log.info("P.CpAppBar.hideCommand: "+n);this.updateCommand({commandId:n,visible:false})}})