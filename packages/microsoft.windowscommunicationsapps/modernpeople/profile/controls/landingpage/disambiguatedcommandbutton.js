Jx.delayDefine(People,"DisambiguatedCommandButton",function(){function r(n,i){return t.Sequence.find(i,function(t){return t.data===n})}var t=window.People,i=t.Animation,u=Microsoft.WindowsLive.Instrumentation.Ids,n=t.DisambiguatedCommandButton=function(n,t,i,r,u,f){this._id=n;this._title=t;this._icon=i;this._settingsContainer=r;this._settingsKey=u;this._jobSet=f;this._value=null;this._alternatives=null;this._element=null;this._disambiguatorElement=null;this._valueElement=null;this._titleElement=null};n.prototype.updateValues=function(n,t){this._alternatives=t=t.filter(function(n){return Jx.isObject(n)&&Jx.isNonEmptyString(n.display)&&Jx.isNonEmptyString(n.data)});var i=n?n.data:null;this._value=(this._value?r(this._value.data,t):null)||this.getMRUValue(t)||r(i,t)||t[0];this._element&&(this._value&&this._updateUI(),this._hideShow())};n.prototype.getMRUValue=function(n){var t=null;return this._settingsKey&&this._settingsContainer&&(t=r(this._settingsContainer.get(this._settingsKey),n)),t};n.prototype.getUI=function(){var n=Jx.escapeHtml(this._getTitle()),t=Jx.escapeHtml(this._getDisplayValue()),i=n+" "+t;return"<div id='"+this._id+"' class='contactCommand' tabIndex='-1' role='link' aria-label='"+i+"'><div class='contactCommand-content'><div><div class='contactCommand-icon'>"+this._icon+"<\/div><\/div><div class='contactCommand-body'><div class='contactCommand-title'>"+n+"<\/div><div class='contactCommand-value'>"+t+"<\/div><\/div><\/div><div class='contactCommand-disambiguator' style='display:none' role='button' aria-haspopup='true' aria-label='"+Jx.escapeHtml(Jx.res.getString("/landingPage/disambiguatedCommandButton"))+"'><\/div><\/div>"};n.prototype.activateUI=function(n){var r=this._element=n.querySelector("#"+this._id),u;r.addEventListener("click",this._onClick.bind(this),false);r.addEventListener("keydown",this._onKeydown.bind(this),false);i.addPressStyling(r);i.addPressStyling(r.querySelector(".contactCommand-content"));u=this._disambiguatorElement=r.querySelector(".contactCommand-disambiguator");u.addEventListener("click",this._onDisambiguate.bind(this),false);i.addPressStyling(u);this._valueElement=r.querySelector(".contactCommand-value");this._titleElement=r.querySelector(".contactCommand-title");this._hideShow();this._jobSet&&this._jobSet.addUIJob(this,this._updateTooltip,null,t.Priority.accessibility)};n.prototype._getTitle=function(){var n=this._value;return Boolean(n)&&Jx.isNonEmptyString(n.title)?n.title:this._title};n.prototype._updateUI=function(){var i=this._value,n=this._getDisplayValue();this._valueElement.innerText=n;this._title||(this._titleElement.innerText=i.title,this._jobSet&&this._jobSet.addUIJob(this,this._updateTooltip,null,t.Priority.accessibility));this._element.setAttribute("aria-label",this._getTitle()+" "+n)};n.prototype._updateTooltip=function(){var n=this._titleElement;this._element.title=n.scrollWidth>n.clientWidth?n.innerText:""};n.prototype._getDisplayValue=function(){if(this._value){var n=this._value.shortDisplay,t=this._value.display;return n||t}return""};n.prototype._hideShow=function(){this._value?(this._element.style.display="",this._disambiguatorElement.style.display=this._alternatives.length<=1?"none":""):this._element.style.display="none"};n.prototype._onClick=function(){var n=this._value,i=n.data,r;this._settingsKey&&this._settingsContainer&&this._settingsContainer.set(this._settingsKey,i);r=n.getUrl?n.getUrl(i):i;People.Nav.navigate(r);Jx.isDefined(n.bici)&&Jx.bici.addToStream(u.People.socialReactionUpdated,"",t.Bici.landingPage,0,n.bici)};n.prototype._onDisambiguate=function(n){var i=new Windows.UI.Popups.PopupMenu,t;this._alternatives.forEach(function(n){var t=new Windows.UI.Popups.UICommand(n.display,this._onDisambiguationSelected.bind(this,n));try{i.commands.append(t)}catch(r){}},this);Jx.addClass(this._element,"contactCommand-menuOpen");t=this._disambiguatorElement.getBoundingClientRect();try{i.showForSelectionAsync({x:t.left,y:t.top,width:t.width,height:t.height},Windows.UI.Popups.Placement.below).done(this._onMenuClosed.bind(this),Jx.fnEmpty)}catch(r){Jx.log.exception("Failed to show menu",r)}n.stopPropagation()};n.prototype._onMenuClosed=function(){Jx.removeClass(this._element,"contactCommand-menuOpen")};n.prototype._onDisambiguationSelected=function(n){this._value=n;this._updateUI();this._onClick()};n.prototype._onKeydown=function(n){(n.key==="Spacebar"||n.key==="Enter")&&(this._disambiguatorElement.style.display!=="none"?this._disambiguatorElement.click():this._onClick())}})