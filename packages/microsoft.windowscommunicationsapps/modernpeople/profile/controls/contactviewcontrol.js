Jx.delayDefine(People.Controls,"ContactViewControl",function(){function i(n,t){return function(){try{return t.apply(this,arguments)}finally{}}}function o(t){var u,i,e,o,h,s,c,f;$include("$(cssResources)/controls-people.css");u=this._person=t.data;i=this._hostDiv=t.element;e=this._host;this._cachedWidth=0;this._jobSet=e.getJobSet().createChild();o=this._layout=e.getLayout();this._layoutChangedHandler=this._resizeContent;o.addLayoutChangedEventListener(this._layoutChangedHandler,this);o.addOrientationChangedEventListener(this._layoutChangedHandler,this);this._shareCallback=n.ShareSource.sharePersonCallback.bind(this,u);h=Jx.app;h.addListener("sharesourcedatarequested",this._shareCallback);s=this._ic=new n.IdentityControl(u,this._jobSet,{interactive:false});c=s.getUI(n.IdentityElements.TileLayout,{primaryContent:null,secondaryContent:{element:n.IdentityElements.Networks,className:"profileView-icNetworks"}});i.innerHTML="<div id='contactViewContainer' class='profileBase-container' aria-label='"+Jx.escapeHtml(Jx.res.getString("/strings/profileDetailPageAriaLabel"))+"'><div class='profile-icContainer'>"+c+"<\/div><div id='contactViewControl'><\/div><div id='contactViewPadding' class='profileBase-paddingDiv' aria-disabled='true'><\/div><\/div>";f=t.context;this._jobSet.addUIJob(this,function(){this._loadContent(i.querySelector("#contactViewControl"),u,f);s.activateUI(i);t.mode==="hydrate"&&f&&r.setScrollPosition(i,f)},null,n.Priority.next);this._augmentAction=null}function s(){return r.getScrollPosition(this._hostDiv)}function h(t,i,r){var f,e;this._pendingUpdate=false;f=this._binder=new n.PlatformObjectBinder(i);this._accessor=f.createAccessor(this._updateForm.bind(this,t));this._loadForm(t);e=this._host;this._jobSet.addUIJob(this,n.ContactCommands.addCommands.bind(n.ContactCommands,e,f),null,n.Priority.appbar);Boolean(r)||(Jx.bici.increment(u.People.profileDetailsView,1),i.isFavorite?Jx.bici.increment(u.People.profileDetailsViewFavorite,1):Jx.bici.increment(u.People.profileDetailsViewNonFavorite,1));Jx.mark("People.ContactViewControl._loadContent:prfvTrackStartup_end,Info,People,Profile");Jx.ptStop("People-ProfileLoad")}function c(){var t,n;return this._shareCallback&&(t=Jx.app,t.removeListener("sharesourcedatarequested",this._shareCallback),this._shareCallback=null),this._layoutChangedHandler&&(this._layout.removeLayoutChangedEventListener(this._layoutChangedHandler,this),this._layout.removeOrientationChangedEventListener(this._layoutChangedHandler,this),this._layoutChangedHandler=null),n=this._jobSet,n&&n.cancelAllChildJobs(),this._disposeAugmentAction(),true}function l(){Jx.dispose(this._binder);this._binder=null;this._accessor=null;this._ic&&(this._ic.shutdownUI(),this._ic=null);Jx.dispose(this._jobSet);this._jobSet=null;this._person=null;this._hostDiv.innerHTML=""}var n=window.People,f=n.Controls,a=n.Nav,v=n.Layout,r=f.ContactControlPosition,u=Microsoft.WindowsLive.Instrumentation.Ids,e,t;n.enableLiveProfile=false;e=f.ContactViewControl=function(n){this._host=n};t=e.prototype;t.load=i("load",o);t.prepareSuspension=i("prepareSuspension",s);t.activate=i("activate",function(){});t._loadContent=i("loadContent",h);t._augmentPerson=function(){this._disposeAugmentAction();try{Jx.log.info("Calling augmentViaServerAsync on person: "+this._person.objectId);this._augmentAction=this._person.augmentViaServerAsync(false)}catch(n){Jx.log.exception("Error calling augmentViaServerAsync on person: "+this._person.objectId,n)}};t._disposeAugmentAction=function(){var n=this._augmentAction;n&&(n.cancel(),this._augmentAction=null)};t._resize=function(){var n=this._hostDiv;this._cachedWidth=r.update(this._layout,this._cachedWidth,n.querySelector("#contactViewControl"),n.querySelector("#contactViewPadding"))};t._resizeContent=function(){this._jobSet.addUIJob(this,this._resize,null,n.Priority.realizeItem)};t._loadForm=function(t){var i=this._accessor.linkedContacts.map(function(n){return n.createAccessor(null)}),r=n.Contact.createUniqueFields(i),u=new n.UiForm({fieldList:n.Contact.viewFieldList,groupList:n.Contact.getViewGroupList(),loc:Jx.res,cssPrefix:"profileView-",residPrefix:"/strings/profile_"});u.createViewForm(t,i,r);this._resizeContent();this._augmentPerson()};t._updateForm=function(t){this._pendingUpdate||(this._pendingUpdate=true,this._jobSet.addUIJob(this,function(){this._pendingUpdate=false;var n=this._hostDiv.querySelector("#contactViewContainer"),i=n.scrollLeft,r=n.scrollTop;t.innerHTML="";this._loadForm(t);n.scrollLeft=i;n.scrollTop=r},null,n.Priority.realizeItem))};t.deactivate=i("deactivate",c);t.unload=i("unload",l)})