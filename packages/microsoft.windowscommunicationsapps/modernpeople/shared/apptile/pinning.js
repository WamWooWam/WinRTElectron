Jx.delayDefine(People,"Pinning",function(){function i(n){return JSON.parse(n||"{}")}function r(t){var i=Object.keys(t).map(n.Sequence.value,t).join("_").replace(/[\n\t\";,:!<>\/\\\*\? ]/g,""),r;return i.length>64&&(r=(new Windows.Security.ExchangeActiveSyncProvisioning.EasClientDeviceInformation).id,i="P_"+r.replace(/-/g,"")+"_"+Date.now().toString(16)),i}function u(n,t,i){try{return n.apply(t,i)}catch(r){return Jx.log.error(r),WinJS.Promise.wrapError(r)}}function f(t,f,e,o,s,h,c){var a=Jx.isNonEmptyString(s)?s:f.tileId,w=i(a),v=Jx.isNonEmptyString(o)?o:r(w),l,d,y,p;if(!Jx.isNonEmptyString(v)||!Jx.isNonEmptyString(a))return WinJS.Promise.wrapError(new Error("Could not create tile id or arguments"));if(l=new Windows.UI.StartScreen.SecondaryTile(v),e){var b=Microsoft.WindowsLive.Platform,g=f.getUserTile(b.UserTileSize.extraLarge,false),nt=w.type!==b.TileIdType.easTileId&&w.type!==b.TileIdType.localContactId,k=g.appdataURI;Jx.isNonEmptyString(k)||(k="ms-appx:///ModernPeople/Images/Default_User_Tile_270.png");l.displayName=f.calculatedUIName;l.shortName=f.calculatedUIName;l.phoneticName=f.calculatedYomiDisplayName;l.arguments=a;d=Windows.UI.StartScreen;l.foregroundText=d.ForegroundText.light;l.roamingEnabled=nt;l.visualElements.showNameOnSquare150x150Logo=true;l.visualElements.showNameOnWide310x150Logo=true;l.visualElements.showNameOnSquare310x310Logo=true;y=new Windows.Foundation.Uri(k);l.visualElements.wide310x150Logo=y;l.visualElements.square70x70Logo=y;l.visualElements.square150x150Logo=y;l.visualElements.square310x310Logo=y}return p=(e?"":"un")+"pinning",u(h,l,c).then(function(i){if(Jx.log.info(p+" person, "+f.objectId+" succeeded.  User confirmed: "+i),i&&(e?f.setStartScreenTileId(v,a):f.setStartScreenTileId(null,null),t.runResourceVerbAsync(t.accountManager.defaultAccount,"peopleTile",t.createVerb("RegisterChannels",e?JSON.stringify({tileId:v,arguments:a}):"")),e)){var r=Windows.UI.Notifications.TileUpdateManager.createTileUpdaterForSecondaryTile(v);r.enableNotificationQueue(true);Jx.bici.addToStream(Microsoft.WindowsLive.Instrumentation.Ids.People.socialReactionUpdated,"",n.Bici.landingPage,0,n.Bici.pinContact)}return i},function(){Jx.log.error(p+" person, "+f.objectId+" failed")})}function e(n,t,i){var u="PINERROR_"+t.tileId,r=function(){i.removeMessage(u);document.removeEventListener("msvisibilitychange",f,false)},f=function(){document.msVisibilityState!=="visible"&&r()},e=Microsoft.WindowsLive.Platform,o=n.accountManager.defaultAccount,s=o.getResourceByType(e.ResourceType.contacts);o.lastAuthResult===e.Result.defaultAccountDoesNotExist||s&&s.isInitialSyncFinished?i.addErrorMessage(u,2,{messageText:Jx.res.loadCompoundString("/strings/brokenTileErrorMessage",t.displayName),button1:{text:Jx.res.getString("/meStrings/picCtrl_cmdDelete"),tooltip:Jx.res.getString("/meStrings/picCtrl_cmdDelete"),callback:function(){t.requestDeleteAsync().done(function(n){n&&r()})}},button2:{text:Jx.res.getString("/accountsStrings/actdlgCancel"),tooltip:Jx.res.getString("/accountsStrings/actdlgCancel"),callback:r},cssClass:"ab-messageBar"}):i.addErrorMessage(u,2,{messageText:Jx.res.getString("/strings/incompleteSyncTileErrorMessage"),button2:{text:Jx.res.getString("/accountsStrings/actdlgClose"),tooltip:Jx.res.getString("/accountsStrings/actdlgClose"),callback:r},cssClass:"ab-messageBar"});document.addEventListener("msvisibilitychange",f,false)}var n=window.People,t=n.Pinning={};t.pinPersonAsync=function(n,t,i,r,u,e){var o=Windows.UI.StartScreen.SecondaryTile.prototype,s=i?o.requestCreateAsync:o.requestDeleteAsync;return f(n,t,i,r,u,s,e)};t.isPersonPinnedAsync=function(n,t){var i=n.peopleManager;return Windows.UI.StartScreen.SecondaryTile.findAllAsync().then(function(n){var r="",u="",f=n.some(function(n){var f=i.tryLoadPersonByTileId(n.arguments);return Jx.isNullOrUndefined(f)||f.objectId!==t.objectId?false:(r=n.tileId,u=n.arguments,true)});return{isPinned:f,tileId:r,launchArguments:u}})};t.tileLaunchError=function(t,i){Windows.UI.StartScreen.SecondaryTile.findAllAsync().then(function(r){var u=n.Sequence.find(r,function(n){return n.tileId===i}),f=Jx.root;f&&u&&e(t,u,f.getMessageBar())})}})