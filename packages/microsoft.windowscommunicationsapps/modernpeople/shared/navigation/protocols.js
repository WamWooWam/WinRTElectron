Jx.delayDefine(People,"Protocol",function(){function o(n){for(var r,t=0;t<i.length;t++)if(r=i[t],r.name===n)return r;return null}function u(n){for(var r,t=0;t<i.length;t++)if(r=i[t],r.sourceId===n)return r;return null}function s(n){var t,r;if(Jx.isDefined(n))for(t=0;t<i.length;t++)if(r=i[t],r.imType===n)return r;return null}function h(n){for(var r,t=0;t<i.length;t++)if(r=i[t],r.postName===n)return r;return null}function e(n){return n=n.replace(/[\ud800-\udfff]/g,""),encodeURIComponent(n).replace(/%(40|2B|3A)/gi,decodeURIComponent)}function c(n){return decodeURIComponent(n)}var n=People,f=Microsoft.WindowsLive.Platform.ContactIMType,r={profile:{identifier:"identifier",service:"required"},message:{identifier:"identifier",service:"required"},audiocall:{identifier:"identifier",service:"required"},videocall:{identifier:"identifier",service:"required"},tel:{identifier:"phoneNumber",service:"illegal"},sms:{identifier:"phoneNumber",service:"illegal"},mailto:{identifier:"email",service:"illegal"}},i=[{name:"messenger",sourceId:"WL",imType:f.windowsLive,mriFormat:"1:{0}",identifier:"windowsLiveEmailAddress"},{name:"outlook-com",sourceId:"ABCH"},{name:"skype-com",sourceId:"SKYPE",mriFormat:"8:{0}"},{name:"facebook-com",sourceId:"FB",mriFormat:"13:{0};via=14:FB",postName:"facebook.com"},{name:"twitter-com",sourceId:"TWITR",mriFormat:"13:{0};via=14:TWITR",postName:"twitter.com"},{name:"google-com",sourceId:"GOOG"},{name:"weibo-com",sourceId:"SINWE"},{name:"linkedin-com",sourceId:"LI"},{name:"yahoo-com",sourceId:"YAHOO",imType:f.yahoo,mriFormat:"32:{0}",identifier:"yahooEmailAddress"},{name:"lync-com",sourceId:"LYNC",imType:f.office,mriFormat:"2:{0}",identifier:"federatedEmailAddress"}],t;n.Protocol=function(){this.verb="";this.contact={sourceId:"",identifier:"",email:"",phoneNumber:""}};n.Protocol.prototype={isValid:function(){return this!==t},toUrl:function(){var f,t,n,i;return this.isValid()?(f=[this.verb],t=r[this.verb],t.service!=="illegal"&&(n=null,Jx.isNonEmptyString(this.contact.sourceId)&&(n=u(this.contact.sourceId),n?f.push(n.name):Jx.log.warning("Unsupported sourceId ignored: "+this.contact.sourceId)),t.service==="required"&&!n))?(Jx.log.warning("No service provided when creating service-required verb"),""):(this.contact.phoneNumber&&(this.contact.phoneNumber=this.contact.phoneNumber.replace(/[\s-.()]/g,"")),i=this.contact[t.identifier],!i)?(Jx.log.error("No contact identifier provided for verb"),""):f.join("-")+":"+(this.contact.sourceId==="FB"?"?serviceUserId="+e(i)+"&displayName="+e(this.contact.calculatedUIName):e(i)):""},toMri:function(){var n,t,i;return this.isValid()&&(n=u(this.contact.sourceId),n&&(t=n.mriFormat,t))?(i=this.contact.identifier,t.replace("{0}",function(){return i})):""},toPerson:function(n){var t=u(this.contact.sourceId),i;return t?t.identifier?(i=this.toMri(),n.peopleManager.tryLoadPersonByMri(i)):n.peopleManager.tryLoadPersonBySourceIDAndObjectID(this.contact.sourceId,this.contact.identifier):(Jx.log.warning("Unsupported sourceId ignored: "+this.contact.sourceId),null)}};n.Protocol.create=function(t,i){var r=new n.Protocol;return r.verb=t,r.contact.sourceId=i.sourceId||"",r.contact.identifier=i.identifier||"",r.contact.email=i.email||"",r.contact.phoneNumber=i.phoneNumber||"",r};n.Protocol.createFromContact=function(i,r){var f=new n.Protocol,e;f.verb=i;try{e=s(r.imType)||u(r.account.sourceId);e?(f.contact.sourceId=e.sourceId,f.contact.identifier=r[e.identifier||"thirdPartyObjectId"],f.contact.calculatedUIName=r.calculatedUIName):Jx.log.warning("Unsupported service ignored")}catch(o){return Jx.log.exception("Error getting contact information",o),t}return f};n.Protocol.createFromPostInfo=function(t,i){var r=new n.Protocol,u=h(t);return u?(r.contact.sourceId=u.sourceId,r.contact.identifier=i):Jx.log.warning("Unsupported service ignored"),r};n.Protocol.fromUri=function(i){var u,h,f,s;if(Jx.log.pii("Processing uri: "+i.rawUri),u=new n.Protocol,h=i.schemeName,Jx.isNonEmptyString(i.userName)||Jx.isNonEmptyString(i.password)||Jx.isNonEmptyString(i.port))return Jx.log.error("Illegal field specified in uri"),t;var l=h.split("-"),e=l.shift().toLowerCase(),a=l.join("-").toLowerCase();if(Object.keys(r).indexOf(e)===-1)return Jx.log.error("Unrecognized verb"),t;if(u.verb=e,f=r[e],a===""){if(f.service==="required")return Jx.log.error("Service not specified for service-required verb"),t}else{if(f.service==="illegal")return Jx.log.error("Service specified for unsupported verb"),t;if(s=o(a),!s)return Jx.log.error("Unrecognized service"),t;u.contact.sourceId=s.sourceId}return i.path===""||i.path==="/"?(Jx.log.error("No identifier specified"),t):(u.contact[f.identifier]=c(i.path),u)};t=new n.Protocol;t.verb="invalid"})