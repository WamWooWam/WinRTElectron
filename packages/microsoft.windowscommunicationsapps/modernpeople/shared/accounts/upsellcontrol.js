Jx.delayDefine(People.Accounts,"UpsellControl",function(){var r=window.People,t=r.Accounts,u=Microsoft.WindowsLive.Platform,n=t.UpsellControl=function(n,i,r,u,f){this._platform=n;this._scenario=i;this._settings=r;this._upsell=null;this._stringIds=u;this._options=f||{};this._phase1Ctor=f.phase1Ctor||t.Phase1Upsell;this._phase2Ctor=f.phase2Ctor||t.Phase2Upsell;this.initComponent();this._settings.addListener("phaseChange",this._onPhaseChange,this)},i;Jx.inherit(n,Jx.Component);Object.defineProperty(n.prototype,"id",{get:function(){return this._id}});n.prototype.getUI=function(n){$include("$(cssResources)/Upsell.css");this._ensureUpsell();n.html="<div id='"+this._id+"' class='upsell-container'>"+Jx.getUI(this._upsell).html+"<\/div>"};n.prototype.activateUI=function(){this._containerElement=document.getElementById(this._id);Jx.Component.activateUI.call(this)};i=[];i[1]=function(n,t,i,r,u){var f=this._upsell=new this._phase1Ctor(i,r,n,t,u);f.isInit()||f.initComponent();f.on("upsellAvailable",this._onUpsellAvailable,this);return f};i[2]=function(n,t,i,r){var u=new this._phase2Ctor(n,t,i,r);return u.isInit()||u.initComponent(),u};n.prototype._onUpsellAvailable=function(){this.fire("upsellAvailable",null,null)};n.prototype._ensureUpsell=function(){var n=this._upsell===null,t=n&&this._settings.shouldShow(),r;return t&&(r=i[this._settings.getPhase()],this._upsell=r.call(this,this._settings,this._stringIds,this._platform,this._scenario,this._options),this.append(this._upsell)),!n||t};n.prototype._updateUpsell=function(){Jx.isNullOrUndefined(this._upsell)||(this._upsell.deactivateUI(),this.removeChild(this._upsell),this._upsell=null);this.shouldShow()&&(Jx.isNullOrUndefined(this._containerElement)||this._upsell.initUI(this._containerElement),this._onUpsellAvailable())};n.prototype._onPhaseChange=function(n){this._updateUpsell();n.phase>=t.UpsellSettings.maxPhase&&this.fire("upsellDismissed",null,null)};n.prototype.shouldShow=function(){var n=this._upsell,t=this._settings.shouldShow()&&this._ensureUpsell()&&(!this._upsell.shouldShow||this._upsell.shouldShow());return t||n!==this._upsell&&this._upsell&&(!this._upsell.shouldShow||this._upsell.shouldShow())};n.prototype.getPhase=function(){return this._settings.getPhase()};n.prototype.render=function(){this._upsell.render&&this._upsell.render()};n.prototype.shutdownComponent=function(){Jx.dispose(this._settings);Jx.Component.prototype.shutdownComponent.call(this)}})