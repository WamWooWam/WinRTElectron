Jx.delayDefine(People.Accounts,"Phase1Upsell",function(){var i=window.People,t=i.Accounts,r=Microsoft.WindowsLive.Platform,n=t.Phase1Upsell=function(n,i,r,u,f){this._platform=n;this._scenario=i;this._settings=r;this._accountList=null;this._accountSync=null;u=u||{};this._instructionsId=u.phase1InstructionsId||"";this._dismissTextId=u.phase1DismissId||"";this._options=f=f||{};this._suppressAddMore=f.suppressAddMore;this._delayRender=!!f.delayRender;this._maxUpsellCount=f.maxUpsellCount||4;this._accountListType="accountListType"in f?f.accountListType:t.AccountListType.filteredUpsells;$include("$(cssResources)/Upsell.css");this.initComponent()};Jx.augment(n,Jx.Component);Object.defineProperty(n.prototype,"id",{get:function(){return this._id}});n.prototype.getUI=function(n){var i=this._showDismiss=Jx.isNonEmptyString(this._dismissTextId),r=i?Jx.res.getString(this._dismissTextId):"",u=this._suppressAddMore?"":Jx.res.getString("/accountsStrings/phase1addMore"),t=Jx.res.getString(this._instructionsId);n.html="<div id='"+this._id+"' class='phase1Upsell'><div class='upsell-flex'><div id='upsell_title' class='upsell-instructions' title='"+Jx.escapeHtml(t)+"'>"+t+"<\/div><div id='accounts_container' class='upsell-accounts-container' aria-label='"+Jx.escapeHtml(t)+"'>"+Jx.getUI(this._accountList).html+"<\/div><div id='upsell_more' class='upsell-more "+(this._suppressAddMore?"hidden":"")+"' tabIndex='0' role='button'><div class='upsell-moreIconContainer'><div id='upsell_moreIcon' class='upsell-moreIcon'><\/div><\/div><div id='upsell_moreText' title='"+Jx.escapeHtml(u)+"' class='upsell-moreText singleLineText'>"+u+"<\/div><\/div><\/div><div class='upsell-flexless'><div role='button' title='"+Jx.escapeHtml(r)+"' class='upsell-dismiss typeSizeNormal"+(i?"":" hidden")+"' tabIndex='0' />"+r+"<\/div><\/div><\/div>"};n.prototype.activateUI=function(){var r=document.getElementById(this._id),n,t;this._suppressAddMore||(n=r.querySelector(".upsell-more"),n.addEventListener("click",this._onAddMoreAccounts.bind(this),false),n.addEventListener("keydown",this._onKeyDown.bind(this),false),i.Animation.addPressStyling(n));this._showDismiss&&(t=r.querySelector(".upsell-dismiss"),t.addEventListener("click",this._onDismiss.bind(this),false),t.addEventListener("keydown",this._onDismissKeyDown.bind(this),false));Jx.Component.prototype.activateUI.call(this)};n.prototype.shouldShow=function(){var i=true,n;return this._accountList===null&&(this._onAccountClick=this._onAccountClick.bind(this),this._accountList=new t.AccountListControl(this._accountListType,this._platform,this._scenario,"canvas",{delayRender:this._delayRender,maxCount:this._maxUpsellCount,largeIcons:true,supportsContextMenus:false,getAssetText:this._options.getAssetText,onPrimaryAction:this._onAccountClick}),this.append(this._accountList)),this._getUpsellCount()<=0&&(i=false,Jx.isNullOrUndefined(this._accountSync)&&(n=this._accountSync=new t.AccountSynchronization(this._platform),n.areAccountsAvailable()?(this._incrementPhase(),this._disposeAccountSync()):(this._onAccountsAvailableHandler=this._onAccountsAvailable,n.addListener("accountsAvailable",this._onAccountsAvailableHandler,this)))),i};n.prototype.render=function(){this._accountList.render()};n.prototype._getUpsellCount=function(){return this._accountList.getCount()};n.prototype._onAccountsAvailable=function(){this._getUpsellCount()>0?(this.fire("upsellAvailable",null,null),this._disposeAccountSync()):this._incrementPhase()};n.prototype._onAccountClick=function(){return this._incrementPhase(),true};n.prototype._onAddMoreAccounts=function(){t.showAccountSettingsPage(this._platform,this._scenario,t.AccountSettingsPage.upsells,{launchedFromApp:true});this._incrementPhase()};n.prototype._onKeyDown=function(n){(n.key==="Spacebar"||n.key==="Enter")&&(this._onAddMoreAccounts(),n.preventDefault())};n.prototype._onDismiss=function(){var n=this._settings;n&&n.markDismissed()};n.prototype._onDismissKeyDown=function(n){(n.key==="Spacebar"||n.key==="Enter")&&(this._onDismiss(),n.preventDefault())};n.prototype._disposeAccountSync=function(){Jx.isFunction(this._onAccountsAvailableHandler)&&(this._accountSync.removeListener("accountsAvailable",this._onAccountsAvailableHandler,this),this._onAccountsAvailableHandler=null);Jx.dispose(this._accountSync);this._accountSync=null};n.prototype.deactivateUI=function(){this._disposeAccountSync();Jx.Component.prototype.deactivateUI.call(this)};n.prototype._incrementPhase=function(){var n=this._settings;n&&n.incrementPhase()}})