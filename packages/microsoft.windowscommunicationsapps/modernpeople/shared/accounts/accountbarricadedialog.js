Jx.delayDefine(People.Accounts,"AccountBarricadeDialog",function(){function n(n){return Jx.res.getString("/accountsStrings/"+n)}function h(n,t){return Jx.res.loadCompoundString("/accountsStrings/"+n,t)}var r=window.People,s=window.People.Accounts,t=Microsoft.WindowsLive.Platform,u=s.AccountBarricadeDialog=function(n,t){this._account=n;this._onCanceled=t;this._dialog=null},i,f,e,o;u.prototype.showChooseAccountTypeDialog=function(t){var u=new i(this._account),f=this._createDialog(u),e=function(){t.call(null,u.accountType)};u.addButton=this._addActionButton("idBarDlgAddButton","actdlgAdd",e,"submit");f.buttons.push(new r.CloseButton("idBarDlgCancelButton",n("actdlgCancel"),f));f.show(true)&&(u.addButton.disabled="disabled")};u.prototype.showIsEasDialog=function(n,t){var i=this._createDialog(new e(this._account)),r=this._addActionButton("idBarDlgYesButton","barDlgYesButton",n,"submit");this._addActionButton("idBarDlgNoButton","barDlgNoButton",t);r.autofocus=true;i.show(true)};u.prototype.showPopNotSupportedDialog=function(i,u){var o=this._createDialog(new f),s,e;o.buttons.push(new r.CloseButton("idBarDlgCancelButton",n("actdlgCancel"),o));o.show(true);s="";Jx.isNonEmptyString(u)&&(e=u.split("@"),e.length>1&&(e.shift(),s=e.join("")));Jx.bici.addToStream(Microsoft.WindowsLive.Instrumentation.Ids.Platform.accountDialogOverall,"POP",s,r.Bici.SyncProtocol.pop,t.Result.cannotCreatePopAccounts,r.Bici.ConfigSource.pop,i)};u.prototype.showGmailDowngradeDialog=function(i){var u=this._account,a=u.sourceId==="EXCH"?"GOOG":u.sourceId,f=i.accountManager.getAccountBySourceId(a,"")||u,h,c,l=f.color.toString(16);f.color!==0&&l!=="ffffffff"&&(h="#"+l,c="White");var v={headerColor:h,headerIcon:f.iconMediumUrl||u.iconMediumUrl,titleColor:c},y=u.emailAddress,e=this._createDialog(new o(u),n("barDlgGmailDowngradeDlgTitle"),v),p=function(){var n,r,f,e,o;if(u.canDelete){if(n=i.accountManager.getAccountBySourceId("GOOG",""),n&&n.accountType!==t.AccountType.imapAccountFactory&&(r=n.getOtherConnectableAccounts(t.ApplicationScenario.mail),n=null,r&&r.count>0))for(f=0;f<r.count;f++)if(e=r.item(f),e&&e.accountType===t.AccountType.imapAccountFactory){n=e;break}n?(o=new s.AccountDialog(n,s.AccountDialogMode.add,t.ApplicationScenario.mail,i,"",y),o.show()&&(u.deleteObject(),this._account=u=null)):Jx.log.error("Failed to downgrade Gmail account. Could not load the Gmail upsell.")}else Jx.log.error("Failed to downgrade Gmail account, 'this._account.canDelete' was false.")}.bind(this),w=this._addActionButton("idBarDlgYesButton","barDlgReconnectBtn",p,"submit");e.buttons.push(new r.CloseButton("idBarDlgCancelButton",n("actdlgCancel"),e));w.autofocus=true;e.show(true)};u.prototype._createDialog=function(t,i,u){var e=u||{useAppTheme:true},f=this._dialog=new r.Dialog(i||n("barDlgTitle"),t,e);return f.addListener("closed",this._onDialogClosed,this),f};u.prototype._addActionButton=function(t,i,u,f){var e=this._dialog,o=new r.DialogButton(t,n(i),f);return o.addListener("click",function(){e.removeListener("closed",this._onDialogClosed,this);e.close();u.call();this._dialog=null},this),e.buttons.push(o),o};u.prototype._onDialogClosed=function(){Jx.isFunction(this._onCanceled)&&this._onCanceled.call();this._dialog=null};i=function(n){this.initComponent();this._account=n;this._addButton=null;this._cachedType=null};Jx.augment(i,Jx.Component);i.prototype.getUI=function(i){var r=this._account.emailAddress,u=Jx.isNonEmptyString(r)?h("barDlgChooseAccountTypeTitleWithEmail",Jx.escapeHtml(r)):n("barDlgChooseAccountTypeTitle");i.html="<div class='barDlgContent'><div id='dlgDescription' class='barDlgChild' role='heading'>"+u+"<\/div><div id='accountTypeOptions' class='barDlgChild'><label><input id='barDlgEas' type='radio' value='"+t.AccountType.easAccountFactory+"'>"+n("barDlgEasLabel")+"<\/label><label><input id='barDlgImap' type='radio' value='"+t.AccountType.imapAccountFactory+"'>"+n("barDlgImapLabel")+"<\/label><\/div><div id='accountUnsupported'><a href='http://go.microsoft.com/fwlink/?LinkId=259186'>"+n("barDlgUnsupportedAccountTypes")+"<\/a><\/div><\/div>"};i.prototype.activateUI=function(){Array.prototype.forEach.call(document.querySelectorAll("#accountTypeOptions input[type='radio']"),function(n){n.name="accountType";n.addEventListener("change",function(){n.checked&&(this._addButton.disabled="")}.bind(this))},this);Jx.safeSetActive(document.getElementById("barDlgEas"));Jx.Component.prototype.activateUI.call(this)};i.prototype.shutdownUI=function(){this._cachedType=this.accountType;Jx.Component.prototype.shutdownUI.call(this)};Object.defineProperty(i.prototype,"addButton",{get:function(){return this._addButton},set:function(n){this._addButton=n}});Object.defineProperty(i.prototype,"accountType",{get:function(){var n=this.hasUI()?document.querySelector("#accountTypeOptions input[type='radio']:checked"):null;return n?parseInt(n.value):this._cachedType}});f=function(n){this.initComponent();this._account=n};Jx.augment(f,Jx.Component);f.prototype.getUI=function(t){t.html="<div class='barDlgContent'><div id='dlgDescription' role='heading'>"+n("barDlgPopNotSupported")+"<\/div><div>"+n("barDlgIdUsingPopInstructions")+"<\/div><div><a href='http://g.live.com/9ep9gl/popmail'>"+n("barDlgUsingPopLink")+"<\/a><\/div><\/div>"};f.prototype.activateUI=function(){var n=document.querySelector(".barDlgContent a");Jx.safeSetActive(n);Jx.Component.prototype.activateUI.call(this)};e=function(n){this.initComponent();this._account=n};Jx.augment(e,Jx.Component);e.prototype.getUI=function(n){n.html="<div class='barDlgContent'><div id='dlgDescription' role='heading'>"+h("barDlgVerifyEasTitle",Jx.escapeHtml(this._account.emailAddress))+"<\/div><\/div>"};o=function(n){this.initComponent();this._account=n};Jx.augment(o,Jx.Component);o.prototype.getUI=function(n){n.html="<div class='barDlgContent'><div id='dlgDescription' role='heading'>"+h("barDlgGmailDowngradeDlgExplanation",Jx.escapeHtml(this._account.emailAddress))+"<\/div><\/div>"}})