Jx.delayDefine(People.Accounts,"authenticateOAuthAsync",function(){"use strict";var e=window.People,o=e.Accounts,i=Windows.Security.Authentication.Web,r=i.WebAuthenticationStatus,n=Windows.Foundation.Uri,u="680536898769.apps.googleusercontent.com",s="K42IZLOoy0mhX6QfGZkCwWGS";o.authenticateOAuthAsync=function(e){return new WinJS.Promise(function(o,h,c){var a="https://accounts.google.com/o/oauth2/auth?client_id="+u+"&redirect_uri=http://localhost/&response_type=code&scope=https://mail.google.com/%20https://www.googleapis.com/auth/userinfo.email";e!==undefined&&(a+="&login_hint="+n.escapeComponent(e));var v=new n(a),y=new n("http://localhost"),l={};i.WebAuthenticationBroker.authenticateAsync(i.WebAuthenticationOptions.none,v,y).then(function(i){var s=i.responseStatus,f,e,u,h,o;return s===r.errorHttp?(f=t(i.responseErrorDetail),WinJS.Promise.wrapError(new Error(f,f))):s===r.userCancel?WinJS.Promise.wrapError(new Error("Canceled")):(e=new n(i.responseData),u=e.queryParsed,e.query.indexOf("error=")!==-1)?(h=u.getFirstValueByName("error"),"access_denied"===h?WinJS.Promise.wrapError(new Error("Canceled")):WinJS.Promise.wrapError(new Error(2147500037,u.getFirstValueByName("error")))):(c("initialAuthComplete"),o=u.getFirstValueByName("code"),l.code=o,o)}).then(function(t){var i="code="+n.escapeComponent(t)+"&client_id="+u+"&client_secret="+s+"&redirect_uri=http://localhost/&grant_type=authorization_code",r={type:"POST",url:"https://accounts.google.com/o/oauth2/token",responseType:"json",data:i,headers:{"Content-Type":"application/x-www-form-urlencoded"}};return WinJS.xhr(r)}).then(function(i){var e,r,u,o;return f(i.status)?(e=t(i.status),WinJS.Promise.wrapError(new Error(e,e))):(r=JSON.parse(i.response),l.accessToken=r.access_token,l.refreshToken=r.refresh_token,!Jx.isNumber(r.expires_in))?WinJS.Promise.wrapError(new Error(2147500037,"Invalid expires_in")):(u=new Date,u.setSeconds(u.getSeconds()+r.expires_in),l.accessTokenExpiry=u,o={type:"GET",url:"https://www.googleapis.com/oauth2/v2/userinfo",responseType:"json",headers:{Authorization:"Bearer "+n.escapeComponent(r.access_token)}},WinJS.xhr(o))}).then(function(n){var i,r;return f(n.status)?(i=t(n.status),WinJS.Promise.wrapError(new Error(i,i))):(r=JSON.parse(n.response),l.emailAddress=r.email,Jx.log.info("authenticateOAuthAsync() success"),l)}).done(function(n){o(n)},function(n){if(n instanceof Error)h(n);else if(n instanceof XMLHttpRequest){var i=t(n.status);h(new Error(i,i))}else h(new Error(2147500037,"Failed"))})})};var h=function(n,t,i){return n<<31|t<<16|i},t=function(n){return h(1,25,16384|n&4095)},f=function(n){return n!==200}})