Jx.delayDefine(People,"Overlay",function(){var i=window.People,n=i.Overlay=function(n){this._restore=[];this._content=n;this._setImmediateHandle=null;this._onNodeInsertedListener=this._onNodeAdded.bind(this)},t;Jx.inherit(n,Jx.Events);n._activeOverlay=null;n._reservedOverlay=null;n._trap=function(n){n.stopPropagation()};n.prototype.show=function(i){if(n._reservedOverlay&&this!==n._reservedOverlay)return Jx.log.warning("Failing to show overlay. A different overlay has already reserved next showing."),false;if(n._activeOverlay)if(i){if(!this.closeActive())return false}else return Jx.log.warning("Failing to show overlay. One is already active."),false;n._reservedOverlay=null;n._activeOverlay=this;var u=this._root=document.createElement("div"),f=document.createElement("div"),r=document.body.firstElementChild;return u.className="overlay-root",f.className="overlay-fill",f.style.zIndex=t(document.body,10)+1,u.appendChild(f),this._setImmediateHandle=setImmediate(function(){while(r!==null)r.disabled||u===r||(r.disabled=true,this._restore.push(r)),r=r.nextElementSibling;document.body.addEventListener("DOMNodeInserted",this._onNodeInsertedListener,true)}.bind(this)),this._keyupListener=this._onKeyupHandler.bind(this),document.documentElement.addEventListener("keydown",n._trap,false),document.documentElement.addEventListener("keyup",this._keyupListener,false),document.documentElement.addEventListener("contextmenu",n._trap,false),document.body.appendChild(u),this._content.initUI(f),true};n.prototype.close=function(){n._activeOverlay===this&&(this._setImmediateHandle&&(clearImmediate(this._setImmediateHandle),this._setImmediateHandle=null),this._content.shutdownUI(),document.body.removeChild(this._root),document.documentElement.removeEventListener("keydown",n._trap,false),Jx.isFunction(this._keyupListener)&&(document.documentElement.removeEventListener("keyup",this._keyupListener,false),this._keyupListener=null),document.documentElement.removeEventListener("contextmenu",n._trap,false),document.body.removeEventListener("DOMNodeInserted",this._onNodeInsertedListener,true),this._restore.forEach(function(n){n.disabled=false}),n._activeOverlay=null)};n.prototype.isShowing=function(){return!Jx.isNullOrUndefined(n._activeOverlay)&&n._activeOverlay===this};n.prototype.canShow=function(){return Jx.isNullOrUndefined(n._activeOverlay)&&(Jx.isNullOrUndefined(n._reservedOverlay)||n._reservedOverlay===this)};n.prototype.reserveNextShowing=function(){return Jx.isNullOrUndefined(n._activeOverlay)&&Jx.isNullOrUndefined(n._reservedOverlay)?(n._reservedOverlay=this,true):false};n.prototype.cancelReservation=function(){n._reservedOverlay===this&&(n._reservedOverlay=null)};n.prototype.closeActive=function(){if(Jx.log.info("Forcing current overlay to dismiss."),n._activeOverlay)try{n._activeOverlay.close();n._activeOverlay=null}catch(t){return Jx.log.exception("Failed attempting to close overlay. Likely already closed",t),false}return true};n.prototype._onKeyupHandler=function(n){this.raiseEvent("keyup",n);n.stopPropagation()};n.prototype._onNodeAdded=function(n){var t=n.target;t.parentElement===document.body&&(t.disabled||(this._restore.push(t),t.disabled=true))};t=function(n,i){var u,r,f;for(i=Math.max(getComputedStyle(n).zIndex,i)||i,u=n.children||[],r=0,f=u.length;r<f;r++)i=t(u[r],i);return i}})