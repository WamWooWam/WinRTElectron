//! Copyright (c) Microsoft Corporation. All rights reserved.
Jx.delayDefine(window,"wLive",function(){(function(){var n=window;n.wLive={Controls:{},Core:{CookieToss:{complete:true}}};n.wLiveControls=n.wLive.Controls;n.wLiveCore=n.wLive.Core;String.prototype.encodeHtml=function(){return Jx.escapeHtml(this.toString())};String.prototype.encodeHtmlAttribute=function(){return this.replace(/[^\w.,-]/g,function(n){return"&#"+n.charCodeAt(0)+";"})};String.prototype.format=function(){var n=arguments;return this.replace(/\{\d+\}/g,function(t){var i=n[t.replace(/[\{\}]/g,"")];return i===null?"":i})};String.prototype.encodeUrl=function(){return encodeURI(this)};String.prototype.endsWith=function(n){return n.length?n.length>this.length?false:this.substr(this.length-n.length)==n:true};String.prototype.startsWith=function(n){return n.length?n.length>this.length?false:this.substr(0,n.length)==n:true};n.wLiveCore.ActionManager=function(){};n.wLiveCore.ActionManager.prototype={doAction:function(){},getAction:function(){}};n.wLiveCore.ErrorManager=function(){};n.wLiveCore.ErrorManager.prototype={add:function(){},clear:function(){}};n.wLiveCore.SelectionManager=function(){};n.wLiveCore.PageController=function(){};n.wLiveCore.DataModel={dataChangedEvent:"dataChanged"};n.wLiveControls.EditableText={CaptionOptions:{}};n.wLiveControls.Video=function(){};n.wLiveControls.Video.prototype={dispose:function(){}};n.wLiveControls.TagCreate=function(){};n.wLiveControls.TagCreate.prototype={dispose:function(){},render:function(){},resize:function(){},stop:function(){}};n.wLiveControls.TagHover=function(){};n.wLiveControls.TagHover.prototype={dispose:function(){},render:function(){},resize:function(){}};n.wLiveControls.LoadingCue=function(){};n.wLiveControls.LoadingCue.prototype={setVisibility:function(){},update:function(){}};n.$BSI={isLoading:function(){return false},reportEvent:function(){}};n.$Do={register:function(){},when:function(){}};n._ge=function(){return false};n.sutra=function(){};n.unsutra=function(){};n.$WebWatson={submit:function(){}};n.$f={createLoading:function(){return""},showLoading:function(){}};n.$baseMaster={getHeaderHeight:function(){return 0},toggleFixedHeader:function(){}};n.$Config={prop:"MoSelf",sd:"a",BSI:{},mkt:"en-us"};n.$B={IE:1,IE_M10:1,V:10,Full:1,ltr:!Jx.isRtl(),rtl:Jx.isRtl()};n.$menu={current:false};n.FilesConfig={contactUsLink:"",codeOfConductLink:""};n.GetString=function(){return""};n.skipSLReload=true;n.Trace={log:function(n){Jx.log.info(n)},logTo:function(){Jx.log.info(S)},register:function(){}}})(),function(){wLive.Core.StringHelpers={caseInsensitiveStringEquals:function(n,t){return n==t?true:n==null||t==null?false:n.toLowerCase()==t.toLowerCase()}}}(),function(){var n="live.shared.skydrive.",t="live.shared.marketinfo.";wLive.Core.AleHelpers={getString:function(t){return GetString(n+"shared."+t)},getPCString:function(t){return GetString(n+"pc."+t)},getMobileString:function(t){return GetString(n+"mobile."+t)},getMarketInfoValue:function(n){return GetString(t+n)}}}(),function(){wLive.Core.BiciHelpers={reportClickAction:function(n,t,i){var u;if(!i){var f=wLive.Core.PageController,e=f&&f.getInstance(),r=e&&e.getViewContext();r&&(i=r&&r.biciPageId,u=r&&r.biciSetViewContentType,u&&(i+=u))}$BSI.reportEvent("ClickedSelected.Command.SkyDrive",{SkyCmnd:n,ClickLoc:t,TypeOfPage:i})},prependBiciReportClickAction:function(n,t,i){return function(){return wLive.Core.BiciHelpers.reportClickAction(t,i),n&&n.apply(this,arguments)}}}}(),function(){wLive.Core.DomHelpers={isTextInputElement:function(n){return n.is("textarea")||n.is("input")&&(n.attr("type")=="text"||n.attr("type")=="password")},setTimeoutZero:function(n){return window.msSetImmediate?(window.msSetImmediate(n),null):window.setTimeout(n,0)}}}(),function(){var n="popoverHelpers",r=false,u=jQuery(window),t=function(){Trace.log("PopoverHelpers: dialog up",n);r=true},i=function(){Trace.log("PopoverHelpers: dialog closed",n);r=false};$Do.when("Notifications.js",0,function(){Trace.log("PopoverHelpers: creating bindings",n);jQuery(wLive.Controls.Notifications).bind({"afterdialogshow.notifications":t,"beforedialogdismiss.notifications":i,"afterflyoutshow.notifications":t,"beforeflyoutdismiss.notifications":i});var r={};r.cleanupBindings=function(){Trace.log("PopoverHelpers: clearing bindings",n);jQuery(wLive.Controls.Notifications).unbind({"afterdialogshow.notifications":t,"beforedialogdismiss.notifications":i,"afterflyoutshow.notifications":t,"beforeflyoutdismiss.notifications":i})};$Do.when("$PF.attach",r,r.cleanupBindings)});wLive.Core.PopoverHelpers={popoverSelector:".ModalDialog",isPopoverVisible:function(){return r||$menu&&$menu.current}}}(),function(){function r(t){for(var r=-1,i=0;i<n.length;i++)if(n[i].hasOwnProperty(t)){r=i;break}return r}window.FilesIS32=window.FilesIS32||{};window.FilesIS8=window.FilesIS8||{};var n=[FilesIS32,FilesIS8],t=[FilesConfig.imageStripUrl_32,FilesConfig.imageStripUrl_8],i=wLive.Core.ImageStrip={};i.getImage=function(i,u,f){var s,e;if(u=u||"",f=f||"",e=r(i),e>-1){var h=n[e],c=t[e],o=h[i];s=$IS.Create(o.x,o.y,o.w,o.h,FilesConfig.imgBaseUrl,c,u,f)}return s}}(),function(){function r(){n.complete=true;jQuery(n).trigger(n.eventName)}var t=window,i=new RegExp("^http(?:s)?://(?:[A-Za-z0-9]*[.])*livefilestore(?:-int)?[.]com/","i"),n=wLive.Core.CookieToss={complete:true,eventName:"cookieToss",requiresCookieToss:function(n){return i.test(n)}};_ge("cookieToss")&&!t.cookieToss.e&&(n.complete=false,t.cookieToss.c=r)}(),function(){function v(e,v,y){function yt(n,i,r,u,f){return{id:u,queueId:f,exec:n,abort:i,pri:r,timeoutId:0,next:null,prev:null,state:t}}function st(i){if(i&&i.state==n){i.prev&&(i.prev.next=i.next);i.next&&(i.next.prev=i.prev);var r=i.pri;tt[r]==i&&(tt[r]=i.next);it[r]==i&&(it[r]=i.prev);i.state=t;i.prev=i.next=null;k--}return i}function pt(i){if(i&&i.state==t){var r=i.pri,u=it[r];u?(u.next=i,i.prev=u):tt[r]=i;it[r]=i;i.state=n;k++}}function ht(){!ot&&!ft&&k&&p<rt&&(ft=window.setTimeout(bt,c))}function wt(n,t){var i=true,u;return t>0&&(u=Math.max(h,r-r*(t/g)),i=(new Date).getTime()-n<u),i}function bt(){var r=(new Date).getTime(),i=0,t;for(ft=0,ot=true;k>0&&i<=g&&p<rt;)if(t=tt[i],t=t&&nt[t.pri]<(at[t.pri]||rt)?kt(st(t)):null,t){if(!wt(r,i))break}else i++;ot=false;ht()}function kt(n){if(n){p++;d[n.id]=n;n.startTime=(new Date).getTime();nt[n.pri]++;n.state=i;var t=n.exec(function(t){ct(n,t)});t||ct(n)}return n}function ct(n,t){n.state===i&&(p--,delete d[n.id],nt[n.pri]--,t&&typeof t=="number"?(n.state=f,n.timeoutId=window.setTimeout(function(){lt(n)},t)):lt(n))}function lt(n){var t=w[n.queueId];n.state=a;delete t[n.id];ht()}for(var b=this,rt=e||s,at=v||{},g=y||o,k=0,p=0,nt=[],ut=0;ut<=g;ut++)nt.push(0);var ft=0,vt=0,w={},tt=[],it=[],d={},et=false,ot=false;b.enqueue=function(t,i,r,f,e){var h=false,s,o;return et||(e=e||u,f=f||String(vt++),r=r!==undefined?r:l,s=w[e]=w[e]||{},o=s[f],(!o||o.state==n&&(o.next||o.pri!=r))&&(o?(st(o),o.pri=r):(h=true,o=s[f]=yt(t,i,r,f,e)),pt(o),ht())),h};b.abortAll=function(){et=true;for(queueId in w)b.abort(queueId);et=false};b.abort=function(n){var r,t;if(n=n||u,r=w[n],r){for(taskId in r)t=r[taskId],t.state==i?(ct(t),t.abort&&t.abort()):t.state==f?(t.timeoutId&&clearTimeout(t.timeoutId),lt(t)):st(t);w[n]={}}};b.getActiveTaskCount=function(){return p};b.getActiveTasks=function(){return d}}var e=wLive.Core,o=3,s=5,h=20,r=100,c=0,u="root",l=2,t=0,n=1,i=2,f=3,a=4;e.PriorityQueue=v}(),function(){var i=wLive.Core,t=i.RequestPriorityEnum={FetchData:0,FetchImages:1,DefaultGet:2,DefaultPost:3,MoveOperation:4,CopyOperation:5,DeleteOperation:6,RestoreOperation:7,UploadOperation:8,RemoteUploadOperation:9,UpdateStatusOperation:10,ResetAbuseScoreOperation:11,OwnerRequestReviewOperation:12},n={};n[t.CopyOperation]=1;n[t.DeleteOperation]=1;n[t.MoveOperation]=1;n[t.RestoreOperation]=1;n[t.UploadOperation]=3;n[t.RemoteUploadOperation]=1;window.requests=new i.PriorityQueue(5,n,12);window.domUpdates=new i.PriorityQueue}(),function(){function y(y,p,w,b,k,d,g,nt){function lt(n){var t=false;return n.indexOf("/")!=0&&(t=ht(n)!=ht(window.location.host)),t}function ht(n){var t=n.indexOf("://");return t!==-1&&(n=n.substr(t+3)),t=n.indexOf("?"),t!==-1&&(n=n.substr(0,t)),t=n.indexOf("/"),t!==-1&&(n=n.substr(0,t)),n.toLowerCase()}function ct(n,t){var f={};if(n.status==500)try{f=Object.fromJSON(n.responseText)||{}}catch(h){}if(!f.error&&!f.items){var o=true,e=r,s=i("LoadGenericError");f.pageStats={url:p,error:t,tasks:[],executionTimeMs:0,schedulerTimeMs:0};switch(t){case"timeout":e=8001;s=i("LoadTimeoutError");break;case"abort":e=u;o=false;f.pageStats.info=t;f.pageStats.error=null}f.error={isRetriable:o,code:e,message:s,debugMessage:"(xhr status "+n.status+") xhr.responseText: "+n.responseText,stackTrace:""}}return f}function et(n){var i,r;n=n||{};wLive.PageStats.add(n.pageStats,st);n.error&&(i=n.error.stackTrace,i=i&&i.encodeJson?i.encodeJson():"",r='{"code": "'+n.error.code+'", "message": "'+n.error.message+'", "debug": "'+n.error.debugMessage+'", "stacktrace": "'+i+'", "retriesLeft": "'+ot+'", "requestUrl": "'+p+'"}',f.push(r));n.error&&n.error.isRetriable&&ot>0?(Trace.logTo(ut,"Retrying request: "+p,t),it&&it(),ot--,tt.start()):n.error?(Trace.logTo(ut,"Failed response: "+p,t),it&&it(tt.failureReentranceDelay),n.error.code!=u&&k&&k(n)):(Trace.logTo(ut,"Response: "+p,t),it&&it(tt.successReentranceDelay),rt&&tt.originId&&(n.originId=tt.originId),b&&b(n))}var tt=this,ft,it,ot=nt!==undefined?nt:h,ut,st,rt;d=d||s;ut=null;rt=lt(p);y=y||"key"+v++;tt.priority=g||(w?c:l);tt.queueId=w?o:e;tt.originId=null;tt.jsonpParameterName=undefined;tt.successReentranceDelay=0;tt.failureReentranceDelay=0;w&&(w=w.replace(/\?/g,"\\u003F"));tt.start=function(){return window.requests.enqueue(function(i){var u,o,f,e,s;return it=i,st=(new Date).getTime(),u=null,o=p,rt?(o+=p.indexOf("?")===-1?"?":"&",o+="canary="+FilesConfig.canary.encodeUrl(),f="dataRequestCallback_"+a++,e=false,s=setTimeout(function(){e||(e=true,et(ct(ft,"timeout",r)))},d),n.DataRequest[f]=function(t){e||(clearTimeout(s),e=true,et(t));delete n.DataRequest[f]}):(u={canary:FilesConfig.canary,Accept:"application/json",AppId:FilesConfig.appId},tt.originId&&(u["X-SkyApiOriginId"]=tt.originId),FilesConfig.oauthToken&&(u["X-Auth"]=FilesConfig.oauthToken)),ft=jQuery.ajax({url:o,dataType:rt?"jsonp":"json",jsonp:tt.jsonpParameterName,jsonpCallback:f?"wLive.Core.DataRequest."+f:undefined,data:w,processData:false,type:w?"POST":"GET",headers:u,timeout:d,success:rt?undefined:function(n){et(n)},error:rt?undefined:function(n,t,i){et(ct(n,t,i))}}),ut=Trace.log("Request: "+p,t),true},function(){rt||tt.abort()},tt.priority,y,tt.queueId)};tt.abort=function(){ft&&!rt&&(Trace.logTo(ut,"Abort: "+p,t),ft.abort(),ft=null);it&&(it(),it=null)}}var n=wLive.Core,i=n.AleHelpers.getString,e="fetch",o="write",s=3e4,r=8e3,u=8002,h=1,c=n.RequestPriorityEnum.DefaultPost,l=n.RequestPriorityEnum.DefaultGet,t="DataRequest",a=0,v=0,f;n.DataRequest=y;f=n.DataRequest.Errors=[]}(),function(){var n=wLive.Core;n.Events={addListener:function(n,t,i,r){var u=window.Qos,e=u?function(){return u.instrument(u.startOperation({newId:r}),t).apply(i,arguments)}:t,f=this._skyEv=this._skyEv||{};return f[n]=f[n]||{recursionCount:0,isSweepNeeded:false,listeners:[]},f[n].listeners.push({fn:e,originalFn:t,obj:i}),this},removeListener:function(n,t,i){var r,e,u,f;if(this._skyEv&&(f=this._skyEv[n],f))for(r=f.listeners,u=r.length;u--;)if(e=r[u],Boolean(e)&&e.originalFn===t&&e.obj===i)return f.recursionCount!==0?(r[u]=null,f.isSweepNeeded=true):r.splice(u,1),this;return this},disposeEvents:function(){this._skyEv&&(this._skyEv=null)},raiseEvent:function(n,t){window.raiseEvent&&raiseEvent(this,n,t,false);var u,f,i,e,r,o=this._skyEv;if(o&&(r=o[n],r)){for(u=r.listeners,++r.recursionCount,i=0,e=u.length;i<e;++i)if(f=u[i],f)try{f.fn.call(f.obj,t)}catch(s){throw s}if(--r.recursionCount==0&&r.isSweepNeeded){for(i=u.length;i--;)u[i]||u.splice(i,1);r.isSweepNeeded=false}}return this}}}(),function(){function r(){this._filters=[u];this.clear()}function u(n){return!n||n.isVisible===undefined||n.isVisible}var t=wLive.Core,n,i;t.ItemSet=r;n=t.ItemSet.prototype;n.clear=function(){var n=this,i,t;if(n._filteredCount=0,n._filteredIndexToActualIndex={},n._keyToFilteredIndex={},n._childCount=0,n._materializedCount=0,n._indexToItem)for(i in n._indexToItem)t=n._indexToItem[i],t&&t.removeListener&&(t.removeListener("change",n._invalidateHandler,n),t.removeListener("removeItem",n._removeItemHandler,n));n._indexToItem={};n._keyToIndex={};n._requiresFilter=false};n.get=function(n,t){var i=this;return i._updateFilteredSet(t),t||(n=i._filteredIndexToActualIndex[n]),this._indexToItem[n]};n.getByKey=function(n,t){var i=this,r;return i._updateFilteredSet(t),r=t?i._keyToIndex[n]:i._filteredIndexToActualIndex[i._keyToFilteredIndex[n]],this._indexToItem[r]};n.set=function(n,t){var i=this,u=false,r=i._indexToItem[n];return r!=t&&(r&&r.removeListener&&(r.removeListener("change",i._invalidateHandler,i),r.removeListener("removeItem",i._removeItemHandler,i)),u=true,i._indexToItem[n]=t,t&&(t.key&&(i._keyToIndex[t.key]=n),i._childCount=Math.max(i._childCount,n+1),t.addListener&&(t.addListener("change",i._invalidateHandler,i),t.addListener("removeItem",i._removeItemHandler,i))),!r&&t?i._materializedCount++:r&&!t&&i._materializedCount--,i._requiresFilter=true),u};n.insert=function(n,t,i){this.insertWithGroupHint(n,t,true,i)};n.insertWithGroupHint=function(n,t,i,r){var u=this,e,h,o,f,s,c;if(u._updateFilteredSet(r),r||(n=n<u._filteredCount?u._filteredIndexToActualIndex[n]:u._childCount),n=Math.max(0,Math.min(n,u._childCount)),e=u._indexToItem[n],u._indexToItem[n]=null,u.groupings)for(h=u.groupings,o=0;o<h.length;o++)f=h[o],s=f.startIndex+f.count-1,i?s>=n?(f.startIndex>n&&f.startIndex++,f.startIndex<=n&&f.count++):n==u._childCount&&s+1==u._childCount&&f.count++:s+1>=n&&((f.startIndex==n&&f.startIndex!=0||f.startIndex>n)&&f.startIndex++,f.startIndex<=n&&f.count++);for(u.set(n,t);e;)c=u._indexToItem[++n],u._indexToItem[n]=e,u._keyToIndex[e.key]=n,e=c,n==u._childCount&&u._childCount++;u._requiresFilter=true};n.add=function(n){var t=this;t.insert(t._childCount,n,true)};n.indexOf=function(n,t){var r=this,i;return r._updateFilteredSet(t),i=t?r._keyToIndex[n.key]:r._keyToFilteredIndex[n.key],i===undefined&&(i=-1),i};n.removeAt=function(n,t){var i=this,r,e,f,u,o,s;if(i._updateFilteredSet(t),t||(n=i._filteredIndexToActualIndex[n]),r=i._indexToItem[n],r&&(r.removeListener&&(r.removeListener("change",i._invalidateHandler,i),r.removeListener("removeItem",i._removeItemHandler,i)),delete i._keyToIndex[r.key]),i.groupings)for(e=i.groupings,f=0;f<e.length;f++)u=e[f],o=u.startIndex+u.count-1,o>=n&&(u.startIndex<=n?(u.count--,u.count==0&&(e.splice(f,1),f--)):u.startIndex--);for(s=i._childCount-1;n<s;)r=i._indexToItem[n+1],r&&(i._keyToIndex[r.key]=n,i._indexToItem[n]=r),n++;delete i._indexToItem[i._childCount-1];i._childCount--;i._requiresFilter=true};n.remove=function(n){var t=this,i=t.indexOf(n,true);i!=-1&&t.removeAt(i,true)};n.invalidate=function(){var n=this;n._requiresFilter=true;n.raiseEvent("change")};n.getCount=function(n){var t=this;return t._updateFilteredSet(n),n?t._childCount:t._filteredCount};n.getGroupings=function(n){var t=this,i=t.groupings,r,e,u,f;if(i)if(t._updateFilteredSet(n),n){for(u=0;u<i.length;u++)f=i[u],f.endIndex=f.startIndex+f.count-1;r=i}else r=t._filteredGroups;else e=t.getCount(n),r=[{groupingId:"other",startIndex:0,endIndex:e-1,count:e}];return r};n.setCount=function(n){var t=this;t._childCount!=n&&(t.clear(),t._childCount=t._filteredCount=n,t._requiresFilter=true)};n.setFilters=function(n){var t=this;t._filters=n||[];t._requiresFilter=true};n._updateFilteredSet=function(n){var t=this,f,o,h;if(t._requiresFilter&&!n){t._filteredGroups=[];t._filteredIndexToActualIndex={};t._keyToFilteredIndex={};var u=0,c=t._childCount,e=0,s=t._filters,i,l=0,r;for(t.groupings&&t.groupings.length&&(i=t.groupings[0],i.endIndex=i.startIndex+i.count-1,r={groupingId:i.groupingId,name:i.name,startIndex:0,endIndex:0,count:0}),t._filteredCount=0;u<c;u++){for(f=t._indexToItem[u],o=true,e=0;o&&e<s.length;e++)o=s[e](f);o&&(t._filteredIndexToActualIndex[t._filteredCount]=u,f&&f.key&&(t._keyToFilteredIndex[f.key]=t._filteredCount),i&&r.count++,t._filteredCount++);i&&u==i.endIndex&&(r.count>0&&(r.endIndex=r.startIndex+r.count-1,t._filteredGroups.push(r)),i=t.groupings[++l],i&&(i.endIndex=i.startIndex+i.count-1),h=t._filteredCount,r={groupingId:i?i.groupingId:"other",name:i?i.name:null,startIndex:h,count:0})}t._requiresFilter=false}};n._invalidateHandler=function(){this.invalidate()};n._removeItemHandler=function(n){this.remove(n)};n.__isObservable=true;n.groupings=null;i=t.Events;n.addListener=t.Events.addListener;n.removeListener=i.removeListener;n.disposeEvents=i.disposeEvents;n.raiseEvent=i.raiseEvent}();wLive.Core.JSONConstants={SortField:{Default:"0",Name:"1",ModifiedDate:"2",CreatedDate:"3",Size:"4",Type:"5",DateTaken:"6",Owner:"7",UserArranged:"8",LastOpened:"9",Relevancy:"10",DateDeleted:"11",OriginalLocation:"12"},SortDirection:{Default:"0",Ascending:"1",Descending:"2"},FilterType:{Albums:"1",Folder:"2",Favorites:"4",AllFolders:"7",PhotosAndVideos:"8",Documents:"16"}},function(){function f(n,i,u){function e(n){var t=f._headerItemsSet&&n&&f._headerItemsSet.indexOf(n)!==-1;return t&&r.push({set:f,headerSet:f._headerItemsSet,item:n}),!t}var f=this;t.ItemSet.apply(this);f.modifiedDate=-1;f.groupings=null;f._dataModel=n;f._parentItemKey=i;f._setKey=u;f.setKeyParts=t.SkyDriveItem.getSetKeyParts(u);f._headerItemsSet=null;f._filters.push(e);f._type="SkyDriveItemSet"}var t=wLive.Core,r,u,n,i;t.SkyDriveItemSet=f;r=[];s_infiniteScrollBuffer=20;u="SkyDriveItemSet";n=f.prototype=new t.ItemSet;i=t.ItemSet.prototype;n.setHeaderItemsSet=function(n){var t=this;t._headerItemsSet&&t._headerItemsSet.removeListener("change",t._invalidateHandler,t);t._headerItemsSet=n;n.addListener("change",t._invalidateHandler,t,"SkyDriveWeb_Internal_Framework_SkyDriveItemSet_ItemSetChanged")};n.isOutOfDate=function(){var t=this,n=t.getParent(true);return n&&(n.hasExpired()||n.modifiedDate!=t.modifiedDate)};n.get=function(n,t,r){var e=this,f=null,c=false,l=false,y=e._dataModel,a=e._parentItemKey,v=e._setKey,o=e._headerItemsSet,p=e.getCount(r),w=e._filteredIndexToActualIndex,s=e.isOutOfDate(),h;return o&&o.getCount()>0&&(o.getCount()>n?(f=o.get(n),c=true):n-=o.getCount()),c||(f=i.get.call(e,n,r),l=!f&&n>=0&&n<p),f&&f.hasExpired()&&(s=true,h=f.getParent(true),h&&h.expire(false)),!t&&(l||s)&&y.fetchItem(a,v,null,n)&&Trace.log("get miss - index: "+n+", exists: "+!!f+", setExpired: "+s+", setKey: "+v,u),f&&(f.parentKey=a),f};n.getCount=function(n){var r=this,u=r._headerItemsSet,t=i.getCount.call(r,n);return u&&(t+=u.getCount()),r.isOutOfDate()&&!t&&(t=1),t};n.setCount=function(n){var t=this,u=t.getParent(true),r,f,e;if(u&&(u.hasMoreResults===true||u.hasMoreResults===false)){if(r=u.folder.totalCount,f=t._childCount,u.hasMoreResults&&(r<=f?r=f:r+=s_infiniteScrollBuffer),t._childCount=t._filteredCount=r,t._requiresFilter=true,r<f)for(e=f-1;e>=r;e--)t._indexToItem[e]&&t._materializedCount--,delete t._indexToItem[e]}else i.setCount.call(t,n)};n.getGroupings=function(n){var s=this,h=s._headerItemsSet,t,u=i.getGroupings.call(s,n),r,f,e,o;if(h&&(r=h.getCount(n),r)){if(f=[],u.length==0||u[0].groupingId!="folder")for(f.push({groupingId:"folder",startIndex:0,endIndex:r-1,count:r}),e=0;e<u.length;e++)t=u[e],f.push({groupingId:t.groupingId,startIndex:t.startIndex+r,endIndex:t.endIndex+r,count:t.count});else for(o=0;o<u.length;o++)t=u[o],f.push({groupingId:t.groupingId,name:t.name,startIndex:t.startIndex?t.startIndex+r:0,endIndex:t.endIndex+r,count:t.groupingId=="folder"?t.count+r:t.count});u=f}return r=this.getCount(n),r&&!u.length&&u.push({groupingId:"other",startIndex:0,endIndex:r-1,count:r}),u};n.getParent=function(n){var t=this,i=t._dataModel;return i?i.getItem(t._parentItemKey,n):null};n.indexOf=function(n,t,r){var e=this,o=e._headerItemsSet,c=e._dataModel,l=e._parentItemKey,s=e._setKey,h=e.isOutOfDate(),f=-1;return o&&(f=o.indexOf(n,t)),f==-1&&(f=i.indexOf.call(e,n,t),!r&&(f===-1||h)&&c.fetchItem(l,s,n.id,0)&&Trace.log("indexOf miss - id: "+n.id+", setExpired: "+h+", setKey: "+s,u),o&&f!==-1&&(f+=o.getCount(t))),f};n.remove=function(n){var t=this,i=t.indexOf(n,true,true);i!=-1&&t.removeAt(i,true)};n.clone=function(){var r=this,u=new t.SkyDriveItemSet(r._dataModel,r._parentItemKey,r._setKey),h=i.get,n,f,e,o,s;for(u.groupings=this.groupings,n=0;n<r.getCount();n++)f=h.call(r,n),f&&u.set(n,f);for(u.modifiedDate=r.modifiedDate,e=r._headerItemsSet,o=new t.ItemSet,n=0;n<e.getCount();n++)s=e.get(n,true),s&&o.set(n,s);return u.setHeaderItemsSet(o),u};n.isComplete=function(){var n=this;return n._materializedCount===n._childCount};n.sort=function(){for(var r=this,i=t.SkyDriveItem.getSetKeyParts(r._setKey),f=[],e,u,n=0;n<r.getCount();n++)e=r.get(n,true),f.push(e);for(u=f.sort(function(n,r){function f(n,i){var r=t.JSONConstants.SortField;switch(i){case r.ModifiedDate:return n.dateModifiedOnClient||0;case r.CreatedDate:return n.creationDate||0;case r.Size:return n.size||0}}var u;u=i.sr;i.sd&&(u=i.sd==t.JSONConstants.SortDirection.Default);var e=u?f(n,i.sb):f(r,i.sb),o=u?f(r,i.sb):f(n,i.sb),s=e-o;if(n.folder&&!r.folder)return-1;if(!n.folder&&r.folder)return 1;if(!(n.video||n.photo)||r.photo||r.video){if((r.video||r.photo)&&!n.photo&&!n.video)return-1}else return 1;return s}),n=0;n<u.length;n++)r.set(n,u[n])};t.SkyDriveItemSet.removeMarkedHeaderItems=function(){while(r.length>0){var n=r.pop(),t=n.set,i=n.headerSet,u=n.item;i.remove(u);t._requiresFilter=true}};t.SkyDriveItemSet.setInfiniteScrollBuffer=function(n){s_infiniteScrollBuffer=n}}(),function(){function r(t,i,u){i==u&&(u=null);var f=this;f.key=i;f.instance=b++;f.keyParts=n.SkyDriveItem.getItemKeyParts(i);f.parentKey=u;f.id=f.keyParts.id;f.did=f.keyParts.did;f.commands=null;f.modifiedDate=-1;f.name=null;f.extension=null;f.ownerName=null;f.ownerCid=null;f.iconType=null;f.isUnknownFileType=false;f.folder=null;f.sharingLevel=null;f.group=null;f.hasPendingGroupJoinRequest=null;f.userInvitedToGroupOnDifferentEmail=null;f.partialData=null;f.hasMoreResults=null;f.neverExpires=null;f.estimatedResultCount=null;f.directlyShared=null;f.snippet=null;f.highlights=null;f.tokenNeedsRedeeming=false;f.video=null;f._isLoadingItem=false;f._missingName=false;f._expirationDate=0;f._dataModel=t;f._isNewFolder=false;f._childSets=null;f._headerItemsSet=null;f._dataContext=null;f._version=0;f.documentFormat=r.DocumentFormat.Default}function v(n,t){var r=n.parentKey,u=n.key,f=n.snippet,o=n.highlights,i={};e(i,n.keyParts,1);e(n,t,1);delete n.partialData;n.parentKey=r;n.key=u;n.keyParts=i;n.snippet=f;n.highlights=o}function e(n,t,i){var u,r,f;for(u in t)r=t[u],r&&typeof r=="object"&&!Object.isArray(r)&&i>0?(f=n[u]=n[u]||{},e(f,r,i-1)):n[u]=r}function it(n){if(i&&n)for(var t=0;t<i.length;t++)if(n.id===i[t].id)return false;return true}function rt(n,t){var u,r,f;if(t.qt=="shared"){if(!i&&(i=c.getLocalValue(a),i)){for(u=new Date,r=0;r<i.length;r++)f=i[r],new Date(f.expire)<u&&(i.splice(r,1),r--);c.setLocalValue(a,i)}n._filters.push(it)}}function ut(n){var t=n.folder;t&&(t.covers=t.covers||null,t.hasSubfolders=t.hasSubfolders?true:false);n.isProcessingVideo=n.isProcessingVideo||false}function ft(t,i){var u=n.JSONConstants.FilterType,r=t.totalCount,f=n.SkyDriveItem.getSetKeyParts(i),e=f?f.ft:"";return e==u.AllFolders?r=t.folderCount!==undefined?t.folderCount:t.hasSubfolders?1:0:e==u.PhotosAndVideos&&t.photoCount!==undefined&&(r=t.photoCount),r!==undefined?r:1}var n=wLive.Core,et=n.AleHelpers.getPCString,s=n.AleHelpers.getString,c=n.BrowserStorage,y="root",l="default",p="NonEmptyDocumentFolder",w=wLive.Core.AleHelpers.getPCString("SkyDriveProductName"),b=0,k="SkyDriveItem",a="SkyDrive.AbdicatedItems",d=0,g="rd,1",nt=12e4,tt=36e7,h={},f={},u=null,i=null,t,o;r.DocumentFormat={Default:0,ODF:1};r.ExtendedProperty={Default:0,MoSkyDocProperties:1,QuotaInfo:2};n.SkyDriveItem=r;t=n.SkyDriveItem.prototype;t.processItem=function(t){var i=this,o=false,u,s,h,f,c,a;return this._isNewFolder=false,(t.modifiedDate===undefined||t.modifiedDate>=i.modifiedDate)&&(ut(t),this.parentKey&&(u=n.SkyDriveItem.getItemKeyParts(this.parentKey),u.qt||u.did||(this.parentKey=n.SkyDriveItem.getItemKey(t.parentId,u.cid,u.group,u.qt,u.did,u.q,u.sft))),s=this.folder?this.folder.totalCount:-1,h=t.folder?t.folder.totalCount:-1,(t.modifiedDate!=i.modifiedDate||h!=s||t.sharingLevel!=i.sharingLevel)&&(i._version++,o=true),f=null,t.folder&&(f=t.folder.children,delete t.folder.children),e(i,t,1),f&&(t.folder.children=f),t.folder&&(i._childSets||(i._childSets={}),i._headerItemsSet||(i._headerItemsSet=new n.ItemSet)),t.name||(i._missingName=true),c=i.isViewerOwner(),i.ownerName||(i.ownerName=c?FilesConfig.userDisplayName:""),i.ownerCid||(i.ownerCid=i.keyParts.cid),i.iconType||(i.iconType=t.folder?p:l),i.isUnknownFileType=n.StringHelpers.caseInsensitiveStringEquals(i.iconType,l),!t.docFormat||t.docFormat!=1||(i.documentFormat=r.DocumentFormat.ODF)),i._commands=null,!i.did||(i.commands=g+(i.commands?","+i.commands:"")),a=i.neverExpires?tt:nt,i._expirationDate=(new Date).getTime()+a,o};t.updateItemProperties=function(n,t,i){var r=this;r._dataModel.updateItemProperties(r,n,t,i)};t.updateItemProperty=function(n,t,i,r,u){var f=this;this._isNewFolder&&n=="name"?(f.name=(t||"").trim(),f.invalidate(),f._dataModel.createSubfolder(f.getParent(),f,i,r)):f._dataModel.updateItemProperty(f,n,t,i,r,u)};t.getExtendedInfo=function(t,i,u){var f;switch(u){case r.ExtendedProperty.MoSkyDocProperties:f="&with=davUrl,mimetype";break;case r.ExtendedProperty.QuotaInfo:f=""}this._dataModel.fetchItem(this.key,n.SkyDriveItem.getSetKey(),null,0,true,this.modifiedDate,t,i,0,f)};t.hasExpired=function(){return!this.isPlaceholder&&this._expirationDate<(new Date).getTime()};t.getVersion=function(){return this._version};t.getDisplayName=function(n){var t=this,i=t.name,r,u;return n&&!t.parentKey?t.did?(r=n.deviceItemSet.getByKey(t.did.toLowerCase()),i=r?r.name:""):i=t.isQt("search")?s("SearchResults").format(t.getSearchQuery()):t.isQt("recyclebin")?s("RecycleBinLowerCase"):t.ownerName?s("UsersSkyDrive").format(t.ownerName):w:(u=t.extension,t.isUnknownFileType&&u&&(i+=u)),i};t.isViewerOwner=function(){var n=this;return!n.ownerCid||n.ownerCid.toLowerCase()==FilesConfig.hcid.toLowerCase()};t.isLoading=function(){return this._isLoadingItem};t.isWebPlayableVideo=function(){var n=this,t=n.video,i=t&&n.video.attributes,r=i?n.video.attributes===7:n.did;return t&&r};t.isQt=function(t){return n.StringHelpers.caseInsensitiveStringEquals(this.keyParts.qt,t)};t.getSearchQuery=function(){return this.keyParts.q||""};t.extendPartialData=function(t){var i=this,r=n.SkyDriveItem.getItemKeyParts(i.key),f=n.SkyDriveItem.getItemKey(r.id,r.cid,parseInt(r.group),undefined,r.did,undefined,undefined),u=i._dataModel.getItem(f,true);u&&!u.hasExpired()?(v(i,u),t(i)):i._dataModel.fetchItem(f,n.SkyDriveItem.getSetKey("0"),null,0,false,i.modifiedDate,function(n){v(i,n);t(i)})};t.getParent=function(n){var t=this;return t._dataModel.getItem(t.parentKey,n)};t.getChildren=function(t){var e=this,r=this._childSets,i=null,s,f,h,o;if(r){if(t=t||u,i=r[t],!i){for(s in r)if(n.SkyDriveItem.getSetKeyParts(t).ft===n.SkyDriveItem.getSetKeyParts(s).ft&&(f=r[s],h=n.SkyDriveItem.getSetKeyParts(t),(n.ClientSortableFields[h.sb]&&h.sd!=n.JSONConstants.SortDirection.Default||f._childCount===1)&&f.isComplete()&&false)){i=r[t]=f.clone();i._setKey=t;i.setKeyParts=$Utility.deserialize(t,"&",false,false);f._childCount>1&&i.sort();break}i||(i=r[t]=new n.SkyDriveItemSet(e._dataModel,e.key,t),o=n.SkyDriveItem.getSetKeyParts(t),o&&o.ft&&o.ft===n.JSONConstants.FilterType.PhotosAndVideos||i.setHeaderItemsSet(e._headerItemsSet),rt(i,this.keyParts))}i.modifiedDate===-1&&i.setCount(ft(e.folder,t))}return i};t.remove=function(){this.raiseEvent("removeItem",this)};t.setVisibility=function(n){var t=this;t.isVisible=n;t.raiseEvent("change")};t.getVisibility=function(){var n=this;return n.isVisible===undefined||n.isVisible};t.invalidate=function(n){var i=this,t;for(n||i._version++,t=i,i.raiseEvent("change");t;)i._dataModel._fireDataChanged(t),t=t.getParent(true)};t.expire=function(n){var t=this,i;t._expirationDate=-1;n&&(i=t.getParent(true),i&&i.expire(true));t._dataModel.abortPendingRequests(t.key)};t.getHasSubfolders=function(){var n=this.folder&&this.folder.hasSubfolders;return n||this._headerItemsSet&&this._headerItemsSet.getCount()>0};t.createPinnedSubfolder=function(){var t=this,i=null,u;return t._headerItemsSet&&(u="NewFolder"+d++,i=new r(this._dataModel,n.SkyDriveItem.getItemKey(u),this.key),i.processItem({folder:{totalCount:0,childCount:0},name:FilesConfig.defaultFolderString,commands:"rn,1",group:t.group,cid:t.ownerCid,ownerName:t.ownerName,sharingLevel:t.sharingLevel,_isNewFolder:true}),Trace.log("Creating a pinned subfolder under: "+this.key,k),t._headerItemsSet.insert(0,i),t._headerItemsSet.invalidate()),i};t.removePinnedSubfolder=function(n){var i=this,t=i._headerItemsSet;t&&(t.remove(n),t.invalidate())};t.updatePinnedSubfolderKey=function(t){var i=this,u=false,r;i._headerItemsSet&&(r=i._headerItemsSet.indexOf(t),r>=0&&(i._headerItemsSet.remove(t),t.key=n.SkyDriveItem.getItemKey(t.id,t.ownerCid,t.group,null,null),t.keyParts=n.SkyDriveItem.getItemKeyParts(t.key),t.clearItemSets(),i._headerItemsSet.insert(r,t),i._headerItemsSet.invalidate(),u=true));u||(t.key=n.SkyDriveItem.getItemKey(t.id,t.ownerCid,t.group,null,null),t.keyParts=n.SkyDriveItem.getItemKeyParts(t.key),t.clearItemSets())};t.clearItemSets=function(){var n=this,t;if(n._childSets!==null){for(t in n._childSets)n._childSets[t].clear();n._childSets={}}};t.getDevice=function(){var t=this,i=null,r;return t.keyParts.did&&(r=n.PageController.getInstance().getViewContext().deviceItemSet,i=r.getByKey(t.keyParts.did.toLowerCase())),i};t.getDeviceBaseUrl=function(){var i=this,n=null,t=i.getDevice();return t&&(n=t.baseUrl),n||FilesConfig.devicesBaseUrl};t.__isObservable=true;n.SkyDriveItem.getItemKey=function(n,t,i,r,u,f,e){var o={id:n||y,cid:(t||""+FilesConfig.hcid).toLowerCase(),group:Number(i)?"1":"0",qt:(r||"").toLowerCase(),did:u||"",q:f||"",sft:e||""},s;return u||(o.id=o.id.toLowerCase()),s="id="+o.id.encodeUrl()+"&cid="+o.cid.encodeUrl()+"&group="+o.group.encodeUrl()+"&qt="+o.qt.encodeUrl(),u&&(s+="&did="+o.did.encodeUrl()),f&&(s+="&q="+o.q.encodeUrl()),e&&(s+="&sft="+o.sft.encodeUrl()),h[s]=o,s};n.SkyDriveItem.getItemKeyParts=function(t){var r=h[t],i;return r||(i=$Utility.deserialize(t,"&",false,false),n.SkyDriveItem.getItemKey(i.id,i.cid,parseInt(i.group),i.qt,i.did,i.q,i.sft),r=h[t]),r};n.SkyDriveItem.getSetKey=function(n,t,i,r,e){var h=f[u]||{},c=n||h.sb||"0",s=t!==null&&t!==undefined,l=s?t:h.sr,v=Number(l)?"1":"0",a=i||"",o;return r=r||"0,1,2",e=e||"0",o="ft="+a.encodeUrl()+"&sb="+c.encodeUrl()+(s?"&sr="+v:"")+(s?"":"&sd="+e)+"&gb="+r.encodeUrl(),f[o]={ft:a,sb:c,gb:r},s?f[o].sr=l:f[o].sd=e,o};n.SkyDriveItem.getSetKeyParts=function(n){return n=n||u,f[n]};n.SkyDriveItem.setDefaultSetKey=function(n){u=n};n.SkyDriveItem.getDefaultSetKey=function(){return u};n.SkyDriveItem.areItemsSame=function(n,t,i){if(n&&t){var r=!i||n.commands===t.commands&&n.name===t.name;return n.key===t.key&&n.modifiedDate===t.modifiedDate&&r}return false};n.SkyDriveItem.IsFolderWithCovers=function(n){return n&&n.folder&&n.folder.covers};n.ClientSortableFields={2:true,3:true,4:true};n.QuotaStatus={Normal:0,Nearing:1,Exceeded:2};n.ItemStatus={Active:0,Restricted:1,RestrictedICN:2};n.ReviewState={NotReviewed:0,AutoReviewed:1,AgentReviewed:2,Challenged:3,ChallengeReviewed:4};u=n.SkyDriveItem.getSetKey();o=n.Events;t.addListener=n.Events.addListener;t.removeListener=o.removeListener;t.disposeEvents=o.disposeEvents;t.raiseEvent=o.raiseEvent}(),function(){function nt(n){var t=u(n,"qt");return t&&t!==""}function u(n,t){return n?(n.keyParts||(n.keyParts=$Utility.deserialize(n.key,"&",false,false)),n.keyParts[t]):undefined}function o(n){return c("FileType."+n)}var t=wLive.Core,c=t.AleHelpers.getPCString;Trace.register("SkyDriveItemHelper",{isEnabled:false});var l="",a=":",p=1e3,v=6e4,s=36e5,w=.85,b="&videoplayer=skysl",k="root",d="photomail_",f="Doc",h="One",n="Ppt",i="Xls",r="Vsd",e="Lib",y="Drive",g={WinDocuments:e,WinLibrary:e,WinMusic:e,WinPictures:e,WinPodcastLibrary:e,WinVideos:e,WinDrive:y,CDDrive:"CDDrive",GenericDrive:y,UsbDrive:"USBDrive",ExternalDrive:"ExtDrive",NetworkStorage:"NetDrive",Accdb:"Mdb",Doc:f,Docm:f,Docx:f,Dot:f,Dotm:f,Dotx:f,Exe:"Exe",Html:"Html",Mdb:"Mdb",Mpp:"Mpp",Mpt:"Mpp",Odp:n,Ods:i,Odt:f,One:h,Onepkg:h,Onetoc2:h,Notebook:"OneNotebook",Pot:n,Potm:n,Potx:n,Ppa:n,Ppam:n,Pps:n,Ppsm:n,Ppsx:n,Ppt:n,Pptm:n,Pptx:n,Pub:"Pub",Rtf:"Rtf",Txt:"Txt",Vdw:r,Vsd:r,Vsdm:r,Vsdx:r,Vsl:r,Vss:r,Vssm:r,Vssx:r,Vst:r,Vstm:r,Vstx:r,Xaml:"Xaml",Xla:i,Xlam:i,Xll:i,Xls:i,Xlsb:i,Xlsm:i,Xlsx:i,Xlt:i,Xltm:i,Xltx:i,Xml:"Xml",Xps:"Xps",Xsn:"Xsn",Zip:"Zip"};wLive.Core.SkyDriveItemHelper={duration:function(n){var t,i,f,r,u;return t=l,i=false,n>=s&&(f=Math.floor(n/s),n=n%s,t+=f+a,i=true),r=Math.floor(n/v),n=n%v,r<10&&i&&(t+="0"),t+=r+a,u=Math.floor(n/p),u<10&&(t+="0"),t+u},getThumbnail:function(n,t){var i,f,r,u;if(i=n.thumbnails,i)for(f=i.length,r=0;r<f;r++)if(u=i[r],u.name==t)return u;return undefined},pickThumbnail:function(n,t,i){var e,r,o;var u=null,f=null,s=t*i*w;if(n&&n.thumbnails&&n.thumbnails.length>0)for(e=0;e<n.thumbnails.length;e++)r=n.thumbnails[e],r.totalPixels=r.width*r.height,o=r.coverage=Math.min(r.width,t)*Math.min(r.height,i),o>=s?(!u||r.totalPixels<u.totalPixels)&&(u=r):(!f||r.totalPixels>f.totalPixels)&&(f=r);return u||f},isHtml5DropEnabled:function(n,t){return n&&n.folder&&!n.did&&t.viewParams.qt!="mru"&&t.viewParams.qt!="shared"&&t.viewParams.qt!="recyclebin"},isRootItem:function(n){return n.id===k},isSkyDriveRoot:function(n){return t.SkyDriveItemHelper.isRootItem(n)&&!n.group&&!n.did&&!nt(n)},isDeviceRoot:function(n){return n&&t.SkyDriveItemHelper.isRootItem(n)&&n.did},isGroupRoot:function(n){return t.SkyDriveItemHelper.isRootItem(n)&&u(n,"group")==="1"&&n.ownerCid!=null},isGroupItem:function(n){return u(n,"group")==="1"},isLegacyPhotomail:function(n){return n.id&&n.id.startsWith(d)},isTopLevelItem:function(n){if(t.SkyDriveItemHelper.isRootItem(n))return false;var i=n.getParent(true);return i&&t.SkyDriveItemHelper.isRootItem(i)},getTopLevelItem:function(n){while(n&&!t.SkyDriveItemHelper.isTopLevelItem(n))n=n.getParent(true);return n},isViewerOwner:function(n){return!n.ownerCid||n.ownerCid.toLowerCase()==FilesConfig.hcid.toLowerCase()},isMruQuery:function(n){var t=u(n,"qt");return t&&t.toLowerCase()==="mru"},isRecycleBinQuery:function(n){var t=u(n,"qt");return t&&t.toLowerCase()==="recyclebin"},isSharedQuery:function(n){var t=u(n,"qt");return t&&t.toLowerCase()==="shared"},isSearchQuery:function(n){var i=u(n,"qt");return i&&i.toLowerCase()==="search"&&t.SkyDriveItemHelper.isRootItem(n)},getSearchQuery:function(n){return u(n,"q")||""},isSearchResult:function(n){var i=n&&n.getParent&&n.getParent(true);return t.SkyDriveItemHelper.isSearchQuery(i)},isSearchOrDescendent:function(n){while(n){if(t.SkyDriveItemHelper.isSearchQuery(n))return true;n=n.getParent&&n.getParent(true)}return false},highlightAndEncodeField:function(n,t){var i,e,o;if(n&&n[t]){var u=n[t],f=[],r=n.highlights;if(r)for(i=r.length-1;i>=0;i--)r[i].fieldName==t&&r[i].startIndex<u.length&&(f.unshift(u.substring(r[i].endIndex).encodeHtml()),e=jQuery(_ce("span")).addClass("highlight").html(u.substring(r[i].startIndex,r[i].endIndex).encodeHtml()),sutra(e,"$Sutra.SkyDrive.SearchHighlight"),o=jQuery(_ce("span")).append(e),f.unshift(o.html()),u=u.substring(0,r[i].startIndex));return f.unshift(u.encodeHtml()),f.join("")}return""},clearFieldHighlights:function(n,t){var r,i;if(n&&n.highlights)for(r=n.highlights,i=0;i<r.length;)r[i].fieldName==t?r.splice(i,1):i++},getSongForPlayer:function(n){var r,t=n.audio,i;return t&&(i=null,n.thumbnailSet&&(i=n.thumbnailSet.baseUrl+wLive.Core.SkyDriveItemHelper.getThumbnail(n.thumbnailSet,"height128").url),r={songUrl:n.urls.download+b,songTitle:t.title||n.name||l,artistName:t.artist||c("InfoPane.Information.UnknownArtist"),albumArtUrl:i,mimeType:n.mimeType,error:0}),r},getNormalizedExtension:function(n){return n&&g[n.iconType]},getFriendlyFileType:function(n){var f=n.getVersion(),e="friendlyFileTypeVersion";if(n[e]!==f){var s=n.extension,r=s&&s.substring(1).toUpperCase(),u=t.SkyDriveItemHelper.getNormalizedExtension(n),i=o("NoExtension");!u&&n.folder?i=o("Folder"):n.photo&&!n.video?i=o("Image").format(r||"").trim():u?i=o(u):r&&(i=o("Unknown").format(r));n.friendlyFileType=i;n[e]=f}return n.friendlyFileType}}}(),function(){function nt(n){var t=u(n,"qt");return t&&t!==""}function u(n,t){return n?(n.keyParts||(n.keyParts=$Utility.deserialize(n.key,"&",false,false)),n.keyParts[t]):undefined}function o(n){return c("FileType."+n)}var t=wLive.Core,c=t.AleHelpers.getPCString;Trace.register("SkyDriveItemHelper",{isEnabled:false});var l="",a=":",p=1e3,v=6e4,s=36e5,w=.85,b="&videoplayer=skysl",k="root",d="photomail_",f="Doc",h="One",n="Ppt",i="Xls",r="Vsd",e="Lib",y="Drive",g={WinDocuments:e,WinLibrary:e,WinMusic:e,WinPictures:e,WinPodcastLibrary:e,WinVideos:e,WinDrive:y,CDDrive:"CDDrive",GenericDrive:y,UsbDrive:"USBDrive",ExternalDrive:"ExtDrive",NetworkStorage:"NetDrive",Accdb:"Mdb",Doc:f,Docm:f,Docx:f,Dot:f,Dotm:f,Dotx:f,Exe:"Exe",Html:"Html",Mdb:"Mdb",Mpp:"Mpp",Mpt:"Mpp",Odp:n,Ods:i,Odt:f,One:h,Onepkg:h,Onetoc2:h,Notebook:"OneNotebook",Pot:n,Potm:n,Potx:n,Ppa:n,Ppam:n,Pps:n,Ppsm:n,Ppsx:n,Ppt:n,Pptm:n,Pptx:n,Pub:"Pub",Rtf:"Rtf",Txt:"Txt",Vdw:r,Vsd:r,Vsdm:r,Vsdx:r,Vsl:r,Vss:r,Vssm:r,Vssx:r,Vst:r,Vstm:r,Vstx:r,Xaml:"Xaml",Xla:i,Xlam:i,Xll:i,Xls:i,Xlsb:i,Xlsm:i,Xlsx:i,Xlt:i,Xltm:i,Xltx:i,Xml:"Xml",Xps:"Xps",Xsn:"Xsn",Zip:"Zip"};wLive.Core.SkyDriveItemHelper={duration:function(n){var t,i,f,r,u;return t=l,i=false,n>=s&&(f=Math.floor(n/s),n=n%s,t+=f+a,i=true),r=Math.floor(n/v),n=n%v,r<10&&i&&(t+="0"),t+=r+a,u=Math.floor(n/p),u<10&&(t+="0"),t+u},getThumbnail:function(n,t){var i,f,r,u;if(i=n.thumbnails,i)for(f=i.length,r=0;r<f;r++)if(u=i[r],u.name==t)return u;return undefined},pickThumbnail:function(n,t,i){var e,r,o;var u=null,f=null,s=t*i*w;if(n&&n.thumbnails&&n.thumbnails.length>0)for(e=0;e<n.thumbnails.length;e++)r=n.thumbnails[e],r.totalPixels=r.width*r.height,o=r.coverage=Math.min(r.width,t)*Math.min(r.height,i),o>=s?(!u||r.totalPixels<u.totalPixels)&&(u=r):(!f||r.totalPixels>f.totalPixels)&&(f=r);return u||f},isHtml5DropEnabled:function(n,t){return n&&n.folder&&!n.did&&t.viewParams.qt!="mru"&&t.viewParams.qt!="shared"&&t.viewParams.qt!="recyclebin"},isRootItem:function(n){return n.id===k},isSkyDriveRoot:function(n){return t.SkyDriveItemHelper.isRootItem(n)&&!n.group&&!n.did&&!nt(n)},isDeviceRoot:function(n){return n&&t.SkyDriveItemHelper.isRootItem(n)&&n.did},isGroupRoot:function(n){return t.SkyDriveItemHelper.isRootItem(n)&&u(n,"group")==="1"&&n.ownerCid!=null},isGroupItem:function(n){return u(n,"group")==="1"},isLegacyPhotomail:function(n){return n.id&&n.id.startsWith(d)},isTopLevelItem:function(n){if(t.SkyDriveItemHelper.isRootItem(n))return false;var i=n.getParent(true);return i&&t.SkyDriveItemHelper.isRootItem(i)},getTopLevelItem:function(n){while(n&&!t.SkyDriveItemHelper.isTopLevelItem(n))n=n.getParent(true);return n},isViewerOwner:function(n){return!n.ownerCid||n.ownerCid.toLowerCase()==FilesConfig.hcid.toLowerCase()},isMruQuery:function(n){var t=u(n,"qt");return t&&t.toLowerCase()==="mru"},isRecycleBinQuery:function(n){var t=u(n,"qt");return t&&t.toLowerCase()==="recyclebin"},isSharedQuery:function(n){var t=u(n,"qt");return t&&t.toLowerCase()==="shared"},isSearchQuery:function(n){var i=u(n,"qt");return i&&i.toLowerCase()==="search"&&t.SkyDriveItemHelper.isRootItem(n)},getSearchQuery:function(n){return u(n,"q")||""},isSearchResult:function(n){var i=n&&n.getParent&&n.getParent(true);return t.SkyDriveItemHelper.isSearchQuery(i)},isSearchOrDescendent:function(n){while(n){if(t.SkyDriveItemHelper.isSearchQuery(n))return true;n=n.getParent&&n.getParent(true)}return false},highlightAndEncodeField:function(n,t){var i,e,o;if(n&&n[t]){var u=n[t],f=[],r=n.highlights;if(r)for(i=r.length-1;i>=0;i--)r[i].fieldName==t&&r[i].startIndex<u.length&&(f.unshift(u.substring(r[i].endIndex).encodeHtml()),e=jQuery(_ce("span")).addClass("highlight").html(u.substring(r[i].startIndex,r[i].endIndex).encodeHtml()),sutra(e,"$Sutra.SkyDrive.SearchHighlight"),o=jQuery(_ce("span")).append(e),f.unshift(o.html()),u=u.substring(0,r[i].startIndex));return f.unshift(u.encodeHtml()),f.join("")}return""},clearFieldHighlights:function(n,t){var r,i;if(n&&n.highlights)for(r=n.highlights,i=0;i<r.length;)r[i].fieldName==t?r.splice(i,1):i++},getSongForPlayer:function(n){var r,t=n.audio,i;return t&&(i=null,n.thumbnailSet&&(i=n.thumbnailSet.baseUrl+wLive.Core.SkyDriveItemHelper.getThumbnail(n.thumbnailSet,"height128").url),r={songUrl:n.urls.download+b,songTitle:t.title||n.name||l,artistName:t.artist||c("InfoPane.Information.UnknownArtist"),albumArtUrl:i,mimeType:n.mimeType,error:0}),r},getNormalizedExtension:function(n){return n&&g[n.iconType]},getFriendlyFileType:function(n){var f=n.getVersion(),e="friendlyFileTypeVersion";if(n[e]!==f){var s=n.extension,r=s&&s.substring(1).toUpperCase(),u=t.SkyDriveItemHelper.getNormalizedExtension(n),i=o("NoExtension");!u&&n.folder?i=o("Folder"):n.photo&&!n.video?i=o("Image").format(r||"").trim():u?i=o(u):r&&(i=o("Unknown").format(r));n.friendlyFileType=i;n[e]=f}return n.friendlyFileType}}}(),function(){function p(){o=true}function f(t){function e(){t[0].s=u;t[0].src=u}var u;!t&&n.length>0&&(t=n.pop());t&&(!o&&i.length>0&&(r.complete||!r.requiresCookieToss(i[0]))?(u=i.splice(0,1)[0],i.length>0&&n.length>0&&f(),c++,c%10?e():s.DomHelpers.setTimeoutZero(e)):n.push(t))}function w(){var n=this,r=jQuery(n),i=n.s;$WebWatson.submit("Image failed to download.",i,0,null,v,null,null,true);delete t[i];f(r)}function b(){var i=this,r=jQuery(i),u=i.s;delete t[u];n.push(r)}function k(){var u=this,s=jQuery(u),i=u.s,r=t[i],n,o;for(n=0,o=r.length,e[i]=true;n<o;n++)r[n]&&(r[n].src=i);delete t[i];f(s)}var s=wLive.Core,r=s.CookieToss,l="imgPool",a="unload",v=29001,u=wLive.Core.Images={},h=10,n=[],i=[],t={},e={},y=0,c=0,o=false;(function(){function i(){f()}for(var t=0;t<h;t++)n.push(jQuery(document.createElement("img")).bind({error:w,abort:b,load:k}));jQuery(window).bind(a,p);r.complete||jQuery(r).bind(r.eventName,i)})();u.getId=function(){return l+y++};u.isComplete=function(n){return e[n]};u.isIdle=function(){return i.length==0&&n.length==h};u.hasLoadedImage=function(n){return e[n]};u.loadImage=function(n,r){e[n]?r&&(r.src=n):t[n]?t[n].push(r):(i.push(n),t[n]=[r],f())}}(),function(){function f(e,o,k,d,g,nt){function lt(t,i,r,e,o,s){var c=rt[i],a,h,l,v;if(c&&(delete c[r],c.count--,c.count||delete rt[i]),t&&t.items&&!t.error){var y=s&&s!=t.originId,p=y&&vt(tt.getItem(i,true)),w=tt.processResponse(t,i,r);Trace.log("Received response: (fromCache: "+y+", revalidating: "+p+", itemsChanged: "+w+")",u);a=tt.getItem(i,true);a&&w&&a.invalidate(true);p&&tt.fetchItem(i,r,e,o,true)}else h=t?t.error:{debugMessage:"Server returned no success or failure"},l=it(i,"did"),l&&(v=st(l),v&&v.baseUrl&&n.DeviceItem.hasNewBaseUrlError(h,l)&&tt.fetchItem(i,r,e,o,true)),$WebWatson.submit("JSON error",i,0,h.debugMessage,h.code,h.stackTrace,0,true),h.key=i,tt.raiseEvent(f.errorEvent,h)}function st(t){var i=n.PageController.getInstance().getViewContext().deviceItemSet;return i.getByKey(t.toLowerCase())}function dt(i,r){return keyComponents=t.getItemKeyParts(i),n.StringHelpers.caseInsensitiveStringEquals(keyComponents.id,r)||!r&&!keyComponents.id}function it(n,i){var r=t.getItemKeyParts(n);return r[i]}function ht(i,r,u,f,e,o){var a,c,h,s,g,l,y,w,p,k,v,d;if(c=t.getItemKeyParts(r),a=r&&dt(r,i.id)?r:t.getItemKey(i.id,i.ownerCid,i.group,c.qt,c.did,c.q,c.sft),h=tt.getItem(a,true),s=i.folder,!f&&i.parentId&&(f=c.qt==="search"?t.getItemKey("root",undefined,0,c.qt,0,c.q,c.sft):t.getItemKey(i.parentId,i.ownerCid,i.group,c.qt,c.did)),h||(e=true,h=ot[a]=new n.SkyDriveItem(tt,a,f),i.isSpecialFolder&&a!=r&&(g=t.getItemKey(i.specialFolderCanonicalName.toLowerCase(),i.ownerCid,i.group,null,c.did),ot[g]=h)),e=h.processItem(i)||e,s){l=h.getChildren(u);o&&u!=o&&(e=e||h._childSets[o]!==l,h._childSets[o]=l);n.SkyDriveItemHelper.isDeviceRoot(h)&&b(s);(l.modifiedDate!=h.modifiedDate||l.getCount(true)!=s.childCount)&&s.childCount!=undefined&&(!s.groupings||h.hasMoreResults===true||h.hasMoreResults===false||(l.groupings=s.groupings),l.modifiedDate=h.modifiedDate,l.setCount(s.childCount),l._requiresFilter=true,e=true);s.photoCount!==undefined&&(h.folder.photoCount=s.photoCount);var nt=it(r,"qt"),rt=it(r,"q"),ut=it(r,"sft");if(s.children)for(y=s.startIndex||0,y+s.children.length>s.totalCount&&(w=s.totalCount-y,s.children.length=w>0?w:0),p=0,k=y;p<s.children.length;p++,k++)v=s.children[p],d=t.getItemKey(v.id,v.ownerCid,v.group,nt,h.did,rt,ut),e=ht(v,d,u,a,e)||e,e=l.set(k,tt.getItem(d,true))||e}return e}function gt(n){for(var s=n.items,f=n.tokenNeedsRedeeming,e=n.tokenType,i,t,u,h,o,r=0;r<s.length;r++)if(i=s[r],i.id!="root"&&f&&e!=null&&(i.tokenNeedsRedeeming=f,i.tokenType=e,t=i.folder,t&&t.children))for(u=0,h=t.startIndex||0;u<t.children.length;u++)o=t.children[u],o.tokenNeedsRedeeming=f,o.tokenType=e}function ni(t,u,f,e,o,l,a){var w,y,v,b;var k=tt.getItem(t,true),d=at(k),ut=a?a:tt.extraGetItemsParams,g=n.PageController&&n.PageController.getInstance(),nt=g&&g.getViewContext(),p=nt&&nt.viewParams,rt=(l===undefined?"&d=1":"&d="+l)+"&iabch=1&lid="+(d?d.id:"")+"&caller="+wt+"&path="+(l===0||pt(k,t)?"0":"1")+(f?"&sid="+f:"&si="+e)+"&ps="+o+"&pi=5&m="+bt+"&"+h+"="+c+"&"+s+(p&&p.v==FilesConfig.filePickerViewParam&&p.auth==FilesConfig.skyDrivePickerOAuth?"&urlType=2":"")+ut;return $B.Mobile&&(rt+="&isMobile=1"),w=ft,t.indexOf("&did=")!==-1&&(y=st(it(t,"did")),w=y&&y.baseUrl?y.baseUrl:FilesConfig.devicesBaseUrl,v=n.SkyDriveItem.getSetKeyParts(u),v.sd!==undefined&&(b="0",b=v.sb==i.Default||v.sb==i.Name?v.sd==r.Descending?"1":"0":v.sd==r.Ascending?"0":"1",u=u.replace("sd="+v.sd,"sr="+b))),w+"GetItems?"+t+"&"+u+rt}function at(n){for(var t=n?n.getParent(true):null;t&&t.parentKey;)n=t,t=t.getParent(true);return t?n:null}function vt(n){return!n||n.hasExpired()}function yt(n){return n&&it(n,"qt")==="search"&&it(n,"id")==="root"}function ti(n){return n&&it(n,"qt")==="recyclebin"&&it(n,"id")==="root"}function pt(n,t){var i=at(n);return yt(t)||ti(t)?false:!!(n&&!n.parentKey||i&&tt.getItem(i.parentKey,true))}function ii(t){var i=ft+"GetGroupInfo?"+t+"&retrieveMembership=true",r=new n.DataRequest(i,i,null,function(i){var r=new n.GroupInfo(i.groupInfo,t);ct[t]=r;tt.raiseEvent(f.groupInfoChangedEvent)});r.start()}var tt=this;tt.extraGetItemsParams="";var ft=e||null,wt=d||"",ri=o||"",bt=g||"",et=nt||100,ui=k||"";var ot=[],kt=1,ct=[],rt={},ut=null;tt.hasPendingRequests=function(n){return!!rt[n]};tt.abortPendingRequests=function(n){var t=rt[n],i,r;if(t){for(i in t)i!=="count"&&(r=t[i],r.abort());delete rt[n]}};tt.getItem=function(n,i,r,f){var e=null,o,s;return n&&(e=ot[n]||null,i||(o=vt(e),s=pt(e,n),(o||!s&&e.id!=="root")&&tt.fetchItem(n,f||t.getDefaultSetKey(),null,0,false,e?null:r)&&Trace.log("getItem miss - exists: "+!!e+", expired: "+o+", hasAncestors: "+s+", key: "+n,u))),e};tt.processResponse=function(u,f,e){var s=false,d,h,o,v,c,y,p,w,l,a,b,k;if(e=e||t.getDefaultSetKey(),d=e,u&&u.items&&!u.error){for(h=it(f,"did"),o=n.SkyDriveItem.getSetKeyParts(e),(o.sb==i.Default||o.sd==r.Default)&&(h?(v=o.sb==i.Default?i.Name:o.sb,c=o.sd,c==r.Default&&(c=v!=i.Name?r.Descending:r.Ascending),e=n.SkyDriveItem.getSetKey(v+"",null,o.ft,o.gb,c+"")):e=n.SkyDriveItem.getSetKey(u.sortOrder+"",null,o.ft,o.gb,u.sortDirection+"")),y=u.items,gt(u),p=u.baseUrl,h&&p&&(w=st(h),w&&(w.baseUrl=p)),l=0;l<y.length;l++)s=ht(y[l],f,e,null,s,d)||s;a=tt.getItem(f,true);(u.lastVersion!==undefined||a&&n.SkyDriveItemHelper.isSkyDriveRoot(a)&&n.SkyDriveItemHelper.isViewerOwner(a))&&(b=FilesConfig.lastVersion||u.lastVersion,k=b?b.split(","):[],FilesConfig.lastVersion=k[0]||"0",FilesConfig.freRenderIndex===undefined&&(FilesConfig.freRenderIndex=Number(k[1]||"0")))}return s};tt.suspendChangeEvents=function(){ut||(ut=[])};tt.resumeChangeEvents=function(){if(ut){var n=ut;for(ut=null;n.length;)tt._fireDataChanged(n.pop())}};tt.createSubfolder=function(t,i,r,u){var f=ft+"AddFolder?"+s,e={parentId:t.id,cid:t.ownerCid,group:t.group,name:i.name},o;n.SkyDriveItemHelper.isRootItem(t)&&n.PageController&&n.PageController.getInstance().getViewContext().viewParams.sc=="photos"&&(e.category=1);o=new n.DataRequest(f,f,Object.toJSON(e),function(n){var u=n?n.item:null;i.processItem(u);t.updatePinnedSubfolderKey(i);ot[i.key]=i;t.expire();t.invalidate();r&&r(n,i)},function(n){u&&u(n,i)});o.start()};tt.updateItem=function(i,r,u,f,e){var o=ft+r+"?"+s,h=new n.DataRequest(o+Math.random(),o,u,function(n){var r=n&&n.item,u;r&&(u=t.getItemKey(r.id,r.ownerCid,r.group),ht(r,u)&&tt.getItem(u).invalidate());f&&f(n,i)},function(n){if(e){var t=tt.getItem(i.key,true);e(n,t)}});h.start()};tt.updateItemProperties=function(n,t,i,r){var u=n.parentId;t.id=n.id;u&&u!=="root"&&(t.lid=n.parentId);t[h]=c;tt.updateItem(n,"UpdateItem",Object.toJSON(t),i,r)};tt.updateItemProperty=function(n,t,i,r,u,f){var o="",e;f&&(o=', "overrideLock":"true"');var a=n[t],s=n[t]=i,l=n.extension;t==="name"&&l&&(s+=l);n.invalidate();e=n.parentId;tt.updateItem(n,"UpdateItem",'{"id":"'+n.id+'","'+t+'":"'+s.encodeJson()+(e&&e!=="root"?'","lid":"'+e.encodeJson():"")+'","'+h+'":"'+c+'"'+o+"}",r,function(n,r){u(n,r);r[t]===i&&(r[t]=a,r.invalidate())})};tt.getPlaceholderItem=function(t,i,r,u){var f=new n.SkyDriveItem(tt,t,null),e=r?1:0;return f.processItem({name:i,folder:{totalCount:e,childCount:e},isPlaceholder:true,id:it(t,l),ownerName:"",ownerCid:it(t,a).toUpperCase()}),mix(f,u),f};tt.getLoadingItem=function(n){return tt.getPlaceholderItem(n,"",true,{_isLoadingItem:true})};tt.getGroupInformation=function(n,t,i){var r,u,f;return r="cid="+n.toLowerCase().encodeUrl(),u=i.viewParams,u.authkey&&(r+="&authkey="+(u.authkey||"").encodeUrl()),u.ticket&&(r+="&ticket="+(u.ticket||"").encodeUrl()),f=ct[r],f||ii(r,t,kt),f};tt.ensureCompletelyDownloaded=function(n,i,r,f,e){function l(n){Trace.log("EnsureCompletelyDownloaded fetch error: itemKey - "+h+" setKey - "+f,u);r(n)}function c(){var a=true,y=0,t,p,b,k,v;if(s!=n.modifiedDate&&(Trace.log("EnsureCompletelyDownloaded refresh loop detected: modifiedDateChanges - "+o+" itemModifiedDate - "+s+" item.modifiedDate - "+n.modifiedDate,u),o++,s=n.modifiedDate),o>w)Trace.log("EnsureCompletelyDownloaded refresh loop hit: modifiedDateChanges - "+o+" itemModifiedDate - "+s+" item.modifiedDate - "+n.modifiedDate,u),r(null);else{if(t=n.getChildren(f),t){if(t.isComplete())a=true;else if(e){for(p=0;p<e.length;p++)if(b=e[p],!t.get(b,true)){a=false;y=b;break}}else for(k=t.getCount(),v=0;v<k;v++)if(!t.get(v,true)){a=false;y=v;break}}else a=false;a?i(n):(Trace.log("EnsureCompletelyDownloaded fetch item: itemKey - "+h+" setKey - "+f+" fetchIndex - "+y,u),tt.fetchItem(h,f,null,y,false,null,c,l))}}f=f||t.getDefaultSetKey();var h=n.key,o=0,s=n.modifiedDate;c()};tt.fetchItem=function(t,i,r,u,f,e,o,s,h,c){var k=et,ut,b,w;r||(u-=u%et,u&&(u-=et,k=et*2));var ot=tt.replaceGetItemsUrl&&tt.replaceGetItemsUrl(t,ft),d=ot||ni(t,i,r,u,k,h,c),g=tt.getItem(t,true),l=Math.random(),nt=tt.getItem(t,true);nt&&nt.hasExpired()&&(f=true);ut=n.Search&&yt(t)&&!f?n.Search.getSearchOrigin(it(t,"q")):(g||e)&&!f?e||g.modifiedDate:l;var st=FilesConfig.authKey?"&authkey="+FilesConfig.authKey.encodeUrl():FilesConfig.ticket?"&ticket="+FilesConfig.ticket.encodeUrl():"",ht=d+"&v="+ut+st,ct=!!n.SkyDriveItem.getItemKeyParts(t).did,a=new n.DataRequest(d,ht,null,function(n){lt(n,t,i,r,u,l);o&&o(tt.getItem(t,true))},function(n){lt(n,t,i,r,u,l);s&&s(n?n.error:null)},ct?y:v);return a.originId=l,a.failureReentranceDelay=p,b=a.start(),b&&(w=rt[t]=rt[t]||{},w[i]=a,w.count=(w.count||0)+1),b};tt.dispose=function(){for(var n in rt)rt[n].abort();tt.disposeEvents()};tt._fireDataChanged=function(n){ut?ut.push(n):tt.raiseEvent(f.dataChangedEvent,n)}}function b(n){var r,u;if(n.childCount!==undefined){var e=n.childCount,i=[],f=[],t=null;for(r=0;r<e;r++)u=n.children[r],u.isHeader?(t&&t.count&&f.push(t),t={groupingId:"folder",name:u.name,startIndex:i.length,endIndex:i.length,count:0}):(t.endIndex=i.length,i.push(u),t.count++);t&&t.count&&f.push(t);n.groupings=f;n.children=i;n.totalCount=i.length;n.childCount=i.length}}var n=wLive.Core,i=n.JSONConstants.SortField,r=n.JSONConstants.SortDirection,e,o;var l="id",a="cid",s="lct=1",h="rset",c=$B.Mobile?"web_mobile":"web",u="DataModel",t=n.SkyDriveItem,v=3e4,y=15e4,p=2e3,w=3;n.DataModel=f;n.DataModel.dataChangedEvent="dataChanged";n.DataModel.groupInfoChangedEvent="groupInfoChanged";n.DataModel.errorEvent="error";e=f.prototype;o=n.Events;e.addListener=n.Events.addListener;e.removeListener=o.removeListener;e.disposeEvents=o.disposeEvents;e.raiseEvent=o.raiseEvent}(),function(){function f(){return i||(i=wLive.Core.PageController.getInstance().getViewContext()),i}function r(t){return t?t.encodeURIComponent():n}function u(n,t,i,r){var u=n?n.ownerCid:null;return r?r:u||t.callerCid}var n="",i=null,t=wLive.Core.SkyDriveItemHelper;wLive.Core.ItemActionHelper={itemStringFormat:function(i,e,o,s){var h=f();return i.itemFormat({item:e,$Config:window.$Config,FilesConfig:window.FilesConfig,ViewContext:h},{encodeUrl:function(t){return t?t.encodeUrl():n},encodeURIComponent:r,cid:u,cidQueryString:function(i,f,e,o,s){var h=s||i&&i.group,c=i&&t.isSearchQuery(i)&&i.id=="root",l=i&&t.isRecycleBinQuery(i);return c?"qt=search&q="+t.getSearchQuery(i):"cid="+r(u(i,f,e,o))+(h?"&group=1":n)+(l?"&qt=recyclebin":n)},profileDomain:function(n,t,i,r,u){var f=u===true||u===false?u:n&&n.group;return f?i.groupsDomain:i.profileDomain},groupsDomain:function(){return FilesConfig.groupsDomain},groupEmail:function(n){return n&&t.isGroupRoot(n)&&n.groupEmail?n.groupEmail:""},deviceIdQueryString:function(t){return t&&!!t.did?"&did="+t.did.encodeURIComponent():n},resIdQueryString:function(t){return!t||t.id=="root"?n:"&resid="+t.id.encodeURIComponent()},appQueryString:function(t){var r=wLive.Core.SkyDriveItemHelper.getNormalizedExtension(t),i=null;switch(r){case"Doc":i="Word";break;case"Xls":i="Excel";break;case"Ppt":i="PowerPoint";break;case"One":case"OneNotebook":i="OneNote"}return i?"&app="+i:n},authKeyQueryString:function(t,i){var r=i.viewParams;return r.ticket?"&ticket="+r.ticket:r.authkey?"&authkey="+r.authkey:n},idQueryString:function(t){return!t||t.id=="root"?n:"&id="+t.id.encodeURIComponent()},parentIdQueryString:function(t){return t.parentId&&!t.directlyShared?t.parentId=="root"?n:"&id="+t.parentId.encodeURIComponent():n},parentId:function(t){return(t.parentId||n).encodeURIComponent()},isFolder:function(n){return n.folder?1:0},scenario:function(t,i){return i.viewParams.sc?"&sc="+i.viewParams.sc:n},queryType:function(t,i){return i.viewParams.qt?"&qt="+i.viewParams.qt:n},searchParams:function(i,r){var u=i&&t.isSearchResult(i),f=i&&(i.photo||i.video||i.isProcessingVideo||r.currentViewType==="SelfView");return u&&f?"&qt=search&q="+t.getSearchQuery(i):n},viewQueryString:function(t,i){return i.viewParams.v?"&v="+i.viewParams.v:n}},[e,h,window.FilesConfig,o,s])}}}(),function(){function i(n,t,i){for(var r=false;!r&&n&&n.parentKey!=null;)r=n.folder&&n.folder.category===i,n=t.dataModel.getItem(n.parentKey,true);return r}var n=wLive.Core,t=n.SkyDriveItemHelper;t.getLoadedThumbnailUrl=function(t){var f,i,e,r,o,u;if(i=t.thumbnails,i)for(e=i.length,r=0;r<e;r++)if(o=i[r],u=t.baseUrl+o.url,n.Images.isComplete(u)){f=u;break}return f};t.isFavoritesLib=function(n,t){return i(n,t,2)};t.isPhotoAlbum=function(n,t){return i(n,t,1)};t.getIcon=function(t,i){var f,r,e,u,o,s;if(f="ft_"+i+"_"+t.iconType,r="icon"+i+f,!t[r]){if(this.isRootItem(t)&&i===16)return n.ImageStrip.getImage("skydrive_16",t.ownerName);if(this.isGroupRoot(t))return n.ImageStrip.getImage("groups",t.ownerName);e=t.name;u=n.ImageStrip.getImage(f,e);u||(o=i===16?"tiny":i===32?"smaller":"small",s=(FilesConfig.foldersImgBaseUrl+"/icons/{0}/{1}.png").format(o,t.iconType),u=$IS.Create(0,0,i,i,FilesConfig.imgBaseUrl,s,e,""));t[r]=u}return t[r].cloneNode(true)}}(),function(){function w(r,w){function g(){return nt?nt:"cid-"+ut}var b=this,it=$Utility.deserialize(w,"&",false,false),nt=r.groupAlias,ft=r.displayName,d=r.email,k=r.membershipState,tt=r.permissions,rt=r.membership,ut=it.cid;b.emailHtml=function(){var n,r,t,o;return d&&d!==e?(r=s.format(d.encodeUrl()),n=i.format(r.encodeHtmlAttribute(),d.encodeHtmlAttribute()),t=jQuery(n),t.click(f(null,"EG",u)),n=t):k&&k>5&&(o=y.format(g().encodeUrl()),n=a+'<br /><a href="'+o.encodeHtmlAttribute()+'">'+v+"<\/a>"),n};b.emailTitle=function(){return d};b.emailHistoryHtml=function(){var n,r,t;return d&&d!==e&&(r=c.format(d.encodeUrl()),n=i.format(r.encodeHtmlAttribute(),l),t=jQuery(n),t.click(f(null,"VGE",u)),n=t),n};b.membershipHtml=function(){var i;return k&&k>3&&(i=n(t+".Membership"+k)),i};b.permissionsHtml=function(){var i;return tt!=null&&(i=n(t+".Permissions"+tt)),i};b.groupOptionsLink=function(){var n,r,t;return k&&k>4&&(r=o.format(g().encodeUrl()),n=i.format(r.encodeHtmlAttribute(),h),t=jQuery(n),t.click(f(null,"VGO",u)),n=t),n};b.canInvite=function(){return k&&k>5};b.groupMembership=function(){return rt};b.membershipPageLink=function(n){var t=p.format(g().encodeUrl());return i.format(t.encodeHtmlAttribute(),n)}}var r=wLive.Core,n=r.AleHelpers.getPCString,i='<a href="{0}">{1}<\/a>',t="GroupInfo",e="",u="IPR",s=FilesConfig.groupMailUrl,o=FilesConfig.groupsDomain+"{0}/options",h=n(t+".ViewGroupOptions"),c=FilesConfig.groupMailSearchUrl,l=n(t+".ViewEmail"),a=n(t+".EmailTurnedOff"),v=n(t+".TurnOnEmailLinkText"),y=o+"/email",p=FilesConfig.groupsDomain+"{0}/membership/",f=r.BiciHelpers.prependBiciReportClickAction;r.GroupInfo=w}(),function(){function t(){this._actions={}}var i=wLive.Core,n;i.ActionManager=t;n=t.prototype;n.registerAction=function(n,t){this._actions[n]=t};n.isActionRegistered=function(n){return this._actions[n]?true:false};n.getAction=function(n){var t=this._actions[n];return t?t.getAction.apply(t,arguments):null};n.doAction=function(n){n&&(n.click&&n.click(),n.url&&$BSI.navigateTo(n.url,n.target))};t.getATagAction=n.getATagAction=function(n,t,r){var u=n.click||function(){return $BSI.navigateTo(n.url),false},f=n.skyCmd;return t&&f&&(u=n.click=i.BiciHelpers.prependBiciReportClickAction(u,f,t)),r&&(n.click=function(n){return r(n,u)}),n};t.setATagAction=n.setATagAction=function(n,i,r,u){return i=i||jQuery(_ce("a")),n=t.getATagAction(n,r,u),n.click&&i.bind("click.action",n.click),i.attr("href",n.url||"#"),n.target&&i.attr("target",n.target),i}}(),function(){function i(){var n=this;n.execute=function(n,i){$Do.when("Bucket4.js",0,function(){$Do.when(t+n,0,i)})};n.register=function(n,i){$Do.register(t+n,function(t){i(n,t)})}}var n=wLive.Core,r,t;n.OperationManager=i;r=new i;t="Operation_";n.OperationManager.getInstance=function(){return r};n.OperationManager.Current=new i}(),function(){function n(){function ot(n,t){var i,e;i=gt(t);switch(i){case u:at(n);l=n;break;case f:vt(n,t);break;case r:yt(n);l=n}e=s.getSelection();a=e.selectionCount===0?-1:n}function at(n){!tt&&lt(n)&&y();bt(n)}function vt(n,t){var i;t.ctrl||(h={},v={},k(l));var r=s.isSelected(c,l),u=Math.min(Math.min(l,a),n),f=Math.max(Math.max(l,a),n),e=Math.max(Math.min(l,n),0),o=Math.max(Math.max(l,n),0);for(i=u;i<=f;i++)i>=e&&i<=o?i!==l&&(r&&(!tt&&!lt(i)||tt)?pt(i):wt(i)):(delete h[i],delete v[i])}function st(n){return n=n||{},n.ctrl=nt&&n.ctrl,n.shift=nt&&n.shift,n}function yt(n){var t=s.getSelection(),i=t&&t.selectionCount===1&&s.isSelected(c,n);y();i||k(n)}function y(){h={};v={};p=false;a=-1;l=-1}function pt(n){k(n)}function wt(n){delete h[n];delete v[n]}function bt(n){s.isSelected(c,n)?(delete h[n],delete v[n]):k(n)}function kt(n){for(var t=n;h[t]!=null;)t--;return t}function dt(n){for(var t=n;h[t]!=null;)t++;return t}function it(n){var r=false,u,f;return n||(r=true),!t(n,c)&&n&&(r=true,c=n),u=i.SkyDriveItem.getDefaultSetKey(),ft!==u&&(ft=u),n&&(f=n.getChildren(),rt||(d=f.getGroupings()),w=f.getCount()),r}function gt(n){var t=n&&n.ctrl,i=n&&n.shift;return i?f:t?u:r}function ht(n){var i=0,r;for(r in b)i++;return i>1&&!t(n,c)?true:false}function ni(n,i){var r=t(n.parent,i.parent)&&n.relationshipsKey===i.relationshipsKey&&n.inPreselectionMode===i.inPreselectionMode&&n.selectionCount===i.selectionCount,u,e,f;if(r){u=n.indexes;e=i.indexes;for(f in u)if(u[f]!==e[f]){r=false;break}}return r}function ct(n){for(var i,t=0;t<d.length;t++)if(i=d[t],i.startIndex<=n&&i.endIndex>=n)return t;return-1}function lt(n){for(var t in h){if(ct(n)!=ct(t))return true;break}return false}function k(n){h[n]=parseInt(n);var t=c.getChildren().get(n,true);t&&(v[n]=t)}function g(n,t){var r=s.getSelection(),i;return it(t)&&y(),i=n(),ni(r,s.getSelection())||ti(),i}function ti(){ut.trigger(n.SelectionChangedEvent,[s.getSelection()])}var s=this,ut=jQuery(s),c,ft,w,d=[],rt=false,b={},et={},h={},v={},p=false,a=-1,l=-1,nt=true,tt=true;s.dispose=function(){y();c=null;b=null;s=null;ut=null};s.setMultiSelectEnabled=function(n){nt=n};s.setCrossGroupSelectEnabled=function(n){tt=n};s.registerList=function(n,t){b[n]=t;et[t.key]=n};s.unregisterList=function(){et={};b={}};s.clickSelect=function(n,t,i){i=st(i);g(function(){ot(t,i);p=i&&i.preselect},n)};s.keyboardSelect=function(n,t,i){return(i=st(i),ht(n))?true:g(function(){var n=a,r=i.shift,u,f;switch(t){case e:n!==-1?(u=r?n-1:kt(n),n=Math.max(0,u)):(it(b[0]),n=w-1);break;case o:n!==-1?(f=r?n+1:dt(n),n=Math.min(w-1,f)):(it(b[0]),n=0);break;default:return true}if(n!==a)i.ctrl=false,ot(n,i);else return true;return false},n)};s.resolveSelection=function(t){var i=n.ResolveSuccess,r=t?t.getChildren():null,f,p,c,u,e,o,l;if(r&&r.getCount()!==0){if(f={},p=s.getSelection(),it(t))i=n.ResolveFailed;else if(r.get(0))for(c in h)u=v[c],e=u?r.indexOf(u,false,true):-1,e>-1?f[e]=u:i=n.ResolveFailed;else i=n.ResolveWaiting;i===n.ResolveSuccess?(o=v[a],l=o?r.indexOf(o,false,true):-1,g(function(){y();for(var n in f)k(n);a=l},t)):i===n.ResolveFailed&&s.deselectAll()}else s.deselectAll();return i};s.selectAll=function(n){return ht(n)||!nt?true:(g(function(){y();for(var n=0;n<w;n++)k(n)},n),false)};s.deselectAll=function(n,t){t?y():g(function(){y()},n)};s.getSingleSelectedItem=function(n){var t,i=this.getSelection(),r;if(n&&i.selectionCount===1)for(r in i.indexes){t=n.getChildren().get(r);break}return t};s.multipleSelected=function(){var n=0,t;for(t in h)if(h.hasOwnProperty(t)&&(n++,n>1))break;return n>1};s.anySelected=function(){var n=false,t;for(t in h)if(h.hasOwnProperty(t)){n=true;break}return n};s.getSelection=function(){var n=0,t;for(t in h)n++;return{parent:c,inPreselectionMode:p,indexes:h,selectionCount:n,lastInteractedIndex:a}};s.getSelectedItems=function(n){var f,e;var o=i.PageController.getInstance().getViewContext(),h=o.dataModel,t=s.getSelection(),r=t.parent,u=[];for(f in t.indexes)u.push(f);e=i.SkyDriveItem.getDefaultSetKey();h.ensureCompletelyDownloaded(r,function(){var i=[],u,f;for(u in t.indexes)f=r.getChildren(e).get(u),i.push(f);n(i)},function(){Trace.log("Failed to get the selected items for: "+r.key,"Selection Manager")},null,u)};s.isSelected=function(n,i){return t(n,c)&&h[i]===i};s.hasPreselectedChild=function(n){return t(n,c)&&p};s.resetPreselectionFlag=function(){p=false};s.setGroupings=function(n){n?(d=n,rt=true):(d=c?c.getChildren().getGroupings():[],rt=false)}}var i=wLive.Core,t=i.SkyDriveItem.areItemsSame,e=38,o=40,r=0,u=1,f=2;n.SelectionChangedEvent="selectionChanged";n.ResolveFailed=-1;n.ResolveWaiting=1;n.ResolveSuccess=2;wLive.Core.SelectionManager=n}(),function(){function r(){function i(){var u=window.FilesConfig,t=u.notificationBarMessages,r,i;if(t)for(r in t)i=t[r],typeof i=="object"&&n.add(i)}function r(n,t){return n.priority!=t.priority?n.priority-t.priority:n.type-t.type}var n=this;n._errors=[];n.errorReceivedEventName="errorreceived";n.errorClearedEventName="errorcleared";n.add=function(i){var f,e,u,o,s;i.priority|=0;i.type|=0;i.type==0&&$Config.hc&&i.$element&&(f="Help",e=i.$element.children("a").length>0,e?f="Other":i.code?(u=null,$Config.hc.slcList&&$Config.hc.slcList[i.code]?(f="SLC",o="&nbsp;"+t("ErrorStatusMessage"),s='<a href="'+$Config.hc.slcUrl+'" target="_blank">'+t("ErrorStatusLinkLabel")+"<\/a>",u=jQuery("<span/>",{"class":"errorHelpLink",html:o.format(s)}),u.click(function(){$BSI.reportEvent("ClickSelected.SLC.SkyDriveInProductLink",{CMXErrorCodeSD:i.code})}),$BSI.reportEvent("Action.SLC.SkyDriveOutageError",{CMXErrorCodeSD:i.code})):(u=jQuery('<span class="errorHelpLink">&nbsp;<a target="_blank">'+$Config.hc.label+"<\/a><\/span>"),$HelpContext.attachContextTo(u.children("a"),i.code,i.$element.text())),i.$element.append(u)):(i.code="noCode",f="None"),$BSI.reportEvent("Log.WL.ErrorDisplayed",{WLErrorProduct:$Config.prop,WLErrorCode:i.code,WLErrorLinkType:f}));n._errors.push(i);n._errors.sort(r);jQuery(n).trigger(n.errorReceivedEventName)};n.removeAt=function(t){var i=n._errors&&n._errors.length;i>0&&t>=0&&t<i&&(n._errors.splice(t,1),n._errors.length===0&&jQuery(n).trigger(n.errorClearedEventName))};n.clear=function(){n._errors.length>0&&(n._errors=[],jQuery(n).trigger(n.errorClearedEventName))};n.dismiss=function(){var t=n._errors;t.length>0&&t[0].dismissCallback&&t[0].dismissCallback();n.clear()};n.getErrors=function(){return n._errors};i()}var n=wLive.Core,t=n.AleHelpers.getString,i=wLive.Controls,u=i.Notifications;n.ErrorManager=r}(),function(){var t=wLive.Core,n=wLive.Controls;t.PopoverManager={showPopover:function(i,r){$Do.when("Bucket3.js",0,function(){var u=new n[i](t.PageController.getInstance().getViewContext());u.show(r)});!n[i]}}}(),function(){var t=wLive.Core,n=wLive.Controls,i=t.AleHelpers.getPCString;n.CommandBarHelper={populateSharedCommands:function(r,u,f,e,o,s){s=s||"";var h,c=function(t,r){h=h||t;var u=i(t.stringId+s+"Command")||t.string,f=n.CommandBarHelper.createNavLink(t.action,t.sutraId,u,r,"CB")},l=function(t,r,u){var b=r,c=[],l,a,p,w,f,e,v,o,y;if(u(c),l=c.length,l){if(l===1)a=c[0];else{for(p=t+s+"Menu",w=n.CommandBarHelper.createNavLinkElement(i(p)),t==="Open"?(f=n.SplitMenu.create(),e=f.getMenu()):e=n.Menu.create({html:w}),v=0;v<l;v++)e.push(c[v]);f?(o=h.action,y=f.getLink(),y.setHtml(w),y.setUrl(o.url),o.click&&y.addClick(o.click,o.url),a=f):a=e;sutra(e._$a,"$Sutra.SkyDrive."+p)}b.push(a)}},a=function(n){var i=n.array||n,r=i.length,t;r&&(t=i[r-1],t.removeSeparator(),t.addSeparator())};t.CommandManager.processCommands(r,u,f,o,c,l,a,e)},initializeCommandBar:function(n,t){var i,r;return window.$CommandBar?(sutra($CommandBar.$obj,t),i=n.actionManager.getAction("SkyDriveRoot"),i&&(r=$CommandBar.getDataModel().logo,r.setProperty("url",i.url)),$CommandBar):undefined},createNavLink:function(i,r,u,f,e,o){var s=null,c=i.skyCmd,h,l;return c&&(i.click=t.BiciHelpers.prependBiciReportClickAction(i.click,c,e)),i.html=n.CommandBarHelper.createNavLinkElement(u,o),s=n.NavLink.create(i),h=i.url,h&&h.indexOf("http")===0&&(l=i.target||"_top",s._$a.attr("target",l)),sutra(s._$a,"$Sutra.SkyDrive."+r+"Command"),f.push(s),s},createNavLinkElement:function(n,t){var i=jQuery(_ce("span"));return t?(i.append(wLive.Core.ImageStrip.getImage(t)),i.append("&nbsp;"+n.encodeHtml())):i.text(n),i}}}(),function(){function u(n,t,i,r,f,e,s,h,c){for(var g=i.length,p,w,b,v=0;v<g;v++){var l=mix({},i[v]),a=l.command,k=l.commandGroup;if(a){var y=t.getAction(a,r),nt=l.alias||a,d=f&&f[nt];y&&(!l.isEnabled||l.isEnabled(n,r))&&(!d||d(n,r))&&(l.action=y,l.id=a,p=l.getStringId,l.stringId=p&&p(n,r)||a,l.string=y.string||o(l.stringId+"Command"),w=l.getSutraId,l.sutraId=w&&w(r)||a,e(l,c))}else k?(b=function(i){u(n,t,l.members,r,f,e,s,h,i)},s?s(k,c,b):b(c)):h&&h(c)}}function t(n,t){var i=n.currentItem,r=i.key;return n.currentViewType!=="SetView"||i.folder||(r=i.parentKey),r===t.key}function i(n,i){return!t(n,i)}function s(t,i){return n.SkyDriveItemHelper.isGroupRoot(i)}function h(t,i){return!n.SkyDriveItemHelper.isRootItem(i)}function c(n,t){var r=n.actionManager.getAction("DefaultClick",t),u=r&&r.name,f=u==="ViewItem";return i(n,t)&&f}function f(n,i){return!r(n)&&(t(n,i)||!n.actionManager.getAction("Abdicate",i))}function e(){return true}function l(n,t){return!t.form}function r(n){return n.viewParams.qt=="recyclebin"}function a(n){return!n.tokenHasBeenRedeemed}var n=wLive.Core,o=n.AleHelpers.getPCString;n.CommandManager={processCommands:function(t,i,r,f,e,o,s,h){var c=i,l=t.actionManager;i||(c=r,l=t.multiselectActionManager);u(t,l,n.CommandManager._commands,c,f,e,o,s,h)},commandDisabled:function(){return false},isCurrentItem:function(n,i){return t(n,i)},isNotCurrentItem:function(n,t){return i(n,t)},isDeleteEnabled:function(n,t){return f(n,t)},isOwnerRequestReviewEnabled:function(n,t){return e(n,t)},isRecycleBinItem:function(n){return r(n)},_commands:[{commandGroup:"Survey",members:[{command:"SendSurvey"},{command:"PreviewSurvey"},{command:"EditSurvey"}]},{command:"SlideShow"},{isEnabled:c,command:"ViewItem"},{commandGroup:"Open",members:[{getStringId:function(n,t){var i=t;return i.form?"OpenWorkbookInExcelWebApp":undefined},command:"OpenInExcelWebApp"},{command:"OpenInOneNoteWebApp"},{isEnabled:i,command:"OpenInPdfWebApp"},{command:"OpenInPowerPointWebApp"},{command:"OpenInWordWebApp"},{isEnabled:l,command:"OpenInExcel"},{command:"OpenInOneNote"},{command:"OpenInPowerPoint"},{command:"OpenInWord"},{command:"OpenInVisio"},{command:"OpenInProject"},{command:"OpenInPublisher"},{command:"OpenInExpo"}]},{alias:"TopLevelDownload",command:"Download"},{command:"Play"},{command:"Restore"},{isEnabled:r,command:"Delete"},{command:"CopyToSkyDrive"},{command:"ViewOrginal"},{commandGroup:"Share",members:[{getStringId:function(n,i){var r,u=i;return u.form&&u.isViewerOwner()?r="ShareWorkbook":t(n,i)&&n.actionManager.getAction("Share",i)&&(i.video?r="ShareVideo":i.photo&&(r="SharePhoto")),r},getSutraId:function(){return"Share"},command:"Sharing"},{command:"ShareParent"}]},{alias:"TopLevelEmbed",command:"Embed"},{isEnabled:a,command:"AddToShared"},{commandGroup:"Manage",members:[{alias:"NestedDownload",command:"Download"},{alias:"NestedEmbed",command:"Embed"},{isEnabled:t,command:"OrderPrints"},{},{command:"RemoveFromMRU"},{isEnabled:i,command:"Rename"},{alias:"NestedDelete",isEnabled:f,command:"Delete"},{command:"Abdicate"},{command:"ReportAbuse"},{command:"Move"},{command:"Copy"},{},{command:"ViewVersions"},{},{command:"OpenFileLocation"},{command:"ViewInFolder"},{isEnabled:e,command:"OwnerRequestReview"},{isEnabled:h,command:"Properties"}]},{commandGroup:"Group",members:[{command:"GroupSendMail"},{command:"GroupViewMail"},{},{command:"GroupDiscussions"},{command:"GroupInvite"},{command:"GroupMembership"},{},{command:"ViewGroupCalendar"},{command:"AddGroupCalendar"},{isEnabled:s,command:"Properties"}]},{command:"GroupProfile"},{command:"GroupOptions"},{command:"Deselect"}]}}(),function(){function s(t,r){return n.isCurrentItem(t,r)||i.isSearchResult(r)}function h(n,t){return i.isMruQuery(t)}function c(n){return n.currentViewType==="SetView"}function a(n,i){function w(n,t){return c.hide(),t(null,null,null,null,n.target)}function b(n){var t=n.which;return t===o||t>36&&t<41?(c.hide(),false):undefined}function p(){c.hide()}var c=this,h,s,v=false,y,a;i&&(a=jQuery(i.selectionManager),a.bind(t.SelectionManager.SelectionChangedEvent,p));c.render=function(n,o,a){function rt(n,i){var u=i,r=t.ActionManager.setATagAction(n.action,null,a.bici,w),f;r.html(n.string.encodeHtml());sutra(r,"$Sutra.SkyDrive."+n.sutraId+"Command");!$B.IE&&r instanceof jQuery&&r.attr("tabindex",1);f=jQuery("<li><\/li>").append(r).appendTo(u)}function ut(n,t,i){var e=t,o=jQuery("<ul><\/ul>"),u,f;i(o);u=o.children();f=e.children();u.length>1&&(f.length>0&&f.last().find(".c_ms").length===0&&f.last().append(r),u.last().append(r));e.append(u);e.append(u)}var g,nt,tt,k,p,it,d;if(y=a.ev,v=true,g=o&&o.selectionCount,g===1)for(nt in o.indexes){tt=o.parent;n=tt.getChildren().get(nt);break}s?(s.dispose(),s=null):i.itemScopedDisposables.push(c);h&&h.remove();h=jQuery(f).appendTo(document.body);k=a.pos;h.css({left:k.x,top:k.y});p=jQuery(u).bind("keydown",b).bind(e,function(){return false});sutra(p,"$Sutra.SkyDrive.ContextMenu");t.CommandManager.processCommands(i,n,o,l,rt,ut,null,p);it=p.children();it.last().find(".c_ms").remove();h.append(p);d=h.get(0);window.$menu.create(y,0,{menuEl:p.get(0),sourceEl:d,parentEl:document.body});s=d.menu};c.hide=function(){v&&(s&&s.hide(),v=false)};c.dispose=function(){s&&(s.dispose(),s=null);h&&h.empty();a&&a.unbind(t.SelectionManager.SelectionChangedEvent,p)}}var t=wLive.Core,n=t.CommandManager,i=t.SkyDriveItemHelper,v=t.AleHelpers.getPCString,u='<ul class="c_m t_hovl"><\/ul>',f='<div class="c_mp co_me" style="position:absolute;"><\/div>',r='<span class="c_ms"><\/span>',e="contextmenu",o=27,l={NestedDownload:n.commandDisabled,NestedShare:n.commandDisabled,NestedEmbed:n.commandDisabled,OpenFileLocation:s,Properties:n.isNotCurrentItem,Rename:c,ShareParent:n.commandDisabled,SlideShow:n.commandDisabled,ViewInFolder:h,NestedDelete:n.isDeleteEnabled,OwnerRequestReview:n.isOwnerRequestReviewEnabled};wLive.Controls.ContextMenu=a}(),function(){var n=window.wLive;n.Controls.EditableTextOptions=function(){};n.Controls.EditableTextOptions.prototype={n:"name",gdt:function(){},snp:false,v:function(){return"defaultValue"},g:true,c:false,ml:0,de:false,ca:"ClickAction",ac:"actionClass",ic:"inputClass",ec:"editClass",gem:function(){},get:function(){},sc:function(){},aa:"authAction",ea:"editAction"}}(),function(){function u(n){return n/1e4-h}function f(n,i,r){var h=new Date,k=u(n),e=h.getTime()-k,f=tt(e),o=it(e),s=rt(e);return f>0?f<7?(f==1?c:l).format(f):i?i:t.DateFactory.getFormattedDate(n):o>0?(o==1?a:v).format(o):s>0?(s==1?y:p).format(s):r?b:w}function tt(n){return n==0?0:Math.floor(n/864e5)}function it(n){return n==0?0:Math.floor(n/36e5)}function rt(n){return n==0?0:Math.floor(n/6e4)}function o(){s(r,[],0)}function s(n,t,i){for(var h,u=Math.min(i+nt,n.length),f=i;f<u;f++)h=n[f],ut(h)&&t.push(h);u<n.length?setTimeout(function(){s(n,t,u)},10):(r=t,setTimeout(o,e))}function ut(n){var i=false,t=n.el,r=n.ticks,u=n.localizedDate;return t&&t.closest("body").size()!==0&&r&&(t.text(f(r,u)),i=true),i}var t=wLive.Core,n=t.AleHelpers.getString,i=t.AleHelpers.getMarketInfoValue,h=621355968e5,c=n("Dates.Yesterday"),l=n("Dates.DaysAgo"),a=n("Dates.HourAgo"),v=n("Dates.HoursAgo"),y=n("Dates.MinuteAgo"),p=n("Dates.MinutesAgo"),w=n("Dates.MomentAgo"),b=n("Dates.MomentAgoLowerCase"),k=i("DateFormat.DayMonthYearPattern"),d=i("DateFormat.DayAndSuffixPattern"),g=i("DateFormat.AppendAfterDay"),e=6e4,r=[],nt=10;t.DateFactory={getDate:function(n,t,i){var u=jQuery(_ce("span"));return n>0&&r.push({el:u.text(f(n,t,i)),ticks:n,localizedDate:t}),u},getDateString:f,getFormattedDate:function(t){var r=u(t),i=new Date(r),f=(i.getMonth()+1).toString(),e=i.getDate(),o=n("Dates.AbbreviatedMonth_{0}".format(f)),s=d.format(e,g);return k.format(o,s,i.getFullYear())},getUTCDateTime:function(n){var f=jQuery(_ce("span")),s=u(n),t=new Date(s),h=(t.getUTCMonth()+1).toString(),c=t.getUTCDate(),l=t.getUTCFullYear(),a=t.getUTCHours(),i=t.getUTCMinutes(),r=t.getUTCSeconds(),e,o;return i=i>9?i:"0"+i,r=r>9?r:"0"+r,e="{0}/{1}/{2} {3}:{4}:{5} UTC",o=e.format(h,c,l,a,i,r),f.text(o),f}};setTimeout(o,e)}(),function(){function d(b,ni,ti){function nu(){li?ei.video?tu():ei.photo||ei.audio?iu():ru():(!ti.df&&ei.folder?eu():ei.photo||ei.video||ei.isProcessingVideo?uu():fu(),tr=true)}function tu(){var n=ti.dv?k:dt,t=n.format(ei.name.encodeHtmlAttribute());oi.html(t);si=jQuery(s,oi);si.bind(h,sr);or()}function or(){if(t.isComplete(li))si.attr(f,li),oi.addClass(r),tr=true;else{var n=t.isComplete(bi);n?(si.attr(f,bi),oi.addClass(r)):si.hide();n&&bi==li||(vi=jQuery("<img />").attr(st,"").attr(g,si.attr(g)).css(p,0).css(lt,1),vi.insertBefore(si),ur||(wi||(wi=setTimeout(dr,ut),ai&&(clearTimeout(ai),ai=null)),vi.bind(i,lr),t.loadImage(li,vi[0])))}}function iu(){var n=k.format(ei.name.encodeHtmlAttribute());oi.html(n);si=jQuery(s,oi);si.bind(h,sr);or()}function sr(){si.css(bt,kt)}function ru(){var r=gt.format("",ei.getChildren().getCount()),n;oi.html(r);hr();n=jQuery(e+o,oi);jQuery(n[0]).css(p,1);jQuery(n[1]).css(p,0);si=jQuery(s,jQuery(n[0]));si.bind(h,sr);si.bind(i,cu);t.loadImage(li,si[0])}function uu(){var n,t;ei.photo?n=fi:(t=FilesConfig.foldersImgBaseUrl+"/videoNoThumbnail.png",n=ui.format(t.encodeHtmlAttribute(),ei.name.encodeHtmlAttribute()));oi.html(n)}function fu(){oi.html(ri);ei.did?jQuery(".itemTdm",oi).append(n.SkyDriveItemHelper.getFriendlyFileType(ei).encodeHtml()):jQuery(".itemTdm",oi).append(n.DateFactory.getDate(ei.dateModifiedOnClient,ei.displayModifiedDate));hr()}function eu(){oi.html(ii.format(ei.did?"":ei.getChildren().getCount()));hr()}function hr(){var n=jQuery(".itemName",oi);ti.de||!l.EditableText?n.text(ei.name):(gi?(n.replaceWith(gi.getContainer()),gi.bindAll()):gi=new l.EditableText(n,ni,jQuery.extend({},l.EditableText.RenameOptions,{de:true,ec:"itemNameEdit",hc:true})),gi.isEditing()||gi.render(ei))}function vr(){var i=false,n,t;return n=ti.w>0?ti.w:b.width(),t=ti.h>0?ti.h:b.height(),(n!=yi||t!=pi)&&(yi=n,pi=t,i=true),i}function cr(){oi.width(yi);oi.height(pi);si?(yr(yi,pi),su(yi,pi)):ei.video||ei.isProcessingVideo?yr(yi,pi):!ti.df&&ei.folder||ei.photo||ou(yi,pi)}function ou(t,i){var o=oi.find(".itemTd"),h=oi.find(".itemTdc"),s=oi.find(".itemTdi"),f=oi.find(".itemTdt"),r=a,e;(i==ot||i==u)&&(r=u);i==r?o.removeClass("itemTdb"):o.addClass("itemTdb");e=i==a||i==u;s.empty().height(r).width(r).css(w,e?0:v).css("margin-top",-r/2).append(jQuery(n.SkyDriveItemHelper.getIcon(ei,r)));f.css(w,v*2+r).css(pt,v);e?f.hide():f.show()}function yr(t,i){var r=jQuery(".itemTo",oi),e,o,f,s;r[0]&&(e=jQuery(jQuery(".itemTos",oi)[ir?1:0]),e.width(t),e.height(i),r.width(t),r.height(i),i<u||di&&ti.dt?r.hide():(r.show(),di||(o=r.find(".itemTvo"),f=a,i<et&&(f=u),s=(!ei.video&&ei.isProcessingVideo?"processingVideo_":"video_")+f,o.empty().width(f).append(jQuery(n.ImageStrip.getImage(s))).css(y,(i-f)/2))))}function su(n,t){var r,i,u;ci==0||hi==0?(r=0,i=0):di||ti.as?n==0||t==0?(r=0,i=0):ci/hi<n/t?(r=n,i=hi/ci*n):(i=t,r=ci/hi*t):ti.iw&&ti.ih?(i=hi,r=ci):ti.iw?hi<t?(i=hi,r=ci):(i=t,r=ci/hi*t):ti.ih?hi<n?(i=hi,r=ci):(r=n,i=hi/ci*n):n==0||t==0?(r=0,i=0):ci<n&&hi<t?(i=hi,r=ci):ci/hi>n/t?(r=n,i=hi/ci*n):(i=t,r=ci/hi*t);r=Math.ceil(r);i=Math.ceil(i);u=si.parent();u.width(r).height(i);$B.IE&&$B.V<9&&si.width(r).height(i);u.css(wt,Math.floor((n-r)/2));di?u.css(y,Math.floor((t-i)/4)):u.css(y,Math.floor((t-i)/2))}function pr(){jQuery(e+o,b).stop(true,true);nr&&(nr.unbind(),nr=null);vi&&(vi.stop(true),vi.unbind(i,lr),vi=null);si&&(si.unbind(),si=null);clearTimeout(wi);wi=null;clearTimeout(ai);ai=null}function wr(){var s=li,i,t,r,e,u,f;if(li=bi=null,di=false,e=yi,u=pi,ei){if(ei.thumbnailSet&&(!ei.audio||ti.ap))i=ei.thumbnailSet,t=n.SkyDriveItemHelper.pickThumbnail(i,e,u),r=ei.photo||ei.video||t,u>c&&(f=n.SkyDriveItemHelper.pickThumbnail(i,c,c),(f.width!=t.width||f.height!=t.height)&&(bi=i.baseUrl+f.url));else if(n.SkyDriveItem.IsFolderWithCovers(ei)){var o=ei.folder.covers,h=o.length;h>0&&(rr=0,i=o[rr],t=n.SkyDriveItemHelper.pickThumbnail(i,e,u),r=t,di=true)}t&&(ci=r.width,hi=r.height,li=i.baseUrl+t.url,bi||(bi=li))}return s!=li}function hu(n){var c=this,t=jQuery(c),h,u;b.trigger(d.pulseEventName,t.data(it));n.type==i&&(h=jQuery(jQuery(e+o,b)[ir?1:0]),h.animate({opacity:vt},at,rt),ir=!ir,u=jQuery(jQuery(e+o,b)[ir?1:0]),si=jQuery(s,u),ci=t.data(nt),hi=t.data(tt),li=t.attr(f),bi=li,si.attr(f,li),oi.addClass(r),cr(),u.animate({opacity:1},c_pulseFadeInSpeed,rt))}function cu(){var n=this;oi.addClass(r);bi==li&&kr()}function br(n){var t={pos:{x:n.pageX,y:n.pageY},ev:n,bici:"CM"};ni.contextMenu.render(ei,null,t)}function kr(){var t,i,n;if(tr=true,$BSI.isLoading()&&jQuery(ni).trigger("perfLoad"),gr(),t=ni.errorManager.getErrors(),i=t&&t.length,i>0)for(n=0;n<i;n++)if(t[n].code==="imageLoad"){ni.errorManager.removeAt(n);break}clearTimeout(wi);wi=null;clearTimeout(ai);ai=null}function lr(){var n=this;oi.addClass(r);vi.animate({opacity:1},c_pulseFadeInSpeed);kr()}function dr(){clearTimeout(wi);wi=null;"undefined"!=typeof $header&&$header.showLoading();ai=setTimeout(lu,yt)}function gr(){"undefined"!=typeof $header&&$header.hideLoading()}function lu(){clearTimeout(ai);ai=null;ni&&n.StringHelpers.caseInsensitiveStringEquals(ni.viewParams.id,ei.id)&&ei.photo&&ni.errorManager.add({$element:jQuery("<span>"+ft("image.loaderror").encodeHtml()+"<\/span>"),priority:2,type:4,code:"imageLoad"})}var ki=this;ti=ti||{};var oi=jQuery('<span class="itemT"><\/span>'),ei,ar,si,vi,nr,li,bi,tr,yi,pi,ci=0,hi=0,fr,er,di=false,ur,rr,ir,gi,wi,ai;sutra(oi,"$Sutra.SkyDrive.ItemTile");b.append(oi);$B.Full&&oi.bind(ht,function(n){return ti.sm&&!n.shiftKey?(br(n),false):undefined});ki.render=function(u,f,e){var o=n.SkyDriveItem.areItemsSame(ei,u,true)&&ar===u.getVersion();ti=e||ti;o&&ki.resize();o&&ur==f||(ur=f,o?vi&&!ur&&(tr||(wi||(wi=setTimeout(dr,ut),ai&&(clearTimeout(ai),ai=null)),vi.bind(i,lr),t.loadImage(li,vi[0]))):(tr=false,ei=u,ar=ei.getVersion(),ci=0,hi=0,yi=0,pi=0,fr=0,er=0,pr(),gr(),oi.empty(),oi.removeClass(r),vr(),wr(),ir=false,nu(),cr()))};ki.isLoaded=function(){return tr};ki.resize=function(){vr()&&((fr<yi||er<pi)&&(fr=yi,er=pi,wr()&&ei.photo&&or()),cr())};ki.dispose=function(){pr();oi.unbind();gi&&gi.dispose()};ki.canPulse=function(){return di&&ei.folder.covers.length>1};ki.pulse=function(r){var o=false,u,c;if(di&&t.isIdle()&&(u=ei.folder.covers.length,u>1)){rr=(rr+1)%u;var l=yi,a=pi,s=ei.folder.covers[rr],e=n.SkyDriveItemHelper.pickThumbnail(s,l,a);o=true;c=s.baseUrl+e.url;nr||(nr=jQuery("<img/>").bind(i+" "+h+" "+ct,hu));nr.data(tt,e.height).data(nt,e.width).data(it,r);nr.attr(f,c)}return o};ki.showContextMenu=br}var n=wLive.Core,l=wLive.Controls,t=n.Images,ft=n.AleHelpers.getString,ei=n.CommandManager,et=128,ot=64,a=48,u=32,v=$B.Mobile?5:12,e=".",o="itemTos",g="alt",st="title",f="src",nt="w",tt="h",it="p",ht="contextmenu",s="img",i="load",h="error",ct="abort",y="margin-top",p="opacity",lt="z-index",r="itemTl",rt="linear",at=c_pulseFadeInSpeed=1e3,vt=0,ut=500,yt=9500,c=$B.Full?128:64,oi="height"+c,pt=$B.rtl?"left":"right",w=$B.rtl?"right":"left",wt="margin-"+w,bt="visibility",kt="hidden",b='<span class="itemTp"><img alt="{0}" title="" /><\/span>',k=($B.Mobile?"":'<span class="itemTs"><\/span>')+b,dt='<span class="itemTo"><span class="itemTvo"><\/span><\/span><span class="itemTos">'+k+"<\/span>",gt='<span class="itemTo itemTag"><span class="itemTa"><span class="itemTan"><span class="itemName"><\/span><\/span><\/span><span class="itemTac">{1}<\/span><\/span><span class="itemTos">'+b+'<\/span><span class="itemTos">'+b+"<\/span>",ni=$B.Mobile?"/mobile_folder_gradient.png":"/folder_gradient.png",ti=$B.Mobile?"/mobile_folder_overlay.png":"/folder_overlay.png",ii='<span class="itemTo itemTf"><span class="itemTfhov"><span class="itemTfg"><span class="itemTfi"><img src="'+(FilesConfig.foldersImgBaseUrl+ni).encodeHtmlAttribute()+'" class="itemTgrad" width="100%" height="100%" /><\/span><img class="itemTfo" src="'+(FilesConfig.foldersImgBaseUrl+ti).encodeHtmlAttribute()+'" /><\/span><\/span><span class="itemTa"><span class="itemTan"><span class="itemName"><\/span><\/span><\/span><span class="itemTac">{0}<\/span><\/span>',ri='<span class="itemTd"><span class="itemTdc"><span class="itemTdio"><span class="itemTdi"><\/span><\/span><span class="itemTdt"><span class="itemTdn"><span class="itemName"><\/span><\/span><span class="itemTdm"><\/span><\/span><\/span><\/span>',ui='<span class="itemTo"><span class="itemTvo"><\/span><\/span><span class="itemTos"><img class="itemTnv" src="{0}" alt="{1}" title="" /><\/span>',fi='<span class="itemTnp"><\/span>';wLive.Controls.ItemTile=d;d.pulseEventName="pulse"}();wLive.Core.SoftBlockEnum={MoveAction:0,RenameAction:1,DeleteAction:2},function(){function s(n,s,kt){function hu(n){gt&&gt.key===n.key&&ri.render(n)}function cu(n,t){gt&&t&&gt.key===t.key&&au()}function gi(){ii&&(li=ur,pu())}function lu(){var n;n=oi?ni.height():ei.height();gu(true);lr("height",n);setTimeout(function(){ri.resize(function(){ti.focus().select()})},0)}function or(n){var t=wr&&wr(s,n);return t||sr(n)}function sr(n){return n[vi]}function of(n){var t=n.snippet||"";t&&su.html("..."+h.highlightAndEncodeField(n,"snippet")+"...")}function nr(n,t){var f=fr||yi&&!ki,r,u;ni&&f===(ni[0].nodeName==="A")||(ni&&ni.remove(),r=f?"a":"span",ni=jQuery("<"+r+' class="'+nt+(br?" "+br:"")+'"><span class="'+c+'"><\/span>'+(uf?'<span class="'+l+'"><\/span>':"")+"<\/"+r+">"),rr(ni,o,yu),si=jQuery("."+c,ni),sutra(si,"$Sutra.SkyDrive.EditableTextCurrentText"),su=jQuery("."+l,ni),ei.append(ni));n=n&&n.trim();n?ni.removeClass(e):yi&&(ni.addClass(e),kt.v&&(n=kt.v(gt)));n=n||"";t?si.html(n):si.text(n);fr&&(u=s.actionManager.getAction(fr,gt));u?(i.ActionManager.setATagAction(u,ni),ni.removeClass(v)):(ni[0].nodeName==="A"&&ni.attr("href",ot).bind(o,function(n){n.preventDefault()}),ni.addClass(v))}function tr(){ar.clear();ur=false;ti&&ti.removeClass(w)}function au(){yi&&!ii&&(lu(),ti.val(sr(gt)))}function vu(n){if(tr(),li)li=false;else{var i=iu?iu(gt):t("UpdateItemErrorTitle"),r=jQuery("<span>"+i+" "+n+"<\/span>");ar.add({$element:r,priority:0,type:0});ur=true;lu();ti&&ti.addClass(w)}}function yu(){return ki?undefined:(au(),false)}function sf(n){var t,i,u,r;ii&&(tr(),li=false,i=n.which,i===yt?t=wu:i===pt&&(t=pu),t?(t(),n.preventDefault()):gr&&ui.text(ti.val()+String.fromCharCode(i)),u=ui[0].scrollHeight,r=ui[0].scrollHeight,ti.innerHeight()<r&&lr("height",r),n.stopPropagation())}function hr(n){n&&(hi&&hi.hide(),cr(k))}function pu(){function c(){var n,t;r&&(s.pendingFolderToCreate=false,gt.invalidate(),hr(r),s.selectionManager.getSelection().selectionCount===0&&(n=gt.getParent(),n&&(t=n.getChildren().indexOf(gt,true),t>-1&&s.selectionManager.clickSelect(n,t))));ru&&ru(gt);vi=="caption"&&(s.tokenHasBeenRedeemed=true);wi(false);li=false}function h(e,o){i.StringHelpers.caseInsensitiveStringEquals(gt.id,o.id)&&(e&&e.error&&e.error.code===d?$Do.when("Bucket3.js",0,function(){if(i.StringHelpers.caseInsensitiveStringEquals(gt.id,o.id)){var t=e.error.data,r=t&&jQuery.parseJSON(t);ai=new f.SoftBlock(bt.RenameAction,s.callerCid,gt,r,f.Notifications);ai.show(function(){wi(true);ci.updateItemProperty(gt,vi,n,function(){wi(false)},h,true)},function(){nr(u);pi(true)})}}):(ti.val(n),nr(u),hr(r),vu(e.error.message||t("UpdateItemError"))));wi(false)}var n=ti.val(),r,o,u;return n=n.trim(),r=gt._isNewFolder,r&&(hi?hi.show():(hi=$f&&jQuery($f.createLoading({returnMarkup:true,useTransparentFallback:true})),ei.prepend(hi)),ir(k)),o=tu&&tu(gt,n),o?(hr(r),vu(o)):(u=sr(gt),n!==(ni.hasClass(e)?"":u)||gt._isNewFolder?(nr(n),wi(true),pi(false),gt.updateItemProperty(vi,n,c,h)):wu()),false}function wu(){return pi(true),false}function bu(){rr(ti,lt,gi);rr(ti,vt,sf)}function ku(){ti&&ti.unbind();wt.unbind(at,gi)}function du(){var i,t,r;ii&&(i=oi?n:ei,t=i.offset(),t.top&&t.left||(t=eu),t.top&&t.left&&(eu=t,r=$B.rtl?3:0,t.left=t.left-vr.offset().left-r,fi.show(),fi.offset(t)))}function pi(n){if(ii&&n&&gt&&gt._isNewFolder){nf();s.pendingFolderToCreate=false;var t=gt.getParent();t&&(t.removePinnedSubfolder(gt),t.invalidate())}else nf()}function gu(t){ii!=t&&(ii=t,ii?(ui=jQuery(ef),ti=jQuery(r+b,fi),n.append(ui),ir(p),sutra(ti,"$Sutra.SkyDrive.EditableTextInput"),fi.hide().appendTo(vr),bu()):(ku(),fi.remove(),unsutra(ti),cr(p),ui&&ui.remove()),tf())}function wi(n){er!=n&&(er=n,tf())}function nf(){ii&&tr();gu(false)}function tf(){er||ii?ci.suspendChangeEvents():ci.resumeChangeEvents()}function ir(t){n.addClass(t);fi.addClass(t)}function cr(t){n.removeClass(t);fi.removeClass(t)}function lr(n,t){if(t){ti&&ti[n](t);var i=$B.IE?t-1:t;ui&&ui[n](i)}}function rr(n,t,i){n&&n.unbind(t,i).bind(t,i)}var ri=this,ar=s.errorManager,ci=s.dataModel,vr=s.$rootElement,yr=jQuery(s),gt,pr,ur,li,ai,vi=kt.n,wr=kt.gdt,fr=kt.ca,br=kt.ac,kr=kt.ic,dr=kt.ec,rf=kt.aa,bi=kt.ea,gr=kt.g,oi=kt.c,nu=kt.ml,ki=kt.de,tu=kt.gem,iu=kt.get,uf=kt.snp,ru=kt.sc,uu=false,fu=dt(),di=r+fu,eu={top:0,left:0},yi,ii=false,er=false,ou=" "+et+(kr?" "+kr:""),ff=nu?' maxlength="'+nu+'"':"",ef='<textarea class="'+ft+ou+'" disabled="disabled" + textareaAdditionalAttributes><\/textarea>',ei,ni,si,su,ui,ti,fi,hi;n.html('<span class="'+a+'"><\/span>');n.addClass(g).addClass(gr?rt:"");ei=jQuery(r+a,n);fi=jQuery('<div id="'+fu+'" class="'+tt+(ki?" "+it:"")+(dr?" "+dr:"")+'"><textarea class="'+b+ou+'"'+ff+"><\/textarea><\/div>");sutra(n,"$Sutra.SkyDrive.EditableText");ci.addListener(i.DataModel.dataChangedEvent,hu,undefined,"SkyDriveWeb_Internal_Control_EditableText_DataChanged");bi&&yr.bind(bi,cu);oi&&ir(ut);ri.bindAll=function(){rr(ni,o,yu);ii&&bu()};ri.isEditing=function(){return ii};ri.getContainer=function(){return n};ri.focus=function(){ii?ti.focus():ni.focus()};ri.render=function(n){if((!i.SkyDriveItem.areItemsSame(gt,n)||pr!==or(n))&&!(ii&&gt.key===n.key)){pi(true);gt=n;pr=or(gt);yi=!!s.actionManager.getAction(rf,gt);!ki&&yi?ir(y):cr(y);var t=or(gt)||"";nr(h.highlightAndEncodeField(gt,vi),true);of(n)}oi&&ri.resize()};ri.resize=function(t){var i;i=oi?n.width()-2:ei.width()-2;oi&&!ii?si&&(ei.width("auto"),ei.width(Math.min(si.width()+21,i))):lr("width",i);setTimeout(function(){du();t&&t()},0)};ri.dispose=function(){uu||(uu=true,pi(true),tr(),ci.removeListener(i.DataModel.dataChangedEvent,hu),bi&&yr.unbind(bi,cu),u.unbind(di),ni&&ni.unbind(),ku());ai&&(ai.dispose(),ai=null)};u.bind(st+di,function(){ri.resize()});u.bind(ht+di,du);u.bind(ct+di,gi);ri.bindAll()}var i=wLive.Core,f=wLive.Controls,t=i.AleHelpers.getPCString,h=i.SkyDriveItemHelper,d=9001,n="et_",g=n+"main",nt=n+"text",c=n+"primary",l=n+"snippet",a=n+"textContainer",e=n+"empty",v=n+"inactive",y=n+"editable",tt=n+"edit",p=n+"editing",it=n+"outline",w=n+"error",rt=n+"growable",ut=n+"centered",ft=n+"hinput",b=n+"input",et=n+"textarea",k=n+"processing",r=".",ot="#",o="click",st="resize",ht="scroll",ct="mousewheel",lt="blur",at="mouseup",vt="keydown",yt=27,pt=13,u=jQuery(window),wt=jQuery(document),bt=i.SoftBlockEnum,kt=0,dt=function(){return n+kt++},gt=jQuery('<div>:*?\\/;"<>|&#xff0f;&#xff1b;&#xff0a;<\/div>').text();f.EditableText=s;s.RenameOptions={n:"name",gdt:function(n,t){return t.getDisplayName(n)},g:false,gem:function(n,i){var r,f,u,e;if(i)if(i.startsWith(".")||!n.extension&&i.endsWith("."))r=t("CantStartOrEndWithDotError");else{for(u=0;u<i.length;u++)if(e=i.charAt(u),gt.indexOf(e)!==-1){f=e;break}f&&(r=t("InvalidTextFormatError").format(f))}else r=t("NameRequiredError");return r},get:function(n){return n._isNewFolder?t("NewFolderErrorTitle"):t("RenameErrorTitleFormat").format(n.name)},aa:"Rename",ea:"Rename"};s.CaptionOptions={n:"caption",aa:"ModifyCaption",get:function(n){return n.photo?t("CaptionErrorTitle"):t("DescriptionErrorTitle")},ml:255,v:function(n){return n.photo?t("AddCaption"):t("AddDescription")}}}(),function(){function t(t,i){var r=this;r.render=function(){i=i==null?n:i;var u=$f&&$f.createLoading({returnMarkup:true,useTransparentFallback:true,text:i}),r=jQuery(u);t.append(r);$f.showLoading(r);r.find(".c_loadingText").addClass("t_ctc");sutra(r,"$Sutra.SkyDrive.LoadingSpinner")}}var n=wLive.Core.AleHelpers.getString("Loading");wLive.Controls.LoadingSpinner=t}(),function(){function f(f){var o,s;f.html(t);var h=jQuery(".lcCenter",f),e=jQuery(".lcWrapper",f).hide(),c=new n.LoadingSpinner(e);c.render();e.css("margin-"+u,-(e.width()/2));sutra(e,"$Sutra.SkyDrive.LoadingCue");o=this;s=false;o.setVisibility=function(n){n?(s||(r?e.stop(true).delay(i).css("opacity",0).show().animate({opacity:1},500):e.show()),h.offset().top>=jQuery(window).scrollTop()?e.css({position:"absolute"}):e.css({position:"fixed"})):e.stop(true).hide();s=n};o.update=function(){o.setVisibility(s)}}var n=wLive.Controls,t='<div class="lcCenter"><div class="lcWrapper"><\/div><\/div>',i=250,r=jQuery.support.opacity,u=$B.ltr?"left":"right";n.LoadingCue=f}(),function(){function g(r,u,f){function ft(n,t,i){n.width(t);n.height(i)}function st(){var i=false,u=r[0],n=u.w||r.width(),t=u.h||r.height();return(n!=et||t!=ot)&&(et=n,ot=t,i=true,ut.w=f.cw=n,ut.h=f.ch=t,ft(it,n,t),ft(v,n,t),ft(rt,n,t)),i}var h=this,ht=t.SkyDriveItemHelper,ct=u.dataModel,e,a;f=f||{};r.html(s);var it=jQuery(".selfItem",r),nt=jQuery(".selfItemP",r),v=jQuery(".selfItemV",r),tt=jQuery(".selfItemTH",r),rt=jQuery(".selfItemTC",r),et,ot,ut={dt:true,dv:true,as:true,sp:2,nms:f.nms},l=new i.ItemTile(nt,u,ut),g=new i.Video(v,u),c,o;$B.Mobile||f.ht?(tt.hide(),rt.hide()):(c=new i.TagHover(tt,u,f),o=new i.TagCreate(rt,u,f));h.isLoaded=function(){return l.isLoaded()};h.showContextMenu=function(n){l.showContextMenu(n)};h.render=function(i,s){var et=t.SkyDriveItem.areItemsSame(e,i),ut,rt;if(sutra(it,"$Sutra.SkyDrive.SelfItem"),!s&&$B.IE&&$B.V<9&&r.css("filter",""),!et||a!=s)if(a=s,e=i,st(),tt.hide(),e){if(e.photo||e.isWebPlayableVideo()||e.isProcessingVideo||(ut=e.video&&!e.isWebPlayableVideo()?d:k,u.errorManager.add({$element:jQuery(ut),priority:1,type:4})),!u.isSuper&&e.itemStatus&&e.itemStatus>0){var ft=1,h=1,ot=ct.getItem(e.parentKey,true);ht.isViewerOwner(e)?(ot.sharingLevelValue!=4||e.sharingLevelValue!=4)&&(rt=null,e.itemStatus==2?(rt=jQuery(w),h=2):(rt=jQuery(b),h=1),u.errorManager.add({$element:rt,actionBtnName:y,actionCallback:function(){var r=e.reviewState&&e.reviewState==t.ReviewState.ChallengeReviewed,n;$B.Mobile||r?$BSI.navigateTo(p,"_blank"):(n=[],n.push(i),u.operationManager.execute("OwnerRequestReview",{items:n}))},priority:1,type:4})):(ft=2,h=e.itemStatus==2?2:1,u.errorManager.add({$element:jQuery("<span>"+n("RestrictedNotification.Visitor")+"<\/span>"),priority:1,type:4}));$BSI.reportEvent("SkyDrive.Abuse.TargetedTakedown",{RestrictedType:ft,RestrictedReason:h})}(e.video||e.isProcessingVideo)&&!e.thumbnailSet?nt.hide():(nt.show(),l.render(e,s));e.isWebPlayableVideo()&&!s?(f.te=true,v.show(),g.render(e)):(f.te=false,v.hide(),s||(f.te=true,c&&(tt.show(),c.render(e))),!i.video&&i.isProcessingVideo&&u.errorManager.add({$element:jQuery("<span>"+n("Video.BeingProcessedHeader")+". "+n("Video.BeingProcessedMessage")+"<\/span>"),priority:1,type:4}))}else nt.hide(),v.hide();a||o&&o.render(e)};h.stop=function(){e&&e.video&&g.stop();o&&o.stop()};h.unset=function(){unsutra(it)};h.resize=function(){st()&&e&&(l.resize(),e.photo&&!a&&c&&c.resize(),a||e.video&&g.resize());a||o&&o.resize()};h.dispose=function(){l.dispose();l=null;g.dispose();g=null;c&&c.dispose();o&&o.dispose()}}var t=wLive.Core,i=wLive.Controls,n=t.AleHelpers.getString,nt=t.AleHelpers.getPCString,r=window.FilesConfig,s='<div class="selfItem"><div class="selfItemP"><\/div><div class="selfItemV"><\/div><div class="selfItemTH"><\/div><div class="selfItemTC"><\/div><\/div>',f='<a target="_blank" href="{0}">',u="<\/a>",h=n("RestrictedNotification.Owner"),c=n("RestrictedNotification.OwnerICN"),l=n("Video.LoadError"),a=n("Video.UnsupportedFormat"),v=f.format(r.contactUsLink.encodeHtmlAttribute());formatedOwnerMessage=$B.Mobile?n("RestrictedNotification.OwnerContactUs").format(v,u):n("RestrictedNotification.OwnerContactUs").format("","");var y=n("RestrictedNotification.ContactUs"),p=r.contactUsLink.encodeHtmlAttribute(),e="<div>"+formatedOwnerMessage+"<\/div>",o=f.format(r.codeOfConductLink.encodeHtmlAttribute()),w="<div>"+c.format(o,u)+"<\/div>"+e,b="<div>"+h.format(o,u)+"<\/div>"+e,k="<div>"+l+"<\/div>",d="<div>"+a+"<\/div>";i.SelfItem=g}(),function(){function nt(nt,tt){function wt(){if(ft.empty(),ft.removeClass("videoOverlay"),vt(),rt.video&&rt.urls&&rt.urls.download){var r=rt.video.fourCC,i=false;s===undefined&&(s=vi());r==b&&s&&!rt.did?(ci(),ft.html(ai()),it=jQuery("#vHTML5Preview",ft),it.bind("error",bi),it.bind("loadeddata",pi),it.bind("volumechange",yi),it.bind("ended",ki),it[0].volume=n.Video.volume,it[0].muted=n.Video.muted,ut=t.HTML5):$B.Mobile?(yt(dt),ut=t.None,i=true):v?ni():(i=true,g?(ti(),ut=t.Upsell):(yt(dt),ut=t.None));i&&(ft.addClass("videoOverlay"),bt())}}function vt(){ft.show();ct.hide();nt.css(a,10)}function bt(){vt();ut==t.SL&&(it.height(ot+e),it.addClass("videoSL"))}function hi(){nt.css(a,0)}function ci(){$B.Mobile||(ft.hide(),ct.show(),gt.setVisibility(true))}function ni(){hi();ft.html(li());it=jQuery("#vSLPreview",ft);ut=t.SL}function li(){var u="downloadUrlAVOverride="+rt.urls.download,n="",s="",e,o,t,i,r;if(rt.did){var h=rt.urls.videoStream,l=rt.video.height,a=rt.video.duration;if(h&&l){for(e=rt.extension,e&&(u+=",extension="+e),u+=",streamingUrl="+h,o=",profiles=",t=d,i=0;i<=f.length;i++)if(r=f[i],r<=l||r==240){r<t&&(t=r);n=o+lt(f.slice(i).join(","));s=",profileBuffers="+lt(k.slice(i).join(","));break}n||(t=f.slice(-1)[0],n=o+t);n+=",defaultProfile="+t;a&&(n+=",duration="+a)}}else u+="&videoplayer=skysl";return'<object id="vSLPreview" data="data:application/x-silverlight," type="application/x-silverlight-2" width="'+ht+'" height="'+ot+'"><param name="source" value="'+c.itemPreviewXapUrl.encodeHtmlAttribute()+'" /><param name="MaxFrameRate" value="30" /><param name="background" value="#000000" /><param name="windowless" value="true" /><param name="enableHtmlAccess" value="true" /><param name="initParams" value="'+u.encodeHtmlAttribute()+n.encodeHtmlAttribute()+s.encodeHtmlAttribute()+",videoWidth="+ht+",videoHeight="+ot+",itemKey="+rt.key+",originalString="+lt(w.encodeHtmlAttribute())+",videoLoading="+lt(oi.encodeHtmlAttribute())+",videoLoadingPercentage="+lt(ei.encodeHtmlAttribute())+",videoLoadError="+lt(kt.encodeHtmlAttribute())+',errorMethod=ShowVideoError,loadMethod=TriggerSilverlightLoaded,endedMethod=VideoCompleted,volumeMethod=SilverlightVolumeChanged"/><\/object>'}function ai(){var t="",n,r,u,f;return rt.thumbnailSet&&rt.thumbnailSet.baseUrl&&(n=i.SkyDriveItemHelper.pickThumbnail(rt.thumbnailSet,ht,ot),n&&n.url&&(r=rt.thumbnailSet.baseUrl+n.url,t='poster="'+r.encodeHtmlAttribute()+'"')),u=rt.urls.download+"&videoplayer=skysl",f='<video id="vHTML5Preview"  width="'+ht+'" height="'+ot+'" '+t+' controls><source src="'+u.encodeHtmlAttribute()+'" type="video/mp4" /><\/video>',f}function ti(){tt.errorManager.add({$element:jQuery("<span>"+si+"<\/span>"),actionBtnName:y("DownloadCommand"),actionCallback:function(){$BSI.navigateTo(c.installSilverlightUrl,"_blank")},priority:1,type:4})}function ii(){var n=nt.width(),t=nt.height();return(n=n>300?n:300,n!=ht||t!=ot)?(ht=n,ot=t,true):false}function vi(){var n=document.createElement("video");return!!(n.canPlayType&&n.canPlayType('video/mp4; codecs="avc1.42E01E, mp4a.40.2"').replace(/no/,""))}function lt(n){return n.replace(/,/g,"|")}function ri(t){var f=t.which,r=n.Video.currentVideo,u=n.Video.viewableItemKey;return!i.DomHelpers.isTextInputElement(jQuery(t.target))&&u&&r&&!i.PopoverHelpers.isPopoverVisible()&&f==32&&rt&&u==rt.key?(r.playPause(),false):undefined}function yi(){n.Video.viewableItemKey==rt.key&&(n.Video.muted=it[0].muted,n.Video.volume=it[0].volume)}function ui(){var t=n.Video.volume;n.Video.muted&&(t=0);it[0].Content&&it[0].Content.VideoControls&&it[0].Content.VideoControls.SetVolume(t)}function pi(){at=true;n.Video.viewableItemKey==rt.key&&(bt(),$B.Mobile||it[0].play())}function wi(t){at=true;t&&rt&&n.Video.viewableItemKey&&rt.key==t&&n.Video.viewableItemKey==t&&(bt(),ui(),it[0].Content&&it[0].Content.VideoControls&&it[0].Content.VideoControls.PlayVideo())}function bi(t){var f,i,u;if(ct.hide(),f=rt.key,i=kt,pt&&!st&&n.Video.viewableItemKey==f){pt=false;wt();return}u="videoErrorUnknown";switch(t.target.error.code){case t.target.error.MEDIA_ERR_NETWORK:i=r("Video.LoadErrorNetwork");u="videoErrorNetwork";break;case t.target.error.MEDIA_ERR_DECODE:i=r("Video.LoadErrorDecode");u="videoErrorDecode";break;case t.target.error.MEDIA_ERR_SRC_NOT_SUPPORTED:if(i=r("Video.LoadErrorUnsupported"),u="videoErrorUnsupported",v){ft.empty();vt();ni();return}}yt(i,u,f)}function yt(t,i,r){st=t;r&&n.Video.viewableItemKey!=r||(tt.errorManager.add({$element:jQuery("<span>"+t.encodeHtml()+"<\/span>"),priority:2,type:4,code:i}),jQuery(wLive.Controls.Video.Events).trigger("error",r))}function ki(){di(rt.key)}function di(t){t&&n.Video.viewableItemKey!=t||jQuery(wLive.Controls.Video.Events).trigger("complete",t)}var et=this,fi=tt.dataModel,rt,it,ut,ei=r("video.loading"),oi=r("loading"),kt=r("video.loaderror"),dt=r("Video.LoadErrorUnsupported"),si=r("video.installsilverlightformatstring"),st=null,at=false,pt=false,ht,ot,ft,ct,gt;nt.html(p);ft=jQuery(".videoControl",nt);sutra(ft,"$Sutra.SkyDrive.VideoControl");ct=jQuery(".videoLoading",nt);gt=new n.LoadingCue(ct);jQuery(tt).bind(o,function(n,t){wi(t)});h.bind(l,ri);et.stop=function(){if(n.Video.viewableItemKey=null,it&&it[0])if(ut==t.HTML5&&it[0].pause){try{it[0].pause()}catch(i){}vt()}else ut==t.SL&&it[0].Content&&it[0].Content.VideoControls&&it[0].Content.VideoControls.StopVideo()};et.render=function(r){n.Video.viewableItemKey=r.key;n.Video.currentVideo=et;var f=!i.SkyDriveItem.areItemsSame(rt,r);rt=r;f?(st=null,at=false,pt=false,ii(),u.complete||!u.requiresCookieToss(rt.urls.download)?wt():jQuery(u).bind(u.eventName,wt)):it&&it[0]?(at&&vt(),pt=at,st?yt(st):ut==t.HTML5&&it[0].play?(it[0].currentTime&&(it[0].currentTime=0),$B.Mobile||it[0].play(),it[0].volume=n.Video.volume,it[0].muted=n.Video.muted):ut==t.SL&&it[0].Content&&it[0].Content.VideoControls&&(it[0].Content.VideoControls.ResetVideo(),it[0].Content.VideoControls.PlayVideo(),ui())):ut==t.Upsell?ti():st&&yt(st)};et.resize=function(){if(ut!=t.None&&ut!=t.Upsell&&ii()){var n=ot;ut==t.SL&&(n+=e);it.height(n);it.width(ht)}};et.playPause=function(){if(it&&it[0]){var n=it[0];ut==t.HTML5?n.paused?n.play():n.pause():ut==t.SL&&n.Content&&n.Content.VideoControls&&n.Content.VideoControls.PlayClick()}};et.dispose=function(){et.stop();ft.remove();jQuery(tt).unbind(o);h.unbind(l,ri);jQuery(u).unbind(u.eventName);et=null;fi=null;ft=null;ct=null}}var i=wLive.Core,n=wLive.Controls,c=FilesConfig,u=i.CookieToss,r=i.AleHelpers.getString,y=i.AleHelpers.getPCString,p='<div class="videoLoading"><\/div><div class="videoControl"><\/div>',e=30,o="slLoaded",l="keydown",a="z-index",w=r("video.original"),b="H264",f=[720,480,360,240],k=[30,15,10,5],d=360,t={HTML5:0,SL:1,Upsell:2,None:3},v=i.SilverlightInstalled,g=i.SilverlightSupported,s,h;n.Video=nt;n.Video.currentVideo=null;n.Video.viewableItemKey=null;n.Video.volume=1;n.Video.muted=false;h=jQuery(document);n.Video.ch=e;n.Video.Events={}}(),function(){function vr(s,pi,wi){function ic(){uf!=-1&&(su=true,ls=wf!=0,tl=!pi.infoPaneClosed,nu.hide(),gr.hide(),cu.hide(),ls&&oe(),pu.addClass("selfis"),eu=setTimeout(pe,cs),fl(document.documentElement))}function pe(){if(clearTimeout(eu),eu=null,rh(),!he&&!pf){var n=pr.getChildren().getCount();n-1>yr?af(yr+1):af(0)}}function ts(n,t){vr.key===t&&(he=false,su&&!eu&&pe())}function rh(){pf&&(!fo||pt.hasLoadedImage(fo))&&(!eo||pt.hasLoadedImage(eo))&&(pf=false,su&&!eu&&pe())}function ue(){su&&(clearTimeout(eu),eu=null,su=false,nu.show(),gr.show(),cu.show(),ls&&oe(),pu.removeClass("selfis"),setTimeout(el,100))}function fl(n){n.requestFullscreen?n.requestFullscreen():n.mozRequestFullScreen?n.mozRequestFullScreen():n.webkitRequestFullScreen?n.webkitRequestFullScreen():n.msRequestFullScreen&&n.msRequestFullScreen()}function el(){var n=document;n.exitFullscreen?n.exitFullscreen():n.mozCancelFullScreen?n.mozCancelFullScreen():n.webkitCancelFullScreen?n.webkitCancelFullScreen():n.msCancelFullScreen&&n.msCancelFullScreen()}function rc(n,t){return jQuery('<img src="'+n.encodeHtmlAttribute()+'" alt="'+t.encodeHtmlAttribute()+'" />')}function sl(n){n.originalEvent.preventDefault&&(n.originalEvent.pointerType==2||n.originalEvent.pointerType==="touch")&&vr&&vr.photo&&!hu.tm&&n.originalEvent.preventDefault()}function hl(n){var t,i,o,h;if($B.Full){if(wi.moSelf)t=s.height(),i=s.width();else{de.removeClass(ut);t=vt.height()-ys;i=s.width();var r=re.deviceXDPI,u=re.deviceYDPI,f=re.logicalXDPI,e=re.logicalYDPI;r&&u&&f&&e&&(r>=f||u>=e)&&(go=Math.min(go,r),ns=Math.min(ns,u),(u!=ns||r!=go)&&(i=Math.floor(1*i*r/go),t=Math.floor(1*t*u/ns),de.addClass(ut)));s.height(t)}dr=i-ps;of=t-wf-vu}else t=vt.height(),i=vt.width(),$B.IE&&(t=$B.V<9?i==320?485:244:i==320?432:288),o=jQuery(document.body).width(),dr=Math.max(ci,Math.min(i,o)),of=Math.max(ci,t);th=Math.floor(dr*sr);$B.Mobile||wi.moSelf?(te=dr,nf=of):(te=dr-fi*2,nf=n.video?of-oi-hi:of-ei-si,yo&&(n&&yo.render(n),h=Math.max(0,tc.outerHeight()+15-(n.video?hi:si)),nf-=h))}function uc(){hl(vr);$B.Full?(pu.width(dr),cu.height(of),cu.css("margin-top",vu),gr.width(th),nu.width(th)):(pu.width(dr),cu.width(dr));var n=of-lt;$B.Full?(n=ir&&!wi.moSelf?Math.floor(n*.35):Math.floor(n/2),uu.css(o,n+vu),fu.css(o,n+vu)):(n=Math.floor(n*.35),gr.css(o,n+vu),nu.css(o,n+vu));lf(true);us(vr,wr);cf(vr,wr)}function rs(){hu.tm||rf.video?(gr.css(a,1),nu.css(a,1)):(gr.css(a,3),nu.css(a,3))}function us(n,t){var r=0,u=0,f,e,i;n&&(f=nf,e=te,$B.Full&&(hu.tm||n.video)&&(e-=wi.moSelf?80:40),$B.Full&&n.video&&(f-=30),n.video?(r=n.video.width,u=n.video.height):n.photo&&(r=n.photo.width,u=n.photo.height),wi.moSelf&&(r*=2,u*=2),i=lc(n,r,u,e,f),t.height(i.h),t.width(i.w),t[0].h=i.h,t[0].w=i.w)}function cf(n,t,r,u){var c;r=r||0;var s=t[0],h=s.h||t.height(),l=s.w||t.width(),f,e;$B.Full?(f=Math.floor((nf-h)/2)+vu,e=Math.floor((te-l)/2)+r,wi.moSelf||(f+=n&&n.video?oi:ei,e+=fi)):(f=Math.floor((nf-h)/4),e=Math.floor((te-l)/2)+r,c=f+h,pu.height(c),cu.css(o,c));s[o]!=f&&t.css(o,f);u?t.animate({left:e},rl):t.css(i,e);t[0][i]=e;t[0][o]=f}function cl(n){return n.shiftKey?undefined:(ou.showContextMenu(n),false)}function oh(t){if(!gf){var i=fc(t);i&&(gf=true,le=i.pageX,yu=false,gu=false,ef=false,ws=le,ae=le,$B.Full&&!hu.tm&&(yu=true,ce=true,n.useTouchAnimations?lh():lf()),kh=i.pageY,ss(),es())}}function sh(t){var s=pr.getChildren(),u,e,i,r,h,c,o,y,l;if(gf&&(u=fc(t),u)){if(e=u.pageX,i=e-le,!yu){var p=u.pageY-kh,a=Math.abs(p),v=Math.abs(i);if(a<10&&v<10)return true;if(a>=v)return gf=false,true;yu=true;hu.tm||n.useTouchAnimations||lf()}return i>0?(yr>0?ef||(ef=s.get(yr-1),r=ef):c=true,h=-1,gu=null):(yr+1<s.getCount()?gu||(gu=s.get(yr+1),r=gu):c=true,h=1,ef=null),r&&(Trace.log("Changing animation direction"),tu.css(f,1).hide(),us(r,tu),ke.render(r,true)),(!n.useTouchAnimations||bs&&i!=0||r)&&(bs=false,setTimeout(function(){bs=true},100),c?(ef=gu=null,tu.css(f,0).hide(),o=dr*.2,Math.abs(i)>o&&(i=i>0?o:o*-1)):(y=(dr-tu[0].w)/2,l=i+h*(dr-y),cf(r,tu,l),Trace.log("TouchItem"+l)),cf(vr,wr,i),Trace.log("CurrentItem"+i)),r&&tu.show(),Math.abs(e-ae)>10&&(ws=ae,ae=e),false}return undefined}function hh(t){var o,s;if(gf&&ll(t)){gf=false;yu=false;var u=ae,f=u-ws,e=u-le,r,i,h=pr.getChildren();ef&&e>10&&f>=0?(i=dr,yr--,r=true):gu&&e<-10&&f<=0?(i=-1*dr,yr++,r=true):i=gu?dr:-1*dr;r?(vr=h.get(yr),o=tu,tu=wr,wr=o,s=ke,ke=ou,ou=s,pi.errorManager.clear(),vh(),iu?iu.render(pr,yr):ch(),br&&clearTimeout(br),br=setTimeout(no,n.animationDuration+y)):ce=false;cf(vr,tu,i,!n.useTouchAnimations);cf(vr,wr,0,!n.useTouchAnimations);kf&&ss();bf&&es();so=true;Trace.log("TouchEnd finished")}}function ll(n){var t=n.touches||n.originalEvent.touches;if(t){if(t.length==0)return true}else if(n.originalEvent.pointerType==2||n.originalEvent.pointerType=="touch")return true;return false}function fc(n){var t=n.touches||n.originalEvent.touches;if(t){if(t.length>0)return t[0]}else if(n.originalEvent.pointerType==2||n.originalEvent.pointerType=="touch")return n.originalEvent;return null}function ec(){return su&&!ce?(ue(),false):undefined}function oc(i){var r=i.which,u,f,e;if(!t.DomHelpers.isTextInputElement(jQuery(i.target))&&!t.PopoverHelpers.isPopoverVisible()){if(yr!=-1&&pr&&(f=pr.getChildren(),r==hr||r==34?(u=true,io()):r==cr||r==33?(u=true,to()):r==36?(u=true,yr!=0?af(0):to()):r==35&&(u=true,yr!=f.getCount()-1?af(f.getCount()-1):io())),su&&(e=i.altKey||i.ctrlKey||i.metaKey||i.shiftKey||u||r==122||r==91,!e))return ue(),false;if(r==27)return al(),false;r==40&&n.fullView?oe():r!=38||n.fullView||oe()}return undefined}function al(){pr&&!pr.isPlaceholder&&vf.doAction(vf.getAction("ViewItem",pr))}function sc(){ve=lu&&lu.isEditing()}function vl(){vr&&vr.video||yu||ve||ce?ce=false:oe();ve=false}function yl(){yu||ve||oe();ve=false}function oe(){wi.moSelf||(df?(clearTimeout(df),df=null):is.addClass(ft),n.fullView?hc():(ie.css(g,"0px"),cu.css($B.rtl?i:dt,"0px"),wf=nt,ys=bh,ps=ct,n.fullView=true,s.addClass(et),$B.Mobile&&(os(),fs())),bu.css(g,wf),ru.resize(),n.fullView&&u&&u.toggleFixedHeader(true),jQuery(".TopBar").offset(nl.offset()),df=setTimeout(function(){is.removeClass(ft);df=null},200))}function hc(){ie.css(g,"-"+nt+"px");cu.css($B.rtl?i:dt,"-"+ct+"px");u&&u.toggleFixedHeader(false);wf=0;ys=0;ps=0;n.fullView=false;s.removeClass(et);$B.Mobile&&(ss(),es())}function pl(){vu=nc.height();ru.resize();rs()}function wl(){vu=0;ru.resize();rs()}function cc(){ku.toggle()}function ch(){if(pr&&yr!=-1){var n=Math.max(0,yr-vi),t=Math.min(yr+vi,pr.getChildren().getCount()-1);ac(n,t,1,1)}}function bl(){if(pr&&yr!=-1){var n=Math.max(0,yr-yi),t=Math.min(yr+yi,pr.getChildren().getCount()-1);ac(n,t,te,nf,yr)}}function lc(n,t,i,r,u){var f,e;return u<=0||r<=0?(f=0,e=0):t>r||i>u?t/i>r/u?(f=r,e=i/t*r):(e=u,f=t/i*u):(e=i,f=t),e=Math.round(e),f=Math.round(f),{w:f,h:e}}function ac(n,i,r,u,f){var l,o,e,h,c,s,a;for(f!==undefined&&(fo=null,eo=null),l=pr.getChildren(),o=n;o<i;o++)e=l.get(o),e&&e.photo&&e.thumbnailSet&&(h=lc(e,e.photo.width,e.photo.height,r,u),c=gc.pickThumbnail(e.thumbnailSet,h.w,h.h),c&&(s=e.thumbnailSet.baseUrl+c.url,f!==undefined&&(o==f?fo=s:o==f+1&&(eo=s),a=as),t.Images.loadImage(s,a)))}function vc(t){if(!ds){ds=true;su&&(clearTimeout(eu),eu=setTimeout(pe,cs));lf();var i=(t?-1*at:at)/2,r=n.animationDuration/2,u=jQuery.fx.interval;jQuery.fx.interval=v;wr.animate({left:"+="+i},r,gt);wr.animate({left:"-="+i},r,gt,kl);jQuery.fx.interval=u}}function kl(){ds=false;br&&(clearTimeout(br),br=null);br=setTimeout(no,y)}function lf(t){wr.stop(false,true);wr.stop(false,true);kr.stop(false,true);kr.stop(false,true);tu.stop(false,true);tu.hide();kr.hide();n.useCSS3Animations?(sf&&(clearTimeout(sf),sf=null,yc()),kr.removeClass("selfAnimate"),wr.removeClass("selfAnimate"),tu.removeClass("selfAnimate"),ks=false):lo&&pc(true);t||(br&&(clearTimeout(br),br=null),ou.stop())}function af(r){var h,u,c,l,e,o,s;yh&&yh.getQueue().reset();is.removeClass(ft);df=null;su&&(clearTimeout(eu),eu=setTimeout(pe,cs));r!=yr&&(h=r>yr,yr=r,vr=pr.getChildren().get(yr),pi.errorManager.clear(),vh(),pr&&yr!=-1&&(iu?iu.render(pr,yr):ch()),lf(),clearTimeout(br),br=null,u=(h?-1:1)*($B.Mobile?dr:at),c=kr,kr=wr,wr=c,kr.removeAttr("role"),wr.attr("role","main"),l=be,be=ou,ou=l,be.unset(),kr.css(a,-1),wr.css(a,2),wr.css("display","block"),tf=u,ho=kr[0][i],n.useCSS3Animations?($B.Full&&wr.css(f,0),us(vr,wr),cf(vr,wr,-1*u),co=wr[0][i],sf&&clearTimeout(sf),sf=t.DomHelpers.setTimeoutZero(yc)):(e=v/n.animationDuration,o=Math.round(u*e),$B.Full&&kr.css(f,1-e),s=ho+o,kr.css(i,s),kr[0][i]=s,$B.Full&&wr.css(f,e),us(vr,wr),cf(vr,wr,-1*u+o),co=wr[0][i]-o,dh=(new Date).getTime(),gh=dh+n.animationDuration-v,lo=setInterval(dl,v)),ou.render(vr,true),vr&&(vr.video?he=true:pf=true),lu&&(vr?(bu.show(),lu.render(vr),su||lu.focus()):bu.hide()))}function yc(){if(sf=null,tf!=0){lh();var t=ho+tf,r=co+tf;kr.css(i,t);kr[0][i]=t;wr.css(i,r);wr[0][i]=r;$B.Full&&(kr.css(f,0),wr.css(f,1));tf=0;br&&clearTimeout(br);br=setTimeout(no,n.animationDuration+y)}}function lh(){ks||(Trace.log("Starting animations"),kr.addClass("selfAnimate"),wr.addClass("selfAnimate"),tu.addClass("selfAnimate"),ks=true)}function dl(){pc()}function pc(t){var r,h,u,e,o,s;tf!=0&&(t?r=0:(h=(new Date).getTime(),r=Math.max(gh-h,0)/n.animationDuration),u=1-r,e=Math.round(u*tf),$B.Full&&(kr.css(f,r),wr.css(f,u)),o=ho+e,s=co+e,kr.css(i,o),kr[0][i]=o,wr.css(i,s),wr[0][i]=s,(r==0||t)&&(clearInterval(lo),lo=null,tf=0,t||(br&&clearTimeout(br),br=setTimeout(no,y))))}function no(){br=null;vr?(ff=vr,yf=yr,wi.moSelf||t.StringHelpers.caseInsensitiveStringEquals(pi.viewParams.id,vr.id)?ah():vf.doAction(vf.getAction("ViewItem",vr))):ah()}function ah(){if($B.Mobile&&window.scrollTo(0,1),kr.css("display","none"),ff){if(rf=ff,uf=yf,ff=null,yf=-1,wi.onSelectedIndexChanged)wi.onSelectedIndexChanged(uf);rs();ou.render(vr);vr.video?he=true:pf=true;lu&&(vr?(bu.show(),lu.render(vr)):bu.hide());ku&&(ku.render(vr),pi.infoPaneClosed&&ku.toggle());hf&&hf.render(vr);ao&&vr&&(ao.clear(),it.populateSharedCommands(pi,vr,null,ao,ar,null))}bl()}function vh(){var n=true,t=true;pr&&yr!=-1&&(yr!=0&&(n=false),pr.getChildren().getCount()-1!=yr&&(t=false));n?uu.removeClass(b):uu.addClass(b);t?fu.removeClass(b):fu.addClass(b)}function gl(){vh();pr&&yr!=-1&&(iu?iu.render(pr,yr):ch(),nh&&(nh=false,ra(!gs)));gs&&(gs=false);br&&clearTimeout(br);br=setTimeout(no,y)}function to(){pr&&yr>-1&&(yr>0?af(yr-1):vc())}function na(n){n.which!=1||yu||(se(),ne=setInterval(to,li),to())}function ta(n){n.which!=1||yu||(se(),ne=setInterval(io,li),io())}function se(){clearInterval(ne);ne=null}function io(){yr!=-1&&pr&&(pr.getChildren().getCount()-1>yr?af(yr+1):vc(true))}function wc(n){so&&(!(bf||kf)||jQuery(n.target).closest(".selfps").length||jQuery(n.target).closest(".selfns").length||(es(),ss()))}function ia(){fs();os()}function fs(){bf||(bf=true,uu.stop(true),uu.animate({opacity:1},tt));so=true}function es(){bf&&(bf=false,uu.stop(true),uu.animate({opacity:0},ai))}function ra(n){$B.Full&&(n?(uu.animate({opacity:1},tt*4),fu.animate({opacity:1},tt*4)):(uu.css("opacity",1),fu.css("opacity",1)))}function ua(){fs();os()}function os(){kf||(kf=true,fu.stop(true),fu.animate({opacity:1},tt));so=true}function ss(){kf&&(kf=false,fu.stop(true),fu.animate({opacity:0},ai))}function bc(n){var t,i,r;if(ro==n.key)if(vr){if(t=n.getChildren().indexOf(vr),vs&&vr.key==vs||(vs=vr.key,oo=0),t==-1&&pi.viewParams.qt==di)if(oo<il)oo++;else{oo=0;$BSI.navigateTo("#qt=search&q="+encodeURIComponent(pi.viewParams.q));return}t!=-1?(dc(),ru.render(vr)):kc()}else i=pr.getChildren().get(yr),i&&ru.render(i);else vr&&vr.key===n.key&&(r=pr.getChildren().indexOf(vr),r!=-1?(wi.moSelf||(bu.show(),lu.render(n)),ru.resize()):nh||kc())}function kc(){var t,i,n,r;pr&&(t=pr.getChildren().getCount(),t>0?(r=Math.min(t-1,yr),n=pr.getChildren().get(r),i=true):n=pr,fa(),i&&ru.render(n),vf.doAction(vf.getAction("ViewItem",n)))}function dc(){uf=-1;yr=-1;yf=-1;iu&&iu.resetState()}function fa(){dc();rf=null;vr=null;ff=-0;pr=null;ro=null;uo=false}var ru=this,du=jQuery(pi),gc=t.SkyDriveItemHelper,vf=pi.actionManager,hs=pi.dataModel,yh=r.Notifications,nl=jQuery("#c_base"),ao,ye,fe,ee,uh,fh,eh,we,ku;wi=wi||{};wi.moSelf||$B.Mobile?n.fullView=false:s.addClass(et);n.useTouchAnimations=wi.moSelf&&(rr||ur);var pr,ro,rf,uf=-1,uo,ph,vr,yr=-1,ff,yf=-1,su,eu,cs=3e3,he=false,ls,tl,pf=false,as=new Image,fo,eo,wh=jQuery(as).bind(bt,rh),vs=null,oo=0,il=2,bh=u&&u.getHeaderHeight(),vu=0,ys=n.fullView?bh:0,ps=n.fullView?ct:0,wf=n.fullView?nt:0,bf=true,kf=true,so,df,gf,ce,le,kh,gu,ef,ae,ws,yu,rl=$B.Full?200:100,bs=true,ks=true,ve,ne,br,dh,ds,gs=true,nh=true,dr,of,th,te,nf,gh,tf=0,ho,co,lo,sf,hu={tm:false,thc:0,tcc:0,te:true,at:true,nms:wi.moSelf,ht:wi.moSelf};bi.to=hu;hu.ht=true;it&&(ye=it.initializeCommandBar(pi,"$Sutra.SkyDrive.SelfCommandBar"),ye&&(ao=ye.getDataModel().list));s.html(lr);var pu=jQuery(".selfi",s).bind(nr,function(n){return t.DomHelpers.isTextInputElement(jQuery(n.target))?undefined:false}),vo=jQuery(".selfb",s),gr=jQuery(".selfps",s),nc=jQuery(".selftn",s),ul=jQuery(".selfnb",s),ea=jQuery(".selfnbs",s),wu=jQuery(".selfp",s),wr=jQuery(wu[0]).attr("role","main"),kr=jQuery(wu[1]),tu=jQuery(wu[2]),nu=jQuery(".selfns",s),uu=jQuery(".selfpa",s),ie=jQuery(".selff",s),fu=jQuery(".selfna",s),cu=jQuery(".selfip",s),bu=jQuery(jQuery(".selfc",s)[0]),tc=jQuery(jQuery(".selfc",s)[1]),lu,yo;wi.moSelf||$B.Mobile?bu.hide():(lu=new rt(bu,pi,ki),yo=new rt(tc,pi,ki),s.addClass(tr));n.useTouchAnimations&&n.useCSS3Animations&&lh();var iu,ih,hf,po,wo,bo,ko,re=window.screen,go=re.deviceXDPI,ns=re.deviceYDPI;window.$theme&&($theme.previewTheme(["SkyDriveDark2",null,null,$theme.version],false,null),s.addClass(ni),window.$CommandBar&&ye.addLightHover());"undefined"!=typeof $WLXIM&&$Do.when("$WLXIM.SidebarCreated",0,function(){jQuery($WLXIM.sidebar).bind("onSidebarOpenCompletedEvent"+e,ru.resize);jQuery($WLXIM.sidebar).bind("onSidebarCloseCompletedEvent"+e,ru.resize)});wi.moSelf?(uh=wi.images,fh=wi.strings,fe=fh.Previous,ee=fh.Next,wo=po=rc(uh.previousEnabled,fe),ko=bo=rc(uh.nextEnabled,ee)):(fe=yt("Previous"),ee=yt("Next"),po=jQuery(p.getImage("previousRest",fe)),wo=jQuery(p.getImage("previousHover",fe)),bo=jQuery(p.getImage("nextRest",ee)),ko=jQuery(p.getImage("nextHover",ee)));po.addClass("selfpar");wo.addClass("selfpah");bo.addClass("selfnar");ko.addClass("selfnah");uu.append(po);uu.append(wo);fu.append(bo);fu.append(ko);$B.Full&&(kr.css({opacity:0}),tu.css({opacity:0}),uu.height(lt),ie.height(nt),fu.height(lt),bu.css(g,wf),wi.moSelf||(iu=new r.FilmStrip(ie,pi,n),hf=new r.TagStatusBar(nc,pi,hu),eh=function(t){n.fullView&&iu&&iu.mouseScroll(t.originalEvent.wheelDelta||t.originalEvent.detail)},pu.bind(st,function(n){eh(n)}),ie.bind(st,function(n){eh(n)})),gr.bind(k,ia),nu.bind(k,ua),h.bind(k,wc),du.bind(er,pl),du.bind(or,wl),we=document,h.bind("fullscreenchange"+e,function(){we.fullscreen||ue()}),h.bind("mozfullscreenchange"+e,function(){we.mozFullScreen||ue()}),h.bind("webkitfullscreenchange"+e,function(){we.webkitIsFullScreen||ue()}),h.bind("msfullscreenchange"+e,function(){we.msFullScreen||ue()}),du.bind("toggleProperties",cc));wi.moSelf||(ih=new r.SelfNotificationBar(ul,pi),ku=new r.InfoPane(cu,pi,bi),du.bind("slideshow",ic));var ou=new r.SelfItem(wr,pi,hu),be=new r.SelfItem(kr,pi,hu),ke=new r.SelfItem(tu,pi,hu);jQuery(r.Video.Events).bind("error",ts);jQuery(r.Video.Events).bind("complete",ts);var de=jQuery(gi).addClass(wt),ol=jQuery(document),ge=ol,is=jQuery("body"),au=pu;au.bind(ot,oh);au.bind(ti,sh);au.bind(ii,hh);au.bind("mousedown",oh);au.bind("mousemove",sh);au.bind("mouseup",hh);ge.bind(kt,oc);ge.bind(l,ec);hs.addListener(t.DataModel.dataChangedEvent,bc,undefined,"SkyDriveWeb_Internal_Control_SelfView_DataChanged");vo.bind(l,yl);wu.bind(l,vl);!wi.moSelf&&$B.Full&&wu.bind(fr,cl);vo.bind(d,sc);wu.bind(d,sc);gr.attr("role","button");gr.attr("aria-label",fe);nu.attr("role","button");nu.attr("aria-label",ee);wi.moSelf?(gr.bind(l,to),nu.bind(l,io)):(gr.bind(d,na),gr.bind(ri,se),gr.bind(ui,se),nu.bind(d,ta),nu.bind(ri,se),nu.bind(ui,se));wu.bind(ot,sl);sutra(gr,"$Sutra.SkyDrive.PreviousHover");sutra(uu,"$Sutra.SkyDrive.PreviousArrow");sutra(nu,"$Sutra.SkyDrive.NextHover");sutra(fu,"$Sutra.SkyDrive.NextArrow");$B.Full&&(n.fullView?u.toggleFixedHeader(true):hc());ru.isLoaded=function(){return ou.isLoaded()};ru.render=function(i){var f,l,e,a,o,u,v;var s=w(ff,i),h=w(rf,i)&&i.getVersion()==ph,y=w(vr,i),r=hs.getItem(i.parentKey);f=i.parentKey;l=uo&&w(pr,r);l||r.folder.photoCount===undefined||r.folder.photoCount<r.getChildren().getCount()?(e=t.SkyDriveItem.getSetKeyParts(t.SkyDriveItem.getDefaultSetKey()),a=t.SkyDriveItem.getSetKey(e.sb,null,t.JSONConstants.FilterType.PhotosAndVideos,t.PageController.getInstance().getGroupByParam(),e.sd),t.SkyDriveItem.setDefaultSetKey(a),uo=true):uo=false;pi.selectionManager.deselectAll();h&&!s&&pr&&uf!=-1||(h||(pi.errorManager.clear(),o="ReadView.Content.File.Photo",i.video&&(o="ReadView.Content.File.Movie"),$BSI.reportEvent(o,{ViewMethod:"oneup",ResourceId:i.id,Extension:i.extension?i.extension.replace(".",c):c})),s?ah():y&&yr!=-1||(u=r.getChildren().indexOf(i),pr&&vr&&uf!=-1&&ro==f&&u!=-1?af(u):(v=rf&&rf.key==i.key,lf(v),ff=null,yf=-1,vr=rf=i,yr=uf=u,pr=r,ro=f,ph=i.getVersion(),vr&&(vr.video?he=true:pf=true),rs(),$B.Mobile&&(window.scrollTo(0,1),n.fullView&&(os(),fs())),uc(),gl())))};ru.resize=function(){uc();iu&&iu.resize();hf&&hf.resize();ku&&ku.resize();lu&&(lu.resize(),yo.resize());ou.resize()};ru.dispose=function(){wh.unbind(bt,rh);wh=null;as=null;lf(false);clearInterval(ne);ne=null;clearTimeout(br);br=null;hs.removeListener(t.DataModel.dataChangedEvent,bc);ge.unbind(kt,oc);ge.unbind(l,ec);ge=null;au.unbind(ot,oh);au.unbind(ti,sh);au.unbind(ii,hh);au=null;pu.unbind();pu=null;cu.unbind();cu=null;vo.unbind();vo=null;wu.unbind();wu=null;gr.unbind();gr=null;nu.unbind();nu=null;jQuery(n).unbind();du.unbind(ht);du.unbind("toggleProperties",cc);du.unbind("slideshow",ic);du=null;h.unbind(k,wc);h.unbind(e);"undefined"!=typeof $WLXIM&&jQuery($WLXIM.sidebar).unbind(e);uu.stop(true);fu.stop(true);de.removeClass(wt);de.removeClass(ut);de=null;s.width("auto");s.height("auto");iu&&(ie.unbind(st),iu.dispose());ih&&ih.dispose();hf&&hf.dispose();ku&&ku.dispose();ou.dispose();ou=null;be.dispose();be=null;ke.dispose();ke=null;jQuery(r.Video.Events).unbind("error",ts).unbind("complete",ts);clearTimeout(eu);eu=null;window.$theme&&($theme.previewTheme(["SkyDrive",null,null,$theme.version],false,null),s.removeClass(ni),window.$CommandBar&&ye.removeLightHover());"undefined"!=typeof $header&&$header.hideLoading();!n.fullView&&u&&u.toggleFixedHeader(true);is=null;ru=null}}var t=wLive.Core,s=t.CommandManager,r=wLive.Controls,it=r.CommandBarHelper,yt=t.AleHelpers.getString,u=window.$baseMaster,p=t.ImageStrip,pt=t.Images,rt=r.EditableText,w=t.SkyDriveItem.areItemsSame,di="search",gi="html",wt="self",ut="selfZoom",f="opacity",c="",bt="load",nr="selectstart",kt="keydown",l="click",i="left",dt="right",a="z-index",gt="linear",e=".SelfView",b="enabled",ni="darkTheme",ft="transitionsOn",et="fullView",tr="webView",ir=$B.IE&&$B.V>9&&window.outerHeight===window.innerHeight,rr=navigator.userAgent.indexOf("ARM")>0,ur=navigator.userAgent.indexOf("MSAppHost")>0,ot=$B.IE?"pointerdown":"touchstart",ti=$B.IE?"pointermove":"touchmove",ii=$B.IE?"pointerup":"touchend",k="mousemove",d="mousedown",fr="contextmenu",ri="mouseleave",ui="mouseup",st="mousewheel DOMMouseScroll",o="top",g="bottom",ht=".self",er="enableTagging"+ht,or="disableTagging"+ht,nt=77,ct=300,lt=40,fi=20,ei=10,oi=20,si=10,hi=20,ci=240,sr=.1,at=$B.rtl?-30:30,li=800,v=50,y=50,tt=200,ai=200,hr=$B.ltr?39:37,cr=$B.ltr?37:39,vi=5,yi=$B.Mobile?3:5,pi='<div class="selfps"><span class="selfih"><\/span><span class="selfpa"><\/span><\/div>',wi='<div class="selfns"><span class="selfih"><\/span><span class="selfna"><\/span><\/div>',lr=($B.Mobile?pi:c)+'<div><div class="selfi"><div class="selfssc"><\/div><div class="selfb"><\/div>'+($B.Mobile?c:pi)+'<div class="selfp"><\/div><div class="selfp"><\/div><div class="selfp"><\/div><div class="selfc"><\/div><div class="selfc" style="visibility: hidden"><\/div>'+($B.Mobile?c:wi)+"<\/div>"+($B.Mobile?wi:c)+'<div class="selfip"><\/div><\/div><div class="selff"><\/div><div class="selfnbs"><div class="selfnb"><\/div><div class="selftn"><\/div><\/div>',bi={fh:true,lp:true,i:true,bici:"IP1",cs:true,oi:true,h:{sp:true,vf:true}},ki=$B.Mobile?null:jQuery.extend({},rt.CaptionOptions,{c:true,hc:true,ic:"selfci"}),n={fullView:true,disableAnimations:$B.Full&&$B.IE&&$B.V<9,useCSS3Animations:!($B.IE&&$B.V<10||$B.Firefox&&$B.V<4),animationDuration:300,animationInterval:v,useTouchAnimations:false},vt=jQuery(window),h=jQuery(document),ar=s?{ViewItem:s.commandDisabled,Rename:s.commandDisabled,NestedDownload:s.commandDisabled,NestedEmbed:s.commandDisabled,Properties:s.commandDisabled,ViewInFolder:s.commandDisabled}:null;r.SelfView=vr;$Do.register("wLive.Controls.SelfView")}()})