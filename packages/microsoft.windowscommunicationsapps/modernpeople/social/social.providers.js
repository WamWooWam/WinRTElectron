//! Copyright (c) Microsoft Corporation. All rights reserved.
Jx.delayDefine(People,"loadSocialProviders",function(){People.loadSocialProviders=Jx.fnEmpty;People.loadSocialImports();People.loadSocialCore();People.loadSocialPlatform();var i=Microsoft.WindowsLive.Instrumentation.PropertyId,n=Microsoft.WindowsLive.Instrumentation.ScenarioId,t=Microsoft.WindowsLive.Instrumentation.ApiId,r=Microsoft.WindowsLive.Instrumentation.ErrorType;People.RecentActivity.Providers.CacheLocation={none:0,contactDataCache:1,feedObjectCache:2};People.RecentActivity.Providers.create_feedObjectRefreshInfo=function(n,t,i){var r={};return n==null&&(n=new Array(0)),t==null&&(t=new Array(0)),i==null&&(i=new Array(0)),r.objectsAdded=n,r.objectsUpdated=t,r.objectsRemoved=i,r};People.RecentActivity.Providers.create_feedObjectSearchResult=function(n,t){var i={};return i.feedObject=n,i.location=t,i};People.RecentActivity.Providers.create_notificationRefreshInfo=function(n,t,i){var r={};return n==null&&(n=new Array(0)),t==null&&(t=new Array(0)),i==null&&(i=new Array(0)),r.notificationsAdded=n,r.notificationsUpdated=t,r.notificationsRemoved=i,r};People.RecentActivity.Providers.create_photoTagRefreshInfo=function(n,t){var i={};return n==null&&(n=new Array(0)),t==null&&(t=new Array(0)),i.photoTagsAdded=n,i.photoTagsRemoved=t,i};People.RecentActivity.Providers.create_resourceRefreshInfo=function(n,t,i){var r={};return r.resourcesAdded=n,r.resourcesUpdated=t,r.resourcesRemoved=i,r};People.RecentActivity.Providers.create_commentRefreshInfo=function(n,t){var i={};return n==null&&(n=new Array(0)),t==null&&(t=new Array(0)),i.commentsAdded=n,i.commentsRemoved=t,i};People.RecentActivity.Providers.create_reactionRefreshInfo=function(n,t){var i={};return n==null&&(n=new Array(0)),t==null&&(t=new Array(0)),i.reactionsAdded=n,i.reactionsRemoved=t,i};People.RecentActivity.Providers.IdentityType={person:0,contact:1};People.RecentActivity.Providers.create_socialNodeContext=function(n){var t={};return t.userIdentity=n,t.photoMap={},t.albumMap={},t};People.RecentActivity.Providers.ContactDataCache=function(n,t){this._userIdentity=n;this._cacheDict=t;this._feedObjectCache=People.RecentActivity.Providers.FeedObjectCache.getInstance(n)};People.RecentActivity.Providers.ContactDataCache.prototype._userIdentity=null;People.RecentActivity.Providers.ContactDataCache.prototype._cacheDict=null;People.RecentActivity.Providers.ContactDataCache.prototype._feedObjectCache=null;Object.defineProperty(People.RecentActivity.Providers.ContactDataCache.prototype,"cacheDictionary",{get:function(){return this._cacheDict}});Object.defineProperty(People.RecentActivity.Providers.ContactDataCache.prototype,"userIdentity",{get:function(){return this._userIdentity}});People.RecentActivity.Providers.ContactDataCache.prototype.addComment=function(n,t,i){var u,f,r;People.RecentActivity.Platform.Configuration.instance.cacheEnabled&&(u=this._cacheDict.item(n),f=this.getObjectByObjectInfo(u,t),t=f.feedObject,r=new People.RecentActivity.Providers.CommentInfoCollection(t.comments),r.add(i),t.comments=r.toArray(),t.commentDetails.count=r.count,this.commit(f,n,u))};People.RecentActivity.Providers.ContactDataCache.prototype.refreshComments=function(n,t,i){if(!People.RecentActivity.Platform.Configuration.instance.cacheEnabled)return People.RecentActivity.Providers.create_commentRefreshInfo(i,new Array(0));var f=this._cacheDict.item(n),r=this.getObjectByObjectInfo(f,t),e=r.feedObject,o=new People.RecentActivity.Providers.CommentInfoCollection(t.comments),u=o.refresh(i),s=false;return(u.commentsAdded.length>0||u.commentsRemoved.length>0)&&(e.comments=o.toArray(),e.commentDetails.count=t.commentDetails.count,s=true),(s||!r.location)&&this.commit(r,n,f),u};People.RecentActivity.Providers.ContactDataCache.prototype.addReaction=function(n,t,i){var r,u,f,e;People.RecentActivity.Platform.Configuration.instance.cacheEnabled&&(r=this._cacheDict.item(n),u=this.getObjectByObjectInfo(r,t),t=u.feedObject,f=new People.RecentActivity.Providers.ReactionInfoCollection(t.reactions),f.add(i),t.reactions=f.toArray(),e=this._getReactionDetailsInfo(t,i),e.count++,this.commit(u,n,r))};People.RecentActivity.Providers.ContactDataCache.prototype.refreshReactions=function(n,t,i){if(!People.RecentActivity.Platform.Configuration.instance.cacheEnabled)return People.RecentActivity.Providers.create_reactionRefreshInfo(i,new Array(0));var f=this._cacheDict.item(n),r=this.getObjectByObjectInfo(f,t),e=r.feedObject,o=new People.RecentActivity.Providers.ReactionInfoCollection(t.reactions),u=o.refresh(i),s=false;return(u.reactionsAdded.length>0||u.reactionsRemoved.length>0)&&(e.reactions=o.toArray(),e.reactionDetails=t.reactionDetails,s=true),(s||!r.location)&&this.commit(r,n,f),u};People.RecentActivity.Providers.ContactDataCache.prototype.removeReaction=function(n,t,i){var r,u,f,e;People.RecentActivity.Platform.Configuration.instance.cacheEnabled&&(r=this._cacheDict.item(n),u=this.getObjectByObjectInfo(r,t),t=u.feedObject,f=new People.RecentActivity.Providers.ReactionInfoCollection(t.reactions),f.remove(i))&&(t.reactions=f.toArray(),e=this._getReactionDetailsInfo(t,i),e.count--,this.commit(u,n,r))};People.RecentActivity.Providers.ContactDataCache.prototype.removeFeedObject=function(n,t){var i,r;People.RecentActivity.Platform.Configuration.instance.cacheEnabled&&(i=this.cacheDictionary.item(n),i.length)&&(r=this.getCollection(i),r.remove(t)&&(i=r.toArray(),this.addCacheEntry(n,i)))};People.RecentActivity.Providers.ContactDataCache.prototype.addCacheEntry=function(n,t){People.RecentActivity.Platform.Configuration.instance.cacheEnabled&&this._cacheDict.add(n,t)};People.RecentActivity.Providers.ContactDataCache.prototype.removeCacheEntry=function(n){People.RecentActivity.Platform.Configuration.instance.cacheEnabled&&this._cacheDict.remove(n)};People.RecentActivity.Providers.ContactDataCache.prototype.clear=function(){People.RecentActivity.Platform.Configuration.instance.cacheEnabled&&this._cacheDict.clear()};People.RecentActivity.Providers.ContactDataCache.prototype.refreshFeedObjects=function(n,t){if(!People.RecentActivity.Platform.Configuration.instance.cacheEnabled)return People.RecentActivity.Providers.create_feedObjectRefreshInfo(t,new Array(0),new Array(0));var u=this.cacheDictionary.item(n),r=this.getCollection(u),i=r.refresh(t);return(i.objectsAdded.length>0||i.objectsRemoved.length>0||i.objectsUpdated.length>0)&&(t=r.toArray(),this.addCacheEntry(n,t)),i};People.RecentActivity.Providers.ContactDataCache.prototype.getFeedObjects=function(n){if(!People.RecentActivity.Platform.Configuration.instance.cacheEnabled)return new Array(0);if(!People.RecentActivity.Platform.Configuration.instance.isOnline){var t=this._cacheDict.getLastUpdateTime(n);if(t==null||((new Date).getTime()-t.getTime())/1e3>People.RecentActivity.Platform.Configuration.instance.offlineCacheRetrievalThreshold)return new Array(0)}return this._cacheDict.item(n)};People.RecentActivity.Providers.ContactDataCache.prototype.addMoreFeedObjects=function(n,t){var u,i,r;t!=null&&t.length&&(u=t[0].type,i=this.getFeedObjects(n),r=u===People.RecentActivity.Core.FeedObjectInfoType.entry?new People.RecentActivity.Providers.FeedEntryInfoCollection(i):new People.RecentActivity.Providers.AlbumInfoCollection(i),r.merge(t),this.addCacheEntry(n,r.toArray()))};People.RecentActivity.Providers.ContactDataCache.prototype.getObjectByObjectInfo=function(n,t){var r=this.getCollection(n),i=t.type!==People.RecentActivity.Core.FeedObjectInfoType.photo?r.findObjectByInfo(t):new People.RecentActivity.Providers.AlbumInfoCollection(n).findPhotoByInfo(t);return i!=null?People.RecentActivity.Providers.create_feedObjectSearchResult(i,1):(i=this._feedObjectCache.getFeedObjectByInfo(t),i!=null)?People.RecentActivity.Providers.create_feedObjectSearchResult(i,2):(Jx.log.write(3,People.Social.format("GetObjectByObjectInfo: object with type {0} and Id {1} is not found in cache!",t.type,t.id)),People.RecentActivity.Providers.create_feedObjectSearchResult(t,0))};People.RecentActivity.Providers.ContactDataCache.prototype.commit=function(n,t,i){n.location===1?this.addCacheEntry(t,i):this._feedObjectCache.addFeedObject(n.feedObject)};People.RecentActivity.Providers.ContactDataCache.prototype._getReactionDetailsInfo=function(n,t){for(var r,i=0;i<n.reactionDetails.length;i++)if(r=n.reactionDetails[i],t.type.id===r.id)return r;return null};People.RecentActivity.Providers.AlbumCache=function(n){People.RecentActivity.Providers.ContactDataCache.call(this,n,new People.RecentActivity.Providers.AlbumDictionary(n))};Jx.inherit(People.RecentActivity.Providers.AlbumCache,People.RecentActivity.Providers.ContactDataCache);People.RecentActivity.Providers.AlbumCache._instances$1={};People.RecentActivity.Providers.AlbumCache.getInstance=function(n){return!Jx.isUndefined(People.RecentActivity.Providers.AlbumCache._instances$1[n])||(People.RecentActivity.Providers.AlbumCache._instances$1[n]=new People.RecentActivity.Providers.AlbumCache(n)),People.RecentActivity.Providers.AlbumCache._instances$1[n]};People.RecentActivity.Providers.AlbumCache.prototype.getAlbums=function(n){return this.getFeedObjects(n)};People.RecentActivity.Providers.AlbumCache.prototype.refreshAlbums=function(n,t){return this.refreshFeedObjects(n,t)};People.RecentActivity.Providers.AlbumCache.prototype.refreshAlbum=function(n,t,i){var e,o,u;if(!People.RecentActivity.Platform.Configuration.instance.cacheEnabled)return People.RecentActivity.Providers.create_feedObjectRefreshInfo(i,new Array(0),new Array(0));var s=this.cacheDictionary.item(n),r=this.getObjectByObjectInfo(s,t),f=false;return!r.location||(f=People.RecentActivity.Providers.SocialHelper.updateAlbum(r.feedObject,t)),e=r.feedObject.data,e.totalCount!==i.length&&(e.totalCount=i.length,f=true),o=new People.RecentActivity.Providers.PhotoInfoCollection(t.data.photos),u=o.refresh(i),(u.objectsAdded.length>0||u.objectsRemoved.length>0||u.objectsUpdated.length>0)&&(e.photos=o.toArray(),f=true),(f||!r.location)&&this.commit(r,n,s),u};People.RecentActivity.Providers.AlbumCache.prototype.refreshPhoto=function(n,t,i){if(!People.RecentActivity.Platform.Configuration.instance.cacheEnabled)return People.RecentActivity.Providers.create_photoTagRefreshInfo(i,new Array(0));var e=this.cacheDictionary.item(n),r=this.getObjectByObjectInfo(e,t),u=false;!r.location||(u=People.RecentActivity.Providers.SocialHelper.updatePhoto(r.feedObject,t));var s=r.feedObject.data,o=new People.RecentActivity.Providers.PhotoTagInfoCollection(t.data.tags),f=o.refresh(i);return(f.photoTagsAdded.length>0||f.photoTagsRemoved.length>0)&&(s.tags=o.toArray(),u=true),(u||!r.location)&&this.commit(r,n,e),f};People.RecentActivity.Providers.AlbumCache.prototype.findObjectById=function(n,t,i){var u=this.getFeedObjects(n),r=new People.RecentActivity.Providers.AlbumInfoCollection(u);return i===People.RecentActivity.Core.FeedObjectInfoType.photoAlbum?r.findObjectById(t):r.findPhotoById(t)};People.RecentActivity.Providers.AlbumCache.prototype.getCollection=function(n){return new People.RecentActivity.Providers.AlbumInfoCollection(n)};People.RecentActivity.Providers.CacheDictionary=function(n,t){this._userIdentity=n;this._cachedEntryListKey=this._userIdentity+"_"+t;this._cachedEntryKeyPrefix=this._cachedEntryListKey;this._initializeCachedEntryList();People.RecentActivity.Providers.Cache.events.addListener("quotaexceeded",this._onQuotaExceeded,this)};People.RecentActivity.Providers.CacheDictionary.prototype._cachedEntryListKey=null;People.RecentActivity.Providers.CacheDictionary.prototype._cachedEntryKeyPrefix=null;People.RecentActivity.Providers.CacheDictionary.prototype._userIdentity=null;People.RecentActivity.Providers.CacheDictionary.prototype._cachedEntryList=null;Object.defineProperty(People.RecentActivity.Providers.CacheDictionary.prototype,"count",{get:function(){return this._cachedEntryList.length}});People.RecentActivity.Providers.CacheDictionary.prototype.clear=function(){for(var n=0;n<this._cachedEntryList.length;n++)this.removeInternal(this._cachedEntryList[n]);People.RecentActivity.Providers.Cache.remove(this._cachedEntryListKey)};People.RecentActivity.Providers.CacheDictionary.prototype.addInternal=function(n,t){this._appendIdentifier(n);People.RecentActivity.Providers.Cache.add(this.getKey(n),t)};People.RecentActivity.Providers.CacheDictionary.prototype.removeInternal=function(n){People.RecentActivity.Providers.Cache.remove(this.getKey(n));this._removeIdentifier(n);this.onRemove(n)};People.RecentActivity.Providers.CacheDictionary.prototype.onRemove=function(){return};People.RecentActivity.Providers.CacheDictionary.prototype.getKey=function(n){return this._cachedEntryKeyPrefix+"_"+n};People.RecentActivity.Providers.CacheDictionary.prototype._initializeCachedEntryList=function(){this._cachedEntryList=People.RecentActivity.Providers.Cache.get(this._cachedEntryListKey);this._cachedEntryList==null&&(this._cachedEntryList=[]);for(var n=0;n<this._cachedEntryList.length-this.maxCachedEntries;n++)this.removeInternal(this._cachedEntryList[n])};People.RecentActivity.Providers.CacheDictionary.prototype._appendIdentifier=function(n){var t=this._cachedEntryList.indexOf(n);this._cachedEntryList.length>0&&t===this._cachedEntryList.length-1||(t>=0?this._cachedEntryList.splice(t,1):this.count===this.maxCachedEntries&&this.removeInternal(this._cachedEntryList[0]),this._cachedEntryList.push(n),this._writeCachedEntryListToCache())};People.RecentActivity.Providers.CacheDictionary.prototype._removeIdentifier=function(n){var t=this._cachedEntryList.indexOf(n);t>=0&&(this._cachedEntryList.splice(t,1),this._writeCachedEntryListToCache())};People.RecentActivity.Providers.CacheDictionary.prototype._writeCachedEntryListToCache=function(){People.RecentActivity.Providers.Cache.add(this._cachedEntryListKey,this._cachedEntryList)};People.RecentActivity.Providers.CacheDictionary.prototype._onQuotaExceeded=function(){var n=this._cachedEntryList.length,t,u,i,r;if(n&&(t=Math.ceil(n/2),t>0))for(u=People.RecentActivity.Platform.Configuration.instance.whatsNewPersonId,i=0;t>0&&i<n;)r=this._cachedEntryList[i],r.indexOf(u)===-1?(this.removeInternal(r),t--,n--):i++};People.RecentActivity.Providers.ContactDataCacheDictionary=function(n,t){People.RecentActivity.Providers.CacheDictionary.call(this,n,t.toString().substr(0,1))};Jx.inherit(People.RecentActivity.Providers.ContactDataCacheDictionary,People.RecentActivity.Providers.CacheDictionary);Object.defineProperty(People.RecentActivity.Providers.ContactDataCacheDictionary.prototype,"maxCachedEntries",{get:function(){return People.RecentActivity.Platform.Configuration.instance.maxCachedContacts},configurable:true});People.RecentActivity.Providers.ContactDataCacheDictionary.prototype.add=function(n,t){var i,r;i=this.maxEntriesPerContact;t!=null&&t.length>i&&(t=t.slice(t.length-i,t.length-i+i));r=this._getIdentifier$1(n);this.addInternal(r,t);People.RecentActivity.Providers.Cache.add(this._getLastUpdateTimeKey$1(r),new Date)};People.RecentActivity.Providers.ContactDataCacheDictionary.prototype.remove=function(n){var t=this._getIdentifier$1(n);this.removeInternal(t);People.RecentActivity.Providers.Cache.remove(this._getLastUpdateTimeKey$1(t))};People.RecentActivity.Providers.ContactDataCacheDictionary.prototype.getLastUpdateTime=function(n){var t=People.RecentActivity.Providers.Cache.get(this._getLastUpdateTimeKey$1(this._getIdentifier$1(n)));return Jx.isNonEmptyString(t)?People.RecentActivity.Core.DateTimeHelper.parseTimeStamp(t):Date.empty};People.RecentActivity.Providers.ContactDataCacheDictionary.prototype.onRemove=function(n){People.RecentActivity.Providers.Cache.remove(this._getLastUpdateTimeKey$1(n))};People.RecentActivity.Providers.ContactDataCacheDictionary.prototype._getIdentifier$1=function(n){return n.sourceId+"_"+n.id};People.RecentActivity.Providers.ContactDataCacheDictionary.prototype._getLastUpdateTimeKey$1=function(n){return this.getKey(n)+"_lastupdated"};People.RecentActivity.Providers.ContactDataCacheDictionary.prototype.item=function(n){return People.RecentActivity.Providers.Cache.get(this.getKey(this._getIdentifier$1(n)))||new Array(0)};People.RecentActivity.Providers.AlbumDictionary=function(n){People.RecentActivity.Providers.ContactDataCacheDictionary.call(this,n,People.RecentActivity.Core.FeedObjectInfoType.photoAlbum)};Jx.inherit(People.RecentActivity.Providers.AlbumDictionary,People.RecentActivity.Providers.ContactDataCacheDictionary);Object.defineProperty(People.RecentActivity.Providers.AlbumDictionary.prototype,"maxEntriesPerContact",{get:function(){return People.RecentActivity.Platform.Configuration.instance.maxCachedAlbumsPerContact},configurable:true});People.RecentActivity.Providers.ResourceInfoCollection=function(n){this._initializeCollection(n)};People.RecentActivity.Providers.ResourceInfoCollection.prototype.resources=null;People.RecentActivity.Providers.ResourceInfoCollection.prototype.map=null;Object.defineProperty(People.RecentActivity.Providers.ResourceInfoCollection.prototype,"count",{get:function(){return this.resources.length}});Object.defineProperty(People.RecentActivity.Providers.ResourceInfoCollection.prototype,"batchSize",{get:function(){return this.maxSize},configurable:true});People.RecentActivity.Providers.ResourceInfoCollection.prototype.isUpdated=function(){return false};People.RecentActivity.Providers.ResourceInfoCollection.prototype.findResourceById=function(n){return this.map[n]};People.RecentActivity.Providers.ResourceInfoCollection.prototype.refreshInternal=function(n){var i,a,r,t,h,u,c,f,l;i=this.batchSize;a=this.count;n.length>i&&(n=n.slice(0,i));var e=Array.apply(null,this.resources),o=[],s=[];for(r=n.length-1;r>=0;r--)if(t=n[r],h=this.getId(t),Jx.isUndefined(this.map[h]))o.unshift(t);else{u=this.map[h];this.isUpdated(u,t)&&s.unshift(t);this.onRefreshed(u,t);c=e.indexOf(u);c!==-1&&e.splice(c,1)}return f=e,l=true,o.length||s.length||f.length!==Math.max(a-i,0)||(l=false,f.length=0),l&&this._initializeCollection(n),People.RecentActivity.Providers.create_resourceRefreshInfo(o,s,f)};People.RecentActivity.Providers.ResourceInfoCollection.prototype.addInternal=function(n){this.resources.length===this.maxSize&&(delete this.map[this.getId(this.resources[0])],this.resources.shift());this.resources.push(n);this.map[this.getId(n)]=n};People.RecentActivity.Providers.ResourceInfoCollection.prototype.removeInternal=function(n){var t,r,i;return t=this.getId(n),Jx.isUndefined(this.map[t])?(Jx.log.write(3,People.Social.format("RemoveInternal: the resource with Id {0} is not found!",t)),false):(r=this.map[t],delete this.map[t],i=this.resources.indexOf(r),i!==-1&&this.resources.splice(i,1),true)};People.RecentActivity.Providers.ResourceInfoCollection.prototype.mergeInternal=function(n){var t,i,e,r,o,f,u;if(!(this.count>=this.maxSize)){for(t=[],i=0,e=n.length;i<e;i++)r=n[i],o=this.getId(r),t.push(r),Jx.isUndefined(this.map[o])||this.removeInternal(r);t.push.apply(t,this.resources);f=this.maxSize;u=t.length;u>f&&(t=t.slice(u-f,u));this._initializeCollection(t)}};People.RecentActivity.Providers.ResourceInfoCollection.prototype.onRefreshed=function(){};People.RecentActivity.Providers.ResourceInfoCollection.prototype._initializeCollection=function(n){var t,i,r;for(this.resources=Array.apply(null,n),this.map={},t=0,i=n.length;t<i;t++)r=this.getId(n[t]),this.map[r]=n[t]};People.RecentActivity.Providers.FeedObjectInfoCollection=function(n){People.RecentActivity.Providers.ResourceInfoCollection.call(this,n)};Jx.inherit(People.RecentActivity.Providers.FeedObjectInfoCollection,People.RecentActivity.Providers.ResourceInfoCollection);Object.defineProperty(People.RecentActivity.Providers.FeedObjectInfoCollection.prototype,"maxSize",{get:function(){return this.getMaxSize()},configurable:true});People.RecentActivity.Providers.FeedObjectInfoCollection.prototype.findObjectById=function(n){return this.findResourceById(n)};People.RecentActivity.Providers.FeedObjectInfoCollection.prototype.findObjectByInfo=function(n){return this.findResourceById(n.id)};People.RecentActivity.Providers.FeedObjectInfoCollection.prototype.refresh=function(n){var t=this.refreshInternal(n);return People.RecentActivity.Providers.create_feedObjectRefreshInfo(t.resourcesAdded,t.resourcesUpdated,t.resourcesRemoved)};People.RecentActivity.Providers.FeedObjectInfoCollection.prototype.add=function(n){this.addInternal(n)};People.RecentActivity.Providers.FeedObjectInfoCollection.prototype.remove=function(n){return this.removeInternal(n)};People.RecentActivity.Providers.FeedObjectInfoCollection.prototype.merge=function(n){this.mergeInternal(n)};People.RecentActivity.Providers.FeedObjectInfoCollection.prototype.toArray=function(){return this.resources};People.RecentActivity.Providers.FeedObjectInfoCollection.prototype.isUpdated=function(n,t){var r=n,u=t,i,f;if(r.commentDetails.count!==u.commentDetails.count||r.commentDetails.permissions!==u.commentDetails.permissions)return true;for(i=0,f=r.reactionDetails.length;i<f;i++)if(r.reactionDetails[i].count!==u.reactionDetails[i].count||r.reactionDetails[i].permissions!==u.reactionDetails[i].permissions)return true;return false};People.RecentActivity.Providers.FeedObjectInfoCollection.prototype.onRefreshed=function(n,t){var i=n,r=t;r.comments=i.comments;r.reactions=i.reactions;People.RecentActivity.Providers.ResourceInfoCollection.prototype.onRefreshed.call(this,n,t)};People.RecentActivity.Providers.FeedObjectInfoCollection.prototype.getMaxSize=function(){return-1};People.RecentActivity.Providers.FeedObjectInfoCollection.prototype.getId=function(n){var t=n;return t.id};People.RecentActivity.Providers.AlbumInfoCollection=function(n){People.RecentActivity.Providers.FeedObjectInfoCollection.call(this,n)};Jx.inherit(People.RecentActivity.Providers.AlbumInfoCollection,People.RecentActivity.Providers.FeedObjectInfoCollection);People.RecentActivity.Providers.AlbumInfoCollection.prototype.findObjectByInfo=function(n){switch(n.type){case People.RecentActivity.Core.FeedObjectInfoType.photoAlbum:return this.findResourceById(n.data.id);case People.RecentActivity.Core.FeedObjectInfoType.photo:return this.findPhotoByInfo(n);default:return null}};People.RecentActivity.Providers.AlbumInfoCollection.prototype.findPhotoByInfo=function(n){var t=this.findObjectById(n.data.albumId);return t==null?null:new People.RecentActivity.Providers.PhotoInfoCollection(t.data.photos).findObjectByInfo(n)};People.RecentActivity.Providers.AlbumInfoCollection.prototype.findPhotoById=function(n){for(var u,r,i=this.resources,t=0;t<i.length;t++)if(u=i[t],r=new People.RecentActivity.Providers.PhotoInfoCollection(u.data.photos).findObjectById(n),r!=null)return r;return null};People.RecentActivity.Providers.AlbumInfoCollection.prototype.isUpdated=function(n,t){if(People.RecentActivity.Providers.FeedObjectInfoCollection.prototype.isUpdated.call(this,n,t))return true;var i=n.data,r=t.data;return i.cover.id!==r.cover.id?true:i.description!==r.description?true:i.name!==r.name?true:i.totalCount!==r.totalCount?true:false};People.RecentActivity.Providers.AlbumInfoCollection.prototype.onRefreshed=function(n,t){var i=n,r=t,u,f;r.commentDetails=i.commentDetails;r.reactionDetails=i.reactionDetails;u=i.data;f=r.data;f.photos=u.photos;People.RecentActivity.Providers.FeedObjectInfoCollection.prototype.onRefreshed.call(this,n,t)};People.RecentActivity.Providers.AlbumInfoCollection.prototype.getMaxSize=function(){return People.RecentActivity.Platform.Configuration.instance.maxCachedAlbumsPerContact};People.RecentActivity.Providers.AlbumInfoCollection.prototype.getId=function(n){var t=n;return t.data.id};People.RecentActivity.Providers.LocalStorage=function(){var n=this.item("__CacheVersion");(Jx.isNullOrUndefined(n)||n<1)&&this.clear()};People.RecentActivity.Providers.LocalStorage._cacheVersionKey="__CacheVersion";People.RecentActivity.Providers.LocalStorage._cacheVersion=1;Object.defineProperty(People.RecentActivity.Providers.LocalStorage,"isSupported",{get:function(){var n=null;try{n=window.localStorage}catch(t){Jx.log.write(3,People.Social.format("Failed to get localStorage: {0}.",t.message))}return!Jx.isNullOrUndefined(n)}});People.RecentActivity.Providers.LocalStorage.prototype.add=function(n,t){window.localStorage.setItem(n,JSON.stringify(t))};People.RecentActivity.Providers.LocalStorage.prototype.remove=function(n){window.localStorage.removeItem(n)};People.RecentActivity.Providers.LocalStorage.prototype.clear=function(){window.localStorage.clear();this.add("__CacheVersion",1)};People.RecentActivity.Providers.LocalStorage.prototype.item=function(n){var t=window.localStorage[n];return t==null?null:JSON.parse(t)};People.RecentActivity.Providers.MemoryStorage=function(){this._storage={}};People.RecentActivity.Providers.MemoryStorage.prototype.add=function(n,t){this._storage[n]=JSON.stringify(t)};People.RecentActivity.Providers.MemoryStorage.prototype.remove=function(n){delete this._storage[n]};People.RecentActivity.Providers.MemoryStorage.prototype.clear=function(){People.Social.clearKeys(this._storage)};People.RecentActivity.Providers.MemoryStorage.prototype.item=function(n){var t=this._storage[n];return t==null?null:JSON.parse(this._storage[n])};People.RecentActivity.Providers.Cache=function(){};People.RecentActivity.Providers.Cache.events={};Jx.mix(People.RecentActivity.Providers.Cache.events,Jx.Events);Jx.mix(People.RecentActivity.Providers.Cache.events,People.Social.Events);People.RecentActivity.Providers.Cache._cache=null;People.RecentActivity.Providers.Cache.add=function(n,t){try{return People.RecentActivity.Providers.Cache._cache.add(n,t),true}catch(i){Jx.log.write(2,People.Social.format("Failed to add key value to cache! Error: {0}.",i.message));Jx.log.pii(People.Social.format("Key:{0}, Value:{1}",n,JSON.stringify(t)))}Jx.log.write(3,"Attempting cache cleanup...");People.RecentActivity.Providers.Cache.events.raiseEvent("quotaexceeded",new People.RecentActivity.EventArgs(null));try{return Jx.log.write(4,"Retrying to add stuff to cache..."),People.RecentActivity.Providers.Cache._cache.add(n,t),true}catch(i){Jx.log.write(2,People.Social.format("Unfortunately cache write failed again! Error: {0}.",i.message))}return false};People.RecentActivity.Providers.Cache.get=function(n){try{return People.RecentActivity.Providers.Cache._cache.item(n)}catch(t){return Jx.log.write(2,People.Social.format("Failed to get cached entry! Error: {0}.",t.message)),Jx.log.pii("Key:"+n),null}};People.RecentActivity.Providers.Cache.remove=function(n){try{return People.RecentActivity.Providers.Cache._cache.remove(n),true}catch(t){return Jx.log.write(2,People.Social.format("Failed to remove cached entry! Error: {0}.",t.message)),Jx.log.pii("Key:"+n),false}};People.RecentActivity.Providers.Cache.clear=function(){People.RecentActivity.Providers.Cache._cache.clear()},function(){People.RecentActivity.Providers.Cache._cache=People.RecentActivity.Providers.LocalStorage.isSupported?new People.RecentActivity.Providers.LocalStorage:new People.RecentActivity.Providers.MemoryStorage}();People.RecentActivity.Providers.CommentInfoCollection=function(n){People.RecentActivity.Providers.ResourceInfoCollection.call(this,n)};Jx.inherit(People.RecentActivity.Providers.CommentInfoCollection,People.RecentActivity.Providers.ResourceInfoCollection);Object.defineProperty(People.RecentActivity.Providers.CommentInfoCollection.prototype,"maxSize",{get:function(){return People.RecentActivity.Platform.Configuration.instance.maxCachedCommentsPerEntry},configurable:true});People.RecentActivity.Providers.CommentInfoCollection.prototype.refresh=function(n){var t=this.refreshInternal(n);return People.RecentActivity.Providers.create_commentRefreshInfo(t.resourcesAdded,t.resourcesRemoved)};People.RecentActivity.Providers.CommentInfoCollection.prototype.add=function(n){this.addInternal(n)};People.RecentActivity.Providers.CommentInfoCollection.prototype.remove=function(n){return this.removeInternal(n)};People.RecentActivity.Providers.CommentInfoCollection.prototype.toArray=function(){return this.resources};People.RecentActivity.Providers.CommentInfoCollection.prototype.getId=function(n){var t=n;return t.id};People.RecentActivity.Providers.FeedCache=function(n){People.RecentActivity.Providers.ContactDataCache.call(this,n,new People.RecentActivity.Providers.FeedDictionary(n))};Jx.inherit(People.RecentActivity.Providers.FeedCache,People.RecentActivity.Providers.ContactDataCache);People.RecentActivity.Providers.FeedCache._instances$1={};People.RecentActivity.Providers.FeedCache.getInstance=function(n){return!Jx.isUndefined(People.RecentActivity.Providers.FeedCache._instances$1[n])||(People.RecentActivity.Providers.FeedCache._instances$1[n]=new People.RecentActivity.Providers.FeedCache(n)),People.RecentActivity.Providers.FeedCache._instances$1[n]};People.RecentActivity.Providers.FeedCache.prototype.getFeedEntries=function(n){return this.getFeedObjects(n)};People.RecentActivity.Providers.FeedCache.prototype.addMoreFeedEntries=function(n,t){this.addMoreFeedObjects(n,t)};People.RecentActivity.Providers.FeedCache.prototype.refreshFeedEntries=function(n,t){return this.refreshFeedObjects(n,t)};People.RecentActivity.Providers.FeedCache.prototype.findObjectById=function(n,t){var i=this.getFeedObjects(n),r=new People.RecentActivity.Providers.FeedEntryInfoCollection(i);return r.findObjectById(t)};People.RecentActivity.Providers.FeedCache.prototype.getCollection=function(n){return new People.RecentActivity.Providers.FeedEntryInfoCollection(n)};People.RecentActivity.Providers.FeedDictionary=function(n){People.RecentActivity.Providers.ContactDataCacheDictionary.call(this,n,People.RecentActivity.Core.FeedObjectInfoType.entry)};Jx.inherit(People.RecentActivity.Providers.FeedDictionary,People.RecentActivity.Providers.ContactDataCacheDictionary);Object.defineProperty(People.RecentActivity.Providers.FeedDictionary.prototype,"maxEntriesPerContact",{get:function(){return People.RecentActivity.Platform.Configuration.instance.maxCachedEntriesPerContact},configurable:true});People.RecentActivity.Providers.FeedEntryInfoCollection=function(n){People.RecentActivity.Providers.FeedObjectInfoCollection.call(this,n)};Jx.inherit(People.RecentActivity.Providers.FeedEntryInfoCollection,People.RecentActivity.Providers.FeedObjectInfoCollection);Object.defineProperty(People.RecentActivity.Providers.FeedEntryInfoCollection.prototype,"batchSize",{get:function(){return People.RecentActivity.Platform.Configuration.instance.feedEntriesBatchSize},configurable:true});People.RecentActivity.Providers.FeedEntryInfoCollection.prototype.getMaxSize=function(){return People.RecentActivity.Platform.Configuration.instance.maxCachedEntriesPerContact};People.RecentActivity.Providers.FeedObjectCache=function(n){this._userIdentity=n;this._cacheDict=new People.RecentActivity.Providers.FeedObjectCacheDictionary(n)};People.RecentActivity.Providers.FeedObjectCache._instances={};People.RecentActivity.Providers.FeedObjectCache.getInstance=function(n){var t,i;return(t=n,!Jx.isUndefined(People.RecentActivity.Providers.FeedObjectCache._instances[t]))?People.RecentActivity.Providers.FeedObjectCache._instances[t]:(i=new People.RecentActivity.Providers.FeedObjectCache(n),People.RecentActivity.Providers.FeedObjectCache._instances[t]=i,i)};People.RecentActivity.Providers.FeedObjectCache.prototype._userIdentity=null;People.RecentActivity.Providers.FeedObjectCache.prototype._cacheDict=null;People.RecentActivity.Providers.FeedObjectCache.prototype.addFeedObject=function(n){People.RecentActivity.Platform.Configuration.instance.cacheEnabled&&this._cacheDict.add(n)};People.RecentActivity.Providers.FeedObjectCache.prototype.getFeedObject=function(n,t){return People.RecentActivity.Platform.Configuration.instance.cacheEnabled?this._cacheDict.item(n,t):null};People.RecentActivity.Providers.FeedObjectCache.prototype.getFeedObjectByInfo=function(n){return People.RecentActivity.Platform.Configuration.instance.cacheEnabled?this._cacheDict.getFeedObjectByInfo(n):null};People.RecentActivity.Providers.FeedObjectCache.prototype.clear=function(){People.RecentActivity.Platform.Configuration.instance.cacheEnabled&&this._cacheDict.clear()};People.RecentActivity.Providers.FeedObjectCacheDictionary=function(n){People.RecentActivity.Providers.CacheDictionary.call(this,n,"o")};Jx.inherit(People.RecentActivity.Providers.FeedObjectCacheDictionary,People.RecentActivity.Providers.CacheDictionary);Object.defineProperty(People.RecentActivity.Providers.FeedObjectCacheDictionary.prototype,"maxCachedEntries",{get:function(){return People.RecentActivity.Platform.Configuration.instance.maxCachedFeedObjects},configurable:true});People.RecentActivity.Providers.FeedObjectCacheDictionary.prototype.add=function(n){this.addInternal(this._getIdentifier$1(n),n)};People.RecentActivity.Providers.FeedObjectCacheDictionary.prototype.getFeedObjectByInfo=function(n){return this._item(this._getIdentifier$1(n))};People.RecentActivity.Providers.FeedObjectCacheDictionary.prototype.item=function(n,t){return this._item(this._makeIdentifier(n,t))};People.RecentActivity.Providers.FeedObjectCacheDictionary.prototype.remove=function(n,t){this.removeInternal(this._makeIdentifier(n,t))};People.RecentActivity.Providers.FeedObjectCacheDictionary.prototype._getIdentifier$1=function(n){var t=null;switch(n.type){case People.RecentActivity.Core.FeedObjectInfoType.entry:t=n.id;break;case People.RecentActivity.Core.FeedObjectInfoType.photo:t=n.data.id;break;case People.RecentActivity.Core.FeedObjectInfoType.photoAlbum:t=n.data.id}return this._makeIdentifier(t,n.type)};People.RecentActivity.Providers.FeedObjectCacheDictionary.prototype._item=function(n){return People.RecentActivity.Providers.Cache.get(this.getKey(n))};People.RecentActivity.Providers.FeedObjectCacheDictionary.prototype._makeIdentifier=function(n,t){return t+"_"+n};People.RecentActivity.Providers.NotificationCache=function(n){this._userIdentity=n};People.RecentActivity.Providers.NotificationCache._instances={};People.RecentActivity.Providers.NotificationCache.getInstance=function(n){var t,i;return(t=n,!Jx.isUndefined(People.RecentActivity.Providers.NotificationCache._instances[t]))?People.RecentActivity.Providers.NotificationCache._instances[t]:(i=new People.RecentActivity.Providers.NotificationCache(n),People.RecentActivity.Providers.NotificationCache._instances[t]=i,i)};People.RecentActivity.Providers.NotificationCache.prototype._userIdentity=null;People.RecentActivity.Providers.NotificationCache.prototype.addCacheEntry=function(n,t){if(People.RecentActivity.Platform.Configuration.instance.cacheEnabled){var i=People.RecentActivity.Platform.Configuration.instance.maxCachedNotificationsPerNetwork;t!=null&&t.length>i&&(t=t.slice(t.length-i,t.length-i+i));People.RecentActivity.Providers.Cache.add(this._getKey(n),t)}};People.RecentActivity.Providers.NotificationCache.prototype.getNotifications=function(n){return People.RecentActivity.Platform.Configuration.instance.cacheEnabled?People.RecentActivity.Providers.Cache.get(this._getKey(n))||new Array(0):new Array(0)};People.RecentActivity.Providers.NotificationCache.prototype.refreshNotifications=function(n,t){if(!People.RecentActivity.Platform.Configuration.instance.cacheEnabled)return People.RecentActivity.Providers.create_notificationRefreshInfo(t,new Array(0),new Array(0));var u=this.getNotifications(n),r=new People.RecentActivity.Providers.NotificationInfoCollection(u),i=r.refresh(t);return(i.notificationsAdded.length>0||i.notificationsRemoved.length>0||i.notificationsUpdated.length>0)&&(t=r.toArray(),this.addCacheEntry(n,t)),i};People.RecentActivity.Providers.NotificationCache.prototype.markNotificationsRead=function(n,t){var i,e,r;if(People.RecentActivity.Platform.Configuration.instance.cacheEnabled){var o=this.getNotifications(n),f=new People.RecentActivity.Providers.NotificationInfoCollection(o),u=false;for(i=0;i<t.length;i++)e=t[i],r=f.findNotificationById(e.id),r!=null&&r.isUnread&&(r.isUnread=false,u||(u=true));u&&(t=f.toArray(),this.addCacheEntry(n,t))}};People.RecentActivity.Providers.NotificationCache.prototype.clear=function(){var t,n,i;if(People.RecentActivity.Platform.Configuration.instance.cacheEnabled)for(t=People.RecentActivity.Platform.Configuration.instance.supportedNetworksForNotification,n=0;n<t.length;n++)i=t[n],People.RecentActivity.Providers.Cache.remove(this._getKey(i))};People.RecentActivity.Providers.NotificationCache.prototype.getLastReadTime=function(n){var t=Jx.appData.localSettings().get(this._getLastReadTimeKey(n));return Jx.isNullOrUndefined(t)?Date.empty:t};People.RecentActivity.Providers.NotificationCache.prototype.updateLastReadTime=function(n,t){var i=this.getLastReadTime(n);(i==null||t>i)&&Jx.appData.localSettings().set(this._getLastReadTimeKey(n),t)};People.RecentActivity.Providers.NotificationCache.prototype._getLastReadTimeKey=function(n){return this._getKey(n)+"_lastread"};People.RecentActivity.Providers.NotificationCache.prototype._getKey=function(n){return this._userIdentity+"_n_"+n};People.RecentActivity.Providers.NotificationInfoCollection=function(n){People.RecentActivity.Providers.ResourceInfoCollection.call(this,n)};Jx.inherit(People.RecentActivity.Providers.NotificationInfoCollection,People.RecentActivity.Providers.ResourceInfoCollection);Object.defineProperty(People.RecentActivity.Providers.NotificationInfoCollection.prototype,"maxSize",{get:function(){return People.RecentActivity.Platform.Configuration.instance.maxCachedNotificationsPerNetwork},configurable:true});People.RecentActivity.Providers.NotificationInfoCollection.prototype.findNotificationById=function(n){return this.findResourceById(n)};People.RecentActivity.Providers.NotificationInfoCollection.prototype.refresh=function(n){var t=this.refreshInternal(n);return People.RecentActivity.Providers.create_notificationRefreshInfo(t.resourcesAdded,t.resourcesUpdated,t.resourcesRemoved)};People.RecentActivity.Providers.NotificationInfoCollection.prototype.toArray=function(){return this.resources};People.RecentActivity.Providers.NotificationInfoCollection.prototype.isUpdated=function(n,t){var i=n,r=t;return i.timestamp!==r.timestamp||i.isUnread!==r.isUnread?true:false};People.RecentActivity.Providers.NotificationInfoCollection.prototype.getId=function(n){var t=n;return t.id};People.RecentActivity.Providers.PhotoInfoCollection=function(n){People.RecentActivity.Providers.FeedObjectInfoCollection.call(this,n)};Jx.inherit(People.RecentActivity.Providers.PhotoInfoCollection,People.RecentActivity.Providers.FeedObjectInfoCollection);People.RecentActivity.Providers.PhotoInfoCollection.prototype.findObjectByInfo=function(n){return this.findResourceById(n.data.id)};People.RecentActivity.Providers.PhotoInfoCollection.prototype.isUpdated=function(n,t){if(People.RecentActivity.Providers.FeedObjectInfoCollection.prototype.isUpdated.call(this,n,t))return true;var i=n.data,r=t.data;return i.caption!==r.caption?true:i.index!==r.index?true:false};People.RecentActivity.Providers.PhotoInfoCollection.prototype.onRefreshed=function(n,t){var i=n,r=t,u,f;r.commentDetails=i.commentDetails;r.reactionDetails=i.reactionDetails;u=i.data;f=r.data;f.tags=u.tags;People.RecentActivity.Providers.FeedObjectInfoCollection.prototype.onRefreshed.call(this,n,t)};People.RecentActivity.Providers.PhotoInfoCollection.prototype.getMaxSize=function(){return People.RecentActivity.Platform.Configuration.instance.maxCachedPhotosPerAlbum};People.RecentActivity.Providers.PhotoInfoCollection.prototype.getId=function(n){var t=n;return t.data.id};People.RecentActivity.Providers.PhotoTagInfoCollection=function(n){People.RecentActivity.Providers.ResourceInfoCollection.call(this,n)};Jx.inherit(People.RecentActivity.Providers.PhotoTagInfoCollection,People.RecentActivity.Providers.ResourceInfoCollection);Object.defineProperty(People.RecentActivity.Providers.PhotoTagInfoCollection.prototype,"maxSize",{get:function(){return People.RecentActivity.Platform.Configuration.instance.maxCachedPhotoTagsPerPhoto},configurable:true});People.RecentActivity.Providers.PhotoTagInfoCollection.prototype.refresh=function(n){var t=this.refreshInternal(n);return People.RecentActivity.Providers.create_photoTagRefreshInfo(t.resourcesAdded,t.resourcesRemoved)};People.RecentActivity.Providers.PhotoTagInfoCollection.prototype.toArray=function(){return this.resources};People.RecentActivity.Providers.PhotoTagInfoCollection.prototype.getId=function(n){var t=n;return t.contact.id};People.RecentActivity.Providers.ReactionInfoCollection=function(n){People.RecentActivity.Providers.ResourceInfoCollection.call(this,n)};Jx.inherit(People.RecentActivity.Providers.ReactionInfoCollection,People.RecentActivity.Providers.ResourceInfoCollection);Object.defineProperty(People.RecentActivity.Providers.ReactionInfoCollection.prototype,"maxSize",{get:function(){return People.RecentActivity.Platform.Configuration.instance.maxCachedReactionsPerEntry},configurable:true});People.RecentActivity.Providers.ReactionInfoCollection.prototype.refresh=function(n){var t=this.refreshInternal(n);return People.RecentActivity.Providers.create_reactionRefreshInfo(t.resourcesAdded,t.resourcesRemoved)};People.RecentActivity.Providers.ReactionInfoCollection.prototype.add=function(n){this.addInternal(n)};People.RecentActivity.Providers.ReactionInfoCollection.prototype.remove=function(n){return this.removeInternal(n)};People.RecentActivity.Providers.ReactionInfoCollection.prototype.toArray=function(){return this.resources};People.RecentActivity.Providers.ReactionInfoCollection.prototype.getId=function(n){var t=n;return People.Social.format("{0}_{1}",t.type.id,t.publisher.id)};People.RecentActivity.Providers.CollectionHelper=function(){};People.RecentActivity.Providers.CollectionHelper.joinKeys=function(n,t){for(var i="",u,r=0;r<n.length;r++)u=n[r],i.length>0&&(i+=","),t?(i+="'",i+=u,i+="'"):i+=u;return i};People.RecentActivity.Providers.EntityHelper=function(){};People.RecentActivity.Providers.EntityHelper._urlRegex="https?://[^\\s/\\[\\]()\\?!]+(/[^\\s()\\[\\]<>:;]*)?";People.RecentActivity.Providers.EntityHelper.getLinkEntities=function(n){var u=[],i,r,t,f;if(!Jx.isNonEmptyString(n))return new Array(0);for(i=new RegExp(People.RecentActivity.Providers.EntityHelper._urlRegex,"gi");(r=i.exec(n))!=null&&r.length>0;)t=r[0],f=People.RecentActivity.Core.create_entityInfo(People.RecentActivity.Core.EntityInfoType.link,People.RecentActivity.Core.create_linkEntityInfo(t,t),i.lastIndex-t.length,t.length),u.push(f);return u};People.RecentActivity.Providers.EntityHelper.sortEntities=function(n){n.sort(function(n,t){return n.offset-t.offset})};People.RecentActivity.Providers.FeedProviderFactory=function(){};People.RecentActivity.Providers.FeedProviderFactory._instance=null;Object.defineProperty(People.RecentActivity.Providers.FeedProviderFactory,"instance",{get:function(){return People.RecentActivity.Providers.FeedProviderFactory._instance==null&&(People.RecentActivity.Providers.FeedProviderFactory._instance=new People.RecentActivity.Providers.FeedProviderFactory),People.RecentActivity.Providers.FeedProviderFactory._instance},set:function(n){People.RecentActivity.Providers.FeedProviderFactory._instance=n}});People.RecentActivity.Providers.FeedProviderFactory.prototype.createFeedProvider=function(n,t,i,r){var u=null;switch(i.id){case People.RecentActivity.Core.NetworkId.facebook:u=new People.RecentActivity.Providers.FacebookProvider(n,t,i,r,false,null);break;case People.RecentActivity.Core.NetworkId.twitter:u=new People.RecentActivity.Providers.SupProvider(n,t,i,r,false,null);break;case People.RecentActivity.Core.NetworkId.all:u=this._getAllNetworkProvider(n,t,r);break;default:throw new Error("Unsupported Social Network!")}return People.RecentActivity.Platform.Configuration.instance.isRetailMode&&(u=new People.RecentActivity.Providers.RetailModeProvider(u,r)),u};People.RecentActivity.Providers.FeedProviderFactory.prototype.getNetworks=function(n){return People.RecentActivity.Platform.Platform.instance.getNetworks(n)};People.RecentActivity.Providers.FeedProviderFactory.prototype.getUserConnectableNetworks=function(){return People.RecentActivity.Platform.Platform.instance.getUserConnectableNetworks()};People.RecentActivity.Providers.FeedProviderFactory.prototype.getNetwork=function(n){return People.RecentActivity.Platform.Platform.instance.getNetworkInfoById(n)};People.RecentActivity.Providers.FeedProviderFactory.prototype.getConfiguration=function(){var n=People.RecentActivity.Platform.Configuration.instance;return People.RecentActivity.Core.create_configurationInfo(n.maxCachedEntriesPerContact,n.feedEntriesBatchSize,n.maxCachedReactionsPerEntry,n.maxCachedPhotoTagsPerPhoto,n.aggregatedNetworkId,n.whatsNewPersonId)};People.RecentActivity.Providers.FeedProviderFactory.prototype._getAllNetworkProvider=function(n,t,i){var r=People.RecentActivity.Platform.Platform.instance.getNetworks(n);return(r=r.filter(function(n){return n.id!==People.RecentActivity.Platform.Configuration.instance.aggregatedNetworkId}),r.length===1)?(Jx.log.write(4,People.Social.format("FeedProviderFactory.GetAllNetworkProvider({0}): only 1 network: {1}",n,r[0].id)),this.createFeedProvider(n,t,r[0],i)):(Jx.log.write(4,People.Social.format("FeedProviderFactory.GetAllNetworkProvider({0}): creating FeedAggregator.",n)),new People.RecentActivity.Providers.FeedAggregator(n,r,i))},function(){var n="UserTileL",t="UserTileXL",i="__fake_album_id__",r="http://graph.facebook.com/{0}/picture?type=large",u="http://www.facebook.com/#!/profile.php?id={0}";People.RecentActivity.Providers.SocialCache=function(n){this._contactDict={};this._photoDict={};this._albumDict={};this._usernameToContactIdMap={};this._objectIdToPhotoIdMap={};this._objectIdToAlbumIdMap={};this._networkId=n};People.RecentActivity.Providers.SocialCache.prototype._networkId=null;People.RecentActivity.Providers.SocialCache.prototype._me=null;Object.defineProperty(People.RecentActivity.Providers.SocialCache.prototype,"meContact",{get:function(){return this._me==null&&(this._me=this.getContact(People.RecentActivity.Platform.AuthInfo.getInstance(this._networkId).userId.id)),this._me}});People.RecentActivity.Providers.SocialCache.prototype.clear=function(){People.Social.clearKeys(this._contactDict);People.Social.clearKeys(this._albumDict);People.Social.clearKeys(this._photoDict);People.Social.clearKeys(this._objectIdToAlbumIdMap);People.Social.clearKeys(this._objectIdToPhotoIdMap);People.Social.clearKeys(this._usernameToContactIdMap)};People.RecentActivity.Providers.SocialCache.prototype.getContact=function(n){var i=this._getKey(n),t;return Jx.isUndefined(this._contactDict[i])?(t=People.RecentActivity.Core.create_contactInfo(n,this._networkId,"","","",false),this._contactDict[i]=t):t=this._contactDict[i],People.RecentActivity.Platform.Platform.instance.getContactInfoDetails(t),t};People.RecentActivity.Providers.SocialCache.prototype.refreshContact=function(n){if(n==null){Jx.log.write(3,People.Social.format("SocialCache.RefreshContact({0}): null contact!",n));return}this.refreshContacts([n])};People.RecentActivity.Providers.SocialCache.prototype.refreshContacts=function(n){var o,e,s,i,f,t;if(!People.RecentActivity.Providers.Utilities.isArray(n)){Jx.log.write(3,"SocialCache.RefreshContacts()");return}switch(this._networkId){case People.RecentActivity.Core.NetworkId.facebook:for(o=n,i=0;i<o.length;i++)(e=o[i],People.RecentActivity.Providers.FacebookValidator.validateContact(e))&&(t=this.getContact(e.id.toString()),t.personId==null&&(t.name=e.name||t.name,t.picture=e.pic_square||t.picture,t.isFriend=false,t.largePicture=People.Social.format(r,t.id),t.profileUrl=People.Social.format(u,t.id)));break;case People.RecentActivity.Core.NetworkId.twitter:for(s=n,i=0;i<s.length;i++)(f=s[i],People.RecentActivity.Providers.SupValidator.validateContact(f))&&(t=this.getContact(f.ObjectId),t.networkHandle=f.ScreenName,t.personId==null&&(t.name=f.Name||t.name,t.isFriend=false,t.profileUrl=f.ProfileUrl,this._updateSupUserProfilePics(t,f)))}};People.RecentActivity.Providers.SocialCache.prototype.getPhoto=function(n){var i,r,t,o,f;if(i=this._getKey(n),r=People.RecentActivity.Platform.Configuration.instance,Jx.isUndefined(this._photoDict[i])){var s=People.RecentActivity.Core.create_photoInfo(n,null,null,null,null,0,0,null,0,0,null,0,0),u=r.getNetworkReactionInfos(this._networkId),e=new Array(u.length);for(t=0,o=u.length;t<o;t++)e[t]=People.RecentActivity.Core.create_reactionDetailsInfo(u[t].id,0,People.RecentActivity.Core.Permissions.none);f=People.RecentActivity.Core.create_commentDetailsInfo(0,this._networkId!==People.RecentActivity.Core.NetworkId.twitter,People.RecentActivity.Core.Permissions.none);f.icon=r.getCommentIcon(this._networkId);this._photoDict[i]=People.RecentActivity.Core.create_feedObjectInfo(null,this._networkId,People.RecentActivity.Core.FeedObjectInfoType.photo,s,null,0,f,new Array(0),e,new Array(0))}return this._photoDict[i]};People.RecentActivity.Providers.SocialCache.prototype.refreshPhoto=function(n,t){if(t==null){Jx.log.write(3,People.Social.format("SocialCache.RefreshPhoto({0}): null photo!",t));return}this.refreshPhotos(n,[t])};People.RecentActivity.Providers.SocialCache.prototype.refreshPhotos=function(n,t){var o,u,s,e,f,i,r,c,h;if(!People.RecentActivity.Providers.Utilities.isArray(t)){Jx.log.write(3,"SocialCache.RefreshPhotos()");return}switch(this._networkId){case People.RecentActivity.Core.NetworkId.facebook:for(o=t,e=0;e<o.length;e++)(u=o[e],People.RecentActivity.Providers.FacebookValidator.validatePhoto(u))&&(i=this.getPhoto(u.pid),r=i.data,i.id=Jx.isNullOrUndefined(u.object_id)?i.id:u.object_id.toString(),i.url=u.link||i.url,i.timestamp=isNaN(u.created)?i.timestamp:People.RecentActivity.Providers.SocialHelper.getValidTime(u.created),r.caption=u.caption||r.caption,r.albumId=Jx.isNonEmptyString(u.aid)?u.aid:r.albumId,r.owner=Jx.isNullOrUndefined(u.owner)?r.owner:this.getContact(u.owner.toString()),r.entities.length||(r.entities=People.RecentActivity.Providers.EntityHelper.getLinkEntities(r.caption)),this._updateFacebookReactions(i,u.comment_info,u.like_info),this._populateFacebookPhotoImages(r,u));break;case People.RecentActivity.Core.NetworkId.twitter:for(s=t,e=0;e<s.length;e++)(f=s[e],People.RecentActivity.Providers.SupValidator.validatePhoto(f))&&(i=this.getPhoto(f.ObjectId),r=i.data,i.id=Jx.isNonEmptyString(f.activityObjectId)?f.activityObjectId:i.id,i.url=f.url||i.url,i.timestamp=isNaN(f.timestamp)?i.timestamp:f.timestamp,r.owner=f.author!=null&&Jx.isNonEmptyString(f.author.ObjectId)?this.getContact(f.author.ObjectId):r.owner,r.albumId="__fake_twitter_aid__"+f.ObjectId,this.refreshContact(f.author),c=f.author!=null?f.author.ScreenName:"",i.commentDetails.prefix=People.RecentActivity.Providers.SocialHelper.getTwitterCommentPrefix(c),h=n.Reactions.ReplyReaction.TextLimit,h>0&&(i.commentDetails.maximumLength=h),this._populateTwitterPhotoImages(r,f.Streams),this._enableSupReactions(i))}};People.RecentActivity.Providers.SocialCache.prototype.getAlbum=function(n){var t;if(t=this._getKey(n),Jx.isUndefined(this._albumDict[t])){var u=People.RecentActivity.Core.create_photoAlbumInfo(n,null,null,null,new Array(0),0,null,new Array(0)),f=People.RecentActivity.Platform.Configuration.instance.getNetworkReactionInfoByType(People.RecentActivity.Core.NetworkReactionInfoType.like),r=People.RecentActivity.Core.create_commentDetailsInfo(0,this._networkId!==People.RecentActivity.Core.NetworkId.twitter,People.RecentActivity.Core.Permissions.none);r.icon=People.RecentActivity.Platform.Configuration.instance.getCommentIcon(this._networkId);this._albumDict[t]=People.RecentActivity.Core.create_feedObjectInfo(i,this._networkId,People.RecentActivity.Core.FeedObjectInfoType.photoAlbum,u,null,0,r,new Array(0),[People.RecentActivity.Core.create_reactionDetailsInfo(f.id,0,People.RecentActivity.Core.Permissions.none)],new Array(0))}return this._albumDict[t]};People.RecentActivity.Providers.SocialCache.prototype.refreshAlbums=function(n){var f,u,t,r,i;if(!People.RecentActivity.Providers.Utilities.isArray(n)){Jx.log.write(3,"SocialCache.RefreshAlbums()");return}switch(this._networkId){case People.RecentActivity.Core.NetworkId.facebook:for(f=n,u=0;u<f.length;u++)(t=f[u],People.RecentActivity.Providers.FacebookValidator.validateAlbum(t))&&(r=this.getAlbum(t.aid),i=r.data,r.id=Jx.isNullOrUndefined(t.object_id)?r.id:t.object_id.toString(),r.url=t.link||r.url,r.timestamp=isNaN(t.modified)?r.timestamp:People.RecentActivity.Providers.SocialHelper.getValidTime(t.modified),i.name=t.name||i.name,i.description=t.description||i.description,i.totalCount=isNaN(t.size)?i.totalCount:t.size,i.cover=Jx.isNonEmptyString(t.cover_pid)?this.getPhoto(t.cover_pid):i.cover,i.owner=Jx.isNullOrUndefined(t.owner)?i.owner:this.getContact(t.owner.toString()),i.entities=People.RecentActivity.Providers.EntityHelper.getLinkEntities(i.description),this._updateFacebookReactions(r,t.comment_info,t.like_info))}};People.RecentActivity.Providers.SocialCache.prototype.getContactId=function(n){var t=this._getKey(n);return this._usernameToContactIdMap[t]};People.RecentActivity.Providers.SocialCache.prototype.updateContactIdMap=function(n){var t,i,r;switch(this._networkId){case People.RecentActivity.Core.NetworkId.facebook:for(t=0;t<n.length;t++)i=n[t],r=this._getKey(i.username),this._usernameToContactIdMap[r]=i.id.toString()}};People.RecentActivity.Providers.SocialCache.prototype.getPhotoId=function(n){var t=this._getKey(n);return this._objectIdToPhotoIdMap[t]};People.RecentActivity.Providers.SocialCache.prototype.updatePhotoIdMap=function(n){var t,i,r;switch(this._networkId){case People.RecentActivity.Core.NetworkId.facebook:for(t=0;t<n.length;t++)i=n[t],r=this._getKey(i.object_id.toString()),this._objectIdToPhotoIdMap[r]=i.pid}};People.RecentActivity.Providers.SocialCache.prototype.getAlbumId=function(n){var t=this._getKey(n);return this._objectIdToAlbumIdMap[t]};People.RecentActivity.Providers.SocialCache.prototype.updateAlbumIdMap=function(n){var t,i,r;switch(this._networkId){case People.RecentActivity.Core.NetworkId.facebook:for(t=0;t<n.length;t++)i=n[t],r=this._getKey(i.object_id.toString()),this._objectIdToAlbumIdMap[r]=i.aid}};People.RecentActivity.Providers.SocialCache.prototype._getKey=function(n){return this._networkId+n};People.RecentActivity.Providers.SocialCache.prototype._populateFacebookPhotoImages=function(n,t){var r=[],i;r.push(People.RecentActivity.Providers.Sup.create_picture(t.src_small,t.src_small_height,t.src_small_width));r.push(People.RecentActivity.Providers.Sup.create_picture(t.src,t.src_height,t.src_width));r.push(People.RecentActivity.Providers.Sup.create_picture(t.src_big,t.src_big_height,t.src_big_width));i=this._getPicture(r,2);i!=null&&(n.originalSource=n.source=i.Url,n.originalSourceHeight=n.sourceHeight=isNaN(i.Height)?0:i.Height,n.originalSourceWidth=n.sourceWidth=isNaN(i.Width)?0:i.Width,i=this._getPicture(r,1),n.thumbnailSource=i.Url,n.thumbnailSourceHeight=isNaN(i.Height)?0:i.Height,n.thumbnailSourceWidth=isNaN(i.Width)?0:i.Width)};People.RecentActivity.Providers.SocialCache.prototype._populateTwitterPhotoImages=function(n,t){var u,f,e,r,i;if(People.RecentActivity.Providers.Utilities.isArray(t)){for(u={},f=0;f<t.length;f++)(e=t[f],Jx.isNonEmptyString(e.Size))&&(u[e.Size]=e);r=[];r.push(u.Small||People.RecentActivity.Providers.Sup.create_picture());r.push(u.Medium||People.RecentActivity.Providers.Sup.create_picture());r.push(u.Large||People.RecentActivity.Providers.Sup.create_picture());i=this._getPicture(r,0);i!=null&&(n.thumbnailSource=i.Url||"",n.thumbnailSourceWidth=isNaN(i.Width)?0:i.Width,n.thumbnailSourceHeight=isNaN(i.Height)?0:i.Height,i=this._getPicture(r,1),n.source=i.Url||"",n.sourceWidth=isNaN(i.Width)?0:i.Width,n.sourceHeight=isNaN(i.Height)?0:i.Height,i=this._getPicture(r,2),n.originalSource=i.Url||"",n.originalSourceWidth=isNaN(i.Width)?0:i.Width,n.originalSourceHeight=isNaN(i.Height)?0:i.Height)}};People.RecentActivity.Providers.SocialCache.prototype._getPicture=function(n,t){for(var r=n.length,u=0,i=t;u<r;){if(Jx.isNonEmptyString(n[i].Url))return n[i];t===r-1?i--:i=(i+1)%r;u++}return Jx.log.write(3,"SocialCache.GetPicture: pictures are all invalid!"),null};People.RecentActivity.Providers.SocialCache.prototype._updateSupUserProfilePics=function(i,r){var s=r.ProfilePicStreams,u,f,e,h,o;if(!People.RecentActivity.Providers.Utilities.isArray(s)){Jx.log.write(3,"SocialCache._updateSupUserProfilePics: No ProfilePicStreams available for the user:");Jx.log.pii(People.Social.format("{0}, {1}",r.ObjectId,r.Name));return}for(u=null,f=null,e=0,h=s.length;e<h;e++){o=s[e];switch(o.Size){case n:u=o.Url;break;case t:f=o.Url}}Jx.isNonEmptyString(u)?i.picture=u:(Jx.log.write(3,People.Social.format("SocialCache._updateSupUserProfilePics: No '{0}' tile found for the user:",n)),Jx.log.pii(People.Social.format("{0}, {1}",r.ObjectId,r.Name)));Jx.isNonEmptyString(f)?i.largePicture=f:(Jx.log.write(3,People.Social.format("SocialCache._updateSupUserProfilePics: No '{0}' tile found for the user:",t)),Jx.log.pii(People.Social.format("{0}, {1}",r.ObjectId,r.Name)))};People.RecentActivity.Providers.SocialCache.prototype._updateFacebookReactions=function(n,t,i){n.commentDetails.permissions=t==null||t.can_comment?People.RecentActivity.Core.Permissions.add:People.RecentActivity.Core.Permissions.none;var r=n.reactionDetails[0];r.permissions=i==null||i.can_like?People.RecentActivity.Core.Permissions.full:People.RecentActivity.Core.Permissions.none;i==null||Jx.isNullOrUndefined(i.like_count)||(r.count=i.like_count)};People.RecentActivity.Providers.SocialCache.prototype._enableSupReactions=function(n){var r,t,i,u;for(n.commentDetails.permissions=People.RecentActivity.Core.Permissions.add,r=People.RecentActivity.Platform.Configuration.instance,t=0;t<n.reactionDetails.length;t++)i=n.reactionDetails[t],u=r.getNetworkReactionInfoById(i.id),i.permissions=u.type===People.RecentActivity.Core.NetworkReactionInfoType.retweet?People.RecentActivity.Core.Permissions.add:People.RecentActivity.Core.Permissions.full}}();People.RecentActivity.Providers.SocialHelper=function(){};People.RecentActivity.Providers.SocialHelper.updateAlbum=function(n,t){var u,i,r;return u=false,n.id!==t.id&&(n.id=t.id,u=true),n.url!==t.url&&(n.url=t.url,u=true),n.timestamp!==t.timestamp&&(n.timestamp=t.timestamp,u=true),i=n.data,r=t.data,(i.cover==null||i.cover.id!==r.cover.id)&&(i.cover=r.cover,u=true),i.description!==r.description&&(i.description=r.description,i.entities=r.entities,u=true),i.name!==r.name&&(i.name=r.name,u=true),(i.owner==null||i.owner.id!==r.owner.id)&&(i.owner=r.owner,u=true),i.totalCount!==r.totalCount&&(i.totalCount=r.totalCount,u=true),u};People.RecentActivity.Providers.SocialHelper.updatePhoto=function(n,t){var u=false,i=n.data,r=t.data;return n.url!==t.url&&(n.url=t.url,u=true),n.timestamp!==t.timestamp&&(n.timestamp=t.timestamp,u=true),i.caption!==r.caption&&(i.caption=r.caption,i.entities=r.entities,u=true),i.index!==r.index&&r.index>=0&&(i.index=r.index,u=true),(i.owner==null||i.owner.id!==r.owner.id)&&(i.owner=r.owner,u=true),u};People.RecentActivity.Providers.SocialHelper.joinContactIds=function(n){return People.RecentActivity.Providers.SocialHelper._joinContactIdMap(n,function(n){return n.value.id})};People.RecentActivity.Providers.SocialHelper.joinSourceIdsAndContactIds=function(n){return People.RecentActivity.Providers.SocialHelper._joinContactIdMap(n,function(n){return n.key+":"+n.value.id})};People.RecentActivity.Providers.SocialHelper.getValidTime=function(n){return Jx.isUndefined(n)?0:n*1e3};People.RecentActivity.Providers.SocialHelper.getTwitterEntryUrl=function(n,t){return!Jx.isNonEmptyString(n)||!Jx.isNonEmptyString(t)?"":"http://www.twitter.com/"+n+"/status/"+t};People.RecentActivity.Providers.SocialHelper.getTwitterCommentPrefix=function(n){return Jx.isNonEmptyString(n)||Jx.log.write(3,People.Social.format("SocialHelper.GetTwitterCommentPrefix({0}): null or empty screenName ",n)),"@"+n+" "};People.RecentActivity.Providers.SocialHelper.mergePhotos=function(n,t,i){var u,e,r,f,o;if(n==null||n.length===0)return Array.apply(null,t);if(u=Array.apply(null,n),t==null||t.length===0)return u;for(e={},r=0,f=n.length;r<f;r++)e[n[r].data.id]=true;for(r=0,f=t.length;r<f;r++)Jx.isUndefined(e[t[r].data.id])&&(o=t[r],i&&(o.data.index=u.length),u.push(o));return u};People.RecentActivity.Providers.SocialHelper._joinContactIdMap=function(n,t){var i,r,u;i="";for(r in n)u={key:r,value:n[r]},i.length>0&&(i+=","),i+=t(u);return i},function(){function n(n){return Jx.isUndefined(n)?"undefined":n===null?"null":n.toString().length}People.RecentActivity.Providers.FacebookValidator=function(){};People.RecentActivity.Providers.FacebookValidator.validateFeedEntry=function(t){return t==null?(Jx.log.write(3,People.Social.format("FacebookValidator.ValidateFeedEntry({0}): null entry!",t)),false):Jx.isNullOrUndefined(t.actor_id)?(Jx.log.write(3,People.Social.format("FacebookValidator.ValidateFeedEntry({0})",n(t.actor_id))),false):true};People.RecentActivity.Providers.FacebookValidator.validateContact=function(t){if(t==null)return Jx.log.write(3,People.Social.format("FacebookValidator.ValidateContact({0}): null contact!",t)),false;var i=Jx.isNullOrUndefined(t.id);return!i&&Jx.isNonEmptyString(t.name)&&Jx.isNonEmptyString(t.pic_square)||Jx.log.write(3,People.Social.format("FacebookValidator.ValidateContact({0},{1},{2})",n(t.id),n(t.name),n(t.pic_square))),!i};People.RecentActivity.Providers.FacebookValidator.validateAlbum=function(t){if(t==null)return Jx.log.write(3,People.Social.format("FacebookValidator.ValidateAlbum({0}): null album!",t)),false;var i=!Jx.isNonEmptyString(t.aid);return(i||!Jx.isNonEmptyString(t.cover_pid)||Jx.isNullOrUndefined(t.description)||!Jx.isNonEmptyString(t.link)||Jx.isNullOrUndefined(t.name)||Jx.isNullOrUndefined(t.object_id)||Jx.isNullOrUndefined(t.owner)||isNaN(t.size)||isNaN(t.modified))&&Jx.log.write(3,People.Social.format("FacebookValidator.ValidateAlbum({0},{1},{2},{3},{4},{5},{6},{7},{8})",n(t.aid),n(t.cover_pid),n(t.description),n(t.link),n(t.name),n(t.object_id),t.owner,t.size,t.modified)),!i};People.RecentActivity.Providers.FacebookValidator.validatePhoto=function(t){if(t==null)return Jx.log.write(3,People.Social.format("FacebookValidator.ValidatePhoto({0}): null photo!",t)),false;var i=!Jx.isNonEmptyString(t.pid)||!Jx.isNonEmptyString(t.src_small)&&!Jx.isNonEmptyString(t.src)&&!Jx.isNonEmptyString(t.src_big);return(i||!Jx.isNonEmptyString(t.aid)||Jx.isNullOrUndefined(t.caption)||!Jx.isNonEmptyString(t.link)||Jx.isNullOrUndefined(t.object_id)||Jx.isNullOrUndefined(t.owner)||isNaN(t.created)||isNaN(t.src_big_height)||isNaN(t.src_big_width)||isNaN(t.src_height)||isNaN(t.src_width)||isNaN(t.src_small_height)||isNaN(t.src_small_width))&&Jx.log.write(3,People.Social.format("FacebookValidator.ValidatePhoto({0},{1},{2},{3},{4},{5},{6},{7},{8},{9},{10},{11},{12},{13},{14},{15})",n(t.aid),n(t.caption),n(t.link),n(t.object_id),t.owner,n(t.pid),t.created,n(t.src_big),t.src_big_height,t.src_big_width,n(t.src),t.src_height,t.src_width,n(t.src_small),t.src_small_height,t.src_small_width)),!i};People.RecentActivity.Providers.FacebookValidator.validateNotification=function(t){if(t==null)return Jx.log.write(3,People.Social.format("FacebookValidator.ValidateNotification({0}): null notification!",t)),false;var i=!Jx.isNonEmptyString(t.notification_id)||Jx.isNullOrUndefined(t.sender_id)||!Jx.isNonEmptyString(t.title_text)||!Jx.isNonEmptyString(t.href);return(i||isNaN(t.updated_time)||isNaN(t.is_unread)||Jx.isNullOrUndefined(t.object_id)||!Jx.isNonEmptyString(t.object_type))&&Jx.log.write(3,People.Social.format("FacebookValidator.ValidateNotification({0},{1},{2},{3},{4},{5},{6},{7})",n(t.notification_id),n(t.sender_id),n(t.title_text),t.updated_time,n(t.href),t.is_unread,n(t.object_id),t.object_type)),!i};People.RecentActivity.Providers.FacebookValidator.validatePhotoMedia=function(t){return t==null?(Jx.log.write(3,People.Social.format("FacebookValidator.ValidatePhotoMedia({0}): null media!",t)),false):t.photo==null?(Jx.log.write(3,People.Social.format("FacebookValidator.ValidatePhotoMedia({0}): null media.Photo!",t.photo)),false):!Jx.isNonEmptyString(t.photo.pid)||!Jx.isNonEmptyString(t.photo.aid)?(Jx.log.write(3,People.Social.format("FacebookValidator.ValidatePhotoMedia({0},{1})",n(t.photo.pid),n(t.photo.aid))),false):true};People.RecentActivity.Providers.FacebookValidator.validateVideoMedia=function(t){return t==null?(Jx.log.write(3,People.Social.format("FacebookValidator.ValidateVideoMedia({0}): null media!",t)),false):t.video==null?(Jx.log.write(3,People.Social.format("FacebookValidator.ValidateVideoMedia({0}): null media.Video!",t.video)),false):!Jx.isNonEmptyString(t.video.source_url)&&!Jx.isNonEmptyString(t.video.display_url)?(Jx.log.write(3,People.Social.format("FacebookValidator.ValidateVideoMedia({0},{1})",n(t.video.source_url),n(t.video.display_url))),false):true};People.RecentActivity.Providers.FacebookValidator.validateCommentsInfo=function(n){if(n==null)return Jx.log.write(3,People.Social.format("FacebookValidator.ValidateCommentsInfo({0}): null info!",n)),false;var t=isNaN(n.comment_count);return(t||Jx.isNullOrUndefined(n.can_comment))&&Jx.log.write(3,People.Social.format("FacebookValidator.ValidateCommentsInfo({0},{1})",n.comment_count,n.can_comment)),!t};People.RecentActivity.Providers.FacebookValidator.validateLikesInfo=function(n){if(n==null)return Jx.log.write(3,People.Social.format("FacebookValidator.ValidateLikesInfo({0}): null info!",n)),false;var t=isNaN(n.count);return(t||Jx.isNullOrUndefined(n.can_like)||Jx.isNullOrUndefined(n.user_likes))&&Jx.log.write(3,People.Social.format("FacebookValidator.ValidateLikesInfo({0},{1})",n.count,n.can_like)),!t};People.RecentActivity.Providers.FacebookValidator.validateComment=function(t,i){return t==null?(Jx.log.write(3,People.Social.format("FacebookValidator.ValidateComment({0}): null comment!",t)),false):Jx.isNullOrUndefined(t.fromid)||!Jx.isNonEmptyString(t.id)||!Jx.isNonEmptyString(t.text)||i&&Jx.isNullOrUndefined(t.object_id)?(Jx.log.write(3,People.Social.format("FacebookValidator.ValidateComment({0},{1},{2},{3})",n(t.fromid),n(t.id),n(t.text),n(t.object_id))),false):true};People.RecentActivity.Providers.FacebookValidator.validateLike=function(t){return t==null?(Jx.log.write(3,People.Social.format("FacebookValidator.ValidateLike({0}): null like!",t)),false):Jx.isNullOrUndefined(t.object_id)||Jx.isNullOrUndefined(t.user_id)?(Jx.log.write(3,People.Social.format("FacebookValidator.ValidateLike({0},{1})",n(t.object_id),n(t.user_id))),false):true};People.RecentActivity.Providers.FacebookValidator.validatePhotoTag=function(t){if(t==null)return Jx.log.write(3,People.Social.format("FacebookValidator.ValidatePhotoTag({0}): null tag!",t)),false;var i=Jx.isNullOrUndefined(t.subject)||!Jx.isNonEmptyString(t.subject.toString());return(i||isNaN(t.xcoord)||isNaN(t.ycoord))&&Jx.log.write(3,People.Social.format("FacebookValidator.ValidatePhotoTag({0},{1},{2})",n(t.subject),t.xcoord,t.ycoord)),!i};People.RecentActivity.Providers.FacebookValidator.validateMessageTag=function(t){return t==null?(Jx.log.write(3,People.Social.format("FacebookValidator.ValidateMessageTag({0}): null tag!",t)),false):Jx.isNullOrUndefined(t.id)||isNaN(t.length)||isNaN(t.offset)?(Jx.log.write(3,People.Social.format("FacebookValidator.ValidateMessageTag({0},{1},{2})",n(t.id),t.length,t.offset)),false):true};People.RecentActivity.Providers.FacebookValidator.validateResultSet=function(n){return n==null?(Jx.log.write(3,People.Social.format("FacebookValidator.ValidateResultSet({0}): null result!",n)),false):People.RecentActivity.Providers.Utilities.isArray(n.fql_result_set)?true:(Jx.log.write(3,People.Social.format("FacebookValidator.ValidateResultSet({0}): ResultSet is not an array!",n.name)),false)}}(),function(){function n(n){return Jx.isUndefined(n)?"undefined":n===null?"null":n.toString().length}People.RecentActivity.Providers.SupValidator=function(){};People.RecentActivity.Providers.SupValidator.validateFeedEntry=function(t){if(t==null)return Jx.log.write(3,People.Social.format("SupValidator.ValidateFeedEntry({0}): null entry!",t)),false;var i=!Jx.isNonEmptyString(t.ObjectId)||!Jx.isNonEmptyString(t.SourceId)||!Jx.isNonEmptyString(t.Type)||t.Author==null||!Jx.isNonEmptyString(t.Author.ObjectId);return(i||!Jx.isNonEmptyString(t.Published)||t.Message==null)&&Jx.log.write(3,People.Social.format("SupValidator.ValidateFeedEntry({0},{1},{2},{3},{4},{5})",n(t.ObjectId),t.SourceId,t.Published,t.Author!=null?n(t.Author.ObjectId)+";"+n(t.Author.ScreenName):"",t.Message!=null?n(t.Message.Text):"",t.Type)),!i};People.RecentActivity.Providers.SupValidator.validateContact=function(t){if(t==null)return Jx.log.write(3,People.Social.format("SupValidator.ValidateContact({0}): null contact!",t)),false;var i=!Jx.isNonEmptyString(t.ObjectId);return!i&&Jx.isNonEmptyString(t.Name)&&Jx.isNonEmptyString(t.ScreenName)&&Jx.isNonEmptyString(t.SourceId)||Jx.log.write(3,People.Social.format("SupValidator.ValidateContact({0},{1},{2},{3})",n(t.ObjectId),n(t.Name),n(t.ScreenName),t.SourceId)),!i};People.RecentActivity.Providers.SupValidator.validatePhoto=function(t){var u,o,f,e,r,i;if(t==null)return Jx.log.write(3,People.Social.format("SupValidator.ValidatePhoto({0}): null photo!",t)),false;if(u=true,(o=People.RecentActivity.Providers.Utilities.isArray(t.Streams))&&Jx.isNonEmptyString(t.activityObjectId)&&t.author!=null&&Jx.isNonEmptyString(t.author.ObjectId)&&Jx.isNonEmptyString(t.author.ScreenName)&&Jx.isNonEmptyString(t.ObjectId)&&Jx.isNonEmptyString(t.SourceId)&&!isNaN(t.timestamp)&&Jx.isNonEmptyString(t.url)||(u=false),u)for(r=0;r<t.Streams.length;r++)if(i=t.Streams[r],!Jx.isNonEmptyString(i.Url)||!Jx.isNonEmptyString(i.Size)||isNaN(i.Height)||isNaN(i.Width)){u=false;break}if(!u&&(f=null,e=null,t.author!=null&&(f=t.author.ObjectId,e=t.author.ScreenName),Jx.log.write(3,People.Social.format("SupValidator.ValidatePhoto({0},{1},{2},{3},{4},{5},{6})",n(t.activityObjectId),n(f),n(e),n(t.ObjectId),t.SourceId,t.timestamp,n(t.url))),o))for(r=0;r<t.Streams.length;r++)i=t.Streams[r],Jx.log.write(3,People.Social.format("SupValidator.ValidatePhoto({0},{1},{2},{3})",i.Size,n(i.Url),i.Height,i.Width));return Jx.isNonEmptyString(t.ObjectId)};People.RecentActivity.Providers.SupValidator.validateEntity=function(t){return t==null?(Jx.log.write(3,People.Social.format("SupValidator.ValidateEntity({0}): null entity!",t)),false):!Jx.isNonEmptyString(t.Type)||isNaN(t.Start)||isNaN(t.End)||t.User==null&&t.Link==null?(Jx.log.write(3,People.Social.format("SupValidator.ValidateEntity({0},{1},{2},{3},{4})",t.Type,t.Start,t.End,t.User!=null?n(t.User.Name):"",t.Link!=null?n(t.Link.Url):"")),false):true};People.RecentActivity.Providers.SupValidator.validateMessage=function(t){return t==null?(Jx.log.write(3,People.Social.format("SupValidator.ValidateMessage({0}): null message!",n(t))),false):Jx.isNonEmptyString(t.Text)?true:(Jx.log.write(3,People.Social.format("SupValidator.ValidateMessage({0})",n(t.Text))),false)};People.RecentActivity.Providers.SupValidator.validateLink=function(t){return t==null?(Jx.log.write(3,People.Social.format("SupValidator.ValidateLink({0}): null link!",t)),false):Jx.isNonEmptyString(t.Url)?true:(Jx.log.write(3,People.Social.format("SupValidator.ValidateLink({0},{1})",n(t.Url),n(t.SafeUrl))),false)};People.RecentActivity.Providers.SupValidator.validateReplyDetail=function(n){if(n==null)return Jx.log.write(3,People.Social.format("SupValidator.ValidateReplyDetail({0}): null reactions!",n)),false;if(n.ReplyReaction==null)return Jx.log.write(3,People.Social.format("SupValidator.ValidateReplyDetail({0}): null reactions.Reply!",n.ReplyReaction)),false;var t=n.ReplyReaction;return(isNaN(t.Count)||Jx.isNullOrUndefined(t.CanReact)||isNaN(t.TextLimit))&&Jx.log.write(3,People.Social.format("SupValidator.ValidateReplyDetail({0},{1},{2})",t.Count,t.CanReact,t.TextLimit)),true};People.RecentActivity.Providers.SupValidator.validateRetweetDetail=function(n){if(n==null)return Jx.log.write(3,People.Social.format("SupValidator.ValidateRetweetDetail({0}): null reactions!",n)),false;if(n.RetweetReaction==null)return Jx.log.write(3,People.Social.format("SupValidator.ValidateRetweetDetail({0}): null reactions.Retweet!",n.RetweetReaction)),false;var t=n.RetweetReaction;return(isNaN(t.Count)||Jx.isNullOrUndefined(t.CanReact))&&Jx.log.write(3,People.Social.format("SupValidator.ValidateRetweetDetail({0},{1})",t.Count,t.CanReact)),true};People.RecentActivity.Providers.SupValidator.validateFavoriteDetail=function(n){if(n==null)return Jx.log.write(3,People.Social.format("SupValidator.ValidateFavoriteDetail({0}): null reactions!",n)),false;if(n.FavoriteReaction==null)return Jx.log.write(3,People.Social.format("SupValidator.ValidateFavoriteDetail({0}): null reactions.Favorite!",n.FavoriteReaction)),false;var t=n.FavoriteReaction;return(Jx.isNullOrUndefined(t.HasReacted)||Jx.isNullOrUndefined(t.CanReact))&&Jx.log.write(3,People.Social.format("SupValidator.ValidateFavoriteDetail({0},{1})",t.HasReacted,t.CanReact)),true};People.RecentActivity.Providers.SupValidator.validateReply=function(t){return t==null?(Jx.log.write(3,People.Social.format("SupValidator.ValidateReply({0}): null reaction!",t)),false):!Jx.isNonEmptyString(t.ObjectId)||t.Author==null||!Jx.isNonEmptyString(t.Author.ObjectId)||t.Message==null||!Jx.isNonEmptyString(t.Message.Text)?(Jx.log.write(3,People.Social.format("SupValidator.ValidateReply({0},{1},{2})",t.ObjectId,t.Author!=null?n(t.Author.ObjectId)+";"+n(t.Author.ScreenName):"",t.Message!=null?n(t.Message.Text):"")),false):true};People.RecentActivity.Providers.SupValidator.validateRetweet=function(t){return t==null?(Jx.log.write(3,People.Social.format("SupValidator.ValidateRetweet({0}): null reaction!",t)),false):t.Author==null||!Jx.isNonEmptyString(t.Author.ObjectId)?(Jx.log.write(3,People.Social.format("SupValidator.ValidateRetweet({0})",t.Author!=null?n(t.Author.ObjectId)+";"+n(t.Author.ScreenName):"")),false):true}}();People.RecentActivity.Providers.Utilities=function(){};People.RecentActivity.Providers.Utilities.isArray=function(n){return Jx.isArray(n)?true:(n!=null&&Jx.log.write(4,"Utilities.IsArray: obj is not an array."),false)};People.RecentActivity.Providers.HttpResponseHeaders=function(n){this._headers=n;this._parsedHeaders={}};People.RecentActivity.Providers.HttpResponseHeaders.prototype._headers=null;People.RecentActivity.Providers.HttpResponseHeaders.prototype._parsedHeaders=null;People.RecentActivity.Providers.HttpResponseHeaders.prototype._initialized=false;Object.defineProperty(People.RecentActivity.Providers.HttpResponseHeaders.prototype,"headers",{get:function(){return this._headers}});People.RecentActivity.Providers.HttpResponseHeaders.prototype._ensureInitialized=function(){this._initialized||(this._parseHeaders(this._headers),this._initialized=true)};People.RecentActivity.Providers.HttpResponseHeaders.prototype._parseHeaders=function(n){var e,u,r,f,t,i,o;for(People.Social.clearKeys(this._parsedHeaders),e=n.split("\r\n"),u=0;u<e.length;u++)(r=e[u],f=r.indexOf(":"),f!==-1)&&(t=r.substring(0,f),i=r.substring(f+1,r.length),Jx.isNonEmptyString(t))&&(t=t.toUpperCase(),i=i.trim(),o=this._parsedHeaders[t],Jx.isNonEmptyString(o)?Jx.isNonEmptyString(i)&&(this._parsedHeaders[t]=o+","+i):this._parsedHeaders[t]=i)};People.RecentActivity.Providers.HttpResponseHeaders.prototype.item=function(n){return this._ensureInitialized(),this._parsedHeaders[n.toUpperCase()]};People.RecentActivity.Providers.AggregationState=function(){this._objectList=[];this._cachedObjectList=[];this._queuedObjects=[];this._scenarioId=n.unknown;this._scenarioErrorType=r.success;this._errorMap={}};People.RecentActivity.Providers.AggregationState.aggregateFeedEntryKey="f";People.RecentActivity.Providers.AggregationState.aggregateCachedFeedEntryKey="cf";People.RecentActivity.Providers.AggregationState.aggregateAlbumKey="a";People.RecentActivity.Providers.AggregationState.aggregateCachedAlbumKey="ca";People.RecentActivity.Providers.AggregationState.aggregateNotificationKey="n";People.RecentActivity.Providers.AggregationState.aggregateCachedNotificationKey="cn";People.RecentActivity.Providers.AggregationState.aggregateUnreadNotificationCountKey="u";People.RecentActivity.Providers.AggregationState.aggregateMarkedReadNotificationKey="rn";People.RecentActivity.Providers.AggregationState._aggregationStateMap={};People.RecentActivity.Providers.AggregationState.contains=function(n){return!Jx.isUndefined(People.RecentActivity.Providers.AggregationState._aggregationStateMap[n])};People.RecentActivity.Providers.AggregationState.getAggregationState=function(n){return!Jx.isUndefined(People.RecentActivity.Providers.AggregationState._aggregationStateMap[n])||(People.RecentActivity.Providers.AggregationState._aggregationStateMap[n]=new People.RecentActivity.Providers.AggregationState),People.RecentActivity.Providers.AggregationState._aggregationStateMap[n]};People.RecentActivity.Providers.AggregationState.removeAggregationState=function(n){Jx.isUndefined(People.RecentActivity.Providers.AggregationState._aggregationStateMap[n])||delete People.RecentActivity.Providers.AggregationState._aggregationStateMap[n]};People.RecentActivity.Providers.AggregationState.removeAggregationStatesByAggregatorId=function(n){var u,t,i,r;for(u=n.length,t=0,i=Object.keys(People.RecentActivity.Providers.AggregationState._aggregationStateMap);t<i.length;t++)r=i[t],r.substr(0,u)===n&&delete People.RecentActivity.Providers.AggregationState._aggregationStateMap[r]};People.RecentActivity.Providers.AggregationState.prototype._count=0;People.RecentActivity.Providers.AggregationState.prototype._totalRequests=0;People.RecentActivity.Providers.AggregationState.prototype._outstandingRequests=0;People.RecentActivity.Providers.AggregationState.prototype._failedRequests=0;People.RecentActivity.Providers.AggregationState.prototype._succeededRequests=0;People.RecentActivity.Providers.AggregationState.prototype._failedAuthentication=0;People.RecentActivity.Providers.AggregationState.prototype._recordScenario=false;People.RecentActivity.Providers.AggregationState.prototype._scenarioDuration=0;People.RecentActivity.Providers.AggregationState.prototype._scenarioRequestSize=0;People.RecentActivity.Providers.AggregationState.prototype._scenarioErrorCode=0;Object.defineProperty(People.RecentActivity.Providers.AggregationState.prototype,"count",{get:function(){return this._count}});Object.defineProperty(People.RecentActivity.Providers.AggregationState.prototype,"objectList",{get:function(){return this._objectList}});Object.defineProperty(People.RecentActivity.Providers.AggregationState.prototype,"cachedObjectList",{get:function(){return this._cachedObjectList}});Object.defineProperty(People.RecentActivity.Providers.AggregationState.prototype,"queuedObjects",{get:function(){return this._queuedObjects}});Object.defineProperty(People.RecentActivity.Providers.AggregationState.prototype,"outstandingRequests",{get:function(){return this._outstandingRequests}});Object.defineProperty(People.RecentActivity.Providers.AggregationState.prototype,"totalRequests",{get:function(){return this._totalRequests}});Object.defineProperty(People.RecentActivity.Providers.AggregationState.prototype,"aggregationResult",{get:function(){var n=new People.RecentActivity.Core.ResultInfo(People.RecentActivity.Core.ResultCode.failure);return this._failedRequests?(n.errorMap=this._errorMap,n.code=this._succeededRequests?this._failedAuthentication>0?People.RecentActivity.Core.ResultCode.partialFailureWithInvalidUserCredential:People.RecentActivity.Core.ResultCode.partialFailure:this._failedAuthentication>0?People.RecentActivity.Core.ResultCode.invalidUserCredential:People.RecentActivity.Core.ResultCode.failure):n.code=People.RecentActivity.Core.ResultCode.success,n}});Object.defineProperty(People.RecentActivity.Providers.AggregationState.prototype,"recordScenario",{get:function(){return this._recordScenario}});Object.defineProperty(People.RecentActivity.Providers.AggregationState.prototype,"scenarioId",{get:function(){return this._scenarioId}});Object.defineProperty(People.RecentActivity.Providers.AggregationState.prototype,"scenarioDuration",{get:function(){return this._scenarioDuration}});Object.defineProperty(People.RecentActivity.Providers.AggregationState.prototype,"scenarioRequestSize",{get:function(){return this._scenarioRequestSize}});Object.defineProperty(People.RecentActivity.Providers.AggregationState.prototype,"scenarioErrorCode",{get:function(){return this._scenarioErrorCode}});Object.defineProperty(People.RecentActivity.Providers.AggregationState.prototype,"scenarioErrorType",{get:function(){return this._scenarioErrorType}});People.RecentActivity.Providers.AggregationState.prototype.reset=function(t){this._totalRequests=this._outstandingRequests=t;this._failedRequests=0;this._succeededRequests=0;this._failedAuthentication=0;this._recordScenario=false;this._scenarioId=n.unknown;this._scenarioDuration=0;this._scenarioRequestSize=0;this._scenarioErrorCode=0;this._scenarioErrorType=r.success;this._objectList.length=0;this._cachedObjectList.length=0;People.Social.clearKeys(this._errorMap);this._errorMap={};this._count=0};People.RecentActivity.Providers.AggregationState.prototype.updateState=function(n,t){this.updateStateWithCachedObjects(n,t,null)};People.RecentActivity.Providers.AggregationState.prototype.updateStateWithCachedObjects=function(n,t,i){this._updateStateInternal(n,t,i,0)};People.RecentActivity.Providers.AggregationState.prototype.updateStateWithCount=function(n,t){this._updateStateInternal(n,null,null,t)};People.RecentActivity.Providers.AggregationState.prototype.updateScenarioInstrumentation=function(t,i){this._recordScenario=true;this._scenarioId=t;this._scenarioDuration+=i.scenarioDuration;this._scenarioRequestSize+=i.scenarioSizeInBytes;this._scenarioErrorCode||!i.errorCode||(this._scenarioErrorCode=i.errorCode,this._scenarioErrorType=i.errorType)};People.RecentActivity.Providers.AggregationState.prototype._updateStateInternal=function(n,t,i,r){this._outstandingRequests&&(this._outstandingRequests--,t!=null&&this._objectList.push.apply(this._objectList,t),i!=null&&this._cachedObjectList.push.apply(this._cachedObjectList,i),this._count+=r,n.code===People.RecentActivity.Core.ResultCode.success?this._succeededRequests++:(this._failedRequests++,this._populateErrorMap(n),(n.code===People.RecentActivity.Core.ResultCode.invalidUserCredential||n.code===People.RecentActivity.Core.ResultCode.invalidPermissions)&&this._failedAuthentication++))};People.RecentActivity.Providers.AggregationState.prototype._populateErrorMap=function(n){var t,i,r;if(n.errorMap!=null)for(t=0,i=Object.keys(n.errorMap);t<i.length;t++)r=i[t],this._errorMap[r]=n.errorMap[r]};People.RecentActivity.Providers.ProviderBase=function(n){this._events=n};People.RecentActivity.Providers.ProviderBase.prototype.feedInitialized=false;People.RecentActivity.Providers.ProviderBase.prototype.feedInitializing=false;People.RecentActivity.Providers.ProviderBase.prototype.albumInitialized=false;People.RecentActivity.Providers.ProviderBase.prototype.notificationsInitialized=false;People.RecentActivity.Providers.ProviderBase.prototype._contactId=null;People.RecentActivity.Providers.ProviderBase.prototype._events=null;People.RecentActivity.Providers.ProviderBase.prototype._feedCache=null;People.RecentActivity.Providers.ProviderBase.prototype._albumCache=null;People.RecentActivity.Providers.ProviderBase.prototype._notificationCache=null;Object.defineProperty(People.RecentActivity.Providers.ProviderBase.prototype,"feedCache",{get:function(){return this._feedCache==null&&(this._feedCache=People.RecentActivity.Providers.FeedCache.getInstance(People.RecentActivity.Platform.Platform.instance.getUserPersonCid())),this._feedCache}});Object.defineProperty(People.RecentActivity.Providers.ProviderBase.prototype,"albumCache",{get:function(){return this._albumCache==null&&(this._albumCache=People.RecentActivity.Providers.AlbumCache.getInstance(People.RecentActivity.Platform.Platform.instance.getUserPersonCid())),this._albumCache}});Object.defineProperty(People.RecentActivity.Providers.ProviderBase.prototype,"notificationCache",{get:function(){return this._notificationCache==null&&(this._notificationCache=People.RecentActivity.Providers.NotificationCache.getInstance(People.RecentActivity.Platform.Platform.instance.getUserPersonCid())),this._notificationCache}});Object.defineProperty(People.RecentActivity.Providers.ProviderBase.prototype,"events",{get:function(){return this._events},set:function(n){this._events=n}});Object.defineProperty(People.RecentActivity.Providers.ProviderBase.prototype,"contactId",{get:function(){return this._contactId},set:function(n){this._contactId=n}});People.RecentActivity.Providers.ProviderBase.prototype.hasUpdate=function(n){return n.objectsAdded.length>0||n.objectsUpdated.length>0||n.objectsRemoved.length>0};People.RecentActivity.Providers.FeedProvider=function(n,t,i,r,u,f){People.RecentActivity.Providers.ProviderBase.call(this,r);u;this._aggregatorId$1=f;this._requestMap$1={};this._aggregated$1=u;this.networkId=i.id;var e=People.RecentActivity.Platform.Configuration.instance;this._feedEntryBatchSize$1=e.feedEntriesBatchSize;this._feedEntryMinBatchSize=e.feedEntriesMinBatchSize;this._feedEntriesMaxCount=e.feedEntriesMaxCount;switch(t){case 0:this.contactId=People.RecentActivity.Platform.Platform.instance.getContactId(n,i.id);break;case 1:this.contactId=new People.RecentActivity.Platform.ContactId(n,i.id);break;default:throw new Error("Unknown identity type!")}People.RecentActivity.Platform.Platform.instance.addListener("connectednetworkchanged",this._onConnectedNetworkChanged$1,this)};Jx.inherit(People.RecentActivity.Providers.FeedProvider,People.RecentActivity.Providers.ProviderBase);People.RecentActivity.Providers.FeedProvider._fakeIdSegment$1="fake";People.RecentActivity.Providers.FeedProvider.prototype.networkId=null;People.RecentActivity.Providers.FeedProvider.prototype._aggregatorId$1=null;People.RecentActivity.Providers.FeedProvider.prototype._requestMap$1=null;People.RecentActivity.Providers.FeedProvider.prototype._feedEntryBatchSize$1=0;People.RecentActivity.Providers.FeedProvider.prototype._feedEntryMinBatchSize=0;People.RecentActivity.Providers.FeedProvider.prototype._feedEntriesMaxCount=0;People.RecentActivity.Providers.FeedProvider.prototype._serializer$1=null;People.RecentActivity.Providers.FeedProvider.prototype._requestFactory$1=null;People.RecentActivity.Providers.FeedProvider.prototype._feedObjectCache$1=null;People.RecentActivity.Providers.FeedProvider.prototype._seeMoreTimeOffset$1=0;People.RecentActivity.Providers.FeedProvider.prototype._aggregated$1=false;People.RecentActivity.Providers.FeedProvider.prototype._totalEntryCount$1=0;People.RecentActivity.Providers.FeedProvider.prototype._hasMoreEntries$1=true;People.RecentActivity.Providers.FeedProvider.prototype._isRefreshingFeed$1=false;People.RecentActivity.Providers.FeedProvider.prototype._isGettingMoreEntries$1=false;Object.defineProperty(People.RecentActivity.Providers.FeedProvider.prototype,"requestFactory",{get:function(){return this._requestFactory$1},set:function(n){this._requestFactory$1=n}});Object.defineProperty(People.RecentActivity.Providers.FeedProvider.prototype,"feedObjectCache",{get:function(){return this._feedObjectCache$1==null&&(this._feedObjectCache$1=People.RecentActivity.Providers.FeedObjectCache.getInstance(People.RecentActivity.Platform.Platform.instance.getUserPersonCid())),this._feedObjectCache$1}});Object.defineProperty(People.RecentActivity.Providers.FeedProvider.prototype,"serializer",{get:function(){return this._serializer$1},set:function(n){this._serializer$1=n}});People.RecentActivity.Providers.FeedProvider.prototype.dispose=function(){var n,t;People.RecentActivity.Platform.Platform.instance.removeListenerSafe("connectednetworkchanged",this._onConnectedNetworkChanged$1,this);for(n in this._requestMap$1)t={key:n,value:this._requestMap$1[n]},t.value.cancel();People.Social.clearKeys(this._requestMap$1);this._serializer$1.dispose()};People.RecentActivity.Providers.FeedProvider.prototype.getCachedFeedEntries=function(n,t){var r,i;People.RecentActivity.Core.EtwHelper.writeFeedEvent(People.RecentActivity.Core.EtwEventName.providerGetCachedFeedStart,this.networkId,this.contactId.id);r=People.RecentActivity.Core.EtwEventName.providerGetMoreFeedEntriesStart;Jx.isUndefined(this._requestMap$1[r])||(this._requestMap$1[r].cancel(),this._isGettingMoreEntries$1=false);i=this._getCachedFeedObjects$1(People.RecentActivity.Core.FeedObjectInfoType.entry);People.RecentActivity.Core.EtwHelper.writeFeedEvent(People.RecentActivity.Core.EtwEventName.providerGetCachedFeedEnd,this.networkId,this.contactId.id);n&&i.length>this._feedEntryBatchSize$1&&(i=i.slice(i.length-this._feedEntryBatchSize$1,i.length-this._feedEntryBatchSize$1+this._feedEntryBatchSize$1));this.feedInitializing||(this._seeMoreTimeOffset$1=i.length?i[0].timestamp:0,this._totalEntryCount$1=i.length,this._hasMoreEntries$1=this._totalEntryCount$1<this._feedEntriesMaxCount,Jx.log.write(4,People.Social.format("FeedProvider.GetCachedFeedEntries(totalEntryCount:{0}):{1}",this._totalEntryCount$1,this.networkId)),this.feedInitialized=true);this.events.onGetCachedFeedEntriesCompleted(new People.RecentActivity.Core.ResultInfo(People.RecentActivity.Core.ResultCode.success),i,t)};People.RecentActivity.Providers.FeedProvider.prototype.refreshFeedEntries=function(n){var t,i;if(this._isRefreshingFeed$1||this._isGettingMoreEntries$1){Jx.log.write(3,People.Social.format("FeedProvider.RefreshFeedEntries({0},{1}):{2}",this._isRefreshingFeed$1,this._isGettingMoreEntries$1,this.networkId));this.events.onRefreshFeedEntriesCompleted(new People.RecentActivity.Core.ResultInfo(People.RecentActivity.Core.ResultCode.success),[],[],[],false,n);return}if(this.feedInitialized||(People.RecentActivity.Core.EtwHelper.writeFeedEvent(People.RecentActivity.Core.EtwEventName.providerGetFeedStart,this.networkId,this.contactId.id),this.feedInitializing=true,this._aggregated$1||this.getCachedFeedEntries(true,n)),!People.RecentActivity.Platform.Configuration.instance.isOnline){this.feedInitializing=false;this.feedInitialized=true;this.events.onRefreshFeedEntriesCompleted(new People.RecentActivity.Core.ResultInfo(People.RecentActivity.Core.ResultCode.userOffline),[],[],[],false,n);return}People.RecentActivity.Core.EtwHelper.writeFeedEvent(People.RecentActivity.Core.EtwEventName.providerRefreshFeedStart,this.networkId,this.contactId.id);this._isRefreshingFeed$1=true;t=this._createRequestContext$1(1,null,null,null,n);t.isAggregated=this._aggregated$1;i=this.requestFactory.createGetFeedRequest(t);this._setRequestMap$1(People.RecentActivity.Core.EtwEventName.providerRefreshFeedStart,i);i.execute(this._onFeedEntriesRefreshed$1.bind(this))};People.RecentActivity.Providers.FeedProvider.prototype.getMoreFeedEntries=function(n){var t,i,r;if(!this.feedInitialized||this._isRefreshingFeed$1||this._isGettingMoreEntries$1){Jx.log.write(3,People.Social.format("FeedProvider.GetMoreFeedEntries({0},{1},{2}):{3}",this.feedInitialized,this._isRefreshingFeed$1,this._isGettingMoreEntries$1,this.networkId));this.events.onGetMoreEntriesCompleted(new People.RecentActivity.Core.ResultInfo(People.RecentActivity.Core.ResultCode.success),[],false,n);return}if(!People.RecentActivity.Platform.Configuration.instance.isOnline){this.events.onGetMoreEntriesCompleted(new People.RecentActivity.Core.ResultInfo(People.RecentActivity.Core.ResultCode.userOffline),[],false,n);return}if(t=this._getAggregationKey$1("f"),!this._hasMoreEntries$1){this._aggregated$1&&People.RecentActivity.Providers.AggregationState.contains(t)&&People.RecentActivity.Providers.AggregationState.getAggregationState(t).updateState(new People.RecentActivity.Core.ResultInfo(People.RecentActivity.Core.ResultCode.success),[]);Jx.log.write(4,"FeedProvider.GetMoreFeedEntries(hasMoreEntries:false):"+this.networkId);this.events.onGetMoreEntriesCompleted(new People.RecentActivity.Core.ResultInfo(People.RecentActivity.Core.ResultCode.success),[],false,n);return}People.RecentActivity.Core.EtwHelper.writeFeedEvent(People.RecentActivity.Core.EtwEventName.providerGetMoreFeedEntriesStart,this.networkId,this.contactId.id);this._isGettingMoreEntries$1=true;i=this._createRequestContext$1(1,null,null,null,n);i.feedTimeOffset=this._seeMoreTimeOffset$1;this._aggregated$1&&People.RecentActivity.Providers.AggregationState.contains(t)&&(i.isAggregated=true);r=this.requestFactory.createGetFeedRequest(i);this._setRequestMap$1(People.RecentActivity.Core.EtwEventName.providerGetMoreFeedEntriesStart,r);r.execute(this._onMoreFeedEntriesRetrieved$1.bind(this))};People.RecentActivity.Providers.FeedProvider.prototype.refreshComments=function(n,t){if(!People.RecentActivity.Platform.Configuration.instance.isOnline){this.events.onRefreshCommentsCompleted(new People.RecentActivity.Core.ResultInfo(People.RecentActivity.Core.ResultCode.userOffline),n,[],[],t);return}if(this._isFakeObject$1(n)){this.events.onRefreshCommentsCompleted(new People.RecentActivity.Core.ResultInfo(People.RecentActivity.Core.ResultCode.success),n,[],[],t);return}People.RecentActivity.Core.EtwHelper.writeFeedObjectEvent(People.RecentActivity.Core.EtwEventName.providerRefreshCommentsStart,n);var r=this._createRequestContext$1(2,n,null,null,t),i=this.requestFactory.createGetCommentsRequest(r);this._setRequestMap$1(People.RecentActivity.Core.EtwEventName.providerRefreshCommentsStart+n.id,i);i.execute(this._onCommentsRefreshed$1.bind(this))};People.RecentActivity.Providers.FeedProvider.prototype.refreshReactions=function(n,t){var i,r,e,u,f;if(!People.RecentActivity.Platform.Configuration.instance.isOnline){this.events.onRefreshReactionsCompleted(new People.RecentActivity.Core.ResultInfo(People.RecentActivity.Core.ResultCode.userOffline),n,[],[],t);return}if(this._isFakeObject$1(n)){this.events.onRefreshReactionsCompleted(new People.RecentActivity.Core.ResultInfo(People.RecentActivity.Core.ResultCode.success),n,[],[],t);return}for(People.RecentActivity.Core.EtwHelper.writeFeedObjectEvent(People.RecentActivity.Core.EtwEventName.providerRefreshReactionsStart,n),i=[],i.push.apply(i,People.RecentActivity.Platform.Configuration.instance.getNetworkReactionInfos(n.sourceId)),People.RecentActivity.Providers.AggregationState.getAggregationState(this._getAggregationKey$1(n.id)).reset(i.length),r=0,e=i.length;r<e;r++)u=this._createRequestContext$1(3,n,null,null,t),u.reactionType=i[r].type,f=this.requestFactory.createGetReactionsRequest(u),this._setRequestMap$1(People.RecentActivity.Core.EtwEventName.providerRefreshReactionsStart+n.id+u.reactionType,f),f.execute(this._onReactionsRefreshed$1.bind(this))};People.RecentActivity.Providers.FeedProvider.prototype.addComment=function(n,t,i){if(!People.RecentActivity.Platform.Configuration.instance.isOnline){this.events.onCommentAdded(new People.RecentActivity.Core.ResultInfo(People.RecentActivity.Core.ResultCode.userOffline),n,null,i);return}People.RecentActivity.Core.EtwHelper.writeCommentEvent(People.RecentActivity.Core.EtwEventName.providerAddCommentStart,n,t);var u=this._createRequestContext$1(4,n,t,null,i),r=this.requestFactory.createAddCommentRequest(u);this._setRequestMap$1(People.RecentActivity.Core.EtwEventName.providerAddCommentStart,r);r.execute(this._onCommentAdded$1.bind(this))};People.RecentActivity.Providers.FeedProvider.prototype.addReaction=function(n,t,i){if(!People.RecentActivity.Platform.Configuration.instance.isOnline){this.events.onReactionAdded(new People.RecentActivity.Core.ResultInfo(People.RecentActivity.Core.ResultCode.userOffline),n,t,i);return}People.RecentActivity.Core.EtwHelper.writeReactionEvent(People.RecentActivity.Core.EtwEventName.providerAddReactionStart,n,t);var u=this._createRequestContext$1(5,n,null,t,i),r=this.requestFactory.createAddReactionRequest(u);this._setRequestMap$1(People.RecentActivity.Core.EtwEventName.providerAddReactionStart,r);r.execute(this._onReactionAdded$1.bind(this))};People.RecentActivity.Providers.FeedProvider.prototype.removeReaction=function(n,t,i){if(!People.RecentActivity.Platform.Configuration.instance.isOnline){this.events.onReactionRemoved(new People.RecentActivity.Core.ResultInfo(People.RecentActivity.Core.ResultCode.userOffline),n,t,i);return}People.RecentActivity.Core.EtwHelper.writeReactionEvent(People.RecentActivity.Core.EtwEventName.providerRemoveReactionStart,n,t);var u=this._createRequestContext$1(0,n,null,t,i),r=this.requestFactory.createRemoveReactionRequest(u);if(r==null){this.events.onReactionRemoved(new People.RecentActivity.Core.ResultInfo(People.RecentActivity.Core.ResultCode.failure),n,t,i);return}this._setRequestMap$1(People.RecentActivity.Core.EtwEventName.providerRemoveReactionStart,r);r.execute(this._onReactionRemoved$1.bind(this))};People.RecentActivity.Providers.FeedProvider.prototype.refreshAlbums=function(n){if(this.albumInitialized||(People.RecentActivity.Core.EtwHelper.writeFeedEvent(People.RecentActivity.Core.EtwEventName.providerGetAlbumsStart,this.networkId,this.contactId.id),this._aggregated$1||this.getCachedAlbums(n)),!People.RecentActivity.Platform.Configuration.instance.isOnline){this.events.onRefreshAlbumsCompleted(new People.RecentActivity.Core.ResultInfo(People.RecentActivity.Core.ResultCode.userOffline),[],[],[],n);return}People.RecentActivity.Core.EtwHelper.writeFeedEvent(People.RecentActivity.Core.EtwEventName.providerRefreshAlbumsStart,this.networkId,this.contactId.id);var i=this._createRequestContext$1(7,null,null,null,n),t=this.requestFactory.createGetAlbumsRequest(i);this._setRequestMap$1(People.RecentActivity.Core.EtwEventName.providerRefreshAlbumsStart,t);t.execute(this._onAlbumsRefreshed$1.bind(this))};People.RecentActivity.Providers.FeedProvider.prototype.getCachedAlbums=function(n){People.RecentActivity.Core.EtwHelper.writeFeedEvent(People.RecentActivity.Core.EtwEventName.providerGetCachedAlbumsStart,this.networkId,this.contactId.id);var t=this._getCachedFeedObjects$1(People.RecentActivity.Core.FeedObjectInfoType.photoAlbum);People.RecentActivity.Core.EtwHelper.writeFeedEvent(People.RecentActivity.Core.EtwEventName.providerGetCachedAlbumsEnd,this.networkId,this.contactId.id);this.events.onGetCachedAlbumsCompleted(new People.RecentActivity.Core.ResultInfo(People.RecentActivity.Core.ResultCode.success),t,n)};People.RecentActivity.Providers.FeedProvider.prototype.refreshAlbum=function(n,t){if(!People.RecentActivity.Platform.Configuration.instance.isOnline){this.events.onRefreshAlbumCompleted(new People.RecentActivity.Core.ResultInfo(People.RecentActivity.Core.ResultCode.userOffline),n,[],[],[],t);return}People.RecentActivity.Core.EtwHelper.writeFeedObjectEvent(People.RecentActivity.Core.EtwEventName.providerRefreshAlbumStart,n);var r=this._createRequestContext$1(8,n,null,null,t),i=this.requestFactory.createRefreshAlbumRequest(r);this._setRequestMap$1(People.RecentActivity.Core.EtwEventName.providerRefreshAlbumStart+n.id,i);i.execute(this._onAlbumRefreshed$1.bind(this))};People.RecentActivity.Providers.FeedProvider.prototype.refreshPhoto=function(n,t){if(!People.RecentActivity.Platform.Configuration.instance.isOnline){this.events.onRefreshPhotoCompleted(new People.RecentActivity.Core.ResultInfo(People.RecentActivity.Core.ResultCode.userOffline),n,[],[],t);return}People.RecentActivity.Core.EtwHelper.writeFeedObjectEvent(People.RecentActivity.Core.EtwEventName.providerRefreshPhotoStart,n);var r=this._createRequestContext$1(9,n,null,null,t),i=this.requestFactory.createRefreshPhotoRequest(r);this._setRequestMap$1(People.RecentActivity.Core.EtwEventName.providerRefreshPhotoStart+n.id,i);i.execute(this._onPhotoRefreshed$1.bind(this))};People.RecentActivity.Providers.FeedProvider.prototype.getFeedObject=function(n,t){if(!People.RecentActivity.Platform.Configuration.instance.isOnline){this.events.onGetFeedObjectCompleted(new People.RecentActivity.Core.ResultInfo(People.RecentActivity.Core.ResultCode.userOffline),n,t);return}People.RecentActivity.Core.EtwHelper.writeFeedObjectEvent(People.RecentActivity.Core.EtwEventName.providerGetFeedObjectStart,n);var r=this._createRequestContext$1(0,n,null,null,t),i=this.requestFactory.createGetFeedObjectRequest(r);this._setRequestMap$1(People.RecentActivity.Core.EtwEventName.providerGetFeedObjectStart,i);i.execute(this._onFeedObjectReceived$1.bind(this))};People.RecentActivity.Providers.FeedProvider.prototype.getCachedFeedObject=function(n,t){var f,i,r,e,u,o,l,s;if(People.RecentActivity.Core.EtwHelper.writeFeedObjectEvent(People.RecentActivity.Core.EtwEventName.providerGetCachedFeedObjectStart,n),f=this._findObjectById$1(n.id,n.sourceId,n.type),!Jx.isNullOrUndefined(f)&&f.type===People.RecentActivity.Core.FeedObjectInfoType.entry){if(i=f.data,i.type===People.RecentActivity.Core.FeedEntryInfoType.photo){var h=i.data.photo,r=i.data.album,c=this._findObjectById$1(h.data.id,h.sourceId,h.type);c!==null&&(i.data.photo=c,r.data.photos=People.RecentActivity.Providers.SocialHelper.mergePhotos([c],r.data.photos,false))}if((i.type===People.RecentActivity.Core.FeedEntryInfoType.photo||i.type===People.RecentActivity.Core.FeedEntryInfoType.photoAlbum)&&(r=i.data.album,e=this._findObjectById$1(r.data.id,r.sourceId,r.type),e!==null)){for(u=People.RecentActivity.Providers.SocialHelper.mergePhotos(e.data.photos,r.data.photos,true),e.data.photos=u,e.data.totalCount=u.length,o=0,l=u.length;o<l;o++)s=this.feedObjectCache.getFeedObject(u[o].data.id,i.type),Jx.isNullOrUndefined(s)||(s.data.index=u[o].data.index,u[o]=s);i.data.album=e}}if(People.RecentActivity.Core.EtwHelper.writeFeedObjectEvent(People.RecentActivity.Core.EtwEventName.providerGetCachedFeedObjectEnd,n),f!=null)this.events.onGetCachedFeedObjectCompleted(new People.RecentActivity.Core.ResultInfo(People.RecentActivity.Core.ResultCode.success),f,t);else this.events.onGetCachedFeedObjectCompleted(new People.RecentActivity.Core.ResultInfo(People.RecentActivity.Core.ResultCode.failure),n,t)};People.RecentActivity.Providers.FeedProvider.prototype.addFeedObject=function(n,t){if(!People.RecentActivity.Platform.Configuration.instance.isOnline){this.events.onFeedObjectAdded(new People.RecentActivity.Core.ResultInfo(People.RecentActivity.Core.ResultCode.userOffline),n,t);return}People.RecentActivity.Core.EtwHelper.writeFeedObjectEvent(People.RecentActivity.Core.EtwEventName.providerAddFeedObjectStart,n);var r=this._createRequestContext$1(13,n,null,null,t),i=this.requestFactory.createAddFeedObjectRequest(r);this._setRequestMap$1(People.RecentActivity.Core.EtwEventName.providerAddFeedObjectStart,i);i.execute(this._onFeedObjectAdded$1.bind(this))};People.RecentActivity.Providers.FeedProvider.prototype.refreshNotifications=function(n){var t,i;if(!People.RecentActivity.Platform.Configuration.instance.isOnline){this.events.onRefreshNotificationsCompleted(new People.RecentActivity.Core.ResultInfo(People.RecentActivity.Core.ResultCode.userOffline),[],[],[],n);return}this.notificationsInitialized||this._aggregated$1||this.getCachedNotifications(n);People.RecentActivity.Core.EtwHelper.writeFeedEvent(People.RecentActivity.Core.EtwEventName.providerRefreshNotificationsStart,this.networkId,this.contactId.id);t=this._createRequestContext$1(6,null,null,null,n);t.isAggregated=this._aggregated$1;i=this.requestFactory.createRefreshNotificationsRequest(t);this._setRequestMap$1(People.RecentActivity.Core.EtwEventName.providerRefreshNotificationsStart,i);i.execute(this._onRefreshNotificationsCompleted$1.bind(this))};People.RecentActivity.Providers.FeedProvider.prototype.getCachedNotifications=function(n){if(!People.RecentActivity.Platform.Configuration.instance.isOnline){this.events.onGetCachedNotificationsCompleted(new People.RecentActivity.Core.ResultInfo(People.RecentActivity.Core.ResultCode.userOffline),[],n);return}People.RecentActivity.Core.EtwHelper.writeFeedEvent(People.RecentActivity.Core.EtwEventName.providerGetCachedNotificationsStart,this.networkId,this.contactId.id);var t=this._getCachedNotificationsInternal$1();People.RecentActivity.Core.EtwHelper.writeFeedEvent(People.RecentActivity.Core.EtwEventName.providerGetCachedNotificationsEnd,this.networkId,this.contactId.id);this.notificationsInitialized||(this.notificationsInitialized=true);this.events.onGetCachedNotificationsCompleted(new People.RecentActivity.Core.ResultInfo(People.RecentActivity.Core.ResultCode.success),t,n)};People.RecentActivity.Providers.FeedProvider.prototype.markNotificationsRead=function(n,t){var i,r;if(!People.RecentActivity.Platform.Configuration.instance.isOnline){this.events.onMarkNotificationsReadCompleted(new People.RecentActivity.Core.ResultInfo(People.RecentActivity.Core.ResultCode.userOffline),n,t);return}People.RecentActivity.Core.EtwHelper.writeFeedEvent(People.RecentActivity.Core.EtwEventName.providerMarkNotificationsReadStart,this.networkId,this.contactId.id);i=this._createRequestContext$1(0,null,null,null,t);i.notifications=n;i.isAggregated=this._aggregated$1;r=this.requestFactory.createMarkNotificationsReadRequest(i);this._setRequestMap$1(People.RecentActivity.Core.EtwEventName.providerMarkNotificationsReadStart,r);r.execute(this._onMarkNotificationsReadCompleted$1.bind(this))};People.RecentActivity.Providers.FeedProvider.prototype.getUnreadNotificationsCount=function(n){var t,i;if(!People.RecentActivity.Platform.Configuration.instance.isOnline){this.events.onGetUnreadNotificationsCountCompleted(new People.RecentActivity.Core.ResultInfo(People.RecentActivity.Core.ResultCode.userOffline),0,n);return}People.RecentActivity.Core.EtwHelper.writeFeedEvent(People.RecentActivity.Core.EtwEventName.providerGetUnreadNotificationsCountStart,this.networkId,this.contactId.id);t=this._createRequestContext$1(10,null,null,null,n);t.isAggregated=this._aggregated$1;i=this.requestFactory.createGetUnreadNotificationsCountRequest(t);this._setRequestMap$1(People.RecentActivity.Core.EtwEventName.providerGetUnreadNotificationsCountStart,i);i.execute(this._onGetUnreadNotificationsCountCompleted$1.bind(this))};People.RecentActivity.Providers.FeedProvider.prototype.getNotificationsFromResponse=function(n){return n.data};People.RecentActivity.Providers.FeedProvider.prototype.getUnreadNotificationsCountFromResponse=function(n){return n.data};People.RecentActivity.Providers.FeedProvider.prototype._onFeedEntriesRefreshed$1=function(n){var r,t,i;People.RecentActivity.Core.EtwHelper.writeFeedEvent(People.RecentActivity.Core.EtwEventName.providerRefreshFeedEnd,this.networkId,this.contactId.id);delete this._requestMap$1[People.RecentActivity.Core.EtwEventName.providerRefreshFeedStart];r=n.requestContext;t=n.data||[];this.feedInitialized||(this.feedInitialized=true,this.feedInitializing=false,People.RecentActivity.Core.EtwHelper.writeFeedEvent(People.RecentActivity.Core.EtwEventName.providerGetFeedEnd,this.networkId,this.contactId.id));i=this._refreshCachedFeedObjects$1(n,t,People.RecentActivity.Core.FeedObjectInfoType.entry);n.resultInfo.code===People.RecentActivity.Core.ResultCode.success&&(!this._seeMoreTimeOffset$1||this.hasUpdate(i))&&(this._seeMoreTimeOffset$1=t.length?t[0].timestamp:0,this._totalEntryCount$1=t.length,this._hasMoreEntries$1=r.numEntriesReceived>=this._feedEntryMinBatchSize,Jx.log.write(4,People.Social.format("FeedProvider.OnFeedEntriesRefreshed(totalEntryCount:{0}):{1}",this._totalEntryCount$1,this.networkId)));this.events.onRefreshFeedEntriesCompleted(n.resultInfo,i.objectsAdded,i.objectsUpdated,i.objectsRemoved,this._hasMoreEntries$1,r.userState);this._isRefreshingFeed$1=false};People.RecentActivity.Providers.FeedProvider.prototype._onMoreFeedEntriesRetrieved$1=function(n){var r;People.RecentActivity.Core.EtwHelper.writeFeedEvent(People.RecentActivity.Core.EtwEventName.providerGetMoreFeedEntriesEnd,this.networkId,this.contactId.id);delete this._requestMap$1[People.RecentActivity.Core.EtwEventName.providerGetMoreFeedEntriesStart];var u=n.requestContext,t=n.data||[],f=this._getAggregationKey$1("f"),i=null;this._aggregated$1&&People.RecentActivity.Providers.AggregationState.contains(f)&&(i=People.RecentActivity.Providers.AggregationState.getAggregationState(f),r=n.requestContext,i.updateScenarioInstrumentation(r.scenarioId,r),i.updateState(n.resultInfo,t));n.success&&(t.length>0&&(i==null&&this.feedCache.addMoreFeedEntries(this.contactId,t),this._seeMoreTimeOffset$1=t[0].timestamp,this._totalEntryCount$1+=t.length,Jx.log.write(4,People.Social.format("FeedProvider.OnMoreFeedEntriesRetrieved(totalEntryCount:{0}):{1}",this._totalEntryCount$1,this.networkId))),(this._totalEntryCount$1>=this._feedEntriesMaxCount||u.numEntriesReceived<this._feedEntryMinBatchSize)&&(this._hasMoreEntries$1=false,Jx.log.write(4,"FeedProvider.OnMoreFeedEntriesRetrieved(hasMoreEntries:false):"+this.networkId)));this.events.onGetMoreEntriesCompleted(n.resultInfo,t,this._hasMoreEntries$1,u.userState);this._isGettingMoreEntries$1=false};People.RecentActivity.Providers.FeedProvider.prototype._onAlbumsRefreshed$1=function(n){var i,t;People.RecentActivity.Core.EtwHelper.writeFeedEvent(People.RecentActivity.Core.EtwEventName.providerRefreshAlbumsEnd,this.networkId,this.contactId.id);delete this._requestMap$1[People.RecentActivity.Core.EtwEventName.providerRefreshAlbumsStart];i=n.data;this.albumInitialized||(this.albumInitialized=true,People.RecentActivity.Core.EtwHelper.writeFeedEvent(People.RecentActivity.Core.EtwEventName.providerGetAlbumsEnd,this.networkId,this.contactId.id));t=this._refreshCachedFeedObjects$1(n,i,People.RecentActivity.Core.FeedObjectInfoType.photoAlbum);this.events.onRefreshAlbumsCompleted(n.resultInfo,t.objectsAdded,t.objectsUpdated,t.objectsRemoved,n.requestContext.userState)};People.RecentActivity.Providers.FeedProvider.prototype._onAlbumRefreshed$1=function(n){var r,t,u,i;r=n.requestContext;t=r.feedObject;People.RecentActivity.Core.EtwHelper.writeFeedObjectEvent(People.RecentActivity.Core.EtwEventName.providerRefreshAlbumEnd,t);delete this._requestMap$1[People.RecentActivity.Core.EtwEventName.providerRefreshAlbumStart+t.id];u=n.data;i=n.resultInfo.code===People.RecentActivity.Core.ResultCode.success?this.albumCache.refreshAlbum(this.contactId,t,u):People.RecentActivity.Providers.create_feedObjectRefreshInfo();this.events.onRefreshAlbumCompleted(n.resultInfo,t,i.objectsAdded,i.objectsUpdated,i.objectsRemoved,r.userState)};People.RecentActivity.Providers.FeedProvider.prototype._onPhotoRefreshed$1=function(n){var i,t,u,r;i=n.requestContext;t=i.feedObject;People.RecentActivity.Core.EtwHelper.writeFeedObjectEvent(People.RecentActivity.Core.EtwEventName.providerRefreshPhotoEnd,t);delete this._requestMap$1[People.RecentActivity.Core.EtwEventName.providerRefreshPhotoStart+t.id];u=n.data;r=n.resultInfo.code===People.RecentActivity.Core.ResultCode.success?this.albumCache.refreshPhoto(this.contactId,t,u):People.RecentActivity.Providers.create_photoTagRefreshInfo();this.events.onRefreshPhotoCompleted(n.resultInfo,t,r.photoTagsAdded,r.photoTagsRemoved,i.userState)};People.RecentActivity.Providers.FeedProvider.prototype._onCommentsRefreshed$1=function(n){var i,t,u,r;i=n.requestContext;t=i.feedObject;People.RecentActivity.Core.EtwHelper.writeFeedObjectEvent(People.RecentActivity.Core.EtwEventName.providerRefreshCommentsEnd,t);delete this._requestMap$1[People.RecentActivity.Core.EtwEventName.providerRefreshCommentsStart+t.id];u=n.data;r=n.resultInfo.code===People.RecentActivity.Core.ResultCode.success?this._getFeedObjectCache$1(t.type).refreshComments(this.contactId,t,u):People.RecentActivity.Providers.create_commentRefreshInfo();this.events.onRefreshCommentsCompleted(n.resultInfo,t,r.commentsAdded,r.commentsRemoved,i.userState)};People.RecentActivity.Providers.FeedProvider.prototype._onReactionsRefreshed$1=function(n){var u,f;var r=n.requestContext,t=r.feedObject,o=n.data,e=this._getAggregationKey$1(t.id),i=People.RecentActivity.Providers.AggregationState.getAggregationState(e);if(i.updateState(n.resultInfo,o),!i.outstandingRequests){People.RecentActivity.Core.EtwHelper.writeFeedObjectEvent(People.RecentActivity.Core.EtwEventName.providerRefreshReactionsEnd,t);delete this._requestMap$1[People.RecentActivity.Core.EtwEventName.providerRefreshReactionsStart+t.id+r.reactionType];u=i.aggregationResult;f=u.code!==People.RecentActivity.Core.ResultCode.failure?this._getFeedObjectCache$1(t.type).refreshReactions(this.contactId,t,i.objectList):People.RecentActivity.Providers.create_reactionRefreshInfo();People.RecentActivity.Providers.AggregationState.removeAggregationState(e);this.events.onRefreshReactionsCompleted(u,t,f.reactionsAdded,f.reactionsRemoved,r.userState)}};People.RecentActivity.Providers.FeedProvider.prototype._onCommentAdded$1=function(n){var i=n.requestContext,r=n.data||i.comment,t=i.feedObject;People.RecentActivity.Core.EtwHelper.writeCommentEvent(People.RecentActivity.Core.EtwEventName.providerAddCommentEnd,t,r);delete this._requestMap$1[People.RecentActivity.Core.EtwEventName.providerAddCommentStart];n.resultInfo.code===People.RecentActivity.Core.ResultCode.success&&this._getFeedObjectCache$1(t.type).addComment(this.contactId,t,r);this.events.onCommentAdded(n.resultInfo,t,r,i.userState)};People.RecentActivity.Providers.FeedProvider.prototype._onReactionAdded$1=function(n){var i=n.requestContext,t=i.feedObject,r=n.data||i.reaction;People.RecentActivity.Core.EtwHelper.writeReactionEvent(People.RecentActivity.Core.EtwEventName.providerAddReactionEnd,t,r);delete this._requestMap$1[People.RecentActivity.Core.EtwEventName.providerAddReactionStart];n.resultInfo.code===People.RecentActivity.Core.ResultCode.success&&this._getFeedObjectCache$1(t.type).addReaction(this.contactId,t,r);this.events.onReactionAdded(n.resultInfo,t,r,i.userState)};People.RecentActivity.Providers.FeedProvider.prototype._onReactionRemoved$1=function(n){var i=n.requestContext,t=i.feedObject,r=i.reaction;People.RecentActivity.Core.EtwHelper.writeReactionEvent(People.RecentActivity.Core.EtwEventName.providerRemoveReactionEnd,t,r);delete this._requestMap$1[People.RecentActivity.Core.EtwEventName.providerRemoveReactionStart];n.resultInfo.code===People.RecentActivity.Core.ResultCode.success&&this._getFeedObjectCache$1(t.type).removeReaction(this.contactId,t,r);this.events.onReactionRemoved(n.resultInfo,t,r,i.userState)};People.RecentActivity.Providers.FeedProvider.prototype._onFeedObjectReceived$1=function(n){var r,t,i;People.RecentActivity.Core.EtwHelper.writeFeedObjectEvent(People.RecentActivity.Core.EtwEventName.providerGetFeedObjectEnd,n.requestContext.feedObject);delete this._requestMap$1[People.RecentActivity.Core.EtwEventName.providerGetFeedObjectStart];r=n.data||[];t=null;i=n.resultInfo;i.code===People.RecentActivity.Core.ResultCode.success&&r.length>0?(t=r[0],this.feedObjectCache.addFeedObject(t)):(i.code=People.RecentActivity.Core.ResultCode.failure,t=n.requestContext.feedObject);this.events.onGetFeedObjectCompleted(i,t,n.requestContext.userState)};People.RecentActivity.Providers.FeedProvider.prototype._onFeedObjectAdded$1=function(n){var t=n.data;People.RecentActivity.Core.EtwHelper.writeFeedObjectEvent(People.RecentActivity.Core.EtwEventName.providerAddFeedObjectEnd,t);delete this._requestMap$1[People.RecentActivity.Core.EtwEventName.providerAddFeedObjectStart];this.events.onFeedObjectAdded(n.resultInfo,t,n.requestContext.userState)};People.RecentActivity.Providers.FeedProvider.prototype._onRefreshNotificationsCompleted$1=function(n){var i,r,t;i=n.requestContext;r=this.getNotificationsFromResponse(n);People.RecentActivity.Core.EtwHelper.writeFeedEvent(People.RecentActivity.Core.EtwEventName.providerRefreshNotificationsEnd,this.networkId,this.contactId.id);delete this._requestMap$1[People.RecentActivity.Core.EtwEventName.providerRefreshNotificationsStart];this.notificationsInitialized||(this.notificationsInitialized=true);t=this._refreshCachedNotifications$1(n,r);this.events.onRefreshNotificationsCompleted(n.resultInfo,t.notificationsAdded,t.notificationsUpdated,t.notificationsRemoved,i.userState)};People.RecentActivity.Providers.FeedProvider.prototype._onMarkNotificationsReadCompleted$1=function(t){var e,i,o,s;var f=t.requestContext,r=f.notifications,u=r;if(this._aggregated$1&&(e=People.RecentActivity.Providers.AggregationState.getAggregationState(this._getAggregationKey$1("rn")),e.updateScenarioInstrumentation(n.modernPeople_MarkNotificationsRead,f)),t.resultInfo.code===People.RecentActivity.Core.ResultCode.success){for(u=new Array(r.length),i=0,o=u.length;i<o;i++)u[i]=People.RecentActivity.Core.create_notificationInfo(r[i].id,r[i].publisher,r[i].timestamp,r[i].message,r[i].objectId,r[i].objectType,r[i].link,r[i].via,r[i].sourceId,r[i].isReply,r[i].isShare,false);s=this.notificationCache;s.markNotificationsRead(this.networkId,u)}People.RecentActivity.Core.EtwHelper.writeFeedEvent(People.RecentActivity.Core.EtwEventName.providerMarkNotificationsReadEnd,this.networkId,this.contactId.id);delete this._requestMap$1[People.RecentActivity.Core.EtwEventName.providerMarkNotificationsReadStart];this.events.onMarkNotificationsReadCompleted(t.resultInfo,u,f.userState)};People.RecentActivity.Providers.FeedProvider.prototype._onGetUnreadNotificationsCountCompleted$1=function(t){var r,i;if(People.RecentActivity.Core.EtwHelper.writeFeedEvent(People.RecentActivity.Core.EtwEventName.providerGetUnreadNotificationsCountEnd,this.networkId,this.contactId.id),delete this._requestMap$1[People.RecentActivity.Core.EtwEventName.providerGetUnreadNotificationsCountStart],this._aggregated$1&&(r=People.RecentActivity.Providers.AggregationState.getAggregationState(this._getAggregationKey$1("u")),r.updateScenarioInstrumentation(n.modernPeople_GetUnreadNotificationsCount,t.requestContext)),i=t.resultInfo,i.code===People.RecentActivity.Core.ResultCode.success)this.events.onGetUnreadNotificationsCountCompleted(i,this.getUnreadNotificationsCountFromResponse(t),t.requestContext.userState);else this.events.onGetUnreadNotificationsCountCompleted(i,0,t.requestContext.userState)};People.RecentActivity.Providers.FeedProvider.prototype._createRequestContext$1=function(n,t,i,r,u){var o=People.RecentActivity.Platform.AuthInfo.getInstance(this.networkId),e,f;return e={},e[this.networkId]=this.contactId,f=new People.RecentActivity.Providers.RequestContext(o,e,this.serializer),f.expectedResponse=n,f.feedObject=t,f.comment=i,f.reaction=r,f.userState=u,f};People.RecentActivity.Providers.FeedProvider.prototype._getFeedObjectCache$1=function(n){switch(n){case People.RecentActivity.Core.FeedObjectInfoType.entry:return this.feedCache;case People.RecentActivity.Core.FeedObjectInfoType.photoAlbum:case People.RecentActivity.Core.FeedObjectInfoType.photo:return this.albumCache;default:return null}};People.RecentActivity.Providers.FeedProvider.prototype._findObjectById$1=function(n,t,i){var r=this._getFeedObjectCache$1(i).findObjectById(this.contactId,n,i);return Jx.isNullOrUndefined(r)&&(r=this.feedObjectCache.getFeedObject(n,i)),r};People.RecentActivity.Providers.FeedProvider.prototype._refreshCachedFeedObjects$1=function(n,t,i){var f;var r=n.resultInfo,e=this._getFeedObjectCache$1(i),o=i===People.RecentActivity.Core.FeedObjectInfoType.entry?"f":"a",u=People.RecentActivity.Providers.AggregationState.getAggregationState(this._getAggregationKey$1(o));return!this._aggregated$1||u.totalRequests===1?r.code===People.RecentActivity.Core.ResultCode.success?e.refreshFeedObjects(this.contactId,t):People.RecentActivity.Providers.create_feedObjectRefreshInfo():(u.updateScenarioInstrumentation(n.requestContext.scenarioId,n.requestContext),f=this._getCachedFeedObjects$1(i),r.code!==People.RecentActivity.Core.ResultCode.success)?(u.updateStateWithCachedObjects(r,f,f),People.RecentActivity.Providers.create_feedObjectRefreshInfo()):(u.updateStateWithCachedObjects(r,t,f),People.RecentActivity.Providers.create_feedObjectRefreshInfo())};People.RecentActivity.Providers.FeedProvider.prototype._refreshCachedNotifications$1=function(t,i){var r=t.resultInfo,e=this.notificationCache,u=People.RecentActivity.Providers.AggregationState.getAggregationState(this._getAggregationKey$1("n")),f;return!this._aggregated$1||u.totalRequests===1?r.code===People.RecentActivity.Core.ResultCode.success?e.refreshNotifications(this.networkId,i):People.RecentActivity.Providers.create_notificationRefreshInfo():(u.updateScenarioInstrumentation(n.modernPeople_GetNotifications,t.requestContext),f=this._getCachedNotificationsInternal$1(),r.code!==People.RecentActivity.Core.ResultCode.success)?(u.updateStateWithCachedObjects(r,f,f),People.RecentActivity.Providers.create_notificationRefreshInfo()):(u.updateStateWithCachedObjects(r,i,f),People.RecentActivity.Providers.create_notificationRefreshInfo())};People.RecentActivity.Providers.FeedProvider.prototype._getCachedFeedObjects$1=function(n){var t=this._getFeedObjectCache$1(n);return t.getFeedObjects(this.contactId)};People.RecentActivity.Providers.FeedProvider.prototype._getCachedNotificationsInternal$1=function(){return this.notificationCache.getNotifications(this.networkId)};People.RecentActivity.Providers.FeedProvider.prototype._isFakeObject$1=function(n){return n.id.indexOf("fake")>=0};People.RecentActivity.Providers.FeedProvider.prototype._setRequestMap$1=function(n,t){Jx.isUndefined(this._requestMap$1[n])||this._requestMap$1[n].cancel();this._requestMap$1[n]=t};People.RecentActivity.Providers.FeedProvider.prototype._getAggregationKey$1=function(n){return this._aggregatorId$1+"_"+n};People.RecentActivity.Providers.FeedProvider.prototype._onConnectedNetworkChanged$1=function(n){if(n.sourceId===this.networkId)switch(n.type){case People.RecentActivity.Platform.ConnectedNetworkChangedEventType.updated:this.events.onUpdated(People.RecentActivity.Platform.Platform.instance.getNetworkInfoById(this.networkId))}};People.RecentActivity.Providers.FacebookProvider=function(n,t,i,r,u,f){People.RecentActivity.Providers.FeedProvider.call(this,n,t,i,r,u,f);this.serializer=new People.RecentActivity.Providers.FacebookSerializer(new People.RecentActivity.Providers.SocialCache(i.id));this.requestFactory=new People.RecentActivity.Providers.FacebookRequestFactory};Jx.inherit(People.RecentActivity.Providers.FacebookProvider,People.RecentActivity.Providers.FeedProvider);People.RecentActivity.Providers.FeedAggregator=function(n,t,i){People.RecentActivity.Providers.ProviderBase.call(this,i);this._providerMap$1={};this._supportedProviders$1={};this._totalEntryCount$1=-1;this._personId$1=n;this._networks$1=t;var r=People.RecentActivity.Platform.Configuration.instance;this._feedEntryBatchSize$1=r.feedEntriesBatchSize;this._feedEntryMinBatchSize=r.feedEntriesMinBatchSize;this._feedEntriesMaxCount=r.feedEntriesMaxCount;this._aggregatorId$1=(new Date).getTime().toString();this._initializeProviders$1()};Jx.inherit(People.RecentActivity.Providers.FeedAggregator,People.RecentActivity.Providers.ProviderBase);People.RecentActivity.Providers.FeedAggregator.prototype._personId$1=null;People.RecentActivity.Providers.FeedAggregator.prototype._aggregatorId$1=null;People.RecentActivity.Providers.FeedAggregator.prototype._networks$1=null;People.RecentActivity.Providers.FeedAggregator.prototype._feedEntryBatchSize$1=0;People.RecentActivity.Providers.FeedAggregator.prototype._feedEntryMinBatchSize=0;People.RecentActivity.Providers.FeedAggregator.prototype._feedEntriesMaxCount=0;People.RecentActivity.Providers.FeedAggregator.prototype._providers$1=null;People.RecentActivity.Providers.FeedAggregator.prototype._hasMoreEntries$1=true;People.RecentActivity.Providers.FeedAggregator.prototype._isRefreshingFeed$1=false;People.RecentActivity.Providers.FeedAggregator.prototype._isGettingMoreEntries$1=false;People.RecentActivity.Providers.FeedAggregator.prototype._returnBatch$1=false;People.RecentActivity.Providers.FeedAggregator.prototype.dispose=function(){for(var t,n=0;n<this._providers$1.length;n++)t=this._providers$1[n],t.dispose();People.RecentActivity.Providers.AggregationState.removeAggregationStatesByAggregatorId(this._aggregatorId$1)};People.RecentActivity.Providers.FeedAggregator.prototype.refreshFeedEntries=function(n){var t=this;if(this._isRefreshingFeed$1||this._isGettingMoreEntries$1){Jx.log.write(3,People.Social.format("FeedAggregator.RefreshFeedEntries({0},{1})",this._isRefreshingFeed$1,this._isGettingMoreEntries$1));this.events.onRefreshFeedEntriesCompleted(new People.RecentActivity.Core.ResultInfo(People.RecentActivity.Core.ResultCode.success),[],[],[],false,n);return}if(this.feedInitialized||(this.feedInitializing=true,this.getCachedFeedEntries(true,n)),!People.RecentActivity.Platform.Configuration.instance.isOnline){this.feedInitializing=false;this.feedInitialized=true;this.events.onRefreshFeedEntriesCompleted(new People.RecentActivity.Core.ResultInfo(People.RecentActivity.Core.ResultCode.userOffline),[],[],[],false,n);return}People.RecentActivity.Providers.AggregationState.removeAggregationState(this._getAggregationKey$1("f"));this._aggregateAsync$1(0,"f",function(i){t._isRefreshingFeed$1=true;i.refreshFeedEntries(n)})};People.RecentActivity.Providers.FeedAggregator.prototype.getCachedFeedEntries=function(n,t){People.RecentActivity.Providers.AggregationState.removeAggregationState(this._getAggregationKey$1("f"));this._isGettingMoreEntries$1=false;this._returnBatch$1=n;this._aggregateAsync$1(0,"cf",function(i){i.getCachedFeedEntries(n,t)})};People.RecentActivity.Providers.FeedAggregator.prototype.refreshAlbums=function(n){if(this.albumInitialized||this.getCachedAlbums(n),!People.RecentActivity.Platform.Configuration.instance.isOnline){this.events.onRefreshAlbumsCompleted(new People.RecentActivity.Core.ResultInfo(People.RecentActivity.Core.ResultCode.userOffline),[],[],[],n);return}this._aggregateAsync$1(1,"a",function(t){t.refreshAlbums(n)})};People.RecentActivity.Providers.FeedAggregator.prototype.getCachedAlbums=function(n){this._aggregateAsync$1(1,"ca",function(t){t.getCachedAlbums(n)})};People.RecentActivity.Providers.FeedAggregator.prototype.refreshAlbum=function(n,t){this._getProvider$1(n).refreshAlbum(n,t)};People.RecentActivity.Providers.FeedAggregator.prototype.refreshPhoto=function(n,t){this._getProvider$1(n).refreshPhoto(n,t)};People.RecentActivity.Providers.FeedAggregator.prototype.refreshComments=function(n,t){this._getProvider$1(n).refreshComments(n,t)};People.RecentActivity.Providers.FeedAggregator.prototype.refreshReactions=function(n,t){this._getProvider$1(n).refreshReactions(n,t)};People.RecentActivity.Providers.FeedAggregator.prototype.addComment=function(n,t,i){this._getProvider$1(n).addComment(n,t,i)};People.RecentActivity.Providers.FeedAggregator.prototype.addReaction=function(n,t,i){this._getProvider$1(n).addReaction(n,t,i)};People.RecentActivity.Providers.FeedAggregator.prototype.removeReaction=function(n,t,i){this._getProvider$1(n).removeReaction(n,t,i)};People.RecentActivity.Providers.FeedAggregator.prototype.getCachedFeedObject=function(n,t){this._getProvider$1(n).getCachedFeedObject(n,t)};People.RecentActivity.Providers.FeedAggregator.prototype.getFeedObject=function(n,t){this._getProvider$1(n).getCachedFeedObject(n,t)};People.RecentActivity.Providers.FeedAggregator.prototype.addFeedObject=function(n,t){this._getProvider$1(n).addFeedObject(n,t)};People.RecentActivity.Providers.FeedAggregator.prototype.getMoreFeedEntries=function(n){var h=this,t,o,r,u,s;if(!this.feedInitialized||this._isRefreshingFeed$1||this._isGettingMoreEntries$1){Jx.log.write(3,People.Social.format("FeedAggregator.GetMoreFeedEntries({0},{1},{2})",this.feedInitialized,this._isRefreshingFeed$1,this._isGettingMoreEntries$1));this.events.onGetMoreEntriesCompleted(new People.RecentActivity.Core.ResultInfo(People.RecentActivity.Core.ResultCode.success),[],false,n);return}if(!People.RecentActivity.Platform.Configuration.instance.isOnline){this.events.onGetMoreEntriesCompleted(new People.RecentActivity.Core.ResultInfo(People.RecentActivity.Core.ResultCode.userOffline),[],false,n);return}if(t=this._getSupportedProvidersByObjectType$1(0),t.length===1){People.RecentActivity.Providers.AggregationState.removeAggregationState(this._getAggregationKey$1("f"));this._isGettingMoreEntries$1=true;t[0].getMoreFeedEntries(n);return}if(!this._hasMoreEntries$1){Jx.log.write(4,"FeedAggregator.GetMoreFeedEntries(hasMoreEntries:false)");this.events.onGetMoreEntriesCompleted(new People.RecentActivity.Core.ResultInfo(People.RecentActivity.Core.ResultCode.success),[],false,n);return}var e=this._getAggregationKey$1("f"),i=People.RecentActivity.Providers.AggregationState.getAggregationState(e),f=i.queuedObjects.length;if(Jx.log.write(4,People.Social.format("FeedAggregator.GetMoreFeedEntries(queuedObjCount:{0})",f)),f<this._feedEntryBatchSize$1){this._aggregateAsync$1(0,"f",function(t){h._isGettingMoreEntries$1=true;t.getMoreFeedEntries(n)});return}if(o=this._getSupportedNetworks$1(0),t=this._getProvidersForMoreEntries$1(i,o),Jx.log.write(4,People.Social.format("FeedAggregator.GetMoreFeedEntries(providers.Count:{0})",t.length)),!t.length){r=i.queuedObjects.splice(f-this._feedEntryBatchSize$1,this._feedEntryBatchSize$1);this._totalEntryCount$1+=r.length;Jx.log.write(4,People.Social.format("FeedAggregator.GetMoreFeedEntries(totalEntryCount:{0})",this._totalEntryCount$1));this._totalEntryCount$1>=this._feedEntryMinBatchSize&&(this._hasMoreEntries$1=false,People.RecentActivity.Providers.AggregationState.removeAggregationState(e));this._updateFeedObjectsCache$1(r,People.RecentActivity.Core.FeedObjectInfoType.entry,true);this.events.onGetMoreEntriesCompleted(new People.RecentActivity.Core.ResultInfo(People.RecentActivity.Core.ResultCode.success),r,this._hasMoreEntries$1,n);return}for(i.reset(t.length),this._isGettingMoreEntries$1=true,u=0;u<t.length;u++)s=t[u],s.getMoreFeedEntries(n)};People.RecentActivity.Providers.FeedAggregator.prototype.refreshNotifications=function(n){if(!People.RecentActivity.Platform.Configuration.instance.isOnline){this.events.onRefreshNotificationsCompleted(new People.RecentActivity.Core.ResultInfo(People.RecentActivity.Core.ResultCode.userOffline),[],[],[],n);return}this.notificationsInitialized||this.getCachedNotifications(n);this._aggregateAsync$1(2,"n",function(t){t.refreshNotifications(n)})};People.RecentActivity.Providers.FeedAggregator.prototype.getCachedNotifications=function(n){if(!People.RecentActivity.Platform.Configuration.instance.isOnline){this.events.onGetCachedNotificationsCompleted(new People.RecentActivity.Core.ResultInfo(People.RecentActivity.Core.ResultCode.userOffline),[],n);return}this._aggregateAsync$1(2,"cn",function(t){t.getCachedNotifications(n)})};People.RecentActivity.Providers.FeedAggregator.prototype.markNotificationsRead=function(n,t){for(var f,r,e,o,s,i={},u=0;u<n.length;u++)f=n[u],r=i[f.publisher.sourceId],r==null&&(r=[],i[f.publisher.sourceId]=r),r.push(f);People.RecentActivity.Providers.AggregationState.getAggregationState(this._getAggregationKey$1("rn")).reset(Object.keys(i).length);for(e in i)o={key:e,value:i[e]},s=this._providerMap$1[o.key],s.markNotificationsRead(o.value,t)};People.RecentActivity.Providers.FeedAggregator.prototype.getUnreadNotificationsCount=function(n){this._aggregateAsync$1(2,"u",function(t){t.getUnreadNotificationsCount(n)})};People.RecentActivity.Providers.FeedAggregator.prototype.onUpdated=function(n){this.events.onUpdated(n)};People.RecentActivity.Providers.FeedAggregator.prototype.onRefreshFeedEntriesCompleted=function(n,t,i,r,u,f){var h,e,s,c,o;if(this.feedInitialized||(this.feedInitialized=true,this.feedInitializing=false),h=this._getAggregationKey$1("f"),e=People.RecentActivity.Providers.AggregationState.getAggregationState(h),e.totalRequests===1){this._tryRecordScenario$1(e);this.events.onRefreshFeedEntriesCompleted(n,t,i,r,u,f);this._isRefreshingFeed$1=false;People.RecentActivity.Providers.AggregationState.removeAggregationState(h);return}if(!e.outstandingRequests){this._tryRecordScenario$1(e);n=e.aggregationResult;s=this._extractAggregatedObjects$1(e.objectList,this._feedEntryBatchSize$1,this._getFeedObjectTimestamp$1);this._updateFeedObjectsCache$1(s,People.RecentActivity.Core.FeedObjectInfoType.entry,false);c=this._extractAggregatedObjects$1(e.cachedObjectList,this._feedEntryBatchSize$1,this._getFeedObjectTimestamp$1);o=n.code!==People.RecentActivity.Core.ResultCode.failure?new People.RecentActivity.Providers.FeedEntryInfoCollection(c).refresh(s):People.RecentActivity.Providers.create_feedObjectRefreshInfo();n.isSuccessOrPartialFailure&&(this._totalEntryCount$1===-1||this.hasUpdate(o))&&(this._totalEntryCount$1=s.length,Jx.log.write(4,People.Social.format("FeedAggregator.OnRefreshFeedEntriesCompleted(totalEntryCount:{0})",this._totalEntryCount$1)),this._hasMoreEntries$1=this._totalEntryCount$1>=this._feedEntryMinBatchSize,e.queuedObjects.length=0,e.queuedObjects.push.apply(e.queuedObjects,e.objectList));this.events.onRefreshFeedEntriesCompleted(n,o.objectsAdded,o.objectsUpdated,o.objectsRemoved,this._hasMoreEntries$1,f);this._isRefreshingFeed$1=false}};People.RecentActivity.Providers.FeedAggregator.prototype.onGetCachedFeedEntriesCompleted=function(n,t,i){var r=this;this._onGetAggregatedObjectsCompleted$1(n,t,"cf",this._returnBatch$1?this._feedEntryBatchSize$1:-1,this._getFeedObjectTimestamp$1,function(n,t){r.feedInitializing||(r._totalEntryCount$1=t.length,r._hasMoreEntries$1=r._totalEntryCount$1<r._feedEntriesMaxCount,Jx.log.write(4,People.Social.format("FeedAggregator.OnGetCachedFeedEntriesCompleted(totalEntryCount:{0})",r._totalEntryCount$1)),r.feedInitialized=true);r.events.onGetCachedFeedEntriesCompleted(n,t,i)})};People.RecentActivity.Providers.FeedAggregator.prototype.onRefreshCommentsCompleted=function(n,t,i,r,u){this.events.onRefreshCommentsCompleted(n,t,i,r,u)};People.RecentActivity.Providers.FeedAggregator.prototype.onRefreshReactionsCompleted=function(n,t,i,r,u){this.events.onRefreshReactionsCompleted(n,t,i,r,u)};People.RecentActivity.Providers.FeedAggregator.prototype.onCommentAdded=function(n,t,i,r){this.events.onCommentAdded(n,t,i,r)};People.RecentActivity.Providers.FeedAggregator.prototype.onReactionAdded=function(n,t,i,r){this.events.onReactionAdded(n,t,i,r)};People.RecentActivity.Providers.FeedAggregator.prototype.onReactionRemoved=function(n,t,i,r){this.events.onReactionRemoved(n,t,i,r)};People.RecentActivity.Providers.FeedAggregator.prototype.onGetCachedAlbumsCompleted=function(n,t,i){this.events.onGetCachedAlbumsCompleted(n,t,i)};People.RecentActivity.Providers.FeedAggregator.prototype.onRefreshAlbumsCompleted=function(n,t,i,r,u){this.events.onRefreshAlbumsCompleted(n,t,i,r,u)};People.RecentActivity.Providers.FeedAggregator.prototype.onRefreshAlbumCompleted=function(n,t,i,r,u,f){this.events.onRefreshAlbumCompleted(n,t,i,r,u,f)};People.RecentActivity.Providers.FeedAggregator.prototype.onRefreshPhotoCompleted=function(n,t,i,r,u){this.events.onRefreshPhotoCompleted(n,t,i,r,u)};People.RecentActivity.Providers.FeedAggregator.prototype.onGetCachedFeedObjectCompleted=function(n,t,i){this.events.onGetCachedFeedObjectCompleted(n,t,i)};People.RecentActivity.Providers.FeedAggregator.prototype.onGetFeedObjectCompleted=function(n,t,i){this.events.onGetFeedObjectCompleted(n,t,i)};People.RecentActivity.Providers.FeedAggregator.prototype.onFeedObjectAdded=function(n,t,i){this.events.onFeedObjectAdded(n,t,i)};People.RecentActivity.Providers.FeedAggregator.prototype.onGetMoreEntriesCompleted=function(n,t,i,r){var s=this._getSupportedProvidersByObjectType$1(0),o,u,h,f,e;if(s.length===1){this._isGettingMoreEntries$1=false;this.events.onGetMoreEntriesCompleted(n,t,i,r);return}if(o=this._getAggregationKey$1("f"),u=People.RecentActivity.Providers.AggregationState.getAggregationState(o),!u.outstandingRequests){this._tryRecordScenario$1(u);n=u.aggregationResult;h={};f=u.queuedObjects;f.push.apply(f,u.objectList);this._dedupeObjects$1(f,function(n){var t=n;return t.sourceId+";"+t.id});e=this._extractAggregatedObjects$1(f,this._feedEntryBatchSize$1,this._getFeedObjectTimestamp$1);this._updateFeedObjectsCache$1(e,People.RecentActivity.Core.FeedObjectInfoType.entry,true);this._totalEntryCount$1+=e.length;Jx.log.write(4,People.Social.format("FeedAggregator.OnGetMoreEntriesCompleted(totalEntryCount:{0})",this._totalEntryCount$1));(this._totalEntryCount$1>=this._feedEntriesMaxCount||n.code===People.RecentActivity.Core.ResultCode.success&&e.length<People.RecentActivity.Platform.Configuration.prototype.feedEntriesBatchSize)&&(this._hasMoreEntries$1=false,Jx.log.write(4,"FeedAggregator.OnGetMoreEntriesCompleted(hasMoreEntries:false)"),People.RecentActivity.Providers.AggregationState.removeAggregationState(o));this.events.onGetMoreEntriesCompleted(n,e,this._hasMoreEntries$1,r);this._isGettingMoreEntries$1=false}};People.RecentActivity.Providers.FeedAggregator.prototype.onRefreshNotificationsCompleted=function(n,t,i,r,u){var o,f,s,h,e;if(this.notificationsInitialized=true,o=this._getAggregationKey$1("n"),f=People.RecentActivity.Providers.AggregationState.getAggregationState(o),f.totalRequests===1){this._tryRecordScenario$1(f);this.events.onRefreshNotificationsCompleted(n,t,i,r,u);return}if(!f.outstandingRequests){this._tryRecordScenario$1(f);n=f.aggregationResult;s=this._extractAggregatedObjects$1(f.objectList,People.RecentActivity.Platform.Configuration.instance.maxCachedNotificationsPerNetwork,this._getNotificationTimestamp$1);this._updateNotificationsCache$1(s);h=this._extractAggregatedObjects$1(f.cachedObjectList,People.RecentActivity.Platform.Configuration.instance.maxCachedNotificationsPerNetwork,this._getNotificationTimestamp$1);e=n.code!==People.RecentActivity.Core.ResultCode.failure?new People.RecentActivity.Providers.NotificationInfoCollection(h).refresh(s):People.RecentActivity.Providers.create_notificationRefreshInfo();People.RecentActivity.Providers.AggregationState.removeAggregationState(o);this.events.onRefreshNotificationsCompleted(n,e.notificationsAdded,e.notificationsUpdated,e.notificationsRemoved,u)}};People.RecentActivity.Providers.FeedAggregator.prototype.onGetCachedNotificationsCompleted=function(n,t,i){var r=this;this._onGetAggregatedObjectsCompleted$1(n,t,"cn",People.RecentActivity.Platform.Configuration.instance.maxCachedNotificationsPerNetwork,this._getNotificationTimestamp$1,function(n,t){r.notificationsInitialized=true;r.events.onGetCachedNotificationsCompleted(n,t,i)})};People.RecentActivity.Providers.FeedAggregator.prototype.onMarkNotificationsReadCompleted=function(n,t,i){var r=this;this._onGetAggregatedObjectsCompleted$1(n,t,"rn",People.RecentActivity.Platform.Configuration.instance.maxCachedNotificationsPerNetwork,this._getNotificationTimestamp$1,function(n,t){r.events.onMarkNotificationsReadCompleted(n,t,i)})};People.RecentActivity.Providers.FeedAggregator.prototype.onGetUnreadNotificationsCountCompleted=function(n,t,i){var u=this._getAggregationKey$1("u"),r=People.RecentActivity.Providers.AggregationState.getAggregationState(u);if(r.totalRequests===1){this._tryRecordScenario$1(r);this.events.onGetUnreadNotificationsCountCompleted(n,t,i);return}if(r.updateStateWithCount(n,t),!r.outstandingRequests){this._tryRecordScenario$1(r);n=r.aggregationResult;People.RecentActivity.Providers.AggregationState.removeAggregationState(u);this.events.onGetUnreadNotificationsCountCompleted(n,r.count,i)}};People.RecentActivity.Providers.FeedAggregator.prototype._initializeProviders$1=function(){for(var f=this._networks$1.length>1?true:false,r=[],u=[],i,t,n=0;n<this._networks$1.length;n++)t=this._networks$1[n],t.id===People.RecentActivity.Core.NetworkId.facebook?(i=new People.RecentActivity.Providers.FacebookProvider(this._personId$1,0,t,this,f,this._aggregatorId$1),r.push(i),this._providerMap$1[t.id]=i):u.push(t);for(n=0;n<u.length;n++)t=u[n],i=new People.RecentActivity.Providers.SupProvider(this._personId$1,0,t,this,f,this._aggregatorId$1),r.push(i),this._providerMap$1[t.id]=i;this._providers$1=r};People.RecentActivity.Providers.FeedAggregator.prototype._getProvider$1=function(n){return this._providerMap$1[n.sourceId]};People.RecentActivity.Providers.FeedAggregator.prototype._aggregateAsync$1=function(n,t,i){var u=this._getSupportedProvidersByObjectType$1(n),r,f;for(People.RecentActivity.Providers.AggregationState.getAggregationState(this._getAggregationKey$1(t)).reset(u.length),r=0;r<u.length;r++)f=u[r],i(f)};People.RecentActivity.Providers.FeedAggregator.prototype._onGetAggregatedObjectsCompleted$1=function(n,t,i,r,u,f){i=this._getAggregationKey$1(i);var e=People.RecentActivity.Providers.AggregationState.getAggregationState(i);if(e.totalRequests===1){this._tryRecordScenario$1(e);f(n,t);return}e.updateState(n,t);e.outstandingRequests||(this._tryRecordScenario$1(e),n=e.aggregationResult,t=this._extractAggregatedObjects$1(e.objectList,r,u),People.RecentActivity.Providers.AggregationState.removeAggregationState(i),f(n,t))};People.RecentActivity.Providers.FeedAggregator.prototype._getSupportedProvidersByObjectType$1=function(n){return Jx.isUndefined(this._supportedProviders$1[n])&&(this._supportedProviders$1[n]=this._getSupportedProviders$1(this._getSupportedNetworks$1(n))),this._supportedProviders$1[n]};People.RecentActivity.Providers.FeedAggregator.prototype._getSupportedProviders$1=function(n){for(var t=[],u,r,i=0;i<n.length;i++)if(u=n[i],r=this._providerMap$1[u],r!=null&&(t.indexOf(r)===-1&&t.push(r),t.length===this._providers$1.length))break;return t};People.RecentActivity.Providers.FeedAggregator.prototype._extractAggregatedObjects$1=function(n,t,i){return this._sortObjects$1(n,i),t===-1?n:n.splice(Math.max(n.length-t,0),t)};People.RecentActivity.Providers.FeedAggregator.prototype._sortObjects$1=function(n,t){n.sort(function(n,i){return t(n)-t(i)})};People.RecentActivity.Providers.FeedAggregator.prototype._dedupeObjects$1=function(n,t){for(var u={},r,i=n.length-1;i>=0;i--)r=t(n[i]),Jx.isUndefined(u[r])||n.splice(i,1),u[r]=true};People.RecentActivity.Providers.FeedAggregator.prototype._getSupportedNetworks$1=function(n){var r=this,i=People.RecentActivity.Platform.Configuration.instance,t=[];switch(n){case 0:t=i.supportedNetworksForRecentActivity;break;case 1:t=i.supportedNetworksForPhoto;break;case 2:t=i.supportedNetworksForNotification}return t.filter(function(n){return!Jx.isUndefined(r._providerMap$1[n])})};People.RecentActivity.Providers.FeedAggregator.prototype._getFeedObjectTimestamp$1=function(n){return n.timestamp};People.RecentActivity.Providers.FeedAggregator.prototype._getNotificationTimestamp$1=function(n){return n.timestamp};People.RecentActivity.Providers.FeedAggregator.prototype._tryRecordScenario$1=function(t){t.recordScenario&&t.scenarioId!==n.unknown&&People.RecentActivity.Core.BiciHelper.recordScenarioQos(t.scenarioId,t.scenarioDuration,t.scenarioRequestSize,t.scenarioErrorCode,t.scenarioErrorType,null)};People.RecentActivity.Providers.FeedAggregator.prototype._getAggregationKey$1=function(n){return this._aggregatorId$1+"_"+n};People.RecentActivity.Providers.FeedAggregator.prototype._getProvidersForMoreEntries$1=function(n,t){for(var i={},h=n.queuedObjects,c=h.length,o,f,e,u,s,r=0;r<c;r++)if(o=h[r],Jx.isUndefined(i[o.sourceId])&&(i[o.sourceId]=r,Object.keys(i).length===t.length))break;for(f=[],e=0;e<t.length;e++)u=t[e],(Jx.isUndefined(i[u])||i[u]>c-this._feedEntryBatchSize$1)&&(s=this._providerMap$1[u],f.indexOf(s)===-1&&(f.push(s),Jx.log.write(4,People.Social.format("FeedAggregator.GetProvidersForMoreEntries(network:{0})",u))));return f};People.RecentActivity.Providers.FeedAggregator.prototype._updateFeedObjectsCache$1=function(n,t,i){for(var s,e,h,o,u,c,r={},f=0;f<n.length;f++)s=n[f],e=s.sourceId,Jx.isUndefined(r[e])&&(r[e]=[]),r[e].push(s);for(h in r)o={key:h,value:r[h]},u=this._providerMap$1[o.key],u!=null&&(c=t===People.RecentActivity.Core.FeedObjectInfoType.entry?u.feedCache:u.albumCache,i?c.addMoreFeedObjects(u.contactId,o.value):c.addCacheEntry(u.contactId,o.value))};People.RecentActivity.Providers.FeedAggregator.prototype._updateNotificationsCache$1=function(n){for(var i={},t=null,u,f,e,o,r=0;r<n.length;r++)u=n[r],t=u.sourceId,Jx.isUndefined(i[t])&&(i[t]=[]),i[t].push(u);for(f in i)e={key:f,value:i[f]},t=e.key,o=this._providerMap$1[t],o!=null&&o.notificationCache.addCacheEntry(t,e.value)};People.RecentActivity.Providers.RetailModeProvider=function(n,t){People.RecentActivity.Providers.ProviderBase.call(this,t);this._provider$1=n;this._provider$1.events=this};Jx.inherit(People.RecentActivity.Providers.RetailModeProvider,People.RecentActivity.Providers.ProviderBase);People.RecentActivity.Providers.RetailModeProvider.prototype._provider$1=null;People.RecentActivity.Providers.RetailModeProvider.prototype.dispose=function(){this._provider$1.dispose()};People.RecentActivity.Providers.RetailModeProvider.prototype.refreshFeedEntries=function(n){this.feedInitialized||(this.getCachedFeedEntries(true,n),this.feedInitialized=true);this.events.onRefreshFeedEntriesCompleted(new People.RecentActivity.Core.ResultInfo(People.RecentActivity.Core.ResultCode.success),[],[],[],false,n)};People.RecentActivity.Providers.RetailModeProvider.prototype.getCachedFeedEntries=function(n,t){this._provider$1.getCachedFeedEntries(n,t)};People.RecentActivity.Providers.RetailModeProvider.prototype.refreshAlbums=function(n){this.albumInitialized||(this.getCachedAlbums(n),this.albumInitialized=true);this.events.onRefreshAlbumsCompleted(new People.RecentActivity.Core.ResultInfo(People.RecentActivity.Core.ResultCode.success),[],[],[],n)};People.RecentActivity.Providers.RetailModeProvider.prototype.getCachedAlbums=function(n){this._provider$1.getCachedAlbums(n)};People.RecentActivity.Providers.RetailModeProvider.prototype.refreshAlbum=function(n,t){this.events.onRefreshAlbumCompleted(new People.RecentActivity.Core.ResultInfo(People.RecentActivity.Core.ResultCode.success),n,[],[],[],t)};People.RecentActivity.Providers.RetailModeProvider.prototype.refreshPhoto=function(n,t){this.events.onRefreshPhotoCompleted(new People.RecentActivity.Core.ResultInfo(People.RecentActivity.Core.ResultCode.success),n,[],[],t)};People.RecentActivity.Providers.RetailModeProvider.prototype.refreshComments=function(n,t){this.events.onRefreshCommentsCompleted(new People.RecentActivity.Core.ResultInfo(People.RecentActivity.Core.ResultCode.success),n,[],[],t)};People.RecentActivity.Providers.RetailModeProvider.prototype.refreshReactions=function(n,t){this.events.onRefreshReactionsCompleted(new People.RecentActivity.Core.ResultInfo(People.RecentActivity.Core.ResultCode.success),n,[],[],t)};People.RecentActivity.Providers.RetailModeProvider.prototype.addComment=function(n,t,i){this.events.onCommentAdded(new People.RecentActivity.Core.ResultInfo(People.RecentActivity.Core.ResultCode.success),n,t,i)};People.RecentActivity.Providers.RetailModeProvider.prototype.addReaction=function(n,t,i){this.events.onReactionAdded(new People.RecentActivity.Core.ResultInfo(People.RecentActivity.Core.ResultCode.success),n,t,i)};People.RecentActivity.Providers.RetailModeProvider.prototype.removeReaction=function(n,t,i){this.events.onReactionRemoved(new People.RecentActivity.Core.ResultInfo(People.RecentActivity.Core.ResultCode.success),n,t,i)};People.RecentActivity.Providers.RetailModeProvider.prototype.getCachedFeedObject=function(n,t){this._provider$1.getCachedFeedObject(n,t)};People.RecentActivity.Providers.RetailModeProvider.prototype.getFeedObject=function(n,t){this.events.onGetFeedObjectCompleted(new People.RecentActivity.Core.ResultInfo(People.RecentActivity.Core.ResultCode.success),n,t)};People.RecentActivity.Providers.RetailModeProvider.prototype.addFeedObject=function(n,t){this.events.onFeedObjectAdded(new People.RecentActivity.Core.ResultInfo(People.RecentActivity.Core.ResultCode.success),n,t)};People.RecentActivity.Providers.RetailModeProvider.prototype.getMoreFeedEntries=function(n){this.events.onGetMoreEntriesCompleted(new People.RecentActivity.Core.ResultInfo(People.RecentActivity.Core.ResultCode.success),[],false,n)};People.RecentActivity.Providers.RetailModeProvider.prototype.refreshNotifications=function(n){this.notificationsInitialized||(this.getCachedNotifications(n),this.notificationsInitialized=true);this.events.onRefreshNotificationsCompleted(new People.RecentActivity.Core.ResultInfo(People.RecentActivity.Core.ResultCode.success),[],[],[],n)};People.RecentActivity.Providers.RetailModeProvider.prototype.getCachedNotifications=function(n){this._provider$1.getCachedNotifications(n)};People.RecentActivity.Providers.RetailModeProvider.prototype.markNotificationsRead=function(n){for(var t={},u,r,o,f,e,i=0;i<n.length;i++)u=n[i],r=u.sourceId,!Jx.isUndefined(t[r])||(t[r]=[]),t[r].push(u);o=this.notificationCache;for(f in t)e={key:f,value:t[f]},n=e.value,o.markNotificationsRead(e.key,n)};People.RecentActivity.Providers.RetailModeProvider.prototype.getUnreadNotificationsCount=function(n){for(var s=this.notificationCache,f=0,e,u,i,o,t=0,r=People.RecentActivity.Platform.Configuration.instance.supportedNetworksForNotification;t<r.length;t++)for(e=r[t],u=s.getNotifications(e),i=0;i<u.length;i++)o=u[i],o.isUnread&&f++;this.events.onGetUnreadNotificationsCountCompleted(new People.RecentActivity.Core.ResultInfo(People.RecentActivity.Core.ResultCode.success),f,n)};People.RecentActivity.Providers.RetailModeProvider.prototype.onUpdated=function(n){this.events.onUpdated(n)};People.RecentActivity.Providers.RetailModeProvider.prototype.onRefreshFeedEntriesCompleted=function(){};People.RecentActivity.Providers.RetailModeProvider.prototype.onGetCachedFeedEntriesCompleted=function(n,t,i){this.events.onGetCachedFeedEntriesCompleted(n,t,i)};People.RecentActivity.Providers.RetailModeProvider.prototype.onRefreshCommentsCompleted=function(){};People.RecentActivity.Providers.RetailModeProvider.prototype.onRefreshReactionsCompleted=function(){};People.RecentActivity.Providers.RetailModeProvider.prototype.onCommentAdded=function(){};People.RecentActivity.Providers.RetailModeProvider.prototype.onReactionAdded=function(){};People.RecentActivity.Providers.RetailModeProvider.prototype.onReactionRemoved=function(){};People.RecentActivity.Providers.RetailModeProvider.prototype.onGetCachedAlbumsCompleted=function(n,t,i){this.events.onGetCachedAlbumsCompleted(n,t,i)};People.RecentActivity.Providers.RetailModeProvider.prototype.onRefreshAlbumsCompleted=function(){};People.RecentActivity.Providers.RetailModeProvider.prototype.onRefreshAlbumCompleted=function(){};People.RecentActivity.Providers.RetailModeProvider.prototype.onRefreshPhotoCompleted=function(){};People.RecentActivity.Providers.RetailModeProvider.prototype.onGetCachedFeedObjectCompleted=function(n,t,i){this.events.onGetCachedFeedObjectCompleted(n,t,i)};People.RecentActivity.Providers.RetailModeProvider.prototype.onGetFeedObjectCompleted=function(){};People.RecentActivity.Providers.RetailModeProvider.prototype.onFeedObjectAdded=function(){};People.RecentActivity.Providers.RetailModeProvider.prototype.onGetMoreEntriesCompleted=function(){};People.RecentActivity.Providers.RetailModeProvider.prototype.onRefreshNotificationsCompleted=function(){};People.RecentActivity.Providers.RetailModeProvider.prototype.onGetCachedNotificationsCompleted=function(n,t,i){this.events.onGetCachedNotificationsCompleted(n,t,i)};People.RecentActivity.Providers.RetailModeProvider.prototype.onMarkNotificationsReadCompleted=function(){};People.RecentActivity.Providers.RetailModeProvider.prototype.onGetUnreadNotificationsCountCompleted=function(){};People.RecentActivity.Providers.SupProvider=function(n,t,i,r,u,f){People.RecentActivity.Providers.FeedProvider.call(this,n,t,i,r,u,f);this.serializer=new People.RecentActivity.Providers.SupSerializer(new People.RecentActivity.Providers.SocialCache(i.id));this.requestFactory=new People.RecentActivity.Providers.SupRequestFactory};Jx.inherit(People.RecentActivity.Providers.SupProvider,People.RecentActivity.Providers.FeedProvider);People.RecentActivity.Providers.SupProvider._notificationReturnedThreshold$2=6048e5;People.RecentActivity.Providers.SupProvider.prototype.refreshAlbums=function(n){this.events.onRefreshAlbumsCompleted(new People.RecentActivity.Core.ResultInfo(People.RecentActivity.Core.ResultCode.success),new Array(0),new Array(0),new Array(0),n)};People.RecentActivity.Providers.SupProvider.prototype.getCachedAlbums=function(n){this.events.onGetCachedAlbumsCompleted(new People.RecentActivity.Core.ResultInfo(People.RecentActivity.Core.ResultCode.success),new Array(0),n)};People.RecentActivity.Providers.SupProvider.prototype.refreshAlbum=function(n,t){this.events.onRefreshAlbumCompleted(new People.RecentActivity.Core.ResultInfo(People.RecentActivity.Core.ResultCode.success),n,new Array(0),new Array(0),new Array(0),t)};People.RecentActivity.Providers.SupProvider.prototype.refreshPhoto=function(n,t){this.events.onRefreshPhotoCompleted(new People.RecentActivity.Core.ResultInfo(People.RecentActivity.Core.ResultCode.success),n,new Array(0),new Array(0),t)};People.RecentActivity.Providers.SupProvider.prototype.refreshComments=function(n,t){if(n.type===People.RecentActivity.Core.FeedObjectInfoType.photoAlbum&&n.sourceId===People.RecentActivity.Core.NetworkId.twitter){this.events.onRefreshCommentsCompleted(new People.RecentActivity.Core.ResultInfo(People.RecentActivity.Core.ResultCode.success),n,new Array(0),new Array(0),t);return}People.RecentActivity.Providers.FeedProvider.prototype.refreshComments.call(this,n,t)};People.RecentActivity.Providers.SupProvider.prototype.refreshReactions=function(n,t){if(n.type===People.RecentActivity.Core.FeedObjectInfoType.photoAlbum&&n.sourceId===People.RecentActivity.Core.NetworkId.twitter){this.events.onRefreshReactionsCompleted(new People.RecentActivity.Core.ResultInfo(People.RecentActivity.Core.ResultCode.success),n,new Array(0),new Array(0),t);return}People.RecentActivity.Providers.FeedProvider.prototype.refreshReactions.call(this,n,t)};People.RecentActivity.Providers.SupProvider.prototype.markNotificationsRead=function(n,t){var i,r,u;for(this.notificationCache.markNotificationsRead(this.networkId,n),i=0,r=0;r<n.length;r++)u=n[r],u.timestamp>i&&(i=u.timestamp),u.isUnread=false;this.notificationCache.updateLastReadTime(this.networkId,new Date(i));this.events.onMarkNotificationsReadCompleted(new People.RecentActivity.Core.ResultInfo(People.RecentActivity.Core.ResultCode.success),n,t)};People.RecentActivity.Providers.SupProvider.prototype.getNotificationsFromResponse=function(n){var t=n.data,u,f,i,r;if(t==null||!t.length)return new Array(0);for(u=[],f=this.notificationCache.getLastReadTime(this.networkId),i=0;i<t.length;i++)r=t[i],this._isNotificationRecent$2(r)&&(this.feedObjectCache.addFeedObject(r),u.push(this._toNotification$2(r,f)));return u};People.RecentActivity.Providers.SupProvider.prototype.getUnreadNotificationsCountFromResponse=function(n){var t=n.data,r,f,i,u;if(t==null||!t.length)return 0;for(r=0,f=this.notificationCache.getLastReadTime(this.networkId),i=0;i<t.length;i++)u=t[i],this._isNotificationRecent$2(u)&&this._isNotificationUnread$2(u,f)&&r++;return r};People.RecentActivity.Providers.SupProvider.prototype._toNotification$2=function(n,t){var i=n.data;return People.RecentActivity.Core.create_notificationInfo(n.id,this._getNotificationPublisher$2(i),n.timestamp,this._getNotificationMessage$2(i),n.id,this._getNotificationType$2(n.type),n.url,i.via,n.sourceId,this._isNotificationReply$2(i),this._isNotificationShare$2(i),this._isNotificationUnread$2(n,t))};People.RecentActivity.Providers.SupProvider.prototype._isNotificationReply$2=function(n){return this._getAnnotation$2(n,People.RecentActivity.Core.AnnotationInfoType.inReplyTo)!=null};People.RecentActivity.Providers.SupProvider.prototype._isNotificationShare$2=function(n){return this._getAnnotation$2(n,People.RecentActivity.Core.AnnotationInfoType.retweetedBy)!=null};People.RecentActivity.Providers.SupProvider.prototype._isNotificationUnread$2=function(n,t){return t!==Date.empty&&t.getTime()>=n.timestamp?false:true};People.RecentActivity.Providers.SupProvider.prototype._isNotificationRecent$2=function(n){return(new Date).getTime()-n.timestamp<=People.RecentActivity.Providers.SupProvider._notificationReturnedThreshold$2};People.RecentActivity.Providers.SupProvider.prototype._getNotificationPublisher$2=function(n){var t=this._getAnnotation$2(n,People.RecentActivity.Core.AnnotationInfoType.retweetedBy);return t!=null?t.data.publisher:n.publisher};People.RecentActivity.Providers.SupProvider.prototype._getNotificationMessage$2=function(n){var t=this._getAnnotation$2(n,People.RecentActivity.Core.AnnotationInfoType.retweetedBy),i;if(t!=null)return i=t.data,i.text;switch(n.type){case People.RecentActivity.Core.FeedEntryInfoType.text:return n.data.text;case People.RecentActivity.Core.FeedEntryInfoType.link:return n.data.text;case People.RecentActivity.Core.FeedEntryInfoType.photo:return n.data.text;case People.RecentActivity.Core.FeedEntryInfoType.photoAlbum:return n.data.text;case People.RecentActivity.Core.FeedEntryInfoType.video:return n.data.text;default:return""}};People.RecentActivity.Providers.SupProvider.prototype._getNotificationType$2=function(n){switch(n){case People.RecentActivity.Core.FeedObjectInfoType.entry:return People.RecentActivity.Core.NotificationInfoType.entry;case People.RecentActivity.Core.FeedObjectInfoType.photo:return People.RecentActivity.Core.NotificationInfoType.photo;case People.RecentActivity.Core.FeedObjectInfoType.photoAlbum:return People.RecentActivity.Core.NotificationInfoType.photoAlbum;default:return People.RecentActivity.Core.NotificationInfoType.none}};People.RecentActivity.Providers.SupProvider.prototype._getAnnotation$2=function(n,t){for(var r,i=0,u=n.annotations.length;i<u;i++)if(r=n.annotations[i],r.type===t)return r;return null};People.RecentActivity.Providers.DelayedRequest=function(n,t){this._creator=n;this._context=t};People.RecentActivity.Providers.DelayedRequest.createRequest=function(n,t){var i=t.authInfo;return i.status==People.RecentActivity.Platform.AuthenticationStatus.authenticated?n(t):new People.RecentActivity.Providers.DelayedRequest(n,t)};People.RecentActivity.Providers.DelayedRequest.prototype._creator=null;People.RecentActivity.Providers.DelayedRequest.prototype._context=null;People.RecentActivity.Providers.DelayedRequest.prototype._callback=null;People.RecentActivity.Providers.DelayedRequest.prototype._request=null;People.RecentActivity.Providers.DelayedRequest.prototype._canceled=false;People.RecentActivity.Providers.DelayedRequest.prototype.execute=function(n){var t=this._context.authInfo,i;t.status===People.RecentActivity.Platform.AuthenticationStatus.authenticated?(i=this._creator(this._context),i?(this._request=i,this._request.execute(n)):this._fail(People.RecentActivity.Core.ResultCode.failure,n)):t.status===People.RecentActivity.Platform.AuthenticationStatus.disconnected||t.status===People.RecentActivity.Platform.AuthenticationStatus.tokenRetrievalFailed?this._fail(People.RecentActivity.Core.ResultCode.invalidUserCredential,n):(this._callback=n,t.addListener("authenticationstatuschanged",this._onAuthenticated,this),t.status===People.RecentActivity.Platform.AuthenticationStatus.authenticatedPendingTokenRefresh&&t.refreshToken())};People.RecentActivity.Providers.DelayedRequest.prototype.cancel=function(){this._callback=null;this._canceled=true;this._context.authInfo.removeListenerSafe("authenticationstatuschanged",this._onAuthenticated,this);this._request!=null&&(this._request.cancel(),this._request=null)};People.RecentActivity.Providers.DelayedRequest.prototype._fail=function(n,t){var i=new People.RecentActivity.Core.ResultInfo(n),r=this._context.feedObject,u;r&&(i.errorMap[r.sourceId]=n);u=new People.RecentActivity.Providers.SocialHttpResponse(i,null,null,new People.RecentActivity.Providers.HttpResponse(0,"","",null,null),this._context);t(u)};People.RecentActivity.Providers.DelayedRequest.prototype._onAuthenticated=function(n){var t,i;this._canceled||(t=n.sender,Jx.log.write(4,People.Social.format("DelayedRequest.OnAuthenticated({0},{1})",t.userId.sourceId,t.status)),t.status===People.RecentActivity.Platform.AuthenticationStatus.authenticatedPendingTokenRefresh?t.refreshToken():(t.removeListenerSafe("authenticationstatuschanged",this._onAuthenticated,this),i=this._callback,this._callback=null,this.execute(i)))};People.RecentActivity.Providers.FacebookRequestFactory=function(){};People.RecentActivity.Providers.FacebookRequestFactory.prototype.createGetFeedRequest=function(n){return People.RecentActivity.Providers.DelayedRequest.createRequest(People.RecentActivity.Providers.FqlRequest.createGetFeedRequest,n)};People.RecentActivity.Providers.FacebookRequestFactory.prototype.createGetAlbumsRequest=function(n){return People.RecentActivity.Providers.DelayedRequest.createRequest(People.RecentActivity.Providers.FqlRequest.createGetAlbumsRequest,n)};People.RecentActivity.Providers.FacebookRequestFactory.prototype.createRefreshAlbumRequest=function(n){return People.RecentActivity.Providers.DelayedRequest.createRequest(People.RecentActivity.Providers.FqlRequest.createRefreshAlbumRequest,n)};People.RecentActivity.Providers.FacebookRequestFactory.prototype.createRefreshPhotoRequest=function(n){return People.RecentActivity.Providers.DelayedRequest.createRequest(People.RecentActivity.Providers.FqlRequest.createRefreshPhotoRequest,n)};People.RecentActivity.Providers.FacebookRequestFactory.prototype.createGetFeedObjectRequest=function(n){return People.RecentActivity.Providers.DelayedRequest.createRequest(People.RecentActivity.Providers.FqlRequest.createGetFeedObjectRequest,n)};People.RecentActivity.Providers.FacebookRequestFactory.prototype.createAddFeedObjectRequest=function(n){return People.RecentActivity.Providers.DelayedRequest.createRequest(People.RecentActivity.Providers.GraphRequest.createAddFeedObjectRequest,n)};People.RecentActivity.Providers.FacebookRequestFactory.prototype.createGetCommentsRequest=function(n){return People.RecentActivity.Providers.DelayedRequest.createRequest(People.RecentActivity.Providers.FqlRequest.createGetCommentsRequest,n)};People.RecentActivity.Providers.FacebookRequestFactory.prototype.createGetReactionsRequest=function(n){return People.RecentActivity.Providers.DelayedRequest.createRequest(People.RecentActivity.Providers.FqlRequest.createGetReactionsRequest,n)};People.RecentActivity.Providers.FacebookRequestFactory.prototype.createAddCommentRequest=function(n){return People.RecentActivity.Providers.DelayedRequest.createRequest(People.RecentActivity.Providers.GraphRequest.createAddCommentRequest,n)};People.RecentActivity.Providers.FacebookRequestFactory.prototype.createAddReactionRequest=function(n){return People.RecentActivity.Providers.DelayedRequest.createRequest(People.RecentActivity.Providers.GraphRequest.createAddReactionRequest,n)};People.RecentActivity.Providers.FacebookRequestFactory.prototype.createRemoveReactionRequest=function(n){return People.RecentActivity.Providers.DelayedRequest.createRequest(People.RecentActivity.Providers.GraphRequest.createRemoveReactionRequest,n)};People.RecentActivity.Providers.FacebookRequestFactory.prototype.createRefreshNotificationsRequest=function(n){return People.RecentActivity.Providers.DelayedRequest.createRequest(People.RecentActivity.Providers.FqlRequest.createRefreshNotificationsRequest,n)};People.RecentActivity.Providers.FacebookRequestFactory.prototype.createMarkNotificationsReadRequest=function(n){return People.RecentActivity.Providers.DelayedRequest.createRequest(People.RecentActivity.Providers.LegacyRestRequest.createMarkNotificationsReadRequest,n)};People.RecentActivity.Providers.FacebookRequestFactory.prototype.createGetUnreadNotificationsCountRequest=function(n){return People.RecentActivity.Providers.DelayedRequest.createRequest(People.RecentActivity.Providers.FqlRequest.createGetUnreadNotificationsCountRequest,n)};People.RecentActivity.Providers.SupRequestFactory=function(){};People.RecentActivity.Providers.SupRequestFactory.prototype.createGetFeedRequest=function(n){return People.RecentActivity.Providers.DelayedRequest.createRequest(People.RecentActivity.Providers.SupRequest.createGetFeedRequest,n)};People.RecentActivity.Providers.SupRequestFactory.prototype.createGetAlbumsRequest=function(){throw new Error("Not Supported!")};People.RecentActivity.Providers.SupRequestFactory.prototype.createRefreshAlbumRequest=function(){throw new Error("Not Supported!")};People.RecentActivity.Providers.SupRequestFactory.prototype.createRefreshPhotoRequest=function(){throw new Error("Not Supported!")};People.RecentActivity.Providers.SupRequestFactory.prototype.createGetFeedObjectRequest=function(n){return People.RecentActivity.Providers.DelayedRequest.createRequest(People.RecentActivity.Providers.SupRequest.createGetFeedObjectRequest,n)};People.RecentActivity.Providers.SupRequestFactory.prototype.createAddFeedObjectRequest=function(n){return People.RecentActivity.Providers.DelayedRequest.createRequest(People.RecentActivity.Providers.ShareAnythingRequest.createAddFeedObjectRequest,n)};People.RecentActivity.Providers.SupRequestFactory.prototype.createGetCommentsRequest=function(n){return People.RecentActivity.Providers.DelayedRequest.createRequest(People.RecentActivity.Providers.SupRequest.createGetCommentsRequest,n)};People.RecentActivity.Providers.SupRequestFactory.prototype.createGetReactionsRequest=function(n){return People.RecentActivity.Providers.DelayedRequest.createRequest(People.RecentActivity.Providers.SupRequest.createGetReactionsRequest,n)};People.RecentActivity.Providers.SupRequestFactory.prototype.createAddCommentRequest=function(n){return People.RecentActivity.Providers.DelayedRequest.createRequest(People.RecentActivity.Providers.SupRequest.createAddCommentRequest,n)};People.RecentActivity.Providers.SupRequestFactory.prototype.createAddReactionRequest=function(n){return People.RecentActivity.Providers.DelayedRequest.createRequest(People.RecentActivity.Providers.SupRequest.createAddReactionRequest,n)};People.RecentActivity.Providers.SupRequestFactory.prototype.createRemoveReactionRequest=function(n){return People.RecentActivity.Providers.DelayedRequest.createRequest(People.RecentActivity.Providers.SupRequest.createRemoveReactionRequest,n)};People.RecentActivity.Providers.SupRequestFactory.prototype.createRefreshNotificationsRequest=function(n){return People.RecentActivity.Providers.DelayedRequest.createRequest(People.RecentActivity.Providers.SupRequest.createRefreshNotificationsRequest,n)};People.RecentActivity.Providers.SupRequestFactory.prototype.createMarkNotificationsReadRequest=function(){throw new Error("Not Supported!")};People.RecentActivity.Providers.SupRequestFactory.prototype.createGetUnreadNotificationsCountRequest=function(n){return People.RecentActivity.Providers.DelayedRequest.createRequest(People.RecentActivity.Providers.SupRequest.createRefreshNotificationsRequest,n)};People.RecentActivity.Providers.SocialHttpRequest=function(n,t,i){t!=null&&(this._httpRequest=new People.RecentActivity.Providers.HttpRequest(n,t),this.addHeader("If-Modified-Since","Sat, 1 Jan 2000 00:00:00 GMT"));this._requestContext=i};People.RecentActivity.Providers.SocialHttpRequest.prototype._httpRequest=null;People.RecentActivity.Providers.SocialHttpRequest.prototype._requestContext=null;People.RecentActivity.Providers.SocialHttpRequest.prototype._canceled=false;Object.defineProperty(People.RecentActivity.Providers.SocialHttpRequest.prototype,"body",{get:function(){return this._httpRequest.body},set:function(n){this._httpRequest.body=n}});Object.defineProperty(People.RecentActivity.Providers.SocialHttpRequest.prototype,"requestContext",{get:function(){return this._requestContext}});Object.defineProperty(People.RecentActivity.Providers.SocialHttpRequest.prototype,"canceled",{get:function(){return this._canceled}});People.RecentActivity.Providers.SocialHttpRequest.prototype.addHeader=function(n,t){this._httpRequest.addHeader(n,t)};People.RecentActivity.Providers.SocialHttpRequest.prototype.execute=function(n){var f=this._requestContext.authInfo.status,t,i,u;f!==People.RecentActivity.Platform.AuthenticationStatus.authenticated?(t=new People.RecentActivity.Providers.SocialHttpResponse(new People.RecentActivity.Core.ResultInfo(People.RecentActivity.Core.ResultCode.invalidUserCredential),null,null,new People.RecentActivity.Providers.HttpResponse(0,"","",null,null),this._requestContext),t.subErrorCode=f,this._requestContext.errorType=r.client,this._reportInstrumentation(t,0),n(t)):(this._requestContext.startTime=new Date,i=this.body,u=i!=null?i.length:0,this._requestContext.requestSizeInBytes=u,this._requestContext.scenarioSizeInBytes=this._requestContext.scenarioSizeInBytes+u,this._httpRequest.execute(this.onResponseReceived.bind(this),n))};People.RecentActivity.Providers.SocialHttpRequest.prototype.cancel=function(){this._canceled=true};People.RecentActivity.Providers.SocialHttpRequest.prototype.onResponseReceived=function(n){var t=this,f,i,u;try{f=Jx.root.getJobSet()}catch(e){Jx.log.write(2,People.Social.format("SocialHttpRquest.OnResponseReceived(): Fail to get job set! The app might be shutting down: {0}",e.message));return}(i=(new Date).getTime()-this._requestContext.startTime.getTime(),this._requestContext.scenarioDuration=this._requestContext.scenarioDuration+i,this._requestContext.errorType=r.success,u=n.userState,u==null||this._canceled)||f.addUIJob(null,function(){var o,f,e;o=n.status===200||n.status===201||n.status===204?People.RecentActivity.Core.ResultCode.success:n.status===401||n.status===403?People.RecentActivity.Core.ResultCode.invalidUserCredential:People.RecentActivity.Core.ResultCode.failure;f=new People.RecentActivity.Providers.SocialHttpResponse(new People.RecentActivity.Core.ResultInfo(o),null,null,n,t._requestContext);t._requestContext.serializer.deserialize(f,t._requestContext.expectedResponseFormat,t._requestContext.expectedResponse);f.success||(e=f.resultInfo,e.errorMap[t._requestContext.authInfo.userId.sourceId]=e.code,t._requestContext.errorType=r.fault);t._reportInstrumentation(f,i);u(f)},null,People.Priority.socialData)};People.RecentActivity.Providers.SocialHttpRequest.prototype.reportScenario=function(){var t=this._requestContext;t.scenarioId!==n.unknown&&People.RecentActivity.Core.BiciHelper.recordScenarioQos(t.scenarioId,t.scenarioDuration,t.scenarioSizeInBytes,t.errorCode,t.errorType,null)};People.RecentActivity.Providers.SocialHttpRequest.prototype._reportInstrumentation=function(r,u){var f=this._requestContext,e=f.authInfo.userId.sourceId;f.errorCode=this._getHResult(r);this._requestContext.thirdPartyApiName!==People.RecentActivity.Core.BiciThirdPartyApiCallNames.unknown&&People.RecentActivity.Core.BiciHelper.createThirdPartyAPICallDatapoint(e,f.thirdPartyApiName,r.status,f.thirdPartyScenarioType);this._requestContext.liveCommApiName!==People.RecentActivity.Core.BiciLiveCommApiNames.none&&People.RecentActivity.Core.BiciHelper.createHttpCallCompleteDatapoint(e,f.liveCommApiName,f.errorCode,u);f.propertyId!==i.unknown&&f.scenarioId!==n.unknown&&f.apiId!==t.unknown&&People.RecentActivity.Core.BiciHelper.recordDependentApiQos(f.scenarioId,f.apiId,f.propertyId,u,f.requestSizeInBytes,f.errorCode,f.errorType,null);this._requestContext.scenarioComplete&&!this._requestContext.isAggregated&&this.reportScenario()};People.RecentActivity.Providers.SocialHttpRequest.prototype._getHResult=function(n){if(n.success)return 0;var t=n.status,i=isNaN(n.subErrorCode)?0:n.subErrorCode;return(2264924160|16777215&Math.max(0,Math.min(t,999))*1e4+Math.max(0,Math.min(i,9999)))>>>0};People.RecentActivity.Providers.ShareAnythingRequest=function(n,t,i){People.RecentActivity.Providers.SocialHttpRequest.call(this,n,t,i);this.addHeader("Authorization","WLID1.0 "+i.authInfo.token);this.addHeader("AppId",People.RecentActivity.Platform.Configuration.instance.shareAnythingApiAppId)};Jx.inherit(People.RecentActivity.Providers.ShareAnythingRequest,People.RecentActivity.Providers.SocialHttpRequest);People.RecentActivity.Providers.ShareAnythingRequest._shareAnythingPathFormat$1="users({0})/{1}";People.RecentActivity.Providers.ShareAnythingRequest.createAddFeedObjectRequest=function(r){r.liveCommApiName=People.RecentActivity.Core.BiciLiveCommApiNames.shareAnythingPostActivity;r.propertyId=i.shareAnything;r.scenarioId=n.modernPeople_PostShare;r.apiId=t.shareAnything_Status;r.expectedResponseFormat=3;var u=new People.RecentActivity.Providers.ShareAnythingRequest(1,People.RecentActivity.Providers.ShareAnythingRequest._getUrl$1("status"),r);return u.addHeader("Content-Type","application/atom+xml"),u.body=r.serializer.serialize(r.feedObject,13),u};People.RecentActivity.Providers.ShareAnythingRequest._getUrl$1=function(n){var t=People.RecentActivity.Platform.Platform.instance.getUserPersonCid();return new People.RecentActivity.Providers.Uri(People.RecentActivity.Platform.Configuration.instance.shareAnythingApiRootUrl,People.Social.format("users({0})/{1}",t,n))};People.RecentActivity.Providers.FqlRequest=function(n,t,i){People.RecentActivity.Providers.SocialHttpRequest.call(this,n,t,i)};Jx.inherit(People.RecentActivity.Providers.FqlRequest,People.RecentActivity.Providers.SocialHttpRequest);People.RecentActivity.Providers.FqlRequest.feedInfoQuery="feedInfo";People.RecentActivity.Providers.FqlRequest.commentsInfoQuery="commentsInfo";People.RecentActivity.Providers.FqlRequest.likesInfoQuery="likesInfo";People.RecentActivity.Providers.FqlRequest.notificationsInfoQuery="notificationsInfo";People.RecentActivity.Providers.FqlRequest.profileInfoQuery="profileInfo";People.RecentActivity.Providers.FqlRequest.albumInfoQuery="albumInfo";People.RecentActivity.Providers.FqlRequest.photoInfoQuery="photoInfo";People.RecentActivity.Providers.FqlRequest.photoTagInfoQuery="photoTagInfo";People.RecentActivity.Providers.FqlRequest.query="q";People.RecentActivity.Providers.FqlRequest._queryPath$1="fql";People.RecentActivity.Providers.FqlRequest._profileSelect$1="id, name, pic_square";People.RecentActivity.Providers.FqlRequest._feedEntrySelect$1="post_id, actor_id, target_id, message, created_time, attribution, attachment, comment_info, likes, permalink, tagged_ids, message_tags, type";People.RecentActivity.Providers.FqlRequest._feedEntrySelectWhatsNewTemplate$1="SELECT {0} FROM stream WHERE filter_key in (SELECT filter_key FROM stream_filter WHERE uid=me() AND type='newsfeed') AND {1} AND {2}";People.RecentActivity.Providers.FqlRequest._feedEntrySelectRecentActivityTemplate$1="SELECT {0} FROM stream WHERE source_id = {1} AND {2}";People.RecentActivity.Providers.FqlRequest._albumSelect$1="aid, owner, cover_pid, name, modified, description, size, link, object_id, like_info, comment_info";People.RecentActivity.Providers.FqlRequest._photoSelect$1="pid, aid, owner, link, caption, object_id, created, src_small, src_small_height, src_small_width, src, src_height, src_width, src_big, src_big_height, src_big_width, like_info, comment_info";People.RecentActivity.Providers.FqlRequest._commentSelect$1="fromid, time, text, id";People.RecentActivity.Providers.FqlRequest._commentSelectTemplate$1='"{0}":"SELECT {1} FROM comment WHERE {2} = \'{3}\' ORDER BY time DESC","{4}":"SELECT {5} FROM profile WHERE id IN (SELECT fromid FROM #{0})"';People.RecentActivity.Providers.FqlRequest._getFeedQueryTemplate$1='"{0}":"{1}","{2}":"SELECT {3} FROM profile WHERE id IN (SELECT actor_id, target_id, tagged_ids, likes.sample, likes.friends FROM #{0})"';People.RecentActivity.Providers.FqlRequest._refreshAlbumsQueryTemplate$1='"{0}":"SELECT {1} FROM album WHERE owner = {2} ORDER BY created DESC","{3}":"SELECT {4} FROM photo WHERE pid IN (SELECT cover_pid FROM #{0})"';People.RecentActivity.Providers.FqlRequest._refreshAlbumQueryTemplate$1='"{0}":"SELECT {1} FROM photo WHERE aid = \'{2}\' ORDER BY created DESC LIMIT 300","{3}":"SELECT {4} FROM album WHERE aid = \'{2}\'"';People.RecentActivity.Providers.FqlRequest._getAlbumQueryTemplate$1='"{0}":"SELECT {1} FROM album WHERE {2} = \'{3}\' OR object_id = {3}","{4}":"SELECT {5} FROM photo WHERE pid IN (SELECT cover_pid FROM #{0})","{6}":"SELECT {7}, object_id FROM comment WHERE object_id IN (SELECT object_id FROM #{0}) ORDER BY time DESC","{8}":"SELECT user_id, object_id FROM like WHERE object_id IN (SELECT object_id FROM #{0})","{9}":"SELECT {10} FROM profile WHERE id IN (SELECT fromid FROM #{6}) OR id IN (SELECT user_id FROM #{8})"';People.RecentActivity.Providers.FqlRequest._getPhotoQueryTemplate$1='"{0}":"SELECT {1} FROM photo WHERE {2} = \'{3}\' OR object_id = {3}","{4}":"SELECT {5}, object_id FROM comment WHERE object_id IN (SELECT object_id FROM #{0}) ORDER BY time DESC","{6}":"SELECT user_id, object_id FROM like WHERE object_id IN (SELECT object_id FROM #{0})","{7}":"SELECT {8} FROM profile WHERE id IN (SELECT fromid FROM #{4}) OR id IN (SELECT user_id FROM #{6})"';People.RecentActivity.Providers.FqlRequest._refreshPhotoQueryTemplate$1='"{0}":"SELECT subject, xcoord, ycoord, created FROM photo_tag WHERE pid = \'{1}\'","{2}":"SELECT {3} FROM profile WHERE id IN (SELECT subject FROM #{0})","{4}":"SELECT {5} FROM photo WHERE pid = \'{1}\'"';People.RecentActivity.Providers.FqlRequest._excludedAppStoryDomains$1=["http://apps.facebook.com","https://apps.facebook.com","http://zynga.com","http://www.zynga.com"];People.RecentActivity.Providers.FqlRequest.createGetFeedRequest=function(r){var f;var e=People.RecentActivity.Providers.FqlRequest.getBaseUrl(r,true),u=null,o=r.contactIdMap[People.RecentActivity.Core.NetworkId.facebook];return r.scenarioComplete=false,r.propertyId=i.facebook,r.thirdPartyScenarioType=People.RecentActivity.Core.BiciThirdPartyScenarioType.feeds,f=r.feedTimeOffset,o.id===People.RecentActivity.Platform.Configuration.instance.whatsNewPersonId?(r.apiId=t.facebook_Fql_Multiquery_GetActivities,f===-1?(r.liveCommApiName=People.RecentActivity.Core.BiciLiveCommApiNames.fqlGetContactsActivities,r.thirdPartyApiName=People.RecentActivity.Core.BiciThirdPartyApiCallNames.fqlGetContactsActivities,r.scenarioId=n.modernPeople_GetWhatsNewActivities):(r.liveCommApiName=People.RecentActivity.Core.BiciLiveCommApiNames.fqlGetMoreContactsActivities,r.thirdPartyApiName=People.RecentActivity.Core.BiciThirdPartyApiCallNames.fqlGetMoreContactsActivities,r.scenarioId=n.modernPeople_GetMoreWhatsNewActivities),u=People.Social.format("SELECT {0} FROM stream WHERE filter_key in (SELECT filter_key FROM stream_filter WHERE uid=me() AND type='newsfeed') AND {1} AND {2}","post_id, actor_id, target_id, message, created_time, attribution, attachment, comment_info, likes, permalink, tagged_ids, message_tags, type",People.RecentActivity.Providers.FqlRequest._getEntryFilter$1(),People.RecentActivity.Providers.FqlRequest._getAppStoryFilter$1())):(r.apiId=t.facebook_Fql_Multiquery_GetContactsActivities,f===-1?(r.liveCommApiName=People.RecentActivity.Core.BiciLiveCommApiNames.fqlGetActivities,r.thirdPartyApiName=People.RecentActivity.Core.BiciThirdPartyApiCallNames.fqlGetActivities,r.scenarioId=n.modernPeople_GetRecentActivities):(r.liveCommApiName=People.RecentActivity.Core.BiciLiveCommApiNames.fqlGetMoreActivities,r.thirdPartyApiName=People.RecentActivity.Core.BiciThirdPartyApiCallNames.fqlGetMoreActivities,r.scenarioId=n.modernPeople_GetMoreRecentActivities),u=People.Social.format("SELECT {0} FROM stream WHERE source_id = {1} AND {2}","post_id, actor_id, target_id, message, created_time, attribution, attachment, comment_info, likes, permalink, tagged_ids, message_tags, type",o.id,People.RecentActivity.Providers.FqlRequest._getEntryFilter$1())),r.feedTimeOffset>0&&(u+=" AND created_time < ",u+=r.feedTimeOffset/1e3),u+=" ORDER BY created_time DESC ",u+=" LIMIT "+People.RecentActivity.Platform.Configuration.instance.feedEntriesBatchSize,u=People.Social.format(People.RecentActivity.Providers.FqlRequest._getFeedQueryTemplate$1,"feedInfo",u,"profileInfo","id, name, pic_square"),e.addQueryParameter("q","{"+u+"}"),new People.RecentActivity.Providers.FbGetFeedRequest(0,e,r)};People.RecentActivity.Providers.FqlRequest.createGetAlbumsRequest=function(r){var u=People.RecentActivity.Providers.FqlRequest.getBaseUrl(r,true),f=People.Social.format(People.RecentActivity.Providers.FqlRequest._refreshAlbumsQueryTemplate$1,"albumInfo","aid, owner, cover_pid, name, modified, description, size, link, object_id, like_info, comment_info",r.contactIdMap[People.RecentActivity.Core.NetworkId.facebook].id,"photoInfo","pid, aid, owner, link, caption, object_id, created, src_small, src_small_height, src_small_width, src, src_height, src_width, src_big, src_big_height, src_big_width, like_info, comment_info");return u.addQueryParameter("q","{"+f+"}"),r.liveCommApiName=People.RecentActivity.Core.BiciLiveCommApiNames.fqlGetAlbums,r.thirdPartyApiName=People.RecentActivity.Core.BiciThirdPartyApiCallNames.fqlGetAlbums,r.thirdPartyScenarioType=People.RecentActivity.Core.BiciThirdPartyScenarioType.photos,r.propertyId=i.facebook,r.scenarioId=n.modernPeople_GetAlbums,r.apiId=t.facebook_Fql_Multiquery_GetAlbums,new People.RecentActivity.Providers.FqlRequest(0,u,r)};People.RecentActivity.Providers.FqlRequest.createRefreshAlbumRequest=function(r){var f=r.feedObject.data,u=People.RecentActivity.Providers.FqlRequest.getBaseUrl(r,true),e=People.Social.format(People.RecentActivity.Providers.FqlRequest._refreshAlbumQueryTemplate$1,"photoInfo","pid, aid, owner, link, caption, object_id, created, src_small, src_small_height, src_small_width, src, src_height, src_width, src_big, src_big_height, src_big_width, like_info, comment_info",f.id,"albumInfo","aid, owner, cover_pid, name, modified, description, size, link, object_id, like_info, comment_info");return u.addQueryParameter("q","{"+e+"}"),r.liveCommApiName=People.RecentActivity.Core.BiciLiveCommApiNames.fqlGetPhotos,r.thirdPartyApiName=People.RecentActivity.Core.BiciThirdPartyApiCallNames.fqlGetPhotos,r.thirdPartyScenarioType=People.RecentActivity.Core.BiciThirdPartyScenarioType.photos,r.propertyId=i.facebook,r.scenarioId=n.modernPeople_GetPhotos,r.apiId=t.facebook_Fql_Multiquery_GetPhotos,new People.RecentActivity.Providers.FqlRequest(0,u,r)};People.RecentActivity.Providers.FqlRequest.createRefreshPhotoRequest=function(r){var f=r.feedObject.data,u=People.RecentActivity.Providers.FqlRequest.getBaseUrl(r,true),e=People.Social.format(People.RecentActivity.Providers.FqlRequest._refreshPhotoQueryTemplate$1,"photoTagInfo",f.id,"profileInfo","id, name, pic_square","photoInfo","pid, aid, owner, link, caption, object_id, created, src_small, src_small_height, src_small_width, src, src_height, src_width, src_big, src_big_height, src_big_width, like_info, comment_info");return u.addQueryParameter("q","{"+e+"}"),r.liveCommApiName=People.RecentActivity.Core.BiciLiveCommApiNames.fqlGetPhoto,r.thirdPartyApiName=People.RecentActivity.Core.BiciThirdPartyApiCallNames.fqlGetPhoto,r.thirdPartyScenarioType=People.RecentActivity.Core.BiciThirdPartyScenarioType.photos,r.propertyId=i.facebook,r.scenarioId=n.modernPeople_GetPhoto,r.apiId=t.facebook_Fql_Multiquery_GetPhoto,new People.RecentActivity.Providers.FqlRequest(0,u,r)};People.RecentActivity.Providers.FqlRequest.createGetFeedObjectRequest=function(r){var u=r.feedObject,f,e;f=null;switch(u.type){case People.RecentActivity.Core.FeedObjectInfoType.entry:f=People.Social.format(People.RecentActivity.Providers.FqlRequest._getFeedQueryTemplate$1,"feedInfo",People.Social.format("SELECT {0} FROM stream WHERE post_id = '{1}'","post_id, actor_id, target_id, message, created_time, attribution, attachment, comment_info, likes, permalink, tagged_ids, message_tags, type",u.id),"profileInfo","id, name, pic_square");r.expectedResponse=1;r.liveCommApiName=People.RecentActivity.Core.BiciLiveCommApiNames.fqlGetActivity;r.thirdPartyApiName=People.RecentActivity.Core.BiciThirdPartyApiCallNames.fqlGetActivity;r.thirdPartyScenarioType=People.RecentActivity.Core.BiciThirdPartyScenarioType.feeds;r.propertyId=i.facebook;r.scenarioId=n.modernPeople_GetActivity;r.apiId=t.facebook_Fql_Multiquery_GetActivity;break;case People.RecentActivity.Core.FeedObjectInfoType.photoAlbum:f=People.Social.format(People.RecentActivity.Providers.FqlRequest._getAlbumQueryTemplate$1,"albumInfo","aid, owner, cover_pid, name, modified, description, size, link, object_id, like_info, comment_info","aid",u.id,"photoInfo","pid, aid, owner, link, caption, object_id, created, src_small, src_small_height, src_small_width, src, src_height, src_width, src_big, src_big_height, src_big_width, like_info, comment_info","commentsInfo","fromid, time, text, id","likesInfo","profileInfo","id, name, pic_square");r.expectedResponse=7;r.liveCommApiName=People.RecentActivity.Core.BiciLiveCommApiNames.fqlGetAlbum;r.thirdPartyApiName=People.RecentActivity.Core.BiciThirdPartyApiCallNames.fqlGetAlbum;r.thirdPartyScenarioType=People.RecentActivity.Core.BiciThirdPartyScenarioType.photos;r.propertyId=i.facebook;r.scenarioId=n.modernPeople_GetAlbum;r.apiId=t.facebook_Fql_Multiquery_GetAlbum;break;case People.RecentActivity.Core.FeedObjectInfoType.photo:f=People.Social.format(People.RecentActivity.Providers.FqlRequest._getPhotoQueryTemplate$1,"photoInfo","pid, aid, owner, link, caption, object_id, created, src_small, src_small_height, src_small_width, src, src_height, src_width, src_big, src_big_height, src_big_width, like_info, comment_info","pid",u.id,"commentsInfo","fromid, time, text, id","likesInfo","profileInfo","id, name, pic_square");r.expectedResponse=8;r.liveCommApiName=People.RecentActivity.Core.BiciLiveCommApiNames.fqlGetPhoto;r.thirdPartyApiName=People.RecentActivity.Core.BiciThirdPartyApiCallNames.fqlGetPhoto;r.thirdPartyScenarioType=People.RecentActivity.Core.BiciThirdPartyScenarioType.photos;r.propertyId=i.facebook;r.scenarioId=n.modernPeople_GetPhoto;r.apiId=t.facebook_Fql_Multiquery_GetPhoto}return e=People.RecentActivity.Providers.FqlRequest.getBaseUrl(r,true),e.addQueryParameter("q","{"+f+"}"),u.type===People.RecentActivity.Core.FeedObjectInfoType.entry?new People.RecentActivity.Providers.FbGetFeedRequest(0,e,r):new People.RecentActivity.Providers.FqlRequest(0,e,r)};People.RecentActivity.Providers.FqlRequest.createGetCommentsRequest=function(r){var f=People.Social.format(People.RecentActivity.Providers.FqlRequest._commentSelectTemplate$1,"commentsInfo","fromid, time, text, id",r.feedObject.type===People.RecentActivity.Core.FeedObjectInfoType.entry?"post_id":"object_id",r.feedObject.id,"profileInfo","id, name, pic_square"),u=People.RecentActivity.Providers.FqlRequest.getBaseUrl(r,true);return u.addQueryParameter("q","{"+f+"}"),r.liveCommApiName=People.RecentActivity.Core.BiciLiveCommApiNames.fqlGetComments,r.thirdPartyApiName=People.RecentActivity.Core.BiciThirdPartyApiCallNames.fqlGetComments,r.thirdPartyScenarioType=People.RecentActivity.Core.BiciThirdPartyScenarioType.readActivityReactions,r.propertyId=i.facebook,r.scenarioId=n.modernPeople_GetComments,r.apiId=t.facebook_Fql_Multiquery_GetComments,new People.RecentActivity.Providers.FqlRequest(0,u,r)};People.RecentActivity.Providers.FqlRequest.createGetReactionsRequest=function(r){var f=People.Social.format('"{0}":"SELECT user_id FROM like WHERE {1} = \'{2}\'","{3}":"SELECT {4} FROM profile WHERE id IN (SELECT user_id FROM #{0})"',"likesInfo",r.feedObject.type===People.RecentActivity.Core.FeedObjectInfoType.entry?"post_id":"object_id",r.feedObject.id,"profileInfo","id, name, pic_square"),u=People.RecentActivity.Providers.FqlRequest.getBaseUrl(r,true);return u.addQueryParameter("q","{"+f+"}"),r.liveCommApiName=People.RecentActivity.Core.BiciLiveCommApiNames.fqlGetLikes,r.thirdPartyApiName=People.RecentActivity.Core.BiciThirdPartyApiCallNames.fqlGetLikes,r.thirdPartyScenarioType=People.RecentActivity.Core.BiciThirdPartyScenarioType.readActivityReactions,r.propertyId=i.facebook,r.scenarioId=n.modernPeople_GetReactions,r.apiId=t.facebook_Fql_MultiQuery_GetLikes,new People.RecentActivity.Providers.FqlRequest(0,u,r)};People.RecentActivity.Providers.FqlRequest.createRefreshNotificationsRequest=function(r){var f=People.Social.format('"{0}":"SELECT notification_id, sender_id, updated_time, title_text, href, is_unread, object_id, object_type FROM notification WHERE recipient_id = me() AND is_hidden = 0","{1}":"SELECT id, name, pic_square FROM profile WHERE id IN (SELECT sender_id FROM #{0})"',"notificationsInfo","profileInfo"),u=People.RecentActivity.Providers.FqlRequest.getBaseUrl(r,true);return u.addQueryParameter("q","{"+f+"}"),r.liveCommApiName=People.RecentActivity.Core.BiciLiveCommApiNames.fqlGetNotifications,r.thirdPartyApiName=People.RecentActivity.Core.BiciThirdPartyApiCallNames.fqlGetNotifications,r.thirdPartyScenarioType=People.RecentActivity.Core.BiciThirdPartyScenarioType.readNotifications,r.propertyId=i.facebook,r.scenarioId=n.modernPeople_GetNotifications,r.apiId=t.facebook_Fql_Multiquery_GetSocialNotifications,r.scenarioComplete=false,new People.RecentActivity.Providers.FbGetNotificationsRequest(0,u,r)};People.RecentActivity.Providers.FqlRequest.createGetUnreadNotificationsCountRequest=function(r){var u=People.RecentActivity.Providers.FqlRequest.getBaseUrl(r,false);return u.addQueryParameter("q","SELECT '' FROM notification WHERE recipient_id = me() AND is_unread = 1 AND is_hidden = 0"),r.liveCommApiName=People.RecentActivity.Core.BiciLiveCommApiNames.fqlGetUnreadNotificationCount,r.thirdPartyApiName=People.RecentActivity.Core.BiciThirdPartyApiCallNames.fqlGetUnreadNotificationCount,r.thirdPartyScenarioType=People.RecentActivity.Core.BiciThirdPartyScenarioType.readNotifications,r.propertyId=i.facebook,r.scenarioId=n.modernPeople_GetUnreadNotificationsCount,r.apiId=t.facebook_Fql_Query_GetUnreadNotificationCount,new People.RecentActivity.Providers.FqlRequest(0,u,r)};People.RecentActivity.Providers.FqlRequest.getBaseUrl=function(n){var t=new People.RecentActivity.Providers.Uri(People.RecentActivity.Platform.Configuration.instance.fqlRootUrl,"fql"),i=n.authInfo;return t.addQueryParameter("access_token",i.token),t};People.RecentActivity.Providers.FqlRequest._getAppStoryFilter$1=function(){var n=People.RecentActivity.Providers.FqlRequest._excludedAppStoryDomains$1.map(function(n){var t=n;return People.Social.format("substr(attachment.href, 0, {0}) = '{1}'",t.length,t)});return People.Social.format("NOT ((type = 237 OR type = 272) AND ({0}))",n.join(" OR "))};People.RecentActivity.Providers.FqlRequest._getEntryFilter$1=function(){return"NOT (permalink = '')"};People.RecentActivity.Providers.FbGetFeedRequest=function(n,t,i){People.RecentActivity.Providers.FqlRequest.call(this,n,t,i)};Jx.inherit(People.RecentActivity.Providers.FbGetFeedRequest,People.RecentActivity.Providers.FqlRequest);People.RecentActivity.Providers.FbGetFeedRequest._albumInfoMultiQueryTemplate$2='"{0}":"SELECT aid, owner, cover_pid, name, modified, description, size, link, object_id, comment_info, like_info FROM album WHERE aid IN ({1})",';People.RecentActivity.Providers.FbGetFeedRequest._photoInfoMultiQueryTemplate$2='"{0}":"SELECT pid, aid, owner, link, caption, object_id, created, src_small, src_small_height, src_small_width, src, src_height, src_width, src_big, src_big_height, src_big_width, comment_info, like_info FROM photo WHERE pid IN ({1})",';People.RecentActivity.Providers.FbGetFeedRequest._multiQueryTemplate$2='"{0}":"{1}"';People.RecentActivity.Providers.FbGetFeedRequest._contactInfoQueryTemplate$2="SELECT id, name, pic_square FROM profile WHERE id IN ({0})";People.RecentActivity.Providers.FbGetFeedRequest._ownerSubQuery$2="SELECT owner FROM #";People.RecentActivity.Providers.FbGetFeedRequest.prototype._callback$2=null;People.RecentActivity.Providers.FbGetFeedRequest.prototype._feedResponse$2=null;People.RecentActivity.Providers.FbGetFeedRequest.prototype._feedInfoRequest$2=null;People.RecentActivity.Providers.FbGetFeedRequest.prototype.execute=function(n){n!=null&&(this._callback$2=n,this.onExecute())};People.RecentActivity.Providers.FbGetFeedRequest.prototype.cancel=function(){this._feedInfoRequest$2!=null&&this._feedInfoRequest$2.cancel();People.RecentActivity.Providers.FqlRequest.prototype.cancel.call(this)};People.RecentActivity.Providers.FbGetFeedRequest.prototype.onExecute=function(){People.RecentActivity.Providers.FqlRequest.prototype.execute.call(this,this.onFeedEntriesRetrieved.bind(this))};People.RecentActivity.Providers.FbGetFeedRequest.prototype.onFeedEntriesRetrieved=function(n){var i=n.data,u,r;if(!n.success||i==null||!i.length){this.reportScenario();this._callback$2(n);return}if(this.requestContext.requestState==null){this._populateEntityInfo$2(i);this.reportScenario();this._callback$2(n);return}this._feedResponse$2=n;u=this.requestContext.contactIdMap[People.RecentActivity.Core.NetworkId.facebook];r=this.requestContext.feedTimeOffset;u.id===People.RecentActivity.Platform.Configuration.instance.whatsNewPersonId?r===-1?(this.requestContext.liveCommApiName=People.RecentActivity.Core.BiciLiveCommApiNames.fqlGetContactsActivities2,this.requestContext.thirdPartyApiName=People.RecentActivity.Core.BiciThirdPartyApiCallNames.fqlGetContactsActivities2):(this.requestContext.liveCommApiName=People.RecentActivity.Core.BiciLiveCommApiNames.fqlGetMoreContactsActivities2,this.requestContext.thirdPartyApiName=People.RecentActivity.Core.BiciThirdPartyApiCallNames.fqlGetMoreContactsActivities2):r===-1?(this.requestContext.liveCommApiName=People.RecentActivity.Core.BiciLiveCommApiNames.fqlGetActivities2,this.requestContext.thirdPartyApiName=People.RecentActivity.Core.BiciThirdPartyApiCallNames.fqlGetActivities2):(this.requestContext.liveCommApiName=People.RecentActivity.Core.BiciLiveCommApiNames.fqlGetMoreActivities2,this.requestContext.thirdPartyApiName=People.RecentActivity.Core.BiciThirdPartyApiCallNames.fqlGetMoreActivities2);this.requestContext.thirdPartyScenarioType=People.RecentActivity.Core.BiciThirdPartyScenarioType.feeds;this.requestContext.apiId=t.facebook_Fql_Multiquery_GetPhotosAlbumsVideos;this._feedInfoRequest$2=this.createGetFeedInfoRequest(this.requestContext);this._feedInfoRequest$2.execute(this._onMoreFeedInfoRetrieved$2.bind(this))};People.RecentActivity.Providers.FbGetFeedRequest.prototype.createGetFeedInfoRequest=function(n){var t=n.requestState;var i=t[0],r=t[1],u=this._getUrl$2(n,r,i);n.expectedResponse=11;n.scenarioComplete=true;return this.onCreateGetFeedInfoRequest(u,n)};People.RecentActivity.Providers.FbGetFeedRequest.prototype.onCreateGetFeedInfoRequest=function(n,t){return new People.RecentActivity.Providers.SocialHttpRequest(0,n,t)};People.RecentActivity.Providers.FbGetFeedRequest.prototype._onMoreFeedInfoRetrieved$2=function(){this._populateEntityInfo$2(this._feedResponse$2.data);this._callback$2(this._feedResponse$2)};People.RecentActivity.Providers.FbGetFeedRequest.prototype._populateEntityInfo$2=function(n){for(var s,i,f,r,h,o,t,e,u=0;u<n.length;u++)if(s=n[u],i=s.data,i.entities!=null&&i.entities.length)for(i.entities=i.entities.filter(function(n){var t=n,i;return t.type!==People.RecentActivity.Core.EntityInfoType.contact?true:(i=t.data,!Jx.isNonEmptyString(i.name))?false:t.offset>=0}),People.RecentActivity.Providers.EntityHelper.sortEntities(i.entities),f=i.entities,r=1,h=f.length;r<h;r++)o=f[r],t=f[r-1],t.type===People.RecentActivity.Core.EntityInfoType.link&&t.offset+t.length>o.offset&&(t.length=o.offset-t.offset,e=t.data,e.url=e.displayUrl=e.url.substr(0,t.length))};People.RecentActivity.Providers.FbGetFeedRequest.prototype._getUrl$2=function(n,t,i){var r="",u="",e,o,f;return t.length>0&&(e="'"+t.join("','")+"'",r+=People.Social.format('"{0}":"SELECT aid, owner, cover_pid, name, modified, description, size, link, object_id, comment_info, like_info FROM album WHERE aid IN ({1})",',"albumInfo",e),u+=People.Social.format("SELECT id, name, pic_square FROM profile WHERE id IN ({0})","SELECT owner FROM #albumInfo")),i.length>0&&(o="'"+i.join("','")+"'",r+=People.Social.format('"{0}":"SELECT pid, aid, owner, link, caption, object_id, created, src_small, src_small_height, src_small_width, src, src_height, src_width, src_big, src_big_height, src_big_width, comment_info, like_info FROM photo WHERE pid IN ({1})",',"photoInfo",o),u+=u.length?People.Social.format(" OR id IN ({0})","SELECT owner FROM #photoInfo"):People.Social.format("SELECT id, name, pic_square FROM profile WHERE id IN ({0})","SELECT owner FROM #photoInfo")),r+=People.Social.format('"{0}":"{1}"',"profileInfo",u),f=People.RecentActivity.Providers.FqlRequest.getBaseUrl(n,true),f.addQueryParameter("q","{"+r+"}"),f};People.RecentActivity.Providers.FbGetNotificationsRequest=function(n,t,i){People.RecentActivity.Providers.FqlRequest.call(this,n,t,i);this._albumIds$2={};this._photoIds$2={};this._usernames$2={}};Jx.inherit(People.RecentActivity.Providers.FbGetNotificationsRequest,People.RecentActivity.Providers.FqlRequest);People.RecentActivity.Providers.FbGetNotificationsRequest._albumInfoMultiQueryTemplate$2='"{0}":"SELECT object_id, aid FROM album WHERE object_id IN ({1})"';People.RecentActivity.Providers.FbGetNotificationsRequest._photoInfoMultiQueryTemplate$2='"{0}":"SELECT object_id, pid FROM photo WHERE object_id IN ({1})"';People.RecentActivity.Providers.FbGetNotificationsRequest._userInfoMultiQueryTemplate$2='"{0}":"SELECT username, id FROM profile WHERE username IN ({1})"';People.RecentActivity.Providers.FbGetNotificationsRequest._fbPostMatch1$2=new RegExp("^https?://[^/]+/([^/]+)/posts/([^/?&]+)","i");People.RecentActivity.Providers.FbGetNotificationsRequest._fbPostMatch2$2=new RegExp("^https?://[^/]+/permalink\\.php\\?story_fbid=([^&]+)&id=([^&]+)","i");People.RecentActivity.Providers.FbGetNotificationsRequest._fbPhotoMatch$2=new RegExp("^https?://[^/]+/photo\\.php\\?fbid=([^&]+)","i");People.RecentActivity.Providers.FbGetNotificationsRequest._fbAlbumMatch$2=new RegExp("^https?://[^/]+/album\\.php\\?fbid=([^&]+)","i");People.RecentActivity.Providers.FbGetNotificationsRequest.prototype._callback$2=null;People.RecentActivity.Providers.FbGetNotificationsRequest.prototype._notificationsResponse$2=null;People.RecentActivity.Providers.FbGetNotificationsRequest.prototype._albumIds$2=null;People.RecentActivity.Providers.FbGetNotificationsRequest.prototype._photoIds$2=null;People.RecentActivity.Providers.FbGetNotificationsRequest.prototype._usernames$2=null;People.RecentActivity.Providers.FbGetNotificationsRequest.prototype._cache$2=null;People.RecentActivity.Providers.FbGetNotificationsRequest.prototype._moreInfoRequest$2=null;People.RecentActivity.Providers.FbGetNotificationsRequest.prototype.execute=function(n){this._callback$2=n;this.onExecute()};People.RecentActivity.Providers.FbGetNotificationsRequest.prototype.cancel=function(){this._moreInfoRequest$2!=null&&this._moreInfoRequest$2.cancel();People.RecentActivity.Providers.FqlRequest.prototype.cancel.call(this)};People.RecentActivity.Providers.FbGetNotificationsRequest.prototype.onExecute=function(){People.RecentActivity.Providers.FqlRequest.prototype.execute.call(this,this.onNotificationsRetrieved.bind(this))};People.RecentActivity.Providers.FbGetNotificationsRequest.prototype.onNotificationsRetrieved=function(r){var f=r.data,u,e;if(!r.success||f==null||!f.length){this.reportScenario();this._callback$2(r);return}if(this.requestContext.requestState==null){this.reportScenario();this._callback$2(r);return}if(this._notificationsResponse$2=r,u=this.requestContext.requestState,e=u[0],this._cache$2=u[1],this._processNotifications$2(e),!Object.keys(this._albumIds$2).length&&!Object.keys(this._photoIds$2).length&&!Object.keys(this._usernames$2).length){this._callback$2(r);return}this.requestContext.liveCommApiName=People.RecentActivity.Core.BiciLiveCommApiNames.fqlGetNotifications2;this.requestContext.thirdPartyApiName=People.RecentActivity.Core.BiciThirdPartyApiCallNames.fqlGetNotifications2;this.requestContext.thirdPartyScenarioType=People.RecentActivity.Core.BiciThirdPartyScenarioType.readNotifications;this.requestContext.propertyId=i.facebook;this.requestContext.scenarioId=n.modernPeople_GetNotifications;this.requestContext.apiId=t.facebook_Fql_Multiquery_GetSocialNotifications;this._moreInfoRequest$2=this.createGetMoreInfoRequest(this.requestContext);this._moreInfoRequest$2.execute(this._onMoreInfoRetrieved$2.bind(this))};People.RecentActivity.Providers.FbGetNotificationsRequest.prototype.createGetMoreInfoRequest=function(n){var e,i;var t=[],r=Object.keys(this._albumIds$2),u=Object.keys(this._photoIds$2),f=Object.keys(this._usernames$2);r.length>0&&t.push(People.Social.format('"{0}":"SELECT object_id, aid FROM album WHERE object_id IN ({1})"',"albumInfo",People.RecentActivity.Providers.CollectionHelper.joinKeys(r,true)));u.length>0&&t.push(People.Social.format('"{0}":"SELECT object_id, pid FROM photo WHERE object_id IN ({1})"',"photoInfo",People.RecentActivity.Providers.CollectionHelper.joinKeys(u,true)));f.length>0&&t.push(People.Social.format('"{0}":"SELECT username, id FROM profile WHERE username IN ({1})"',"profileInfo",People.RecentActivity.Providers.CollectionHelper.joinKeys(f,true)));e=t.join(",");i=People.RecentActivity.Providers.FqlRequest.getBaseUrl(n,true);i.addQueryParameter("q","{"+e+"}");n.expectedResponse=12;n.scenarioComplete=true;return this.onCreateMoreInfoRequest(i,n)};People.RecentActivity.Providers.FbGetNotificationsRequest.prototype.onCreateMoreInfoRequest=function(n,t){return new People.RecentActivity.Providers.SocialHttpRequest(0,n,t)};People.RecentActivity.Providers.FbGetNotificationsRequest.prototype._onMoreInfoRetrieved$2=function(n){n.resultInfo.code===People.RecentActivity.Core.ResultCode.success&&this._populateNotificationInfo$2(n.data);this._callback$2(this._notificationsResponse$2)};People.RecentActivity.Providers.FbGetNotificationsRequest.prototype._processNotifications$2=function(n){for(var t,i,f,e,o,r,s,u=0;u<n.length;u++){if(t=n[u],t.objectType=People.RecentActivity.Core.NotificationInfoType.none,i=People.RecentActivity.Providers.FbGetNotificationsRequest._fbPostMatch1$2.exec(t.link),i!=null){f=i[1];e=this._cache$2.getContactId(f);t.objectId=i[2];t.objectType=People.RecentActivity.Core.NotificationInfoType.entry;Jx.isNonEmptyString(e)?t.objectId=People.Social.format("{0}_{1}",e,t.objectId):this._addNotificationToDictionary$2(this._usernames$2,f,t);continue}if(i=People.RecentActivity.Providers.FbGetNotificationsRequest._fbPostMatch2$2.exec(t.link),i!=null){t.objectId=People.Social.format("{0}_{1}",i[2],i[1]);t.objectType=People.RecentActivity.Core.NotificationInfoType.entry;continue}if(i=People.RecentActivity.Providers.FbGetNotificationsRequest._fbPhotoMatch$2.exec(t.link),i!=null){r=i[1];o=this._cache$2.getPhotoId(r);Jx.isNonEmptyString(o)?r=o:this._addNotificationToDictionary$2(this._photoIds$2,r,t);t.objectId=r;t.objectType=People.RecentActivity.Core.NotificationInfoType.photo;continue}if(i=People.RecentActivity.Providers.FbGetNotificationsRequest._fbAlbumMatch$2.exec(t.link),i!=null){r=i[1];s=this._cache$2.getAlbumId(r);Jx.isNonEmptyString(s)?r=s:this._addNotificationToDictionary$2(this._albumIds$2,r,t);t.objectId=r;t.objectType=People.RecentActivity.Core.NotificationInfoType.photoAlbum;continue}}};People.RecentActivity.Providers.FbGetNotificationsRequest.prototype._populateNotificationInfo$2=function(n){var h,e,c,l,o,v,t,a,s,i,y;var r=n.profileInfo,u=n.albumInfo,f=n.photoInfo;if(People.RecentActivity.Providers.Utilities.isArray(r)){for(t=0;t<r.length;t++)if(h=r[t],e=this._usernames$2[h.username],e!=null)for(i=0;i<e.length;i++)c=e[i],c.objectId=People.Social.format("{0}_{1}",h.id,c.objectId);this._cache$2.updateContactIdMap(r)}else Jx.log.write(3,"FbGetNotificationsRequest.PopulateNotificationInfo(): profileInfo");if(People.RecentActivity.Providers.Utilities.isArray(u)){for(t=0;t<u.length;t++)if(l=u[t],o=this._albumIds$2[l.object_id.toString()],o!=null)for(i=0;i<o.length;i++)v=o[i],v.objectId=l.aid;this._cache$2.updateAlbumIdMap(u)}else Jx.log.write(3,"FbGetNotificationsRequest.PopulateNotificationInfo(): albumInfo");if(People.RecentActivity.Providers.Utilities.isArray(f)){for(t=0;t<f.length;t++)if(a=f[t],s=this._photoIds$2[a.object_id.toString()],s!=null)for(i=0;i<s.length;i++)y=s[i],y.objectId=a.pid;this._cache$2.updatePhotoIdMap(f)}else Jx.log.write(3,"FbGetNotificationsRequest.PopulateNotificationInfo(): photoInfo")};People.RecentActivity.Providers.FbGetNotificationsRequest.prototype._addNotificationToDictionary$2=function(n,t,i){!Jx.isUndefined(n[t])||(n[t]=[]);n[t].push(i)};People.RecentActivity.Providers.GraphRequest=function(n,t,i){People.RecentActivity.Providers.SocialHttpRequest.call(this,n,t,i)};Jx.inherit(People.RecentActivity.Providers.GraphRequest,People.RecentActivity.Providers.SocialHttpRequest);People.RecentActivity.Providers.GraphRequest.createAddFeedObjectRequest=function(r){var u;var e=r.feedObject.data,o=r.contactIdMap[People.RecentActivity.Core.NetworkId.facebook],f=null;switch(e.type){case People.RecentActivity.Core.FeedEntryInfoType.text:case People.RecentActivity.Core.FeedEntryInfoType.link:case People.RecentActivity.Core.FeedEntryInfoType.video:f=new People.RecentActivity.Providers.Uri(People.RecentActivity.Platform.Configuration.instance.graphApiRootUrl,o.id+"/feed")}return People.RecentActivity.Providers.GraphRequest._addAuthQueryParam$1(f,r),r.liveCommApiName=People.RecentActivity.Core.BiciLiveCommApiNames.graphPostActivity,r.thirdPartyApiName=People.RecentActivity.Core.BiciThirdPartyApiCallNames.graphPostActivity,r.thirdPartyScenarioType=People.RecentActivity.Core.BiciThirdPartyScenarioType.publishStatus,r.propertyId=i.facebook,r.scenarioId=n.modernPeople_PostShare,r.apiId=t.facebook_Graph_PostFeed,u=new People.RecentActivity.Providers.GraphRequest(1,f,r),u.addHeader("Content-Type","application/x-www-form-urlencoded"),u.body=r.serializer.serialize(r.feedObject,13),u};People.RecentActivity.Providers.GraphRequest.createAddCommentRequest=function(r){var u=new People.RecentActivity.Providers.Uri(People.RecentActivity.Platform.Configuration.instance.graphApiRootUrl,r.feedObject.id+"/comments");return u.addQueryParameter("message",r.comment.text),People.RecentActivity.Providers.GraphRequest._addAuthQueryParam$1(u,r),r.liveCommApiName=People.RecentActivity.Core.BiciLiveCommApiNames.graphPostComment,r.thirdPartyApiName=People.RecentActivity.Core.BiciThirdPartyApiCallNames.graphPostComment,r.thirdPartyScenarioType=People.RecentActivity.Core.BiciThirdPartyScenarioType.writeActivityReactions,r.propertyId=i.facebook,r.scenarioId=n.modernPeople_PostComment,r.apiId=t.facebook_Graph_PostComment,new People.RecentActivity.Providers.GraphRequest(1,u,r)};People.RecentActivity.Providers.GraphRequest.createAddReactionRequest=function(r){var u=new People.RecentActivity.Providers.Uri(People.RecentActivity.Platform.Configuration.instance.graphApiRootUrl,r.feedObject.id+"/likes");return People.RecentActivity.Providers.GraphRequest._addAuthQueryParam$1(u,r),r.liveCommApiName=People.RecentActivity.Core.BiciLiveCommApiNames.graphPostLike,r.thirdPartyApiName=People.RecentActivity.Core.BiciThirdPartyApiCallNames.graphPostLike,r.thirdPartyScenarioType=People.RecentActivity.Core.BiciThirdPartyScenarioType.writeActivityReactions,r.propertyId=i.facebook,r.scenarioId=n.modernPeople_PostReaction,r.apiId=t.facebook_Graph_PostLike,r.expectedResponseFormat=2,new People.RecentActivity.Providers.GraphRequest(1,u,r)};People.RecentActivity.Providers.GraphRequest.createRemoveReactionRequest=function(r){var u=new People.RecentActivity.Providers.Uri(People.RecentActivity.Platform.Configuration.instance.graphApiRootUrl,r.feedObject.id+"/likes");return People.RecentActivity.Providers.GraphRequest._addAuthQueryParam$1(u,r),r.liveCommApiName=People.RecentActivity.Core.BiciLiveCommApiNames.graphDeleteLike,r.thirdPartyApiName=People.RecentActivity.Core.BiciThirdPartyApiCallNames.graphDeleteLike,r.thirdPartyScenarioType=People.RecentActivity.Core.BiciThirdPartyScenarioType.writeActivityReactions,r.propertyId=i.facebook,r.scenarioId=n.modernPeople_DeleteReaction,r.apiId=t.facebook_Graph_DeleteLike,new People.RecentActivity.Providers.GraphRequest(2,u,r)};People.RecentActivity.Providers.GraphRequest._addAuthQueryParam$1=function(n,t){n.addQueryParameter("access_token",t.authInfo.token)};People.RecentActivity.Providers.LegacyRestRequest=function(n,t,i){People.RecentActivity.Providers.SocialHttpRequest.call(this,n,t,i)};Jx.inherit(People.RecentActivity.Providers.LegacyRestRequest,People.RecentActivity.Providers.SocialHttpRequest);People.RecentActivity.Providers.LegacyRestRequest._notificationsMarkReadPath$1="method/notifications.markRead";People.RecentActivity.Providers.LegacyRestRequest._notificationIdsParameter$1="notification_ids";People.RecentActivity.Providers.LegacyRestRequest.createMarkNotificationsReadRequest=function(r){var u,s;var e=People.RecentActivity.Providers.LegacyRestRequest.getBaseUrl(r,"method/notifications.markRead"),f=r.notifications,o=new Array(f.length);for(u=0,s=f.length;u<s;u++)o[u]=f[u].id;return e.addQueryParameter("notification_ids",o.join(",")),r.liveCommApiName=People.RecentActivity.Core.BiciLiveCommApiNames.legacyApiMarkNotificationRead,r.thirdPartyApiName=People.RecentActivity.Core.BiciThirdPartyApiCallNames.legacyApiMarkNotificationRead,r.thirdPartyScenarioType=People.RecentActivity.Core.BiciThirdPartyScenarioType.writeNotifications,r.propertyId=i.facebook,r.scenarioId=n.modernPeople_MarkNotificationsRead,r.apiId=t.facebook_LegacyRest_MarkNotificationsRead,new People.RecentActivity.Providers.LegacyRestRequest(0,e,r)};People.RecentActivity.Providers.LegacyRestRequest.getBaseUrl=function(n,t){var i=new People.RecentActivity.Providers.Uri(People.RecentActivity.Platform.Configuration.instance.legacyRestRootUrl,t),r=n.authInfo;return i.addQueryParameter("access_token",r.token),i.addQueryParameter("format","json"),i};People.RecentActivity.Providers.SupRequest=function(n,t,r){People.RecentActivity.Providers.SocialHttpRequest.call(this,n,t,r);var u=new Jx.TransactionContext(r.scenarioId,1033),f=u.getNextTransactionContext(i.psa);this.addHeader("X-AppId","484AAC02-7F59-41B7-9601-772045DCC569");this.addHeader("WLAuthToken",r.authInfo.token)};Jx.inherit(People.RecentActivity.Providers.SupRequest,People.RecentActivity.Providers.SocialHttpRequest);People.RecentActivity.Providers.SupRequest._applicationId$1="484AAC02-7F59-41B7-9601-772045DCC569";People.RecentActivity.Providers.SupRequest._replySegment$1="replies";People.RecentActivity.Providers.SupRequest._favoriteSegment$1="favorites";People.RecentActivity.Providers.SupRequest._retweetSegment$1="retweets";People.RecentActivity.Providers.SupRequest._reactionUrlSegment$1="feeds/reactions/{0}:{1}/{2}";Object.defineProperty(People.RecentActivity.Providers.SupRequest,"_supApiRoot$1",{get:function(){return People.RecentActivity.Platform.Configuration.instance.supApiRootUrl}});People.RecentActivity.Providers.SupRequest.createGetFeedRequest=function(r){var u,s;u=r.contactIdMap;var h=u[Object.keys(u)[0]],f,e="&count="+People.RecentActivity.Platform.Configuration.instance.feedEntriesBatchSize,o=r.feedTimeOffset;return o>0&&(s=new Date(r.feedTimeOffset),e+="&until="+s.toISOString()),h.id===People.RecentActivity.Platform.Configuration.instance.whatsNewPersonId?(f=new People.RecentActivity.Providers.Uri(People.RecentActivity.Providers.SupRequest._supApiRoot$1,"feeds/whatsnew?sourceids="+People.RecentActivity.Providers.CollectionHelper.joinKeys(Object.keys(u))+e),o===-1?(r.liveCommApiName=People.RecentActivity.Core.BiciLiveCommApiNames.supGetWhatsNewActivities,r.scenarioId=n.modernPeople_GetWhatsNewActivities):(r.liveCommApiName=People.RecentActivity.Core.BiciLiveCommApiNames.supGetMoreWhatsNewActivities,r.scenarioId=n.modernPeople_GetMoreWhatsNewActivities),r.apiId=t.psa_SN_ActivityStreamAPI_WhatsNew):(f=new People.RecentActivity.Providers.Uri(People.RecentActivity.Providers.SupRequest._supApiRoot$1,"feeds/recentactivity?ids="+People.RecentActivity.Providers.SocialHelper.joinSourceIdsAndContactIds(u)+e),o===-1?(r.liveCommApiName=People.RecentActivity.Core.BiciLiveCommApiNames.supGetRecentActivities,r.scenarioId=n.modernPeople_GetRecentActivities):(r.liveCommApiName=People.RecentActivity.Core.BiciLiveCommApiNames.supGetMoreRecentActivities,r.scenarioId=n.modernPeople_GetMoreRecentActivities),r.apiId=t.psa_SN_ActivityStreamAPI_RecentActivity),r.propertyId=i.psa,new People.RecentActivity.Providers.SupRequest(0,f,r)};People.RecentActivity.Providers.SupRequest.createGetFeedObjectRequest=function(r){var u,f;return u=r.feedObject,f=new People.RecentActivity.Providers.Uri(People.RecentActivity.Providers.SupRequest._supApiRoot$1,People.Social.format("feeds/activities/{0}:{1}",u.sourceId,u.id)),r.expectedResponse=1,r.liveCommApiName=People.RecentActivity.Core.BiciLiveCommApiNames.supGetActivity,r.propertyId=i.psa,r.scenarioId=n.modernPeople_GetActivity,r.apiId=t.psa_SN_ActivityStreamAPI_RecentActivity,new People.RecentActivity.Providers.SupRequest(0,f,r)};People.RecentActivity.Providers.SupRequest.createGetCommentsRequest=function(r){var u=r.feedObject;return r.liveCommApiName=People.RecentActivity.Core.BiciLiveCommApiNames.supGetAtReplies,r.propertyId=i.psa,r.scenarioId=n.modernPeople_GetReactions,r.apiId=t.psa_SN_ReactionsAPI_Replies_Get,new People.RecentActivity.Providers.SupRequest(0,People.RecentActivity.Providers.SupRequest._getReactionsUrl$1(u,"replies"),r)};People.RecentActivity.Providers.SupRequest.createGetReactionsRequest=function(r){var f,u,e;return f=r.feedObject,u=r.reactionType,e=People.RecentActivity.Providers.SupRequest._getReactionSegment$1(u),r.propertyId=i.psa,r.scenarioId=n.modernPeople_GetReactions,u===People.RecentActivity.Core.NetworkReactionInfoType.retweet?(r.liveCommApiName=People.RecentActivity.Core.BiciLiveCommApiNames.supGetRetweets,r.apiId=t.psa_SN_ReactionsAPI_Retweets_Get):u===People.RecentActivity.Core.NetworkReactionInfoType.favorite&&(r.liveCommApiName=People.RecentActivity.Core.BiciLiveCommApiNames.supGetFavorite,r.apiId=t.psa_SN_ReactionsAPI_Favorites_Get),new People.RecentActivity.Providers.SupRequest(0,People.RecentActivity.Providers.SupRequest._getReactionsUrl$1(f,e),r)};People.RecentActivity.Providers.SupRequest.createAddCommentRequest=function(r){var f,e,u;return f=r.feedObject,e=r.comment,r.liveCommApiName=People.RecentActivity.Core.BiciLiveCommApiNames.supPostAtReply,r.propertyId=i.psa,r.scenarioId=n.modernPeople_PostReaction,r.apiId=t.psa_SN_ReactionsAPI_Replies_Post,u=new People.RecentActivity.Providers.SupRequest(1,People.RecentActivity.Providers.SupRequest._getReactionsUrl$1(f,"replies"),r),u.body=e.text,u};People.RecentActivity.Providers.SupRequest.createAddReactionRequest=function(r){var f,u,e;return f=r.feedObject,u=r.reaction,e=People.RecentActivity.Providers.SupRequest._getReactionSegment$1(u.type.type),r.propertyId=i.psa,r.scenarioId=n.modernPeople_PostReaction,u.type.type===People.RecentActivity.Core.NetworkReactionInfoType.retweet?(r.liveCommApiName=People.RecentActivity.Core.BiciLiveCommApiNames.supPostRetweet,r.apiId=t.psa_SN_ReactionsAPI_Retweets_Post):u.type.type===People.RecentActivity.Core.NetworkReactionInfoType.favorite&&(r.liveCommApiName=People.RecentActivity.Core.BiciLiveCommApiNames.supPostFavorite,r.apiId=t.psa_SN_ReactionsAPI_Favorites_Post,r.expectedResponseFormat=0),new People.RecentActivity.Providers.SupRequest(1,People.RecentActivity.Providers.SupRequest._getReactionsUrl$1(f,e),r)};People.RecentActivity.Providers.SupRequest.createRemoveReactionRequest=function(r){var f,e,u,o;return(f=r.feedObject,e=r.reaction,u=e.type.type,u===People.RecentActivity.Core.NetworkReactionInfoType.retweet)?null:(o=People.RecentActivity.Providers.SupRequest._getReactionSegment$1(u),r.propertyId=i.psa,r.scenarioId=n.modernPeople_DeleteReaction,u===People.RecentActivity.Core.NetworkReactionInfoType.retweet?r.liveCommApiName=People.RecentActivity.Core.BiciLiveCommApiNames.supDeleteRetweet:u===People.RecentActivity.Core.NetworkReactionInfoType.favorite&&(r.liveCommApiName=People.RecentActivity.Core.BiciLiveCommApiNames.supDeleteFavorite,r.apiId=t.psa_SN_ReactionsAPI_Favorites_Delete),new People.RecentActivity.Providers.SupRequest(2,People.RecentActivity.Providers.SupRequest._getReactionsUrl$1(f,o),r))};People.RecentActivity.Providers.SupRequest.createRefreshNotificationsRequest=function(r){var u=new People.RecentActivity.Providers.Uri(People.RecentActivity.Providers.SupRequest._supApiRoot$1,People.Social.format("feeds/notifications?sourceids={0}",r.authInfo.userId.sourceId));return r.expectedResponse=6,r.liveCommApiName=People.RecentActivity.Core.BiciLiveCommApiNames.supGetNotifications,r.propertyId=i.psa,r.scenarioId=n.modernPeople_GetNotifications,r.apiId=t.psa_SN_ActivityStreamAPI_Notifications,new People.RecentActivity.Providers.SupRequest(0,u,r)};People.RecentActivity.Providers.SupRequest._getReactionsUrl$1=function(n,t){return new People.RecentActivity.Providers.Uri(People.RecentActivity.Providers.SupRequest._supApiRoot$1,People.Social.format("feeds/reactions/{0}:{1}/{2}",n.sourceId,n.id,t))};People.RecentActivity.Providers.SupRequest._getReactionSegment$1=function(n){switch(n){case People.RecentActivity.Core.NetworkReactionInfoType.retweet:return"retweets";case People.RecentActivity.Core.NetworkReactionInfoType.favorite:return"favorites"}return null};People.RecentActivity.Providers.RequestContext=function(u,f,e){this._feedTimeOffset=-1;this._startTime=new Date;this._authInfo=u;this._contactIdMap=f;this._serializer=e;this._expectedResponseFormat=1;this._propertyId=i.unknown;this._scenarioId=n.unknown;this._apiId=t.unknown;this._errorType=r.success;this._scenarioComplete=true};People.RecentActivity.Providers.RequestContext.prototype._authInfo=null;People.RecentActivity.Providers.RequestContext.prototype._contactIdMap=null;People.RecentActivity.Providers.RequestContext.prototype._serializer=null;People.RecentActivity.Providers.RequestContext.prototype._feedObject=null;People.RecentActivity.Providers.RequestContext.prototype._comment=null;People.RecentActivity.Providers.RequestContext.prototype._reaction=null;People.RecentActivity.Providers.RequestContext.prototype._reactionType=0;People.RecentActivity.Providers.RequestContext.prototype._notifications=null;People.RecentActivity.Providers.RequestContext.prototype._expectedResponse=0;People.RecentActivity.Providers.RequestContext.prototype._expectedResponseFormat=0;People.RecentActivity.Providers.RequestContext.prototype._userState=null;People.RecentActivity.Providers.RequestContext.prototype._requestState=null;People.RecentActivity.Providers.RequestContext.prototype._thirdPartyApiName=0;People.RecentActivity.Providers.RequestContext.prototype._thirdPartyScenarioType=0;People.RecentActivity.Providers.RequestContext.prototype._liveCommApiName=0;People.RecentActivity.Providers.RequestContext.prototype._propertyId=0;People.RecentActivity.Providers.RequestContext.prototype._scenarioId=0;People.RecentActivity.Providers.RequestContext.prototype._apiId=0;People.RecentActivity.Providers.RequestContext.prototype._errorType=0;People.RecentActivity.Providers.RequestContext.prototype._errorCode=0;People.RecentActivity.Providers.RequestContext.prototype._requestSizeInBytes=0;People.RecentActivity.Providers.RequestContext.prototype._scenarioSizeInBytes=0;People.RecentActivity.Providers.RequestContext.prototype._scenarioComplete=false;People.RecentActivity.Providers.RequestContext.prototype._scenarioDuration=0;People.RecentActivity.Providers.RequestContext.prototype._isAggregated=false;People.RecentActivity.Providers.RequestContext.prototype._numEntriesReceived=0;Object.defineProperty(People.RecentActivity.Providers.RequestContext.prototype,"authInfo",{get:function(){return this._authInfo}});Object.defineProperty(People.RecentActivity.Providers.RequestContext.prototype,"contactIdMap",{get:function(){return this._contactIdMap},set:function(n){this._contactIdMap=n}});Object.defineProperty(People.RecentActivity.Providers.RequestContext.prototype,"serializer",{get:function(){return this._serializer}});Object.defineProperty(People.RecentActivity.Providers.RequestContext.prototype,"expectedResponse",{get:function(){return this._expectedResponse},set:function(n){this._expectedResponse=n}});Object.defineProperty(People.RecentActivity.Providers.RequestContext.prototype,"expectedResponseFormat",{get:function(){return this._expectedResponseFormat},set:function(n){this._expectedResponseFormat=n}});Object.defineProperty(People.RecentActivity.Providers.RequestContext.prototype,"feedObject",{get:function(){return this._feedObject},set:function(n){this._feedObject=n}});Object.defineProperty(People.RecentActivity.Providers.RequestContext.prototype,"comment",{get:function(){return this._comment},set:function(n){this._comment=n}});Object.defineProperty(People.RecentActivity.Providers.RequestContext.prototype,"reaction",{get:function(){return this._reaction},set:function(n){this._reaction=n}});Object.defineProperty(People.RecentActivity.Providers.RequestContext.prototype,"reactionType",{get:function(){return this._reactionType},set:function(n){this._reactionType=n}});Object.defineProperty(People.RecentActivity.Providers.RequestContext.prototype,"feedTimeOffset",{get:function(){return this._feedTimeOffset},set:function(n){this._feedTimeOffset=n}});Object.defineProperty(People.RecentActivity.Providers.RequestContext.prototype,"notifications",{get:function(){return this._notifications},set:function(n){this._notifications=n}});Object.defineProperty(People.RecentActivity.Providers.RequestContext.prototype,"userState",{get:function(){return this._userState},set:function(n){this._userState=n}});Object.defineProperty(People.RecentActivity.Providers.RequestContext.prototype,"requestState",{get:function(){return this._requestState},set:function(n){this._requestState=n}});Object.defineProperty(People.RecentActivity.Providers.RequestContext.prototype,"startTime",{get:function(){return this._startTime},set:function(n){this._startTime=n}});Object.defineProperty(People.RecentActivity.Providers.RequestContext.prototype,"thirdPartyApiName",{get:function(){return this._thirdPartyApiName},set:function(n){this._thirdPartyApiName=n}});Object.defineProperty(People.RecentActivity.Providers.RequestContext.prototype,"thirdPartyScenarioType",{get:function(){return this._thirdPartyScenarioType},set:function(n){this._thirdPartyScenarioType=n}});Object.defineProperty(People.RecentActivity.Providers.RequestContext.prototype,"liveCommApiName",{get:function(){return this._liveCommApiName},set:function(n){this._liveCommApiName=n}});Object.defineProperty(People.RecentActivity.Providers.RequestContext.prototype,"propertyId",{get:function(){return this._propertyId},set:function(n){this._propertyId=n}});Object.defineProperty(People.RecentActivity.Providers.RequestContext.prototype,"scenarioId",{get:function(){return this._scenarioId},set:function(n){this._scenarioId=n}});Object.defineProperty(People.RecentActivity.Providers.RequestContext.prototype,"apiId",{get:function(){return this._apiId},set:function(n){this._apiId=n}});Object.defineProperty(People.RecentActivity.Providers.RequestContext.prototype,"errorType",{get:function(){return this._errorType},set:function(n){this._errorType=n}});Object.defineProperty(People.RecentActivity.Providers.RequestContext.prototype,"errorCode",{get:function(){return this._errorCode},set:function(n){this._errorCode=n}});Object.defineProperty(People.RecentActivity.Providers.RequestContext.prototype,"requestSizeInBytes",{get:function(){return this._requestSizeInBytes},set:function(n){this._requestSizeInBytes=n}});Object.defineProperty(People.RecentActivity.Providers.RequestContext.prototype,"scenarioSizeInBytes",{get:function(){return this._scenarioSizeInBytes},set:function(n){this._scenarioSizeInBytes=n}});Object.defineProperty(People.RecentActivity.Providers.RequestContext.prototype,"scenarioComplete",{get:function(){return this._scenarioComplete},set:function(n){this._scenarioComplete=n}});Object.defineProperty(People.RecentActivity.Providers.RequestContext.prototype,"scenarioDuration",{get:function(){return this._scenarioDuration},set:function(n){this._scenarioDuration=n}});Object.defineProperty(People.RecentActivity.Providers.RequestContext.prototype,"isAggregated",{get:function(){return this._isAggregated},set:function(n){this._isAggregated=n}});Object.defineProperty(People.RecentActivity.Providers.RequestContext.prototype,"numEntriesReceived",{get:function(){return this._numEntriesReceived},set:function(n){this._numEntriesReceived=n}});People.RecentActivity.Providers.HttpRequest=function(n,t){this._request=new XMLHttpRequest;this._request.open(this._getMethod(n),t.toString(),true)};People.RecentActivity.Providers.HttpRequest.prototype._request=null;People.RecentActivity.Providers.HttpRequest.prototype._executing=false;People.RecentActivity.Providers.HttpRequest.prototype._body=null;People.RecentActivity.Providers.HttpRequest.prototype._callback=null;People.RecentActivity.Providers.HttpRequest.prototype._userState=null;Object.defineProperty(People.RecentActivity.Providers.HttpRequest.prototype,"body",{get:function(){return this._body},set:function(n){this._body=n}});People.RecentActivity.Providers.HttpRequest.prototype.addHeader=function(n,t){this._request.setRequestHeader(n,t)};People.RecentActivity.Providers.HttpRequest.prototype.execute=function(n,t){this._executing||(this._executing=true,this._callback=n,this._userState=t,this._request.onreadystatechange=this._onReadyStateChanged.bind(this),this._request.send(this._body))};People.RecentActivity.Providers.HttpRequest.prototype._getMethod=function(n){switch(n){case 2:return"DELETE";case 0:return"GET";case 1:return"POST"}return"GET"};People.RecentActivity.Providers.HttpRequest.prototype._onReadyStateChanged=function(){this._request.readyState===4&&(this._callback!=null&&this._callback(new People.RecentActivity.Providers.HttpResponse(this._request.status,this._request.getAllResponseHeaders(),this._request.responseText,this._request.responseXML,this._userState)),this._callback=null,this._request.onreadystatechange=null,this._request=null,this._executing=false)};People.RecentActivity.Providers.HttpResponse=function(n,t,i,r,u){this._status=n;this._headers=new People.RecentActivity.Providers.HttpResponseHeaders(t);this._body=i;this._document=r;this._userState=u};People.RecentActivity.Providers.HttpResponse.prototype._status=0;People.RecentActivity.Providers.HttpResponse.prototype._body=null;People.RecentActivity.Providers.HttpResponse.prototype._headers=null;People.RecentActivity.Providers.HttpResponse.prototype._document=null;People.RecentActivity.Providers.HttpResponse.prototype._userState=null;Object.defineProperty(People.RecentActivity.Providers.HttpResponse.prototype,"status",{get:function(){return this._status}});Object.defineProperty(People.RecentActivity.Providers.HttpResponse.prototype,"headers",{get:function(){return this._headers}});Object.defineProperty(People.RecentActivity.Providers.HttpResponse.prototype,"body",{get:function(){return this._body}});Object.defineProperty(People.RecentActivity.Providers.HttpResponse.prototype,"document",{get:function(){return this._document}});Object.defineProperty(People.RecentActivity.Providers.HttpResponse.prototype,"userState",{get:function(){return this._userState},set:function(n){this._userState=n}});People.RecentActivity.Providers.SocialHttpResponse=function(n,t,i,r,u){this._resultInfo=n;this._data=t;this._error=i;this._httpResponse=r;this._requextContext=u};People.RecentActivity.Providers.SocialHttpResponse.prototype._httpResponse=null;People.RecentActivity.Providers.SocialHttpResponse.prototype._requextContext=null;People.RecentActivity.Providers.SocialHttpResponse.prototype._resultInfo=null;People.RecentActivity.Providers.SocialHttpResponse.prototype._data=null;People.RecentActivity.Providers.SocialHttpResponse.prototype._error=null;People.RecentActivity.Providers.SocialHttpResponse.prototype._subErrorCode=0;Object.defineProperty(People.RecentActivity.Providers.SocialHttpResponse.prototype,"success",{get:function(){return this._resultInfo.code===People.RecentActivity.Core.ResultCode.success}});Object.defineProperty(People.RecentActivity.Providers.SocialHttpResponse.prototype,"resultInfo",{get:function(){return this._resultInfo},set:function(n){this._resultInfo=n}});Object.defineProperty(People.RecentActivity.Providers.SocialHttpResponse.prototype,"error",{get:function(){return this._error},set:function(n){this._error=n}});Object.defineProperty(People.RecentActivity.Providers.SocialHttpResponse.prototype,"subErrorCode",{get:function(){return this._subErrorCode},set:function(n){this._subErrorCode=n}});Object.defineProperty(People.RecentActivity.Providers.SocialHttpResponse.prototype,"data",{get:function(){return this._data},set:function(n){this._data=n}});Object.defineProperty(People.RecentActivity.Providers.SocialHttpResponse.prototype,"status",{get:function(){return this._httpResponse.status}});Object.defineProperty(People.RecentActivity.Providers.SocialHttpResponse.prototype,"headers",{get:function(){return this._httpResponse.headers}});Object.defineProperty(People.RecentActivity.Providers.SocialHttpResponse.prototype,"body",{get:function(){return this._httpResponse.body}});Object.defineProperty(People.RecentActivity.Providers.SocialHttpResponse.prototype,"document",{get:function(){return this._httpResponse.document}});Object.defineProperty(People.RecentActivity.Providers.SocialHttpResponse.prototype,"requestContext",{get:function(){return this._requextContext}});People.RecentActivity.Providers.CommentNodeHandler=function(){};People.RecentActivity.Providers.CommentNodeHandler.prototype.process=function(n,t){var i,r,u;return(i=n,r=People.RecentActivity.Providers.RetailModeHelper.validateAndGetNodeValue(i,"Author"),r==null)?null:(u=People.RecentActivity.Providers.RetailModeHelper.validateAndGetNodeValue(i,"Text"),u==null)?null:People.RecentActivity.Core.create_commentInfo(t.parentObjectId+"_"+t.index,People.RecentActivity.Providers.RetailModeHelper.createContactInfo(r,t.contactId.sourceId),People.RecentActivity.Providers.RetailModeHelper.getTimestamp(i),u,new Array(0))};People.RecentActivity.Providers.ContactNodeHandler=function(){};People.RecentActivity.Providers.ContactNodeHandler._albumsTag="Albums";People.RecentActivity.Providers.ContactNodeHandler._feedTag="Feed";People.RecentActivity.Providers.ContactNodeHandler.prototype.process=function(n,t){var r=n,i=this._getContactId(r);return i==null?null:(Jx.log.write(4,People.Social.format("Processing contact {0}:{1}...",i.sourceId,i.id)),t.contactId=i,People.Social.clearKeys(t.albumMap),People.Social.clearKeys(t.photoMap),this._populateContactDataCache(r,"Albums",t,People.RecentActivity.Providers.AlbumCache.getInstance(t.userIdentity),People.RecentActivity.Providers.FeedObjectCache.getInstance(t.userIdentity)),this._populateContactDataCache(r,"Feed",t,People.RecentActivity.Providers.FeedCache.getInstance(t.userIdentity),People.RecentActivity.Providers.FeedObjectCache.getInstance(t.userIdentity)))};People.RecentActivity.Providers.ContactNodeHandler.prototype._getContactId=function(n){var t=People.RecentActivity.Providers.RetailModeHelper.validateAndGetNodeValue(n,"ObjectId"),i=People.RecentActivity.Providers.RetailModeHelper.validateAndGetNodeValue(n,"SourceId");return t==null||i==null?null:new People.RecentActivity.Platform.ContactId(t,i)};People.RecentActivity.Providers.ContactNodeHandler.prototype._populateContactDataCache=function(n,t,i,r,u){var o=n.selectSingleNode(t),f,e,s;if(o==null||(f=People.RecentActivity.Providers.NodeHandlerLookup.handlers.item(t).process(o,i),f==null||!f.length))return null;for(e=0;e<f.length;e++)s=f[e],u.addFeedObject(s);return f.sort(People.RecentActivity.Providers.RetailModeHelper.feedObjectSorter),r.addCacheEntry(i.contactId,f),f};People.RecentActivity.Providers.EnumerableNodeHandler=function(n){this._childTag=n};People.RecentActivity.Providers.EnumerableNodeHandler.prototype._childTag=null;Object.defineProperty(People.RecentActivity.Providers.EnumerableNodeHandler.prototype,"childTag",{get:function(){return this._childTag}});People.RecentActivity.Providers.EnumerableNodeHandler.prototype.process=function(n,t){var r=n,i=r.selectNodes(this._childTag);return i==null||!i.size?(Jx.log.write(3,People.Social.format("No {0} tags found!",this._childTag)),null):this.onProcess(i,t)};People.RecentActivity.Providers.EnumerableNodeHandler.prototype.onProcess=function(n,t){var r,i,f,e,u;for(r=[],i=0,f=n.size;i<f;i++)t.index=i,e=n.getAt(i),u=People.RecentActivity.Providers.NodeHandlerLookup.handlers.item(this._childTag).process(e,t),u!=null&&r.push(u);return r};People.RecentActivity.Providers.ContactsNodeHandler=function(n){People.RecentActivity.Providers.EnumerableNodeHandler.call(this,n)};Jx.inherit(People.RecentActivity.Providers.ContactsNodeHandler,People.RecentActivity.Providers.EnumerableNodeHandler);People.RecentActivity.Providers.ContactsNodeHandler.prototype.onProcess=function(n,t){var i,u,e,o,f,r;for(i={},u=0,e=n.size;u<e;u++)(o=n.getAt(u),f=People.RecentActivity.Providers.NodeHandlerLookup.handlers.item(this.childTag).process(o,t),f!=null&&f.length)&&(r=t.contactId.sourceId,!Jx.isUndefined(i[r])||(i[r]=[]),i[r].push.apply(i[r],f));return i};People.RecentActivity.Providers.FeedObjectNodeHandler=function(n){this._tag=n};People.RecentActivity.Providers.FeedObjectNodeHandler._feedEntryTag="FeedEntry";People.RecentActivity.Providers.FeedObjectNodeHandler._albumTag="Album";People.RecentActivity.Providers.FeedObjectNodeHandler._photoTag="Photo";People.RecentActivity.Providers.FeedObjectNodeHandler._photosTag="Photos";People.RecentActivity.Providers.FeedObjectNodeHandler._commentsTag="Comments";People.RecentActivity.Providers.FeedObjectNodeHandler._likesTag="Likes";People.RecentActivity.Providers.FeedObjectNodeHandler.prototype._tag=null;People.RecentActivity.Providers.FeedObjectNodeHandler.prototype.process=function(n,t){var i,r,u,f,e,o,s;if(i=n,r=People.RecentActivity.Providers.RetailModeHelper.validateAndGetNodeValue(i,"ObjectId"),r==null)return null;u=People.RecentActivity.Core.FeedObjectInfoType.none;f=null;switch(this._tag){case"FeedEntry":u=People.RecentActivity.Core.FeedObjectInfoType.entry;f=this._toFeedEntryInfo(t,i);break;case"Album":u=People.RecentActivity.Core.FeedObjectInfoType.photoAlbum;f=this._toPhotoAlbumInfo(t,i,r);break;case"Photo":u=People.RecentActivity.Core.FeedObjectInfoType.photo;f=this._toPhotoInfo(t,i,r)}if(f==null)return null;e=t.contactId.sourceId;o=People.RecentActivity.Core.create_commentDetailsInfo(0,e!==People.RecentActivity.Core.NetworkId.twitter,People.RecentActivity.Core.Permissions.full);o.icon=People.RecentActivity.Platform.Configuration.instance.getCommentIcon(e);o.maximumLength=e===People.RecentActivity.Core.NetworkId.twitter?140:-1;e===People.RecentActivity.Core.NetworkId.twitter&&(o.prefix=People.RecentActivity.Providers.SocialHelper.getTwitterCommentPrefix(this._createContactInfo(t).networkHandle));s=People.RecentActivity.Core.create_feedObjectInfo(r,e,u,f,"about:blank",People.RecentActivity.Providers.RetailModeHelper.getTimestamp(i),o,new Array(0),[People.RecentActivity.Core.create_reactionDetailsInfo(this._getReactionId(t),0,People.RecentActivity.Core.Permissions.full)],new Array(0));this._populateCommentsAndReactions(s,t,i);switch(u){case People.RecentActivity.Core.FeedObjectInfoType.photo:t.photoMap[r]=s;break;case People.RecentActivity.Core.FeedObjectInfoType.photoAlbum:t.albumMap[r]=s}return s};People.RecentActivity.Providers.FeedObjectNodeHandler.prototype._toFeedEntryInfo=function(n,t){var r=People.RecentActivity.Providers.RetailModeHelper.validateAndGetNodeValue(t,"Type"),i,u,e,o,c,s,f,l,h;if(r==null)return null;i=null;switch(r.toLowerCase()){case"album":if(u=this._getAlbumOrPhotoFromFeedEntryNode(People.RecentActivity.Core.FeedObjectInfoType.photoAlbum,t,n),u==null)return null;e=u.data;o=e.photos;c=o.slice(0,Math.min(3,o.length));i=People.RecentActivity.Core.create_feedEntryPhotoAlbumDataInfo(e.description,u,c,false);break;case"photo":if((s=this._getAlbumOrPhotoFromFeedEntryNode(People.RecentActivity.Core.FeedObjectInfoType.photoAlbum,t,n),s==null)||(f=this._getAlbumOrPhotoFromFeedEntryNode(People.RecentActivity.Core.FeedObjectInfoType.photo,t,n),f==null))return null;l=f.data;i=People.RecentActivity.Core.create_feedEntryPhotoDataInfo(l.caption,f,s,false);break;case"text":if(h=People.RecentActivity.Providers.RetailModeHelper.validateAndGetNodeValue(t,"TextMessage"),h==null)return null;i=People.RecentActivity.Core.create_feedEntryStatusDataInfo(h);break;default:return Jx.log.write(3,People.Social.format("Unsupported type: {0}. Entry xml: {1}.",r,t.getXml())),null}return People.RecentActivity.Core.create_feedEntryInfo(this._getEntryType(r),this._createContactInfo(n),i,People.RecentActivity.Providers.RetailModeHelper.getNetworkName(n.contactId.sourceId),new Array(0),new Array(0),false)};People.RecentActivity.Providers.FeedObjectNodeHandler.prototype._toPhotoAlbumInfo=function(n,t,i){var u=t.selectSingleNode("Photos"),r,f;return u==null?(Jx.log.write(3,People.Social.format("No {0} tag found in Album: {1}!","Photos",t.getXml())),null):(n.parentObjectId=i,r=People.RecentActivity.Providers.NodeHandlerLookup.handlers.item("Photos").process(u,n),r==null||!r.length)?null:(f=People.RecentActivity.Providers.RetailModeHelper.validateAndGetNodeValue(t,"AlbumName"),People.RecentActivity.Core.create_photoAlbumInfo(i,this._createContactInfo(n),f||"","",new Array(0),r.length,r[0],r))};People.RecentActivity.Providers.FeedObjectNodeHandler.prototype._toPhotoInfo=function(n,t,i){var r,u,e;var h=People.RecentActivity.Providers.RetailModeHelper.validateAndGetNodeValue(t,"Caption"),f=People.RecentActivity.Providers.RetailModeHelper.validateAndGetNodeValue(t,"Source"),o=People.RecentActivity.Providers.RetailModeHelper.validateAndGetNodeValue(t,"SourceHeight"),s=People.RecentActivity.Providers.RetailModeHelper.validateAndGetNodeValue(t,"SourceWidth");if(!Jx.isNonEmptyString(f)||!Jx.isNonEmptyString(o)||!Jx.isNonEmptyString(s))return null;r=0;u=0;try{r=parseInt(o);u=parseInt(s)}catch(c){return Jx.log.write(3,"Invalid SourceHeight or SourceWidth! Photo xml: "+t.getXml()),null}return e=People.RecentActivity.Core.create_photoInfo(i,n.parentObjectId,this._createContactInfo(n),h||"",f,r,u,f,r,u,f,r,u),e.index=n.index,e};People.RecentActivity.Providers.FeedObjectNodeHandler.prototype._populateCommentsAndReactions=function(n,t,i){var u,r,o,s,f,e;if(n.type===People.RecentActivity.Core.FeedObjectInfoType.entry&&n.data.type!==People.RecentActivity.Core.FeedEntryInfoType.text){u=n.data;r=null;switch(u.type){case People.RecentActivity.Core.FeedEntryInfoType.photoAlbum:o=u.data;r=o.album;break;case People.RecentActivity.Core.FeedEntryInfoType.photo:s=u.data;r=s.photo}r!=null&&(n.comments=r.comments,n.commentDetails=r.commentDetails,n.reactions=r.reactions,n.reactionDetails=r.reactionDetails)}else f=i.selectSingleNode("Comments"),f!=null&&(t.parentObjectId=n.id,n.comments=People.RecentActivity.Providers.NodeHandlerLookup.handlers.item("Comments").process(f,t)||new Array(0),n.commentDetails.count=n.comments.length),e=i.selectSingleNode("Likes"),e!=null&&(n.reactions=People.RecentActivity.Providers.NodeHandlerLookup.handlers.item("Likes").process(e,t)||new Array(0),n.reactionDetails[0].count=n.reactions.length)};People.RecentActivity.Providers.FeedObjectNodeHandler.prototype._getAlbumOrPhotoFromFeedEntryNode=function(n,t,i){var f,r,u;return(f=n===People.RecentActivity.Core.FeedObjectInfoType.photo?"PhotoObjectId":"AlbumObjectId",r=People.RecentActivity.Providers.RetailModeHelper.validateAndGetNodeValue(t,f),r==null)?null:(u=n===People.RecentActivity.Core.FeedObjectInfoType.photo?i.photoMap:i.albumMap,u==null&&!!Jx.isUndefined(u[r]))?(Jx.log.write(3,People.Social.format("No existing object found! ContactId: {0}. {1}:{2}.",i.contactId.id,f,r)),null):u[r]};People.RecentActivity.Providers.FeedObjectNodeHandler.prototype._getReactionId=function(n){var t=People.RecentActivity.Platform.Configuration.instance;return n.contactId.sourceId===People.RecentActivity.Core.NetworkId.twitter?t.getNetworkReactionInfoByType(People.RecentActivity.Core.NetworkReactionInfoType.retweet).id:t.getNetworkReactionInfoByType(People.RecentActivity.Core.NetworkReactionInfoType.like).id};People.RecentActivity.Providers.FeedObjectNodeHandler.prototype._createContactInfo=function(n){return People.RecentActivity.Providers.RetailModeHelper.createContactInfo(n.contactId.id,n.contactId.sourceId)};People.RecentActivity.Providers.FeedObjectNodeHandler.prototype._getEntryType=function(n){switch(n){case"text":return People.RecentActivity.Core.FeedEntryInfoType.text;case"photo":return People.RecentActivity.Core.FeedEntryInfoType.photo;case"album":return People.RecentActivity.Core.FeedEntryInfoType.photoAlbum;default:return People.RecentActivity.Core.FeedEntryInfoType.none}};People.RecentActivity.Providers.NodeHandlerLookup=function(){People.RecentActivity.Providers.NodeHandlerLookup._handlerMap={};People.RecentActivity.Providers.NodeHandlerLookup._handlerMap.Contacts=new People.RecentActivity.Providers.ContactsNodeHandler("Contact");People.RecentActivity.Providers.NodeHandlerLookup._handlerMap.Contact=new People.RecentActivity.Providers.ContactNodeHandler;People.RecentActivity.Providers.NodeHandlerLookup._handlerMap.Notifications=new People.RecentActivity.Providers.NotificationsNodeHandler("Notification");People.RecentActivity.Providers.NodeHandlerLookup._handlerMap.Notification=new People.RecentActivity.Providers.NotificationNodeHandler;People.RecentActivity.Providers.NodeHandlerLookup._handlerMap.Feed=new People.RecentActivity.Providers.EnumerableNodeHandler("FeedEntry");People.RecentActivity.Providers.NodeHandlerLookup._handlerMap.FeedEntry=new People.RecentActivity.Providers.FeedObjectNodeHandler("FeedEntry");People.RecentActivity.Providers.NodeHandlerLookup._handlerMap.Albums=new People.RecentActivity.Providers.EnumerableNodeHandler("Album");People.RecentActivity.Providers.NodeHandlerLookup._handlerMap.Album=new People.RecentActivity.Providers.FeedObjectNodeHandler("Album");People.RecentActivity.Providers.NodeHandlerLookup._handlerMap.Photos=new People.RecentActivity.Providers.EnumerableNodeHandler("Photo");People.RecentActivity.Providers.NodeHandlerLookup._handlerMap.Photo=new People.RecentActivity.Providers.FeedObjectNodeHandler("Photo");People.RecentActivity.Providers.NodeHandlerLookup._handlerMap.Comments=new People.RecentActivity.Providers.EnumerableNodeHandler("Comment");People.RecentActivity.Providers.NodeHandlerLookup._handlerMap.Comment=new People.RecentActivity.Providers.CommentNodeHandler;People.RecentActivity.Providers.NodeHandlerLookup._handlerMap.Likes=new People.RecentActivity.Providers.EnumerableNodeHandler("Like");People.RecentActivity.Providers.NodeHandlerLookup._handlerMap.Like=new People.RecentActivity.Providers.ReactionNodeHandler};People.RecentActivity.Providers.NodeHandlerLookup._handlerMap=null;People.RecentActivity.Providers.NodeHandlerLookup._handlers=null;Object.defineProperty(People.RecentActivity.Providers.NodeHandlerLookup,"handlers",{get:function(){return People.RecentActivity.Providers.NodeHandlerLookup._handlers==null&&(People.RecentActivity.Providers.NodeHandlerLookup._handlers=new People.RecentActivity.Providers.NodeHandlerLookup),People.RecentActivity.Providers.NodeHandlerLookup._handlers}});People.RecentActivity.Providers.NodeHandlerLookup.prototype.item=function(n){return People.RecentActivity.Providers.NodeHandlerLookup._handlerMap[n]};People.RecentActivity.Providers.NotificationNodeHandler=function(){};People.RecentActivity.Providers.NotificationNodeHandler.prototype.process=function(n,t){var i,f,u,e,r,o;return(i=n,f=People.RecentActivity.Providers.RetailModeHelper.validateAndGetNodeValue(i,"Message"),f==null)?null:(u=People.RecentActivity.Providers.RetailModeHelper.validateAndGetNodeValue(i,"ObjectId"),u==null)?null:(e=People.RecentActivity.Providers.RetailModeHelper.validateAndGetNodeValue(i,"ObjectType"),e==null)?null:(r=People.RecentActivity.Providers.RetailModeHelper.validateAndGetNodeValue(i,"SourceId"),r==null)?null:(o=People.RecentActivity.Providers.RetailModeHelper.validateAndGetNodeValue(i,"Publisher"),o==null)?null:People.RecentActivity.Core.create_notificationInfo(t.index+"_"+u,People.RecentActivity.Providers.RetailModeHelper.createContactInfo(o,r),People.RecentActivity.Providers.RetailModeHelper.getTimestamp(i),f,u,this._getNotificationType(e),"about:blank",People.RecentActivity.Providers.RetailModeHelper.getNetworkName(r),r,false,false,true)};People.RecentActivity.Providers.NotificationNodeHandler.prototype._getNotificationType=function(n){switch(n.toLowerCase()){case"entry":return People.RecentActivity.Core.NotificationInfoType.entry;case"photo":return People.RecentActivity.Core.NotificationInfoType.photo;case"album":return People.RecentActivity.Core.NotificationInfoType.photoAlbum;default:return People.RecentActivity.Core.NotificationInfoType.none}};People.RecentActivity.Providers.NotificationsNodeHandler=function(n){People.RecentActivity.Providers.EnumerableNodeHandler.call(this,n)};Jx.inherit(People.RecentActivity.Providers.NotificationsNodeHandler,People.RecentActivity.Providers.EnumerableNodeHandler);People.RecentActivity.Providers.NotificationsNodeHandler.prototype.onProcess=function(n,t){var i,r,e,o,u,f;for(i={},r=0,e=n.size;r<e;r++)(o=n.getAt(r),t.index=r,u=People.RecentActivity.Providers.NodeHandlerLookup.handlers.item(this.childTag).process(o,t),u!=null)&&(f=u.sourceId,!Jx.isUndefined(i[f])||(i[f]=[]),i[f].push(u));return i};People.RecentActivity.Providers.ReactionNodeHandler=function(){};People.RecentActivity.Providers.ReactionNodeHandler.prototype.process=function(n,t){var r,i;if(r=n,i=People.RecentActivity.Providers.RetailModeHelper.validateAndGetNodeValue(r,"Author"),i==null)return null;var f=People.RecentActivity.Providers.RetailModeHelper.createContactInfo(i,t.contactId.sourceId),u=People.RecentActivity.Platform.Configuration.instance,e=t.contactId.sourceId===People.RecentActivity.Core.NetworkId.twitter?u.getNetworkReactionInfoByType(People.RecentActivity.Core.NetworkReactionInfoType.retweet):u.getNetworkReactionInfoByType(People.RecentActivity.Core.NetworkReactionInfoType.like);return People.RecentActivity.Core.create_reactionInfo(e,f)};People.RecentActivity.Providers.RetailModeHelper=function(){};People.RecentActivity.Providers.RetailModeHelper._filePath=null;People.RecentActivity.Providers.RetailModeHelper._completed=null;People.RecentActivity.Providers.RetailModeHelper._error=null;People.RecentActivity.Providers.RetailModeHelper._platform=null;People.RecentActivity.Providers.RetailModeHelper._userCid=null;People.RecentActivity.Providers.RetailModeHelper.populateDemoDataAsync=function(n,t){People.RecentActivity.Providers.RetailModeHelper._filePath=n;People.RecentActivity.Providers.RetailModeHelper._platform=t;People.RecentActivity.Providers.RetailModeHelper.clearDemoData();try{People.RecentActivity.Providers.RetailModeHelper._userCid=People.RecentActivity.Providers.RetailModeHelper._getUserCid(t)}catch(i){Jx.log.write(2,"Failed to get the user cid: "+i.message)}return new WinJS.Promise(People.RecentActivity.Providers.RetailModeHelper._onPromiseInitialized)};People.RecentActivity.Providers.RetailModeHelper.clearDemoData=function(){try{People.RecentActivity.Providers.Cache.clear()}catch(n){Jx.log.write(2,"RetailModeHelper.ClearDemoData: failed to clear the cache: "+n.message)}};People.RecentActivity.Providers.RetailModeHelper.feedObjectSorter=function(n,t){return n.timestamp-t.timestamp};People.RecentActivity.Providers.RetailModeHelper.validateAndGetNodeValue=function(n,t){var i=n.selectSingleNode(t),r=i!=null?i.innerText:null;return Jx.isNonEmptyString(r)?r:(Jx.log.write(3,People.Social.format("No {0} found or invalid for {1}: {2}!",t,n.nodeName,n.getXml())),null)};People.RecentActivity.Providers.RetailModeHelper.getNetworkName=function(n){switch(n){case People.RecentActivity.Core.NetworkId.facebook:return"Facebook";case People.RecentActivity.Core.NetworkId.twitter:return"Twitter"}return Jx.log.write(3,"Unsupported source id: "+n),""};People.RecentActivity.Providers.RetailModeHelper.getTimestamp=function(n){if(n=n.selectSingleNode("Timestamp"),n==null||!Jx.isNonEmptyString(n.innerText))return(new Date).getTime();var t=0;try{t=parseInt(n.innerText)}catch(i){Jx.log.write(2,"Unexpected time stamp format:"+n.innerText)}return(new Date).getTime()+t*6e4};People.RecentActivity.Providers.RetailModeHelper.createContactInfo=function(n,t){var r,i;return r="",t===People.RecentActivity.Core.NetworkId.twitter&&(i=People.RecentActivity.Providers.RetailModeHelper._platform.peopleManager.tryLoadPersonBySourceIDAndObjectID(t,n),i==null&&(i=People.RecentActivity.Providers.RetailModeHelper._platform.accountManager.defaultAccount.meContact.person),r=i.firstName),People.RecentActivity.Core.create_contactInfo(n,t,r,"","",true)};People.RecentActivity.Providers.RetailModeHelper._getUserCid=function(n){var t=n.accountManager.defaultAccount.meContact.cid.value;return Microsoft.WindowsLive.Cid.CidFormatter.toString(t,Microsoft.WindowsLive.Cid.CidFormat.decimal)};People.RecentActivity.Providers.RetailModeHelper._onPromiseInitialized=function(n,t){if(People.RecentActivity.Providers.RetailModeHelper._completed=n,People.RecentActivity.Providers.RetailModeHelper._error=t,People.RecentActivity.Providers.RetailModeHelper._userCid==null){People.RecentActivity.Providers.RetailModeHelper._onError(new Error("Failed to get user cid from platform!"));return}try{Windows.Storage.StorageFile.getFileFromApplicationUriAsync(new Windows.Foundation.Uri(People.RecentActivity.Providers.RetailModeHelper._filePath)).then(People.RecentActivity.Providers.RetailModeHelper._onFileLoaded,People.RecentActivity.Providers.RetailModeHelper._onLoadError).done(People.RecentActivity.Providers.RetailModeHelper._onXmlLoaded,People.RecentActivity.Providers.RetailModeHelper._onLoadError)}catch(i){People.RecentActivity.Providers.RetailModeHelper._onError(i)}};People.RecentActivity.Providers.RetailModeHelper._onFileLoaded=function(n){var t=n;try{return Windows.Data.Xml.Dom.XmlDocument.loadFromFileAsync(t)}catch(i){return People.RecentActivity.Providers.RetailModeHelper._onError(i),null}};People.RecentActivity.Providers.RetailModeHelper._onXmlLoaded=function(n){try{var t=n;if(!People.RecentActivity.Providers.RetailModeHelper._processContacts(t))return null;People.RecentActivity.Providers.RetailModeHelper._processNotifications(t);People.RecentActivity.Providers.RetailModeHelper._onCompleted()}catch(i){People.RecentActivity.Providers.RetailModeHelper._onError(i)}return null};People.RecentActivity.Providers.RetailModeHelper._onLoadError=function(n){return People.RecentActivity.Providers.RetailModeHelper._onError(n),null};People.RecentActivity.Providers.RetailModeHelper._onCompleted=function(){Jx.log.write(4,"Successfully populated social data!");People.RecentActivity.Providers.RetailModeHelper._completed!=null&&People.RecentActivity.Providers.RetailModeHelper._completed({})};People.RecentActivity.Providers.RetailModeHelper._onError=function(n){Jx.log.write(2,"Failed to populate social data: "+n.message);People.RecentActivity.Providers.RetailModeHelper._error!=null&&People.RecentActivity.Providers.RetailModeHelper._error(n)};People.RecentActivity.Providers.RetailModeHelper._processContacts=function(n){var f=n.selectSingleNode("/Social/Contacts"),t,e,o,i,r,u;if(f==null)return People.RecentActivity.Providers.RetailModeHelper._onError(new Error("Invalid xml, no Contacts node found!")),false;if(t=People.RecentActivity.Providers.NodeHandlerLookup.handlers.item("Contacts").process(f,People.RecentActivity.Providers.create_socialNodeContext(People.RecentActivity.Providers.RetailModeHelper._userCid)),t==null||!Object.keys(t).length)return People.RecentActivity.Providers.RetailModeHelper._onError(new Error("Invalid xml, feed data is invalid or missing for all contacts!")),false;e=People.RecentActivity.Providers.FeedCache.getInstance(People.RecentActivity.Providers.RetailModeHelper._userCid);o=People.RecentActivity.Platform.Configuration.instance.whatsNewPersonId;for(i in t)r={key:i,value:t[i]},u=r.value,u.sort(People.RecentActivity.Providers.RetailModeHelper.feedObjectSorter),e.addCacheEntry(new People.RecentActivity.Platform.ContactId(o,r.key),u);return true};People.RecentActivity.Providers.RetailModeHelper._processNotifications=function(n){var f=n.selectSingleNode("/Social/Notifications"),t,e,i,r,u;if(f!=null&&(t=People.RecentActivity.Providers.NodeHandlerLookup.handlers.item("Notifications").process(f,People.RecentActivity.Providers.create_socialNodeContext(People.RecentActivity.Providers.RetailModeHelper._userCid)),t!=null&&Object.keys(t).length)){e=People.RecentActivity.Providers.NotificationCache.getInstance(People.RecentActivity.Providers.RetailModeHelper._userCid);for(i in t)r={key:i,value:t[i]},u=r.value,u.sort(People.RecentActivity.Providers.RetailModeHelper._notificationSorter),e.addCacheEntry(r.key,u)}};People.RecentActivity.Providers.RetailModeHelper._notificationSorter=function(n,t){return n.timestamp-t.timestamp};People.RecentActivity.Providers.Serializer=function(n){this.socialCache=n};People.RecentActivity.Providers.Serializer.unexpectedResponseFormatError=9e3;People.RecentActivity.Providers.Serializer.urlRegex="((http|https):\\/\\/)[^\\s]*[^\\s?.!(;:'>\\[\\],]";People.RecentActivity.Providers.Serializer.prototype.socialCache=null;People.RecentActivity.Providers.Serializer.prototype.dispose=function(){this.socialCache.clear()};People.RecentActivity.Providers.Serializer.prototype.deserialize=function(n,t,i){var u,r,f;People.RecentActivity.Core.EtwHelper.writeUnofficialEvent(People.RecentActivity.Core.EtwEventName.unofficialProviderDeserializeStart,[n.requestContext.liveCommApiName,i]);u=n.body;r=null;try{Jx.log.write(4,"Serializer::Deserialize("+t+","+i+")");switch(t){case 1:r=JSON.parse(u);break;case 2:r=Jx.isNonEmptyString(u)?JSON.parse(u):{};break;case 3:f=new Windows.Data.Xml.Dom.XmlDocument;f.loadXml(u);r=f;break;case 0:r=u}}catch(e){if(Jx.log.write(2,"Serializer::Deserialize("+t+","+i+"): Could not parse responseBody: "+e.toString()+", success: "+n.success),n.success&&!!i){Jx.log.write(1,People.Social.format("Unexpected parser error when deserialzing to type {0}: {1}.",i.toString(),e.message));this.setResponse(n,People.RecentActivity.Core.ResultCode.failure,null,r,9e3);return}}if(this.updateResult(n,t,r),n.resultInfo.code===People.RecentActivity.Core.ResultCode.success){switch(i){case 1:this.deserializeFeedEntries(n,r);break;case 7:this.deserializeAlbumsOrPhotos(n,r);break;case 8:this.deserializeAlbumsOrPhotos(n,r);break;case 9:this.deserializePhotoTags(n,r);break;case 2:this.deserializeComments(n,r);break;case 3:this.deserializeReactions(n,r);break;case 4:this.deserializeComment(n,r);break;case 5:this.deserializeReaction(n,r);break;case 6:this.deserializeNotifications(n,r);break;case 10:this.deserializeUnreadNotificationsCount(n,r);break;case 11:this.deserializeFeedExtraInfo(n,r);break;case 12:this.deserializeNotificationsExtraInfo(n,r);break;case 13:this.deserializeFeedObjectInfo(n,r)}People.RecentActivity.Core.EtwHelper.writeUnofficialEvent(People.RecentActivity.Core.EtwEventName.unofficialProviderDeserializeStop,[n.requestContext.liveCommApiName,i])}};People.RecentActivity.Providers.Serializer.prototype.serialize=function(n,t){switch(t){case 13:return this.serializeFeedObject(n);default:throw new Error("Not Implemented")}};People.RecentActivity.Providers.Serializer.prototype.deserializeFeedExtraInfo=function(){};People.RecentActivity.Providers.Serializer.prototype.deserializeContacts=function(){};People.RecentActivity.Providers.Serializer.prototype.deserializeAlbumsOrPhotos=function(){};People.RecentActivity.Providers.Serializer.prototype.deserializePhotoTags=function(){};People.RecentActivity.Providers.Serializer.prototype.deserializeNotifications=function(){};People.RecentActivity.Providers.Serializer.prototype.deserializeNotificationsExtraInfo=function(){};People.RecentActivity.Providers.Serializer.prototype.deserializeUnreadNotificationsCount=function(){};People.RecentActivity.Providers.Serializer.prototype.deserializeFeedObjectInfo=function(){};People.RecentActivity.Providers.Serializer.prototype.serializeFeedObject=function(){return null};People.RecentActivity.Providers.Serializer.prototype.setResponse=function(n,t,i,r,u){n.resultInfo.code=t;n.data=i;n.error=r;n.subErrorCode=this.normalizeErrorCode(u)};People.RecentActivity.Providers.Serializer.prototype.setUnexpectedFormatResponse=function(n,t){Jx.isNonEmptyString(t)&&Jx.log.write(2,t);this.setResponse(n,People.RecentActivity.Core.ResultCode.failure,null,null,9e3)};People.RecentActivity.Providers.Serializer.prototype.setReactionCount=function(n,t,i){for(var u,r=0;r<n.reactionDetails.length;r++)if(u=n.reactionDetails[r],u.id===t){u.count=i;break}};People.RecentActivity.Providers.Serializer.prototype.normalizeErrorCode=function(n){return isNaN(n)?0:n};People.RecentActivity.Providers.FacebookSerializer=function(n){this._likeReaction$1=People.RecentActivity.Platform.Configuration.instance.getNetworkReactionInfoByType(People.RecentActivity.Core.NetworkReactionInfoType.like);People.RecentActivity.Providers.Serializer.call(this,n)};Jx.inherit(People.RecentActivity.Providers.FacebookSerializer,People.RecentActivity.Providers.Serializer);People.RecentActivity.Providers.FacebookSerializer._legacyRestAuthErrorCode$1=190;People.RecentActivity.Providers.FacebookSerializer._legacyRestScopeErrorCode$1=200;People.RecentActivity.Providers.FacebookSerializer._graphAuthErrorCode$1=190;People.RecentActivity.Providers.FacebookSerializer._graphPermissionErrorCode$1=200;People.RecentActivity.Providers.FacebookSerializer._maxReturnedLikes$1=100;People.RecentActivity.Providers.FacebookSerializer._maxReturnedComments$1=100;People.RecentActivity.Providers.FacebookSerializer._userTagType$1="user";People.RecentActivity.Providers.FacebookSerializer._pageTagType$1="page";People.RecentActivity.Providers.FacebookSerializer._fakeCommentId$1="__fake_comment_id__";People.RecentActivity.Providers.FacebookSerializer.prototype.deserializeFeedEntries=function(n,t){var at=t,d,g,y,ut,ft,nt,i,st,r,ht,f,u,b,ct,l,yt,k,tt,it,o,e,lt,rt;if(at==null){this.setUnexpectedFormatResponse(n,"FacebookSerializer.DeserializeFeedEntries()");return}if(d=at.data,!People.RecentActivity.Providers.Utilities.isArray(d)){this.setUnexpectedFormatResponse(n,"FacebookSerializer.DeserializeFeedEntries()");return}var vt=[],a=[],v=[];for(g=0;g<d.length;g++)if(y=d[g],People.RecentActivity.Providers.FacebookValidator.validateResultSet(y)){switch(y.name){case"feedInfo":for(ut=y.fql_result_set,ft=ut.length,n.requestContext.numEntriesReceived=ft,nt=ft-1;nt>=0;nt--)if(i=ut[nt],People.RecentActivity.Providers.FacebookValidator.validateFeedEntry(i)){var s,h,c=false,p=false,et=this._getCommentDetailsInfo$1(i),ot=this._getReactionDetailsInfo$1(i),pt=this._toReactionInfoArray$1(i.likes),w=this._getContactEntities$1(i);if(w=w.concat(People.RecentActivity.Providers.EntityHelper.getLinkEntities(i.message)),People.RecentActivity.Providers.EntityHelper.sortEntities(w),st=i.actor_id.toString(),r=i.attachment,r==null){if(!Jx.isNonEmptyString(i.message))continue;h=People.RecentActivity.Core.FeedEntryInfoType.text;s=People.RecentActivity.Core.create_feedEntryStatusDataInfo(i.message)}else if(ht=this._getSharedObjectType$1(r),c=ht!==People.RecentActivity.Core.FeedObjectInfoType.none,f=this._getMediaInfo$1(r),f.length>0&&f[0].type!=="link"){u=f[0];switch(u.type){case"video":if(h=People.RecentActivity.Core.FeedEntryInfoType.video,!People.RecentActivity.Providers.FacebookValidator.validateVideoMedia(u))continue;s=People.RecentActivity.Core.create_feedEntryVideoDataInfo(i.message,r.name,r.caption,r.description,u.src,this._getVideoType$1(u.video),u.video.source_url||u.video.display_url,u.video.display_url||u.video.source_url);break;case"photo":if(!People.RecentActivity.Providers.FacebookValidator.validatePhotoMedia(u)){Jx.log.write(3,"FacebookSerializer.DeserializeFeedEntries(): photo entry.");continue}if(b=u.photo.aid,ct=u.photo.owner,c||Jx.isNullOrUndefined(ct)||ct.toString().toUpperCase()===st.toUpperCase()||(p=true),l=this.socialCache.getAlbum(b),f.length===1&&ht!==People.RecentActivity.Core.FeedObjectInfoType.photoAlbum){if(o=u.photo.pid,!c&&!p&&a.indexOf(o)!==-1)continue;h=People.RecentActivity.Core.FeedEntryInfoType.photo;e=this.socialCache.getPhoto(o);this._populatePhotoId$1(a,o);this._populateAlbumId$1(v,b);this._populatePhotoInfo$1(e,u);yt=e.data;yt.entities=w;c||(e.commentDetails=et,e.reactionDetails=ot);this._populateAlbumFromPhoto$1(l,e);s=People.RecentActivity.Core.create_feedEntryPhotoDataInfo(i.message,e,l,p);break}if(!c&&!p&&v.indexOf(b)!==-1)continue;for(h=People.RecentActivity.Core.FeedEntryInfoType.photoAlbum,this._populateAlbumId$1(v,b),k=[],tt=0;tt<f.length;tt++){if(it=f[tt],!People.RecentActivity.Providers.FacebookValidator.validatePhotoMedia(it)){Jx.log.write(3,"FacebookSerializer.DeserializeFeedEntries(): album entry.");continue}o=it.photo.pid;e=this.socialCache.getPhoto(o);this._populatePhotoId$1(a,o);this._populatePhotoInfo$1(e,it);k.push(e)}if(!k.length)continue;this._populateAlbum$1(l,k,r);c||(l.commentDetails=et,l.reactionDetails=ot);s=People.RecentActivity.Core.create_feedEntryPhotoAlbumDataInfo(i.message,l,k,p);break;default:continue}}else if(Jx.isNonEmptyString(r.href)||f.length>0){if(!Jx.isNonEmptyString(r.name)&&!Jx.isNonEmptyString(r.caption)&&!Jx.isNonEmptyString(r.description))continue;h=People.RecentActivity.Core.FeedEntryInfoType.link;lt=null;rt=r.href;f.length>0&&(lt=f[0].src,rt=Jx.isNonEmptyString(f[0].href)?f[0].href:rt);s=People.RecentActivity.Core.create_feedEntryLinkDataInfo(i.message,rt,r.name,r.caption,r.description,lt)}else if(Jx.isNonEmptyString(i.message))h=People.RecentActivity.Core.FeedEntryInfoType.text,s=People.RecentActivity.Core.create_feedEntryStatusDataInfo(i.message);else continue;var wt=this.socialCache.getContact(st),bt=People.RecentActivity.Core.create_feedEntryInfo(h,wt,s,i.attribution,w,this._getAnnotations$1(i),c),kt=People.RecentActivity.Core.create_feedObjectInfo(i.post_id,People.RecentActivity.Core.NetworkId.facebook,People.RecentActivity.Core.FeedObjectInfoType.entry,bt,i.permalink,People.RecentActivity.Providers.SocialHelper.getValidTime(i.created_time),et,[],ot,pt);vt.push(kt)}break;case"profileInfo":this.socialCache.refreshContacts(y.fql_result_set)}this.setResponse(n,People.RecentActivity.Core.ResultCode.success,vt,null);(a.length>0||v.length>0)&&(n.requestContext.requestState=[a,v])}};People.RecentActivity.Providers.FacebookSerializer.prototype.deserializeComments=function(n,t){var s=t,u,r,f,i,e,h,o;if(s==null){this.setUnexpectedFormatResponse(n,"FacebookSerializer.DeserializeComments()");return}if(u=s.data,!People.RecentActivity.Providers.Utilities.isArray(u)){this.setUnexpectedFormatResponse(n,"FacebookSerializer.DeserializeComments()");return}for(r=[],f=0;f<u.length;f++)if(i=u[f],People.RecentActivity.Providers.FacebookValidator.validateResultSet(i))switch(i.name){case"commentsInfo":for(e=0;e<i.fql_result_set.length;e++)h=i.fql_result_set[e],o=this._toCommentInfo$1(h),o!=null&&r.push(o);break;case"profileInfo":this.socialCache.refreshContacts(i.fql_result_set)}r.length<100&&(n.requestContext.feedObject.commentDetails.count=r.length);this.setResponse(n,People.RecentActivity.Core.ResultCode.success,r,null)};People.RecentActivity.Providers.FacebookSerializer.prototype.deserializeReactions=function(n,t){var s=t,u,r,f,i,e,o,h;if(s==null){this.setUnexpectedFormatResponse(n,"FacebookSerializer.DeserializeReactions()");return}if(u=s.data,!People.RecentActivity.Providers.Utilities.isArray(u)){this.setUnexpectedFormatResponse(n,"FacebookSerializer.DeserializeReactions()");return}for(r=[],f=0;f<u.length;f++)if(i=u[f],People.RecentActivity.Providers.FacebookValidator.validateResultSet(i))switch(i.name){case"likesInfo":for(e=0;e<i.fql_result_set.length;e++){if(o=i.fql_result_set[e],Jx.isNullOrUndefined(o.user_id)){Jx.log.write(3,People.Social.format("FacebookSerializer.DeserializeReactions({0}): null like.Uid",o.user_id));continue}h=People.RecentActivity.Core.create_reactionInfo(this._likeReaction$1,this.socialCache.getContact(o.user_id.toString()));r.push(h)}break;case"profileInfo":this.socialCache.refreshContacts(i.fql_result_set)}r.length<100&&this.setReactionCount(n.requestContext.feedObject,this._likeReaction$1.id,r.length);this.setResponse(n,People.RecentActivity.Core.ResultCode.success,r,null)};People.RecentActivity.Providers.FacebookSerializer.prototype.deserializeComment=function(n,t){var i=t,r,u;Jx.isNonEmptyString(i.id)||Jx.log.write(3,People.Social.format("FacebookSerializer.DeserializeComment({0}): null or empty fbComment.Id!",i.id));r=n.requestContext.comment.text;u=People.RecentActivity.Core.create_commentInfo(i.id||"__fake_comment_id__",this.socialCache.meContact,(new Date).getTime(),r,People.RecentActivity.Providers.EntityHelper.getLinkEntities(r));this.setResponse(n,People.RecentActivity.Core.ResultCode.success,u,null)};People.RecentActivity.Providers.FacebookSerializer.prototype.deserializeReaction=function(n){var t=People.RecentActivity.Core.create_reactionInfo(n.requestContext.reaction.type,this.socialCache.meContact);this.setResponse(n,People.RecentActivity.Core.ResultCode.success,t,null)};People.RecentActivity.Providers.FacebookSerializer.prototype.deserializeFeedExtraInfo=function(n,t){var f=t,r,u,i;if(f==null){this.setUnexpectedFormatResponse(n,"FacebookSerializer.DeserializeFeedExtraInfo()");return}if(r=f.data,!People.RecentActivity.Providers.Utilities.isArray(r)){this.setUnexpectedFormatResponse(n,"FacebookSerializer.DeserializeFeedExtraInfo()");return}for(u=0;u<r.length;u++){i=r[u];switch(i.name){case"albumInfo":this.socialCache.refreshAlbums(i.fql_result_set);break;case"photoInfo":this.socialCache.refreshPhotos(null,i.fql_result_set);break;case"profileInfo":this.socialCache.refreshContacts(i.fql_result_set)}}this.setResponse(n,People.RecentActivity.Core.ResultCode.success,t,null)};People.RecentActivity.Providers.FacebookSerializer.prototype.deserializeAlbumsOrPhotos=function(n,t){var rt=t,v,p,r,i,d,w,g,a,nt,f,o,s,tt,c,u,l,h,e,it;if(rt==null){this.setUnexpectedFormatResponse(n,"FacebookSerializer.DeserializeAlbumsOrPhotos()");return}if(v=rt.data,!People.RecentActivity.Providers.Utilities.isArray(v)){this.setUnexpectedFormatResponse(n,"FacebookSerializer.DeserializeAlbumsOrPhotos()");return}var b=[],y={},k=n.requestContext.expectedResponse;for(p=0;p<v.length;p++)if(r=v[p],People.RecentActivity.Providers.FacebookValidator.validateResultSet(r)){i=null;switch(r.name){case"albumInfo":for(u=0;u<r.fql_result_set.length;u++)(f=r.fql_result_set[u],f.size<=0)||Jx.isNonEmptyString(f.aid)&&(i=this.socialCache.getAlbum(f.aid),k===7&&(b.push(i),Jx.isNullOrUndefined(f.object_id)||(y[f.object_id.toString()]=i)));if(this.socialCache.refreshAlbums(r.fql_result_set),k===8&&r.fql_result_set.length>0){if(d=r.fql_result_set.length,d!==1){Jx.log.write(3,People.Social.format("FacebookSerializer.DeserializeAlbumsOrPhotos({0}): there are more than one album!",d));continue}i!=null&&People.RecentActivity.Providers.SocialHelper.updateAlbum(n.requestContext.feedObject,i)}break;case"photoInfo":if(k===8){for(w=r.fql_result_set.length-1,g=0;w>=0;w--,g++)(a=r.fql_result_set[w],People.RecentActivity.Providers.FacebookValidator.validatePhoto(a))&&(i=this.socialCache.getPhoto(a.pid),i.data.index=g,b.push(i),Jx.isNullOrUndefined(a.object_id)||(y[a.object_id.toString()]=i));nt=n.requestContext.feedObject;nt.type===People.RecentActivity.Core.FeedObjectInfoType.photoAlbum&&(f=nt.data,f.totalCount=r.fql_result_set.length)}this.socialCache.refreshPhotos(null,r.fql_result_set);break;case"commentsInfo":for(o={},u=0;u<r.fql_result_set.length;u++)(s=r.fql_result_set[u],People.RecentActivity.Providers.FacebookValidator.validateComment(s,true))&&(!Jx.isUndefined(o[s.object_id.toString()])||(o[s.object_id.toString()]=[]),o[s.object_id.toString()].push(this._toCommentInfo$1(s)));for(h in o)(e={key:h,value:o[h]},i=y[e.key],i!=null)&&(tt=e.value,i.commentDetails.count=tt.length,i.commentDetails.permissions=People.RecentActivity.Core.Permissions.add,i.comments=tt);break;case"likesInfo":for(c={},u=0;u<r.fql_result_set.length;u++)(l=r.fql_result_set[u],People.RecentActivity.Providers.FacebookValidator.validateLike(l))&&(!Jx.isUndefined(c[l.object_id.toString()])||(c[l.object_id.toString()]=[]),c[l.object_id.toString()].push(People.RecentActivity.Core.create_reactionInfo(this._likeReaction$1,this.socialCache.getContact(l.user_id.toString()))));for(h in c)(e={key:h,value:c[h]},i=y[e.key],i!=null)&&(it=e.value,i.reactionDetails=[People.RecentActivity.Core.create_reactionDetailsInfo(this._likeReaction$1.id,it.length,People.RecentActivity.Core.Permissions.full)],i.reactions=it);break;case"profileInfo":this.socialCache.refreshContacts(r.fql_result_set)}}this.setResponse(n,People.RecentActivity.Core.ResultCode.success,b,null)};People.RecentActivity.Providers.FacebookSerializer.prototype.deserializePhotoTags=function(n,t){var c=t,u,o,f,i,e,r,s,h,l;if(c==null){this.setUnexpectedFormatResponse(n,"FacebookSerializer.DeserializePhotoTags()");return}if(u=c.data,!People.RecentActivity.Providers.Utilities.isArray(u)){this.setUnexpectedFormatResponse(n,"FacebookSerializer.DeserializePhotoTags()");return}for(o=[],f=0;f<u.length;f++)if(i=u[f],People.RecentActivity.Providers.FacebookValidator.validateResultSet(i))switch(i.name){case"photoTagInfo":for(e=0;e<i.fql_result_set.length;e++)(r=i.fql_result_set[e],People.RecentActivity.Providers.FacebookValidator.validatePhotoTag(r))&&o.push(People.RecentActivity.Core.create_photoTagInfo(this.socialCache.getContact(r.subject.toString()),isNaN(r.xcoord)?0:r.xcoord,isNaN(r.ycoord)?0:r.ycoord,People.RecentActivity.Providers.SocialHelper.getValidTime(r.created)));break;case"profileInfo":this.socialCache.refreshContacts(i.fql_result_set);break;case"photoInfo":if(s=i.fql_result_set.length,s!==1){Jx.log.write(3,People.Social.format("FacebookSerializer.DeserializePhotoTags({0}): len is not 1!",s));continue}if(h=i.fql_result_set[0],!People.RecentActivity.Providers.FacebookValidator.validatePhoto(h))continue;l=this.socialCache.getPhoto(h.pid);this.socialCache.refreshPhotos(null,i.fql_result_set);People.RecentActivity.Providers.SocialHelper.updatePhoto(n.requestContext.feedObject,l)}this.setResponse(n,People.RecentActivity.Core.ResultCode.success,o,null)};People.RecentActivity.Providers.FacebookSerializer.prototype.deserializeNotifications=function(n,t){var c=t,f,h,e,o,r,s,i,u;if(c==null){this.setUnexpectedFormatResponse(n,"FacebookSerializer.DeserializeNotifications()");return}if(f=c.data,!People.RecentActivity.Providers.Utilities.isArray(f)){this.setUnexpectedFormatResponse(n,"FacebookSerializer.DeserializeNotifications()");return}for(h=[],e=[],o=0;o<f.length;o++)if(r=f[o],People.RecentActivity.Providers.FacebookValidator.validateResultSet(r))if(r.name==="notificationsInfo")for(s=r.fql_result_set.length-1;s>=0;s--)(i=r.fql_result_set[s],People.RecentActivity.Providers.FacebookValidator.validateNotification(i))&&(u=People.RecentActivity.Core.create_notificationInfo(i.notification_id,this.socialCache.getContact(i.sender_id.toString()),People.RecentActivity.Providers.SocialHelper.getValidTime(i.updated_time),i.title_text,i.object_id,this._getNotificationObjectType$1(i.object_type),i.href,n.requestContext.authInfo.networkName,n.requestContext.authInfo.userId.sourceId,false,false,!!i.is_unread),Jx.isNonEmptyString(u.objectId)&&u.objectType!==People.RecentActivity.Core.NotificationInfoType.none||e.push(u),h.push(u));else r.name==="profileInfo"&&this.socialCache.refreshContacts(r.fql_result_set);e.length>0&&(n.requestContext.requestState=[e,this.socialCache]);this.setResponse(n,People.RecentActivity.Core.ResultCode.success,h,null)};People.RecentActivity.Providers.FacebookSerializer.prototype.deserializeNotificationsExtraInfo=function(n,t){var e=t,i,f,r,u;if(e==null){this.setUnexpectedFormatResponse(n,"FacebookSerializer.DeserializeNotificationsExtraInfo()");return}if(i=e.data,!People.RecentActivity.Providers.Utilities.isArray(i)){this.setUnexpectedFormatResponse(n,"FacebookSerializer.DeserializeNotificationsExtraInfo()");return}for(f={},r=0;r<i.length;r++)u=i[r],Jx.isNonEmptyString(u.name)&&(f[u.name]=u.fql_result_set);this.setResponse(n,People.RecentActivity.Core.ResultCode.success,f,null)};People.RecentActivity.Providers.FacebookSerializer.prototype.deserializeUnreadNotificationsCount=function(n,t){var r=t,i;if(r==null){this.setUnexpectedFormatResponse(n,"FacebookSerializer.DeserializeUnreadNotificationsCount()");return}if(i=r.data,!People.RecentActivity.Providers.Utilities.isArray(i)){this.setUnexpectedFormatResponse(n,"FacebookSerializer.DeserializeUnreadNotificationsCount()");return}this.setResponse(n,People.RecentActivity.Core.ResultCode.success,i.length,null)};People.RecentActivity.Providers.FacebookSerializer.prototype.deserializeFeedObjectInfo=function(n,t){var u=t,f,i,r,e,o,s;if(!Jx.isNonEmptyString(u.id)){Jx.log.write(3,People.Social.format("FacebookSerializer.DeserializeFeedObjectInfo({0}): null or empty fbPost.Id!",u.id));this.setResponse(n,People.RecentActivity.Core.ResultCode.success,null,null);return}f=n.requestContext.feedObject;i=f.data;r=[];switch(i.type){case People.RecentActivity.Core.FeedEntryInfoType.text:e=i.data;r=People.RecentActivity.Providers.EntityHelper.getLinkEntities(e.text);break;case People.RecentActivity.Core.FeedEntryInfoType.link:o=i.data;r=People.RecentActivity.Providers.EntityHelper.getLinkEntities(o.text);break;case People.RecentActivity.Core.FeedEntryInfoType.video:s=i.data;r=People.RecentActivity.Providers.EntityHelper.getLinkEntities(s.text)}var h=People.RecentActivity.Core.create_feedEntryInfo(i.type,this.socialCache.meContact,i.data,null,r,[],false),c=People.RecentActivity.Core.create_commentDetailsInfo(0,true,People.RecentActivity.Core.Permissions.full),l=People.RecentActivity.Core.create_reactionDetailsInfo(this._likeReaction$1.id,0,People.RecentActivity.Core.Permissions.full),a=People.RecentActivity.Core.create_feedObjectInfo(u.id,People.RecentActivity.Core.NetworkId.facebook,People.RecentActivity.Core.FeedObjectInfoType.entry,h,null,(new Date).getTime(),c,[],[l],[]);this.setResponse(n,People.RecentActivity.Core.ResultCode.success,a,null)};People.RecentActivity.Providers.FacebookSerializer.prototype.serializeFeedObject=function(n){var r,t,f,i,u;r=n.data;t=new People.RecentActivity.Providers.UriQueryBuilder;switch(r.type){case People.RecentActivity.Core.FeedEntryInfoType.text:f=r.data;t.add("message",f.text);break;case People.RecentActivity.Core.FeedEntryInfoType.link:i=r.data;t.add("message",i.text);t.add("name",i.title);t.add("caption",i.caption);t.add("description",i.description);t.add("picture",i.tile);t.add("link",i.url);break;case People.RecentActivity.Core.FeedEntryInfoType.video:u=r.data;t.add("message",u.text);t.add("link",u.displayUrl)}return t.toString()};People.RecentActivity.Providers.FacebookSerializer.prototype.updateResult=function(n,t,i){var u,f,r;if((f=this._getGraphError$1(i))!=null){Jx.log.write(2,People.Social.format("FacebookSerializer.UpdateResult(GraphError,{0},{1}",f.type,f.message));r=this.normalizeErrorCode(f.code);switch(r){case 190:n.resultInfo.code=People.RecentActivity.Core.ResultCode.invalidUserCredential;break;case 200:n.resultInfo.code=People.RecentActivity.Core.ResultCode.invalidPermissions;break;default:n.resultInfo.code=People.RecentActivity.Core.ResultCode.failure}n.subErrorCode=r;n.error=i}else if((u=this._getLegacyRestError$1(i))!=null){Jx.log.write(2,People.Social.format("FacebookSerializer.UpdateResult(LegacyRestError,{0},{1}",u.error_code,u.error_msg));r=this.normalizeErrorCode(u.error_code);switch(r){case 190:case 200:n.resultInfo.code=People.RecentActivity.Core.ResultCode.invalidUserCredential;break;default:n.resultInfo.code=People.RecentActivity.Core.ResultCode.failure}n.subErrorCode=r;n.error=i}};People.RecentActivity.Providers.FacebookSerializer.prototype._getLegacyRestError$1=function(n){var t=n;return t!=null&&!Jx.isUndefined(t.error_code)?t:null};People.RecentActivity.Providers.FacebookSerializer.prototype._getGraphError$1=function(n){var t=n;return t!=null&&t.error!=null?t.error:null};People.RecentActivity.Providers.FacebookSerializer.prototype._getAnnotations$1=function(n){return Jx.isNullOrUndefined(n.target_id)?[]:[People.RecentActivity.Core.create_annotationInfo(People.RecentActivity.Core.AnnotationInfoType.wallPost,this.socialCache.getContact(n.target_id.toString()))]};People.RecentActivity.Providers.FacebookSerializer.prototype._getContactEntities$1=function(n){var i=n.message_tags,u,r,f,t,e,o;if(!Jx.isNonEmptyString(n.message)||i==null||!Jx.isUndefined(i.length)&&!i.length)return[];for(u=[],r=0,f=n.message.length;r<f;r++)if(t=i[r]==null?null:i[r][0],t!=null&&(t.type==="user"||t.type==="page")){if(!People.RecentActivity.Providers.FacebookValidator.validateMessageTag(t))continue;e=this.socialCache.getContact(t.id.toString());o=People.RecentActivity.Core.create_entityInfo(People.RecentActivity.Core.EntityInfoType.contact,e,t.offset,t.length);u.push(o)}return u};People.RecentActivity.Providers.FacebookSerializer.prototype._getMediaInfo$1=function(n){var t=n.media;return People.RecentActivity.Providers.Utilities.isArray(t)?t:[]};People.RecentActivity.Providers.FacebookSerializer.prototype._getCommentDetailsInfo$1=function(n){var i=People.RecentActivity.Providers.FacebookValidator.validateCommentsInfo(n.comment_info)?n.comment_info.comment_count:0,t=People.RecentActivity.Core.create_commentDetailsInfo(i,true,this._getCommentPermission$1(n.comment_info));return t.icon=People.RecentActivity.Platform.Configuration.instance.getCommentIcon(People.RecentActivity.Core.NetworkId.facebook),t.maximumLength=-1,t};People.RecentActivity.Providers.FacebookSerializer.prototype._getCommentPermission$1=function(n){var t=People.RecentActivity.Core.Permissions.none;return n!=null&&n.can_comment&&(t|=People.RecentActivity.Core.Permissions.add),t};People.RecentActivity.Providers.FacebookSerializer.prototype._getReactionDetailsInfo$1=function(n){var t=People.RecentActivity.Providers.FacebookValidator.validateLikesInfo(n.likes)?n.likes.count:0,i=People.RecentActivity.Core.create_reactionDetailsInfo(this._likeReaction$1.id,t,this._getLikePermission$1(n.likes));return[i]};People.RecentActivity.Providers.FacebookSerializer.prototype._getLikePermission$1=function(n){return n!=null&&n.can_like?People.RecentActivity.Core.Permissions.full:People.RecentActivity.Core.Permissions.none};People.RecentActivity.Providers.FacebookSerializer.prototype._populatePhotoId$1=function(n,t){n.indexOf(t)===-1&&n.push(t)};People.RecentActivity.Providers.FacebookSerializer.prototype._populateAlbumId$1=function(n,t){n.indexOf(t)===-1&&n.push(t)};People.RecentActivity.Providers.FacebookSerializer.prototype._populatePhotoInfo$1=function(n,t){var i,r,u;n.url=t.href;Jx.isNullOrUndefined(t.photo.fbid)||(n.id=t.photo.fbid.toString());i=n.data;!Jx.isNullOrUndefined(t.photo.index)&&t.photo.index>0&&(i.index=t.photo.index-1);i.albumId=t.photo.aid;Jx.isNullOrUndefined(t.photo.owner)||(i.owner=this.socialCache.getContact(t.photo.owner.toString()));i.caption=t.alt;i.source=i.thumbnailSource=i.originalSource=this._getHiResImgSource(t.src);r=t.photo.height;isNaN(r)||(i.sourceHeight=i.thumbnailSourceHeight=i.originalSourceHeight=r);u=t.photo.width;isNaN(u)||(i.sourceWidth=i.thumbnailSourceWidth=i.originalSourceWidth=u)};People.RecentActivity.Providers.FacebookSerializer.prototype._getHiResImgSource=function(n){var i=n,t;return Jx.isNullOrUndefined(n)||(t="_s.jpg",n.indexOf(t)===n.length-t.length&&(i=n.replace(t,"_n.jpg"))),i};People.RecentActivity.Providers.FacebookSerializer.prototype._populateAlbumFromPhoto$1=function(n,t){var r=t.data,i=n.data;i.owner=r.owner;i.totalCount=1;i.cover=t;i.photos=People.RecentActivity.Providers.SocialHelper.mergePhotos(i.photos,[t],false)};People.RecentActivity.Providers.FacebookSerializer.prototype._populateAlbum$1=function(n,t,i){var r=n.data,u=t[0];r.owner=u.data.owner;r.photos=People.RecentActivity.Providers.SocialHelper.mergePhotos(r.photos,t,false);r.name=i.name;r.description=i.description;n.url=i.href};People.RecentActivity.Providers.FacebookSerializer.prototype._toCommentInfo$1=function(n){return People.RecentActivity.Providers.FacebookValidator.validateComment(n,false)?People.RecentActivity.Core.create_commentInfo(n.id,this.socialCache.getContact(n.fromid.toString()),People.RecentActivity.Providers.SocialHelper.getValidTime(n.time),n.text,People.RecentActivity.Providers.EntityHelper.getLinkEntities(n.text)):null};People.RecentActivity.Providers.FacebookSerializer.prototype._toReactionInfoArray$1=function(n){var r=[],t,u,i;if(n==null)return r;if(n.user_likes&&(i=People.RecentActivity.Core.create_reactionInfo(this._likeReaction$1,this.socialCache.meContact),r.push(i)),People.RecentActivity.Providers.Utilities.isArray(n.friends))for(t=0;t<n.friends.length;t++)u=n.friends[t],i=People.RecentActivity.Core.create_reactionInfo(this._likeReaction$1,this.socialCache.getContact(u.toString())),r.push(i);if(People.RecentActivity.Providers.Utilities.isArray(n.sample))for(t=0;t<n.sample.length;t++)u=n.sample[t],i=People.RecentActivity.Core.create_reactionInfo(this._likeReaction$1,this.socialCache.getContact(u.toString())),r.push(i);return r};People.RecentActivity.Providers.FacebookSerializer.prototype._getVideoType$1=function(n){switch(n.source_type){case"html":return People.RecentActivity.Core.FeedEntryVideoDataInfoType.embed;case"raw":return People.RecentActivity.Core.FeedEntryVideoDataInfoType.raw;default:return People.RecentActivity.Core.FeedEntryVideoDataInfoType.none}};People.RecentActivity.Providers.FacebookSerializer.prototype._getNotificationObjectType$1=function(n){if(n==null)return People.RecentActivity.Core.NotificationInfoType.none;switch(n.toLowerCase()){case"stream":return People.RecentActivity.Core.NotificationInfoType.entry;case"photo":return People.RecentActivity.Core.NotificationInfoType.photo;case"album":return People.RecentActivity.Core.NotificationInfoType.photoAlbum;case"video":return People.RecentActivity.Core.NotificationInfoType.video;case"friend":return People.RecentActivity.Core.NotificationInfoType.person;default:return People.RecentActivity.Core.NotificationInfoType.none}};People.RecentActivity.Providers.FacebookSerializer.prototype._getSharedObjectType$1=function(n){var u=false,f=false,t,i,r;if(People.RecentActivity.Providers.Utilities.isArray(n.properties))for(t=0;t<n.properties.length;t++)(i=n.properties[t],Jx.isNullOrUndefined(i.name))||(r=i.name.toString().toUpperCase(),r==="BY"?u=true:r==="PHOTOS"&&(f=true));return u?f?People.RecentActivity.Core.FeedObjectInfoType.photoAlbum:People.RecentActivity.Core.FeedObjectInfoType.photo:People.RecentActivity.Core.FeedObjectInfoType.none};People.RecentActivity.Providers.SupSerializer=function(n){this._retweetReaction$1=People.RecentActivity.Platform.Configuration.instance.getNetworkReactionInfoByType(People.RecentActivity.Core.NetworkReactionInfoType.retweet);this._favoriteReaction$1=People.RecentActivity.Platform.Configuration.instance.getNetworkReactionInfoByType(People.RecentActivity.Core.NetworkReactionInfoType.favorite);People.RecentActivity.Providers.Serializer.call(this,n)};Jx.inherit(People.RecentActivity.Providers.SupSerializer,People.RecentActivity.Providers.Serializer);People.RecentActivity.Providers.SupSerializer._atomNamespace$1="http://www.w3.org/2005/Atom";People.RecentActivity.Providers.SupSerializer._liveNamespace$1="http://api.live.com/schemas";People.RecentActivity.Providers.SupSerializer._queriedServicesHeaderError$1="Error=";People.RecentActivity.Providers.SupSerializer._emoji$1="\ud83d";People.RecentActivity.Providers.SupSerializer._shareAnythingNamespaces$1=null,function(){People.RecentActivity.Providers.SupSerializer._shareAnythingNamespaces$1=People.Social.format('xmlns:atom="{0}" xmlns:live="{1}"',"http://www.w3.org/2005/Atom","http://api.live.com/schemas")}();People.RecentActivity.Providers.SupSerializer.prototype.deserializeFeedEntries=function(n,t){var i=t,r=i.Activities||[t];this._deserializeFeedEntriesInternal$1(r,n)};People.RecentActivity.Providers.SupSerializer.prototype.deserializeComments=function(n,t){var u=t,f=[],i,r,o,e;if(u.ReplyReaction==null)Jx.log.write(3,People.Social.format("SupSerializer.DeserializeComments({0}): null reactionResponse.ReplyReaction!",u.ReplyReaction));else if(i=u.ReplyReaction.Replies,People.RecentActivity.Providers.Utilities.isArray(i))for(r=0;r<i.length;r++)o=i[r],e=this._toCommentInfo$1(o),e!=null&&f.push(e);n.requestContext.feedObject.commentDetails.count=f.length;this.setResponse(n,People.RecentActivity.Core.ResultCode.success,f,null)};People.RecentActivity.Providers.SupSerializer.prototype.deserializeReactions=function(n,t){var i=t,o=[],s=null,l=n.requestContext.reactionType,r=0,u,f,h,c,e;switch(l){case People.RecentActivity.Core.NetworkReactionInfoType.retweet:if(s=this._retweetReaction$1.id,i.RetweetReaction==null){Jx.log.write(3,People.Social.format("SupSerializer.DeserializeReactions({0}): null reactionResponse.RetweetReaction!",i.RetweetReaction));break}if(u=i.RetweetReaction.Retweets,r=i.RetweetReaction.Count,isNaN(r)&&(Jx.log.write(3,People.Social.format("SupSerializer.DeserializeReactions({0})",r)),r=0),People.RecentActivity.Providers.Utilities.isArray(u))for(f=0;f<u.length;f++)(h=u[f],People.RecentActivity.Providers.SupValidator.validateRetweet(h))&&(c=People.RecentActivity.Core.create_reactionInfo(this._retweetReaction$1,this._toContactInfo$1(h.Author)),o.push(c));break;case People.RecentActivity.Core.NetworkReactionInfoType.favorite:if(s=this._favoriteReaction$1.id,i.FavoriteReaction==null){Jx.log.write(3,People.Social.format("SupSerializer.DeserializeReactions({0}): null reactionResponse.FavoriteReaction!",i.FavoriteReaction));break}e=i.FavoriteReaction.HasReacted;Jx.isNullOrUndefined(e)&&Jx.log.write(3,People.Social.format("SupSerializer.DeserializeReactions({0}): null reacted!",e));e&&(r=1,o.push(People.RecentActivity.Core.create_reactionInfo(this._favoriteReaction$1,this.socialCache.meContact)))}this.setReactionCount(n.requestContext.feedObject,s,r);this.setResponse(n,People.RecentActivity.Core.ResultCode.success,o,null)};People.RecentActivity.Providers.SupSerializer.prototype.deserializeComment=function(n,t){var i=t;this.setResponse(n,People.RecentActivity.Core.ResultCode.success,this._toCommentInfo$1(i),null)};People.RecentActivity.Providers.SupSerializer.prototype.deserializeReaction=function(n,t){var r=t,u=n.requestContext.reaction.type.type,i=null;switch(u){case People.RecentActivity.Core.NetworkReactionInfoType.retweet:People.RecentActivity.Providers.SupValidator.validateRetweet(r);i=People.RecentActivity.Core.create_reactionInfo(this._retweetReaction$1,this._toContactInfo$1(r.Author));break;case People.RecentActivity.Core.NetworkReactionInfoType.favorite:i=People.RecentActivity.Core.create_reactionInfo(this._favoriteReaction$1,this.socialCache.meContact)}this.setResponse(n,People.RecentActivity.Core.ResultCode.success,i,null)};People.RecentActivity.Providers.SupSerializer.prototype.deserializeNotifications=function(n,t){var i=t,r=i.Notifications;this._deserializeFeedEntriesInternal$1(r,n)};People.RecentActivity.Providers.SupSerializer.prototype.deserializeFeedObjectInfo=function(n){this.setResponse(n,People.RecentActivity.Core.ResultCode.success,null,null)};People.RecentActivity.Providers.SupSerializer.prototype.updateResult=function(n,t,i){var r,e,u,f;switch(t){case 1:n.success||(n.resultInfo.code=People.RecentActivity.Core.ResultCode.failure);i!=null&&(r=i,Jx.isUndefined(r.Status)||(Jx.log.write(4,People.Social.format("SupSerializer.UpdateResult(SupError,{0},{1})",r.Status,r.Message)),n.error=i));break;case 3:i!=null&&(e=i,u=e.selectSingleNodeNS("/atom:entry/live:subCode/text()",People.RecentActivity.Providers.SupSerializer._shareAnythingNamespaces$1),u!=null&&(n.subErrorCode=parseInt(u.nodeValue)))}f=this._getResultCodeFromQueriedServicesHeader$1(n,People.RecentActivity.Core.NetworkId.twitter);f!==People.RecentActivity.Core.ResultCode.none&&(n.resultInfo.code=f)};People.RecentActivity.Providers.SupSerializer.prototype.serializeFeedObject=function(n){var f,r,u;f=n.data;var o=f.data,t=new Windows.Data.Xml.Dom.XmlDocument,i=t.createElementNS("http://www.w3.org/2005/Atom","entry"),e=t.createElementNS("http://www.w3.org/2005/Atom","title");return t.appendChild(i),i.appendChild(e),e.appendChild(t.createTextNode(o.text)),r=t.createElementNS("http://api.live.com/schemas","live:networks"),u=t.createElementNS("http://api.live.com/schemas","live:sourceId"),i.appendChild(r),r.appendChild(u),u.appendChild(t.createTextNode(n.sourceId)),t.getXml()};People.RecentActivity.Providers.SupSerializer.prototype._deserializeFeedEntriesInternal$1=function(n,t){var s,h,e,o,u,r,f,a,v,nt,y,tt;if(!People.RecentActivity.Providers.Utilities.isArray(n)){this.setUnexpectedFormatResponse(t,"SupSerializer.DeserializeFeedEntriesInternal()");return}for(s=[],h=n.length,t.requestContext.numEntriesReceived=h,e=0;e<h;e++)if(o=n[e],People.RecentActivity.Providers.SupValidator.validateFeedEntry(o)){var c,l,i=o,p=People.RecentActivity.Core.DateTimeHelper.parseTimeStamp(i.Published),w=People.RecentActivity.Providers.SocialHelper.getTwitterEntryUrl(i.Author.ScreenName,i.ObjectId);i.OriginalActivity!=null&&(i=i.OriginalActivity);var it=this._toContactInfo$1(i.Author),b=this._getEntities$1(i.Message),rt=this._getAnnotations$1(o),k=this._getCommentDetails$1(i),d=this._getReactionDetails$1(i),g=this._getReactions$1(i);switch(i.Type){case"Photo":if(l=People.RecentActivity.Core.FeedEntryInfoType.photo,u=i.Photo,u==null){Jx.log.write(3,People.Social.format("SupSerializer.DeserializeFeedEntriesInternal({0}): null entry.Photo!",u));continue}u.author=i.Author;u.url=w;u.timestamp=p.getTime();Jx.isNonEmptyString(u.ObjectId)||(u.ObjectId=i.ObjectId+"_p");u.activityObjectId=i.ObjectId;r=this.socialCache.getPhoto(i.Photo.ObjectId);this.socialCache.refreshPhoto(i,i.Photo);r.commentDetails=k;r.reactionDetails=d;r.reactions=g;f=r.data;f.caption=i.Message!=null?i.Message.Text:"";f.entities=b;a=People.RecentActivity.Core.create_photoAlbumInfo(f.albumId,f.owner,"","",[],1,r,[r]);v=People.RecentActivity.Core.create_commentDetailsInfo(0,i.SourceId!==People.RecentActivity.Core.NetworkId.twitter,People.RecentActivity.Core.Permissions.none);v.icon=People.RecentActivity.Platform.Configuration.instance.getCommentIcon(i.SourceId);nt=People.RecentActivity.Core.create_feedObjectInfo(a.id,r.sourceId,People.RecentActivity.Core.FeedObjectInfoType.photoAlbum,a,null,r.timestamp,v,[],[],[]);c=People.RecentActivity.Core.create_feedEntryPhotoDataInfo(f.caption,r,nt,false);break;default:if(!People.RecentActivity.Providers.SupValidator.validateMessage(i.Message))continue;l=People.RecentActivity.Core.FeedEntryInfoType.text;c=People.RecentActivity.Core.create_feedEntryStatusDataInfo(i.Message.Text)}y=People.RecentActivity.Core.create_feedEntryInfo(l,it,c,i.Attribution,b,rt,false);Jx.isNonEmptyString(i.InReplyToObjectId)&&(y.parentId=i.InReplyToObjectId);tt=People.RecentActivity.Core.create_feedObjectInfo(i.ObjectId,i.SourceId,People.RecentActivity.Core.FeedObjectInfoType.entry,y,w,p.getTime(),k,[],d,g);s.unshift(tt)}this.setResponse(t,People.RecentActivity.Core.ResultCode.success,s,null)};People.RecentActivity.Providers.SupSerializer.prototype._toContactInfo$1=function(n){var t=this.socialCache.getContact(n.ObjectId);return this.socialCache.refreshContact(n),t};People.RecentActivity.Providers.SupSerializer.prototype._toCommentInfo$1=function(n){return People.RecentActivity.Providers.SupValidator.validateReply(n)?People.RecentActivity.Core.create_commentInfo(n.ObjectId,this._toContactInfo$1(n.Author),People.RecentActivity.Core.DateTimeHelper.parseTimeStamp(n.Published).getTime(),n.Message.Text,this._getEntities$1(n.Message)):null};People.RecentActivity.Providers.SupSerializer.prototype._getReactions$1=function(n){var t=[],i;return n.Reactions!=null&&n.Reactions.FavoriteReaction!=null&&n.Reactions.FavoriteReaction.HasReacted&&(i=People.RecentActivity.Core.create_reactionInfo(this._favoriteReaction$1,this.socialCache.meContact),t=[i]),t};People.RecentActivity.Providers.SupSerializer.prototype._getReactionDetails$1=function(n){var e=[],t=0,i=People.RecentActivity.Core.Permissions.none,r,u,f,o;return People.RecentActivity.Providers.SupValidator.validateRetweetDetail(n.Reactions)&&(r=n.Reactions.RetweetReaction,t=isNaN(r.Count)?0:r.Count,i=r.CanReact?People.RecentActivity.Core.Permissions.add:People.RecentActivity.Core.Permissions.none),u=this._retweetReaction$1,f=People.RecentActivity.Core.create_reactionDetailsInfo(u.id,t,i),e.push(f),t=0,i=People.RecentActivity.Core.Permissions.none,People.RecentActivity.Providers.SupValidator.validateFavoriteDetail(n.Reactions)&&(o=n.Reactions.FavoriteReaction,t=o.HasReacted?1:0,i=o.CanReact?People.RecentActivity.Core.Permissions.full:People.RecentActivity.Core.Permissions.none),u=this._favoriteReaction$1,f=People.RecentActivity.Core.create_reactionDetailsInfo(u.id,t,i),e.push(f),e};People.RecentActivity.Providers.SupSerializer.prototype._getCommentDetails$1=function(n){var u=0,r=0,f=People.RecentActivity.Core.Permissions.none,t,i;return People.RecentActivity.Providers.SupValidator.validateReplyDetail(n.Reactions)&&(t=n.Reactions.ReplyReaction,u=isNaN(t.Count)?0:t.Count,f=t.CanReact?People.RecentActivity.Core.Permissions.full:People.RecentActivity.Core.Permissions.none,r=isNaN(t.TextLimit)?0:t.TextLimit),i=People.RecentActivity.Core.create_commentDetailsInfo(u,n.SourceId!==People.RecentActivity.Core.NetworkId.twitter,f),i.icon=People.RecentActivity.Platform.Configuration.instance.getCommentIcon(n.SourceId),r>0&&(i.maximumLength=r),n.SourceId===People.RecentActivity.Core.NetworkId.twitter&&(i.prefix=People.RecentActivity.Providers.SocialHelper.getTwitterCommentPrefix(n.Author.ScreenName)),i};People.RecentActivity.Providers.SupSerializer.prototype._getAnnotations$1=function(n){var t=[],i;return n.OriginalActivity!=null&&n.ResharedMessage!=null&&(i=People.RecentActivity.Core.create_annotationRetweetInfo(this._toContactInfo$1(n.Author),n.ResharedMessage.Text),t.push(People.RecentActivity.Core.create_annotationInfo(People.RecentActivity.Core.AnnotationInfoType.retweetedBy,i))),Jx.isNonEmptyString(n.InReplyToObjectId)&&n.InReplyToUser!=null&&t.push(People.RecentActivity.Core.create_annotationInfo(People.RecentActivity.Core.AnnotationInfoType.inReplyTo,this._toContactInfo$1(n.InReplyToUser))),t};People.RecentActivity.Providers.SupSerializer.prototype._getEntities$1=function(n){var u,f,t,i,r,e;if(n==null||!People.RecentActivity.Providers.Utilities.isArray(n.Entities))return Jx.log.write(3,"SupSerializer.GetEntities()"),[];for(u=[],f=0;f<n.Entities.length;f++)if(t=n.Entities[f],People.RecentActivity.Providers.SupValidator.validateEntity(t)){i=People.RecentActivity.Core.EntityInfoType.none;r=null;switch(t.Type){case"UserMention":if(i=People.RecentActivity.Core.EntityInfoType.contact,!People.RecentActivity.Providers.SupValidator.validateContact(t.User))continue;r=this._toContactInfo$1(t.User);break;case"Hashtag":if(i=People.RecentActivity.Core.EntityInfoType.hashTag,!People.RecentActivity.Providers.SupValidator.validateLink(t.Link))continue;r=t.Link.Url;break;case"Url":if(i=People.RecentActivity.Core.EntityInfoType.link,!People.RecentActivity.Providers.SupValidator.validateLink(t.Link))continue;r=People.RecentActivity.Core.create_linkEntityInfo(t.DisplayUrl||t.Link.Url,t.Link.Url)}i!==People.RecentActivity.Core.EntityInfoType.none&&(e=People.RecentActivity.Core.create_entityInfo(i,r,t.Start,t.End-t.Start),u.push(e))}return People.RecentActivity.Providers.EntityHelper.sortEntities(u),u};People.RecentActivity.Providers.SupSerializer.prototype._getResultCodeFromQueriedServicesHeader$1=function(n,t){var i=n.headers.item("X-QueriedServices"),r,l,f,e;if(Jx.isNonEmptyString(i)||(i=n.headers.item("XQueriedServices")),!Jx.isNonEmptyString(i))return People.RecentActivity.Core.ResultCode.none;var o=null,s=i.split(","),h="Error=",c=h.length;for(r=0;r<s.length;r++){var a=s[r],v=a.trim(),u=v.split(";");if(u.length>0){if(l=u[0].trim(),l!==t)continue;for(f=1;f<u.length;f++)e=u[f].trim(),e.substr(0,c)===h&&(o=e.substring(c,e.length))}}if(o==null)return People.RecentActivity.Core.ResultCode.none;switch(o){case"Disconnected":return People.RecentActivity.Core.ResultCode.invalidUserCredential;default:return People.RecentActivity.Core.ResultCode.failure}};People.RecentActivity.Providers.Uri=function(n,t){t.length&&t.charAt(0)==="/"||(t="/"+t);this._rootUrl=n;this._path=t;this._query=new People.RecentActivity.Providers.UriQueryBuilder};People.RecentActivity.Providers.Uri._parseRe=new RegExp("^(https?://[^/]+?)(/(.*?)(\\?(.*))?)?$","i");People.RecentActivity.Providers.Uri.prototype._rootUrl=null;People.RecentActivity.Providers.Uri.prototype._path=null;People.RecentActivity.Providers.Uri.prototype._query=null;Object.defineProperty(People.RecentActivity.Providers.Uri.prototype,"host",{get:function(){return this._rootUrl}});Object.defineProperty(People.RecentActivity.Providers.Uri.prototype,"path",{get:function(){return this._path}});Object.defineProperty(People.RecentActivity.Providers.Uri.prototype,"query",{get:function(){return this._query}});People.RecentActivity.Providers.Uri.prototype.addQueryParameter=function(n,t){this._query.add(n,t)};People.RecentActivity.Providers.Uri.prototype.toString=function(){var n=this._rootUrl+this._path;return this._query.count>0&&(n+="?"+this._query),n};People.RecentActivity.Providers.UriQueryBuilder=function(){this._queryParams={}};People.RecentActivity.Providers.UriQueryBuilder.prototype._queryParams=null;Object.defineProperty(People.RecentActivity.Providers.UriQueryBuilder.prototype,"count",{get:function(){return Object.keys(this._queryParams).length}});People.RecentActivity.Providers.UriQueryBuilder.prototype.add=function(n,t){this._queryParams[n]=t};People.RecentActivity.Providers.UriQueryBuilder.prototype.remove=function(n){delete this._queryParams[n]};People.RecentActivity.Providers.UriQueryBuilder.prototype.toString=function(){var n="",i,r,u,t;for(i in this._queryParams)r={key:i,value:this._queryParams[i]},n.length>0&&(n+="&"),u=r.key,t=r.value,t=Jx.isNonEmptyString(t)?encodeURIComponent(t):"",n+=u,n+="=",n+=t;return n};People.RecentActivity.Providers.UriQueryBuilder.prototype.item=function(n){return this._queryParams[n]};People.RecentActivity.Providers.Sup.create_picture=function(n,t,i){var r={};return r.Url=n,r.Height=t,r.Width=i,r}})