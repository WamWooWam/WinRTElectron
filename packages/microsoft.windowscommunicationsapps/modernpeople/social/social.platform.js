//! Copyright (c) Microsoft Corporation. All rights reserved.
Jx.delayDefine(People,"loadSocialPlatform",function(){People.loadSocialPlatform=Jx.fnEmpty;People.loadSocialImports();People.loadSocialCore();People.RecentActivity.Platform.AuthenticationStatus={none:0,authenticated:1,authenticatedPendingTokenRefresh:2,tokenRetrievalFailed:3,userIdRetrievalFailed:4,disconnected:5};People.RecentActivity.Platform.AuthInfo=function(n){this._networkName="";this._userId=n};Jx.mix(People.RecentActivity.Platform.AuthInfo.prototype,Jx.Events);Jx.mix(People.RecentActivity.Platform.AuthInfo.prototype,People.Social.Events);People.RecentActivity.Platform.AuthInfo._instances={};People.RecentActivity.Platform.AuthInfo._initialized=false;People.RecentActivity.Platform.AuthInfo.getInstance=function(n){return Jx.isUndefined(People.RecentActivity.Platform.AuthInfo._instances[n])?null:People.RecentActivity.Platform.AuthInfo._instances[n]};People.RecentActivity.Platform.AuthInfo.hasBetaAccount=function(){for(var i=[People.RecentActivity.Core.NetworkId.twitter],t,n=0,r=i.length;n<r;n++)if(t=People.RecentActivity.Platform.AuthInfo.getInstance(i[n]),t!=null&&t._isBetaAccount)return true;return false};People.RecentActivity.Platform.AuthInfo.initialize=function(){var n,t,i,r;if(!People.RecentActivity.Platform.AuthInfo._initialized)for(Jx.log.write(4,"AuthInfo.Initialize()"),People.RecentActivity.Platform.AuthInfo._initialized=true,People.RecentActivity.Platform.Platform.instance.addListener("connectednetworkchanged",People.RecentActivity.Platform.AuthInfo._onConnectedNetworkChanged),n=0,t=People.RecentActivity.Platform.Configuration.instance.supportedNetworks;n<t.length;n++)i=t[n],r=new People.RecentActivity.Platform.AuthInfo(new People.RecentActivity.Platform.ContactId("",i)),People.RecentActivity.Platform.AuthInfo._instances[i]=r};People.RecentActivity.Platform.AuthInfo._onConnectedNetworkChanged=function(n){Jx.log.write(4,People.Social.format("AuthInfo.OnConnectedNetworkChanged({0},{1},{2})",n.sourceId,n.type,n.token!=null?n.token.length:0));var t=People.RecentActivity.Platform.AuthInfo.getInstance(n.sourceId);switch(n.type){case People.RecentActivity.Platform.ConnectedNetworkChangedEventType.connected:Jx.log.write(4,People.Social.format("AuthInfo.OnConnectedNetworkChanged::Connected({0},{1},{2})",t.status,t.isInfoValid,t.token!=null?t.token.length:0));t.networkName=n.networkName;t.socialScenarioState=n.socialScenarioState;t.publishScenarioState=n.publishScenarioState;t._setAuthInfo(n.userId,n.token);break;case People.RecentActivity.Platform.ConnectedNetworkChangedEventType.disconnected:t.status=People.RecentActivity.Platform.AuthenticationStatus.disconnected;t.socialScenarioState=n.socialScenarioState;t.publishScenarioState=n.publishScenarioState;break;case People.RecentActivity.Platform.ConnectedNetworkChangedEventType.updated:Jx.isNonEmptyString(n.networkName)&&(t.networkName=n.networkName);break;case People.RecentActivity.Platform.ConnectedNetworkChangedEventType.scenarioStateUpdated:t.publishScenarioState=n.publishScenarioState;t.socialScenarioState=n.socialScenarioState;break;case People.RecentActivity.Platform.ConnectedNetworkChangedEventType.userIdUpdated:t._setAuthInfo(n.userId)}};People.RecentActivity.Platform.AuthInfo.prototype._userId=null;People.RecentActivity.Platform.AuthInfo.prototype._token=null;People.RecentActivity.Platform.AuthInfo.prototype._tokenFromPlatform=null;People.RecentActivity.Platform.AuthInfo.prototype._socialScenarioState=0;People.RecentActivity.Platform.AuthInfo.prototype._publishScenarioState=0;People.RecentActivity.Platform.AuthInfo.prototype._status=0;People.RecentActivity.Platform.AuthInfo.prototype._isBetaAccount=false;People.RecentActivity.Platform.AuthInfo.prototype._isRefreshingToken=false;Object.defineProperty(People.RecentActivity.Platform.AuthInfo.prototype,"token",{get:function(){return this._token},set:function(n){this._token=n}});Object.defineProperty(People.RecentActivity.Platform.AuthInfo.prototype,"userId",{get:function(){return this._userId}});Object.defineProperty(People.RecentActivity.Platform.AuthInfo.prototype,"status",{get:function(){return this._status},set:function(n){this._status!==n&&(this._status=n,Jx.log.write(4,"AuthInfo.AuthenticationStatusChanged.Invoke()"),n==People.RecentActivity.Platform.AuthenticationStatus.disconnected&&(this._token=null,this._tokenFromPlatform&&(this._tokenFromPlatform.removeEventListener("changed",this._onPlatformTokenPropertyChanged.bind(this),false),this._tokenFromPlatform=null)),this.raiseEvent("authenticationstatuschanged",new People.RecentActivity.EventArgs(this)))}});Object.defineProperty(People.RecentActivity.Platform.AuthInfo.prototype,"networkName",{get:function(){return this._networkName},set:function(n){this._networkName=n}});Object.defineProperty(People.RecentActivity.Platform.AuthInfo.prototype,"socialScenarioState",{get:function(){return this._socialScenarioState},set:function(n){this._socialScenarioState=n}});Object.defineProperty(People.RecentActivity.Platform.AuthInfo.prototype,"publishScenarioState",{get:function(){return this._publishScenarioState},set:function(n){this._publishScenarioState=n}});Object.defineProperty(People.RecentActivity.Platform.AuthInfo.prototype,"isBetaAccount",{get:function(){return this._isBetaAccount}});Object.defineProperty(People.RecentActivity.Platform.AuthInfo.prototype,"isInfoValid",{get:function(){return Jx.isNonEmptyString(this._userId.id)&&Jx.isNonEmptyString(this._token)}});People.RecentActivity.Platform.AuthInfo.prototype.refreshToken=function(){var n=this._userId.sourceId;n===People.RecentActivity.Core.NetworkId.facebook?this._requestFacebookToken():this._requestSupToken()};People.RecentActivity.Platform.AuthInfo.prototype._onAuthenticationFailed=function(n){return Jx.log.write(2,People.Social.format("Failed to get SUP token: {0}.",n.message)),this._isRefreshingToken=false,this._updateStatus(true),this._status=People.RecentActivity.Platform.AuthenticationStatus.authenticatedPendingTokenRefresh,null};People.RecentActivity.Platform.AuthInfo.prototype._onUserAuthenticated=function(n){var t,f,e,r,u,i;if(this._isRefreshingToken=false,t=n,Jx.log.write(4,People.Social.format("AuthInfo.OnUserAuthenticated({0},{1})",t!=null,t.tickets!=null?t.tickets.length:0)),t!=null&&t.tickets!=null)for(f=People.RecentActivity.Platform.Configuration.instance.supTarget.toUpperCase(),e=People.RecentActivity.Platform.Configuration.instance.supPolicy.toUpperCase(),r=0;r<t.tickets.length;r++)u=t.tickets[r],i=u.request,Jx.log.write(4,People.Social.format("AuthInfo.OnUserAuthenticated::Ticket({0},{1})",i.service,i.policy)),i.service.toUpperCase()===f&&i.policy.toUpperCase()===e&&(Jx.log.write(4,People.Social.format("AuthInfo.OnUserAuthenticated({0}, {1}",u.value,t.isBetaAccount)),this._token=u.value,this._isBetaAccount=t.isBetaAccount);return this._updateStatus(true),this._status=People.RecentActivity.Platform.AuthenticationStatus.authenticatedPendingTokenRefresh,null};People.RecentActivity.Platform.AuthInfo.prototype._requestSupToken=function(){if(Jx.log.write(4,"AuthInfo.RequestSupToken"),!this._isRefreshingToken){this._isRefreshingToken=true;var n=new Windows.Security.Authentication.OnlineId.OnlineIdAuthenticator,t=new Windows.Security.Authentication.OnlineId.OnlineIdServiceTicketRequest(People.RecentActivity.Platform.Configuration.instance.supTarget,People.RecentActivity.Platform.Configuration.instance.supPolicy),i=n.authenticateUserAsync([t],Windows.Security.Authentication.OnlineId.CredentialPromptType.doNotPrompt);i.done(this._onUserAuthenticated.bind(this),this._onAuthenticationFailed.bind(this))}};People.RecentActivity.Platform.AuthInfo.prototype._requestFacebookToken=function(){var i,n,t;Jx.log.write(4,"AuthInfo::RequestFacebookToken");this._tokenFromPlatform==null&&(i=this._userId.sourceId,n=People.RecentActivity.Platform.Platform.instance.getAccount(i),n?(t=n.getTokenByScheme("Oauth2"),t?(this._tokenFromPlatform=t,this._tokenFromPlatform.addEventListener("changed",this._onPlatformTokenPropertyChanged.bind(this),false)):Jx.log.write(4,"AuthInfo::RequestFacebookToken: Failed to get token object.")):Jx.log.write(4,"AuthInfo::RequestFacebookToken: Failed to get account."));this._tokenFromPlatform!=null&&(this._token=this._tokenFromPlatform.token);this._updateStatus(true)};People.RecentActivity.Platform.AuthInfo.prototype._onPlatformTokenPropertyChanged=function(n){var i,t,r;for(i=n.detail[0],t=0,r=i.length;t<r;t++)if(i[t]==="token"){this._requestFacebookToken();break}};People.RecentActivity.Platform.AuthInfo.prototype._setAuthInfo=function(n,t){Jx.isNonEmptyString(t)&&(this._token=t);this._setUserId(n);this._updateStatus(false)};People.RecentActivity.Platform.AuthInfo.prototype._setUserId=function(n){this._userId.id=n};People.RecentActivity.Platform.AuthInfo.prototype._updateStatus=function(n){Jx.isNonEmptyString(this._userId.id)?Jx.isNonEmptyString(this._token)?this.status=People.RecentActivity.Platform.AuthenticationStatus.authenticated:n?(Jx.log.write(3,People.Social.format("AuthInfo.UpdateStatus: {0} token is null or empty!",this._userId.sourceId)),this.status=People.RecentActivity.Platform.AuthenticationStatus.tokenRetrievalFailed):(Jx.log.write(4,"AuthInfo::UpdateStatus: Still need to refresh the token."),this.status=People.RecentActivity.Platform.AuthenticationStatus.authenticatedPendingTokenRefresh):(Jx.log.write(3,People.Social.format("AuthInfo.UpdateStatus: {0} user id is null or empty!",this._userId.sourceId)),this.status=People.RecentActivity.Platform.AuthenticationStatus.userIdRetrievalFailed);Jx.log.write(4,People.Social.format("AuthInfo.UpdateStatus({0},{1},{2})",this._status,this._userId.sourceId,this._token!=null?this._token.length:0))};People.RecentActivity.Platform.Configuration=function(){};People.RecentActivity.Platform.Configuration._instance=null;People.RecentActivity.Platform.Configuration._reactionNetworkMap=null;People.RecentActivity.Platform.Configuration._reactionTypeMap=null;People.RecentActivity.Platform.Configuration._reactionIdMap=null;People.RecentActivity.Platform.Configuration._commentIcons=null;Object.defineProperty(People.RecentActivity.Platform.Configuration,"instance",{get:function(){return People.RecentActivity.Platform.Configuration._instance==null&&(People.RecentActivity.Platform.Configuration._instance=new People.RecentActivity.Platform.Configuration),People.RecentActivity.Platform.Configuration._instance},set:function(n){People.RecentActivity.Platform.Configuration._instance=n}});People.RecentActivity.Platform.Configuration.prototype._supportedNetworks=null;People.RecentActivity.Platform.Configuration.prototype._isOnline=true;Object.defineProperty(People.RecentActivity.Platform.Configuration.prototype,"cacheEnabled",{get:function(){return true},configurable:true});Object.defineProperty(People.RecentActivity.Platform.Configuration.prototype,"isOnline",{get:function(){return this._isOnline&&window.navigator.onLine},set:function(n){this._isOnline=n},configurable:true});Object.defineProperty(People.RecentActivity.Platform.Configuration.prototype,"isRetailMode",{get:function(){return Jx.appData==null||Jx.appData.localSettings()==null?false:Jx.appData.localSettings().get("RetailExperience")},configurable:true});Object.defineProperty(People.RecentActivity.Platform.Configuration.prototype,"environment",{get:function(){return Jx.app.getEnvironment()}});Object.defineProperty(People.RecentActivity.Platform.Configuration.prototype,"supRootUrl",{get:function(){return"http://co1msg1012522.msgr-tst.com"},configurable:true});Object.defineProperty(People.RecentActivity.Platform.Configuration.prototype,"supApiRootUrl",{get:function(){var n=this.environment.toUpperCase();switch(n){case"PROD":return People.RecentActivity.Platform.AuthInfo.hasBetaAccount()?"https://df-feeds.live.net":"https://feeds.live.net";case"INT":return"https://sup.live-int.com";default:return null}},configurable:true});Object.defineProperty(People.RecentActivity.Platform.Configuration.prototype,"supTarget",{get:function(){var n=this.environment.toUpperCase();switch(n){case"PROD":return"ssl.live.com";case"INT":return"ssl.live-int.com";default:return null}},configurable:true});Object.defineProperty(People.RecentActivity.Platform.Configuration.prototype,"supPolicy",{get:function(){return"mbi_ssl"},configurable:true});Object.defineProperty(People.RecentActivity.Platform.Configuration.prototype,"shareAnythingApiRootUrl",{get:function(){var n=this.environment.toUpperCase();switch(n){case"PROD":return People.RecentActivity.Platform.AuthInfo.hasBetaAccount()?"https://api-df.live.net":"https://api.live.net";case"INT":return"https://api.live-tst.net";default:return null}}});Object.defineProperty(People.RecentActivity.Platform.Configuration.prototype,"shareAnythingApiAppId",{get:function(){var n=this.environment.toUpperCase();switch(n){case"PROD":return"1141135368";case"INT":return"1745014021";default:return null}}});Object.defineProperty(People.RecentActivity.Platform.Configuration.prototype,"soxeEndpointUrl",{get:function(){var n=this.environment.toUpperCase();switch(n){case"PROD":return People.RecentActivity.Platform.AuthInfo.hasBetaAccount()?"https://profile-df.live.com/handlers/soxe.mvc":"https://profile.live.com/handlers/soxe.mvc";case"INT":return"https://profile.live-int.com/handlers/soxe.mvc";default:return null}}});Object.defineProperty(People.RecentActivity.Platform.Configuration.prototype,"soxeTarget",{get:function(){var n=this.environment.toUpperCase();switch(n){case"PROD":return"profile.live.com";case"INT":return"profile.live-int.com";default:return null}},configurable:true});Object.defineProperty(People.RecentActivity.Platform.Configuration.prototype,"soxePolicy",{get:function(){return"mbi_ssl"},configurable:true});Object.defineProperty(People.RecentActivity.Platform.Configuration.prototype,"snRootUrl",{get:function(){return"http://api.live.net"},configurable:true});Object.defineProperty(People.RecentActivity.Platform.Configuration.prototype,"legacyRestRootUrl",{get:function(){return"https://api.facebook.com"},configurable:true});Object.defineProperty(People.RecentActivity.Platform.Configuration.prototype,"fqlRootUrl",{get:function(){return"https://graph.facebook.com"},configurable:true});Object.defineProperty(People.RecentActivity.Platform.Configuration.prototype,"graphApiRootUrl",{get:function(){return"https://graph.facebook.com"},configurable:true});Object.defineProperty(People.RecentActivity.Platform.Configuration.prototype,"maxCachedContacts",{get:function(){return 20},configurable:true});Object.defineProperty(People.RecentActivity.Platform.Configuration.prototype,"maxCachedEntriesPerContact",{get:function(){return 250},configurable:true});Object.defineProperty(People.RecentActivity.Platform.Configuration.prototype,"maxCachedAlbumsPerContact",{get:function(){return 100},configurable:true});Object.defineProperty(People.RecentActivity.Platform.Configuration.prototype,"maxCachedPhotosPerAlbum",{get:function(){return 2e3},configurable:true});Object.defineProperty(People.RecentActivity.Platform.Configuration.prototype,"maxCachedPhotoTagsPerPhoto",{get:function(){return 100},configurable:true});Object.defineProperty(People.RecentActivity.Platform.Configuration.prototype,"feedEntriesBatchSize",{get:function(){return 50},configurable:true});Object.defineProperty(People.RecentActivity.Platform.Configuration.prototype,"feedEntriesMinBatchSize",{get:function(){return 40},configurable:true});Object.defineProperty(People.RecentActivity.Platform.Configuration.prototype,"feedEntriesMaxCount",{get:function(){return 250},configurable:true});Object.defineProperty(People.RecentActivity.Platform.Configuration.prototype,"maxCachedCommentsPerEntry",{get:function(){return 50},configurable:true});Object.defineProperty(People.RecentActivity.Platform.Configuration.prototype,"maxCachedReactionsPerEntry",{get:function(){return 100},configurable:true});Object.defineProperty(People.RecentActivity.Platform.Configuration.prototype,"maxCachedNotificationsPerNetwork",{get:function(){return 100},configurable:true});Object.defineProperty(People.RecentActivity.Platform.Configuration.prototype,"maxCachedFeedObjects",{get:function(){return 50},configurable:true});Object.defineProperty(People.RecentActivity.Platform.Configuration.prototype,"offlineCacheRetrievalThreshold",{get:function(){return 259200},configurable:true});Object.defineProperty(People.RecentActivity.Platform.Configuration.prototype,"supportedNetworks",{get:function(){return this._supportedNetworks==null&&(this._supportedNetworks=this._getSupportedNetworks()),this._supportedNetworks},configurable:true});Object.defineProperty(People.RecentActivity.Platform.Configuration.prototype,"supportedNetworksForRecentActivity",{get:function(){return[People.RecentActivity.Core.NetworkId.twitter]},configurable:true});Object.defineProperty(People.RecentActivity.Platform.Configuration.prototype,"supportedNetworksForPhoto",{get:function(){return[]},configurable:true});Object.defineProperty(People.RecentActivity.Platform.Configuration.prototype,"supportedNetworksForNotification",{get:function(){return[People.RecentActivity.Core.NetworkId.twitter]},configurable:true});Object.defineProperty(People.RecentActivity.Platform.Configuration.prototype,"supportedNetworksForShare",{get:function(){return[People.RecentActivity.Core.NetworkId.twitter]},configurable:true});Object.defineProperty(People.RecentActivity.Platform.Configuration.prototype,"aggregatedNetworkId",{get:function(){return People.RecentActivity.Core.NetworkId.all},configurable:true});Object.defineProperty(People.RecentActivity.Platform.Configuration.prototype,"whatsNewPersonId",{get:function(){return"__WHATSNEW__"},configurable:true});People.RecentActivity.Platform.Configuration.prototype.getNetworkReactionInfos=function(n){return this._initializeReactionMaps(),People.RecentActivity.Platform.Configuration._reactionNetworkMap[n]||[]};People.RecentActivity.Platform.Configuration.prototype.getNetworkReactionInfoByType=function(n){return this._initializeReactionMaps(),People.RecentActivity.Platform.Configuration._reactionTypeMap[n]};People.RecentActivity.Platform.Configuration.prototype.getNetworkReactionInfoById=function(n){return this._initializeReactionMaps(),People.RecentActivity.Platform.Configuration._reactionIdMap[n]};People.RecentActivity.Platform.Configuration.prototype.getCommentIcon=function(n){if(People.RecentActivity.Platform.Configuration._commentIcons==null){var t={};t[People.RecentActivity.Core.NetworkId.twitter]="";People.RecentActivity.Platform.Configuration._commentIcons=t}return People.RecentActivity.Platform.Configuration._commentIcons[n]};People.RecentActivity.Platform.Configuration.prototype.getShareRefreshDelay=function(n){switch(n){case People.RecentActivity.Core.NetworkId.twitter:return 3e3;default:return 0}};People.RecentActivity.Platform.Configuration.prototype._initializeReactionMaps=function(){var t,u,f,i,r,n;if(People.RecentActivity.Platform.Configuration._reactionNetworkMap==null)for(People.RecentActivity.Platform.Configuration._reactionNetworkMap={},People.RecentActivity.Platform.Configuration._reactionTypeMap={},People.RecentActivity.Platform.Configuration._reactionIdMap={},People.RecentActivity.Platform.Configuration._reactionNetworkMap[People.RecentActivity.Core.NetworkId.twitter]=[People.RecentActivity.Core.create_networkReactionInfo("3",People.RecentActivity.Core.NetworkReactionInfoType.favorite,"/strings/raItemReaction-Favorite-","","","ra-networkReactionTWITRFavorite",false,true),People.RecentActivity.Core.create_networkReactionInfo("2",People.RecentActivity.Core.NetworkReactionInfoType.retweet,"/strings/raItemReaction-Retweet-","","","ra-networkReactionTWITRRetweet",false,false)],t=0,u=this.supportedNetworksForRecentActivity;t<u.length;t++)if(f=u[t],i=People.RecentActivity.Platform.Configuration._reactionNetworkMap[f],i!=null)for(r=0;r<i.length;r++)n=i[r],People.RecentActivity.Platform.Configuration._reactionTypeMap[n.type]=n,People.RecentActivity.Platform.Configuration._reactionIdMap[n.id]=n};People.RecentActivity.Platform.Configuration.prototype._getSupportedNetworks=function(){var n=[],t,i,r;for(n.push.apply(n,this.supportedNetworksForRecentActivity),t=0,i=this.supportedNetworksForPhoto;t<i.length;t++)r=i[t],n.indexOf(r)===-1&&n.push(r);return n};People.RecentActivity.Platform.ConnectedNetworkChangedEventArgs=function(n,t,i){People.RecentActivity.EventArgs.call(this,n);this._type$1=t;this._souceId$1=i};Jx.inherit(People.RecentActivity.Platform.ConnectedNetworkChangedEventArgs,People.RecentActivity.EventArgs);People.RecentActivity.Platform.ConnectedNetworkChangedEventArgs.prototype._type$1=0;People.RecentActivity.Platform.ConnectedNetworkChangedEventArgs.prototype._souceId$1=null;People.RecentActivity.Platform.ConnectedNetworkChangedEventArgs.prototype._networkName$1=null;People.RecentActivity.Platform.ConnectedNetworkChangedEventArgs.prototype._networkIcon$1=null;People.RecentActivity.Platform.ConnectedNetworkChangedEventArgs.prototype._token$1=null;People.RecentActivity.Platform.ConnectedNetworkChangedEventArgs.prototype._userId$1=null;People.RecentActivity.Platform.ConnectedNetworkChangedEventArgs.prototype._socialScenarioState$1=0;People.RecentActivity.Platform.ConnectedNetworkChangedEventArgs.prototype._publishScenarioState$1=0;Object.defineProperty(People.RecentActivity.Platform.ConnectedNetworkChangedEventArgs.prototype,"type",{get:function(){return this._type$1}});Object.defineProperty(People.RecentActivity.Platform.ConnectedNetworkChangedEventArgs.prototype,"sourceId",{get:function(){return this._souceId$1}});Object.defineProperty(People.RecentActivity.Platform.ConnectedNetworkChangedEventArgs.prototype,"networkIcon",{get:function(){return this._networkIcon$1},set:function(n){this._networkIcon$1=n}});Object.defineProperty(People.RecentActivity.Platform.ConnectedNetworkChangedEventArgs.prototype,"networkName",{get:function(){return this._networkName$1},set:function(n){this._networkName$1=n}});Object.defineProperty(People.RecentActivity.Platform.ConnectedNetworkChangedEventArgs.prototype,"token",{get:function(){return this._token$1},set:function(n){this._token$1=n}});Object.defineProperty(People.RecentActivity.Platform.ConnectedNetworkChangedEventArgs.prototype,"userId",{get:function(){return this._userId$1},set:function(n){this._userId$1=n}});Object.defineProperty(People.RecentActivity.Platform.ConnectedNetworkChangedEventArgs.prototype,"socialScenarioState",{get:function(){return this._socialScenarioState$1},set:function(n){this._socialScenarioState$1=n}});Object.defineProperty(People.RecentActivity.Platform.ConnectedNetworkChangedEventArgs.prototype,"publishScenarioState",{get:function(){return this._publishScenarioState$1},set:function(n){this._publishScenarioState$1=n}});People.RecentActivity.Platform.ConnectedNetworkChangedEventType={none:0,connected:1,disconnected:2,updated:3,scenarioStateUpdated:4,userIdUpdated:5};People.RecentActivity.Platform.ContactId=function(n,t){this.id=n;this.sourceId=t};People.RecentActivity.Platform.ContactId.prototype.sourceId=null;People.RecentActivity.Platform.ContactId.prototype.id=null;People.RecentActivity.Platform.ContactId.prototype.equals=function(n){return n==null?false:n.id.toUpperCase()===this.id.toUpperCase()&&n.sourceId.toUpperCase()===this.sourceId.toUpperCase()};People.RecentActivity.Platform.Platform=function(){this._networkMap={};this._allNetworkName=Jx.res.getString("/strings/raNetworkAllName")};Jx.mix(People.RecentActivity.Platform.Platform.prototype,Jx.Events);Jx.mix(People.RecentActivity.Platform.Platform.prototype,People.Social.Events);People.RecentActivity.Platform.Platform._instance=null;Object.defineProperty(People.RecentActivity.Platform.Platform,"instance",{get:function(){return People.RecentActivity.Platform.Platform._instance==null&&(People.RecentActivity.Platform.Platform._instance=new People.RecentActivity.Platform.RealPlatform,People.RecentActivity.Platform.Platform._instance.initialize()),People.RecentActivity.Platform.Platform._instance},set:function(n){People.RecentActivity.Platform.Platform._instance=n;People.RecentActivity.Platform.Platform._instance.initialize()}});People.RecentActivity.Platform.Platform.findContactBySourceId=function(n,t){var i,u,r;if(n==null||!n.count)return null;for(i=0,u=n.count;i<u;i++)if(r=n.item(i),r.account.sourceId===t)return r;return null};People.RecentActivity.Platform.Platform.getNicknameBySourceId=function(n,t){switch(n.objectType){case"literal":return n.nickname;case"MeContact":return"";default:var i=People.RecentActivity.Platform.Platform.findContactBySourceId(n.linkedContacts,t);return i!=null?i.nickname:""}};People.RecentActivity.Platform.Platform.prototype._networkMap=null;People.RecentActivity.Platform.Platform.prototype._allNetworkName=null;People.RecentActivity.Platform.Platform.prototype._initialized=false;People.RecentActivity.Platform.Platform.prototype.getContactId=function(n,t){var i,r;return n===People.RecentActivity.Platform.Configuration.instance.whatsNewPersonId||t===People.RecentActivity.Platform.Configuration.instance.aggregatedNetworkId?new People.RecentActivity.Platform.ContactId(n,t):n===this.getUserPersonId()?People.RecentActivity.Platform.AuthInfo.getInstance(t).userId:(i=Jx.root.getPlatform().peopleManager.tryLoadPerson(n),i==null)?null:(r=this.getContactForNetwork(i,t),r!=null)?new People.RecentActivity.Platform.ContactId(r.thirdPartyObjectId,t):null};People.RecentActivity.Platform.Platform.prototype.getNetworks=function(n){var t,i;return(t=[],Jx.root==null)?(Jx.log.write(3,People.Social.format("Platform.GetNetworks({0}): Jx.root is null. The app might be shutting down.",n)),t):(n===People.RecentActivity.Platform.Configuration.instance.whatsNewPersonId||n===this.getUserPersonId()?t.push.apply(t,this.getMePersonNetworks()):t.push.apply(t,this._getPersonNetworks(n)),Jx.isNonEmptyString(People.RecentActivity.Platform.Configuration.instance.aggregatedNetworkId)&&(i=this._createNetworkInfo(People.RecentActivity.Platform.Configuration.instance.aggregatedNetworkId,null,null,this._allNetworkName,null),t.push(i)),t)};People.RecentActivity.Platform.Platform.prototype.getUserConnectableNetworks=function(){return this.getConnectableNetworks()};People.RecentActivity.Platform.Platform.prototype.getContactInfoDetails=function(){};People.RecentActivity.Platform.Platform.prototype.getPlatformPerson=function(n){var t,i;if(t=null,Jx.root==null)return Jx.log.write(2,People.Social.format("Platform.GetPlatformPerson({0},{1}): Jx.root is null!",n.id,n.name)),null;try{i=Jx.root.getPlatformCache();t=n.id===People.RecentActivity.Platform.AuthInfo.getInstance(n.sourceId).userId.id?i.getDefaultMeContact():i.getPlatform().peopleManager.tryLoadPersonBySourceIDAndObjectID(n.sourceId,n.id)}catch(r){return Jx.log.write(2,People.Social.format("Platform.GetPlatformPerson({0},{1}): Failed to get person info from LiveComm: {2}.",n.id,n.name,r.message)),null}return t};People.RecentActivity.Platform.Platform.prototype.getUserPersonId=function(){return this.getUserPerson().objectId};People.RecentActivity.Platform.Platform.prototype.getNetworkInfoById=function(n,t,i,r){if(!!Jx.isUndefined(this._networkMap[n])){var u=this._getUserContactInfo(n);Jx.isNonEmptyString(r)||(r=People.RecentActivity.Platform.AuthInfo.getInstance(n).networkName);this._networkMap[n]=this._createNetworkInfo(n,t,i,r,u)}return this._networkMap[n]};People.RecentActivity.Platform.Platform.prototype.getUserPerson=function(){var n=Jx.root.getPlatformCache().getDefaultAccount();return n.meContact.person};People.RecentActivity.Platform.Platform.prototype.initialize=function(){this._initialized||(this._initialized=true,People.RecentActivity.Platform.AuthInfo.initialize(),this.onInitialize())};People.RecentActivity.Platform.Platform.prototype.getMePersonNetworks=function(){return this._getPersonNetworks(this.getUserPersonId())};People.RecentActivity.Platform.Platform.prototype.getContactForNetwork=function(n,t){var i,r,f,u;i=n.linkedContacts;i.lock();try{for(r=0,f=i.count;r<f;r++)if(u=i.item(r),this.getSourceId(u)===t)return u}finally{i.unlock()}return null};People.RecentActivity.Platform.Platform.prototype.isNetworkSupported=function(n){return People.RecentActivity.Platform.Configuration.instance.supportedNetworks.indexOf(n)!==-1};People.RecentActivity.Platform.Platform.prototype.onConnectedNetworkChanged=function(n,t,i,r,u,f,e,o){Jx.log.write(4,People.Social.format("Platform.OnConnectedNetworkChanged({0},{1},{2},{3},{4})",n,t,i,r,u!=null));u!=null&&Jx.log.pii("Token: "+u);var s=new People.RecentActivity.Platform.ConnectedNetworkChangedEventArgs(this,n,t);s.networkIcon=i;s.networkName=r;s.token=u;s.userId=f;s.socialScenarioState=e;s.publishScenarioState=o;this.raiseEvent("connectednetworkchanged",s)};People.RecentActivity.Platform.Platform.prototype.onNetworkNameUpdated=function(n,t){if(!Jx.isUndefined(this._networkMap[n])){this._networkMap[n].name=t;this.onConnectedNetworkChanged(People.RecentActivity.Platform.ConnectedNetworkChangedEventType.updated,n,null,t,null,null,0,0)}};People.RecentActivity.Platform.Platform.prototype.onNetworkIconUpdated=function(n,t){if(!Jx.isUndefined(this._networkMap[n])){this._networkMap[n].icon=t;this.onConnectedNetworkChanged(People.RecentActivity.Platform.ConnectedNetworkChangedEventType.updated,n,t,null,null,null,0,0)}};People.RecentActivity.Platform.Platform.prototype.onNetworkScenarioStateChanged=function(n,t,i){if(!Jx.isUndefined(this._networkMap[n]))this.onConnectedNetworkChanged(People.RecentActivity.Platform.ConnectedNetworkChangedEventType.scenarioStateUpdated,n,null,null,null,null,t,i)};People.RecentActivity.Platform.Platform.prototype.onNetworkThirdPartyUserIdChanged=function(n,t){if(!Jx.isUndefined(this._networkMap[n]))this.onConnectedNetworkChanged(People.RecentActivity.Platform.ConnectedNetworkChangedEventType.userIdUpdated,n,null,null,null,t,0,0)};People.RecentActivity.Platform.Platform.prototype._getPersonNetworks=function(n){var e=Jx.root.getPlatform().peopleManager.tryLoadPerson(n),u,t,r,i,f;if(e==null)return new Array(0);u=[];t=e.linkedContacts;t.lock();try{for(r=0;r<t.count;r++)i=t.item(r),f=this.getSourceId(i),this.isNetworkSupported(f)&&u.push(this.getNetworkInfoById(f,this.getObjectId(i),this.getNetworkIcon(i),this.getNetworkName(i)))}finally{t.unlock()}return u};People.RecentActivity.Platform.Platform.prototype._getUserContactInfo=function(n){var i=People.RecentActivity.Platform.AuthInfo.getInstance(n).userId.id,t;return Jx.isNonEmptyString(i)?(t=People.RecentActivity.Core.create_contactInfo(i,n,"","","",true),this.getContactInfoDetails(t),t):(Jx.log.write(3,People.Social.format("Platform._getUserContactInfo({0}): userId is null or empty",n)),null)};People.RecentActivity.Platform.Platform.prototype._createNetworkInfo=function(n,t,i,r,u){Jx.log.write(4,People.Social.format("Platform.CreateNetworkInfo({0},{1},{2}).",n,r,u!=null));u!=null&&Jx.log.pii(People.Social.format("{0}, {1}",u.id,u.name));var f=People.RecentActivity.Platform.Configuration.instance;return People.RecentActivity.Core.create_networkInfo(n,t,i,r,n===People.RecentActivity.Core.NetworkId.all,true,true,f.getNetworkReactionInfos(n),u,f.getShareRefreshDelay(n))};People.RecentActivity.Platform.PsaStatus={none:0,connected:1,error:2,disconnected:3};People.RecentActivity.Platform.RealPlatform=function(){People.RecentActivity.Platform.Platform.call(this);this._accountChangedHandler$1=this._onAccountPropertyChanged$1.bind(this);this._accountCollectionChangedHandler$1=this._onAccountCollectionChanged$1.bind(this);this._accounts$1=[];this._accountMap$1={}};Jx.inherit(People.RecentActivity.Platform.RealPlatform,People.RecentActivity.Platform.Platform);People.RecentActivity.Platform.RealPlatform._fakeCid$1="__cid__";People.RecentActivity.Platform.RealPlatform.prototype._accountCollectionChangedHandler$1=null;People.RecentActivity.Platform.RealPlatform.prototype._accountChangedHandler$1=null;People.RecentActivity.Platform.RealPlatform.prototype._accounts$1=null;People.RecentActivity.Platform.RealPlatform.prototype._accountMap$1=null;People.RecentActivity.Platform.RealPlatform.prototype._collection$1=null;People.RecentActivity.Platform.RealPlatform.prototype.getAccount=function(n){return this._accountMap$1[n]};People.RecentActivity.Platform.RealPlatform.prototype.getUserPersonCid=function(){try{var n=Jx.root.getPlatformCache().getDefaultMeContact().cid.value;return Microsoft.WindowsLive.Cid.CidFormatter.toString(n,Microsoft.WindowsLive.Cid.CidFormat.decimal)}catch(t){return Jx.log.write(2,"Failed to get cid from platform: "+t.message),"__cid__"}};People.RecentActivity.Platform.RealPlatform.prototype.onInitialize=function(){var r=Jx.root.getPlatform().accountManager,n,i,t;if(this._collection$1=r.getConnectedAccountsByScenario(Microsoft.WindowsLive.Platform.ApplicationScenario.social,Microsoft.WindowsLive.Platform.ConnectedFilter.normal,Microsoft.WindowsLive.Platform.AccountSort.rank),this._collection$1==null){Jx.log.write(2,"The platform returned null from getConnectedAccountsByScenario");return}for(this._collection$1.addEventListener("collectionchanged",this._accountCollectionChangedHandler$1),n=0;n<this._collection$1.count;n++)t=this._collection$1.item(n),t.addEventListener("changed",this._accountChangedHandler$1),this._accounts$1.push(t),this._accountMap$1[t.sourceId]=t;for(Jx.log.write(4,People.Social.format("RealPlatform.OnInitialize(Count={0})",this._collection$1.count)),this._collection$1.unlock(),n=0,i=this._accounts$1.length;n<i;n++)t=this._accounts$1[n],this.isNetworkSupported(t.sourceId)&&this._populateAuthInfoFromAccount$1(t)};People.RecentActivity.Platform.RealPlatform.prototype.getSourceId=function(n){return n.account.sourceId};People.RecentActivity.Platform.RealPlatform.prototype.getObjectId=function(n){return n.account.objectId};People.RecentActivity.Platform.RealPlatform.prototype.getNetworkName=function(n){return this._getNetworkNameFromAccount$1(n.account)};People.RecentActivity.Platform.RealPlatform.prototype.getNetworkIcon=function(n){return this._getNetworkIconFromAccount$1(n.account)};People.RecentActivity.Platform.RealPlatform.prototype.getMePersonNetworks=function(){for(var i=[],n,t=0,r=this._accounts$1.length;t<r;t++)n=this._accounts$1[t],this.isNetworkSupported(n.sourceId)&&i.push(this.getNetworkInfoById(n.sourceId,n.objectId,this._getNetworkIconFromAccount$1(n),this._getNetworkNameFromAccount$1(n)));return i};People.RecentActivity.Platform.RealPlatform.prototype.getConnectableNetworks=function(){var u=[],t=Jx.root.getPlatform().accountManager.getConnectableAccountsByScenario(Microsoft.WindowsLive.Platform.ApplicationScenario.publish,Microsoft.WindowsLive.Platform.ConnectableFilter.normal),i,n,r;t.lock();try{for(i=0;i<t.count;i++)n=t.item(i),r=n.sourceId,this.isNetworkSupported(r)&&u.push(this.getNetworkInfoById(r,n.objectId,n.iconMediumUrl,n.displayName))}finally{t.unlock()}return u};People.RecentActivity.Platform.RealPlatform.prototype._getNetworkNameFromAccount$1=function(n){var t=n.displayName,i=n.serviceName;return(Jx.log.write(4,People.Social.format("RealPlatform.GetNetworkNameFromAccount({0},{1})",t,i)),Jx.isNonEmptyString(t))?t:Jx.isNonEmptyString(i)?i:null};People.RecentActivity.Platform.RealPlatform.prototype._getNetworkIconFromAccount$1=function(n){return n.iconMediumUrl};People.RecentActivity.Platform.RealPlatform.prototype._populateAuthInfoFromAccount$1=function(n){Jx.log.write(4,People.Social.format("RealPlatform.PopulateAuthInfoFromAccount({0},{1},{2},{3},{4})",n.sourceId,n.displayName,n.serviceName,n.socialScenarioState,n.publishScenarioState));this.onConnectedNetworkChanged(1,n.sourceId,n.iconMediumUrl,n.displayName||n.serviceName,null,n.thirdPartyUserId,this._getPsaStatus$1(n.socialScenarioState),this._getPsaStatus$1(n.publishScenarioState))};People.RecentActivity.Platform.RealPlatform.prototype._getPsaStatus$1=function(n){return n===Microsoft.WindowsLive.Platform.ScenarioState.connected?1:2};People.RecentActivity.Platform.RealPlatform.prototype._onAccountCollectionChanged$1=function(n){var r,u,t,i;r=n.target;switch(n.eType){case Microsoft.WindowsLive.Platform.CollectionChangeType.itemAdded:t=r.item(n.index);t.addEventListener("changed",this._accountChangedHandler$1);i=t.sourceId;this._accounts$1.splice(n.index,0,t);this._accountMap$1[i]=t;this.isNetworkSupported(i)&&(u=People.RecentActivity.Platform.AuthInfo.getInstance(i),u.status!==1&&this._populateAuthInfoFromAccount$1(t));break;case Microsoft.WindowsLive.Platform.CollectionChangeType.itemRemoved:if(t=this._accounts$1[n.index],t.removeEventListener("changed",this._accountChangedHandler$1),i=t.sourceId,this._accounts$1.splice(n.index,1),delete this._accountMap$1[i],this.isNetworkSupported(i))this.onConnectedNetworkChanged(2,i,null,null,null,null,3,3)}};People.RecentActivity.Platform.RealPlatform.prototype._onAccountPropertyChanged$1=function(n){var i,u;var t=n.target,f=n.detail,r=f[0];for(i=0,u=r.length;i<u;i++)switch(r[i]){case"displayName":case"serviceName":Jx.log.write(4,"Network name for "+t.sourceId+" has changed.");this.onNetworkNameUpdated(t.sourceId,this._getNetworkNameFromAccount$1(t));break;case"iconMediumUrl":Jx.log.write(4,"Network icon for "+t.sourceId+" has changed.");this.onNetworkIconUpdated(t.sourceId,this._getNetworkIconFromAccount$1(t));break;case"publishScenarioState":case"socialScenarioState":Jx.log.write(4,r[i]+" for "+t.sourceId+" has changed.");this.onNetworkScenarioStateChanged(t.sourceId,this._getPsaStatus$1(t.socialScenarioState),this._getPsaStatus$1(t.publishScenarioState));break;case"thirdPartyUserId":Jx.log.write(4,"ThirdPartyUserId for "+t.sourceId+" has changed.");this.onNetworkThirdPartyUserIdChanged(t.sourceId,t.thirdPartyUserId);break;default:Jx.log.write(4,"Ignoring updated property for "+t.sourceId+": "+r[i])}};People.RecentActivity.Platform.SocialCapabilities=function(n){var i,t;n==null?(this._personId=People.RecentActivity.Platform.Configuration.instance.whatsNewPersonId,this._isWhatsNew=true):(i=n.objectType,i==="literal"?this._temporaryContactSourceId=n.objectSourceId:(t=n,this._personId=t.objectId,this._isMe=t.objectId===People.RecentActivity.Platform.SocialCapabilities._getMePerson().objectId));this._isUserPerson=this._isWhatsNew||this._isMe;this._initialize()};Jx.mix(People.RecentActivity.Platform.SocialCapabilities.prototype,Jx.Events);Jx.mix(People.RecentActivity.Platform.SocialCapabilities.prototype,People.Social.Events);People.RecentActivity.Platform.SocialCapabilities._recentActivity="ra";People.RecentActivity.Platform.SocialCapabilities._photo="photo";People.RecentActivity.Platform.SocialCapabilities._notification="notification";People.RecentActivity.Platform.SocialCapabilities._share="share";People.RecentActivity.Platform.SocialCapabilities._capabilityMap=null;People.RecentActivity.Platform.SocialCapabilities._meCapabilities=null;People.RecentActivity.Platform.SocialCapabilities._whatsNewCapabilities=null;Object.defineProperty(People.RecentActivity.Platform.SocialCapabilities,"meCapabilities",{get:function(){return People.RecentActivity.Platform.SocialCapabilities._meCapabilities==null&&(People.RecentActivity.Platform.SocialCapabilities._meCapabilities=new People.RecentActivity.Platform.SocialCapabilities(People.RecentActivity.Platform.SocialCapabilities._getMePerson())),People.RecentActivity.Platform.SocialCapabilities._meCapabilities}});Object.defineProperty(People.RecentActivity.Platform.SocialCapabilities,"whatsNewCapabilities",{get:function(){return People.RecentActivity.Platform.SocialCapabilities._whatsNewCapabilities==null&&(People.RecentActivity.Platform.SocialCapabilities._whatsNewCapabilities=new People.RecentActivity.Platform.SocialCapabilities),People.RecentActivity.Platform.SocialCapabilities._whatsNewCapabilities}});People.RecentActivity.Platform.SocialCapabilities._getMePerson=function(){return Jx.root.getPlatformCache().getDefaultMeContact()};People.RecentActivity.Platform.SocialCapabilities.prototype._personId=null;People.RecentActivity.Platform.SocialCapabilities.prototype._isUserPerson=false;People.RecentActivity.Platform.SocialCapabilities.prototype._isWhatsNew=false;People.RecentActivity.Platform.SocialCapabilities.prototype._isMe=false;People.RecentActivity.Platform.SocialCapabilities.prototype._temporaryContactSourceId=null;People.RecentActivity.Platform.SocialCapabilities.prototype._initialized=false;People.RecentActivity.Platform.SocialCapabilities.prototype._canShowWhatsNew=false;People.RecentActivity.Platform.SocialCapabilities.prototype._canShowPhotos=false;People.RecentActivity.Platform.SocialCapabilities.prototype._canShowNotifications=false;People.RecentActivity.Platform.SocialCapabilities.prototype._canShare=false;People.RecentActivity.Platform.SocialCapabilities.prototype._accountResourceChangedHandler=null;People.RecentActivity.Platform.SocialCapabilities.prototype._accountResource=null;Object.defineProperty(People.RecentActivity.Platform.SocialCapabilities.prototype,"initialized",{get:function(){return this._initialized},set:function(n){this._initialized!==n&&(this._initialized=n,this._onPropertyChanged("Initialized"))}});Object.defineProperty(People.RecentActivity.Platform.SocialCapabilities.prototype,"canShowWhatsNew",{get:function(){return this._canShowWhatsNew},set:function(n){this._canShowWhatsNew!==n&&(this._canShowWhatsNew=n,this._onPropertyChanged("CanShowWhatsNew"))}});Object.defineProperty(People.RecentActivity.Platform.SocialCapabilities.prototype,"canShowPhotos",{get:function(){return this._canShowPhotos},set:function(n){this._canShowPhotos!==n&&(this._canShowPhotos=n,this._onPropertyChanged("CanShowPhotos"))}});Object.defineProperty(People.RecentActivity.Platform.SocialCapabilities.prototype,"canShowNotifications",{get:function(){return this._canShowNotifications},set:function(n){this._canShowNotifications!==n&&(this._canShowNotifications=n,this._onPropertyChanged("CanShowNotifications"))}});Object.defineProperty(People.RecentActivity.Platform.SocialCapabilities.prototype,"canShare",{get:function(){return this._canShare},set:function(n){this._canShare!==n&&(this._canShare=n,this._onPropertyChanged("CanShare"))}});Object.defineProperty(People.RecentActivity.Platform.SocialCapabilities.prototype,"whatsNewNetworks",{get:function(){return this._getFilteredNetworks("ra")}});People.RecentActivity.Platform.SocialCapabilities.prototype.dispose=function(){this._removeAccountResourceEventListener();this._initialized&&People.RecentActivity.Platform.Platform.instance.removeListenerSafe("connectednetworkchanged",this._onConnectedNetworkChanged,this)};People.RecentActivity.Platform.SocialCapabilities.prototype._initialize=function(){People.RecentActivity.Platform.SocialCapabilities._capabilityMap==null&&(People.RecentActivity.Platform.SocialCapabilities._capabilityMap={},People.RecentActivity.Platform.SocialCapabilities._capabilityMap.ra=People.RecentActivity.Platform.Configuration.instance.supportedNetworksForRecentActivity,People.RecentActivity.Platform.SocialCapabilities._capabilityMap.photo=People.RecentActivity.Platform.Configuration.instance.supportedNetworksForPhoto,People.RecentActivity.Platform.SocialCapabilities._capabilityMap.notification=People.RecentActivity.Platform.Configuration.instance.supportedNetworksForNotification,People.RecentActivity.Platform.SocialCapabilities._capabilityMap.share=People.RecentActivity.Platform.Configuration.instance.supportedNetworksForShare);this._accountResource=Jx.root.getPlatformCache().getDefaultAccount().getResourceByType(Microsoft.WindowsLive.Platform.ResourceType.accounts);Jx.isUndefined(this._accountResource.isInitialSyncFinished)?(Jx.log.write(4,"SocialCapabilities.Initialize(mockPlatform:true)"),this._initializeInternal()):this._isAccountResourceReady()?(Jx.log.write(4,"SocialCapabilities.Initialize(isInitialSyncFinished:true,hasEverSynchronized:true)"),this._initializeInternal()):(Jx.log.write(4,People.Social.format("SocialCapabilities.Initialize(isInitialSyncFinished:{0},hasEverSynchronized:{1})",this._accountResource.isInitialSyncFinished,this._accountResource.hasEverSynchronized)),this._addAccountResourceEventListener())};People.RecentActivity.Platform.SocialCapabilities.prototype._initializeInternal=function(){People.RecentActivity.Platform.Platform.instance.addListener("connectednetworkchanged",this._onConnectedNetworkChanged,this);var n=this._getLinkedNetworks();Jx.log.write(4,People.Social.format("SocialCapabilities.InitializeInternal(): {0}",this._getSourceIds(n)));this.canShowWhatsNew=this._canShowSocialContent(n,"ra");this.canShowPhotos=!this._isWhatsNew&&this._canShowSocialContent(n,"photo");this.canShowNotifications=this._isMe&&this._canShowSocialContent(n,"notification");this.canShare=this._canShowSocialContent(n,"share");this.initialized=true};People.RecentActivity.Platform.SocialCapabilities.prototype._isAccountResourceReady=function(){return this._accountResource.isInitialSyncFinished&&this._accountResource.hasEverSynchronized};People.RecentActivity.Platform.SocialCapabilities.prototype._tryInitializeInternal=function(){this._isAccountResourceReady()&&(this._removeAccountResourceEventListener(),this._initializeInternal())};People.RecentActivity.Platform.SocialCapabilities.prototype._onAccountResourcePropertyChanged=function(n){var r,i,t,u;for(r=n.detail,i=r[0],t=0,u=i.length;t<u;t++)switch(i[t]){case"isInitialSyncFinished":Jx.log.write(4,People.Social.format("SocialCapabilities.OnAccountResoucePropertyChanged(isInitialSyncFinished:{0})",this._accountResource.isInitialSyncFinished));this._tryInitializeInternal();break;case"hasEverSynchronized":Jx.log.write(4,People.Social.format("SocialCapabilities.OnAccountResoucePropertyChanged(hasEverSynchronized:{0})",this._accountResource.hasEverSynchronized));this._tryInitializeInternal()}};People.RecentActivity.Platform.SocialCapabilities.prototype._onPropertyChanged=function(n){this.raiseEvent("propertychanged",new People.RecentActivity.NotifyPropertyChangedEventArgs(this,n))};People.RecentActivity.Platform.SocialCapabilities.prototype._onConnectedNetworkChanged=function(n){var t;switch(n.type){case 1:t=this._isUserPerson?new Array(0):this._getLinkedNetworks();!this._canShowWhatsNew&&this._isSocialContentSupported(n.sourceId,t,"ra")&&(this.canShowWhatsNew=true);this._isWhatsNew||this._canShowPhotos||!this._isSocialContentSupported(n.sourceId,t,"photo")||(this.canShowPhotos=true);this._isMe&&!this._canShowNotifications&&this._isSocialContentSupported(n.sourceId,t,"notification")&&(this.canShowNotifications=true);!this._canShare&&this._isSocialContentSupported(n.sourceId,t,"share")&&(this.canShare=true);break;case 2:t=this._getLinkedNetworks();this._canShowWhatsNew&&!this._canShowSocialContent(t,"ra")&&(this.canShowWhatsNew=false);this._isWhatsNew||!this._canShowPhotos||this._canShowSocialContent(t,"photo")||(this.canShowPhotos=false);this._isMe&&this._canShowNotifications&&!this._canShowSocialContent(t,"notification")&&(this.canShowNotifications=false);this._canShare&&!this._canShowSocialContent(t,"share")&&(this.canShare=false)}};People.RecentActivity.Platform.SocialCapabilities.prototype._canShowSocialContent=function(n,t){for(var r,u,i=0;i<n.length;i++)if(r=n[i],People.RecentActivity.Platform.SocialCapabilities._capabilityMap[t].indexOf(r.id)!==-1&&(this._isUserPerson||(u=People.RecentActivity.Platform.AuthInfo.getInstance(r.id).status,u===People.RecentActivity.Platform.AuthenticationStatus.authenticated||u===People.RecentActivity.Platform.AuthenticationStatus.authenticatedPendingTokenRefresh)))return true;return false};People.RecentActivity.Platform.SocialCapabilities.prototype._isSocialContentSupported=function(n,t,i){var r,u;if(People.RecentActivity.Platform.SocialCapabilities._capabilityMap[i].indexOf(n)===-1)return false;if(this._isUserPerson)return true;for(r=0;r<t.length;r++)if(u=t[r],u.id===n)return true;return false};People.RecentActivity.Platform.SocialCapabilities.prototype._getFilteredNetworks=function(n){for(var f=[],i=this._getLinkedNetworks(),r,t=0,u=i.length;t<u;t++)r=i[t],People.RecentActivity.Platform.SocialCapabilities._capabilityMap[n].indexOf(r.id)!==-1&&f.push(r);return i};People.RecentActivity.Platform.SocialCapabilities.prototype._getLinkedNetworks=function(){return this._personId!=null?People.RecentActivity.Platform.Platform.instance.getNetworks(this._personId):[People.RecentActivity.Platform.Platform.instance.getNetworkInfoById(this._temporaryContactSourceId)]};People.RecentActivity.Platform.SocialCapabilities.prototype._addAccountResourceEventListener=function(){this._accountResourceChangedHandler==null&&(this._accountResourceChangedHandler=this._onAccountResourcePropertyChanged.bind(this),this._accountResource.addEventListener("changed",this._accountResourceChangedHandler))};People.RecentActivity.Platform.SocialCapabilities.prototype._removeAccountResourceEventListener=function(){this._accountResourceChangedHandler!=null&&(this._accountResource.removeEventListener("changed",this._accountResourceChangedHandler),this._accountResourceChangedHandler=null)};People.RecentActivity.Platform.SocialCapabilities.prototype._getSourceIds=function(n){var t=n.map(function(n){return n.id});return t.join(",")};People.RecentActivity.Platform.TokenRefreshedEventArgs=function(n,t,i){People.RecentActivity.EventArgs.call(this,n);this._token$1=t;this._isBetaAccount$1=i};Jx.inherit(People.RecentActivity.Platform.TokenRefreshedEventArgs,People.RecentActivity.EventArgs);People.RecentActivity.Platform.TokenRefreshedEventArgs.prototype._token$1=null;People.RecentActivity.Platform.TokenRefreshedEventArgs.prototype._isBetaAccount$1=false;Object.defineProperty(People.RecentActivity.Platform.TokenRefreshedEventArgs.prototype,"token",{get:function(){return this._token$1}});Object.defineProperty(People.RecentActivity.Platform.TokenRefreshedEventArgs.prototype,"isBetaAccount",{get:function(){return this._isBetaAccount$1}})})