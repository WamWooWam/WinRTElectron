//! Copyright (c) Microsoft Corporation. All rights reserved.
Jx.delayDefine(People.RecentActivity.UI.Modules.Feed,["FeedModule","LatestNotification"],function(){$include("$(cssResources)/Social.css"),function(){var t=4,n="whatsNewModuleState";People.RecentActivity.UI.Modules.Feed.FeedModule=function(n){this._jobSet=n};Object.defineProperty(People.RecentActivity.UI.Modules.Feed.FeedModule,"_capabilities",{get:function(){return People.RecentActivity.Platform.SocialCapabilities.whatsNewCapabilities}});People.RecentActivity.UI.Modules.Feed.FeedModule.prototype._element=null;People.RecentActivity.UI.Modules.Feed.FeedModule.prototype._elementInner=null;People.RecentActivity.UI.Modules.Feed.FeedModule.prototype._elementTiles=null;People.RecentActivity.UI.Modules.Feed.FeedModule.prototype._elementTitle=null;People.RecentActivity.UI.Modules.Feed.FeedModule.prototype._elementMessage=null;People.RecentActivity.UI.Modules.Feed.FeedModule.prototype._loader=null;People.RecentActivity.UI.Modules.Feed.FeedModule.prototype._state=null;People.RecentActivity.UI.Modules.Feed.FeedModule.prototype._scheduler=null;People.RecentActivity.UI.Modules.Feed.FeedModule.prototype._jobSet=null;People.RecentActivity.UI.Modules.Feed.FeedModule.prototype._isDisposed=false;People.RecentActivity.UI.Modules.Feed.FeedModule.prototype._isMessageSet=false;People.RecentActivity.UI.Modules.Feed.FeedModule.prototype._isMessageUpdateScheduled=false;People.RecentActivity.UI.Modules.Feed.FeedModule.prototype._areUxUpdatesSuppressed=false;People.RecentActivity.UI.Modules.Feed.FeedModule.prototype._hasPendingUpdates=false;People.RecentActivity.UI.Modules.Feed.FeedModule.prototype._identity=null;People.RecentActivity.UI.Modules.Feed.FeedModule.prototype._identityControls=null;People.RecentActivity.UI.Modules.Feed.FeedModule.prototype._identityControlIds=null;People.RecentActivity.UI.Modules.Feed.FeedModule.prototype._feed=null;People.RecentActivity.UI.Modules.Feed.FeedModule.prototype._clickHandler=null;People.RecentActivity.UI.Modules.Feed.FeedModule.prototype._keyPressHandler=null;People.RecentActivity.UI.Modules.Feed.FeedModule.prototype._listeningCapabilities=false;People.RecentActivity.UI.Modules.Feed.FeedModule.prototype.activateUI=function(n){Jx.log.write(4,"FeedModule: Activating control");this._element=n;this._elementInner=n.querySelector("#module-inner");this._elementTiles=n.querySelector("#module-tiles");this._elementTitle=n.querySelector("#module-title");this._elementTitle.id=this._elementTitle.uniqueID;this._elementTitle.innerText=Jx.res.getString("/strings/raModuleFeedTitle");this._elementMessage=n.querySelector("#module-message");People.Animation.addTapAnimation(this._element);People.Animation.addPressStyling(this._element);this._clickHandler=this._onClicked.bind(this);this._keyPressHandler=this._onKeyPress.bind(this);this._element.addEventListener("click",this._clickHandler,false);this._element.addEventListener("keypress",this._keyPressHandler,false);this._element.setAttribute("aria-labelledby",this._elementTitle.id);var t=this._layout=Jx.root.getLayout();this._tallChangedHandler=this._onIsTallChanged;t.addTallChangedEventListener(this._onIsTallChanged,this);this._scheduler=new People.RecentActivity.UI.Modules.Feed.FeedModuleScheduler(this._jobSet);this._loader=new People.RecentActivity.UI.Modules.Feed.FeedModuleLoader(this._scheduler);this._state=this._getState();this._state!=null?(Jx.log.write(4,"FeedModule: Re-using state, state="+JSON.stringify(this._state)),this._updateUX(),this._loader.loadPlatform(true,this._onPlatformLoaded.bind(this)),this._loader.loadModel(true,this._onModelLoaded.bind(this))):(Jx.log.write(4,"FeedModule: No state available, loading platform"),this._loader.loadPlatform(false,this._onPlatformLoaded.bind(this)))};People.RecentActivity.UI.Modules.Feed.FeedModule.prototype.deactivateUI=function(){this._isDisposed||(this._isDisposed=true,this._loader!=null&&(this._loader.dispose(),this._loader=null),this._scheduler!=null&&(this._scheduler.dispose(),this._scheduler=null),this._disposeCapabilities(),this._disposeFeed(),this._disposeIdentityControls(),this._disposeElements(),this._identityControls=null,this._identityControlIds=null,this._elementTiles=null,this._tallChangedHandler&&(this._layout.removeTallChangedEventListener(this._onIsTallChanged,this),this._tallChangedHandler=null))};People.RecentActivity.UI.Modules.Feed.FeedModule.prototype.getUI=function(){var n=Jx.isRtl()?"":"";return'<div class="ra-module ra-feedModule" role="button" tabindex="0"><div class="ra-feedModuleInner" id="module-inner" aria-hidden="true"><div class="ra-feedModuleTitleContainer" aria-hidden="true"><a class="ra-feedModuleTitle" id="module-title" aria-hidden="true"><\/a><a class="ra-feedModuleChevron" aria-hidden="true">'+n+'<\/a><\/div><div class="ra-feedModuleMessage" id="module-message" aria-hidden="true"><\/div><div class="ra-feedModuleTiles" id="module-tiles" aria-hidden="true"><\/div><\/div><\/div>'};People.RecentActivity.UI.Modules.Feed.FeedModule.prototype.suppressUxUpdates=function(){this._areUxUpdatesSuppressed=true};People.RecentActivity.UI.Modules.Feed.FeedModule.prototype.enableUxUpdates=function(){this._areUxUpdatesSuppressed=false;this._hasPendingUpdates&&this._updateUX()};People.RecentActivity.UI.Modules.Feed.FeedModule.prototype._onIsTallChanged=function(){this._feed&&this._feed.initialized&&this._feed.entries.count>0&&this._updateTiles()};People.RecentActivity.UI.Modules.Feed.FeedModule.prototype._disposeFeed=function(){this._feed!=null&&(this._feed.removeListenerSafe("initializecompleted",this._onFeedInitializeCompleted,this),this._feed.removeListenerSafe("refreshcompleted",this._onFeedRefreshCompleted,this),this._feed=null);this._identity!=null&&(this._identity.dispose(),this._identity=null)};People.RecentActivity.UI.Modules.Feed.FeedModule.prototype._disposeCapabilities=function(){this._listeningCapabilities&&(People.RecentActivity.UI.Modules.Feed.FeedModule._capabilities.removeListenerSafe("propertychanged",this._onCapabilitiesPropertyChanged,this),this._listeningCapabilities=false)};People.RecentActivity.UI.Modules.Feed.FeedModule.prototype._disposeIdentityControls=function(){var n,t;if(this._identityControls!=null){for(n in this._identityControls)t={key:n,value:this._identityControls[n]},t.value.shutdownUI();People.Social.clearKeys(this._identityControls);this._identityControlIds.length=0;this._elementTiles.innerHTML=""}};People.RecentActivity.UI.Modules.Feed.FeedModule.prototype._disposeElements=function(){this._element!=null&&(this._element.removeEventListener("click",this._clickHandler,false),this._element.removeEventListener("keypress",this._keyPressHandler,false),this._element.innerHTML="",this._elementTitle=null,this._elementMessage=null,this._elementInner=null,this._element=null)};People.RecentActivity.UI.Modules.Feed.FeedModule.prototype._getState=function(){var i=Jx.appData.localSettings().get(n),t;if(!Jx.isNullOrUndefined(i))try{if(t=JSON.parse(i),t.networkNames!=null)return t}catch(r){}return null};People.RecentActivity.UI.Modules.Feed.FeedModule.prototype._updateState=function(){var u=[],f=People.RecentActivity.UI.Modules.Feed.FeedModule._capabilities,r,t,e,i;if(f.canShowWhatsNew)for(r=f.whatsNewNetworks,t=0,e=r.length;t<e;t++)r[t].isAggregatedNetwork||u.push(r[t].name);i=People.RecentActivity.UI.Modules.Feed.create_feedModuleState(u);this._isStateEqual(this._state,i)||(Jx.log.write(4,"FeedModule: State updated, state="+JSON.stringify(i)),Jx.appData.localSettings().set(n,JSON.stringify(i)),this._state=i,this._updateUX())};People.RecentActivity.UI.Modules.Feed.FeedModule.prototype._updateUX=function(){var n=this;if(this._areUxUpdatesSuppressed){this._hasPendingUpdates=true;return}if(this._hasPendingUpdates=false,!this._isMessageSet){this._updateUXInternal();this._isMessageSet=true;return}this._isMessageUpdateScheduled||(this._isMessageUpdateScheduled=true,this._scheduler.schedule(function(){n._isDisposed||n._crossFade(n._elementInner,function(){n._updateUXInternal()},function(){n._isMessageSet=true;n._isMessageUpdateScheduled=false;n._scheduler.complete()})}))};People.RecentActivity.UI.Modules.Feed.FeedModule.prototype._updateUXInternal=function(){var n=this._state.networkNames;n.length>0?(Jx.removeClass(this._element,"ra-feedModuleNoNetworks"),this._elementMessage.innerText=n.join(Jx.res.getString("/strings/raModuleFeedNetworkSeparator")),this._elementTiles.style.display=""):(Jx.addClass(this._element,"ra-feedModuleNoNetworks"),this._elementMessage.innerText=Jx.res.getString("/strings/raModuleFeedUpsell"),this._elementTiles.style.display="none")};People.RecentActivity.UI.Modules.Feed.FeedModule.prototype._updateFeed=function(){if(!People.RecentActivity.UI.Modules.Feed.FeedModule._capabilities.canShowWhatsNew){this._disposeIdentityControls();return}this._loader.isModelLoaded&&(this._identity=People.RecentActivity.Identity.createWhatsNewIdentity(),this._feed=this._identity.networks.aggregatedNetwork.feed,this._feed.initialized?(this._feed.addListener("refreshcompleted",this._onFeedRefreshCompleted,this),this._feed.refresh()):(this._feed.addListener("initializecompleted",this._onFeedInitializeCompleted,this),this._feed.initialize()),this._feed.entries.count>0&&(Jx.log.write(4,"FeedModule: Loading initial set of tiles."),this._updateTiles()))};People.RecentActivity.UI.Modules.Feed.FeedModule.prototype._updateTiles=function(){var n=this;this._scheduler.schedule(function(){if(!n._isDisposed)if(n._identityControls==null)Jx.log.write(4,"FeedModule: Initializing tiles for the first time."),n._identityControls={},n._identityControlIds=[],n._updateTilesInternal();else{if(n._isListOfPublishersEqual()){n._scheduler.complete();return}Jx.log.write(4,"FeedModule: Updating tiles, fading out first.");People.Animation.fadeOut(n._elementTiles).done(function(){return n._isDisposed||(n._disposeIdentityControls(),n._updateTilesInternal()),null})}})};People.RecentActivity.UI.Modules.Feed.FeedModule.prototype._updateTilesInternal=function(){for(var e=this,f=this._feed.entries,s=People.RecentActivity.Imports.create_identityControlOptions(false,null,null,null),h=this._layout.getIsTall()&&this._layout.getLayoutState()!=="snapped"?60:40,c=People.RecentActivity.Imports.create_identityElementTileOptions(h,null),i,r,u,n=0,o=f.count;n<o;n++)if(i=this._getPublisherKey(f.item(n)),!!Jx.isUndefined(this._identityControls[i])&&(r=new People.IdentityControl(f.item(n).publisher.getDataContext(),this._jobSet,s),u=document.createElement("div"),u.innerHTML=r.getUI(People.IdentityElements.Tile,c),r.activateUI(u),this._elementTiles.appendChild(u.firstChild),this._identityControls[i]=r,this._identityControlIds.push(i),Object.keys(this._identityControls).length===t))break;this._elementTiles.style.opacity="0";People.Animation.fadeIn(this._elementTiles).done(function(){return e._isDisposed||e._scheduler.complete(),null})};People.RecentActivity.UI.Modules.Feed.FeedModule.prototype._getPublisherKey=function(n){var t=n.publisher,i=t.personId;return Jx.isNonEmptyString(i)||(i=t.sourceId+";"+t.id),i};People.RecentActivity.UI.Modules.Feed.FeedModule.prototype._crossFade=function(n,t,i){var r=this;People.Animation.fadeOut(n).done(function(){return r._isDisposed?null:(t(),People.Animation.fadeIn(n).done(function(){return r._isDisposed?null:(i(),null)}),null)})};People.RecentActivity.UI.Modules.Feed.FeedModule.prototype._isListOfPublishersEqual=function(){var u=this._feed.entries,f=u.count,e=this._identityControlIds.length,r,n,t,i;if(e>f)return false;for(r={},n=f-1,t=0;n>=0&&t<e;n--){if(i=this._getPublisherKey(u.item(n)),!!Jx.isUndefined(r[i])){if(this._identityControlIds[t]!==i)return false;t++}r[i]=true}return true};People.RecentActivity.UI.Modules.Feed.FeedModule.prototype._isStateEqual=function(n,t){var r,i,u;if(n!=null!=(t!=null))return false;if(n==null&&t==null)return true;for(r={},i=0,u=n.networkNames.length;i<u;i++)r[n.networkNames[i]]=true;for(i=0,u=t.networkNames.length;i<u;i++){if(!!Jx.isUndefined(r[t.networkNames[i]]))return false;delete r[t.networkNames[i]]}return!Object.keys(r).length};People.RecentActivity.UI.Modules.Feed.FeedModule.prototype._onModelLoaded=function(n){Jx.log.write(4,"FeedModule: Model loaded, async="+n);var t=People.RecentActivity.UI.Modules.Feed.FeedModule._capabilities;this._listeningCapabilities||(this._listeningCapabilities=true,t.addListener("propertychanged",this._onCapabilitiesPropertyChanged,this));this._updateFeed()};People.RecentActivity.UI.Modules.Feed.FeedModule.prototype._onPlatformLoaded=function(n){Jx.log.write(4,"FeedModule: Platform loaded, async="+n);var t=People.RecentActivity.UI.Modules.Feed.FeedModule._capabilities;this._listeningCapabilities||(this._listeningCapabilities=true,t.addListener("propertychanged",this._onCapabilitiesPropertyChanged,this));this._updateState();n||this._loader.loadModel(true,this._onModelLoaded.bind(this))};People.RecentActivity.UI.Modules.Feed.FeedModule.prototype._onCapabilitiesPropertyChanged=function(n){switch(n.propertyName){case"CanShowWhatsNew":this._updateState();this._updateFeed()}};People.RecentActivity.UI.Modules.Feed.FeedModule.prototype._onFeedInitializeCompleted=function(n){this._feed.removeListenerSafe("initializecompleted",this._onFeedInitializeCompleted,this);n.result.isSuccessOrPartialFailure&&(Jx.log.write(4,"FeedModule: Initialized feed, updating tiles."),this._updateTiles())};People.RecentActivity.UI.Modules.Feed.FeedModule.prototype._onFeedRefreshCompleted=function(n){this._feed.removeListenerSafe("refreshcompleted",this._onFeedRefreshCompleted,this);n.result.isSuccessOrPartialFailure&&(Jx.log.write(4,"FeedModule: Refreshed feed, updating tiles."),this._updateTiles())};People.RecentActivity.UI.Modules.Feed.FeedModule.prototype._onKeyPress=function(n){switch(n.keyCode){case WinJS.Utilities.Key.enter:case WinJS.Utilities.Key.space:People.Nav.navigate(People.Nav.getWhatsNewUri(null))}};People.RecentActivity.UI.Modules.Feed.FeedModule.prototype._onClicked=function(){People.Nav.navigate(People.Nav.getWhatsNewUri(null))}}(),function(){People.RecentActivity.UI.Modules.Feed.LatestNotification=function(n,t){this._jobSet=n;this._platformCache=t;this._notificationPreviewControls=[]};People.RecentActivity.UI.Modules.Feed.LatestNotification.prototype.getUI=function(){return"<div class='notificationList'><\/div>"};People.RecentActivity.UI.Modules.Feed.LatestNotification.prototype.activateUI=function(n){this._scheduler=new People.RecentActivity.UI.Modules.Feed.FeedModuleScheduler(this._jobSet);this._loader=new People.RecentActivity.UI.Modules.Feed.FeedModuleLoader(this._scheduler);this._notificationListElement=n;this._loader.loadPlatform(false,this._onPlatformLoaded.bind(this));this._layout=Jx.root.getLayout();People.RecentActivity.UI.Core.EventManager.events.addListener("windowresized",this._onWindowResized,this)};People.RecentActivity.UI.Modules.Feed.LatestNotification.prototype._onWindowResized=function(){this._notifications&&this._notifications.initialized&&this._notifications._notifications.count>0&&this._updateUX()};People.RecentActivity.UI.Modules.Feed.LatestNotification.prototype._showBoilerText=function(){var n=Jx.res.getString("/strings/abLatestNotificationBoilerText"),t="<div class='notificationBoilerText'>"+Jx.escapeHtml(n)+"<\/div>";this._cleanupNotifications();this._notificationListElement.innerHTML=t};People.RecentActivity.UI.Modules.Feed.LatestNotification.prototype._cleanupNotifications=function(){while(this._notificationPreviewControls.length>0){var n=this._notificationPreviewControls.pop();n.dispose()}};People.RecentActivity.UI.Modules.Feed.LatestNotification.prototype._updateUX=function(){this._capabilities.canShowNotifications?this._updateUXInternal():this._showBoilerText()};People.RecentActivity.UI.Modules.Feed.LatestNotification.prototype.deactivateUI=function(){this._isDisposed||(this._isDisposed=true,this._loader!=null&&(this._loader.dispose(),this._loader=null),this._scheduler!=null&&(this._scheduler.dispose(),this._scheduler=null),this._propertychangedListenerAdded&&(this._capabilities.removeListenerSafe("propertychanged",this._onCapabilitiesPropertyChanged,this),this._propertychangedListenerAdded=false),this._notifications&&(this._initializecompletedListenerAdded&&this._notifications.removeListenerSafe("initializecompleted",this._onInitializeCompleted,this),this._refreshcompletedListenerAdded&&this._notifications.removeListenerSafe("refreshcompleted",this._onRefreshCompleted,this),this._notifications=null),this._meIdentity!=null&&(this._meIdentity.dispose(),this._meIdentity=null),People.RecentActivity.UI.Core.EventManager.events.removeListenerSafe("windowresized",this._onWindowResized,this),this._cleanupNotifications())};People.RecentActivity.UI.Modules.Feed.LatestNotification.prototype._updateUXInternal=function(){var i=this._meIdentity.networks.aggregatedNetwork.notifications._notifications,u,f,t,r;for(this._notificationListElement.innerHTML="",u=this._layout.getIsTall()&&this._layout.getLayoutState()!=="snapped"?this._notificationListElement.offsetHeight/292-1:1,f=Math.min(i.count,u,3),t=0;t<f;t++)r=new n(i._items[t],i._network$1,this._layout),this._notificationPreviewControls.push(r),this._notificationListElement.appendChild(r.notificationContainer)};People.RecentActivity.UI.Modules.Feed.LatestNotification.prototype._updateNotifications=function(){if(this._loader.isModelLoaded){if(!this._capabilities.canShowNotifications){this._updateUX();return}this._notifications=this._meIdentity.networks.aggregatedNetwork.notifications;this._notifications.initialized?(this._notifications.addListener("refreshcompleted",this._onRefreshCompleted,this),this._refreshcompletedListenerAdded=true,this._notifications.refresh()):(this._notifications.addListener("initializecompleted",this._onInitializeCompleted,this),this._initializecompletedListenerAdded=true,this._notifications.initialize());this._notifications._notifications.count>0&&(Jx.log.write(4,"LatestNotification Module: we got notifications"),this._updateUX())}};People.RecentActivity.UI.Modules.Feed.LatestNotification.prototype._onModelLoaded=function(n){Jx.log.write(4,"LatestNotification Module: Model loaded, async="+n);this._meIdentity||(this._meIdentity=People.RecentActivity.Identity.createMeIdentity(),this._capabilities=this._meIdentity.capabilities);this._propertychangedListenerAdded||(this._capabilities.addListener("propertychanged",this._onCapabilitiesPropertyChanged,this),this._propertychangedListenerAdded=true);this._updateNotifications()};People.RecentActivity.UI.Modules.Feed.LatestNotification.prototype._onPlatformLoaded=function(n){Jx.log.write(4,"LatestNotification Module: Platform loaded, async="+n);this._meIdentity||(this._meIdentity=People.RecentActivity.Identity.createMeIdentity(),this._capabilities=this._meIdentity.capabilities);this._propertychangedListenerAdded||(this._capabilities.addListener("propertychanged",this._onCapabilitiesPropertyChanged,this),this._propertychangedListenerAdded=true);n||this._loader.loadModel(true,this._onModelLoaded.bind(this))};People.RecentActivity.UI.Modules.Feed.LatestNotification.prototype._onCapabilitiesPropertyChanged=function(n){switch(n.propertyName){case"CanShowNotifications":this._updateNotifications()}};People.RecentActivity.UI.Modules.Feed.LatestNotification.prototype._onInitializeCompleted=function(n){n.result.isSuccessOrPartialFailure&&(Jx.log.write(4,"LatestNotification: Initialized feed, update UX."),this._updateUX())};People.RecentActivity.UI.Modules.Feed.LatestNotification.prototype._onRefreshCompleted=function(n){n.result.isSuccessOrPartialFailure&&(Jx.log.write(4,"LatestNotification: Initialized feed, update UX."),this._updateUX())};var n=function(n,t,i){var u,r,f,e;this._notificationItem=n;this._network=t;this._identityControl=new People.IdentityControl;u=this._identityControl.getUI(People.IdentityElements.Tile,{className:"notificationTile",size:i.getIsTall()&&i.getLayoutState()!=="snapped"?60:40});this.notificationContainer=document.createElement("div");this.notificationContainer.tabIndex=0;this.notificationContainer.role="button";Jx.addClass(this.notificationContainer,"notificationContainer");A.addTapAnimation(this.notificationContainer);this._keyPressHandler=this._onKeyPress.bind(this);this.notificationContainer.addEventListener("keypress",this._keyPressHandler,false);this._textClickedHandler=this._onNotificationTextClicked.bind(this);this.notificationContainer.addEventListener("click",this._textClickedHandler,false);r=Jx.escapeHtml(n.info.message.replace("@","‪@‬"));this.notificationContainer.innerHTML="<a class='notificationText' title='"+r+"'>"+r+"<\/a>"+u+"<div class='notificationDetail'><div class='notificationDate'>"+Jx.escapeHtml(People.RecentActivity.UI.Core.LocalizationHelper.getTimeString(n._timestamp))+"<\/div><div class='notificationVia'>"+Jx.escapeHtml(Jx.res.loadCompoundString("/strings/socialSectionViaText",n.info.via))+"<\/div><\/div>";f=this.notificationContainer.querySelector(".notificationTile");this._identityControl.activateUI(f);e=People.RecentActivity.ContactCache.findOrCreateContact(n.info.publisher).getDataContext();this._identityControl.updateDataSource(e)};n.prototype.dispose=function(){this._keyPressHandler&&(this.notificationContainer.removeEventListener("keypress",this._keyPressHandler,false),this._keyPressHandler=null);this._textClickedHandler&&(this.notificationContainer.removeEventListener("click",this._textClickedHandler,false),this._textClickedHandler=null);this._identityControl&&(this._identityControl.shutdownUI(),this._identityControl=null);this._notificationItem=null};n.prototype._onNotificationTextClicked=function(){this._navigate()};n.prototype._onKeyPress=function(n){(n.keyCode===WinJS.Utilities.Key.enter||n.keyCode===WinJS.Utilities.Key.space)&&this._navigate()};n._convertType=function(n){var t=People.RecentActivity.FeedObjectType.none;switch(n){case People.RecentActivity.NotificationType.entry:case People.RecentActivity.NotificationType.video:t=People.RecentActivity.FeedObjectType.entry;break;case People.RecentActivity.NotificationType.photo:t=People.RecentActivity.FeedObjectType.photo;break;case People.RecentActivity.NotificationType.photoAlbum:t=People.RecentActivity.FeedObjectType.photoAlbum}return t.toString()};n.prototype._navigate=function(){switch(this._notificationItem.objectType){case People.RecentActivity.NotificationType.entry:case People.RecentActivity.NotificationType.photo:case People.RecentActivity.NotificationType.photoAlbum:this._navigateToSelfPage();break;case People.RecentActivity.NotificationType.person:this._navigateToPerson();break;default:this._navigateToUrl()}};n.prototype._navigateToSelfPage=function(){var t=People.RecentActivity.UI.Core.create_selfPageNavigationData(this._notificationItem.sourceId,this._notificationItem.objectId,n._convertType(this._notificationItem.objectType));t.fallbackUrl=this._notificationItem.link;People.RecentActivity.UI.Core.SelfPageNavigationHelper.navigate(this._network.identity.id,t)};n.prototype._navigateToPerson=function(){var n=this._notificationItem.publisher,t=n.personId,i;Jx.isNonEmptyString(t)?People.Nav.navigate(People.Nav.getViewPersonUri(t,null)):(i=n.getDataContext(),People.Nav.navigate(People.Nav.getViewPersonUri(null,i)))};n.prototype._navigateToUrl=function(){var n=this._notificationItem.link;Jx.isNonEmptyString(n)&&(People.RecentActivity.Core.BiciHelper.createClickThroughDatapoint(this._notificationItem.sourceId,People.RecentActivity.Core.BiciClickthroughAction.unsupportedNotification),People.RecentActivity.UI.Core.UriHelper.launchUri(n))}}();People.RecentActivity.UI.Modules.Feed.FeedModuleLoader=function(n){this._scheduler=n};People.RecentActivity.UI.Modules.Feed.FeedModuleLoader.prototype._scheduler=null;People.RecentActivity.UI.Modules.Feed.FeedModuleLoader.prototype._disposed=false;People.RecentActivity.UI.Modules.Feed.FeedModuleLoader.prototype._isModelLoaded=false;People.RecentActivity.UI.Modules.Feed.FeedModuleLoader.prototype._isPlatformLoaded=false;Object.defineProperty(People.RecentActivity.UI.Modules.Feed.FeedModuleLoader.prototype,"isModelLoaded",{get:function(){return this._isModelLoaded}});Object.defineProperty(People.RecentActivity.UI.Modules.Feed.FeedModuleLoader.prototype,"isPlatformLoaded",{get:function(){return this._isPlatformLoaded}});People.RecentActivity.UI.Modules.Feed.FeedModuleLoader.prototype.dispose=function(){this._disposed||(this._scheduler!=null&&this._scheduler.dispose(),this._disposed=true)};People.RecentActivity.UI.Modules.Feed.FeedModuleLoader.prototype.loadPlatform=function(n,t){var i=this;this._scheduleSequence([function(){People.loadSocialCore()},function(){People.loadSocialImports()},function(){People.loadSocialPlatform()},function(){i._isPlatformLoaded=true;t(n)}],n)};People.RecentActivity.UI.Modules.Feed.FeedModuleLoader.prototype.loadModel=function(n,t){var i=this;this._scheduleSequence([function(){try{var n=window.localStorage}catch(t){}},function(){People.loadSocialProviders()},function(){People.loadSocialModel()},function(){i._isModelLoaded=true;t(n)}],n)};People.RecentActivity.UI.Modules.Feed.FeedModuleLoader.prototype._scheduleSequence=function(n,t){for(var r,i=0;i<n.length;i++)r=n[i],this._scheduleSingleAction(r,t)};People.RecentActivity.UI.Modules.Feed.FeedModuleLoader.prototype._scheduleSingleAction=function(n,t){var i=this;t?this._scheduler.schedule(function(){i._disposed||n();i._scheduler.complete()}):n()};People.RecentActivity.UI.Modules.Feed.FeedModuleScheduler=function(n){this._jobSet=n;this._tasks=[]};People.RecentActivity.UI.Modules.Feed.FeedModuleScheduler.prototype._tasks=null;People.RecentActivity.UI.Modules.Feed.FeedModuleScheduler.prototype._current=null;People.RecentActivity.UI.Modules.Feed.FeedModuleScheduler.prototype._disposed=false;People.RecentActivity.UI.Modules.Feed.FeedModuleScheduler.prototype._jobSet=null;People.RecentActivity.UI.Modules.Feed.FeedModuleScheduler.prototype._pending=false;People.RecentActivity.UI.Modules.Feed.FeedModuleScheduler.prototype.dispose=function(){this._disposed||(this._disposed=true,this._current=null,this._tasks.length=0)};People.RecentActivity.UI.Modules.Feed.FeedModuleScheduler.prototype.schedule=function(n){this._disposed||(this._tasks.push(n),this._run())};People.RecentActivity.UI.Modules.Feed.FeedModuleScheduler.prototype.complete=function(){this._disposed||(this._current=null,this._run())};People.RecentActivity.UI.Modules.Feed.FeedModuleScheduler.prototype._run=function(){var n=this;this._pending||(this._pending=true,this._jobSet.addUIJob(null,function(){n._pending=false;!n._disposed&&n._current==null&&n._tasks.length>0&&(n._current=n._tasks.shift(),n._current())},null,People.Priority.feedModule))};People.RecentActivity.UI.Modules.Feed.create_feedModuleState=function(n){var t={};return t.networkNames=n,t}})