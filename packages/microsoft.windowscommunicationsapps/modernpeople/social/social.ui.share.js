//! Copyright (c) Microsoft Corporation. All rights reserved.
Jx.delayDefine(People.RecentActivity.UI.Share,["ShareLayout","ShareControl"],function(){People.loadSocialModel();People.loadSocialUICore();$include("$(cssResources)/Social.css");People.RecentActivity.UI.Share.CanvasLinkInsertedEventArgs=function(n,t){People.RecentActivity.EventArgs.call(this,n);this._linkUrl$1=t};Jx.inherit(People.RecentActivity.UI.Share.CanvasLinkInsertedEventArgs,People.RecentActivity.EventArgs);People.RecentActivity.UI.Share.CanvasLinkInsertedEventArgs.prototype._linkUrl$1=null;Object.defineProperty(People.RecentActivity.UI.Share.CanvasLinkInsertedEventArgs.prototype,"linkUrl",{get:function(){return this._linkUrl$1}});People.RecentActivity.UI.Share.CanvasFocusChangedEventArgs=function(n,t){People.RecentActivity.EventArgs.call(this,n);this._focusGained$1=t};Jx.inherit(People.RecentActivity.UI.Share.CanvasFocusChangedEventArgs,People.RecentActivity.EventArgs);People.RecentActivity.UI.Share.CanvasFocusChangedEventArgs.prototype._focusGained$1=false;Object.defineProperty(People.RecentActivity.UI.Share.CanvasFocusChangedEventArgs.prototype,"focusGained",{get:function(){return this._focusGained$1}});People.RecentActivity.UI.Share.CharacterCountControl=function(){People.RecentActivity.UI.Core.Control.call(this,People.RecentActivity.UI.Core.HtmlHelper.createElement(People.RecentActivity.UI.Core.Html.shareCharacterCount))};Jx.inherit(People.RecentActivity.UI.Share.CharacterCountControl,People.RecentActivity.UI.Core.Control);People.RecentActivity.UI.Share.CharacterCountControl.prototype._maxCharacterCount$1=0;People.RecentActivity.UI.Share.CharacterCountControl.prototype._currentCharacterCount$1=0;People.RecentActivity.UI.Share.CharacterCountControl.prototype._limitExceeded$1=false;People.RecentActivity.UI.Share.CharacterCountControl.prototype._valueControl$1=null;People.RecentActivity.UI.Share.CharacterCountControl.prototype._errorControl$1=null;Object.defineProperty(People.RecentActivity.UI.Share.CharacterCountControl.prototype,"maxCharacterCount",{get:function(){return this._maxCharacterCount$1},set:function(n){this._maxCharacterCount$1!==n&&(this._maxCharacterCount$1=n,this._updateControl$1())}});Object.defineProperty(People.RecentActivity.UI.Share.CharacterCountControl.prototype,"currentCharacterCount",{get:function(){return this._currentCharacterCount$1},set:function(n){this._currentCharacterCount$1!==n&&(this._currentCharacterCount$1=n,this._updateControl$1())}});Object.defineProperty(People.RecentActivity.UI.Share.CharacterCountControl.prototype,"limitExceeded",{get:function(){return this._limitExceeded$1},set:function(n){if(this._limitExceeded$1!==n){this._limitExceeded$1=n;this.onPropertyChanged("LimitExceeded")}}});People.RecentActivity.UI.Share.CharacterCountControl.prototype.onDisposed=function(){this._valueControl$1!=null&&(this._valueControl$1.dispose(),this._valueControl$1=null);this._errorControl$1!=null&&(this._errorControl$1.dispose(),this._errorControl$1=null);People.RecentActivity.UI.Core.Control.prototype.onDisposed.call(this)};People.RecentActivity.UI.Share.CharacterCountControl.prototype.onRendered=function(){People.RecentActivity.UI.Core.Control.prototype.onRendered.call(this);this.label=Jx.res.getString("/strings/raShareCharacterCountLabel");this._valueControl$1=People.RecentActivity.UI.Core.HtmlHelper.findOrCreateControlById(this.element,"share-charactercount-value");this._valueControl$1.render();this._errorControl$1=People.RecentActivity.UI.Core.HtmlHelper.findOrCreateControlById(this.element,"share-charactercount-error");this._errorControl$1.render();this._errorControl$1.removeFromParent();this._updateControl$1()};People.RecentActivity.UI.Share.CharacterCountControl.prototype._updateControl$1=function(){if(this.isRendered)if(this._maxCharacterCount$1<1)this._errorControl$1.text="",this._errorControl$1.removeFromParent(),this.limitExceeded=false,this.isVisible=false;else{this.isVisible=true;this._valueControl$1.text=Jx.res.loadCompoundString("/strings/raShareCharacterCountValue",this._currentCharacterCount$1,this._maxCharacterCount$1);var n="";this._currentCharacterCount$1>this._maxCharacterCount$1?(this.limitExceeded=true,this.addClass("ra-shareCharacterCountLimitExceeded"),n=Jx.res.getString("/strings/raShareCharacterCountExceeded")):(this.limitExceeded=false,this.removeClass("ra-shareCharacterCountLimitExceeded"),n="");n!==this._errorControl$1.text&&(this._errorControl$1.removeFromParent(),this._errorControl$1.text=n,Jx.isNonEmptyString(n)&&this.appendControl(this._errorControl$1))}};People.RecentActivity.UI.Share.LinkPreviewControl=function(){People.RecentActivity.UI.Core.Control.call(this,People.RecentActivity.UI.Core.HtmlHelper.createElement(People.RecentActivity.UI.Core.Html.sharePreview));$include("$(socialRoot)/Social.LinkPreview.js")};Jx.inherit(People.RecentActivity.UI.Share.LinkPreviewControl,People.RecentActivity.UI.Core.Control);People.RecentActivity.UI.Share.LinkPreviewControl.prototype._mode$1=0;People.RecentActivity.UI.Share.LinkPreviewControl.prototype._shareInfo$1=null;People.RecentActivity.UI.Share.LinkPreviewControl.prototype._linkData$1=null;People.RecentActivity.UI.Share.LinkPreviewControl.prototype._authPromise$1=null;People.RecentActivity.UI.Share.LinkPreviewControl.prototype._linkPreviewSoxeCompleteHandler$1=null;People.RecentActivity.UI.Share.LinkPreviewControl.prototype._basicControl$1=null;People.RecentActivity.UI.Share.LinkPreviewControl.prototype._richControl$1=null;People.RecentActivity.UI.Share.LinkPreviewControl.prototype._linkPreviewControl$1=null;People.RecentActivity.UI.Share.LinkPreviewControl.prototype._previewAuthTokenRetrieved$1=false;People.RecentActivity.UI.Share.LinkPreviewControl.prototype._previewAuthToken$1=null;People.RecentActivity.UI.Share.LinkPreviewControl.prototype._richPreviewInitialized$1=false;People.RecentActivity.UI.Share.LinkPreviewControl.prototype._loading$1=false;Object.defineProperty(People.RecentActivity.UI.Share.LinkPreviewControl.prototype,"mode",{get:function(){return this._mode$1},set:function(n){this._mode$1!==n&&(this._mode$1=n,this._onModeChanged$1())}});Object.defineProperty(People.RecentActivity.UI.Share.LinkPreviewControl.prototype,"shareInfo",{get:function(){return this._shareInfo$1},set:function(n){this._shareInfo$1!==n&&(this._shareInfo$1=n,this._onShareInfoChanged$1())}});Object.defineProperty(People.RecentActivity.UI.Share.LinkPreviewControl.prototype,"linkData",{get:function(){return this._linkPreviewControl$1!=null&&(this._linkData$1=this._linkPreviewControl$1.getData()),this._linkData$1}});Object.defineProperty(People.RecentActivity.UI.Share.LinkPreviewControl.prototype,"loading",{get:function(){return this._mode$1===2?this._loading$1:false},set:function(n){if(this._loading$1!==n){this._loading$1=n;this.onPropertyChanged("Loading")}}});People.RecentActivity.UI.Share.LinkPreviewControl.prototype.onDisposed=function(){this._disposeLinkPreview$1();this._authPromise$1!=null&&(this._authPromise$1.cancel(),this._authPromise$1=null);this._basicControl$1!=null&&(this._basicControl$1.dispose(),this._basicControl$1=null);this._richControl$1!=null&&(this._richControl$1.dispose(),this._richControl$1=null);People.RecentActivity.UI.Core.Control.prototype.onDisposed.call(this)};People.RecentActivity.UI.Share.LinkPreviewControl.prototype.onRendered=function(){People.RecentActivity.UI.Core.Control.prototype.onRendered.call(this);this._basicControl$1=People.RecentActivity.UI.Core.HtmlHelper.findOrCreateControlById(this.element,"share-link-preview-basic");this._basicControl$1.render();this._richControl$1=People.RecentActivity.UI.Core.HtmlHelper.findOrCreateControlById(this.element,"share-link-preview-rich");this._richControl$1.render();this._renderInternal$1()};People.RecentActivity.UI.Share.LinkPreviewControl.prototype._disposeLinkPreview$1=function(){this._linkPreviewControl$1!=null&&(this._linkPreviewControl$1.shutdownUI(),this._linkPreviewControl$1.shutdownComponent(),this._linkPreviewSoxeCompleteHandler$1!=null&&(this._linkPreviewControl$1.removeListener("soxeComplete",this._linkPreviewSoxeCompleteHandler$1),this._linkPreviewSoxeCompleteHandler$1=null),this._linkPreviewControl$1=null);this._richPreviewInitialized$1=false;this._richControl$1.element.innerHTML=""};People.RecentActivity.UI.Share.LinkPreviewControl.prototype._renderInternal$1=function(){this._showOrHideViews$1();this._disposeLinkPreview$1();this._shareInfo$1!=null&&(this._basicControl$1.text=this._linkData$1.url,this._linkPreviewControl$1=new Share.Preview(this._linkData$1,People.RecentActivity.Platform.Configuration.instance.soxeEndpointUrl),this._linkPreviewControl$1.initUI(this._richControl$1.element),Jx.res.processAll(this._richControl$1.element),this._linkPreviewSoxeCompleteHandler$1=this._onLinkPreviewControlSoxeComplete$1.bind(this),this._linkPreviewControl$1.addListener("soxeComplete",this._linkPreviewSoxeCompleteHandler$1),this._showOrHideViews$1(),this._retrieveAuthTokenAsync$1())};People.RecentActivity.UI.Share.LinkPreviewControl.prototype._showOrHideViews$1=function(){this.isRendered&&(this._basicControl$1.isVisible=false,this._linkPreviewControl$1!=null&&this._linkPreviewControl$1.hide(),this._richControl$1.isVisible=false,this._shareInfo$1!=null&&(this._mode$1===2?(this._richControl$1.isVisible=true,this._linkPreviewControl$1!=null&&(this._linkPreviewControl$1.show(),this._tryLoadRichPreview$1())):this._mode$1===1&&(this._basicControl$1.isVisible=true)))};People.RecentActivity.UI.Share.LinkPreviewControl.prototype._retrieveAuthTokenAsync$1=function(){var n=new Windows.Security.Authentication.OnlineId.OnlineIdAuthenticator,t=new Windows.Security.Authentication.OnlineId.OnlineIdServiceTicketRequest(People.RecentActivity.Platform.Configuration.instance.soxeTarget,People.RecentActivity.Platform.Configuration.instance.soxePolicy);this._authPromise$1=n.authenticateUserAsync([t],Windows.Security.Authentication.OnlineId.CredentialPromptType.doNotPrompt);this._authPromise$1.done(this._onAuthTokenRetrieved$1.bind(this),this._onAuthTokenRetrieved$1.bind(this))};People.RecentActivity.UI.Share.LinkPreviewControl.prototype._onModeChanged$1=function(){this._showOrHideViews$1()};People.RecentActivity.UI.Share.LinkPreviewControl.prototype._tryLoadRichPreview$1=function(){!this._richPreviewInitialized$1&&this._previewAuthTokenRetrieved$1&&this._richControl$1.isVisible&&this._linkPreviewControl$1!=null&&(this._richPreviewInitialized$1=true,this.loading=true,this._linkPreviewControl$1.setAuth(this._previewAuthToken$1))};People.RecentActivity.UI.Share.LinkPreviewControl.prototype._onShareInfoChanged$1=function(){this._shareInfo$1!=null?(this._linkData$1=new Share.LinkData,this._linkData$1.tryInitialize(this._shareInfo$1.data,this._shareInfo$1.dataView)):this._linkData$1=null;this.isRendered&&!this.isDisposed&&this._renderInternal$1()};People.RecentActivity.UI.Share.LinkPreviewControl.prototype._onAuthTokenRetrieved$1=function(n){var i,t,e,o,r,u,f;if(this.isDisposed)return null;if(i=n,t=null,i!=null&&i.tickets!=null)for(e=People.RecentActivity.Platform.Configuration.instance.soxeTarget.toUpperCase(),o=People.RecentActivity.Platform.Configuration.instance.soxePolicy.toUpperCase(),r=0;r<i.tickets.length;r++)if(u=i.tickets[r],f=u.request,f.service.toUpperCase()===e&&f.policy.toUpperCase()===o){t=u.value;break}return Jx.isNonEmptyString(t)?t.substr(0,2)==="t="&&(t=t.substr(2)):Jx.log.write(2,"LinkPreviewControl.OnAuthTokenRetrieved: No valid RPS tokens found."),this._previewAuthTokenRetrieved$1=true,this._previewAuthToken$1=t,this._tryLoadRichPreview$1(),null};People.RecentActivity.UI.Share.LinkPreviewControl.prototype._onLinkPreviewControlSoxeComplete$1=function(){this.loading=false};People.RecentActivity.UI.Share.NetworkSelectorItemControl=function(n){People.RecentActivity.UI.Core.Control.call(this,People.RecentActivity.UI.Core.HtmlHelper.createElement(People.RecentActivity.UI.Core.Html.shareNetworkSelectItem));this._network$1=n};Jx.inherit(People.RecentActivity.UI.Share.NetworkSelectorItemControl,People.RecentActivity.UI.Core.Control);People.RecentActivity.UI.Share.NetworkSelectorItemControl.prototype._network$1=null;People.RecentActivity.UI.Share.NetworkSelectorItemControl.prototype._icon$1=null;People.RecentActivity.UI.Share.NetworkSelectorItemControl.prototype._name$1=null;Object.defineProperty(People.RecentActivity.UI.Share.NetworkSelectorItemControl.prototype,"network",{get:function(){return this._network$1}});People.RecentActivity.UI.Share.NetworkSelectorItemControl.prototype.onDisposed=function(){this._icon$1!=null&&(this._icon$1.dispose(),this._icon$1=null);this._name$1!=null&&(this._name$1.dispose(),this._name$1=null);People.RecentActivity.UI.Core.Control.prototype.onDisposed.call(this)};People.RecentActivity.UI.Share.NetworkSelectorItemControl.prototype.onRendered=function(){People.RecentActivity.UI.Core.Control.prototype.onRendered.call(this);this._icon$1=People.RecentActivity.UI.Core.HtmlHelper.findOrCreateControlById(this.element,"share-networkselect-item-icon-image");var n=this._icon$1.element;n.src=this._network$1.icon;this._name$1=People.RecentActivity.UI.Core.HtmlHelper.findOrCreateControlById(this.element,"share-networkselect-item-name");this._name$1.id=this._name$1.uniqueId;this._name$1.text=this._network$1.name;this.labelledBy=this._name$1.id};People.RecentActivity.UI.Share.SendButtonControl=function(){People.RecentActivity.UI.Core.Control.call(this,People.RecentActivity.UI.Core.HtmlHelper.createElement(People.RecentActivity.UI.Core.Html.shareSendButton))};Jx.inherit(People.RecentActivity.UI.Share.SendButtonControl,People.RecentActivity.UI.Core.Control);People.RecentActivity.UI.Share.SendButtonControl.prototype.onRendered=function(){People.RecentActivity.UI.Core.Control.prototype.onRendered.call(this);People.Animation.addTapAnimation(this.element);this.title=Jx.res.getString("/strings/raShareSendButtonTitle");this.attach("click",this._onButtonClicked$1.bind(this))};People.RecentActivity.UI.Share.SendButtonControl.prototype._onClicked$1=function(){this.raiseEvent("clicked")};People.RecentActivity.UI.Share.SendButtonControl.prototype._onButtonClicked$1=function(){this._onClicked$1()};People.RecentActivity.UI.Share.CanvasControl=function(){People.RecentActivity.UI.Core.Control.call(this,People.RecentActivity.UI.Core.HtmlHelper.createElement(People.RecentActivity.UI.Core.Html.shareCanvas));$include("$(socialRoot)/Social.Canvas.js")};Jx.inherit(People.RecentActivity.UI.Share.CanvasControl,People.RecentActivity.UI.Core.Control);People.RecentActivity.UI.Share.CanvasControl._characterCountEventName$1="charactercountchanged";People.RecentActivity.UI.Share.CanvasControl._domNodeInsertedEventName$1="DOMNodeInserted";People.RecentActivity.UI.Share.CanvasControl._onFocusEventName$1="focus";People.RecentActivity.UI.Share.CanvasControl._onBlurEventName$1="blur";People.RecentActivity.UI.Share.CanvasControl.prototype._characterCount$1=0;People.RecentActivity.UI.Share.CanvasControl.prototype._cueText$1=null;People.RecentActivity.UI.Share.CanvasControl.prototype._canvas$1=null;People.RecentActivity.UI.Share.CanvasControl.prototype._characterCountHandler$1=null;People.RecentActivity.UI.Share.CanvasControl.prototype._domNodeInsertedHandler$1=null;People.RecentActivity.UI.Share.CanvasControl.prototype._onFocusHandler$1=null;People.RecentActivity.UI.Share.CanvasControl.prototype._onBlurHandler$1=null;Object.defineProperty(People.RecentActivity.UI.Share.CanvasControl.prototype,"characterCount",{get:function(){return this._characterCount$1},set:function(n){if(this._characterCount$1!==n){this._characterCount$1=n;this.onPropertyChanged("CharacterCount")}}});Object.defineProperty(People.RecentActivity.UI.Share.CanvasControl.prototype,"textContent",{get:function(){var n=ModernCanvas.ContentFormat.text;return this._canvas$1!=null?this._canvas$1.getContent([n])[n]:""},set:function(n){this._canvas$1.addContent(n,ModernCanvas.ContentFormat.text,ModernCanvas.ContentLocation.all,true,null)}});Object.defineProperty(People.RecentActivity.UI.Share.CanvasControl.prototype,"cueText",{get:function(){return this._cueText$1},set:function(n){this._cueText$1!==n&&(this._cueText$1=n,this._updateCueText$1())}});People.RecentActivity.UI.Share.CanvasControl.prototype.clear=function(){this._canvas$1!=null&&(this._canvas$1.clearContent(),this._canvas$1.clearUndoRedo())};People.RecentActivity.UI.Share.CanvasControl.prototype.focus=function(){this._canvas$1!=null&&this._canvas$1.focus()};People.RecentActivity.UI.Share.CanvasControl.prototype.setSelection=function(n){var t=this._canvas$1.getDocument().createRange();t.selectNodeContents(this._canvas$1.getCanvasElement());t.collapse(n);this._canvas$1.replaceSelection(t)};People.RecentActivity.UI.Share.CanvasControl.prototype.scrollSelectionIntoView=function(){this._canvas$1.scrollSelectionIntoView()};People.RecentActivity.UI.Share.CanvasControl.prototype.onDisposed=function(){this._canvas$1!=null&&(this._domNodeInsertedHandler$1!=null&&(this._canvas$1.removeEventListener("DOMNodeInserted",this._domNodeInsertedHandler$1,false),this._domNodeInsertedHandler$1=null),this._onFocusHandler$1!=null&&(this._canvas$1.removeEventListener("focus",this._onFocusHandler$1,false),this._onFocusHandler$1=null),this._onBlurHandler$1!=null&&(this._canvas$1.removeEventListener("blur",this._onBlurHandler$1,false),this._onBlurHandler$1=null),this._characterCountHandler$1!=null&&(this._canvas$1.removeListener("charactercountchanged",this._characterCountHandler$1,this),this._characterCountHandler$1=null),this._canvas$1.dispose(),this._canvas$1=null);People.RecentActivity.UI.Core.Control.prototype.onDisposed.call(this)};People.RecentActivity.UI.Share.CanvasControl.prototype.onRendered=function(){var n=this,t;return People.RecentActivity.UI.Core.Control.prototype.onRendered.call(this),this.label=Jx.res.getString("/strings/raShareCanvasLabel"),t=People.RecentActivity.Imports.create_modernCanvasOptions(),t.className="people",ModernCanvas.createCanvasAsync(this.element,t).then(function(t){return n.isDisposed?null:(n._canvas$1=t,n._updateCueText$1(),n._characterCountHandler$1=n._onCharacterCountChanged$1.bind(n),n._canvas$1.addListener("charactercountchanged",n._characterCountHandler$1,n),n._domNodeInsertedHandler$1=n._onDomNodeInserted$1.bind(n),n._canvas$1.addEventListener("DOMNodeInserted",n._domNodeInsertedHandler$1,false),n._onFocusHandler$1=n._onFocus$1.bind(n),n._canvas$1.addEventListener("focus",n._onFocusHandler$1,false),n._onBlurHandler$1=n._onBlur$1.bind(n),n._canvas$1.addEventListener("blur",n._onBlurHandler$1,false),null)})};People.RecentActivity.UI.Share.CanvasControl.prototype._updateCueText$1=function(){this._canvas$1!=null&&(this._cueText$1!=null?this._canvas$1.setCueText(this._cueText$1):this._canvas$1.setCueText(Jx.res.getString("/strings/raShareCanvasCueText")))};People.RecentActivity.UI.Share.CanvasControl.prototype._onCharacterCountChanged$1=function(n){this.characterCount=n.characterCount};People.RecentActivity.UI.Share.CanvasControl.prototype._onDomNodeInserted$1=function(n){n.target.tagName==="A"&&this._onLinkInserted$1(n.target.innerText)};People.RecentActivity.UI.Share.CanvasControl.prototype._onFocus$1=function(){this._onFocusChanged$1(true)};People.RecentActivity.UI.Share.CanvasControl.prototype._onBlur$1=function(){this._onFocusChanged$1(false)};People.RecentActivity.UI.Share.CanvasControl.prototype._onLinkInserted$1=function(n){this.raiseEvent("linkinserted",new People.RecentActivity.UI.Share.CanvasLinkInsertedEventArgs(this,n))};People.RecentActivity.UI.Share.CanvasControl.prototype._onFocusChanged$1=function(n){this.raiseEvent("focuschanged",new People.RecentActivity.UI.Share.CanvasFocusChangedEventArgs(this,n))};People.RecentActivity.UI.Share.NetworkSelectorControl=function(n,t){People.RecentActivity.UI.Core.Control.call(this,People.RecentActivity.UI.Core.HtmlHelper.createElement(People.RecentActivity.UI.Core.Html.shareNetworkSelect));this._networks$1=n;this._selectedNetwork$1=this._networks$1.findById(t);this._selectedNetwork$1==null&&(this._selectedNetwork$1=this._networks$1.item(0))};Jx.inherit(People.RecentActivity.UI.Share.NetworkSelectorControl,People.RecentActivity.UI.Core.Control);People.RecentActivity.UI.Share.NetworkSelectorControl.prototype._networks$1=null;People.RecentActivity.UI.Share.NetworkSelectorControl.prototype._selectedNetwork$1=null;People.RecentActivity.UI.Share.NetworkSelectorControl.prototype._currentIndex$1=0;People.RecentActivity.UI.Share.NetworkSelectorControl.prototype._expanded$1=false;People.RecentActivity.UI.Share.NetworkSelectorControl.prototype._dismissedWithKeyboard$1=false;People.RecentActivity.UI.Share.NetworkSelectorControl.prototype._currentItemContainer$1=null;People.RecentActivity.UI.Share.NetworkSelectorControl.prototype._currentItem$1=null;People.RecentActivity.UI.Share.NetworkSelectorControl.prototype._focusItem$1=null;People.RecentActivity.UI.Share.NetworkSelectorControl.prototype._mouseDownItem$1=null;People.RecentActivity.UI.Share.NetworkSelectorControl.prototype._dropdownControl$1=null;People.RecentActivity.UI.Share.NetworkSelectorControl.prototype._flyoutControl$1=null;People.RecentActivity.UI.Share.NetworkSelectorControl.prototype._flyout$1=null;People.RecentActivity.UI.Share.NetworkSelectorControl.prototype._itemList$1=null;People.RecentActivity.UI.Share.NetworkSelectorControl.prototype._itemMap$1=null;Object.defineProperty(People.RecentActivity.UI.Share.NetworkSelectorControl.prototype,"selectedNetwork",{get:function(){return this._selectedNetwork$1},set:function(n){if(this._selectedNetwork$1!==n){this._selectedNetwork$1=n;this.onPropertyChanged("SelectedNetwork")}}});People.RecentActivity.UI.Share.NetworkSelectorControl.prototype.onDisposed=function(){var n,t;if(this._selectedNetwork$1=null,this._mouseDownItem$1=null,this._focusItem$1=null,this._itemList$1!=null){for(n=0;n<this._itemList$1.length;n++)t=this._itemList$1[n],t.dispose();this._itemList$1.length=0;this._itemList$1=null}this._itemMap$1!=null&&(People.Social.clearKeys(this._itemMap$1),this._itemMap$1=null);this._currentItem$1!=null&&(this._currentItem$1.dispose(),this._currentItem$1=null);this._flyoutControl$1!=null&&(document.body.removeChild(this._flyoutControl$1.element),this._flyoutControl$1.dispose(),this._flyoutControl$1=null,this._flyout$1=null);this._dropdownControl$1!=null&&(this._dropdownControl$1.dispose(),this._dropdownControl$1=null);this._currentItemContainer$1!=null&&(this._currentItemContainer$1.dispose(),this._currentItemContainer$1=null);People.RecentActivity.UI.Core.Control.prototype.onDisposed.call(this)};People.RecentActivity.UI.Share.NetworkSelectorControl.prototype.onRendered=function(){var n,r,u,i,t;for(People.RecentActivity.UI.Core.Control.prototype.onRendered.call(this),n=this.element,this._currentItem$1=new People.RecentActivity.UI.Share.NetworkSelectorItemControl(this._selectedNetwork$1),this._currentItemContainer$1=People.RecentActivity.UI.Core.HtmlHelper.findOrCreateControlById(n,"share-networkselect-currentitem"),this._currentItemContainer$1.appendControl(this._currentItem$1),this._currentItem$1.render(),this._dropdownControl$1=People.RecentActivity.UI.Core.HtmlHelper.findOrCreateControlById(n,"share-networkselect-dropdown"),this._flyoutControl$1=new People.RecentActivity.UI.Core.Control(People.RecentActivity.UI.Core.HtmlHelper.createElement(People.RecentActivity.UI.Core.Html.shareNetworkSelectFlyout)),this._flyoutControl$1.id=this._flyoutControl$1.uniqueId,this._flyoutControl$1.render(),document.body.appendChild(this._flyoutControl$1.element),this.title=Jx.res.getString("/strings/raShareNetworkSelectTitle"),this._itemList$1=[],this._itemMap$1={},r=0,u=this._networks$1.count;r<u;r++)i=this._networks$1.item(r),i.isAggregatedNetwork||(t=new People.RecentActivity.UI.Share.NetworkSelectorItemControl(i),this._flyoutControl$1.appendControl(t),t.render(),this._attachEvents$1(t),this._itemList$1.push(t),this._itemMap$1[i.id]=t,i===this._selectedNetwork$1&&(this._currentIndex$1=this._itemList$1.length-1));this._flyout$1=new WinJS.UI.Flyout(this._flyoutControl$1.element);this._flyout$1.anchor=n;this._flyout$1.placement="bottom";this._flyout$1.alignment="left";this._flyoutControl$1.attach("beforeshow",this._onFlyoutBeforeShow$1.bind(this));this._flyoutControl$1.attach("aftershow",this._onFlyoutAfterShow$1.bind(this));this._flyoutControl$1.attach("afterhide",this._onFlyoutAfterHide$1.bind(this));this._flyoutControl$1.attach("keydown",this._onFlyoutKeyDown$1.bind(this));this._itemList$1.length<2?this._dropdownControl$1.isVisible=false:(People.RecentActivity.UI.Core.AriaHelper.setExpanded(n,false),People.RecentActivity.UI.Core.AriaHelper.setOwns(n,this._flyoutControl$1.id),People.RecentActivity.UI.Core.AriaHelper.setHasPopup(n,true),this.addClass("ra-shareNetworkSelectExpandable"),this.addClass("ra-shareNetworkSelectCollapsed"),this.attach("click",this._onSelectorClicked$1.bind(this)),this.attach("keydown",this._onSelectorKeyDown$1.bind(this)),this.attach("MSPointerDown",this._onSelectorPointerDown$1.bind(this)),this.attach("MSPointerUp",this._onSelectorPointerUp$1.bind(this)),this.attach("MSPointerOut",this._onSelectorPointerOut$1.bind(this)),this.attach("MSPointerOver",this._onSelectorPointerOver$1.bind(this)))};People.RecentActivity.UI.Share.NetworkSelectorControl.prototype._attachEvents$1=function(n){var t=this;n.attach("click",function(i){t._onItemClicked$1(i,n)});n.attach("keydown",function(i){t._onItemKeyDown$1(i,n)});n.attach("MSPointerDown",function(i){t._onItemPointerDown$1(i,n)});n.attach("MSPointerUp",function(i){t._onItemPointerUp$1(i,n)});n.attach("MSPointerOut",function(i){t._onItemPointerOut$1(i,n)});n.attach("MSPointerOver",function(i){t._onItemPointerOver$1(i,n)})};People.RecentActivity.UI.Share.NetworkSelectorControl.prototype.selectNetwork$1=function(n){this._currentItemContainer$1.removeControl(this._currentItem$1);this._currentItem$1.dispose();this.selectedNetwork=n;this._currentItem$1=new People.RecentActivity.UI.Share.NetworkSelectorItemControl(n);this._currentItemContainer$1.appendControl(this._currentItem$1);this._currentItem$1.isHiddenFromScreenReader=true;this._currentItem$1.role="";this._currentItem$1.render();this._flyout$1.hide()};People.RecentActivity.UI.Share.NetworkSelectorControl.prototype._adjustCurrentIndex$1=function(n){this._currentIndex$1+=n;this._currentIndex$1=Math.min(Math.max(0,this._currentIndex$1),this._itemList$1.length-1)};People.RecentActivity.UI.Share.NetworkSelectorControl.prototype._updateSelectorInPlace$1=function(n){this._adjustCurrentIndex$1(n);this.selectNetwork$1(this._itemList$1[this._currentIndex$1].network)};People.RecentActivity.UI.Share.NetworkSelectorControl.prototype._onSelectorClicked$1=function(){this._flyout$1.show()};People.RecentActivity.UI.Share.NetworkSelectorControl.prototype._onSelectorKeyDown$1=function(n){switch(n.keyCode){case WinJS.Utilities.Key.enter:case WinJS.Utilities.Key.space:this._flyout$1.show();break;case WinJS.Utilities.Key.downArrow:n.altKey?this._flyout$1.show():this._expanded$1||this._updateSelectorInPlace$1(1);break;case WinJS.Utilities.Key.upArrow:this._expanded$1||this._updateSelectorInPlace$1(-1);break;default:return}n.cancelBubble=true;n.preventDefault()};People.RecentActivity.UI.Share.NetworkSelectorControl.prototype._onSelectorPointerDown$1=function(n){var t=n;t.buttons===1&&this.addClass("ra-shareNetworkSelectActive")};People.RecentActivity.UI.Share.NetworkSelectorControl.prototype._onSelectorPointerUp$1=function(){this.removeClass("ra-shareNetworkSelectActive")};People.RecentActivity.UI.Share.NetworkSelectorControl.prototype._onSelectorPointerOut$1=function(){this.removeClass("ra-shareNetworkSelectActive")};People.RecentActivity.UI.Share.NetworkSelectorControl.prototype._onSelectorPointerOver$1=function(n){var t=n;t.buttons===1?this.addClass("ra-shareNetworkSelectActive"):this.removeClass("ra-shareNetworkSelectActive")};People.RecentActivity.UI.Share.NetworkSelectorControl.prototype._onItemClicked$1=function(n,t){this._flyoutControl$1.removeClass("ra-shareNetworkSelectFlyoutHover");this.selectNetwork$1(t.network)};People.RecentActivity.UI.Share.NetworkSelectorControl.prototype._onItemKeyDown$1=function(n,t){switch(n.keyCode){case WinJS.Utilities.Key.enter:case WinJS.Utilities.Key.space:this.selectNetwork$1(t.network);this._dismissedWithKeyboard$1=true;break;case WinJS.Utilities.Key.escape:this._flyout$1.hide();this._dismissedWithKeyboard$1=true}};People.RecentActivity.UI.Share.NetworkSelectorControl.prototype._onItemPointerDown$1=function(n,t){var i=n;i.buttons===1&&(this._flyoutControl$1.removeClass("ra-shareNetworkSelectFlyoutHover"),this._mouseDownItem$1=t,this._mouseDownItem$1.addClass("ra-shareNetworkSelectItemActive"),this._mouseDownItem$1.focus())};People.RecentActivity.UI.Share.NetworkSelectorControl.prototype._onItemPointerUp$1=function(){this._mouseDownItem$1!=null&&(this._mouseDownItem$1.removeClass("ra-shareNetworkSelectItemActive"),this._mouseDownItem$1=null);this._focusItem$1!=null&&this._focusItem$1.focus();this._flyoutControl$1.addClass("ra-shareNetworkSelectFlyoutHover")};People.RecentActivity.UI.Share.NetworkSelectorControl.prototype._onItemPointerOut$1=function(){this._mouseDownItem$1!=null&&this._mouseDownItem$1.removeClass("ra-shareNetworkSelectItemActive");this._focusItem$1!=null&&this._focusItem$1.focus()};People.RecentActivity.UI.Share.NetworkSelectorControl.prototype._onItemPointerOver$1=function(n,t){var i=n;i.buttons!==1?this._flyoutControl$1.addClass("ra-shareNetworkSelectFlyoutHover"):this._mouseDownItem$1===t&&(this._mouseDownItem$1.addClass("ra-shareNetworkSelectItemActive"),this._mouseDownItem$1.focus())};People.RecentActivity.UI.Share.NetworkSelectorControl.prototype._onFlyoutBeforeShow$1=function(){this._expanded$1=true;People.RecentActivity.UI.Core.AriaHelper.setExpanded(this.element,true);this.removeClass("ra-shareNetworkSelectCollapsed");this._flyoutControl$1.addClass("ra-shareNetworkSelectFlyoutHover");this._focusItem$1=this._itemMap$1[this._selectedNetwork$1.id];this._focusItem$1.addClass("ra-shareNetworkSelectItemFocus");this._currentIndex$1=this._itemList$1.indexOf(this._focusItem$1)};People.RecentActivity.UI.Share.NetworkSelectorControl.prototype._onFlyoutAfterShow$1=function(){this._focusItem$1!=null&&this._focusItem$1.focus()};People.RecentActivity.UI.Share.NetworkSelectorControl.prototype._onFlyoutAfterHide$1=function(){this._mouseDownItem$1!=null&&(this._mouseDownItem$1.removeClass("ra-shareNetworkSelectItemActive"),this._mouseDownItem$1=null);this._focusItem$1!=null&&(this._focusItem$1.removeClass("ra-shareNetworkSelectItemFocus"),this._focusItem$1=null);this.addClass("ra-shareNetworkSelectCollapsed");this._dismissedWithKeyboard$1&&(document.body.focus(),this.focus(),this._dismissedWithKeyboard$1=false);this._expanded$1=false;People.RecentActivity.UI.Core.AriaHelper.setExpanded(this.element,false)};People.RecentActivity.UI.Share.NetworkSelectorControl.prototype._onFlyoutKeyDown$1=function(n){var t=this._currentIndex$1;switch(n.keyCode){case WinJS.Utilities.Key.downArrow:this._adjustCurrentIndex$1(1);break;case WinJS.Utilities.Key.upArrow:this._adjustCurrentIndex$1(-1)}t!==this._currentIndex$1&&(this._focusItem$1!=null&&this._focusItem$1.removeClass("ra-shareNetworkSelectItemFocus"),this._focusItem$1=this._itemList$1[this._currentIndex$1],this._focusItem$1.addClass("ra-shareNetworkSelectItemFocus"),this._focusItem$1.focus());n.cancelBubble=true;n.preventDefault()};People.RecentActivity.UI.Share.ProgressControl=function(n){People.RecentActivity.UI.Core.Control.call(this,People.RecentActivity.UI.Core.HtmlHelper.createElement(People.RecentActivity.UI.Core.Html.shareProgress));this._progressText$1=n};Jx.inherit(People.RecentActivity.UI.Share.ProgressControl,People.RecentActivity.UI.Core.Control);People.RecentActivity.UI.Share.ProgressControl.prototype._progressText$1=null;People.RecentActivity.UI.Share.ProgressControl.prototype._label$1=null;People.RecentActivity.UI.Share.ProgressControl.prototype.onDisposed=function(){this._label$1!=null&&(this._label$1.dispose(),this._label$1=null);People.RecentActivity.UI.Core.Control.prototype.onDisposed.call(this)};People.RecentActivity.UI.Share.ProgressControl.prototype.onRendered=function(){People.RecentActivity.UI.Core.Control.prototype.onRendered.call(this);this._label$1=People.RecentActivity.UI.Core.HtmlHelper.findOrCreateControlById(this.element,"share-progress-label");this._label$1.text=this._progressText$1};People.RecentActivity.UI.Share.ShareControl=function(n,t){People.RecentActivity.UI.Core.Control.call(this,People.RecentActivity.UI.Core.HtmlHelper.createElement(People.RecentActivity.UI.Core.Html.shareControl));this._identity$1=n;this._displayFeed$1=t;this._sendButtonFadeCurrent$1=WinJS.Promise.wrap(null)};Jx.inherit(People.RecentActivity.UI.Share.ShareControl,People.RecentActivity.UI.Core.Control);People.RecentActivity.UI.Share.ShareControl.settingKey="shareLastUsedNetwork";People.RecentActivity.UI.Share.ShareControl.prototype._identity$1=null;People.RecentActivity.UI.Share.ShareControl.prototype._currentNetwork$1=null;People.RecentActivity.UI.Share.ShareControl.prototype._biciData$1=null;People.RecentActivity.UI.Share.ShareControl.prototype._displayFeed$1=null;People.RecentActivity.UI.Share.ShareControl.prototype._bodyAnimation$1=null;People.RecentActivity.UI.Share.ShareControl.prototype._sendButtonFadeCurrent$1=null;People.RecentActivity.UI.Share.ShareControl.prototype._sendButtonVisible$1=false;People.RecentActivity.UI.Share.ShareControl.prototype._sendButtonDisabled$1=false;People.RecentActivity.UI.Share.ShareControl.prototype._sending$1=false;People.RecentActivity.UI.Share.ShareControl.prototype._hasRichLink$1=false;People.RecentActivity.UI.Share.ShareControl.prototype._currentLink$1=null;People.RecentActivity.UI.Share.ShareControl.prototype._lastNetworkError$1=null;People.RecentActivity.UI.Share.ShareControl.prototype._overlay$1=null;People.RecentActivity.UI.Share.ShareControl.prototype._body=null;People.RecentActivity.UI.Share.ShareControl.prototype._networkSelect$1=null;People.RecentActivity.UI.Share.ShareControl.prototype._errorMessage$1=null;People.RecentActivity.UI.Share.ShareControl.prototype._canvasContainer$1=null;People.RecentActivity.UI.Share.ShareControl.prototype._canvas$1=null;People.RecentActivity.UI.Share.ShareControl.prototype._linkPreview$1=null;People.RecentActivity.UI.Share.ShareControl.prototype._linkPreviewClear$1=null;People.RecentActivity.UI.Share.ShareControl.prototype._characterCount$1=null;People.RecentActivity.UI.Share.ShareControl.prototype._sendButton$1=null;People.RecentActivity.UI.Share.ShareControl.prototype._sendProgress$1=null;People.RecentActivity.UI.Share.ShareControl.prototype._reconnectLink$1=null;People.RecentActivity.UI.Share.ShareControl.prototype._refreshTimeout=-1;Object.defineProperty(People.RecentActivity.UI.Share.ShareControl.prototype,"hasRichLink",{get:function(){return this._hasRichLink$1},set:function(n){if(this._hasRichLink$1!==n){this._hasRichLink$1=n;this.onPropertyChanged("HasRichLink")}}});People.RecentActivity.UI.Share.ShareControl.prototype.refreshSize=function(){this._updateCanvasHeight$1()};People.RecentActivity.UI.Share.ShareControl.prototype.focus=function(){this._canvas$1.focus()};People.RecentActivity.UI.Share.ShareControl.prototype.onDisposed=function(){this._logBiciData$1();this._refreshTimeout!==-1&&(window.clearTimeout(this._refreshTimeout),this._refreshTimeout=-1);this._bodyAnimation$1!=null&&(this._bodyAnimation$1.cancel(),this._bodyAnimation$1=null);this._sendButtonFadeCurrent$1!=null&&(this._sendButtonFadeCurrent$1.cancel(),this._sendButtonFadeCurrent$1=null);this._currentNetwork$1!=null&&(this._currentNetwork$1.feed.removeListenerSafe("addentrycompleted",this._onFeedAddEntryCompleted$1,this),this._currentNetwork$1=null);this._displayFeed$1!=null&&(this._displayFeed$1.removeListenerSafe("refreshcompleted",this._onDisplayFeedRefreshCompleted$1,this),this._displayFeed$1=null);this._networkSelect$1!=null&&(this._networkSelect$1.removeListenerSafe("propertychanged",this._onNetworkSelectPropertyChanged$1,this),this._networkSelect$1.dispose(),this._networkSelect$1=null);this._reconnectLink$1!=null&&(this._reconnectLink$1.dispose(),this._reconnectLink$1=null);this._errorMessage$1!=null&&(this._errorMessage$1.dispose(),this._errorMessage$1=null);this._canvas$1!=null&&(this._canvas$1.removeListenerSafe("propertychanged",this._onCanvasPropertyChanged$1,this),this._canvas$1.removeListenerSafe("linkinserted",this._onCanvasLinkInserted$1,this),this._canvas$1.removeListenerSafe("focuschanged",this._onCanvasFocusChanged$1,this),this._canvas$1.dispose(),this._canvas$1=null);this._linkPreview$1!=null&&(this._linkPreview$1.dispose(),this._linkPreview$1=null);this._linkPreviewClear$1!=null&&(this._linkPreviewClear$1.dispose(),this._linkPreviewClear$1=null);this._characterCount$1!=null&&(this._characterCount$1.removeListenerSafe("propertychanged",this._onCharacterCountPropertyChanged$1,this),this._characterCount$1.dispose(),this._characterCount$1=null);this._sendButton$1!=null&&(this._sendButton$1.removeListenerSafe("clicked",this._onSendButtonClicked$1,this),this._sendButton$1.dispose(),this._sendButton$1=null);this._canvasContainer$1!=null&&(this._canvasContainer$1.dispose(),this._canvasContainer$1=null);this._body!=null&&(this._body.dispose(),this._body=null);this._sendProgress$1!=null&&(this._sendProgress$1.dispose(),this._sendProgress$1=null);this._overlay$1!=null&&(this._overlay$1.dispose(),this._overlay$1=null);this._identity$1=null;People.RecentActivity.UI.Core.Control.prototype.onDisposed.call(this)};People.RecentActivity.UI.Share.ShareControl.prototype.onRendered=function(){var n,t;return People.RecentActivity.UI.Core.Control.prototype.onRendered.call(this),this._overlay$1=People.RecentActivity.UI.Core.HtmlHelper.findOrCreateControlById(this.element,"share-control-overlay"),this._overlay$1.render(),this._overlay$1.isVisible=false,this._sendProgress$1=new People.RecentActivity.UI.Share.ProgressControl(Jx.res.getString("/strings/raShareSendProgressLabel")),this._sendProgress$1.render(),this._body=People.RecentActivity.UI.Core.HtmlHelper.findOrCreateControlById(this.element,"share-control-body"),this._body.render(),n=Jx.appData.localSettings().get(People.RecentActivity.UI.Share.ShareControl.settingKey),this._networkSelect$1=new People.RecentActivity.UI.Share.NetworkSelectorControl(this._identity$1.networks,n),this.insertControlBefore(this._networkSelect$1,this._body),this._networkSelect$1.render(),this._errorMessage$1=new People.RecentActivity.UI.Core.Control(People.RecentActivity.UI.Core.HtmlHelper.createElement(People.RecentActivity.UI.Core.Html.shareErrorMessage)),this.insertControlBefore(this._errorMessage$1,this._body),this._errorMessage$1.render(),this._errorMessage$1.isVisible=false,this._canvasContainer$1=new People.RecentActivity.UI.Core.Control(People.RecentActivity.UI.Core.HtmlHelper.createElement(People.RecentActivity.UI.Core.Html.shareControlCanvasContainer)),this._body.appendControl(this._canvasContainer$1),this._canvasContainer$1.render(),this._canvas$1=new People.RecentActivity.UI.Share.CanvasControl,this._canvasContainer$1.appendControl(this._canvas$1),t=this._canvas$1.render(),this._linkPreview$1=new People.RecentActivity.UI.Share.LinkPreviewControl,this._canvasContainer$1.appendControl(this._linkPreview$1),this._linkPreview$1.render(),this._linkPreviewClear$1=new People.RecentActivity.UI.Core.Control(People.RecentActivity.UI.Core.HtmlHelper.createElement(People.RecentActivity.UI.Core.Html.shareControlLinkPreviewClear)),this._body.appendControl(this._linkPreviewClear$1),this._linkPreviewClear$1.text=Jx.res.getString("/strings/raShareLinkPreviewClearLabel"),this._linkPreviewClear$1.render(),this._linkPreviewClear$1.isVisible=false,this._characterCount$1=new People.RecentActivity.UI.Share.CharacterCountControl,this._body.appendControl(this._characterCount$1),this._characterCount$1.render(),this._sendButton$1=new People.RecentActivity.UI.Share.SendButtonControl,this.appendControl(this._sendButton$1),this._sendButton$1.render(),this._biciData$1=this._createBiciData$1(),this._networkSelect$1.addListener("propertychanged",this._onNetworkSelectPropertyChanged$1,this),this._characterCount$1.addListener("propertychanged",this._onCharacterCountPropertyChanged$1,this),this._sendButton$1.addListener("clicked",this._onSendButtonClicked$1,this),this._canvas$1.addListener("propertychanged",this._onCanvasPropertyChanged$1,this),this._canvas$1.addListener("linkinserted",this._onCanvasLinkInserted$1,this),this._canvas$1.addListener("focuschanged",this._onCanvasFocusChanged$1,this),this._canvasContainer$1.attach("focus",this._onCanvasContainerFocus.bind(this)),this._linkPreviewClear$1.attach("click",this._onLinkPreviewClearClicked$1.bind(this)),this._linkPreviewClear$1.attach("keydown",this._onLinkPreviewClearKeyDown$1.bind(this)),this._switchNetwork$1(this._networkSelect$1.selectedNetwork),this._updateSendButton$1(),t};People.RecentActivity.UI.Share.ShareControl.prototype.selectNetwork$1=function(n){this._networkSelect$1.selectNetwork$1(n)};People.RecentActivity.UI.Share.ShareControl.prototype._switchNetwork$1=function(n){if(n!==this._currentNetwork$1){this._bodyAnimation$1=this._currentNetwork$1==null?WinJS.Promise.wrap(null):this._exitBody$1();this._updateShareText$1(n);this._currentNetwork$1=n;this._lastNetworkError$1=null;this._updateError$1();var t=this;this._bodyAnimation$1.then(function(){return t.isDisposed?null:(t._updateBody$1(),t._bodyAnimation$1=t._enterBody$1(),t._bodyAnimation$1)})}};People.RecentActivity.UI.Share.ShareControl.prototype._updateShareText$1=function(n){if(this._currentNetwork$1!=null&&!this._identity$1.isMe){var i=this._canvas$1.textContent,t=this._getTwitterNickname$1();this._currentNetwork$1.id===People.RecentActivity.Core.NetworkId.twitter&&n.id!==People.RecentActivity.Core.NetworkId.twitter&&i.substring(0,t.length)===t&&(this._canvas$1.textContent=i.substring(t.length,i.length));this._currentNetwork$1.id!==People.RecentActivity.Core.NetworkId.twitter&&n.id===People.RecentActivity.Core.NetworkId.twitter&&i.substring(0,t.length)!==t&&(this._canvas$1.textContent=t+i)}};People.RecentActivity.UI.Share.ShareControl.prototype._exitBody$1=function(){var n=[];return n.push(this._canvasContainer$1.element),this._linkPreviewClear$1.isVisible&&n.push(this._linkPreviewClear$1.element),this._characterCount$1.isVisible&&n.push(this._characterCount$1.element),People.Animation.fadeOut(n)};People.RecentActivity.UI.Share.ShareControl.prototype._enterBody$1=function(){var n=[];return n.push(this._canvasContainer$1.element),this._linkPreviewClear$1.isVisible&&n.push(this._linkPreviewClear$1.element),this._characterCount$1.isVisible&&n.push(this._characterCount$1.element),People.Animation.fadeIn(n)};People.RecentActivity.UI.Share.ShareControl.prototype._updateBody$1=function(){var n,t;this._linkPreview$1.shareInfo=this._currentLink$1;switch(this._currentNetwork$1.id){case People.RecentActivity.Core.NetworkId.twitter:this._identity$1.isMe?this._canvas$1.cueText=Jx.res.getString("/strings/raShareCanvasCueTextTwitter"):(t=this._getTwitterNickname$1(),this._canvas$1.cueText=t);this._characterCount$1.maxCharacterCount=140;this.addClass("ra-shareControlShowBottomRow");n=false;break;case People.RecentActivity.Core.NetworkId.facebook:this._canvas$1.cueText=this._identity$1.isMe?Jx.res.getString("/strings/raShareCanvasCueTextFacebook"):Jx.res.loadCompoundString("/strings/raShareCanvasWriteToWallCueTextFacebook",this._identity$1.name);this._characterCount$1.maxCharacterCount=-1;n=true;break;default:this._canvas$1.cueText=null;this._characterCount$1.maxCharacterCount=-1;n=true}n&&this._currentLink$1!=null?(Jx.addClass(this._canvas$1.element,"hasLinkPreview"),this._linkPreview$1.isVisible=true,this._linkPreview$1.mode=2,this._linkPreviewClear$1.isVisible=true,this.addClass("ra-shareControlShowBottomRow")):(Jx.removeClass(this._canvas$1.element,"hasLinkPreview"),this._linkPreview$1.mode=0,this._linkPreview$1.isVisible=false,this._linkPreviewClear$1.isVisible=false,this._characterCount$1.isVisible||this.removeClass("ra-shareControlShowBottomRow"));this._updateHasRichLink$1();this._updateCanvasHeight$1();this._updateCharacterCount$1();this._updateSendButton$1()};People.RecentActivity.UI.Share.ShareControl.prototype._updateHasRichLink$1=function(){this.hasRichLink=!!this._linkPreview$1.mode};People.RecentActivity.UI.Share.ShareControl.prototype._updateCanvasHeight$1=function(){this._linkPreview$1&&this._linkPreview$1.isVisible?this.addClass("ra-shareControlShowLinkPreview"):this.removeClass("ra-shareControlShowLinkPreview")};People.RecentActivity.UI.Share.ShareControl.prototype._getFeedObjectInfo$1=function(){var i=null,r=People.RecentActivity.Core.FeedEntryInfoType.none,u=this._canvas$1.textContent,n,t,f;return!this._linkPreview$1.mode||this._currentLink$1==null?(i=People.RecentActivity.Core.create_feedEntryStatusDataInfo(this._canvas$1.textContent),r=People.RecentActivity.Core.FeedEntryInfoType.text):(n=this._linkPreview$1.linkData,t=n.url,People.RecentActivity.UI.Core.LinkHelper.isVideoLink(t)?(i=People.RecentActivity.Core.create_feedEntryVideoDataInfo(u,null,null,null,null,People.RecentActivity.Core.FeedEntryVideoDataInfoType.embed,t,t),r=People.RecentActivity.Core.FeedEntryInfoType.video):(i=People.RecentActivity.Core.create_feedEntryLinkDataInfo(u,t,n.title,null,n.description,n.thumbnailUrl),r=People.RecentActivity.Core.FeedEntryInfoType.link)),f=People.RecentActivity.Core.create_feedEntryInfo(r,null,i,null,null,null,false),People.RecentActivity.Core.create_feedObjectInfo(null,this._currentNetwork$1.id,People.RecentActivity.Core.FeedObjectInfoType.entry,f,null,0,null,null,null,null)};People.RecentActivity.UI.Share.ShareControl.prototype._updateSendButton$1=function(){this._sending$1||!this._linkPreview$1.mode&&this._characterCount$1.currentCharacterCount<1?(this._sendButtonVisible$1=false,this._sendButtonDisabled$1=true):this._characterCount$1.limitExceeded?(this._sendButtonVisible$1=true,this._sendButtonDisabled$1=true):(this._sendButtonVisible$1=true,this._sendButtonDisabled$1=false);this._processSendButtonAnimations$1()};People.RecentActivity.UI.Share.ShareControl.prototype._updateCharacterCount$1=function(n){n==null&&(n=this._canvas$1.textContent);this._characterCount$1.currentCharacterCount=People.RecentActivity.UI.Core.LinkHelper.calculateContentLength(n,this._currentNetwork$1.id)};People.RecentActivity.UI.Share.ShareControl.prototype._processSendButtonAnimations$1=function(){this._sendButtonFadeCurrent$1=this._sendButtonFadeCurrent$1.then(this._ensureSendButtonState$1.bind(this))};People.RecentActivity.UI.Share.ShareControl.prototype._ensureSendButtonState$1=function(){if(this.isDisposed)return null;if(this._sendButton$1.isDisabled=this._sendButtonDisabled$1,!this._sendButtonVisible$1&&this._sendButton$1.isVisible){var n=this;return People.Animation.fadeOut(this._sendButton$1.element).then(function(){return n.isDisposed?null:(n._sendButton$1.isVisible=false,null)})}return this._sendButtonVisible$1&&!this._sendButton$1.isVisible?(this._sendButton$1.isVisible=true,People.Animation.fadeIn(this._sendButton$1.element)):null};People.RecentActivity.UI.Share.ShareControl.prototype._isSupportedScheme$1=function(n){var t=n.schemeName.toUpperCase();return t==="HTTP"||t==="HTTPS"};People.RecentActivity.UI.Share.ShareControl.prototype._updateError$1=function(){var n=this._errorMessage$1.element,t;this._errorMessage$1.isVisible||this._lastNetworkError$1==null?this._errorMessage$1.isVisible&&this._lastNetworkError$1==null?(t=this,People.Animation.fadeOut(n).done(function(){return t.isDisposed?null:(t._errorMessage$1.isVisible=false,n.innerHTML="",t._updateCanvasHeight$1(),null)})):this._lastNetworkError$1!=null&&(n.innerHTML="",this._errorMessage$1.appendChild(this._lastNetworkError$1)):(n.innerHTML="",this._errorMessage$1.appendChild(this._lastNetworkError$1),this._errorMessage$1.isVisible=true,this._updateCanvasHeight$1(),People.Animation.fadeIn(n))};People.RecentActivity.UI.Share.ShareControl.prototype._onShareSuccess$1=function(){this._biciData$1.sendSucceeded=People.RecentActivity.Core.BiciBoolean.biciTrue;this._logBiciData$1();this._lastNetworkError$1=null;this._currentLink$1=null;this._canvas$1.clear();this._onShareCompleted$1(People.RecentActivity.Core.ResultCode.success)};People.RecentActivity.UI.Share.ShareControl.prototype._onShareCompleted$1=function(n){var t=this;People.Animation.fadeOut(this._overlay$1.element).done(function(){return t.isDisposed?null:(t._sendProgress$1.removeFromParent(),t._overlay$1.isVisible=false,t._networkSelect$1.isDisabled=false,t._canvas$1.isDisabled=false,t._linkPreview$1.isDisabled=false,t._linkPreviewClear$1.isDisabled=false,t._sending$1=false,t._updateBody$1(),t._updateError$1(),t.raiseEvent("completed",n),null)})};People.RecentActivity.UI.Share.ShareControl.prototype._clearLinkPreview$1=function(){this._currentLink$1=null;this._biciData$1.shareType=People.RecentActivity.Core.BiciShareType.text;this._updateBody$1()};People.RecentActivity.UI.Share.ShareControl.prototype._createBiciData$1=function(){var n=new People.RecentActivity.UI.Share.ShareBici;return n.hasNetworks=People.RecentActivity.Core.BiciBoolean.biciTrue,n.shareEntryPoint=People.RecentActivity.Core.BiciShareEntryPoint.inApp,n.shareType=People.RecentActivity.Core.BiciShareType.text,this._networkSelect$1!=null&&(n.socialNetworkId=this._networkSelect$1.selectedNetwork.id),n.resetHasData(),n};People.RecentActivity.UI.Share.ShareControl.prototype._logBiciData$1=function(){if(this._biciData$1!=null){var n=this._biciData$1;n.hasData&&(People.RecentActivity.Core.BiciHelper.createShareDatapoint(n.hasNetworks,n.messageLength,n.changedNetworks,n.clickedSend,n.sendSucceeded,n.shareType,n.shareEntryPoint,n.socialNetworkId,n.shareSourcePeopleApp),this._biciData$1=this._createBiciData$1())}};People.RecentActivity.UI.Share.ShareControl.prototype._createReconnectLink$1=function(){return this._reconnectLink$1==null&&(this._reconnectLink$1=new People.RecentActivity.UI.Core.Control(document.createElement("a")),this._reconnectLink$1.text=Jx.res.getString("/strings/raShareLinkReconnectNetwork"),this._reconnectLink$1.attach("click",this._onReconnectLinkClicked$1.bind(this))),this._reconnectLink$1.element};People.RecentActivity.UI.Share.ShareControl.prototype._getTwitterNickname$1=function(){var n=People.RecentActivity.Platform.Platform.getNicknameBySourceId(this._identity$1.getDataContext(),People.RecentActivity.Core.NetworkId.twitter);return Jx.isNonEmptyString(n)?People.Social.format("@{0} ",n):""};People.RecentActivity.UI.Share.ShareControl.prototype._refreshDisplayFeed=function(){if(this._currentNetwork$1.shareRefreshDelay>0){if(this._refreshTimeout===-1){var n=this;this._refreshTimeout=window.setTimeout(function(){n._refreshTimeout=-1;n._displayFeed$1.addListener("refreshcompleted",n._onDisplayFeedRefreshCompleted$1,n);n._displayFeed$1.refresh()},this._currentNetwork$1.shareRefreshDelay)}}else this._displayFeed$1.addListener("refreshcompleted",this._onDisplayFeedRefreshCompleted$1,this),this._displayFeed$1.refresh()};People.RecentActivity.UI.Share.ShareControl.prototype._onNetworkSelectPropertyChanged$1=function(n){switch(n.propertyName){case"SelectedNetwork":var t=n.sender.selectedNetwork;this._biciData$1.socialNetworkId=t.id;this._biciData$1.changedNetworks=People.RecentActivity.Core.BiciBoolean.biciTrue;this._switchNetwork$1(t)}};People.RecentActivity.UI.Share.ShareControl.prototype._onCanvasPropertyChanged$1=function(n){switch(n.propertyName){case"CharacterCount":var t=n.sender;this._biciData$1.messageLength=t.characterCount;this._updateCharacterCount$1(t.textContent);this._updateSendButton$1()}};People.RecentActivity.UI.Share.ShareControl.prototype._onCanvasLinkInserted$1=function(n){if(this._currentLink$1==null)try{var i=n.linkUrl.toUpperCase(),r=i.substr(0,4)==="WWW."?"http://"+n.linkUrl:n.linkUrl,t=new Windows.Foundation.Uri(r);this._isSupportedScheme$1(t)&&(this._biciData$1.shareType=People.RecentActivity.Core.BiciShareType.link,this._currentLink$1=People.RecentActivity.Core.create_shareOperationInfo(Windows.ApplicationModel.DataTransfer.StandardDataFormats.uri,t,null),this._updateBody$1())}catch(u){Jx.log.write(3,"Failed to parse shared URL '"+n.linkUrl+"': "+u.toString())}};People.RecentActivity.UI.Share.ShareControl.prototype._onCanvasFocusChanged$1=function(n){if(this._currentNetwork$1.id===People.RecentActivity.Core.NetworkId.twitter&&!this._identity$1.isMe){var t=this._canvas$1.textContent,i=this._getTwitterNickname$1(),r=n.focusGained;r?Jx.isNonEmptyString(t)||(this._canvas$1.textContent=i,this._canvas$1.setSelection(false)):t===i.trim()&&(this._canvas$1.textContent="")}};People.RecentActivity.UI.Share.ShareControl.prototype._onCharacterCountPropertyChanged$1=function(n){switch(n.propertyName){case"LimitExceeded":this._updateSendButton$1()}};People.RecentActivity.UI.Share.ShareControl.prototype._onSendButtonClicked$1=function(){People.RecentActivity.Core.EtwHelper.writeShareResultEvent(People.RecentActivity.Core.EtwEventName.uiShareTargetShareStart,this._currentNetwork$1.id,People.RecentActivity.Core.ResultCode.none.toString());this._networkSelect$1.isDisabled=true;this._canvas$1.isDisabled=true;this._linkPreview$1.isDisabled=true;this._linkPreviewClear$1.isDisabled=true;this._biciData$1.clickedSend=People.RecentActivity.Core.BiciBoolean.biciTrue;this._sending$1=true;this._updateSendButton$1();this._lastNetworkError$1=null;this._updateError$1();this._overlay$1.isVisible=true;this._overlay$1.appendControl(this._sendProgress$1);this._sendProgress$1.setActive();var n=this;People.Animation.fadeIn(this._overlay$1.element).done(function(){if(n.isDisposed)return null;var t=n._currentNetwork$1.feed;return t.addListener("addentrycompleted",n._onFeedAddEntryCompleted$1,n),t.add(n._getFeedObjectInfo$1()),null})};People.RecentActivity.UI.Share.ShareControl.prototype._onFeedAddEntryCompleted$1=function(n){var t=n.sender;if(t.removeListenerSafe("addentrycompleted",this._onFeedAddEntryCompleted$1,this),n.result.code===People.RecentActivity.Core.ResultCode.success)Jx.appData.localSettings().set(People.RecentActivity.UI.Share.ShareControl.settingKey,t.network.id),this._displayFeed$1!=null&&this._displayFeed$1.initialized?this._refreshDisplayFeed():this._onShareSuccess$1();else{switch(n.result.code){case People.RecentActivity.Core.ResultCode.invalidUserCredential:this._lastNetworkError$1=People.RecentActivity.UI.Core.LocalizationHelper.loadCompoundElement("/strings/raShareErrorPermissionProblem",[document.createTextNode(this._currentNetwork$1.name),this._createReconnectLink$1()]);break;case People.RecentActivity.Core.ResultCode.userOffline:this._lastNetworkError$1=document.createTextNode(Jx.res.getString("/strings/raShareErrorNoInternetConnectivity"));break;case People.RecentActivity.Core.ResultCode.invalidPermissions:this._lastNetworkError$1=document.createTextNode(Jx.res.loadCompoundString("/strings/raShareWriteToWallError",this._identity$1.name));break;default:this._lastNetworkError$1=document.createTextNode(Jx.res.loadCompoundString("/strings/raShareErrorThirdPartyNetwork",this._currentNetwork$1.name))}this._onShareCompleted$1(n.result.code)}People.RecentActivity.Core.EtwHelper.writeShareResultEvent(People.RecentActivity.Core.EtwEventName.uiShareTargetShareStop,t.network.id,n.result.code.toString())};People.RecentActivity.UI.Share.ShareControl.prototype._onDisplayFeedRefreshCompleted$1=function(n){n.sender.removeListenerSafe("refreshcompleted",this._onDisplayFeedRefreshCompleted$1,this);this._onShareSuccess$1()};People.RecentActivity.UI.Share.ShareControl.prototype._onLinkPreviewClearClicked$1=function(n){n.preventDefault();this._clearLinkPreview$1()};People.RecentActivity.UI.Share.ShareControl.prototype._onLinkPreviewClearKeyDown$1=function(n){switch(n.keyCode){case WinJS.Utilities.Key.space:case WinJS.Utilities.Key.enter:n.preventDefault();this._clearLinkPreview$1()}};People.RecentActivity.UI.Share.ShareControl.prototype._onReconnectLinkClicked$1=function(){var t,n,i;this._currentNetwork$1!=null&&(t=Jx.root.getPlatform().accountManager,n=t.getAccountBySourceId(this._currentNetwork$1.id,""),n!=null&&(i=new People.Accounts.FlowLauncher(Jx.root.getPlatform(),Microsoft.WindowsLive.Platform.ApplicationScenario.people,"social",Jx.root.getJobSet()),i.launchManageFlow(n,true)))};People.RecentActivity.UI.Share.ShareControl.prototype._onCanvasContainerFocus=function(n){this._linkPreview$1.isVisible||(n.preventDefault(),this._canvas$1.setSelection(false))};People.RecentActivity.UI.Share.ConnectPage=function(){People.RecentActivity.UI.Core.Page.call(this,People.RecentActivity.UI.Core.HtmlHelper.createElement(People.RecentActivity.UI.Core.Html.shareConnectPage));this._networkControls$2=[]};Jx.inherit(People.RecentActivity.UI.Share.ConnectPage,People.RecentActivity.UI.Core.Page);People.RecentActivity.UI.Share.ConnectPage.prototype._header$2=null;People.RecentActivity.UI.Share.ConnectPage.prototype._error$2=null;People.RecentActivity.UI.Share.ConnectPage.prototype._networks$2=null;People.RecentActivity.UI.Share.ConnectPage.prototype._networkControls$2=null;People.RecentActivity.UI.Share.ConnectPage.prototype.onDisposed=function(){var n,t;if(this._header$2!=null&&(this._header$2.dispose(),this._header$2=null),this._error$2!=null&&(this._error$2.dispose(),this._error$2=null),this._networkControls$2!=null){for(n=0;n<this._networkControls$2.length;n++)t=this._networkControls$2[n],t.dispose();this._networkControls$2.length=0;this._networkControls$2=null}this._networks$2!=null&&(this._networks$2.dispose(),this._networks$2=null);People.RecentActivity.UI.Core.Page.prototype.onDisposed.call(this)};People.RecentActivity.UI.Share.ConnectPage.prototype.onRendered=function(){var t,i,e;if(People.RecentActivity.UI.Core.Page.prototype.onRendered.call(this),this._header$2=People.RecentActivity.UI.Core.HtmlHelper.findOrCreateControlById(this.element,"share-connectpage-header"),this._header$2.text=Jx.res.getString("/strings/raShareConnectPageHeader"),this._error$2=People.RecentActivity.UI.Core.HtmlHelper.findOrCreateControlById(this.element,"share-connectpage-error"),this._error$2.text=Jx.res.getString("/strings/raShareConnectPageError"),this._networks$2=People.RecentActivity.UI.Core.HtmlHelper.findOrCreateControlById(this.element,"share-connectpage-networklist"),t=People.RecentActivity.Providers.FeedProviderFactory.instance.getUserConnectableNetworks(),t.length>0){for(i=0;i<t.length;i++){var r=t[i],n=new People.RecentActivity.UI.Core.Control(People.RecentActivity.UI.Core.HtmlHelper.createElement(People.RecentActivity.UI.Core.Html.shareConnectPageNetwork)),u=People.RecentActivity.UI.Core.HtmlHelper.findOrCreateControlById(n.element,"share-connectpage-network-iconimage"),f=People.RecentActivity.UI.Core.HtmlHelper.findOrCreateControlById(n.element,"share-connectpage-network-text");this._networkControls$2.push(u);this._networkControls$2.push(f);this._networkControls$2.push(n);this._networks$2.appendControl(n);People.Animation.addTapAnimation(n.element);this._attachNetworkHandlers$2(n,r.objectId);e=u.element;e.src=r.icon;f.text=Jx.res.loadCompoundString("/strings/raShareConnectNetworkLabel",r.name)}this._header$2.isVisible=true;this._networks$2.isVisible=true;this._error$2.isVisible=false}else this._header$2.isVisible=false,this._networks$2.isVisible=false,this._error$2.isVisible=true};People.RecentActivity.UI.Share.ConnectPage.prototype._attachNetworkHandlers$2=function(n,t){var i=this;n.attach("click",function(n){i._onNetworkClicked$2(n,t)});n.attach("keydown",function(n){i._onNetworkKeyDown$2(n,t)})};People.RecentActivity.UI.Share.ConnectPage.prototype._launchReconnectFlow$2=function(n){People.RecentActivity.UI.Core.UriHelper.launchUri(People.RecentActivity.Configuration.getNetworkReconnectUrl(n,false))};People.RecentActivity.UI.Share.ConnectPage.prototype._onNetworkClicked$2=function(n,t){this._launchReconnectFlow$2(t)};People.RecentActivity.UI.Share.ConnectPage.prototype._onNetworkKeyDown$2=function(n,t){switch(n.keyCode){case WinJS.Utilities.Key.enter:case WinJS.Utilities.Key.space:this._launchReconnectFlow$2(t);n.preventDefault();n.cancelBubble=true}};People.RecentActivity.UI.Share.ErrorPage=function(){People.RecentActivity.UI.Core.Page.call(this,People.RecentActivity.UI.Core.HtmlHelper.createElement(People.RecentActivity.UI.Core.Html.shareErrorPage))};Jx.inherit(People.RecentActivity.UI.Share.ErrorPage,People.RecentActivity.UI.Core.Page);People.RecentActivity.UI.Share.ErrorPage.prototype._label$2=null;People.RecentActivity.UI.Share.ErrorPage.prototype.onDisposed=function(){this._label$2!=null&&(this._label$2.dispose(),this._label$2=null);People.RecentActivity.UI.Core.Page.prototype.onDisposed.call(this)};People.RecentActivity.UI.Share.ErrorPage.prototype.onRendered=function(){People.RecentActivity.UI.Core.Page.prototype.onRendered.call(this);this.text=Jx.res.getString("/strings/raShareLoadingErrorLabel")};People.RecentActivity.UI.Share.LoadingPage=function(n){People.RecentActivity.UI.Core.Page.call(this,People.RecentActivity.UI.Core.HtmlHelper.createElement(People.RecentActivity.UI.Core.Html.shareLoadingPage));this._dataPackageProperties$2=n};Jx.inherit(People.RecentActivity.UI.Share.LoadingPage,People.RecentActivity.UI.Core.Page);People.RecentActivity.UI.Share.LoadingPage.prototype._dataPackageProperties$2=null;People.RecentActivity.UI.Share.LoadingPage.prototype._label$2=null;People.RecentActivity.UI.Share.LoadingPage.prototype.onDisposed=function(){this._label$2!=null&&(this._label$2.dispose(),this._label$2=null);People.RecentActivity.UI.Core.Page.prototype.onDisposed.call(this)};People.RecentActivity.UI.Share.LoadingPage.prototype.onRendered=function(){People.RecentActivity.UI.Core.Page.prototype.onRendered.call(this);this._label$2=People.RecentActivity.UI.Core.HtmlHelper.findOrCreateControlById(this.element,"share-content-loading-label");this._label$2.text=Jx.res.loadCompoundString("/strings/raShareWaitingForAppProgressLabel",this._dataPackageProperties$2.applicationName)};People.RecentActivity.UI.Share.SharePage=function(n,t,i){People.RecentActivity.UI.Core.Page.call(this,People.RecentActivity.UI.Core.HtmlHelper.createElement(People.RecentActivity.UI.Core.Html.sharePage));this._identity$2=n;this._shareOperation$2=t;this._biciData$2=i;this._biciData$2.shareType=People.RecentActivity.Core.BiciShareType.link};Jx.inherit(People.RecentActivity.UI.Share.SharePage,People.RecentActivity.UI.Core.Page);People.RecentActivity.UI.Share.SharePage.prototype._identity$2=null;People.RecentActivity.UI.Share.SharePage.prototype._shareOperation$2=null;People.RecentActivity.UI.Share.SharePage.prototype._biciData$2=null;People.RecentActivity.UI.Share.SharePage.prototype._currentNetwork$2=null;People.RecentActivity.UI.Share.SharePage.prototype._lastNetworkError$2=null;People.RecentActivity.UI.Share.SharePage.prototype._overlay$2=null;People.RecentActivity.UI.Share.SharePage.prototype._container$2=null;People.RecentActivity.UI.Share.SharePage.prototype._header$2=null;People.RecentActivity.UI.Share.SharePage.prototype._bodyContainer$2=null;People.RecentActivity.UI.Share.SharePage.prototype._body$2=null;People.RecentActivity.UI.Share.SharePage.prototype._networkSelect$2=null;People.RecentActivity.UI.Share.SharePage.prototype._sendButton$2=null;People.RecentActivity.UI.Share.SharePage.prototype._sendProgress$2=null;People.RecentActivity.UI.Share.SharePage.prototype._errorMessage$2=null;People.RecentActivity.UI.Share.SharePage.prototype._canvas$2=null;People.RecentActivity.UI.Share.SharePage.prototype._linkPreview$2=null;People.RecentActivity.UI.Share.SharePage.prototype._characterCount$2=null;People.RecentActivity.UI.Share.SharePage.prototype._currentMode$2=0;People.RecentActivity.UI.Share.SharePage.prototype._shareInfo$2=null;People.RecentActivity.UI.Share.SharePage.prototype._shareButtonClicked$2=false;People.RecentActivity.UI.Share.SharePage.prototype._inputPane$2=null;Object.defineProperty(People.RecentActivity.UI.Share.SharePage.prototype,"shareInfo",{get:function(){return this._shareInfo$2},set:function(n){this._shareInfo$2=n}});People.RecentActivity.UI.Share.SharePage.prototype.onDisposed=function(){People.RecentActivity.UI.Core.EventManager.events.removeListenerSafe("windowonline",this._onOnlineOfflineChanged$2,this);People.RecentActivity.UI.Core.EventManager.events.removeListenerSafe("windowoffline",this._onOnlineOfflineChanged$2,this);this._inputPane$2!=null&&(this._inputPane$2.removeListenerSafe("showing",this._onInputPaneShowing$2,this),this._inputPane$2.removeListenerSafe("hiding",this._onInputPaneHiding$2,this),this._inputPane$2.dispose(),this._inputPane$2=null);this._networkSelect$2!=null&&(this._networkSelect$2.removeListenerSafe("propertychanged",this._onNetworkSelectPropertyChanged$2,this),this._networkSelect$2.dispose(),this._networkSelect$2=null);this._sendButton$2!=null&&(this._sendButton$2.removeListenerSafe("clicked",this._onSendButtonClicked$2,this),this._sendButton$2.dispose(),this._sendButton$2=null);this._errorMessage$2!=null&&(this._errorMessage$2.dispose(),this._errorMessage$2=null);this._header$2!=null&&(this._header$2.dispose(),this._header$2=null);this._canvas$2!=null&&(this._canvas$2.removeListenerSafe("propertychanged",this._onCanvasPropertyChanged$2,this),this._canvas$2.dispose(),this._canvas$2=null);this._linkPreview$2!=null&&(this._linkPreview$2.removeListenerSafe("propertychanged",this._onLinkPreviewPropertyChanged$2,this),this._linkPreview$2.dispose(),this._linkPreview$2=null);this._characterCount$2!=null&&(this._characterCount$2.removeListenerSafe("propertychanged",this._onCharacterCountPropertyChanged$2,this),this._characterCount$2.dispose(),this._characterCount$2=null);this._body$2!=null&&(this._body$2.dispose(),this._body$2=null);this._bodyContainer$2!=null&&(this._bodyContainer$2.dispose(),this._body$2=null);this._container$2!=null&&(this._container$2.dispose(),this._container$2=null);this._sendProgress$2!=null&&(this._sendProgress$2.dispose(),this._sendProgress$2=null);this._overlay$2!=null&&(this._overlay$2.dispose(),this._overlay$2=null);this._currentNetwork$2!=null&&(this._currentNetwork$2.feed.removeListenerSafe("addentrycompleted",this._onFeedAddEntryCompleted$2,this),this._currentNetwork$2=null);People.RecentActivity.UI.Core.Page.prototype.onDisposed.call(this)};People.RecentActivity.UI.Share.SharePage.prototype.onRendered=function(){People.RecentActivity.UI.Core.Page.prototype.onRendered.call(this);this._currentMode$2=0;this._overlay$2=People.RecentActivity.UI.Core.HtmlHelper.findOrCreateControlById(this.element,"share-content-overlay");this._overlay$2.render();this._overlay$2.isVisible=false;this._sendProgress$2=new People.RecentActivity.UI.Share.ProgressControl(Jx.res.getString("/strings/raShareSendProgressLabel"));this._sendProgress$2.render();this._container$2=People.RecentActivity.UI.Core.HtmlHelper.findOrCreateControlById(this.element,"share-content-container");this._header$2=People.RecentActivity.UI.Core.HtmlHelper.findOrCreateControlById(this._container$2.element,"share-content-header");var t=this._identity$2.networks,n=this._shareOperation$2.quickLinkId;if(Jx.isNonEmptyString(n)){if(this._biciData$2.shareEntryPoint=People.RecentActivity.Core.BiciShareEntryPoint.quickLink,t.findById(n)==null){try{this._shareOperation$2.removeThisQuickLink()}catch(i){Jx.log.exception("Failed to remove QuickLink for '"+n+"'",i)}n=null}}else this._biciData$2.shareEntryPoint=People.RecentActivity.Core.BiciShareEntryPoint.shareCharm,n=Jx.appData.localSettings().get(People.RecentActivity.UI.Share.ShareControl.settingKey);this._networkSelect$2=new People.RecentActivity.UI.Share.NetworkSelectorControl(this._identity$2.networks,n);this._header$2.appendControl(this._networkSelect$2);this._networkSelect$2.render();this._sendButton$2=new People.RecentActivity.UI.Share.SendButtonControl;this._header$2.appendControl(this._sendButton$2);this._sendButton$2.addListener("clicked",this._onSendButtonClicked$2,this);this._sendButton$2.render();this._errorMessage$2=new People.RecentActivity.UI.Core.Control(People.RecentActivity.UI.Core.HtmlHelper.createElement(People.RecentActivity.UI.Core.Html.shareErrorMessage));this._header$2.appendControl(this._errorMessage$2);this._errorMessage$2.render();this._errorMessage$2.isVisible=false;this._bodyContainer$2=People.RecentActivity.UI.Core.HtmlHelper.findOrCreateControlById(this._container$2.element,"share-content-body-container");this._body$2=People.RecentActivity.UI.Core.HtmlHelper.findOrCreateControlById(this._bodyContainer$2.element,"share-content-body");this._canvas$2=new People.RecentActivity.UI.Share.CanvasControl;this._canvas$2.addListener("propertychanged",this._onCanvasPropertyChanged$2,this);this._body$2.appendControl(this._canvas$2);this._canvas$2.render();this._linkPreview$2=new People.RecentActivity.UI.Share.LinkPreviewControl;this._linkPreview$2.shareInfo=this._shareInfo$2;this._linkPreview$2.addListener("propertychanged",this._onLinkPreviewPropertyChanged$2,this);this._body$2.appendControl(this._linkPreview$2);this._linkPreview$2.render();this._characterCount$2=new People.RecentActivity.UI.Share.CharacterCountControl;this._body$2.appendControl(this._characterCount$2);this._characterCount$2.addListener("propertychanged",this._onCharacterCountPropertyChanged$2,this);this._characterCount$2.render();People.RecentActivity.UI.Core.EventManager.events.addListener("windowonline",this._onOnlineOfflineChanged$2,this);People.RecentActivity.UI.Core.EventManager.events.addListener("windowoffline",this._onOnlineOfflineChanged$2,this);this._inputPane$2=new People.RecentActivity.UI.Core.InputManager;this._inputPane$2.addListener("showing",this._onInputPaneShowing$2,this);this._inputPane$2.addListener("hiding",this._onInputPaneHiding$2,this);this._networkSelect$2.addListener("propertychanged",this._onNetworkSelectPropertyChanged$2,this);this._switchNetwork$2(this._networkSelect$2.selectedNetwork)};People.RecentActivity.UI.Share.SharePage.prototype.onEnter=function(){return People.Animation.enterPage([this._header$2.element,this._bodyContainer$2.element])};People.RecentActivity.UI.Share.SharePage.prototype.onExit=function(){return People.Animation.exitPage([this._header$2.element,this._bodyContainer$2.element])};People.RecentActivity.UI.Share.SharePage.prototype._getPageMode$2=function(n){switch(n.id){case People.RecentActivity.Core.NetworkId.twitter:return 2;default:return 1}};People.RecentActivity.UI.Share.SharePage.prototype._sendShare$2=function(){People.RecentActivity.Core.EtwHelper.writeShareResultEvent(People.RecentActivity.Core.EtwEventName.uiShareTargetShareStart,this._currentNetwork$2.id,People.RecentActivity.Core.ResultCode.none.toString());this._biciData$2.clickedSend=People.RecentActivity.Core.BiciBoolean.biciTrue;this._container$2.isDisabled=true;var n=this;People.Animation.fadeOut(this._sendButton$2.element).then(function(){return n.isDisposed?null:(n._sendButton$2.isVisible=false,n._overlay$2.isVisible=true,n._overlay$2.appendControl(n._sendProgress$2),n._sendProgress$2.setActive(),People.Animation.fadeIn(n._overlay$2.element))}).done(function(){return n.isDisposed||(n._shareButtonClicked$2=true,n._trySendShare$2()),null})};People.RecentActivity.UI.Share.SharePage.prototype._trySendShare$2=function(){this._shareButtonClicked$2&&!this._linkPreview$2.loading&&(this._shareButtonClicked$2=false,this._currentNetwork$2.feed.addListener("addentrycompleted",this._onFeedAddEntryCompleted$2,this),this._currentNetwork$2.feed.add(this._getFeedObjectInfo$2()))};People.RecentActivity.UI.Share.SharePage.prototype._getFeedObjectInfo$2=function(){var i=null,r=People.RecentActivity.Core.FeedEntryInfoType.none,u=this._getTextContent$2(),n,t,f;return this._currentNetwork$2.id===People.RecentActivity.Core.NetworkId.twitter?(i=People.RecentActivity.Core.create_feedEntryStatusDataInfo(u),r=People.RecentActivity.Core.FeedEntryInfoType.text):(n=this._linkPreview$2.linkData,t=n.url,People.RecentActivity.UI.Core.LinkHelper.isVideoLink(t)?(i=People.RecentActivity.Core.create_feedEntryVideoDataInfo(u,null,null,null,null,People.RecentActivity.Core.FeedEntryVideoDataInfoType.embed,t,t),r=People.RecentActivity.Core.FeedEntryInfoType.video):(i=People.RecentActivity.Core.create_feedEntryLinkDataInfo(u,t,n.title,null,n.description,n.thumbnailUrl),r=People.RecentActivity.Core.FeedEntryInfoType.link)),f=People.RecentActivity.Core.create_feedEntryInfo(r,null,i,null,null,null,false),People.RecentActivity.Core.create_feedObjectInfo(null,this._currentNetwork$2.id,People.RecentActivity.Core.FeedObjectInfoType.entry,f,null,0,null,null,null,null)};People.RecentActivity.UI.Share.SharePage.prototype._getTextContent$2=function(){var n,t;return n=this._canvas$2.textContent,this._currentNetwork$2.id===People.RecentActivity.Core.NetworkId.twitter&&this._shareInfo$2.dataFormat===Windows.ApplicationModel.DataTransfer.StandardDataFormats.uri?(t=this._linkPreview$2.linkData.url,Jx.isNonEmptyString(n)?n+" "+t:t):n};People.RecentActivity.UI.Share.SharePage.prototype._switchNetwork$2=function(n){var r=this,t,i;return this._currentNetwork$2===n?WinJS.Promise.wrap(null):(this._currentNetwork$2!=null&&this._currentNetwork$2.feed.removeListenerSafe("addentrycompleted",this._onFeedAddEntryCompleted$2,this),this._currentNetwork$2=n,this._biciData$2.socialNetworkId=n.id,this._lastNetworkError$2=null,this._updateError$2(),t=this._currentMode$2,i=this._getPageMode$2(n),i===t)?WinJS.Promise.wrap(null):(this._currentMode$2=i,t?People.Animation.exitContent(this._body$2.element).then(function(){return r.isDisposed?null:r._updateBody$2(false)}):this._updateBody$2(true))};People.RecentActivity.UI.Share.SharePage.prototype._updateError$2=function(){var r=this,o=People.RecentActivity.Platform.AuthInfo.getInstance(this._currentNetwork$2.id),n=null,t,u,f,e,i;this._lastNetworkError$2!=null?n=this._lastNetworkError$2:o.publishScenarioState!==People.RecentActivity.Platform.PsaStatus.connected?n=People.RecentActivity.UI.Core.LocalizationHelper.loadCompoundElement("/strings/raShareWarningPossiblePermissionProblem",[document.createTextNode(this._currentNetwork$2.name),this._createReconnectLink$2()]):People.RecentActivity.Platform.Configuration.instance.isOnline||(n=document.createTextNode(Jx.res.getString("/strings/raShareWarningNoInternetConnectivity")));t=this._errorMessage$2.element;u=this._bodyContainer$2.element;this._errorMessage$2.isVisible||n==null?this._errorMessage$2.isVisible&&n==null?(e=People.Animation.createCollapseAnimation(t,u),i=t.style,this._container$2.addClass("ra-shareHeaderCollapse"),i.position="absolute",i.opacity="0",e.execute().then(function(){return r.isDisposed||(i.position="",i.opacity="",r._errorMessage$2.isVisible=false,t.innerHTML="",r._container$2.removeClass("ra-shareHeaderCollapse")),null})):(t.innerHTML="",n!=null&&this._errorMessage$2.appendChild(n)):(f=People.Animation.createExpandAnimation(t,u),t.innerHTML="",this._errorMessage$2.appendChild(n),this._errorMessage$2.isVisible=true,f.execute())};People.RecentActivity.UI.Share.SharePage.prototype._updateBody$2=function(n){return(this._currentMode$2===2?(this.addClass("ra-shareContentBodyTwitter"),this._linkPreview$2.mode=1,this._characterCount$2.maxCharacterCount=140,this._updateCharacterCount$2()):(this.removeClass("ra-shareContentBodyTwitter"),this._linkPreview$2.mode=2,this._characterCount$2.maxCharacterCount=-1),!n)?People.Animation.enterContent(this._body$2.element):WinJS.Promise.wrap(null)};People.RecentActivity.UI.Share.SharePage.prototype._updateCharacterCount$2=function(){this._characterCount$2.currentCharacterCount=People.RecentActivity.UI.Core.LinkHelper.calculateContentLength(this._getTextContent$2(),this._currentNetwork$2.id)};People.RecentActivity.UI.Share.SharePage.prototype._createReconnectLink$2=function(){var n=document.createElement("a");return n.href=People.RecentActivity.Configuration.getNetworkReconnectUrl(this._currentNetwork$2.objectId,true),n.innerText=Jx.res.getString("/strings/raShareLinkReconnectNetwork"),n};People.RecentActivity.UI.Share.SharePage.prototype._onCharacterCountPropertyChanged$2=function(n){var t=n.sender;switch(n.propertyName){case"LimitExceeded":this._sendButton$2.isDisabled=t.limitExceeded}};People.RecentActivity.UI.Share.SharePage.prototype._onFeedAddEntryCompleted$2=function(n){var i=n.sender,r,t;if(i.removeListenerSafe("addentrycompleted",this._onFeedAddEntryCompleted$2,this),this._lastNetworkError$2=null,n.result.code===People.RecentActivity.Core.ResultCode.success)r=new Windows.ApplicationModel.DataTransfer.ShareTarget.QuickLink,r.id=i.network.id,r.title=Jx.res.loadCompoundString("/strings/raShareQuickLinkAction",i.network.name),r.thumbnail=Windows.Storage.Streams.RandomAccessStreamReference.createFromUri(new Windows.Foundation.Uri(i.network.icon)),r.supportedDataFormats.replaceAll(People.RecentActivity.Configuration.shareSupportedDataFormats),Jx.appData.localSettings().set(People.RecentActivity.UI.Share.ShareControl.settingKey,i.network.id),this._biciData$2.sendSucceeded=People.RecentActivity.Core.BiciBoolean.biciTrue,this._shareOperation$2.reportCompleted(r);else{switch(n.result.code){case People.RecentActivity.Core.ResultCode.invalidUserCredential:case People.RecentActivity.Core.ResultCode.invalidPermissions:this._lastNetworkError$2=People.RecentActivity.UI.Core.LocalizationHelper.loadCompoundElement("/strings/raShareErrorPermissionProblem",[document.createTextNode(this._currentNetwork$2.name),this._createReconnectLink$2()]);break;case People.RecentActivity.Core.ResultCode.userOffline:this._lastNetworkError$2=document.createTextNode(Jx.res.getString("/strings/raShareErrorNoInternetConnectivity"));break;default:this._lastNetworkError$2=document.createTextNode(Jx.res.loadCompoundString("/strings/raShareErrorThirdPartyNetwork",this._currentNetwork$2.name))}t=this;People.Animation.fadeOut(this._overlay$2.element).then(function(){return t.isDisposed?null:(t._sendProgress$2.removeFromParent(),t._overlay$2.isVisible=false,t._sendButton$2.isVisible=true,People.Animation.fadeIn(t._sendButton$2.element))}).done(function(){return t.isDisposed||(t._container$2.isDisabled=false,t._updateError$2()),null})}People.RecentActivity.Core.EtwHelper.writeShareResultEvent(People.RecentActivity.Core.EtwEventName.uiShareTargetShareStop,i.network.id,n.result.code.toString())};People.RecentActivity.UI.Share.SharePage.prototype._onLinkPreviewPropertyChanged$2=function(n){switch(n.propertyName){case"Loading":this._trySendShare$2()}};People.RecentActivity.UI.Share.SharePage.prototype._onCanvasPropertyChanged$2=function(n){var t=n.sender;switch(n.propertyName){case"CharacterCount":this._biciData$2.messageLength=t.characterCount;this._updateCharacterCount$2()}};People.RecentActivity.UI.Share.SharePage.prototype._onNetworkSelectPropertyChanged$2=function(n){var t=n.sender;switch(n.propertyName){case"SelectedNetwork":this._biciData$2.changedNetworks=People.RecentActivity.Core.BiciBoolean.biciTrue;this._switchNetwork$2(t.selectedNetwork)}};People.RecentActivity.UI.Share.SharePage.prototype._onOnlineOfflineChanged$2=function(){this._updateError$2()};People.RecentActivity.UI.Share.SharePage.prototype._onSendButtonClicked$2=function(){this._sendShare$2()};People.RecentActivity.UI.Share.SharePage.prototype._onInputPaneShowing$2=function(n){n.ensuredFocusedElementInView=true;this._bodyContainer$2.element.style.marginBottom=n.occludedRect.height+"px";this._canvas$2.scrollSelectionIntoView()};People.RecentActivity.UI.Share.SharePage.prototype._onInputPaneHiding$2=function(n){n.ensuredFocusedElementInView=true;this._bodyContainer$2.element.style.marginBottom=null};People.RecentActivity.UI.Share.SyncingPage=function(){People.RecentActivity.UI.Core.Page.call(this,People.RecentActivity.UI.Core.HtmlHelper.createElement(People.RecentActivity.UI.Core.Html.shareSyncingPage))};Jx.inherit(People.RecentActivity.UI.Share.SyncingPage,People.RecentActivity.UI.Core.Page);People.RecentActivity.UI.Share.SyncingPage.prototype._label$2=null;People.RecentActivity.UI.Share.SyncingPage.prototype.onDisposed=function(){this._label$2!=null&&(this._label$2.dispose(),this._label$2=null);People.RecentActivity.UI.Core.Page.prototype.onDisposed.call(this)};People.RecentActivity.UI.Share.SyncingPage.prototype.onRendered=function(){People.RecentActivity.UI.Core.Page.prototype.onRendered.call(this);this._label$2=People.RecentActivity.UI.Core.HtmlHelper.findOrCreateControlById(this.element,"share-content-syncing-label");this._label$2.text=Jx.res.getString("/strings/raShareSyncingLabel")};People.RecentActivity.UI.Share.ShareBici=function(){};People.RecentActivity.UI.Share.ShareBici.prototype._hasData=false;People.RecentActivity.UI.Share.ShareBici.prototype._hasNetworks=0;People.RecentActivity.UI.Share.ShareBici.prototype._messageLength=0;People.RecentActivity.UI.Share.ShareBici.prototype._changedNetworks=0;People.RecentActivity.UI.Share.ShareBici.prototype._clickedSend=0;People.RecentActivity.UI.Share.ShareBici.prototype._sendSucceeded=0;People.RecentActivity.UI.Share.ShareBici.prototype._shareType=0;People.RecentActivity.UI.Share.ShareBici.prototype._shareEntryPoint=0;People.RecentActivity.UI.Share.ShareBici.prototype._socialNetworkId=null;People.RecentActivity.UI.Share.ShareBici.prototype._shareSourcePeopleApp=null;Object.defineProperty(People.RecentActivity.UI.Share.ShareBici.prototype,"hasData",{get:function(){return this._hasData}});Object.defineProperty(People.RecentActivity.UI.Share.ShareBici.prototype,"hasNetworks",{get:function(){return this._hasNetworks},set:function(n){this._hasData=true;this._hasNetworks=n}});Object.defineProperty(People.RecentActivity.UI.Share.ShareBici.prototype,"messageLength",{get:function(){return this._messageLength},set:function(n){this._hasData=true;this._messageLength=n}});Object.defineProperty(People.RecentActivity.UI.Share.ShareBici.prototype,"changedNetworks",{get:function(){return this._changedNetworks},set:function(n){this._hasData=true;this._changedNetworks=n}});Object.defineProperty(People.RecentActivity.UI.Share.ShareBici.prototype,"clickedSend",{get:function(){return this._clickedSend},set:function(n){this._hasData=true;this._clickedSend=n}});Object.defineProperty(People.RecentActivity.UI.Share.ShareBici.prototype,"sendSucceeded",{get:function(){return this._sendSucceeded},set:function(n){this._hasData=true;this._sendSucceeded=n}});Object.defineProperty(People.RecentActivity.UI.Share.ShareBici.prototype,"shareType",{get:function(){return this._shareType},set:function(n){this._hasData=true;this._shareType=n}});Object.defineProperty(People.RecentActivity.UI.Share.ShareBici.prototype,"shareEntryPoint",{get:function(){return this._shareEntryPoint},set:function(n){this._hasData=true;this._shareEntryPoint=n}});Object.defineProperty(People.RecentActivity.UI.Share.ShareBici.prototype,"socialNetworkId",{get:function(){return this._socialNetworkId},set:function(n){this._hasData=true;this._socialNetworkId=n}});Object.defineProperty(People.RecentActivity.UI.Share.ShareBici.prototype,"shareSourcePeopleApp",{get:function(){return this._shareSourcePeopleApp},set:function(n){this._hasData=true;this._shareSourcePeopleApp=n}});People.RecentActivity.UI.Share.ShareBici.prototype.resetHasData=function(){this._hasData=false};People.RecentActivity.UI.Share.ShareLayout=function(n,t){People.RecentActivity.UI.Core.Control.call(this,n);this._identity$1=People.RecentActivity.Identity.createMeIdentity();this._shareOperation$1=t;this._biciData$1=new People.RecentActivity.UI.Share.ShareBici;this._biciData$1.shareSourcePeopleApp=t.data.properties.applicationName;this._shareOperationParser$1=new People.RecentActivity.ShareOperationParser(this._shareOperation$1.data,[Windows.ApplicationModel.DataTransfer.StandardDataFormats.webLink]);this._shareOperationParser$1.addListener("completed",this._onShareOperationParserCompleted$1,this);this._shareOperationParser$1.process(null);People.RecentActivity.Core.EtwHelper.writeSimpleEvent(People.RecentActivity.Core.EtwEventName.uiShareTargetPlatformSyncStart);this._capabilities$1=this._identity$1.capabilities;this._capabilities$1.initialized&&People.RecentActivity.Core.EtwHelper.writeSimpleEvent(People.RecentActivity.Core.EtwEventName.uiShareTargetPlatformSyncStop);this._capabilities$1.addListener("propertychanged",this._onCapabilitiesPropertyChanged$1,this)};Jx.inherit(People.RecentActivity.UI.Share.ShareLayout,People.RecentActivity.UI.Core.Control);People.RecentActivity.UI.Share.ShareLayout.prototype._shareOperation$1=null;People.RecentActivity.UI.Share.ShareLayout.prototype._biciData$1=null;People.RecentActivity.UI.Share.ShareLayout.prototype._shareOperationParser$1=null;People.RecentActivity.UI.Share.ShareLayout.prototype._identity$1=null;People.RecentActivity.UI.Share.ShareLayout.prototype._capabilities$1=null;People.RecentActivity.UI.Share.ShareLayout.prototype._syncPage$1=null;People.RecentActivity.UI.Share.ShareLayout.prototype._connectPage$1=null;People.RecentActivity.UI.Share.ShareLayout.prototype._loadingPage$1=null;People.RecentActivity.UI.Share.ShareLayout.prototype._errorPage$1=null;People.RecentActivity.UI.Share.ShareLayout.prototype._sharePage$1=null;People.RecentActivity.UI.Share.ShareLayout.prototype._currentPage$1=null;People.RecentActivity.UI.Share.ShareLayout.prototype.onDisposed=function(){Jx.log.write(4,"People.RecentActivity.UI.Share.ShareLayout.OnDisposed");this._logBiciData$1();this._capabilities$1!=null&&(this._capabilities$1.removeListenerSafe("propertychanged",this._onCapabilitiesPropertyChanged$1,this),this._capabilities$1=null);this._identity$1!=null&&(this._identity$1.dispose(),this._identity$1=null);this._shareOperationParser$1!=null&&(this._shareOperationParser$1.removeListenerSafe("completed",this._onShareOperationParserCompleted$1,this),this._shareOperationParser$1=null);this._currentPage$1=null;this._sharePage$1!=null&&(this._sharePage$1.dispose(),this._sharePage$1=null);this._connectPage$1!=null&&(this._connectPage$1.dispose(),this._connectPage$1=null);this._syncPage$1!=null&&(this._syncPage$1.dispose(),this._syncPage$1=null);this._loadingPage$1!=null&&(this._loadingPage$1.dispose(),this._loadingPage$1=null);this._errorPage$1!=null&&(this._errorPage$1.dispose(),this._errorPage$1=null);People.RecentActivity.UI.Core.Control.prototype.onDisposed.call(this)};People.RecentActivity.UI.Share.ShareLayout.prototype.onRendered=function(){People.RecentActivity.UI.Core.Control.prototype.onRendered.call(this);Jx.log.write(4,"People.RecentActivity.UI.Share.ShareLayout.OnRendered");var n=People.RecentActivity.UI.Core.HtmlHelper.createElement(People.RecentActivity.UI.Core.Html.shareLayout);this.element.appendChild(n);this._sharePage$1=new People.RecentActivity.UI.Share.SharePage(this._identity$1,this._shareOperation$1,this._biciData$1);n.appendChild(this._sharePage$1.element);this._connectPage$1=new People.RecentActivity.UI.Share.ConnectPage;n.appendChild(this._connectPage$1.element);this._syncPage$1=new People.RecentActivity.UI.Share.SyncingPage;n.appendChild(this._syncPage$1.element);this._loadingPage$1=new People.RecentActivity.UI.Share.LoadingPage(this._shareOperation$1.data.properties);n.appendChild(this._loadingPage$1.element);this._errorPage$1=new People.RecentActivity.UI.Share.ErrorPage;n.appendChild(this._errorPage$1.element);this._sharePage$1.isVisible=false;this._connectPage$1.isVisible=false;this._syncPage$1.isVisible=false;this._loadingPage$1.isVisible=false;this._errorPage$1.isVisible=false;this._setContentPage$1()};People.RecentActivity.UI.Share.ShareLayout.prototype._setContentPage$1=function(){this.isRendered&&(this._identity$1.capabilities.initialized?this._identity$1.capabilities.canShare?this._shareOperationParser$1.result===People.RecentActivity.Core.ResultCode.none?this._switchPage$1(this._loadingPage$1):this._shareOperationParser$1.result!==People.RecentActivity.Core.ResultCode.success?this._switchPage$1(this._errorPage$1):(this._biciData$1.hasNetworks=People.RecentActivity.Core.BiciBoolean.biciTrue,this._sharePage$1.shareInfo=this._shareOperationParser$1.shareInfo,this._switchPage$1(this._sharePage$1)):(this._biciData$1.hasNetworks=People.RecentActivity.Core.BiciBoolean.biciFalse,Jx.isNonEmptyString(this._shareOperation$1.quickLinkId)&&this._shareOperation$1.removeThisQuickLink(),this._switchPage$1(this._connectPage$1)):this._switchPage$1(this._syncPage$1))};People.RecentActivity.UI.Share.ShareLayout.prototype._switchPage$1=function(n){var t=this,i;n!==this._currentPage$1&&(n.isRendered||(n.isVisible=true,n.render(),n.isVisible=false),i=WinJS.Promise.wrap(null),this._currentPage$1!=null&&(i=this._currentPage$1.exit()),i.done(function(){return t.isDisposed?null:(t._currentPage$1=n,t._currentPage$1.enter())}))};People.RecentActivity.UI.Share.ShareLayout.prototype._onCapabilitiesPropertyChanged$1=function(n){var t=n.sender;switch(n.propertyName){case"Initialized":t.initialized&&People.RecentActivity.Core.EtwHelper.writeSimpleEvent(People.RecentActivity.Core.EtwEventName.uiShareTargetPlatformSyncStop);this._setContentPage$1();break;case"CanShare":this._setContentPage$1()}Jx.log.write(4,People.Social.format("ShareLayout.OnCapabilitiesPropertyChanged(PropertyName: {0}, Initialized: {1}, CanShare: {2})",n.propertyName,t.initialized,t.canShare))};People.RecentActivity.UI.Share.ShareLayout.prototype._onShareOperationParserCompleted$1=function(){this._setContentPage$1()};People.RecentActivity.UI.Share.ShareLayout.prototype._logBiciData$1=function(){if(this._biciData$1!=null){var n=this._biciData$1;People.RecentActivity.Core.BiciHelper.createShareDatapoint(n.hasNetworks,n.messageLength,n.changedNetworks,n.clickedSend,n.sendSucceeded,n.shareType,n.shareEntryPoint,n.socialNetworkId,n.shareSourcePeopleApp)}}})