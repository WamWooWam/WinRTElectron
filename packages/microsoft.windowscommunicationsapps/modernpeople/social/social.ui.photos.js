//! Copyright (c) Microsoft Corporation. All rights reserved.
Jx.delayDefine(People.RecentActivity.UI.Photos,["PhotoAlbumsPanel","PhotoAlbumsLayout"],function(){People.loadSocialModel();People.loadSocialUICore();People.RecentActivity.UI.Host.LandingPagePanelProvider;$include("$(cssResources)/Social.css");People.RecentActivity.UI.Photos.PhotoAlbumControl=function(n){People.RecentActivity.UI.Core.Control.call(this,People.RecentActivity.UI.Core.HtmlHelper.createElement(People.RecentActivity.UI.Core.Html.photoAlbumItem));this._album$1=n;this._album$1.addListener("propertychanged",this._onAlbumPropertyChanged$1,this);this._album$1.photos.addListener("propertychanged",this._onPhotosPropertyChanged$1,this)};Jx.inherit(People.RecentActivity.UI.Photos.PhotoAlbumControl,People.RecentActivity.UI.Core.Control);People.RecentActivity.UI.Photos.PhotoAlbumControl.prototype._album$1=null;People.RecentActivity.UI.Photos.PhotoAlbumControl.prototype._coverLow$1=null;People.RecentActivity.UI.Photos.PhotoAlbumControl.prototype._coverHigh$1=null;People.RecentActivity.UI.Photos.PhotoAlbumControl.prototype._name$1=null;People.RecentActivity.UI.Photos.PhotoAlbumControl.prototype._count$1=null;People.RecentActivity.UI.Photos.PhotoAlbumControl.prototype.invoke=function(){People.RecentActivity.UI.Core.SelfPageNavigationHelper.navigateToObject(this._album$1)};People.RecentActivity.UI.Photos.PhotoAlbumControl.prototype.onDisposed=function(){this._album$1!=null&&(this._album$1.removeListenerSafe("propertychanged",this._onAlbumPropertyChanged$1,this),this._album$1.photos!=null&&this._album$1.photos.removeListenerSafe("propertychanged",this._onPhotosPropertyChanged$1,this));this._name$1!=null&&(this._name$1.dispose(),this._name$1=null);this._count$1!=null&&(this._count$1.dispose(),this._count$1=null);this._coverLow$1!=null&&(this._coverLow$1.dispose(),this._coverLow$1=null);this._coverHigh$1!=null&&(this._coverHigh$1.dispose(),this._coverHigh$1=null);People.RecentActivity.UI.Core.Control.prototype.onDisposed.call(this)};People.RecentActivity.UI.Photos.PhotoAlbumControl.prototype.onRendered=function(){var n,t;People.RecentActivity.Core.EtwHelper.writeFeedObjectEvent(People.RecentActivity.Core.EtwEventName.uiRenderPhotoAlbumStart,this._album$1.objectInfo);n=this.element;this._name$1=People.RecentActivity.UI.Core.HtmlHelper.findOrCreateControlById(n,"album-name");this._name$1.id=this._name$1.uniqueId;this._name$1.text=this._album$1.name;this._name$1.title=this._album$1.name;this._count$1=People.RecentActivity.UI.Core.HtmlHelper.findOrCreateControlById(n,"album-count");this._updateCount$1();t=this._album$1.cover;this._coverLow$1=new People.RecentActivity.UI.Core.ImageControl(People.RecentActivity.UI.Core.HtmlHelper.findElementById(n,"album-cover-low"));this._coverLow$1.isBackground=true;this._coverLow$1.isDelayed=true;this._coverLow$1.isOneByOneError=true;this._coverHigh$1=new People.RecentActivity.UI.Core.ImageControl(People.RecentActivity.UI.Core.HtmlHelper.findElementById(n,"album-cover-high"));this._coverHigh$1.isBackground=true;this._coverHigh$1.isDelayed=true;this._coverHigh$1.isOneByOneError=true;t!=null?(this._coverLow$1.source=t.thumbnailSource,this._coverHigh$1.source=t.source):(this._coverLow$1.source="about:blank",this._coverHigh$1.source="about:blank");this.labelledBy=this._name$1.id;People.RecentActivity.UI.Core.Control.prototype.onRendered.call(this);People.RecentActivity.Core.EtwHelper.writeFeedObjectEvent(People.RecentActivity.Core.EtwEventName.uiRenderPhotoAlbumStop,this._album$1.objectInfo)};People.RecentActivity.UI.Photos.PhotoAlbumControl.prototype._updateCount$1=function(){var n=this._album$1.photos.totalCount;this._count$1.label=People.RecentActivity.UI.Core.LocalizationHelper.getCountString(null,"/strings/ra-label-photoAlbumCountOne","/strings/ra-label-photoAlbumCountMany",n);this._count$1.text=n.toString()};People.RecentActivity.UI.Photos.PhotoAlbumControl.prototype._onPhotosPropertyChanged$1=function(n){switch(n.propertyName){case"Count":case"TotalCount":this._updateCount$1()}};People.RecentActivity.UI.Photos.PhotoAlbumControl.prototype._onAlbumPropertyChanged$1=function(n){switch(n.propertyName){case"Cover":var t=this._album$1.cover;t!=null?(this._coverLow$1.source=t.thumbnailSource,this._coverHigh$1.source=t.source):(this._coverLow$1.source="about:blank",this._coverHigh$1.source="about:blank");break;case"Name":this._name$1.text=this._album$1.name}};People.RecentActivity.UI.Photos.PhotoAlbumsLayout=function(n,t){this._lastResult$1=new People.RecentActivity.Core.ResultInfo(People.RecentActivity.Core.ResultCode.success);People.RecentActivity.UI.Core.Control.call(this,t);this._albumControls$1={};this._identity$1=n;this._itemInvokedHandler$1=this._onItemInvoked$1.bind(this);this._loadingStateChangedHandler$1=this._onLoadingStateChanged$1.bind(this)};Jx.inherit(People.RecentActivity.UI.Photos.PhotoAlbumsLayout,People.RecentActivity.UI.Core.Control);People.RecentActivity.UI.Photos.PhotoAlbumsLayout._hydrationVersion$1=3;People.RecentActivity.UI.Photos.PhotoAlbumsLayout.prototype._identity$1=null;People.RecentActivity.UI.Photos.PhotoAlbumsLayout.prototype._albumControls$1=null;People.RecentActivity.UI.Photos.PhotoAlbumsLayout.prototype._albums$1=null;People.RecentActivity.UI.Photos.PhotoAlbumsLayout.prototype._hydrationData$1=null;People.RecentActivity.UI.Photos.PhotoAlbumsLayout.prototype._network$1=null;People.RecentActivity.UI.Photos.PhotoAlbumsLayout.prototype._initialized$1=false;People.RecentActivity.UI.Photos.PhotoAlbumsLayout.prototype._refreshing$1=false;People.RecentActivity.UI.Photos.PhotoAlbumsLayout.prototype._refresh$1=null;People.RecentActivity.UI.Photos.PhotoAlbumsLayout.prototype._contentGrid$1=null;People.RecentActivity.UI.Photos.PhotoAlbumsLayout.prototype._contentGridList$1=null;People.RecentActivity.UI.Photos.PhotoAlbumsLayout.prototype._dataSource$1=null;People.RecentActivity.UI.Photos.PhotoAlbumsLayout.prototype._contentPsa$1=null;People.RecentActivity.UI.Photos.PhotoAlbumsLayout.prototype._contentErrors$1=null;People.RecentActivity.UI.Photos.PhotoAlbumsLayout.prototype._psa$1=null;People.RecentActivity.UI.Photos.PhotoAlbumsLayout.prototype._errors$1=null;People.RecentActivity.UI.Photos.PhotoAlbumsLayout.prototype._itemInvokedHandler$1=null;People.RecentActivity.UI.Photos.PhotoAlbumsLayout.prototype._loadingStateChangedHandler$1=null;People.RecentActivity.UI.Photos.PhotoAlbumsLayout.prototype.initialize=function(n){if(!this._initialized$1){this._initialized$1=true;this._hydrationData$1=n;this._network$1=this._identity$1.networks.aggregatedNetwork;this._network$1==null&&(this._network$1=this._identity$1.networks.item(0));this._albums$1=this._network$1.albums;var t=this._identity$1.capabilities;t.addListener("propertychanged",this._onCapabilitiesPropertyChanged$1,this);t.canShowPhotos&&this._initializeInternal$1();People.RecentActivity.Core.BiciHelper.setCurrentPageName(People.RecentActivity.Core.BiciPageNames.photosTab);People.RecentActivity.Core.BiciHelper.createPageViewDatapoint(this._network$1.id)}};People.RecentActivity.UI.Photos.PhotoAlbumsLayout.prototype.getState=function(){return this._contentGridList$1!=null?People.RecentActivity.UI.Photos.create_photoAlbumsLayoutHydrationData(3,this._contentGridList$1.indexOfFirstVisible,this._contentGridList$1.currentItem):null};People.RecentActivity.UI.Photos.PhotoAlbumsLayout.prototype.refresh=function(){this._onRefreshClicked$1(null)};People.RecentActivity.UI.Photos.PhotoAlbumsLayout.prototype.onDisposed=function(){var n,t;if(this._network$1=null,this._lastResult$1=null,People.RecentActivity.UI.Core.KeyboardRefresher.removeControl(this),this._albumControls$1!=null){for(n in this._albumControls$1)t={key:n,value:this._albumControls$1[n]},t.value.dispose();People.Social.clearKeys(this._albumControls$1);this._albumControls$1=null}this._albums$1!=null&&(this._albums$1.removeListenerSafe("collectionchanged",this._onCollectionChanged$1,this),this._albums$1.removeListenerSafe("initializecompleted",this._onInitializeCompleted$1,this),this._albums$1.removeListenerSafe("refreshcompleted",this._onRefreshCompleted$1,this),this._albums$1=null);this._identity$1!=null&&(this._identity$1.capabilities.removeListenerSafe("propertychanged",this._onCapabilitiesPropertyChanged$1,this),this._identity$1=null);this._refresh$1=null;this._contentGrid$1!=null&&(this._contentGrid$1.dispose(),this._contentGrid$1=null);this._contentErrors$1!=null&&(this._contentErrors$1.dispose(),this._contentErrors$1=null);this._errors$1!=null&&(this._errors$1.dispose(),this._errors$1=null);this._contentPsa$1!=null&&(this._contentPsa$1.dispose(),this._contentPsa$1=null);this._psa$1!=null&&(this._psa$1.dispose(),this._psa$1=null);this._layoutChangedHandler&&(this._layout.removeLayoutChangedEventListener(this._updateLayout,this),this._layoutChangedHandler=null);this._contentGridList$1!=null&&(this._contentGridList$1.element!=null&&(this._contentGridList$1.removeEventListener("iteminvoked",this._itemInvokedHandler$1,false),this._contentGridList$1.removeEventListener("loadingstatechanged",this._loadingStateChangedHandler$1,false)),this._itemInvokedHandler$1=null,this._loadingStateChangedHandler$1=null,this._contentGridList$1=null,this._dataSource$1=null)};People.RecentActivity.UI.Photos.PhotoAlbumsLayout.prototype.onRendered=function(){var n=People.RecentActivity.UI.Core.HtmlHelper.createElement(People.RecentActivity.UI.Core.Html.photoAlbumLayout),t;this.element.appendChild(n);this._errors$1=new People.RecentActivity.UI.Core.ErrorMessageControl(this._identity$1,People.RecentActivity.UI.Core.ErrorMessageContext.photos,People.RecentActivity.UI.Core.ErrorMessageOperation.read);this._errors$1.render();this._contentErrors$1=People.RecentActivity.UI.Core.HtmlHelper.findOrCreateControlById(n,"layout-errors");this._contentErrors$1.isVisible=false;this._contentErrors$1.appendControl(this._errors$1);this._psa$1=new People.RecentActivity.UI.Core.PsaUpsellControl;this._psa$1.render();this._contentPsa$1=People.RecentActivity.UI.Core.HtmlHelper.findOrCreateControlById(n,"layout-psa");this._contentPsa$1.appendControl(this._psa$1);this._renderListView$1();this._refresh$1=new People.Command("ra-refresh-photos","/strings/raRefresh","/strings/raRefreshTooltip","",true,false,null,this._onRefreshClicked$1.bind(this));t=Jx.root.getCommandBar();t.addCommand(this._refresh$1);t.refresh();this._setContentVisibility$1();this._renderInternal$1();People.RecentActivity.UI.Core.KeyboardRefresher.addControl(this)};People.RecentActivity.UI.Photos.PhotoAlbumsLayout.prototype._updateLayout=function(){var n=this._element.querySelector(".ra-photoLayoutGrid").winControl;n.layout=this._layout.getLayoutState()===People.Layout.layoutState.snapped?new WinJS.UI.ListLayout:new WinJS.UI.GridLayout};People.RecentActivity.UI.Photos.PhotoAlbumsLayout.prototype._renderListView$1=function(){var n=this._layout=Jx.root.getLayout();this._layoutChangedHandler=this._updateLayout;n.addLayoutChangedEventListener(this._updateLayout,this);this._dataSource$1=new WinJS.Binding.List;this._contentGrid$1=People.RecentActivity.UI.Core.HtmlHelper.findOrCreateControlById(this.element,"layout-content");this._contentGrid$1.isVisible=false;this._contentGridList$1=new WinJS.UI.ListView(this._contentGrid$1.element);this._contentGridList$1.addEventListener("iteminvoked",this._itemInvokedHandler$1,false);this._contentGridList$1.itemDataSource=this._dataSource$1.dataSource;this._contentGridList$1.itemTemplate=this._onRenderingItem$1.bind(this);this._contentGridList$1.layout=n.getLayoutState()===People.Layout.layoutState.snapped?new WinJS.UI.ListLayout:new WinJS.UI.GridLayout;this._contentGridList$1.loadingBehavior="randomaccess";this._contentGridList$1.selectionMode="none";this._albums$1.count>0&&this._addAlbums$1(this._albums$1.toArray(),0)};People.RecentActivity.UI.Photos.PhotoAlbumsLayout.prototype._renderInternal$1=function(){if(this.isRendered&&this._albums$1.initialized){if(this._setContentVisibility$1(),this._setRefreshButtonVisibility$1(),this._addAlbums$1(this._albums$1.toArray(),0),this._hydrationData$1!=null&&this._hydrationData$1.v===3)try{this._contentGridList$1.indexOfFirstVisible=this._hydrationData$1.i;this._contentGridList$1.currentItem=this._hydrationData$1.ci}catch(n){Jx.log.write(3,"Failed to set state on grid: "+n.toString())}this._hydrationData$1=null}};People.RecentActivity.UI.Photos.PhotoAlbumsLayout.prototype._initializeInternal$1=function(){this._albums$1.initialized?this._hydrationData$1==null&&this._onRefreshClicked$1(null):(People.RecentActivity.UI.Core.GlobalProgressControl.add(this),this._albums$1.addListener("initializecompleted",this._onInitializeCompleted$1,this),People.RecentActivity.Core.EtwHelper.writeFeedEvent(this._hydrationData$1!=null?People.RecentActivity.Core.EtwEventName.uiGetCachedPhotoAlbumsStart:People.RecentActivity.Core.EtwEventName.uiGetPhotoAlbumsStart,this._network$1.id,this._identity$1.id),this._hydrationData$1!=null?this._albums$1.initializeFromHydration():this._albums$1.initialize())};People.RecentActivity.UI.Photos.PhotoAlbumsLayout.prototype._addAlbums$1=function(n,t){var r,i,u;for(this._setContentVisibility$1(),this._contentGridList$1.addEventListener("loadingstatechanged",this._loadingStateChangedHandler$1,false),r=this._contentGridList$1.itemDataSource,r.beginEdits(),i=0;i<n.length;i++)u=n[i],this._addAlbum$1(u,t++);r.endEdits()};People.RecentActivity.UI.Photos.PhotoAlbumsLayout.prototype._addAlbum$1=function(n,t){this._dataSource$1.indexOf(n)===-1&&this._dataSource$1.splice(t,0,n)};People.RecentActivity.UI.Photos.PhotoAlbumsLayout.prototype._removeAlbums$1=function(n){var i,t,r;for(this._contentGridList$1.addEventListener("loadingstatechanged",this._loadingStateChangedHandler$1,false),i=this._contentGridList$1.itemDataSource,i.beginEdits(),t=0;t<n.length;t++)r=n[t],this._removeAlbum$1(r);i.endEdits()};People.RecentActivity.UI.Photos.PhotoAlbumsLayout.prototype._removeAlbum$1=function(n){var i,t;i=this._dataSource$1.indexOf(n);i!==-1&&(this._dataSource$1.splice(i,1),t=this._getAlbumKey$1(n),Jx.isUndefined(this._albumControls$1[t])||(this._albumControls$1[t].dispose(),delete this._albumControls$1[t]))};People.RecentActivity.UI.Photos.PhotoAlbumsLayout.prototype._getAlbumKey$1=function(n){return n.sourceId+";"+n.id};People.RecentActivity.UI.Photos.PhotoAlbumsLayout.prototype._setContentVisibility$1=function(){if(this.isRendered){this._contentErrors$1.isVisible=false;this._contentGrid$1.isVisible=false;this._contentPsa$1.isVisible=false;var n=this._albums$1.initialized;n&&!this._identity$1.capabilities.canShowPhotos?this._contentPsa$1.isVisible=true:n&&!this._albums$1.count?(this._contentErrors$1.isVisible=true,this._errors$1.location=People.RecentActivity.UI.Core.ErrorMessageLocation.inline,this._lastResult$1.code===People.RecentActivity.Core.ResultCode.success?this._errors$1.showType(People.RecentActivity.UI.Core.ErrorMessageType.empty):this._errors$1.show(this._lastResult$1)):(this._contentGrid$1.isVisible=true,this._errors$1.location=People.RecentActivity.UI.Core.ErrorMessageLocation.messageBar,this._errors$1.show(this._lastResult$1))}};People.RecentActivity.UI.Photos.PhotoAlbumsLayout.prototype._setRefreshButtonVisibility$1=function(){if(this.isRendered){var n=Jx.root.getCommandBar();this._albums$1.initialized&&this._identity$1.capabilities.canShowPhotos?n.showCommand(this._refresh$1.commandId):n.hideCommand(this._refresh$1.commandId)}};People.RecentActivity.UI.Photos.PhotoAlbumsLayout.prototype._onLoadingStateChanged$1=function(n){var t,i;t=n.detail;this._contentGridList$1.loadingState==="complete"&&(t!=null&&t.scrolling||this._dataSource$1.length>0&&(i=this._getAlbumKey$1(this._dataSource$1.getAt(0)),Jx.isUndefined(this._albumControls$1[i])||this._albumControls$1[i].setActive()),this._contentGridList$1.removeEventListener("loadingstatechanged",this._loadingStateChangedHandler$1,false))};People.RecentActivity.UI.Photos.PhotoAlbumsLayout.prototype._onItemInvoked$1=function(n){var i=People.RecentActivity.UI.Core.MoCoHelper.getItemFromEvent(this._dataSource$1,n.detail),t=this._getAlbumKey$1(i);Jx.isUndefined(this._albumControls$1[t])||this._albumControls$1[t].invoke()};People.RecentActivity.UI.Photos.PhotoAlbumsLayout.prototype._onRenderingItem$1=function(n){var t=this;return n.then(function(n){var u,i,r;return t.isDisposed?null:(u=t._dataSource$1.getAt(n.index),i=t._getAlbumKey$1(u),Jx.isUndefined(t._albumControls$1[i])||(t._albumControls$1[i].dispose(),t._albumControls$1[i]=null),r=new People.RecentActivity.UI.Photos.PhotoAlbumControl(u),r.render(),t._albumControls$1[i]=r,r.element)})};People.RecentActivity.UI.Photos.PhotoAlbumsLayout.prototype._onRefreshClicked$1=function(){this.isRendered&&this._initialized$1&&!this._refreshing$1&&(People.RecentActivity.UI.Core.GlobalProgressControl.add(this),People.RecentActivity.Core.EtwHelper.writeFeedEvent(People.RecentActivity.Core.EtwEventName.uiRefreshPhotoAlbumsStart,this._network$1.id,this._identity$1.id),this._refreshing$1=true,this._albums$1.addListener("refreshcompleted",this._onRefreshCompleted$1,this),this._albums$1.refresh())};People.RecentActivity.UI.Photos.PhotoAlbumsLayout.prototype._onCollectionChanged$1=function(n){if(this.isRendered)switch(n.action){case People.RecentActivity.NotifyCollectionChangedAction.add:this._addAlbums$1(n.newItems,n.newItemIndex);break;case People.RecentActivity.NotifyCollectionChangedAction.remove:this._removeAlbums$1(n.oldItems)}};People.RecentActivity.UI.Photos.PhotoAlbumsLayout.prototype._onInitializeCompleted$1=function(n){People.RecentActivity.UI.Core.GlobalProgressControl.remove(this);var t=this._hydrationData$1!=null;this._lastResult$1=n.result;this._albums$1.addListener("collectionchanged",this._onCollectionChanged$1,this);this._renderInternal$1();this._setContentVisibility$1();this._setRefreshButtonVisibility$1();People.RecentActivity.Core.EtwHelper.writeFeedEvent(t?People.RecentActivity.Core.EtwEventName.uiGetCachedPhotoAlbumsStart:People.RecentActivity.Core.EtwEventName.uiGetPhotoAlbumsStart,this._network$1.id,this._identity$1.id)};People.RecentActivity.UI.Photos.PhotoAlbumsLayout.prototype._onRefreshCompleted$1=function(){People.RecentActivity.UI.Core.GlobalProgressControl.remove(this);this._albums$1.removeListenerSafe("refreshcompleted",this._onRefreshCompleted$1,this);this._refreshing$1=false;People.RecentActivity.Core.EtwHelper.writeFeedEvent(People.RecentActivity.Core.EtwEventName.uiRefreshPhotoAlbumsStop,this._network$1.id,this._identity$1.id)};People.RecentActivity.UI.Photos.PhotoAlbumsLayout.prototype._onCapabilitiesPropertyChanged$1=function(n){var t=n.sender;n.propertyName==="CanShowPhotos"&&(t.canShowPhotos&&this._initializeInternal$1(),this._setContentVisibility$1(),this._setRefreshButtonVisibility$1())};People.RecentActivity.UI.Photos.create_photoAlbumsLayoutHydrationData=function(n,t,i){var r={};return r.ci=i,r.i=t,r.v=n,r},function(){var n=3,i=3,t=20,r=-20;People.RecentActivity.UI.Photos.PhotoAlbumsPanel=function(n,t){People.RecentActivity.Imports.Panel.call(this,null,"ra-photosPanelOuter panelView-snapActivePanel",People.PanelView.PanelPosition.photosPanel);this._lastResult$1=new People.RecentActivity.Core.ResultInfo(People.RecentActivity.Core.ResultCode.success);this._albumHeight$1=-1;this._albumWidth$1=-1;this._controls$1={};this._hydrationData$1=t;this._identity$1=n;this._itemInvokedHandler$1=this._onItemInvoked$1.bind(this)};Jx.inherit(People.RecentActivity.UI.Photos.PhotoAlbumsPanel,People.RecentActivity.Imports.Panel);People.RecentActivity.UI.Photos.PhotoAlbumsPanel.prototype._identity$1=null;People.RecentActivity.UI.Photos.PhotoAlbumsPanel.prototype._element$1=null;People.RecentActivity.UI.Photos.PhotoAlbumsPanel.prototype._title$1=null;People.RecentActivity.UI.Photos.PhotoAlbumsPanel.prototype._titleName$1=null;People.RecentActivity.UI.Photos.PhotoAlbumsPanel.prototype._titleMore$1=null;People.RecentActivity.UI.Photos.PhotoAlbumsPanel.prototype._content$1=null;People.RecentActivity.UI.Photos.PhotoAlbumsPanel.prototype._contentViewport$1=null;People.RecentActivity.UI.Photos.PhotoAlbumsPanel.prototype._contentErrors$1=null;People.RecentActivity.UI.Photos.PhotoAlbumsPanel.prototype._errors$1=null;People.RecentActivity.UI.Photos.PhotoAlbumsPanel.prototype._isDisposed$1=false;People.RecentActivity.UI.Photos.PhotoAlbumsPanel.prototype._isReady$1=false;People.RecentActivity.UI.Photos.PhotoAlbumsPanel.prototype._isInitialized$1=false;People.RecentActivity.UI.Photos.PhotoAlbumsPanel.prototype._collection$1=null;People.RecentActivity.UI.Photos.PhotoAlbumsPanel.prototype._grid$1=null;People.RecentActivity.UI.Photos.PhotoAlbumsPanel.prototype._gridDataSource$1=null;People.RecentActivity.UI.Photos.PhotoAlbumsPanel.prototype._maximumCount$1=0;People.RecentActivity.UI.Photos.PhotoAlbumsPanel.prototype._controls$1=null;People.RecentActivity.UI.Photos.PhotoAlbumsPanel.prototype._hydrationData$1=null;People.RecentActivity.UI.Photos.PhotoAlbumsPanel.prototype._itemInvokedHandler$1=null;People.RecentActivity.UI.Photos.PhotoAlbumsPanel.prototype._isCollectionChangeAttached=false;People.RecentActivity.UI.Photos.PhotoAlbumsPanel.prototype.activateUI=function(t){var u,r,i;People.RecentActivity.UI.Core.SnapManager.addControl(this);People.RecentActivity.UI.Core.EventManager.events.addListener("windowresized",this._onWindowResized$1,this);this._element$1=t;this._title$1=People.RecentActivity.UI.Core.HtmlHelper.findOrCreateControlById(t,"panel-title");this._title$1.attach("keypress",this._onTitleKeyPress$1.bind(this));this._title$1.attach("click",this._onTitleClicked$1.bind(this));this._titleName$1=People.RecentActivity.UI.Core.HtmlHelper.findOrCreateControlById(this._element$1,"panel-title-name");this._titleName$1.id=this._titleName$1.uniqueId;this._titleName$1.text=Jx.res.getString("/strings/raPhotosPanelTitle");this._titleMore$1=People.RecentActivity.UI.Core.HtmlHelper.findOrCreateControlById(this._element$1,"panel-title-more");this._titleMore$1.id=this._titleMore$1.uniqueId;this._titleMore$1.text=People.RecentActivity.UI.Core.HtmlHelper.isRightToLeft?"":"";People.Animation.addPressStyling(this._title$1.element);this._content$1=People.RecentActivity.UI.Core.HtmlHelper.findOrCreateControlById(this._element$1,"panel-content");this._content$1.labelledBy=this._titleName$1.id+" "+this._titleMore$1.id;this._measureAlbumSize$1();People.RecentActivity.UI.Core.SnapManager.currentLayout==="snapped"?(this._content$1.element.style.height="",this._content$1.element.style.width=""):(this._content$1.element.style.height=0,this._content$1.element.style.width=this._albumWidth$1*n+"px");this._contentViewport$1=People.RecentActivity.UI.Core.HtmlHelper.findOrCreateControlById(this._element$1,"panel-viewport");this._contentViewport$1.render();this._errors$1=new People.RecentActivity.UI.Core.ErrorMessageControl(this._identity$1,People.RecentActivity.UI.Core.ErrorMessageContext.photos,People.RecentActivity.UI.Core.ErrorMessageOperation.read);this._errors$1.render();this._contentErrors$1=People.RecentActivity.UI.Core.HtmlHelper.findOrCreateControlById(this._element$1,"panel-errors");this._contentErrors$1.render();this._contentErrors$1.appendControl(this._errors$1);this._contentErrors$1.isVisible=false;u=this._identity$1.networks;r=u.aggregatedNetwork;r==null&&(r=u.item(0));this._collection$1=r.albums;i=this;window.msSetImmediate(function(){i._isDisposed$1||(i._collection$1.initialized?i._hydrationData$1==null?(i._collection$1.addListener("refreshcompleted",i._onRefreshCompleted$1,i),i._collection$1.refresh()):(i._lastResult$1=new People.RecentActivity.Core.ResultInfo(People.RecentActivity.Core.ResultCode.success),i._isInitialized$1=true,i._onReady$1()):(i._collection$1.addListener("initializecompleted",i._onInitializeCompleted$1,i),i._hydrationData$1!=null?i._collection$1.initializeFromHydration():i._collection$1.initialize()))})};People.RecentActivity.UI.Photos.PhotoAlbumsPanel.prototype.getUI=function(){return People.RecentActivity.UI.Core.Html.photoAlbumPanel};People.RecentActivity.UI.Photos.PhotoAlbumsPanel.prototype.deactivateUI=function(){if(this._isDisposed$1=true,this._identity$1=null,this._element$1=null,this._lastResult$1=null,People.RecentActivity.UI.Core.SnapManager.removeControl(this),People.RecentActivity.UI.Core.EventManager.events.removeListenerSafe("windowresized",this._onWindowResized$1,this),this._collection$1!=null&&(this._collection$1.removeListenerSafe("collectionchanged",this._onCollectionChanged$1,this),this._collection$1.removeListenerSafe("initializecompleted",this._onInitializeCompleted$1,this),this._collection$1.removeListenerSafe("refreshcompleted",this._onRefreshCompleted$1,this),this._collection$1=null),this._controls$1!=null){for(var n in this._controls$1)this._controls$1[n].dispose();People.Social.clearKeys(this._controls$1);this._controls$1=null}this._title$1!=null&&(this._title$1.dispose(),this._title$1=null);this._titleName$1!=null&&(this._titleName$1.dispose(),this._titleName$1=null);this._titleMore$1!=null&&(this._titleMore$1.dispose(),this._titleMore$1=null);this._content$1!=null&&(this._content$1.dispose(),this._content$1=null);this._contentViewport$1!=null&&(this._contentViewport$1.dispose(),this._contentViewport$1=null);this._contentErrors$1!=null&&(this._contentErrors$1.dispose(),this._contentErrors$1=null);this._errors$1!=null&&(this._errors$1.dispose(),this._errors$1=null);this._grid$1!=null&&(this._grid$1.element!=null&&this._grid$1.removeEventListener("iteminvoked",this._itemInvokedHandler$1,false),this._itemInvokedHandler$1=null,this._grid$1=null,this._gridDataSource$1=null)};People.RecentActivity.UI.Photos.PhotoAlbumsPanel.prototype.ready=function(){this._isReady$1=true;this._onReady$1()};People.RecentActivity.UI.Photos.PhotoAlbumsPanel.prototype.suspend=function(){return{}};People.RecentActivity.UI.Photos.PhotoAlbumsPanel.prototype.onLayoutChanged=function(n){Jx.log.write(4,"PhotoAlbumsPanel.OnLayoutchanged: "+n);this._albumHeight$1=-1;this._albumWidth$1=-1;this._onReady$1();var t=this._element$1.querySelector(".ra-photoLayoutGrid").winControl;t&&(t.layout=n===People.Layout.layoutState.snapped?new WinJS.UI.ListLayout:new WinJS.UI.GridLayout)};People.RecentActivity.UI.Photos.PhotoAlbumsPanel.prototype._measureAlbumSize$1=function(){if(this._albumWidth$1===-1||this._albumHeight$1===-1){var n=People.RecentActivity.UI.Core.HtmlHelper.createElement(People.RecentActivity.UI.Core.Html.photoAlbumItem);this._content$1.appendChild(n);this._content$1.element.style.display="block";this._albumHeight$1=WinJS.Utilities.getTotalHeight(n)+t;this._albumWidth$1=WinJS.Utilities.getTotalWidth(n)+t;this._content$1.element.style.display="";this._content$1.removeChild(n);this._updateMaxAlbumCount$1()}};People.RecentActivity.UI.Photos.PhotoAlbumsPanel.prototype._getAlbumKey$1=function(n){return n.sourceId+";"+n.albumId};People.RecentActivity.UI.Photos.PhotoAlbumsPanel.prototype._addAlbums$1=function(n,t){if(this._updateErrorState$1(),this._updateSize$1(),!(t>this._maximumCount$1)&&n.length){this._hideProgress$1();var i=this._grid$1.itemDataSource;i.beginEdits();this._addAlbumsToList$1(n,t);i.endEdits()}};People.RecentActivity.UI.Photos.PhotoAlbumsPanel.prototype._addAlbumsToList$1=function(n,t){var i,u,r;if(!(this._gridDataSource$1.length>=this._maximumCount$1))for(i=0;i<n.length;i++){if(u=n[i],r=this._gridDataSource$1.indexOf(u),r!==t&&(r!==-1&&this._gridDataSource$1.splice(r,1),this._gridDataSource$1.splice(t,0,u),this._gridDataSource$1.length>=this._maximumCount$1))break;t++}};People.RecentActivity.UI.Photos.PhotoAlbumsPanel.prototype._addMoreAlbumsToList$1=function(){for(var t=this._gridDataSource$1.length,n=t;n<this._maximumCount$1&&n<this._collection$1.count;n++)this._gridDataSource$1.splice(n,0,this._collection$1.item(n))};People.RecentActivity.UI.Photos.PhotoAlbumsPanel.prototype._removeExtraAlbumsFromList$1=function(){for(var t=this._gridDataSource$1.length,n=this._maximumCount$1;n<t;n++)this._gridDataSource$1.splice(this._maximumCount$1,1)};People.RecentActivity.UI.Photos.PhotoAlbumsPanel.prototype._removeAlbums$1=function(n,t){var r,u,i,f,e,o;if(!(t>this._maximumCount$1)&&n.length){for(r=this._grid$1.itemDataSource,r.beginEdits(),u=0,i=0;i<n.length;i++)f=n[i],e=this._gridDataSource$1.indexOf(f),this._gridDataSource$1.splice(e,1),u++;o=this._gridDataSource$1.length;o<this._maximumCount$1&&this._addAlbumsToList$1(this._collection$1.toArray(),t+u);r.endEdits();this._updateErrorState$1();this._updateSize$1()}};People.RecentActivity.UI.Photos.PhotoAlbumsPanel.prototype._updateErrorState$1=function(){this._contentErrors$1.isVisible=false;this._collection$1.count>0?(this._errors$1.location=People.RecentActivity.UI.Core.ErrorMessageLocation.messageBar,this._errors$1.show(this._lastResult$1)):this._isInitialized$1&&(this._contentErrors$1.isVisible=true,this._errors$1.location=People.RecentActivity.UI.Core.ErrorMessageLocation.inline,this._lastResult$1.code===People.RecentActivity.Core.ResultCode.success?this._errors$1.showType(People.RecentActivity.UI.Core.ErrorMessageType.empty):this._errors$1.show(this._lastResult$1),this._content$1.element.style.height="",this._updateWidth$1(2))};People.RecentActivity.UI.Photos.PhotoAlbumsPanel.prototype._updateHeight$1=function(){this._measureAlbumSize$1();var n=Math.min(this._maximumCount$1,this._collection$1.count);this._content$1.element.style.height=this._albumHeight$1*n+"px"};People.RecentActivity.UI.Photos.PhotoAlbumsPanel.prototype._updateWidth$1=function(n){Jx.isUndefined(n)&&(n=1);this._measureAlbumSize$1();var i=this._content$1.element,t=Math.floor(i.clientHeight/this._albumHeight$1),u=Math.min(this._maximumCount$1,Math.max(n*t,this._collection$1.count)),f=Math.ceil(u/t);this._content$1.element.style.width=this._albumWidth$1*f+r+"px"};People.RecentActivity.UI.Photos.PhotoAlbumsPanel.prototype._updateSize$1=function(){People.RecentActivity.UI.Core.SnapManager.currentLayout==="snapped"?(this._content$1.element.style.width="",this._updateHeight$1()):(this._content$1.element.style.height="",this._updateWidth$1())};People.RecentActivity.UI.Photos.PhotoAlbumsPanel.prototype._onReady$1=function(){if(this._isReady$1){this._isInitialized$1&&this._hideProgress$1();(this._grid$1==null||this._gridDataSource$1==null)&&(this._contentViewport$1.attach("keyboardnavigating",this._onKeyboardNavigating$1.bind(this)),this._gridDataSource$1=new WinJS.Binding.List,this._grid$1=new WinJS.UI.ListView(this._contentViewport$1.element),this._grid$1.addEventListener("iteminvoked",this._itemInvokedHandler$1,false),this._grid$1.itemDataSource=this._gridDataSource$1.dataSource,this._grid$1.itemTemplate=this._onRenderingItem$1.bind(this),this._grid$1.layout=Jx.root.getLayout().getLayoutState()===People.Layout.layoutState.snapped?new WinJS.UI.ListLayout:new WinJS.UI.GridLayout,this._grid$1.loadingBehavior="randomaccess",this._grid$1.selectionMode="none",this._grid$1.swipeBehavior=" none");this._isCollectionChangeAttached||(this._collection$1.addListener("collectionchanged",this._onCollectionChanged$1,this),this._isCollectionChangeAttached=true);var n=this;window.msSetImmediate(function(){n._isDisposed$1||(n._collection$1.count>0?n._addAlbums$1(n._collection$1.toArray(),0):n._updateErrorState$1())})}};People.RecentActivity.UI.Photos.PhotoAlbumsPanel.prototype._hideProgress$1=function(){var n=People.RecentActivity.UI.Core.HtmlHelper.findElementById(this._element$1,"panel-progress");n!=null&&n.parentNode.removeChild(n)};People.RecentActivity.UI.Photos.PhotoAlbumsPanel.prototype._navigateToFull$1=function(){var n=this._identity$1.getDataContext(),t=n.objectType,i=n.objectId;switch(t){case"literal":People.Nav.navigate(People.Nav.getViewPhotoUri(null,n));break;default:People.Nav.navigate(People.Nav.getViewPhotoUri(i,null))}};People.RecentActivity.UI.Photos.PhotoAlbumsPanel.prototype._updateMaxAlbumCount$1=function(){if(People.RecentActivity.UI.Core.SnapManager.currentLayout==="snapped")this._maximumCount$1=i;else{var t=Math.floor(this._content$1.element.clientHeight/this._albumHeight$1),r=t<=n?n:n-1;this._maximumCount$1=r*t}};People.RecentActivity.UI.Photos.PhotoAlbumsPanel.prototype._onItemInvoked$1=function(n){var i=People.RecentActivity.UI.Core.MoCoHelper.getItemFromEvent(this._gridDataSource$1,n.detail),t=this._getAlbumKey$1(i);Jx.isUndefined(this._controls$1[t])||this._controls$1[t].invoke()};People.RecentActivity.UI.Photos.PhotoAlbumsPanel.prototype._onRenderingItem$1=function(n){var t=this;return n.then(function(n){var u,i,r;return t._isDisposed$1?null:(u=t._gridDataSource$1.getAt(n.index),i=t._getAlbumKey$1(u),Jx.isUndefined(t._controls$1[i])||(t._controls$1[i].dispose(),t._controls$1[i]=null),r=new People.RecentActivity.UI.Photos.PhotoAlbumControl(u),r.render(),t._controls$1[i]=r,r.element)})};People.RecentActivity.UI.Photos.PhotoAlbumsPanel.prototype._onCollectionChanged$1=function(n){switch(n.action){case People.RecentActivity.NotifyCollectionChangedAction.add:this._addAlbums$1(n.newItems,n.newItemIndex);break;case People.RecentActivity.NotifyCollectionChangedAction.remove:this._removeAlbums$1(n.oldItems,n.oldItemIndex)}};People.RecentActivity.UI.Photos.PhotoAlbumsPanel.prototype._onInitializeCompleted$1=function(n){this._lastResult$1=n.result;this._isInitialized$1=true;this._onReady$1()};People.RecentActivity.UI.Photos.PhotoAlbumsPanel.prototype._onRefreshCompleted$1=function(n){this._isInitialized$1=true;this._lastResult$1=n.result;this._onReady$1()};People.RecentActivity.UI.Photos.PhotoAlbumsPanel.prototype._onTitleKeyPress$1=function(n){(n.keyCode===WinJS.Utilities.Key.enter||n.keyCode===WinJS.Utilities.Key.space)&&this._navigateToFull$1()};People.RecentActivity.UI.Photos.PhotoAlbumsPanel.prototype._onTitleClicked$1=function(){this._navigateToFull$1()};People.RecentActivity.UI.Photos.PhotoAlbumsPanel.prototype._onKeyboardNavigating$1=function(n){var i=n.detail,t=this._getAlbumKey$1(this._gridDataSource$1.getAt(i.newFocus));Jx.isUndefined(this._controls$1[t])||People.RecentActivity.UI.Core.ScrollHelper.scrollIntoView(this._controls$1[t].element)};People.RecentActivity.UI.Photos.PhotoAlbumsPanel.prototype._onWindowResized$1=function(){var t,n;(this._updateMaxAlbumCount$1(),this._updateSize$1(),this._gridDataSource$1!=null)&&(t=this._gridDataSource$1.length,t!==this._maximumCount$1)&&(n=this._grid$1.itemDataSource,n.beginEdits(),this._gridDataSource$1.length<this._maximumCount$1?this._addMoreAlbumsToList$1():this._removeExtraAlbumsFromList$1(),n.endEdits())}}()})