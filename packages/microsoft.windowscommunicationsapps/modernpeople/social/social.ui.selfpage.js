//! Copyright (c) Microsoft Corporation. All rights reserved.
Jx.delayDefine(People.RecentActivity.UI.SelfPage,"SelfPage",function(){People.loadSocialModel();People.loadSocialUICore();People.RecentActivity.UI.Host.LandingPagePanelProvider;$include("$(cssResources)/Social.css");People.RecentActivity.UI.SelfPage.create_selfPageSidebarHydrationData=function(n,t,i,r,u,f){var e={};return e.ci=u,e.id=f,e.ire=t,e.ise=i,e.ssp=r,e.v=n,e};People.RecentActivity.UI.SelfPage.create_selfPageHydrationData=function(n,t,i,r){var u={};return u.cd=t,u.sd=i,u.sv=r,u.v=n,u};People.RecentActivity.UI.SelfPage.create_selfPagePhotoAlbumItemHydrationData=function(n,t,i){var r={};return r.v=n,r.c=t,r.s=i,r};People.RecentActivity.UI.SelfPage.create_selfPagePhotoAlbumPhoto=function(n){var t={};return t.photo=n,t};People.RecentActivity.UI.SelfPage.create_selfPagePhotoAlbumLayoutRecord=function(n,t){var i={};return i.element=t,i.itemIndex=n,i};People.RecentActivity.UI.SelfPage.create_selfPageVideoItemHydrationData=function(n,t,i){var r={};return r.p=n,r.s=t,r.o=i,r};People.RecentActivity.UI.SelfPage.CommentControl=function(n){People.RecentActivity.UI.Core.Control.call(this,People.RecentActivity.UI.Core.HtmlHelper.createElement(People.RecentActivity.UI.Core.Html.selfPageComments));this._obj$1=n;this._comments$1=this._obj$1.comments;this._comments$1.addListener("propertychanged",this._onCommentCollectionPropertyChanged$1,this)};Jx.inherit(People.RecentActivity.UI.SelfPage.CommentControl,People.RecentActivity.UI.Core.Control);People.RecentActivity.UI.SelfPage.CommentControl.prototype._obj$1=null;People.RecentActivity.UI.SelfPage.CommentControl.prototype._comments$1=null;People.RecentActivity.UI.SelfPage.CommentControl.prototype._list$1=null;People.RecentActivity.UI.SelfPage.CommentControl.prototype._title$1=null;People.RecentActivity.UI.SelfPage.CommentControl.prototype.onRendered=function(){var n=this.element,t=Jx.res;this._title$1=People.RecentActivity.UI.Core.HtmlHelper.findOrCreateControlById(n,"item-comment-title");this._title$1.id=this._title$1.uniqueId;this._title$1.text=t.getString("/strings/selfPage-commentTitle-"+this._obj$1.sourceId);this._title$1.isVisible=this._comments$1.count>0;this._title$1.isHiddenFromScreenReader=true;this._list$1=new People.RecentActivity.UI.SelfPage.CommentListControl(People.RecentActivity.UI.Core.HtmlHelper.findElementById(n,"item-comment-list"),this._obj$1);this._list$1.labelledBy=this._title$1.id;this._list$1.render()};People.RecentActivity.UI.SelfPage.CommentControl.prototype.onDisposed=function(){this._title$1!=null&&(this._title$1.dispose(),this._title$1=null);this._list$1!=null&&(this._list$1.dispose(),this._list$1=null);this._comments$1.removeListenerSafe("propertychanged",this._onCommentCollectionPropertyChanged$1,this);People.RecentActivity.UI.Core.Control.prototype.onDisposed.call(this)};People.RecentActivity.UI.SelfPage.CommentControl.prototype._onCommentCollectionPropertyChanged$1=function(n){n.propertyName==="Count"&&(this._title$1.isVisible=this._comments$1.count>0,this._title$1.isHiddenFromScreenReader=true)};People.RecentActivity.UI.SelfPage.CommentInputControl=function(n){People.RecentActivity.UI.Core.Control.call(this,People.RecentActivity.UI.Core.HtmlHelper.createElement(People.RecentActivity.UI.Core.Html.selfPageCommentInput));this._obj$1=n;this._sourceId$1=n.sourceId;this._comments$1=this._obj$1.comments;this._maxLength$1=this._comments$1.maximumLength;this._prefix$1=this._comments$1.prefix;this.render()};Jx.inherit(People.RecentActivity.UI.SelfPage.CommentInputControl,People.RecentActivity.UI.Core.Control);People.RecentActivity.UI.SelfPage.CommentInputControl._urlMatcher$1=new RegExp("https?://[^\\s]+","i");People.RecentActivity.UI.SelfPage.CommentInputControl.prototype._obj$1=null;People.RecentActivity.UI.SelfPage.CommentInputControl.prototype._sourceId$1=null;People.RecentActivity.UI.SelfPage.CommentInputControl.prototype._comments$1=null;People.RecentActivity.UI.SelfPage.CommentInputControl.prototype._input$1=null;People.RecentActivity.UI.SelfPage.CommentInputControl.prototype._button$1=null;People.RecentActivity.UI.SelfPage.CommentInputControl.prototype._watermark$1=true;People.RecentActivity.UI.SelfPage.CommentInputControl.prototype._details$1=null;People.RecentActivity.UI.SelfPage.CommentInputControl.prototype._count$1=null;People.RecentActivity.UI.SelfPage.CommentInputControl.prototype._errors$1=null;People.RecentActivity.UI.SelfPage.CommentInputControl.prototype._maxLength$1=0;People.RecentActivity.UI.SelfPage.CommentInputControl.prototype._prefix$1=null;Object.defineProperty(People.RecentActivity.UI.SelfPage.CommentInputControl.prototype,"input",{get:function(){return this._watermark$1?"":this._input$1.text},set:function(n){Jx.isNonEmptyString(n)?(this._hideWatermark$1(),this._input$1.text=n,this._updateCount$1(),this._updateSize$1()):this._showWatermark$1()}});People.RecentActivity.UI.SelfPage.CommentInputControl.prototype.focus=function(){this._input$1.element.focus()};People.RecentActivity.UI.SelfPage.CommentInputControl.prototype.onRendered=function(){var t=Jx.res,n=this.element;this._details$1=People.RecentActivity.UI.Core.HtmlHelper.findOrCreateControlById(n,"item-comment-details");this._details$1.isVisible=false;this._input$1=People.RecentActivity.UI.Core.HtmlHelper.findOrCreateControlById(n,"item-comment-input");this._input$1.attach("input",this._onInputChanged$1.bind(this));this._input$1.attach("focus",this._onInputFocus$1.bind(this));this._input$1.attach("blur",this._onInputBlur$1.bind(this));this._input$1.addClass("watermark");this._input$1.label=t.getString("/strings/selfPage-commentInputLabel-"+this._sourceId$1);this._updateWatermark$1();this._button$1=People.RecentActivity.UI.Core.HtmlHelper.findOrCreateControlById(n,"item-comment-submit");this._button$1.attach("click",this._onButtonClicked$1.bind(this));this._button$1.isDisabled=true;this._button$1.isVisible=false;this._button$1.label=t.getString("/strings/selfPage-commentAddButtonLabel-"+this._sourceId$1);this._button$1.text=t.getString("/strings/selfPage-commentAddButton-"+this._sourceId$1);this._count$1=People.RecentActivity.UI.Core.HtmlHelper.findOrCreateControlById(n,"item-comment-count");this._count$1.label=t.getString("/strings/selfPage-commentCountLabel");this._errors$1=new People.RecentActivity.UI.Core.ErrorMessageControl(this._comments$1.network.identity,People.RecentActivity.UI.Core.ErrorMessageContext.none,People.RecentActivity.UI.Core.ErrorMessageOperation.write,People.RecentActivity.UI.Core.HtmlHelper.findElementById(n,"item-comment-errors"));this._errors$1.location=People.RecentActivity.UI.Core.ErrorMessageLocation.inline;this._errors$1.render();this._errors$1.isVisible=false};People.RecentActivity.UI.SelfPage.CommentInputControl.prototype.onDisposed=function(){this._comments$1.removeListenerSafe("addcommentcompleted",this._onAddCommentCompleted$1,this);this._input$1!=null&&(this._input$1.dispose(),this._input$1=null);this._errors$1!=null&&(this._errors$1.dispose(),this._errors$1=null);this._button$1!=null&&(this._button$1.dispose(),this._button$1=null);this._count$1!=null&&(this._count$1.dispose(),this._count$1=null);this._details$1!=null&&(this._details$1.dispose(),this._details$1=null);People.RecentActivity.UI.Core.Control.prototype.onDisposed.call(this)};People.RecentActivity.UI.SelfPage.CommentInputControl.prototype._hideWatermark$1=function(){if(this._watermark$1){var n=People.Animation.createExpandAnimation(this._details$1.element,this._input$1.element);this._watermark$1=false;this._input$1.removeClass("watermark");Jx.isNonEmptyString(this._prefix$1)||(this._input$1.text="");this._button$1.isHiddenFromScreenReader=true;this._button$1.isDisabled=true;this._button$1.isVisible=true;this._details$1.isVisible=true;this._updateCount$1();n.execute().done()}};People.RecentActivity.UI.SelfPage.CommentInputControl.prototype._showWatermark$1=function(){var t=this.element.offsetHeight,i=People.Animation.createCollapseAnimation(this._details$1.element,this._input$1.element),n;this._watermark$1=true;this._input$1.addClass("watermark");this._input$1.isDisabled=false;this._updateWatermark$1();this._updateSize$1();this._button$1.isDisabled=true;this._button$1.isVisible=false;this._details$1.isVisible=false;this.element.style.marginTop=t-this.element.offsetHeight+"px";n=this;i.execute().done(function(){return n.isDisposed||(n.element.style.marginTop=null),null})};People.RecentActivity.UI.SelfPage.CommentInputControl.prototype._updateWatermark$1=function(){this._input$1.text=Jx.isNonEmptyString(this._prefix$1)?this._prefix$1:Jx.res.getString("/strings/selfPage-commentInputWatermark")};People.RecentActivity.UI.SelfPage.CommentInputControl.prototype._updateCount$1=function(n){this._maxLength$1===-1?this._count$1.isVisible=false:(Jx.isUndefined(n)&&(n=this._getTextLength$1()),this._count$1.isVisible=true,this._count$1.text=Jx.res.loadCompoundString("/strings/selfPage-commentCount",n,this._maxLength$1))};People.RecentActivity.UI.SelfPage.CommentInputControl.prototype._updateSize$1=function(){var n=this._input$1.element,i=n.style,t=n.scrollHeight-People.RecentActivity.UI.Core.HtmlHelper.getVerticalPadding(n);t=People.RecentActivity.UI.Core.HtmlHelper.snapToLineHeight(n,t);i.height=t+"px"};People.RecentActivity.UI.SelfPage.CommentInputControl.prototype._getTextLength$1=function(){var n=this._input$1.element;return People.RecentActivity.UI.Core.LinkHelper.calculateContentLength(n.value,this._obj$1.sourceId)};People.RecentActivity.UI.SelfPage.CommentInputControl.prototype._onAddCommentCompleted$1=function(n){n.userState===this&&(this._comments$1.removeListenerSafe("addcommentcompleted",this._onAddCommentCompleted$1,this),n.result.code===People.RecentActivity.Core.ResultCode.success?(People.RecentActivity.Core.BiciHelper.createReactionUpdateDatapoint(this._comments$1.network.id,People.RecentActivity.Core.BiciReactionUpdate.add,People.RecentActivity.Core.BiciReactionTypes.comment),this._showWatermark$1()):(this._errors$1.isVisible=true,this._errors$1.show(n.result),this._input$1.isDisabled=false,this._button$1.isDisabled=false))};People.RecentActivity.UI.SelfPage.CommentInputControl.prototype._onButtonClicked$1=function(){this._errors$1.isVisible=false;this._input$1.isDisabled=true;this._button$1.isDisabled=true;var n=this._input$1.text;n=n.trim();this._comments$1.addListener("addcommentcompleted",this._onAddCommentCompleted$1,this);this._comments$1.add(n,this)};People.RecentActivity.UI.SelfPage.CommentInputControl.prototype._onInputChanged$1=function(){if(!this._watermark$1){var n=this._getTextLength$1();!n||this._maxLength$1!==-1&&n>this._maxLength$1?(this._button$1.isDisabled=true,this._button$1.isHiddenFromScreenReader=true):(this._button$1.isDisabled=false,this._button$1.isHiddenFromScreenReader=false);this._updateCount$1(n);this._updateSize$1()}};People.RecentActivity.UI.SelfPage.CommentInputControl.prototype._onInputFocus$1=function(){var i=this._watermark$1,n,t;this._hideWatermark$1();i&&Jx.isNonEmptyString(this._prefix$1)&&(n=this._prefix$1.length,t=this._input$1.element,t.setSelectionRange(n,n))};People.RecentActivity.UI.SelfPage.CommentInputControl.prototype._onInputBlur$1=function(){var n=this._input$1.text;n.trim().length&&n!==this._prefix$1||this._showWatermark$1()};People.RecentActivity.UI.SelfPage.CommentListControl=function(n,t){People.RecentActivity.UI.Core.NavigatableControl.call(this,n,WinJS.Utilities.Key.downArrow,WinJS.Utilities.Key.upArrow);this._obj$2=t;this._comments$2=this._obj$2.comments;this._comments$2.addListener("collectionchanged",this._onCollectionChanged$2,this);this._items$2=[];this._map$2={}};Jx.inherit(People.RecentActivity.UI.SelfPage.CommentListControl,People.RecentActivity.UI.Core.NavigatableControl);People.RecentActivity.UI.SelfPage.CommentListControl.prototype._obj$2=null;People.RecentActivity.UI.SelfPage.CommentListControl.prototype._comments$2=null;People.RecentActivity.UI.SelfPage.CommentListControl.prototype._map$2=null;People.RecentActivity.UI.SelfPage.CommentListControl.prototype._items$2=null;People.RecentActivity.UI.SelfPage.CommentListControl.prototype.onRendered=function(){for(var n=this._comments$2.count-1;n>=0;n--)this._addComment$2(this._comments$2.item(n),0);this._items$2.length>0&&(this.activeItem=this._items$2[0]);People.RecentActivity.UI.Core.NavigatableControl.prototype.onRendered.call(this)};People.RecentActivity.UI.SelfPage.CommentListControl.prototype.onDisposed=function(){for(var n=0;n<this._items$2.length;n++)this._items$2[n].dispose(),this._items$2[n]=null;this._items$2.length=0;People.Social.clearKeys(this._map$2);this._comments$2.removeListenerSafe("collectionchanged",this._onCollectionChanged$2,this);People.RecentActivity.UI.Core.NavigatableControl.prototype.onDisposed.call(this)};People.RecentActivity.UI.SelfPage.CommentListControl.prototype._addComments$2=function(n,t){for(var r,i=0;i<n.length;i++)r=n[i],this._addComment$2(r,t++)};People.RecentActivity.UI.SelfPage.CommentListControl.prototype._addComment$2=function(n,t){var i,r,u;!Jx.isUndefined(this._map$2[n.id])||(i=new People.RecentActivity.UI.SelfPage.CommentListItemControl(this._obj$2,n),this._items$2.splice(t,0,i),this._map$2[n.id]=i,r=this.element,t>=this._items$2.length-1?r.appendChild(i.element):(u=this._items$2[t+1],r.insertBefore(i.element,u.element)),n.isPublishedInApp&&People.Animation.fadeIn(i.element).done(),this.insertTabControl(i,t))};People.RecentActivity.UI.SelfPage.CommentListControl.prototype._removeComments$2=function(n){for(var i,t=0;t<n.length;t++)i=n[t],this._removeComment$2(i)};People.RecentActivity.UI.SelfPage.CommentListControl.prototype._removeComment$2=function(n){var t,i;Jx.isUndefined(this._map$2[n.id])||(t=this._map$2[n.id],t.removeFromParent(),i=this._items$2.indexOf(t),i!==-1&&this._items$2.splice(i,1),delete this._map$2[n.id],this.removeTabControl(t),t.dispose())};People.RecentActivity.UI.SelfPage.CommentListControl.prototype._onCollectionChanged$2=function(n){if(this.isRendered)switch(n.action){case People.RecentActivity.NotifyCollectionChangedAction.add:this._addComments$2(n.newItems,n.newItemIndex);break;case People.RecentActivity.NotifyCollectionChangedAction.remove:this._removeComments$2(n.oldItems)}};People.RecentActivity.UI.SelfPage.CommentListItemControl=function(n,t){People.RecentActivity.UI.Core.Control.call(this,People.RecentActivity.UI.Core.HtmlHelper.createElement(People.RecentActivity.UI.Core.Html.selfPageComment));this._comment$1=t;this._obj$1=n;this.render()};Jx.inherit(People.RecentActivity.UI.SelfPage.CommentListItemControl,People.RecentActivity.UI.Core.Control);People.RecentActivity.UI.SelfPage.CommentListItemControl.prototype._obj$1=null;People.RecentActivity.UI.SelfPage.CommentListItemControl.prototype._comment$1=null;People.RecentActivity.UI.SelfPage.CommentListItemControl.prototype._publisher$1=null;People.RecentActivity.UI.SelfPage.CommentListItemControl.prototype._text$1=null;People.RecentActivity.UI.SelfPage.CommentListItemControl.prototype._time$1=null;People.RecentActivity.UI.SelfPage.CommentListItemControl.prototype.onRendered=function(){var t=this.element,n;this._publisher$1=new People.RecentActivity.UI.Core.ContactControl(this._comment$1.publisher.getDataContext());n=People.RecentActivity.UI.Core.HtmlHelper.findElementById(t,"item-comment-name");n.id=n.uniqueID;n.appendChild(this._publisher$1.getElement(People.RecentActivity.UI.Core.ContactControlType.name,People.RecentActivity.Imports.create_identityElementContextOptions(this._obj$1.sourceId),-1));this._publisher$1.activate(n,false);this._text$1=new People.RecentActivity.UI.Core.FormattedTextControl(People.RecentActivity.UI.Core.HtmlHelper.findElementById(t,"item-comment-text"),this._obj$1.sourceId,false);this._text$1.id=this._text$1.uniqueId;this._text$1.update(this._comment$1.text,this._comment$1.entities);this._time$1=People.RecentActivity.UI.Core.HtmlHelper.findOrCreateControlById(t,"item-comment-time");this._time$1.id=this._time$1.uniqueId;this._updateTime$1();this.labelledBy=n.id+" "+this._text$1.id+" "+this._time$1.id;People.RecentActivity.UI.Core.TimestampUpdateTimer.subscribe(this._onTimerElapsed$1,this)};People.RecentActivity.UI.SelfPage.CommentListItemControl.prototype.onDisposed=function(){this._publisher$1.dispose();this._publisher$1=null;this._text$1.dispose();this._text$1=null;this._time$1.dispose();this._time$1=null;People.RecentActivity.UI.Core.TimestampUpdateTimer.unsubscribe(this._onTimerElapsed$1,this);People.RecentActivity.UI.Core.Control.prototype.onDisposed.call(this)};People.RecentActivity.UI.SelfPage.CommentListItemControl.prototype._updateTime$1=function(){this._time$1.text=People.RecentActivity.UI.Core.LocalizationHelper.getTimeString(this._comment$1.timestamp)};People.RecentActivity.UI.SelfPage.CommentListItemControl.prototype._onTimerElapsed$1=function(){this._updateTime$1()};People.RecentActivity.UI.SelfPage.ReactionControl=function(n,t){People.RecentActivity.UI.Core.NavigatableControl.call(this,People.RecentActivity.UI.Core.HtmlHelper.createElement(People.RecentActivity.UI.Core.Html.selfPageReactions),WinJS.Utilities.Key.rightArrow,WinJS.Utilities.Key.leftArrow);this._tileContactControls={};this._tileControls={};this._obj$2=n;this._reactions$2=t;this._reactions$2.addListener("collectionchanged",this._onCollectionChanged$2,this);this._reactions$2.addListener("propertychanged",this._onCollectionPropertyChanged$2,this);this._reactions$2.addListener("removereactioncompleted",this._onReactionOperationCompleted$2,this);this._reactions$2.addListener("addreactioncompleted",this._onReactionOperationCompleted$2,this);this._removedReactions$2=[]};Jx.inherit(People.RecentActivity.UI.SelfPage.ReactionControl,People.RecentActivity.UI.Core.NavigatableControl);People.RecentActivity.UI.SelfPage.ReactionControl._tileSize$2=60;People.RecentActivity.UI.SelfPage.ReactionControl._tileCount$2=0;People.RecentActivity.UI.SelfPage.ReactionControl.prototype._obj$2=null;People.RecentActivity.UI.SelfPage.ReactionControl.prototype._reactions$2=null;People.RecentActivity.UI.SelfPage.ReactionControl.prototype._buttonReact$2=null;People.RecentActivity.UI.SelfPage.ReactionControl.prototype._buttonMore$2=null;People.RecentActivity.UI.SelfPage.ReactionControl.prototype._buttonMoreLabel$2=null;People.RecentActivity.UI.SelfPage.ReactionControl.prototype._title$2=null;People.RecentActivity.UI.SelfPage.ReactionControl.prototype._content$2=null;People.RecentActivity.UI.SelfPage.ReactionControl.prototype._list$2=null;People.RecentActivity.UI.SelfPage.ReactionControl.prototype._tileContactControls=null;People.RecentActivity.UI.SelfPage.ReactionControl.prototype._tileControls=null;People.RecentActivity.UI.SelfPage.ReactionControl.prototype._expanded$2=false;People.RecentActivity.UI.SelfPage.ReactionControl.prototype._errors$2=null;People.RecentActivity.UI.SelfPage.ReactionControl.prototype._reacting$2=false;People.RecentActivity.UI.SelfPage.ReactionControl.prototype._userReaction$2=null;People.RecentActivity.UI.SelfPage.ReactionControl.prototype._removedReactions$2=null;People.RecentActivity.UI.SelfPage.ReactionControl.prototype._moreButtonAnimating$2=false;Object.defineProperty(People.RecentActivity.UI.SelfPage.ReactionControl.prototype,"isExpanded",{get:function(){return this._expanded$2}});Object.defineProperty(People.RecentActivity.UI.SelfPage.ReactionControl.prototype,"reactions",{get:function(){return this._reactions$2}});People.RecentActivity.UI.SelfPage.ReactionControl.prototype.expand=function(n){if(this._expanded$2)People.RecentActivity.Core.BiciHelper.createClickThroughDatapoint(this._obj$2.sourceId,People.RecentActivity.Core.BiciClickthroughAction.selfPageReactionCount),People.RecentActivity.UI.Core.UriHelper.launchUri(this._obj$2.url);else{if(this._expanded$2=true,this.addClass("expanded"),this._updateList$2(true),this._updateMoreButton$2(false),n){var t=People.RecentActivity.UI.SelfPage.ReactionControl._tileCount$2;this._canReact$2()&&t--;this._focusOnTile(t-1)}this.onPropertyChanged("IsExpanded")}};People.RecentActivity.UI.SelfPage.ReactionControl.prototype.onDisposed=function(){var n,t;if(this._reactions$2.removeListenerSafe("collectionchanged",this._onCollectionChanged$2,this),this._reactions$2.removeListenerSafe("propertychanged",this._onCollectionPropertyChanged$2,this),this._reactions$2.removeListenerSafe("removereactioncompleted",this._onReactionOperationCompleted$2,this),this._reactions$2.removeListenerSafe("addreactioncompleted",this._onReactionOperationCompleted$2,this),Jx.root.getLayout().removeOrientationChangedEventListener(this._onOrientationChanged,this),this._removedReactions$2.length>0&&(this._disposeControls$2(this._removedReactions$2),this._removedReactions$2.length=0,this._removedReactions$2=null),this._disposeControls$2(this._reactions$2.toArray()),this._buttonReact$2!=null&&(this._buttonReact$2.dispose(),this._buttonReact$2=null),this._buttonMoreLabel$2!=null&&(this._buttonMoreLabel$2.dispose(),this._buttonMoreLabel$2=null),this._buttonMore$2!=null&&(this._buttonMore$2.dispose(),this._buttonMore$2=null),this._list$2!=null&&(this._list$2.dispose(),this._list$2=null),this._content$2!=null&&(this._content$2.dispose(),this._content$2=null),this._title$2!=null&&(this._title$2.dispose(),this._title$2=null),this._errors$2!=null&&(this._errors$2.dispose(),this._errors$2=null),this._tileContactControls!=null){for(n in this._tileContactControls)t={key:n,value:this._tileContactControls[n]},t.value.dispose();People.Social.clearKeys(this._tileContactControls);this._tileContactControls=null}if(this._tileControls!=null){for(n in this._tileControls)t={key:n,value:this._tileControls[n]},t.value.dispose();People.Social.clearKeys(this._tileControls);this._tileControls=null}People.RecentActivity.UI.Core.NavigatableControl.prototype.onDisposed.call(this)};People.RecentActivity.UI.SelfPage.ReactionControl.prototype.onRendered=function(){var t=this.element.children,n;this._title$2=People.RecentActivity.UI.Core.Control.fromElement(t[0]);this._title$2.id=this._title$2.uniqueId;this._title$2.text=Jx.res.getString(this._reactions$2.type.stringId+"title");this.labelledBy=this._title$2.id;this._errors$2=new People.RecentActivity.UI.Core.ErrorMessageControl(this._reactions$2.network.identity,People.RecentActivity.UI.Core.ErrorMessageContext.none,People.RecentActivity.UI.Core.ErrorMessageOperation.write,t[1]);this._errors$2.location=People.RecentActivity.UI.Core.ErrorMessageLocation.inline;this._errors$2.render();this._errors$2.isVisible=false;this._content$2=People.RecentActivity.UI.Core.Control.fromElement(t[2]);n=t[2].children;this._buttonReact$2=People.RecentActivity.UI.Core.Control.fromElement(n[0]);this._buttonReact$2.attach("click",this._onReactButtonClicked$2.bind(this));this._buttonReact$2.attach("keydown",this._onReactButtonKeyDown.bind(this));this._list$2=People.RecentActivity.UI.Core.Control.fromElement(n[1]);this._buttonMore$2=People.RecentActivity.UI.Core.Control.fromElement(n[2]);this._buttonMore$2.attach("click",this._onMoreButtonClicked$2.bind(this));this._buttonMore$2.attach("keydown",this._onMoreButtonKeyDown.bind(this));this._buttonMore$2.isVisible=false;this._buttonMoreLabel$2=People.RecentActivity.UI.Core.Control.fromElement(n[2].children[0]);this._buttonMoreLabel$2.isVisible=false;People.Animation.addTapAnimation(this._buttonMore$2.element);People.Animation.addTapAnimation(this._buttonReact$2.element);this._updateTileCount$2();this._updateList$2(true);this._updateMoreButton$2(false);this._updateReactButton$2();this._updateTitle$2();this._canReact$2()&&(this.activeItem=this._buttonReact$2);Jx.root.getLayout().addOrientationChangedEventListener(this._onOrientationChanged,this);People.RecentActivity.UI.Core.NavigatableControl.prototype.onRendered.call(this)};People.RecentActivity.UI.SelfPage.ReactionControl.prototype._canAddReaction$2=function(){return(this._reactions$2.permissions&People.RecentActivity.Core.Permissions.add)===People.RecentActivity.Core.Permissions.add};People.RecentActivity.UI.SelfPage.ReactionControl.prototype._canRemoveReaction$2=function(){return(this._reactions$2.permissions&People.RecentActivity.Core.Permissions.remove)===People.RecentActivity.Core.Permissions.remove};People.RecentActivity.UI.SelfPage.ReactionControl.prototype._canReact$2=function(){return this._reactions$2.containsUser()?this._canRemoveReaction$2():this._canAddReaction$2()};People.RecentActivity.UI.SelfPage.ReactionControl.prototype._react=function(){this._reacting$2||(this._errors$2.isVisible=false,this._reacting$2=true,this._reactions$2.containsUser()?(this._reactions$2.remove(),People.RecentActivity.Core.BiciHelper.createReactionUpdateDatapoint(this._reactions$2.network.id,People.RecentActivity.Core.BiciReactionUpdate.remove,this._getBiciReactionType$2())):(this._reactions$2.add(),People.RecentActivity.Core.BiciHelper.createReactionUpdateDatapoint(this._reactions$2.network.id,People.RecentActivity.Core.BiciReactionUpdate.add,this._getBiciReactionType$2())))};People.RecentActivity.UI.SelfPage.ReactionControl.prototype._disposeControls$2=function(n){for(var t=0;t<n.length;t++){var f=n[t],i=this._getKey$2(f),u=this._tileContactControls[i],r=this._tileControls[i];Jx.isUndefined(u)||(u.dispose(),delete this._tileContactControls[i]);Jx.isUndefined(r)||(this.removeTabControl(r),r.dispose(),delete this._tileControls[i])}};People.RecentActivity.UI.SelfPage.ReactionControl.prototype._getCapacity$2=function(){if(this._expanded$2)return this._reactions$2.count;var n=People.RecentActivity.UI.SelfPage.ReactionControl._tileCount$2;return this._canReact$2()&&n--,n};People.RecentActivity.UI.SelfPage.ReactionControl.prototype._getKey$2=function(n){var t=n.publisher;return t.sourceId+";"+t.id};People.RecentActivity.UI.SelfPage.ReactionControl.prototype._renderTile$2=function(n,t){var i,r,u,f;i=null;r=this._getKey$2(n);Jx.isUndefined(this._tileControls[r])?(u=new People.RecentActivity.UI.Core.ContactControl(n.publisher.getDataContext(),true,this._reactions$2.type.stringId+"contact-reacted"),f=u.getElement(People.RecentActivity.UI.Core.ContactControlType.tile,People.RecentActivity.Imports.create_identityElementTileOptions(60,null),-1),u.activate(f,false),i=People.RecentActivity.UI.Core.Control.fromElement(f),i.role="option",i.addClass("ra-fauxButton"),this._tileContactControls[r]=u,this._tileControls[r]=i):i=this._tileControls[r];this._list$2.insertControl(i,t-1);this.insertTabControl(i,t)};People.RecentActivity.UI.SelfPage.ReactionControl.prototype._updateList$2=function(n){var t,o,i,f,r,u,e;if(!this._reactions$2.type.isToggle&&(n&&this._removedReactions$2.length>0&&(this._disposeControls$2(this._removedReactions$2),this._removedReactions$2.length=0),t=this._getCapacity$2(),t>0))for(o=this._list$2.element,o.innerHTML="",i=1,f=this._reactions$2.count,!this._expanded$2&&Math.max(f,this._reactions$2.totalCount)>t&&t--,r=this._reactions$2.findUser(),this._userReaction$2=r,r!=null&&(this._renderTile$2(r,i),i++,t--),u=0;u<f&&t>0;u++)e=this._reactions$2.item(u),e!==r&&(this._renderTile$2(e,i),i++,t--)};People.RecentActivity.UI.SelfPage.ReactionControl.prototype._updateMoreButton$2=function(n){var r,e,t;if(!this._moreButtonAnimating$2){var o=this._buttonMoreLabel$2.text,i=false,f=Math.max(this._reactions$2.count,this._reactions$2.totalCount),u=this._getCapacity$2();!this._expanded$2&&f>u&&u--;r=f-u;r>99?(i=true,this._buttonMore$2.label=Jx.res.loadCompoundString("/strings/raItemReaction-othersMany",Jx.res.getString("/strings/raItemReaction-99plus")),this._buttonMoreLabel$2.addClass("ra-reactionOthersButtonArrow"),this._buttonMoreLabel$2.text="",this.addTabControl(this._buttonMore$2)):r>0?(i=true,e=r===1?"/strings/raItemReaction-othersOne":"/strings/raItemReaction-othersMany",this._buttonMore$2.label=Jx.res.loadCompoundString(e,r),this._buttonMoreLabel$2.removeClass("ra-reactionOthersButtonArrow"),this._buttonMoreLabel$2.text=Jx.res.loadCompoundString("/strings/raItemReaction-others",r),this.addTabControl(this._buttonMore$2)):(this.removeTabControl(this._buttonMore$2),i=false);t=this;n?!i&&this._buttonMore$2.isVisible?(this._moreButtonAnimating$2=true,People.Animation.fadeOut(this._buttonMore$2.element).done(function(){return t.isDisposed||(t._buttonMoreLabel$2.isVisible=false,t._buttonMore$2.isVisible=false,t._moreButtonAnimating$2=false,t._updateMoreButton$2(false)),null})):i&&!this._buttonMore$2.isVisible?(this._buttonMore$2.isVisible=true,this._buttonMoreLabel$2.isVisible=true,this._buttonMoreLabel$2.isHiddenFromScreenReader=true,this._moreButtonAnimating$2=true,People.Animation.fadeIn(this._buttonMore$2.element).done(function(){return t.isDisposed||(t._moreButtonAnimating$2=false,t._updateMoreButton$2(false)),null})):i&&this._buttonMore$2.isVisible&&this._buttonMoreLabel$2.text!==o&&(this._moreButtonAnimating$2=true,People.Animation.updateBadge(this._buttonMoreLabel$2.element).done(function(){return t.isDisposed||(t._moreButtonAnimating$2=false,t._updateMoreButton$2(false)),null})):(this._buttonMore$2.isVisible=i,this._buttonMoreLabel$2.isVisible=i,this._buttonMoreLabel$2.isHiddenFromScreenReader=true)}};People.RecentActivity.UI.SelfPage.ReactionControl.prototype._updateReactButton$2=function(){var n=this._reactions$2.type;this._buttonReact$2.addClass(n.iconClass);this._buttonReact$2.text=n.iconSelfPage;this._reactions$2.containsUser()?(this._buttonReact$2.addClass("ra-reactionButtonActive"),this._buttonReact$2.isVisible=this._canRemoveReaction$2(),this._buttonReact$2.label=Jx.res.getString(n.stringId+"unreact")):(this._buttonReact$2.removeClass("ra-reactionButtonActive"),this._buttonReact$2.isVisible=this._canAddReaction$2(),this._buttonReact$2.label=Jx.res.getString(n.stringId+"react"));this._canReact$2()?this.insertTabControl(this._buttonReact$2,0):this.removeTabControl(this._buttonReact$2)};People.RecentActivity.UI.SelfPage.ReactionControl.prototype._updateTitle$2=function(){this._title$2.isVisible=this._reactions$2.totalCount>0||this._canAddReaction$2();this._title$2.isHiddenFromScreenReader=true};People.RecentActivity.UI.SelfPage.ReactionControl.prototype._focusOnTile=function(n){var t=this._list$2.element.children;t.length>n&&t[n].focus()};People.RecentActivity.UI.SelfPage.ReactionControl.prototype._getBiciReactionType$2=function(){switch(this._reactions$2.type.type){case People.RecentActivity.NetworkReactionType.like:return People.RecentActivity.Core.BiciReactionTypes.like;case People.RecentActivity.NetworkReactionType.favorite:return People.RecentActivity.Core.BiciReactionTypes.favorite;case People.RecentActivity.NetworkReactionType.retweet:return People.RecentActivity.Core.BiciReactionTypes.retweet}return People.RecentActivity.Core.BiciReactionTypes.like};People.RecentActivity.UI.SelfPage.ReactionControl.prototype._updateUserReaction$2=function(){var t=this,u,r,n,f,e,o,s,i;if(this._expanded$2||this._reactions$2.type.isToggle)return this._updateList$2(true),this._userReaction$2!=null&&this._focusOnTile(0),WinJS.Promise.wrap(null);if(u=this._reactions$2.findUser(),u!=null&&this._userReaction$2==null){if(this._renderTile$2(u,1),r=this._list$2.element,n=r.style,n.position="absolute",n.top="0px",n.left="0px",this._canRemoveReaction$2())return f=People.Animation.createRepositionAnimation(r),i=this._content$2.element.style,i.whiteSpace="nowrap",n.position="",n.top="",n.left="",f.execute().then(function(){return t.isDisposed||(i.whiteSpace="",t._updateList$2(true),t._userReaction$2!=null&&t._focusOnTile(0)),null});this._buttonReact$2.isVisible=true;this._buttonReact$2.isHiddenFromScreenReader=true;e=this._list$2.element.children[0];e.style.opacity="0";o=this._buttonReact$2.element;o.style.opacity="1";People.Animation.crossFade(e,o).done(function(){return t.isDisposed||(t._buttonReact$2.isVisible=false,e.style.opacity="",o.style.opacity="",n.position="",n.top="",n.left="",t._updateList$2(true),t._userReaction$2!=null&&t._focusOnTile(0)),null})}else if(u==null&&this._userReaction$2!=null){s=this._userReaction$2;this._updateList$2(false);i=this._content$2.element.style;i.whiteSpace="nowrap";this._renderTile$2(s,1);var r=this._list$2.element,f=People.Animation.createRepositionAnimation(r),n=r.style;return n.position="absolute",n.top="0px",n.left="0px",f.execute().then(function(){return t.isDisposed||(n.position="",n.top="",n.left="",i.whiteSpace="",t._updateList$2(true),t._userReaction$2!=null&&t._focusOnTile(0)),null})}return WinJS.Promise.wrap(null)};People.RecentActivity.UI.SelfPage.ReactionControl.prototype._updateTileCount$2=function(){var n=Jx.root.getLayoutState(),t=n==="portrait"||n==="snapped"?4:5;return People.RecentActivity.UI.SelfPage.ReactionControl._tileCount$2!==t?(People.RecentActivity.UI.SelfPage.ReactionControl._tileCount$2=t,true):false};People.RecentActivity.UI.SelfPage.ReactionControl.prototype._onReactionOperationCompleted$2=function(n){var t,i;t=n.result;t.code!==People.RecentActivity.Core.ResultCode.success?(this._errors$2.isVisible=true,this._errors$2.show(t),this._reacting$2=false):(i=this,this._updateUserReaction$2().done(function(){return i._reacting$2=false,false}))};People.RecentActivity.UI.SelfPage.ReactionControl.prototype._onReactButtonClicked$2=function(){this._react()};People.RecentActivity.UI.SelfPage.ReactionControl.prototype._onReactButtonKeyDown=function(n){switch(n.keyCode){case WinJS.Utilities.Key.enter:case WinJS.Utilities.Key.space:this._react()}};People.RecentActivity.UI.SelfPage.ReactionControl.prototype._onMoreButtonClicked$2=function(){this.expand(true)};People.RecentActivity.UI.SelfPage.ReactionControl.prototype._onMoreButtonKeyDown=function(n){switch(n.keyCode){case WinJS.Utilities.Key.enter:case WinJS.Utilities.Key.space:this.expand(true)}};People.RecentActivity.UI.SelfPage.ReactionControl.prototype._onCollectionChanged$2=function(n){switch(n.action){case People.RecentActivity.NotifyCollectionChangedAction.remove:this._removedReactions$2.push.apply(this._removedReactions$2,n.oldItems)}this._reacting$2||this._updateList$2(true)};People.RecentActivity.UI.SelfPage.ReactionControl.prototype._onCollectionPropertyChanged$2=function(n){switch(n.propertyName){case"Count":case"TotalCount":this._updateTitle$2();this._updateReactButton$2();this._updateMoreButton$2(true);this._reacting$2||this._updateList$2(true)}};People.RecentActivity.UI.SelfPage.ReactionControl.prototype._onOrientationChanged=function(){this._updateTileCount$2()&&(this._updateList$2(true),this._updateMoreButton$2(false))},function(){var n=1;People.RecentActivity.UI.SelfPage.SelfPageSidebarControl=function(n){People.RecentActivity.UI.Core.Control.call(this,People.RecentActivity.UI.Core.HtmlHelper.createElement(People.RecentActivity.UI.Core.Html.selfPageSidebar));this._obj$1=n};Jx.inherit(People.RecentActivity.UI.SelfPage.SelfPageSidebarControl,People.RecentActivity.UI.Core.Control);People.RecentActivity.UI.SelfPage.SelfPageSidebarControl.prototype._obj$1=null;People.RecentActivity.UI.SelfPage.SelfPageSidebarControl.prototype._reactions$1=null;People.RecentActivity.UI.SelfPage.SelfPageSidebarControl.prototype._comments$1=null;People.RecentActivity.UI.SelfPage.SelfPageSidebarControl.prototype._commentInput$1=null;People.RecentActivity.UI.SelfPage.SelfPageSidebarControl.prototype._extra$1=null;People.RecentActivity.UI.SelfPage.SelfPageSidebarControl.prototype._scroll$1=null;People.RecentActivity.UI.SelfPage.SelfPageSidebarControl.prototype._summaryContainer$1=null;People.RecentActivity.UI.SelfPage.SelfPageSidebarControl.prototype._reactionsContainer$1=null;People.RecentActivity.UI.SelfPage.SelfPageSidebarControl.prototype._state$1=null;People.RecentActivity.UI.SelfPage.SelfPageSidebarControl.prototype._isCommentInputFocusRequested$1=false;Object.defineProperty(People.RecentActivity.UI.SelfPage.SelfPageSidebarControl.prototype,"extra",{get:function(){return null},configurable:true});Object.defineProperty(People.RecentActivity.UI.SelfPage.SelfPageSidebarControl.prototype,"object",{get:function(){return this._obj$1}});Object.defineProperty(People.RecentActivity.UI.SelfPage.SelfPageSidebarControl.prototype,"network",{get:function(){return this._obj$1.network}});Object.defineProperty(People.RecentActivity.UI.SelfPage.SelfPageSidebarControl.prototype,"commentInputHeight",{get:function(){var n=0;return this._commentInput$1!=null&&(n=this._commentInput$1.element.clientHeight),n}});People.RecentActivity.UI.SelfPage.SelfPageSidebarControl.prototype.applyState=function(t){t.v===n&&(this._state$1=t,this._applyReactionState$1(),this._applyCommentState$1(),this._applyExtraState$1(),t.ise&&this.summary.expand(),this._applyScrollState$1())};People.RecentActivity.UI.SelfPage.SelfPageSidebarControl.prototype.getState=function(){var f={},i=this._reactions$1,t,e,o,r,u;if(i!=null)for(t=0,e=i.length;t<e;t++)o=i[t].reactions.type.id,f[o]=i[t].isExpanded;return r=false,u=this.summary,u!=null&&(r=u.isExpanded),People.RecentActivity.UI.SelfPage.create_selfPageSidebarHydrationData(n,f,r,this._scroll$1.element.scrollTop,this._commentInput$1!=null?this._commentInput$1.input:null,this.getExtraHydrationState())};People.RecentActivity.UI.SelfPage.SelfPageSidebarControl.prototype.setFocusOnCommentInput=function(){this._commentInput$1!=null?this._commentInput$1.focus():this._isCommentInputFocusRequested$1=true};People.RecentActivity.UI.SelfPage.SelfPageSidebarControl.prototype.onRenderedInDom=function(){var n=this.summary;n!=null&&n.onRenderedInDom()};People.RecentActivity.UI.SelfPage.SelfPageSidebarControl.prototype.onDisposed=function(){if(this._summaryContainer$1=null,this._reactionsContainer$1=null,this._reactions$1!=null){for(var n=0,t=this._reactions$1.length;n<t;n++)this._reactions$1[n].dispose(),this._reactions$1[n]=null;this._reactions$1=null}this._comments$1!=null&&(this._comments$1.dispose(),this._comments$1=null);this._commentInput$1!=null&&(this._commentInput$1.dispose(),this._commentInput$1=null);this._extra$1!=null&&(this._extra$1.dispose(),this._extra$1=null);this._scroll$1!=null&&(this._scroll$1.dispose(),this._scroll$1=null);this._obj$1.comments.removeListenerSafe("addcommentcompleted",this._onAddCommentCompleted$1,this);People.RecentActivity.UI.Core.Control.prototype.onDisposed.call(this)};People.RecentActivity.UI.SelfPage.SelfPageSidebarControl.prototype.onRendered=function(){var n=this;this._scroll$1=People.RecentActivity.UI.Core.HtmlHelper.findOrCreateControlById(this.element,"selfpage-sidebar-scroll");this._summaryContainer$1=People.RecentActivity.UI.Core.HtmlHelper.findElementById(this._scroll$1.element,"selfpage-summary-container");this._reactionsContainer$1=People.RecentActivity.UI.Core.HtmlHelper.findElementById(this._scroll$1.element,"selfpage-reactions-container");this._renderSummary$1();window.msSetImmediate(function(){n.isDisposed||(n._renderExtra$1(),n._renderReactions$1(),n._renderComments$1())});People.RecentActivity.UI.Core.Control.prototype.onRendered.call(this)};People.RecentActivity.UI.SelfPage.SelfPageSidebarControl.prototype.getExtraHydrationState=function(){return null};People.RecentActivity.UI.SelfPage.SelfPageSidebarControl.prototype.applyExtraHydrationState=function(){};People.RecentActivity.UI.SelfPage.SelfPageSidebarControl.prototype._applyReactionState$1=function(){var n,t,i;if(this._state$1!=null&&this._reactions$1!=null)for(n=0,t=this._reactions$1.length;n<t;n++)i=this._reactions$1[n].reactions.type.id,this._state$1.ire[i]&&this._reactions$1[n].expand(false)};People.RecentActivity.UI.SelfPage.SelfPageSidebarControl.prototype._applyCommentState$1=function(){this._state$1!=null&&this._commentInput$1!=null&&Jx.isNonEmptyString(this._state$1.ci)&&(this._commentInput$1.input=this._state$1.ci)};People.RecentActivity.UI.SelfPage.SelfPageSidebarControl.prototype._applyExtraState$1=function(){this._state$1!=null&&this._extra$1!=null&&this._state$1.id!=null&&this.applyExtraHydrationState(this._state$1.id)};People.RecentActivity.UI.SelfPage.SelfPageSidebarControl.prototype._applyScrollState$1=function(){this._state$1==null||this._reactions$1==null||this._obj$1.network.capabilities.commentsEnabled&&this._comments$1==null||(this._scroll$1.element.scrollTop=this._state$1.ssp)};People.RecentActivity.UI.SelfPage.SelfPageSidebarControl.prototype._renderSummary$1=function(){var n=this.summary;n!=null&&(this._summaryContainer$1.appendChild(n.element),n.render())};People.RecentActivity.UI.SelfPage.SelfPageSidebarControl.prototype._renderExtra$1=function(){this._extra$1=this.extra;this._extra$1!=null&&(this._reactionsContainer$1.appendChild(this._extra$1.element),this._extra$1.render(),this._applyExtraState$1(),this._applyScrollState$1())};People.RecentActivity.UI.SelfPage.SelfPageSidebarControl.prototype._renderReactions$1=function(){for(var i=this._obj$1.reactions,r=[],f,n,t=0,u=i.count;t<u;t++)f=i.item(t),n=new People.RecentActivity.UI.SelfPage.ReactionControl(this._obj$1,f),this._reactionsContainer$1.appendChild(n.element),r.push(n),n.render(),People.Animation.fadeIn(n.element);this._reactions$1=r;this._applyReactionState$1();this._applyScrollState$1()};People.RecentActivity.UI.SelfPage.SelfPageSidebarControl.prototype._renderComments$1=function(){if(this._obj$1.network.capabilities.commentsEnabled){this._comments$1=new People.RecentActivity.UI.SelfPage.CommentControl(this._obj$1);this._scroll$1.appendControl(this._comments$1);this._comments$1.render();var n=this._obj$1.comments;(n.permissions&People.RecentActivity.Core.Permissions.add)===People.RecentActivity.Core.Permissions.add&&(n.addListener("addcommentcompleted",this._onAddCommentCompleted$1,this),this._commentInput$1=new People.RecentActivity.UI.SelfPage.CommentInputControl(this._obj$1),this.appendControl(this._commentInput$1),People.Animation.fadeIn(this._commentInput$1.element));this._applyCommentState$1();this._applyScrollState$1();People.Animation.fadeIn(this._comments$1.element);this._isCommentInputFocusRequested$1&&this._commentInput$1!=null&&this._commentInput$1.focus()}};People.RecentActivity.UI.SelfPage.SelfPageSidebarControl.prototype._onAddCommentCompleted$1=function(n){if(n.result.code===People.RecentActivity.Core.ResultCode.success){var t=this._scroll$1.element;t.scrollTop=t.scrollHeight}}}();People.RecentActivity.UI.SelfPage.SelfPageEntrySidebarControl=function(n){People.RecentActivity.UI.SelfPage.SelfPageSidebarControl.call(this,n)};Jx.inherit(People.RecentActivity.UI.SelfPage.SelfPageEntrySidebarControl,People.RecentActivity.UI.SelfPage.SelfPageSidebarControl);People.RecentActivity.UI.SelfPage.SelfPageEntrySidebarControl.prototype._summary$2=null;Object.defineProperty(People.RecentActivity.UI.SelfPage.SelfPageEntrySidebarControl.prototype,"summary",{get:function(){return this._renderSummary$2(),this._summary$2},configurable:true});People.RecentActivity.UI.SelfPage.SelfPageEntrySidebarControl.prototype.onDisposed=function(){this._summary$2!=null&&(this._summary$2.dispose(),this._summary$2=null);People.RecentActivity.UI.SelfPage.SelfPageSidebarControl.prototype.onDisposed.call(this)};People.RecentActivity.UI.SelfPage.SelfPageEntrySidebarControl.prototype._renderSummary$2=function(){if(this._summary$2==null){var n=this.object;this._summary$2=new People.RecentActivity.UI.SelfPage.SelfPageEntrySummaryControl(n)}};People.RecentActivity.UI.SelfPage.SelfPageSummaryControl=function(n){People.RecentActivity.UI.Core.Control.call(this,People.RecentActivity.UI.Core.HtmlHelper.createElement(People.RecentActivity.UI.Core.Html.selfPageSummary));this._obj$1=n};Jx.inherit(People.RecentActivity.UI.SelfPage.SelfPageSummaryControl,People.RecentActivity.UI.Core.Control);People.RecentActivity.UI.SelfPage.SelfPageSummaryControl.prototype._obj$1=null;People.RecentActivity.UI.SelfPage.SelfPageSummaryControl.prototype._identity$1=null;People.RecentActivity.UI.SelfPage.SelfPageSummaryControl.prototype._text$1=null;People.RecentActivity.UI.SelfPage.SelfPageSummaryControl.prototype._timeVia$1=null;People.RecentActivity.UI.SelfPage.SelfPageSummaryControl.prototype._extra$1=null;People.RecentActivity.UI.SelfPage.SelfPageSummaryControl.prototype._annotations$1=null;People.RecentActivity.UI.SelfPage.SelfPageSummaryControl.prototype._seeMore$1=null;People.RecentActivity.UI.SelfPage.SelfPageSummaryControl.prototype._expanded$1=false;Object.defineProperty(People.RecentActivity.UI.SelfPage.SelfPageSummaryControl.prototype,"isExpanded",{get:function(){return this._expanded$1}});Object.defineProperty(People.RecentActivity.UI.SelfPage.SelfPageSummaryControl.prototype,"network",{get:function(){return this._obj$1.network}});Object.defineProperty(People.RecentActivity.UI.SelfPage.SelfPageSummaryControl.prototype,"object",{get:function(){return this._obj$1}});Object.defineProperty(People.RecentActivity.UI.SelfPage.SelfPageSummaryControl.prototype,"extra",{get:function(){return null},configurable:true});Object.defineProperty(People.RecentActivity.UI.SelfPage.SelfPageSummaryControl.prototype,"annotations",{get:function(){return null},configurable:true});People.RecentActivity.UI.SelfPage.SelfPageSummaryControl.prototype.expand=function(){if(!this._expanded$1){this._expanded$1=true;this.addClass("expanded");this.removeClass("collapsed");this._seeMore$1!=null&&(this._seeMore$1.removeFromParent(),this._seeMore$1.dispose(),this._seeMore$1=null);this.onPropertyChanged("IsExpanded")}};People.RecentActivity.UI.SelfPage.SelfPageSummaryControl.prototype.onRenderedInDom=function(){var n,t;if(!this._expanded$1&&(n=this._text$1.element,n.scrollHeight-5>n.clientHeight)){this.addClass("collapsed");this._seeMore$1==null&&(t=People.RecentActivity.UI.Core.HtmlHelper.createElement(People.RecentActivity.UI.Core.Html.selfPageSummarySeeMore),this._seeMore$1=People.RecentActivity.UI.Core.Control.fromElement(t.children[0]),this._seeMore$1.text=Jx.res.getString("/strings/raSeeMore"),this._seeMore$1.attach("click",this._onSeeMoreClicked$1.bind(this)),this._seeMore$1.attach("keydown",this._onSeeMoreKeyDown.bind(this)),this.insertControlAfter(People.RecentActivity.UI.Core.Control.fromElement(t),this._text$1));return}};People.RecentActivity.UI.SelfPage.SelfPageSummaryControl.prototype.onDisposed=function(){this._identity$1!=null&&(this._identity$1.dispose(),this._identity$1=null);this._text$1!=null&&(this._text$1.dispose(),this._text$1=null);this._timeVia$1!=null&&(this._timeVia$1.dispose(),this._timeVia$1=null);this._extra$1!=null&&(this._extra$1.dispose(),this._extra$1=null);this._annotations$1!=null&&(this._annotations$1.dispose(),this._annotations$1=null);this._seeMore$1!=null&&(this._seeMore$1.dispose(),this._seeMore$1=null);People.RecentActivity.UI.Core.TimestampUpdateTimer.unsubscribe(this._onTimerElapsed$1,this);this.network.removeListenerSafe("propertychanged",this._onNetworkPropertyChanged$1,this);this.removeListenerSafe("propertychanged",this._onSelfPropertyChanged$1,this);People.RecentActivity.UI.Core.Control.prototype.onDisposed.call(this)};People.RecentActivity.UI.SelfPage.SelfPageSummaryControl.prototype.onRendered=function(){var n=this.element,r,u,t,i;this._identity$1=new People.RecentActivity.UI.Core.ContactControl(this.publisher.getDataContext());r=People.RecentActivity.UI.Core.HtmlHelper.findElementById(n,"summary-picture");r.appendChild(this._identity$1.getElement(People.RecentActivity.UI.Core.ContactControlType.tile,People.RecentActivity.Imports.create_identityElementTileOptions(80,null),0));u=People.RecentActivity.UI.Core.HtmlHelper.findElementById(n,"summary-name");u.appendChild(this._identity$1.getElement(People.RecentActivity.UI.Core.ContactControlType.name,People.RecentActivity.Imports.create_identityElementContextOptions(this._obj$1.sourceId),-1));this._identity$1.activate(n);this._text$1=new People.RecentActivity.UI.Core.FormattedTextControl(People.RecentActivity.UI.Core.HtmlHelper.findElementById(n,"summary-text"),this._obj$1.sourceId,false);this._text$1.isVisible=Jx.isNonEmptyString(this.summaryText);this._text$1.update(this.summaryText,this.summaryEntities);this._timeVia$1=People.RecentActivity.UI.Core.HtmlHelper.findOrCreateControlById(n,"summary-time-via");t=this.annotations;i=this.extra;i!=null&&(this._extra$1=People.RecentActivity.UI.Core.HtmlHelper.findOrCreateControlById(n,"summary-extra"),this._extra$1.appendControl(i));t!=null&&(this._annotations$1=People.RecentActivity.UI.Core.HtmlHelper.findOrCreateControlById(n,"summary-annotations"),this._annotations$1.appendControl(t));People.RecentActivity.UI.Core.TimestampUpdateTimer.subscribe(this._onTimerElapsed$1,this);this.network.addListener("propertychanged",this._onNetworkPropertyChanged$1,this);this._updateTimeVia$1();this.addListener("propertychanged",this._onSelfPropertyChanged$1,this)};People.RecentActivity.UI.SelfPage.SelfPageSummaryControl.prototype._updateTimeVia$1=function(){var n="",t=this.timestamp,i,r;t==null||!t.getTime()||(n=People.RecentActivity.UI.Core.LocalizationHelper.getTimeString(t));i=n;r=this.network.name;Jx.isNonEmptyString(r)&&(i=Jx.res.loadCompoundString("/strings/raItemVia",n,r));this._timeVia$1.text=i};People.RecentActivity.UI.SelfPage.SelfPageSummaryControl.prototype._onNetworkPropertyChanged$1=function(n){n.propertyName==="Name"&&this._updateTimeVia$1()};People.RecentActivity.UI.SelfPage.SelfPageSummaryControl.prototype._onTimerElapsed$1=function(){this._updateTimeVia$1()};People.RecentActivity.UI.SelfPage.SelfPageSummaryControl.prototype._onSeeMoreClicked$1=function(){this.expand()};People.RecentActivity.UI.SelfPage.SelfPageSummaryControl.prototype._onSeeMoreKeyDown=function(n){switch(n.keyCode){case WinJS.Utilities.Key.enter:case WinJS.Utilities.Key.space:this.expand()}};People.RecentActivity.UI.SelfPage.SelfPageSummaryControl.prototype._onSelfPropertyChanged$1=function(n){n.propertyName==="SummaryText"&&this._text$1.update(this.summaryText,this.summaryEntities)};People.RecentActivity.UI.SelfPage.SelfPageEntrySummaryControl=function(n){People.RecentActivity.UI.SelfPage.SelfPageSummaryControl.call(this,n)};Jx.inherit(People.RecentActivity.UI.SelfPage.SelfPageEntrySummaryControl,People.RecentActivity.UI.SelfPage.SelfPageSummaryControl);People.RecentActivity.UI.SelfPage.SelfPageEntrySummaryControl.prototype._annotations$2=null;Object.defineProperty(People.RecentActivity.UI.SelfPage.SelfPageEntrySummaryControl.prototype,"publisher",{get:function(){return this.object.publisher},configurable:true});Object.defineProperty(People.RecentActivity.UI.SelfPage.SelfPageEntrySummaryControl.prototype,"summaryEntities",{get:function(){return this.object.entities},configurable:true});Object.defineProperty(People.RecentActivity.UI.SelfPage.SelfPageEntrySummaryControl.prototype,"summaryText",{get:function(){var n=this.object;switch(n.entryType){case People.RecentActivity.FeedEntryType.video:return n.data.text;default:return""}},configurable:true});Object.defineProperty(People.RecentActivity.UI.SelfPage.SelfPageEntrySummaryControl.prototype,"timestamp",{get:function(){return this.object.timestamp},configurable:true});Object.defineProperty(People.RecentActivity.UI.SelfPage.SelfPageEntrySummaryControl.prototype,"annotations",{get:function(){return this._renderAnnotations$2(),this._annotations$2},configurable:true});People.RecentActivity.UI.SelfPage.SelfPageEntrySummaryControl.prototype.onDisposed=function(){this._annotations$2!=null&&(this._annotations$2.dispose(),this._annotations$2=null);People.RecentActivity.UI.SelfPage.SelfPageSummaryControl.prototype.onDisposed.call(this)};People.RecentActivity.UI.SelfPage.SelfPageEntrySummaryControl.prototype._renderAnnotations$2=function(){if(this._annotations$2==null){var n=this.object;this._annotations$2=new People.RecentActivity.UI.Core.AnnotationsControl(n,document.createElement("div"),People.RecentActivity.UI.Core.AnnotationsControlPlacement.oneUp);this._annotations$2.render()}};People.RecentActivity.UI.SelfPage.SelfPagePhotoAlbumSidebarControl=function(n){People.RecentActivity.UI.SelfPage.SelfPageSidebarControl.call(this,n)};Jx.inherit(People.RecentActivity.UI.SelfPage.SelfPagePhotoAlbumSidebarControl,People.RecentActivity.UI.SelfPage.SelfPageSidebarControl);People.RecentActivity.UI.SelfPage.SelfPagePhotoAlbumSidebarControl.prototype._summary$2=null;Object.defineProperty(People.RecentActivity.UI.SelfPage.SelfPagePhotoAlbumSidebarControl.prototype,"summary",{get:function(){return this._renderSummary$2(),this._summary$2},configurable:true});People.RecentActivity.UI.SelfPage.SelfPagePhotoAlbumSidebarControl.prototype.onDisposed=function(){this._summary$2!=null&&(this._summary$2.dispose(),this._summary$2=null);People.RecentActivity.UI.SelfPage.SelfPageSidebarControl.prototype.onDisposed.call(this)};People.RecentActivity.UI.SelfPage.SelfPagePhotoAlbumSidebarControl.prototype._renderSummary$2=function(){this._summary$2==null&&(this._summary$2=new People.RecentActivity.UI.SelfPage.SelfPagePhotoAlbumSummaryControl(this.object))};People.RecentActivity.UI.SelfPage.SelfPagePhotoAlbumSummaryControl=function(n){People.RecentActivity.UI.SelfPage.SelfPageSummaryControl.call(this,n);n.addListener("propertychanged",this._onAlbumPropertyChanged$2,this)};Jx.inherit(People.RecentActivity.UI.SelfPage.SelfPagePhotoAlbumSummaryControl,People.RecentActivity.UI.SelfPage.SelfPageSummaryControl);Object.defineProperty(People.RecentActivity.UI.SelfPage.SelfPagePhotoAlbumSummaryControl.prototype,"publisher",{get:function(){return this.object.owner},configurable:true});Object.defineProperty(People.RecentActivity.UI.SelfPage.SelfPagePhotoAlbumSummaryControl.prototype,"summaryEntities",{get:function(){return this.object.entities},configurable:true});Object.defineProperty(People.RecentActivity.UI.SelfPage.SelfPagePhotoAlbumSummaryControl.prototype,"summaryText",{get:function(){return this.object.description},configurable:true});Object.defineProperty(People.RecentActivity.UI.SelfPage.SelfPagePhotoAlbumSummaryControl.prototype,"timestamp",{get:function(){return this.object.timestamp},configurable:true});People.RecentActivity.UI.SelfPage.SelfPagePhotoAlbumSummaryControl.prototype.onDisposed=function(){this.object.removeListenerSafe("propertychanged",this._onAlbumPropertyChanged$2,this);People.RecentActivity.UI.SelfPage.SelfPageSummaryControl.prototype.onDisposed.call(this)};People.RecentActivity.UI.SelfPage.SelfPagePhotoAlbumSummaryControl.prototype._onAlbumPropertyChanged$2=function(n){if(n.propertyName==="Description")this.onPropertyChanged("SummaryText")};People.RecentActivity.UI.SelfPage.SelfPagePhotoSidebarControl=function(n){People.RecentActivity.UI.SelfPage.SelfPageSidebarControl.call(this,n)};Jx.inherit(People.RecentActivity.UI.SelfPage.SelfPagePhotoSidebarControl,People.RecentActivity.UI.SelfPage.SelfPageSidebarControl);People.RecentActivity.UI.SelfPage.SelfPagePhotoSidebarControl.prototype._summary$2=null;People.RecentActivity.UI.SelfPage.SelfPagePhotoSidebarControl.prototype._tags$2=null;Object.defineProperty(People.RecentActivity.UI.SelfPage.SelfPagePhotoSidebarControl.prototype,"summary",{get:function(){return this._renderSummary$2(),this._summary$2},configurable:true});Object.defineProperty(People.RecentActivity.UI.SelfPage.SelfPagePhotoSidebarControl.prototype,"extra",{get:function(){return this._renderTags$2(),this._tags$2},configurable:true});People.RecentActivity.UI.SelfPage.SelfPagePhotoSidebarControl.prototype.onDisposed=function(){this._summary$2!=null&&(this._summary$2.dispose(),this._summary$2=null);this._tags$2!=null&&(this._tags$2.dispose(),this._tags$2=null);People.RecentActivity.UI.SelfPage.SelfPageSidebarControl.prototype.onDisposed.call(this)};People.RecentActivity.UI.SelfPage.SelfPagePhotoSidebarControl.prototype.getExtraHydrationState=function(){return this._tags$2!=null?this._tags$2.isExpanded:null};People.RecentActivity.UI.SelfPage.SelfPagePhotoSidebarControl.prototype.applyExtraHydrationState=function(n){if(this._tags$2!=null){var t=n;t&&this._tags$2.expand(false)}};People.RecentActivity.UI.SelfPage.SelfPagePhotoSidebarControl.prototype._renderSummary$2=function(){this._summary$2==null&&(this._summary$2=new People.RecentActivity.UI.SelfPage.SelfPagePhotoSummaryControl(this.object))};People.RecentActivity.UI.SelfPage.SelfPagePhotoSidebarControl.prototype._renderTags$2=function(){this._tags$2==null&&(this._tags$2=new People.RecentActivity.UI.SelfPage.SelfPagePhotoTagsControl(this.object))};People.RecentActivity.UI.SelfPage.SelfPagePhotoSummaryControl=function(n){People.RecentActivity.UI.SelfPage.SelfPageSummaryControl.call(this,n)};Jx.inherit(People.RecentActivity.UI.SelfPage.SelfPagePhotoSummaryControl,People.RecentActivity.UI.SelfPage.SelfPageSummaryControl);People.RecentActivity.UI.SelfPage.SelfPagePhotoSummaryControl.prototype._extra$2=null;People.RecentActivity.UI.SelfPage.SelfPagePhotoSummaryControl.prototype._buttonAlbum$2=null;Object.defineProperty(People.RecentActivity.UI.SelfPage.SelfPagePhotoSummaryControl.prototype,"publisher",{get:function(){return this.object.owner},configurable:true});Object.defineProperty(People.RecentActivity.UI.SelfPage.SelfPagePhotoSummaryControl.prototype,"summaryEntities",{get:function(){return this.object.entities},configurable:true});Object.defineProperty(People.RecentActivity.UI.SelfPage.SelfPagePhotoSummaryControl.prototype,"summaryText",{get:function(){return this.object.caption},configurable:true});Object.defineProperty(People.RecentActivity.UI.SelfPage.SelfPagePhotoSummaryControl.prototype,"timestamp",{get:function(){return this.object.timestamp},configurable:true});Object.defineProperty(People.RecentActivity.UI.SelfPage.SelfPagePhotoSummaryControl.prototype,"extra",{get:function(){return this._renderExtra$2(),this._extra$2},configurable:true});People.RecentActivity.UI.SelfPage.SelfPagePhotoSummaryControl.prototype.onDisposed=function(){if(this._extra$2!=null){this._disposeExtraContent$2();this._extra$2.dispose();this._extra$2=null;var n=this.object,t=n.album;n.removeListenerSafe("propertychanged",this._onPhotoPropertyChanged$2,this);t.removeListenerSafe("propertychanged",this._onAlbumPropertyChanged$2,this);t.photos.removeListenerSafe("propertychanged",this._onAlbumPropertyChanged$2,this)}People.RecentActivity.UI.SelfPage.SelfPageSummaryControl.prototype.onDisposed.call(this)};People.RecentActivity.UI.SelfPage.SelfPagePhotoSummaryControl.prototype._renderExtra$2=function(){if(this._extra$2==null){var t=this.object,n=t.album;if(n==null)return;this._extra$2=new People.RecentActivity.UI.Core.Control(People.RecentActivity.UI.Core.HtmlHelper.createElement(People.RecentActivity.UI.Core.Html.selfPagePhotoExtra));this._renderExtraContent$2();n.addListener("propertychanged",this._onAlbumPropertyChanged$2,this);n.photos.addListener("propertychanged",this._onAlbumPropertyChanged$2,this);t.addListener("propertychanged",this._onPhotoPropertyChanged$2,this)}};People.RecentActivity.UI.SelfPage.SelfPagePhotoSummaryControl.prototype._renderExtraContent$2=function(){var t,n,i,r;this._disposeExtraContent$2();t=this.object;n=t.album;Jx.isNonEmptyString(n.name)&&(i=People.RecentActivity.UI.Core.HtmlHelper.createElement(People.RecentActivity.UI.Core.Html.selfPagePhotoExtraAlbum),this._buttonAlbum$2=new People.RecentActivity.UI.Core.Control(i),this._buttonAlbum$2.attach("click",this._onAlbumNameClicked$2.bind(this)),this._buttonAlbum$2.attach("keydown",this._onAlbumNameKeyDown.bind(this)),this._buttonAlbum$2.render(),this._buttonAlbum$2.text=n.name,r=[document.createTextNode((t.index+1).toString()),document.createTextNode(n.photos.totalCount.toString()),this._buttonAlbum$2.element],this._extra$2.appendChild(People.RecentActivity.UI.Core.LocalizationHelper.loadCompoundElement("/strings/raPhotoIndex",r)))};People.RecentActivity.UI.SelfPage.SelfPagePhotoSummaryControl.prototype._disposeExtraContent$2=function(){this._buttonAlbum$2!=null&&(this._buttonAlbum$2.dispose(),this._buttonAlbum$2=null);this._extra$2.text=""};People.RecentActivity.UI.SelfPage.SelfPagePhotoSummaryControl.prototype._navigateToAlbum=function(){var t=this.object.album,r=t.network,n=r.identity,i=People.RecentActivity.UI.Core.create_selfPageNavigationData(t.sourceId,t.albumId,t.objectType.toString()),u;n.isTemporary&&(i.temporaryContact=n.getDataContext());i.isWhatsNew=n.isWhatsNew;u=People.RecentActivity.UI.Core.SelfPageNavigationHelper.getNavigateUrl(n.isWhatsNew||n.isTemporary?r.user.personId:n.id,i);People.Nav.navigate(u)};People.RecentActivity.UI.SelfPage.SelfPagePhotoSummaryControl.prototype._onPhotoPropertyChanged$2=function(n){switch(n.propertyName){case"Caption":this.onPropertyChanged("SummaryText");break;case"Index":this._renderExtraContent$2()}};People.RecentActivity.UI.SelfPage.SelfPagePhotoSummaryControl.prototype._onAlbumPropertyChanged$2=function(n){switch(n.propertyName){case"Name":case"TotalCount":this._renderExtraContent$2()}};People.RecentActivity.UI.SelfPage.SelfPagePhotoSummaryControl.prototype._onAlbumNameClicked$2=function(){this._navigateToAlbum()};People.RecentActivity.UI.SelfPage.SelfPagePhotoSummaryControl.prototype._onAlbumNameKeyDown=function(n){switch(n.keyCode){case WinJS.Utilities.Key.enter:case WinJS.Utilities.Key.space:this._navigateToAlbum()}};People.RecentActivity.UI.SelfPage.SelfPagePhotoTagsControl=function(n){People.RecentActivity.UI.Core.NavigatableControl.call(this,People.RecentActivity.UI.Core.HtmlHelper.createElement(People.RecentActivity.UI.Core.Html.selfPagePhotoTags),WinJS.Utilities.Key.rightArrow,WinJS.Utilities.Key.leftArrow);this._controls$2={};this._elements$2={};this._photo$2=n;this._tags$2=this._photo$2.tags;this._tags$2.addListener("collectionchanged",this._onCollectionChanged$2,this);this._tags$2.addListener("propertychanged",this._onCollectionPropertyChanged$2,this)};Jx.inherit(People.RecentActivity.UI.SelfPage.SelfPagePhotoTagsControl,People.RecentActivity.UI.Core.NavigatableControl);People.RecentActivity.UI.SelfPage.SelfPagePhotoTagsControl._tileSize$2=60;People.RecentActivity.UI.SelfPage.SelfPagePhotoTagsControl._tileCount$2=0;People.RecentActivity.UI.SelfPage.SelfPagePhotoTagsControl.prototype._photo$2=null;People.RecentActivity.UI.SelfPage.SelfPagePhotoTagsControl.prototype._tags$2=null;People.RecentActivity.UI.SelfPage.SelfPagePhotoTagsControl.prototype._expanded$2=false;People.RecentActivity.UI.SelfPage.SelfPagePhotoTagsControl.prototype._list$2=null;People.RecentActivity.UI.SelfPage.SelfPagePhotoTagsControl.prototype._buttonMore$2=null;People.RecentActivity.UI.SelfPage.SelfPagePhotoTagsControl.prototype._title$2=null;People.RecentActivity.UI.SelfPage.SelfPagePhotoTagsControl.prototype._controls$2=null;People.RecentActivity.UI.SelfPage.SelfPagePhotoTagsControl.prototype._elements$2=null;Object.defineProperty(People.RecentActivity.UI.SelfPage.SelfPagePhotoTagsControl.prototype,"isExpanded",{get:function(){return this._expanded$2}});People.RecentActivity.UI.SelfPage.SelfPagePhotoTagsControl.prototype.expand=function(){if(this._expanded$2)People.RecentActivity.UI.Core.UriHelper.launchUri(this._photo$2.url);else{if(this._expanded$2=true,this.addClass("expanded"),this._updateList$2(),this._updateMoreButton$2(),focus){var n=People.RecentActivity.UI.SelfPage.SelfPagePhotoTagsControl._tileCount$2;this._focusOnTile(n-1)}this.onPropertyChanged("IsExpanded")}};People.RecentActivity.UI.SelfPage.SelfPagePhotoTagsControl.prototype.onDisposed=function(){var n,t;if(this._tags$2.removeListenerSafe("collectionchanged",this._onCollectionChanged$2,this),this._tags$2.removeListenerSafe("propertychanged",this._onCollectionPropertyChanged$2,this),Jx.root.getLayout().removeOrientationChangedEventListener(this._onOrientationChanged,this),this._list$2!=null&&(this._list$2.dispose(),this._list$2=null),this._buttonMore$2!=null&&(this._buttonMore$2.dispose(),this._buttonMore$2=null),this._title$2!=null&&(this._title$2.dispose(),this._title$2=null),this._controls$2!=null){for(n in this._controls$2)t={key:n,value:this._controls$2[n]},t.value.dispose();People.Social.clearKeys(this._controls$2);this._controls$2=null;People.Social.clearKeys(this._elements$2);this._elements$2=null}People.RecentActivity.UI.Core.NavigatableControl.prototype.onDisposed.call(this)};People.RecentActivity.UI.SelfPage.SelfPagePhotoTagsControl.prototype.onRendered=function(){var n=this.element;this._title$2=People.RecentActivity.UI.Core.HtmlHelper.findOrCreateControlById(n,"photo-tags-title");this._title$2.id=this._title$2.uniqueId;this._title$2.text=Jx.res.getString("/strings/raPhotoTagsTitle");this.labelledBy=this._title$2.id;this._buttonMore$2=People.RecentActivity.UI.Core.HtmlHelper.findOrCreateControlById(n,"photo-tags-others");this._buttonMore$2.attach("click",this._onMoreButtonClicked$2.bind(this));this._buttonMore$2.attach("keydown",this._onMoreButtonKeyDown.bind(this));this._buttonMore$2.isVisible=false;this._list$2=People.RecentActivity.UI.Core.HtmlHelper.findOrCreateControlById(n,"photo-tags-list");this._updateTileCount$2();this._updateList$2();this._updateMoreButton$2();this._updateTitle$2();Jx.root.getLayout().addOrientationChangedEventListener(this._onOrientationChanged,this);People.RecentActivity.UI.Core.NavigatableControl.prototype.onRendered.call(this)};People.RecentActivity.UI.SelfPage.SelfPagePhotoTagsControl.prototype._disposeControls$2=function(n){for(var r,t,i=0;i<n.length;i++)r=n[i],t=this._getKey$2(r),Jx.isUndefined(this._controls$2[t])||(this._controls$2[t].dispose(),delete this._controls$2[t]),delete this._elements$2[t]};People.RecentActivity.UI.SelfPage.SelfPagePhotoTagsControl.prototype._getCapacity$2=function(){if(this._expanded$2)return this._tags$2.count;var n=People.RecentActivity.UI.SelfPage.SelfPagePhotoTagsControl._tileCount$2;return n<this._tags$2.count&&n--,n};People.RecentActivity.UI.SelfPage.SelfPagePhotoTagsControl.prototype._getKey$2=function(n){var t=n.contact;return t.sourceId+";"+t.id};People.RecentActivity.UI.SelfPage.SelfPagePhotoTagsControl.prototype._renderTile$2=function(n,t){var i,r,u;i=null;r=this._getKey$2(n);Jx.isUndefined(this._elements$2[r])?(u=new People.RecentActivity.UI.Core.ContactControl(n.contact.getDataContext(),true,"/strings/raPhotoTagsContactLabel"),i=u.getElement(People.RecentActivity.UI.Core.ContactControlType.tile,People.RecentActivity.Imports.create_identityElementTileOptions(60,null),-1),u.activate(i,false),People.RecentActivity.UI.Core.AriaHelper.setRole(i,"option"),Jx.addClass(i,"ra-fauxButton"),this._controls$2[r]=u,this._elements$2[r]=i):i=this._elements$2[r];this._list$2.insertChild(i,t);this.insertTabControl(People.RecentActivity.UI.Core.Control.fromElement(i),t)};People.RecentActivity.UI.SelfPage.SelfPagePhotoTagsControl.prototype._updateList$2=function(){var t=this._getCapacity$2(),f,n,i,r,e,u;if(t>0)for(f=this._list$2.element,f.innerHTML="",n=0,i=this._tags$2.findUser(),i!=null&&(this._renderTile$2(i,n),n++,t--),r=0,e=this._tags$2.count;r<e&&t>0;r++)u=this._tags$2.item(r),u!==i&&(this._renderTile$2(u,n),n++,t--)};People.RecentActivity.UI.SelfPage.SelfPagePhotoTagsControl.prototype._updateMoreButton$2=function(){var i=this._tags$2.count,r=this._getCapacity$2(),n=i-r,t;n>99?(this._buttonMore$2.addClass("ra-selfPagePhotoTagsOthersButtonArrow"),this._buttonMore$2.isVisible=true,this._buttonMore$2.label=Jx.res.loadCompoundString("/strings/raPhotoTagsOthers-othersMany",Jx.res.getString("/strings/raPhotoTagsOthers99Plus")),this._buttonMore$2.text="",this.addTabControl(this._buttonMore$2)):n>0?(t="/strings/raPhotoTagsOthers"+(n===1?"One":"Many"),this._buttonMore$2.removeClass("ra-selfPagePhotoTagsOthersButtonArrow"),this._buttonMore$2.isVisible=true,this._buttonMore$2.label=Jx.res.loadCompoundString(t,n),this._buttonMore$2.text=Jx.res.loadCompoundString("/strings/raPhotoTagsOthers",n),this.addTabControl(this._buttonMore$2)):(this.removeTabControl(this._buttonMore$2),this._buttonMore$2.isVisible=false)};People.RecentActivity.UI.SelfPage.SelfPagePhotoTagsControl.prototype._updateTitle$2=function(){this._title$2.isVisible=this._tags$2.count>0};People.RecentActivity.UI.SelfPage.SelfPagePhotoTagsControl.prototype._focusOnTile=function(n){var t=this._list$2.element.children;t[n].focus()};People.RecentActivity.UI.SelfPage.SelfPagePhotoTagsControl.prototype._updateTileCount$2=function(){var n=Jx.root.getLayoutState(),t=n==="portrait"||n==="snapped"?4:5;return People.RecentActivity.UI.SelfPage.SelfPagePhotoTagsControl._tileCount$2!==t?(People.RecentActivity.UI.SelfPage.SelfPagePhotoTagsControl._tileCount$2=t,true):false};People.RecentActivity.UI.SelfPage.SelfPagePhotoTagsControl.prototype._onMoreButtonClicked$2=function(){this.expand(true)};People.RecentActivity.UI.SelfPage.SelfPagePhotoTagsControl.prototype._onMoreButtonKeyDown=function(n){switch(n.keyCode){case WinJS.Utilities.Key.enter:case WinJS.Utilities.Key.space:this.expand(true)}};People.RecentActivity.UI.SelfPage.SelfPagePhotoTagsControl.prototype._onCollectionChanged$2=function(n){switch(n.action){case People.RecentActivity.NotifyCollectionChangedAction.remove:this._disposeControls$2(n.oldItems)}this._updateList$2()};People.RecentActivity.UI.SelfPage.SelfPagePhotoTagsControl.prototype._onCollectionPropertyChanged$2=function(n){switch(n.propertyName){case"Count":case"TotalCount":this._updateList$2();this._updateMoreButton$2();this._updateTitle$2()}};People.RecentActivity.UI.SelfPage.SelfPagePhotoTagsControl.prototype._onOrientationChanged=function(){this._updateTileCount$2()&&(this._updateList$2(true),this._updateMoreButton$2(false))};People.RecentActivity.UI.SelfPage.PhotoDataModel=function(n){var t;People.RecentActivity.Imports.PhotoViewerDataModel.call(this);this._obj$1=n;this._images$1={};this._items$1=[];this._itemIdMap$1={};this._itemKeyMap$1={};this._photos$1={};this._root$1=new People.RecentActivity.Imports.PhotoViewerRootItem(this._items$1);switch(this._obj$1.objectType){case People.RecentActivity.FeedObjectType.photo:this._addItems$1(0,[this._obj$1]);break;case People.RecentActivity.FeedObjectType.photoAlbum:t=this._obj$1;this._addItems$1(0,t.photos.toArray())}this._obj$1.objectType===People.RecentActivity.FeedObjectType.photoAlbum&&(t=this._obj$1,t.photos.addListener("collectionchanged",this._onPhotoCollectionChanged$1,this))};Jx.inherit(People.RecentActivity.UI.SelfPage.PhotoDataModel,People.RecentActivity.Imports.PhotoViewerDataModel);People.RecentActivity.UI.SelfPage.PhotoDataModel.prototype._obj$1=null;People.RecentActivity.UI.SelfPage.PhotoDataModel.prototype._itemIdMap$1=null;People.RecentActivity.UI.SelfPage.PhotoDataModel.prototype._itemKeyMap$1=null;People.RecentActivity.UI.SelfPage.PhotoDataModel.prototype._photos$1=null;People.RecentActivity.UI.SelfPage.PhotoDataModel.prototype._root$1=null;People.RecentActivity.UI.SelfPage.PhotoDataModel.prototype._items$1=null;People.RecentActivity.UI.SelfPage.PhotoDataModel.prototype._images$1=null;People.RecentActivity.UI.SelfPage.PhotoDataModel.prototype._disposed$1=false;People.RecentActivity.UI.SelfPage.PhotoDataModel.prototype.dispose=function(){var i,t,r,n;if(!this._disposed$1){this._disposed$1=true;this._obj$1.objectType===People.RecentActivity.FeedObjectType.photoAlbum&&(i=this._obj$1,i.photos.removeListenerSafe("collectionchanged",this._onPhotoCollectionChanged$1,this));this._root$1=null;People.Social.clearKeys(this._photos$1);People.Social.clearKeys(this._itemIdMap$1);People.Social.clearKeys(this._itemKeyMap$1);this._items$1.length=0;for(t in this._images$1)r={key:t,value:this._images$1[t]},n=r.value,n.removeListenerSafe("imagefailed",this._onImageFailed$1,this),n.removeListenerSafe("imageloaded",this._onImageLoaded$1,this),n.dispose();People.Social.clearKeys(this._images$1)}};People.RecentActivity.UI.SelfPage.PhotoDataModel.prototype.getKey=function(n){return this._itemIdMap$1[n].key};People.RecentActivity.UI.SelfPage.PhotoDataModel.prototype.getItem=function(n){return n==="root"?this._root$1:this._itemKeyMap$1[n]};People.RecentActivity.UI.SelfPage.PhotoDataModel.prototype.getChildCount=function(){return this._items$1.length};People.RecentActivity.UI.SelfPage.PhotoDataModel.prototype.getChildByIndex=function(n,t){return this._items$1[t]};People.RecentActivity.UI.SelfPage.PhotoDataModel.prototype.getIndexOfChild=function(n,t){return this._items$1.indexOf(t)};People.RecentActivity.UI.SelfPage.PhotoDataModel.prototype._isZeroSizedPhoto$1=function(n){return!n.originalHeight||!n.originalWidth};People.RecentActivity.UI.SelfPage.PhotoDataModel.prototype._createItem$1=function(n){var t=People.RecentActivity.Imports.create_photoViewerItemPhoto(n.sourceWidth,n.sourceHeight),i=People.RecentActivity.Imports.create_photoViewerItemThumbnail("height128",n.thumbnailWidth,n.thumbnailHeight,n.thumbnailSource),r=People.RecentActivity.Imports.create_photoViewerItemThumbnail("normal",n.originalWidth,n.originalHeight,n.originalSource),u=People.RecentActivity.Imports.create_photoViewerItemThumbnailSet([i,r]);return new People.RecentActivity.Imports.PhotoViewerItem(n.id,Jx.res.getString("/strings/raPhotoLabel"),t,u)};People.RecentActivity.UI.SelfPage.PhotoDataModel.prototype._getPhotoKey$1=function(n){return n.sourceId+";"+n.id};People.RecentActivity.UI.SelfPage.PhotoDataModel.prototype._getPhotoSize$1=function(n){var i,t;i=this._getPhotoKey$1(n);Jx.isUndefined(this._images$1[i])?(t=new People.RecentActivity.UI.Core.ImageControl(document.createElement("img")),t.id=i,t.addListener("imagefailed",this._onImageFailed$1,this),t.addListener("imageloaded",this._onImageLoaded$1,this),t.source=n.originalSource):(t=this._images$1[i],t.isLoaded&&this._updateItemSize$1(n,this._itemIdMap$1[n.id],t.width,t.height))};People.RecentActivity.UI.SelfPage.PhotoDataModel.prototype._addItems$1=function(n,t){for(var u,r,f=[],i=0;i<t.length;i++)r=t[i],u=this._createItem$1(r),this._items$1.splice(n,0,u),this._itemIdMap$1[u.id]=u,this._itemKeyMap$1[u.key]=u,this._photos$1[this._getPhotoKey$1(r)]=r,this._isZeroSizedPhoto$1(r)&&f.push(r),n++;for(this._root$1.folder.photoCount=this._items$1.length,i=0;i<f.length;i++)r=f[i],this._getPhotoSize$1(r)};People.RecentActivity.UI.SelfPage.PhotoDataModel.prototype._removeItems$1=function(n){for(var t=0;t<n.length;t++){var r=n[t],i=this._itemIdMap$1[r.id],u=this._items$1.indexOf(i);u!==-1&&this._items$1.splice(u,1);delete this._itemIdMap$1[i.id];delete this._itemKeyMap$1[i.key];delete this._photos$1[this._getPhotoKey$1(r)]}this._root$1.folder.photoCount=this._items$1.length};People.RecentActivity.UI.SelfPage.PhotoDataModel.prototype._resetItems$1=function(){var r=this._obj$1,t=r.photos,n,i;for(this._items$1.length=0,n=0,i=t.count;n<i;n++)this._items$1.push(this._itemIdMap$1[t.item(n).id])};People.RecentActivity.UI.SelfPage.PhotoDataModel.prototype._updateItemSize$1=function(n,t,i,r){var f=t.thumbnailSet,u=f.thumbnails[1];u.height=r;u.width=i;t.photo.height=r;t.photo.width=i;this.raiseEvent("dataChanged",t)};People.RecentActivity.UI.SelfPage.PhotoDataModel.prototype._onPhotoCollectionChanged$1=function(n){switch(n.action){case People.RecentActivity.NotifyCollectionChangedAction.add:this._addItems$1(n.newItemIndex,n.newItems);break;case People.RecentActivity.NotifyCollectionChangedAction.remove:this._removeItems$1(n.oldItems);break;case People.RecentActivity.NotifyCollectionChangedAction.reset:this._resetItems$1()}this.raiseEvent("dataChanged",this._root$1)};People.RecentActivity.UI.SelfPage.PhotoDataModel.prototype._onImageFailed$1=function(n){var t=n.sender;t.removeListenerSafe("imagefailed",this._onImageFailed$1,this);t.removeListenerSafe("imageloaded",this._onImageLoaded$1,this)};People.RecentActivity.UI.SelfPage.PhotoDataModel.prototype._onImageLoaded$1=function(n){var t,r,i;t=n.sender;t.removeListenerSafe("imagefailed",this._onImageFailed$1,this);t.removeListenerSafe("imageloaded",this._onImageLoaded$1,this);r=t.id;Jx.isUndefined(this._photos$1[r])||(i=this._photos$1[t.id],this._updateItemSize$1(i,this._itemIdMap$1[i.id],t.width,t.height))};People.RecentActivity.UI.SelfPage.PhotoViewContext=function(n){People.RecentActivity.Imports.PhotoViewerViewContext.call(this,new People.RecentActivity.UI.SelfPage.PhotoDataModel(n))};Jx.inherit(People.RecentActivity.UI.SelfPage.PhotoViewContext,People.RecentActivity.Imports.PhotoViewerViewContext);People.RecentActivity.UI.SelfPage.PhotoViewContext.prototype.dispose=function(){this.dataModel.dispose()};People.RecentActivity.UI.SelfPage.SelfPage=function(n){this._refreshTimer=-1;this._context=n;this._element=People.RecentActivity.UI.Core.HtmlHelper.createElement(People.RecentActivity.UI.Core.Html.selfPage);this._content=People.RecentActivity.UI.Core.HtmlHelper.findOrCreateControlById(this._element,"selfpage-content");this._sidebar=People.RecentActivity.UI.Core.HtmlHelper.findOrCreateControlById(this._element,"selfpage-sidebar");this._isCommentScenario=this._context.isCommentScenario};Jx.mix(People.RecentActivity.UI.SelfPage.SelfPage.prototype,Jx.Events);Jx.mix(People.RecentActivity.UI.SelfPage.SelfPage.prototype,People.Social.Events);People.RecentActivity.UI.SelfPage.SelfPage._hydrationVersion=2;People.RecentActivity.UI.SelfPage.SelfPage._refreshTimeout=200;People.RecentActivity.UI.SelfPage.SelfPage.prototype._context=null;People.RecentActivity.UI.SelfPage.SelfPage.prototype._isCommentScenario=false;People.RecentActivity.UI.SelfPage.SelfPage.prototype._state=null;People.RecentActivity.UI.SelfPage.SelfPage.prototype._obj=null;People.RecentActivity.UI.SelfPage.SelfPage.prototype._element=null;People.RecentActivity.UI.SelfPage.SelfPage.prototype._rendered=false;People.RecentActivity.UI.SelfPage.SelfPage.prototype._backButtonRendered=false;People.RecentActivity.UI.SelfPage.SelfPage.prototype._sidebar=null;People.RecentActivity.UI.SelfPage.SelfPage.prototype._sidebarChild=null;People.RecentActivity.UI.SelfPage.SelfPage.prototype._content=null;People.RecentActivity.UI.SelfPage.SelfPage.prototype._contentChild=null;People.RecentActivity.UI.SelfPage.SelfPage.prototype._item=null;People.RecentActivity.UI.SelfPage.SelfPage.prototype._commands=null;People.RecentActivity.UI.SelfPage.SelfPage.prototype._commandBack=null;People.RecentActivity.UI.SelfPage.SelfPage.prototype._refresher=null;People.RecentActivity.UI.SelfPage.SelfPage.prototype._disposed=false;People.RecentActivity.UI.SelfPage.SelfPage.prototype._inputHandler=null;People.RecentActivity.UI.SelfPage.SelfPage.prototype._inputHandlerHeight=0;People.RecentActivity.UI.SelfPage.SelfPage.prototype._isResizing=false;Object.defineProperty(People.RecentActivity.UI.SelfPage.SelfPage.prototype,"element",{get:function(){return this._element}});Object.defineProperty(People.RecentActivity.UI.SelfPage.SelfPage.prototype,"isSidebarVisible",{get:function(){return this._sidebar.isVisible}});Object.defineProperty(People.RecentActivity.UI.SelfPage.SelfPage.prototype,"displayedObject",{get:function(){if(this._sidebarChild!=null){var n=this._sidebarChild.object;if(n!=null)return n}return this._obj}});Object.defineProperty(People.RecentActivity.UI.SelfPage.SelfPage.prototype,"object",{get:function(){return this._obj}});Object.defineProperty(People.RecentActivity.UI.SelfPage.SelfPage.prototype,"refresher",{get:function(){return this._refresher}});Object.defineProperty(People.RecentActivity.UI.SelfPage.SelfPage.prototype,"isCommentScenario",{get:function(){return this._isCommentScenario}});People.RecentActivity.UI.SelfPage.SelfPage.prototype.getState=function(){return this._item!=null&&this._sidebar!=null?People.RecentActivity.UI.SelfPage.create_selfPageHydrationData(2,this._item.getContentState(),this._item.getSidebarState(),this._sidebar.isVisible):null};People.RecentActivity.UI.SelfPage.SelfPage.prototype.dispose=function(){this._disposed||(this._disposed=true,People.RecentActivity.UI.Core.SnapManager.removeControl(this),People.RecentActivity.UI.Core.KeyboardRefresher.removeControl(this),this._inputHandler!=null&&(this._inputHandler.removeListenerSafe("showing",this._onInputHandlerShowing,this),this._inputHandler.removeListenerSafe("hiding",this._onInputHandlerHiding,this),this._inputHandler.dispose(),this._inputHandler=null),this._refreshTimer!==-1&&(clearTimeout(this._refreshTimer),this._refreshTimer=-1),this._content!=null&&(this._content.dispose(),this._content=null),this._contentChild!=null&&(this._contentChild.dispose(),this._contentChild=null),this._sidebar!=null&&(this._sidebar.dispose(),this._sidebar=null),this._sidebarChild!=null&&(this._sidebarChild.dispose(),this._sidebarChild=null),this._item!=null&&(this._item.removeListenerSafe("propertychanged",this._onItemPropertyChanged,this),this._item.dispose(),this._item=null),this._commands!=null&&(this._commands.dispose(),this._commands=null),this._commandBack!=null&&(this._commandBack.dispose(),this._commandBack=null),this._refresher!=null&&(this._refresher.dispose(),this._refresher=null),People.RecentActivity.UI.Core.EventManager.events.removeListenerSafe("windowresized",this._onWindowResized,this),this._element=null)};People.RecentActivity.UI.SelfPage.SelfPage.prototype.getAnimationData=function(){var n=[[this._content.element],[this._sidebar.element]];return People.RecentActivity.Imports.create_contentAnimationData(n,this._onEnterComplete.bind(this))};People.RecentActivity.UI.SelfPage.SelfPage.prototype.render=function(n,t){if(Jx.log.write(4,"SelfPage::Render"),!this._rendered){this._rendered=true;this._obj=n;this._refresher=new People.RecentActivity.UI.SelfPage.SelfPageRefresher(this._obj.network.identity);this._refresher.addListener("refreshcompleted",this._onRefreshCompleted,this);var i=t;i!=null&&i.v===2&&(this._state=i);switch(this._obj.objectType){case People.RecentActivity.FeedObjectType.photo:this._renderPhoto();break;case People.RecentActivity.FeedObjectType.photoAlbum:this._renderPhotoAlbum();break;case People.RecentActivity.FeedObjectType.entry:this._renderEntry()}People.RecentActivity.Core.BiciHelper.setCurrentPageName(this._item.biciPageName);People.RecentActivity.Core.BiciHelper.createPageViewDatapoint(this._obj.sourceId);switch(this._item.style){case 1:Jx.removeClass(this._element,"ra-selfPageLight");Jx.addClass(this._element,"ra-selfPageDark");break;case 0:Jx.addClass(this._element,"ra-selfPageLight")}Jx.addClass(this._element,"ra-network"+this._obj.sourceId);People.RecentActivity.UI.Core.SnapManager.addControl(this);People.RecentActivity.UI.Core.KeyboardRefresher.addControl(this);this._addBackButtonStyle();this._renderContent();this._renderSidebar();this._renderCommands();People.RecentActivity.UI.Core.EventManager.events.addListener("windowresized",this._onWindowResized,this);this._item.addListener("propertychanged",this._onItemPropertyChanged,this)}};People.RecentActivity.UI.SelfPage.SelfPage.prototype.renderBackButton=function(){this._backButtonRendered||(this._backButtonRendered=true,this._commandBack=People.RecentActivity.UI.Core.HtmlHelper.findOrCreateControlById(this.element,"selfpage-back"),this._commandBack.attach("click",this._onBackButtonClicked.bind(this)),this._commandBack.label=Jx.res.getString("/strings/backButtonAriaLabel"),this._commandBack.text=People.RecentActivity.UI.Core.HtmlHelper.isRightToLeft?"":"",Jx.addClass(this._element,"ra-selfPageLight"))};People.RecentActivity.UI.SelfPage.SelfPage.prototype.refresh=function(){this.refreshAll(null)};People.RecentActivity.UI.SelfPage.SelfPage.prototype.onLayoutChanged=function(){this._renderContentChild()};People.RecentActivity.UI.SelfPage.SelfPage.prototype.refreshAll=function(n){this._refresher!=null&&(this._refresher.refresh(this._obj,n),this.refreshCurrent(n))};People.RecentActivity.UI.SelfPage.SelfPage.prototype.refreshCurrent=function(n){if(this._sidebarChild!=null){var t=this._sidebarChild.object;t!=null&&t!==this._obj&&this._refresher.refresh(t,n)}};People.RecentActivity.UI.SelfPage.SelfPage.prototype.refreshObjects=function(n,t){var i=this;this._refreshTimer!==-1&&clearTimeout(this._refreshTimer);this._refreshTimer=setTimeout(function(){for(var r=0,u=n.length;r<u;r++)i._refresher.refresh(n[r],t)},200)};People.RecentActivity.UI.SelfPage.SelfPage.prototype._renderSidebar=function(){if(Jx.log.write(4,"SelfPage::RenderSidebar"),People.RecentActivity.Core.EtwHelper.writeUnofficialEvent(People.RecentActivity.Core.EtwEventName.unofficialUISelfPageRenderSidebarStart),this._sidebarChild=this._item.sidebar,this._state!=null&&(this._sidebar.isVisible=this._state.sv),this._sidebarChild!=null){this._sidebar.appendControl(this._sidebarChild);this._item.onSidebarRendered(this._state==null?null:this._state.sd)}this._inputHandler=new People.RecentActivity.UI.Core.InputManager;this._inputHandler.addListener("showing",this._onInputHandlerShowing,this);this._inputHandler.addListener("hiding",this._onInputHandlerHiding,this);People.RecentActivity.Core.EtwHelper.writeUnofficialEvent(People.RecentActivity.Core.EtwEventName.unofficialUISelfPageRenderSidebarEnd)};People.RecentActivity.UI.SelfPage.SelfPage.prototype._renderContent=function(){Jx.log.write(4,"SelfPage::RenderContent");People.RecentActivity.Core.EtwHelper.writeUnofficialEvent(People.RecentActivity.Core.EtwEventName.unofficialUISelfPageRenderContentStart);this._renderContentChild();People.RecentActivity.Core.EtwHelper.writeUnofficialEvent(People.RecentActivity.Core.EtwEventName.unofficialUISelfPageRenderContentEnd)};People.RecentActivity.UI.SelfPage.SelfPage.prototype._renderContentChild=function(){if(this._contentChild==null&&(this._contentChild=this._item.content,this._contentChild!=null)){this._content.appendControl(this._contentChild);this._item.onContentRendered(this._state==null?null:this._state.cd);this._context.isCommentScenario||this._item.setFocusOnContent()}};People.RecentActivity.UI.SelfPage.SelfPage.prototype._renderCommands=function(){this._commands=new People.RecentActivity.UI.SelfPage.SelfPageCommands(this,this._obj);this._state==null&&this._commands.refresh()};People.RecentActivity.UI.SelfPage.SelfPage.prototype._addBackButtonStyle=function(){this._item.style===1&&(this._commandBack.attach("MSPointerMove",this._onBackButtonHover.bind(this)),this._commandBack.attach("MSPointerCancel",this._onBackButtonHoverCancelled.bind(this)),this._commandBack.attach("MSPointerOut",this._onBackButtonHoverCancelled.bind(this)),this._commandBack.element.style.backgroundImage="url('"+People.RecentActivity.UI.Core.HtmlHelper.resolvePath("~/images/ra-selfPageBackRest.png")+"')")};People.RecentActivity.UI.SelfPage.SelfPage.prototype._renderPhoto=function(){var n=this._obj,t=n.album;t!=null&&(this._obj=t);this._item=new People.RecentActivity.UI.SelfPage.SelfPagePhotoItem(this,this._obj,n.id)};People.RecentActivity.UI.SelfPage.SelfPage.prototype._renderPhotoAlbum=function(){if(this._context!=null){var n=this._context.data;this._item=n!=null&&n.isOneUp?new People.RecentActivity.UI.SelfPage.SelfPagePhotoItem(this,this._obj,n!=null?n.photoId:null):new People.RecentActivity.UI.SelfPage.SelfPagePhotoAlbumItem(this,this._obj,n!=null?n.photoId:null)}else this._item=new People.RecentActivity.UI.SelfPage.SelfPagePhotoAlbumItem(this,this._obj,null)};People.RecentActivity.UI.SelfPage.SelfPage.prototype._renderEntry=function(){var t=this._obj,n;switch(t.entryType){case People.RecentActivity.FeedEntryType.link:this._item=new People.RecentActivity.UI.SelfPage.SelfPagePlainItem(this,this._obj);break;case People.RecentActivity.FeedEntryType.text:this._item=new People.RecentActivity.UI.SelfPage.SelfPagePlainItem(this,this._obj);break;case People.RecentActivity.FeedEntryType.video:this._item=People.RecentActivity.UI.SelfPage.SelfPageVideoItem.isSupported(this._obj)?new People.RecentActivity.UI.SelfPage.SelfPageVideoItem(this,this._obj):new People.RecentActivity.UI.SelfPage.SelfPagePlainItem(this,this._obj);break;case People.RecentActivity.FeedEntryType.photo:n=t.data;this._obj=n.photo;this._renderPhoto();break;case People.RecentActivity.FeedEntryType.photoAlbum:n=t.data;this._obj=n.album;this._renderPhotoAlbum()}};People.RecentActivity.UI.SelfPage.SelfPage.prototype._resizeItem=function(){if(this._item!=null&&this._content!=null&&this._contentChild!=null){this._adjustForInputPane(0);this._isResizing=true;var t=this._item.onResized(),n=this._onResizeCompleted.bind(this);t.done(n,n)}};People.RecentActivity.UI.SelfPage.SelfPage.prototype._adjustForInputPane=function(n){if(!this._isResizing){Jx.isValidNumber(n)||(n=this._inputHandlerHeight);var t=true,i=this._sidebar.element.offsetHeight-this._sidebarChild.commentInputHeight;return n>i&&(t=false,n=i),this._sidebar.element.style.marginBottom=n+"px",t}};People.RecentActivity.UI.SelfPage.SelfPage.prototype._onWindowResized=function(){this._resizeItem()};People.RecentActivity.UI.SelfPage.SelfPage.prototype._onItemPropertyChanged=function(n){switch(n.propertyName){case"Content":this._onItemContentChanged();break;case"Sidebar":this._onItemSidebarChanged()}};People.RecentActivity.UI.SelfPage.SelfPage.prototype._onItemContentChanged=function(){var u=this,t=null,n=null,r=this._item.content,i;if(this._contentChild!==r){if(i=this._contentChild!=null,i&&(n=this._contentChild.element),this._contentChild=r,this._contentChild!=null){t=this._contentChild.element;this._content.appendControl(this._contentChild);this._item.onContentRendered(i||this._state==null?null:this._state.cd)}(t!=null||n!=null)&&People.RecentActivity.UI.Core.AnimationHelper.transitionContent(t,n).done(function(){return u._disposed||n!=null&&n.parentNode!=null&&n.parentNode.removeChild(n),null})}};People.RecentActivity.UI.SelfPage.SelfPage.prototype._onItemSidebarChanged=function(){var u=this,t=null,n=null,i=this._item.sidebar,r=this._sidebarChild!=null,f=this._sidebarChild!==i;if(this._sidebarChild!==i){if(r&&(n=this._sidebarChild.element),this._sidebarChild=i,this._sidebarChild!=null){t=this._sidebarChild.element;this._sidebar.appendControl(this._sidebarChild);this._item.onSidebarRendered(r||this._state==null?null:this._state.sd);!r&&this._context.isCommentScenario&&this._item.setFocusOnCommentInput()}(t!=null||n!=null)&&People.RecentActivity.UI.Core.AnimationHelper.crossFadeContent(t,n).done(function(){return u._disposed||n!=null&&n.parentNode!=null&&n.parentNode.removeChild(n),null})}};People.RecentActivity.UI.SelfPage.SelfPage.prototype._onBackButtonClicked=function(){People.RecentActivity.UI.Core.SelfPageNavigationHelper.navigateBack()};People.RecentActivity.UI.SelfPage.SelfPage.prototype._onBackButtonHover=function(){var n=this._commandBack.element;n.style.backgroundImage="url('"+People.RecentActivity.UI.Core.HtmlHelper.resolvePath("~/images/ra-selfPageBackHover.png")+"')"};People.RecentActivity.UI.SelfPage.SelfPage.prototype._onBackButtonHoverCancelled=function(){var n=this._commandBack.element;n.style.backgroundImage="url('"+People.RecentActivity.UI.Core.HtmlHelper.resolvePath("~/images/ra-selfPageBackRest.png")+"')"};People.RecentActivity.UI.SelfPage.SelfPage.prototype._onInputHandlerShowing=function(n){this._inputHandlerHeight=n.occludedRect.height;n.ensuredFocusedElementInView=this._adjustForInputPane()};People.RecentActivity.UI.SelfPage.SelfPage.prototype._onInputHandlerHiding=function(){this._inputHandlerHeight=0;this._adjustForInputPane()};People.RecentActivity.UI.SelfPage.SelfPage.prototype._onEnterComplete=function(){this._item!=null&&this._context!=null&&this._context.isCommentScenario&&this._item.setFocusOnCommentInput()};People.RecentActivity.UI.SelfPage.SelfPage.prototype._onRefreshCompleted=function(n){this.raiseEvent("refreshcompleted",n)};People.RecentActivity.UI.SelfPage.SelfPage.prototype._onResizeCompleted=function(){this.isDiposed||(this._isResizing=false,this._adjustForInputPane())};People.RecentActivity.UI.SelfPage.SelfPageCommands=function(n,t){this._obj=t;this._selfPage=n;this._selfPage.addListener("refreshcompleted",this._onRefreshCompleted,this);this._render()};People.RecentActivity.UI.SelfPage.SelfPageCommands.prototype._obj=null;People.RecentActivity.UI.SelfPage.SelfPageCommands.prototype._selfPage=null;People.RecentActivity.UI.SelfPage.SelfPageCommands.prototype._commandRefresh=null;People.RecentActivity.UI.SelfPage.SelfPageCommands.prototype._commandOpenOnNetwork=null;People.RecentActivity.UI.SelfPage.SelfPageCommands.prototype._refreshing=false;People.RecentActivity.UI.SelfPage.SelfPageCommands.prototype.dispose=function(){this._commandRefresh=null;this._commandOpenOnNetwork=null;this._selfPage.removeListenerSafe("refreshcompleted",this._onRefreshCompleted,this);this._obj.network.removeListenerSafe("propertychanged",this._onNetworkPropertyChanged,this)};People.RecentActivity.UI.SelfPage.SelfPageCommands.prototype.refresh=function(){this._refreshing||(this._refreshing=true,this._selfPage.refreshAll(this))};People.RecentActivity.UI.SelfPage.SelfPageCommands.prototype._render=function(){var n,t,i;this._obj.network.addListener("propertychanged",this._onNetworkPropertyChanged,this);n=Jx.root.getCommandBar();this._commandOpenOnNetwork=new People.Command("ra-sp-open-network",null,null,"",true,true,null,this._onOpenOnNetworkClicked.bind(this));this._updateOpenOnNetwork();n.addCommand(this._commandOpenOnNetwork);this._obj.objectType===People.RecentActivity.FeedObjectType.entry&&(t=this._obj,t.entryType===People.RecentActivity.FeedEntryType.link&&(i=new People.Command("ra-sp-open","/strings/ra-label-selfPageOpenInWeb","/strings/ra-tooltip-selfPageOpenInWeb","",true,true,null,this._onOpenInWebClicked.bind(this)),n.addCommand(i)));this._commandRefresh=new People.Command("ra-sp-refresh","/strings/raRefresh","/strings/raRefreshTooltip","",true,true,null,this._onRefreshClicked.bind(this));n.addCommand(this._commandRefresh);n.refresh()};People.RecentActivity.UI.SelfPage.SelfPageCommands.prototype._openUrl=function(n){People.RecentActivity.UI.Core.UriHelper.launchUri(n)};People.RecentActivity.UI.SelfPage.SelfPageCommands.prototype._updateOpenOnNetwork=function(){var n=this._obj.network.name;this._commandOpenOnNetwork.setFormattedName("/strings/ra-label-selfPageOpenOnNetwork",n);this._commandOpenOnNetwork.setFormattedTooltip("/strings/ra-tooltip-selfPageOpenOnNetwork",n)};People.RecentActivity.UI.SelfPage.SelfPageCommands.prototype._onOpenInWebClicked=function(){switch(this._obj.objectType){case People.RecentActivity.FeedObjectType.entry:this._onOpenEntryInWebClicked()}};People.RecentActivity.UI.SelfPage.SelfPageCommands.prototype._onOpenEntryInWebClicked=function(){var n=this._obj,t;n.entryType===People.RecentActivity.FeedEntryType.link&&(t=n.data,this._openUrl(t.url))};People.RecentActivity.UI.SelfPage.SelfPageCommands.prototype._onOpenOnNetworkClicked=function(){People.RecentActivity.Core.BiciHelper.createClickThroughDatapoint(this._obj.sourceId,People.RecentActivity.Core.BiciClickthroughAction.selfPageViewOnNetwork);this._openUrl(this._selfPage.displayedObject.url)};People.RecentActivity.UI.SelfPage.SelfPageCommands.prototype._onRefreshClicked=function(){this.refresh()};People.RecentActivity.UI.SelfPage.SelfPageCommands.prototype._onRefreshCompleted=function(n){n.userState===this&&(this._refreshing=false)};People.RecentActivity.UI.SelfPage.SelfPageCommands.prototype._onNetworkPropertyChanged=function(n){n.propertyName==="Name"&&this._updateOpenOnNetwork()};People.RecentActivity.UI.SelfPage.SelfPageItem=function(n,t){this._selfPage=n;this._obj=t};Jx.mix(People.RecentActivity.UI.SelfPage.SelfPageItem.prototype,Jx.Events);Jx.mix(People.RecentActivity.UI.SelfPage.SelfPageItem.prototype,People.Social.Events);People.RecentActivity.UI.SelfPage.SelfPageItem.prototype._selfPage=null;People.RecentActivity.UI.SelfPage.SelfPageItem.prototype._obj=null;People.RecentActivity.UI.SelfPage.SelfPageItem.prototype._disposed=false;Object.defineProperty(People.RecentActivity.UI.SelfPage.SelfPageItem.prototype,"style",{get:function(){return 1},configurable:true});Object.defineProperty(People.RecentActivity.UI.SelfPage.SelfPageItem.prototype,"selfPage",{get:function(){return this._selfPage}});Object.defineProperty(People.RecentActivity.UI.SelfPage.SelfPageItem.prototype,"object",{get:function(){return this._obj}});Object.defineProperty(People.RecentActivity.UI.SelfPage.SelfPageItem.prototype,"network",{get:function(){return this._obj.network}});Object.defineProperty(People.RecentActivity.UI.SelfPage.SelfPageItem.prototype,"isDisposed",{get:function(){return this._disposed}});People.RecentActivity.UI.SelfPage.SelfPageItem.prototype.dispose=function(){this._disposed||(this._disposed=true,this.onDisposed())};People.RecentActivity.UI.SelfPage.SelfPageItem.prototype.getContentState=function(){return null};People.RecentActivity.UI.SelfPage.SelfPageItem.prototype.getSidebarState=function(){var n=this.sidebar;return n!=null?n.getState():null};People.RecentActivity.UI.SelfPage.SelfPageItem.prototype.setFocusOnContent=function(){var t=this.content,n;if(t!=null&&(n=t.element.querySelector("[tabindex='0']"),n!=null))try{n.setActive()}catch(i){}};People.RecentActivity.UI.SelfPage.SelfPageItem.prototype.setFocusOnCommentInput=function(){var n=this.sidebar;n!=null&&n.setFocusOnCommentInput()};People.RecentActivity.UI.SelfPage.SelfPageItem.prototype.onContentRendered=function(){};People.RecentActivity.UI.SelfPage.SelfPageItem.prototype.onSidebarRendered=function(n){var t=this.sidebar;t.onRenderedInDom();n!=null&&t.applyState(n)};People.RecentActivity.UI.SelfPage.SelfPageItem.prototype.onResized=function(){return WinJS.Promise.wrap()};People.RecentActivity.UI.SelfPage.SelfPageItem.prototype.onDisposed=function(){};People.RecentActivity.UI.SelfPage.SelfPageItem.prototype.onPropertyChanged=function(n){this.raiseEvent("propertychanged",new People.RecentActivity.NotifyPropertyChangedEventArgs(this,n))};People.RecentActivity.UI.SelfPage.SelfPageEntryItem=function(n,t){People.RecentActivity.UI.SelfPage.SelfPageItem.call(this,n,t)};Jx.inherit(People.RecentActivity.UI.SelfPage.SelfPageEntryItem,People.RecentActivity.UI.SelfPage.SelfPageItem);People.RecentActivity.UI.SelfPage.SelfPageEntryItem.prototype._sidebar$1=null;Object.defineProperty(People.RecentActivity.UI.SelfPage.SelfPageEntryItem.prototype,"sidebar",{get:function(){return this._renderSidebar$1(),this._sidebar$1},configurable:true});Object.defineProperty(People.RecentActivity.UI.SelfPage.SelfPageEntryItem.prototype,"entry",{get:function(){return this.object}});People.RecentActivity.UI.SelfPage.SelfPageEntryItem.prototype.onDisposed=function(){this._sidebar$1!=null&&(this._sidebar$1.dispose(),this._sidebar$1=null);People.RecentActivity.UI.SelfPage.SelfPageItem.prototype.onDisposed.call(this)};People.RecentActivity.UI.SelfPage.SelfPageEntryItem.prototype.onRenderSidebar=function(){this._sidebar$1=new People.RecentActivity.UI.SelfPage.SelfPageEntrySidebarControl(this.object);this._sidebar$1.render()};People.RecentActivity.UI.SelfPage.SelfPageEntryItem.prototype._renderSidebar$1=function(){this._sidebar$1==null&&this.onRenderSidebar()},function(){var n=4;People.RecentActivity.UI.SelfPage.SelfPagePhotoAlbumItem=function(n,t,i){People.RecentActivity.UI.SelfPage.SelfPageItem.call(this,n,t);this._listviewMap$1={};this._listviewImageMap$1={};this._photoId$1=i};Jx.inherit(People.RecentActivity.UI.SelfPage.SelfPagePhotoAlbumItem,People.RecentActivity.UI.SelfPage.SelfPageItem);People.RecentActivity.UI.SelfPage.SelfPagePhotoAlbumItem.prototype._state$1=null;People.RecentActivity.UI.SelfPage.SelfPagePhotoAlbumItem.prototype._stateApplied$1=false;People.RecentActivity.UI.SelfPage.SelfPagePhotoAlbumItem.prototype._content$1=null;People.RecentActivity.UI.SelfPage.SelfPagePhotoAlbumItem.prototype._sidebar$1=null;People.RecentActivity.UI.SelfPage.SelfPagePhotoAlbumItem.prototype._title$1=null;People.RecentActivity.UI.SelfPage.SelfPagePhotoAlbumItem.prototype._count$1=null;People.RecentActivity.UI.SelfPage.SelfPagePhotoAlbumItem.prototype._listviewElement$1=null;People.RecentActivity.UI.SelfPage.SelfPagePhotoAlbumItem.prototype._listview$1=null;People.RecentActivity.UI.SelfPage.SelfPagePhotoAlbumItem.prototype._listviewList$1=null;People.RecentActivity.UI.SelfPage.SelfPagePhotoAlbumItem.prototype._listviewMap$1=null;People.RecentActivity.UI.SelfPage.SelfPagePhotoAlbumItem.prototype._listviewImageMap$1=null;People.RecentActivity.UI.SelfPage.SelfPagePhotoAlbumItem.prototype._isCoverSkipped$1=false;People.RecentActivity.UI.SelfPage.SelfPagePhotoAlbumItem.prototype._photoId$1=null;People.RecentActivity.UI.SelfPage.SelfPagePhotoAlbumItem.prototype._itemInvokedHandler$1=null;People.RecentActivity.UI.SelfPage.SelfPagePhotoAlbumItem.prototype._loadingStateChangedHandler$1=null;People.RecentActivity.UI.SelfPage.SelfPagePhotoAlbumItem.prototype._contentAnimatingHandler=null;People.RecentActivity.UI.SelfPage.SelfPagePhotoAlbumItem.prototype._enterPageAnimated=false;People.RecentActivity.UI.SelfPage.SelfPagePhotoAlbumItem.prototype._animationPromise=null;Object.defineProperty(People.RecentActivity.UI.SelfPage.SelfPagePhotoAlbumItem.prototype,"content",{get:function(){return this._renderContent$1(),this._content$1},configurable:true});Object.defineProperty(People.RecentActivity.UI.SelfPage.SelfPagePhotoAlbumItem.prototype,"sidebar",{get:function(){return this._renderSidebar$1(),this._sidebar$1},configurable:true});Object.defineProperty(People.RecentActivity.UI.SelfPage.SelfPagePhotoAlbumItem.prototype,"biciPageName",{get:function(){return People.RecentActivity.Core.BiciPageNames.selfPagePhotoAlbum},configurable:true});Object.defineProperty(People.RecentActivity.UI.SelfPage.SelfPagePhotoAlbumItem.prototype,"style",{get:function(){return 0},configurable:true});People.RecentActivity.UI.SelfPage.SelfPagePhotoAlbumItem.prototype.getContentState=function(){return this._listview$1!=null?People.RecentActivity.UI.SelfPage.create_selfPagePhotoAlbumItemHydrationData(n,this._listview$1.currentItem,this._listview$1.scrollPosition):null};People.RecentActivity.UI.SelfPage.SelfPagePhotoAlbumItem.prototype.setFocusOnContent=function(){var n,t;if(this._state$1==null&&this._listviewList$1!=null&&this._listviewList$1.length>0&&(n=this._photoId$1,Jx.isNonEmptyString(n)||(n=this._listviewList$1.getAt(0).photo.id),t=this._listviewList$1.indexOf(this._listviewMap$1[n]),t!==-1&&(this._listview$1.indexOfFirstVisible=t),!Jx.isUndefined(this._listviewImageMap$1[n])))try{this._listviewImageMap$1[n].setActive()}catch(i){Jx.log.exception("Error setting the active element.",i)}};People.RecentActivity.UI.SelfPage.SelfPagePhotoAlbumItem.prototype.onContentRendered=function(t){var u=this.object,i,r,f;u.addListener("propertychanged",this._onAlbumPropertyChanged$1,this);i=u.photos;i.addListener("collectionchanged",this._onPhotosCollectionChanged$1,this);i.addListener("propertychanged",this._onPhotosPropertyChanged$1,this);this._listviewElement$1=People.RecentActivity.UI.Core.HtmlHelper.findElementById(this._content$1.element,"item-list");this._listviewElement$1.style.visibility="hidden";this._listviewElement$1.style.opacity=0;this._listviewList$1=new WinJS.Binding.List;this._listview$1=new WinJS.UI.ListView(this._listviewElement$1);this._listview$1.itemDataSource=this._listviewList$1.dataSource;this._listview$1.itemTemplate=this._onRenderingItem$1.bind(this);this._listview$1.layout=new WinJS.UI.GridLayout;this._listview$1.loadingBehavior="randomaccess";this._listview$1.selectionMode="none";this._itemInvokedHandler$1=this._onItemInvoked$1.bind(this);this._loadingStateChangedHandler$1=this._onLoadingStateChanged$1.bind(this);this._contentAnimatingHandler=this._onContentAnimating$1.bind(this);this._listview$1.addEventListener("iteminvoked",this._itemInvokedHandler$1,false);this._listview$1.addEventListener("loadingstatechanged",this._loadingStateChangedHandler$1,false);this._listview$1.addEventListener("contentanimating",this._contentAnimatingHandler,false);t!=null&&(r=t,r.v===n&&(this._state$1=r));f=i.count;f>0&&(this._isOnlyCoverPhoto$1()?this._isCoverSkipped$1=true:this._addPhotos$1(i.toArray()));People.RecentActivity.UI.SelfPage.SelfPageItem.prototype.onContentRendered.call(this,t)};People.RecentActivity.UI.SelfPage.SelfPagePhotoAlbumItem.prototype.onResized=function(){var i=People.RecentActivity.UI.SelfPage.SelfPageItem.prototype.onResized.call(this),n=this,t=this._listview$1;return i.then(function(){if(!n.isDisposed)return new WinJS.Promise(function(i){setImmediate(function(){if(!n.isDisposed){var r=function(){(n.isDisposed||t.loadingState=="complete")&&(t.removeEventListener("loadingstatechanged",r,false),t=null,i())};t.addEventListener("loadingstatechanged",r,false);n._forceLayout$1()}})})})};People.RecentActivity.UI.SelfPage.SelfPagePhotoAlbumItem.prototype.onDisposed=function(){var n,t;this._content$1!=null&&(this._content$1.dispose(),this._content$1=null);this._title$1!=null&&(this._title$1.dispose(),this._title$1=null);this._count$1!=null&&(this._count$1.dispose(),this._count$1=null);this._animationPromise!=null&&(this._animationPromise.cancel(),this._animationPromise=null);this._listview$1!=null&&(this._listview$1.removeEventListener("iteminvoked",this._itemInvokedHandler$1,false),this._listview$1.removeEventListener("loadingstatechanged",this._loadingStateChangedHandler$1,false),this._listview$1.removeEventListener("contentanimating",this._contentAnimatingHandler,false),this._listview$1=null,this._listviewList$1=null,People.Social.clearKeys(this._listviewImageMap$1),this._listviewImageMap$1=null,People.Social.clearKeys(this._listviewMap$1),this._listviewMap$1=null,this._loadingStateChangedHandler$1=null,this._itemInvokedHandler$1=null,this._contentAnimatingHandler=null);this._listviewElement$1=null;this._sidebar$1!=null&&(this._sidebar$1.dispose(),this._sidebar$1=null);this._state$1=null;n=this.object;n.removeListenerSafe("propertychanged",this._onAlbumPropertyChanged$1,this);t=n.photos;t.removeListenerSafe("collectionchanged",this._onPhotosCollectionChanged$1,this);t.removeListenerSafe("propertychanged",this._onPhotosPropertyChanged$1,this);People.RecentActivity.UI.SelfPage.SelfPageItem.prototype.onDisposed.call(this)};People.RecentActivity.UI.SelfPage.SelfPagePhotoAlbumItem.prototype._forceLayout$1=function(){this._listview$1.forceLayout()};People.RecentActivity.UI.SelfPage.SelfPagePhotoAlbumItem.prototype._renderContent$1=function(){if(this._content$1==null){var n=People.RecentActivity.UI.Core.HtmlHelper.createElement(People.RecentActivity.UI.Core.Html.selfPagePhotoAlbumContent),i=this.object,t=i.name;this._title$1=People.RecentActivity.UI.Core.HtmlHelper.findOrCreateControlById(n,"item-title");this._title$1.text=t;this._title$1.title=t;this._count$1=People.RecentActivity.UI.Core.HtmlHelper.findOrCreateControlById(n,"item-count");this._updateCount$1();this._content$1=new People.RecentActivity.UI.Core.Control(n)}};People.RecentActivity.UI.SelfPage.SelfPagePhotoAlbumItem.prototype._renderSidebar$1=function(){this._sidebar$1==null&&(this._sidebar$1=new People.RecentActivity.UI.SelfPage.SelfPagePhotoAlbumSidebarControl(this.object),this._sidebar$1.render())};People.RecentActivity.UI.SelfPage.SelfPagePhotoAlbumItem.prototype._updateCount$1=function(){var n=this.object,t=People.RecentActivity.UI.Core.LocalizationHelper.getCountString("/strings/raSelfPagePhotoAlbumCountZero","/strings/raSelfPagePhotoAlbumCountOne","/strings/raSelfPagePhotoAlbumCountMany",n.photos.totalCount);this._count$1!=null&&this._title$1!=null&&(Jx.isNonEmptyString(n.name)?this._count$1.text=t:(this._count$1.text="",this._title$1.text=t))};People.RecentActivity.UI.SelfPage.SelfPagePhotoAlbumItem.prototype._addPhotos$1=function(n){var o,i,r,u,f,e,t;if(n.length){for(this._listview$1.addEventListener("loadingstatechanged",this._loadingStateChangedHandler$1,false),o=this._listview$1.itemDataSource,o.beginEdits(),i=2147483647,r=-1,u=0;u<n.length;u++){var s=n[u],h=s.index,t=this._createItemFromPhoto$1(s);this._listviewList$1.splice(h,0,t);this._listviewMap$1[s.id]=t;i=Math.min(i,h);r=Math.max(r,h)}this._isCoverSkipped$1&&(f=this.object.cover,e=f.index,e>=i-1&&e<=r+1&&(t=this._createItemFromPhoto$1(f),this._listviewList$1.splice(e,0,t),this._listviewMap$1[f.id]=t,this._isCoverSkipped$1=false));o.endEdits();this._listviewElement$1.style.visibility=""}};People.RecentActivity.UI.SelfPage.SelfPagePhotoAlbumItem.prototype._tryApplyState=function(){if(!this._stateApplied$1&&this._state$1!=null){try{this._listview$1.currentItem=this._state$1.c;this._listview$1.scrollPosition=this._state$1.s}catch(n){Jx.log.exception("Error setting state on ListView",n)}this._stateApplied$1=true}};People.RecentActivity.UI.SelfPage.SelfPagePhotoAlbumItem.prototype._removePhotos$1=function(n){var i,t,f,r,e,u;if(n.length){for(this._listview$1.addEventListener("loadingstatechanged",this._loadingStateChangedHandler$1,false),i=this._listview$1.itemDataSource,i.beginEdits(),t=0;t<n.length;t++)f=n[t],r=f.id,Jx.isUndefined(this._listviewMap$1[r])||(e=this._listviewMap$1[r],u=this._listviewList$1.indexOf(e),u!==-1&&this._listviewList$1.splice(u,1));i.endEdits();this._listviewList$1.length||(this._listviewElement$1.style.visibility="hidden")}};People.RecentActivity.UI.SelfPage.SelfPagePhotoAlbumItem.prototype._resetPhotos$1=function(){var t,i,n,r;for(this._listview$1.addEventListener("loadingstatechanged",this._loadingStateChangedHandler$1,false),t=this._listview$1.itemDataSource,t.beginEdits(),this._listviewList$1.splice(0,this._listviewList$1.length),i=this.object.photos,n=0,r=i.count;n<r;n++)this._listviewList$1.splice(n,0,this._listviewMap$1[i.item(n).id]);t.endEdits();this._listview$1.forceLayout()};People.RecentActivity.UI.SelfPage.SelfPagePhotoAlbumItem.prototype._createItemFromPhoto$1=function(n){return People.RecentActivity.UI.SelfPage.create_selfPagePhotoAlbumPhoto(n)};People.RecentActivity.UI.SelfPage.SelfPagePhotoAlbumItem.prototype._isOnlyCoverPhoto$1=function(){var t=this.object,n=t.photos;return n.count===1&&n.totalCount!==1&&n.item(0)===t.cover};People.RecentActivity.UI.SelfPage.SelfPagePhotoAlbumItem.prototype._onRenderingItem$1=function(n){var t=this;return n.then(function(n){var i;if(t.isDisposed)return null;var f=n.data,r=f.photo.id,u=null;return Jx.isUndefined(t._listviewImageMap$1[r])||(u=t._listviewImageMap$1[r].uniqueID,t._listviewImageMap$1[r]=null),i=document.createElement("div"),i.className="ra-selfPagePhotoAlbumItemPhotoWrapper",i.id=Jx.isNonEmptyString(u)?u:i.uniqueID,i.style.backgroundImage="url('"+f.photo.originalSource+"')",People.RecentActivity.UI.Core.AriaHelper.setLabel(i,Jx.res.getString("/strings/raSelfPagePhotoAlbumLabel")),t._listviewImageMap$1[r]=i,i})};People.RecentActivity.UI.SelfPage.SelfPagePhotoAlbumItem.prototype._onPhotosPropertyChanged$1=function(n){switch(n.propertyName){case"Count":case"TotalCount":this._updateCount$1()}};People.RecentActivity.UI.SelfPage.SelfPagePhotoAlbumItem.prototype._onPhotosCollectionChanged$1=function(n){if(this._content$1!=null)switch(n.action){case People.RecentActivity.NotifyCollectionChangedAction.add:this._addPhotos$1(n.newItems);break;case People.RecentActivity.NotifyCollectionChangedAction.remove:this._removePhotos$1(n.oldItems);break;case People.RecentActivity.NotifyCollectionChangedAction.reset:this._resetPhotos$1()}};People.RecentActivity.UI.SelfPage.SelfPagePhotoAlbumItem.prototype._onAlbumPropertyChanged$1=function(n){switch(n.propertyName){case"Name":this._title$1.text=this.object.name}};People.RecentActivity.UI.SelfPage.SelfPagePhotoAlbumItem.prototype._onContentAnimating$1=function(n){n.detail.type===WinJS.UI.ListViewAnimationType.entrance&&n.preventDefault()};People.RecentActivity.UI.SelfPage.SelfPagePhotoAlbumItem.prototype._onLoadingStateChanged$1=function(n){switch(this._listview$1.loadingState){case"itemsLoaded":if(!this._enterPageAnimated){var t=this;this._animationPromise=People.Animation.enterPage(this._listviewElement$1).done(function(){t._animationPromise=null});this._enterPageAnimated=true}n.detail!=null&&n.detail.scrolling||(this._tryApplyState(),this.setFocusOnContent());break;case"complete":n.detail!=null&&n.detail.scrolling||this.setFocusOnContent();this._listview$1.removeEventListener("loadingstatechanged",this._loadingStateChangedHandler$1,false)}};People.RecentActivity.UI.SelfPage.SelfPagePhotoAlbumItem.prototype._onItemInvoked$1=function(n){var t=People.RecentActivity.UI.Core.MoCoHelper.getItemFromEvent(this._listviewList$1,n.detail);t!=null&&People.RecentActivity.UI.Core.SelfPageNavigationHelper.navigateToObject(this.object,People.RecentActivity.UI.Core.create_selfPageAlbumData(true,t.photo.id))}}();People.RecentActivity.UI.SelfPage.SelfPagePhotoItem=function(n,t,i){this._currentIndex$1=-1;People.RecentActivity.UI.SelfPage.SelfPageItem.call(this,n,t);this._currentId$1=i;this._sidebars$1={}};Jx.inherit(People.RecentActivity.UI.SelfPage.SelfPagePhotoItem,People.RecentActivity.UI.SelfPage.SelfPageItem);People.RecentActivity.UI.SelfPage.SelfPagePhotoItem._photoFlipperCss$1="\r\n.selfnar { background-image: url('{0}'); }\r\n.selfnar:hover { background-image: url('{1}'); }\r\n.selfnar:active { background-image: url('{2}'); }\r\n.selfpar { background-image: url('{3}'); }\r\n.selfpar:hover { background-image: url('{4}'); }\r\n.selfpar:active { background-image: url('{5}'); }";People.RecentActivity.UI.SelfPage.SelfPagePhotoItem._photoSidebarPreloadCount$1=1;People.RecentActivity.UI.SelfPage.SelfPagePhotoItem._injectedPhotoFlipperCss$1=false;People.RecentActivity.UI.SelfPage.SelfPagePhotoItem._injectPhotoViewerFlipperCss$1=function(){if(!People.RecentActivity.UI.SelfPage.SelfPagePhotoItem._injectedPhotoFlipperCss$1){People.RecentActivity.UI.SelfPage.SelfPagePhotoItem._injectedPhotoFlipperCss$1=true;var n;n=People.RecentActivity.UI.Core.HtmlHelper.isLeftToRight?People.Social.format("\r\n.selfnar { background-image: url('{0}'); }\r\n.selfnar:hover { background-image: url('{1}'); }\r\n.selfnar:active { background-image: url('{2}'); }\r\n.selfpar { background-image: url('{3}'); }\r\n.selfpar:hover { background-image: url('{4}'); }\r\n.selfpar:active { background-image: url('{5}'); }",People.RecentActivity.UI.Core.HtmlHelper.resolvePath("~/images/ra-photoViewerNext.png"),People.RecentActivity.UI.Core.HtmlHelper.resolvePath("~/images/ra-photoViewerNext-hover.png"),People.RecentActivity.UI.Core.HtmlHelper.resolvePath("~/images/ra-photoViewerNext-pressed.png"),People.RecentActivity.UI.Core.HtmlHelper.resolvePath("~/images/ra-photoViewerPrevious.png"),People.RecentActivity.UI.Core.HtmlHelper.resolvePath("~/images/ra-photoViewerPrevious-hover.png"),People.RecentActivity.UI.Core.HtmlHelper.resolvePath("~/images/ra-photoViewerPrevious-pressed.png")):People.Social.format("\r\n.selfnar { background-image: url('{0}'); }\r\n.selfnar:hover { background-image: url('{1}'); }\r\n.selfnar:active { background-image: url('{2}'); }\r\n.selfpar { background-image: url('{3}'); }\r\n.selfpar:hover { background-image: url('{4}'); }\r\n.selfpar:active { background-image: url('{5}'); }",People.RecentActivity.UI.Core.HtmlHelper.resolvePath("~/images/ra-photoViewerPrevious.png"),People.RecentActivity.UI.Core.HtmlHelper.resolvePath("~/images/ra-photoViewerPrevious-hover.png"),People.RecentActivity.UI.Core.HtmlHelper.resolvePath("~/images/ra-photoViewerPrevious-pressed.png"),People.RecentActivity.UI.Core.HtmlHelper.resolvePath("~/images/ra-photoViewerNext.png"),People.RecentActivity.UI.Core.HtmlHelper.resolvePath("~/images/ra-photoViewerNext-hover.png"),People.RecentActivity.UI.Core.HtmlHelper.resolvePath("~/images/ra-photoViewerNext-pressed.png"));Jx.addStyle(n)}};People.RecentActivity.UI.SelfPage.SelfPagePhotoItem.prototype._currentId$1=null;People.RecentActivity.UI.SelfPage.SelfPagePhotoItem.prototype._currentItem$1=null;People.RecentActivity.UI.SelfPage.SelfPagePhotoItem.prototype._currentSidebar$1=null;People.RecentActivity.UI.SelfPage.SelfPagePhotoItem.prototype._content$1=null;People.RecentActivity.UI.SelfPage.SelfPagePhotoItem.prototype._viewer$1=null;People.RecentActivity.UI.SelfPage.SelfPagePhotoItem.prototype._context$1=null;People.RecentActivity.UI.SelfPage.SelfPagePhotoItem.prototype._sidebars$1=null;People.RecentActivity.UI.SelfPage.SelfPagePhotoItem.prototype._isPropertyChangedQueued$1=false;People.RecentActivity.UI.SelfPage.SelfPagePhotoItem.prototype._isInitialWithState$1=false;People.RecentActivity.UI.SelfPage.SelfPagePhotoItem.prototype._lockToken$1=null;Object.defineProperty(People.RecentActivity.UI.SelfPage.SelfPagePhotoItem.prototype,"content",{get:function(){return this._renderContent$1(),this._content$1},configurable:true});Object.defineProperty(People.RecentActivity.UI.SelfPage.SelfPagePhotoItem.prototype,"sidebar",{get:function(){return this._renderSidebar$1(),this._currentSidebar$1},configurable:true});Object.defineProperty(People.RecentActivity.UI.SelfPage.SelfPagePhotoItem.prototype,"biciPageName",{get:function(){return People.RecentActivity.Core.BiciPageNames.selfPagePhoto},configurable:true});People.RecentActivity.UI.SelfPage.SelfPagePhotoItem.prototype.getContentState=function(){return this._currentIndex$1};People.RecentActivity.UI.SelfPage.SelfPagePhotoItem.prototype.getSidebarState=function(){return this._currentSidebar$1!=null?this._currentSidebar$1.getState():null};People.RecentActivity.UI.SelfPage.SelfPagePhotoItem.prototype.onContentRendered=function(n){var t,f,i,r,u;this._isInitialWithState$1=n!=null;t=this.object;this._context$1=new People.RecentActivity.UI.SelfPage.PhotoViewContext(t);t.objectType===People.RecentActivity.FeedObjectType.photoAlbum&&(f=t,i=f.photos,i.addListener("collectionchanged",this._onPhotoCollectionChanged$1,this),i.addListener("propertychanged",this._onPhotoCollectionPropertyChanged$1,this),Jx.isNonEmptyString(this._currentId$1)&&(this._lockToken$1=i.lock(this._currentId$1)));this._renderViewer$1();n!=null&&(r=n,u=this._context$1.dataModel.getChildCount(),this._currentIndex$1=r<u?r:u-1);this._renderCurrentItem$1(false);People.RecentActivity.UI.SelfPage.SelfPageItem.prototype.onContentRendered.call(this,n)};People.RecentActivity.UI.SelfPage.SelfPagePhotoItem.prototype.onResized=function(){var t=People.RecentActivity.UI.SelfPage.SelfPageItem.prototype.onResized.call(this),n=this;return t.then(function(){if(!n.isDisposed)return new WinJS.Promise(function(t){setImmediate(function(){n.isDisposed||(n._resizeGrid(),n._viewer$1!=null&&n._viewer$1.resize(),t())})})})};People.RecentActivity.UI.SelfPage.SelfPagePhotoItem.prototype._resizeGrid=function(){var n=this.selfPage.element.querySelector(".ra-selfPageContainer"),i,t;n.offsetWidth/n.offsetHeight<1?(i=4/3,t=n.offsetWidth/i,t=Math.min(t,n.offsetHeight/2),n.style["-ms-grid-rows"]=t+"px 1fr"):n.style["-ms-grid-rows"]="100%"};People.RecentActivity.UI.SelfPage.SelfPagePhotoItem.prototype.onDisposed=function(){var i=this.object,r,n,t,u;if(this._currentItem$1=null,i.objectType===People.RecentActivity.FeedObjectType.photoAlbum&&(r=i,n=r.photos,n.removeListenerSafe("collectionchanged",this._onPhotoCollectionChanged$1,this),n.removeListenerSafe("propertychanged",this._onPhotoCollectionPropertyChanged$1,this),this._lockToken$1!=null&&(n.unlock(this._lockToken$1),this._lockToken$1=null)),this._context$1!=null&&(this._context$1.dispose(),this._context$1=null),this._content$1!=null&&(this._content$1.dispose(),this._content$1=null),this._viewer$1!=null&&(this._viewer$1.dispose(),this._viewer$1=null),this._sidebars$1!=null){for(t in this._sidebars$1)u={key:t,value:this._sidebars$1[t]},u.value.dispose();People.Social.clearKeys(this._sidebars$1)}this._currentSidebar$1!=null&&(this._currentSidebar$1.dispose(),this._currentSidebar$1=null);People.RecentActivity.UI.SelfPage.SelfPageItem.prototype.onDisposed.call(this)};People.RecentActivity.UI.SelfPage.SelfPagePhotoItem.prototype._renderContent$1=function(){this._content$1==null&&(People.RecentActivity.Core.EtwHelper.writeUnofficialEvent(People.RecentActivity.Core.EtwEventName.unofficialUILoadPhotoViewerStart),$include("$(socialRoot)/Social.PhotoViewer.js"),People.RecentActivity.Core.EtwHelper.writeUnofficialEvent(People.RecentActivity.Core.EtwEventName.unofficialUILoadPhotoViewerStop),this._resizeGrid(),this._content$1=new People.RecentActivity.UI.Core.Control(People.RecentActivity.UI.Core.HtmlHelper.createElement(People.RecentActivity.UI.Core.Html.selfPagePhotoContent)))};People.RecentActivity.UI.SelfPage.SelfPagePhotoItem.prototype._renderViewer$1=function(){var n,t,i,r;n=Jx.res;t=People.RecentActivity.Imports.create_photoViewerImages(People.RecentActivity.UI.Core.HtmlHelper.resolvePath("~/images/ra-1x1.gif"),People.RecentActivity.UI.Core.HtmlHelper.resolvePath("~/images/ra-1x1.gif"),People.RecentActivity.UI.Core.HtmlHelper.resolvePath("~/images/ra-1x1.gif"),People.RecentActivity.UI.Core.HtmlHelper.resolvePath("~/images/ra-1x1.gif"));People.RecentActivity.UI.SelfPage.SelfPagePhotoItem._injectPhotoViewerFlipperCss$1();i=People.RecentActivity.Imports.create_photoViewerStrings(n.getString("/strings/raPhotoViewerPrevious"),n.getString("/strings/raPhotoViewerNext"));r=this._content$1.element;this._viewer$1=new wLive.Controls.SelfView($(r),this._context$1,People.RecentActivity.Imports.create_photoViewerOptions(t,i,this._onPhotoViewerIndexChanged$1.bind(this)))};People.RecentActivity.UI.SelfPage.SelfPagePhotoItem.prototype._renderSidebar$1=function(){var r=this.object,u,t,n,i;switch(r.objectType){case People.RecentActivity.FeedObjectType.photo:this._currentSidebar$1==null&&(this._currentSidebar$1=new People.RecentActivity.UI.SelfPage.SelfPagePhotoSidebarControl(r),this._currentSidebar$1.render());break;case People.RecentActivity.FeedObjectType.photoAlbum:if(this._ensureCurrentIndex$1(),this._currentIndex$1!==-1&&this._currentItem$1!=null){if(this._currentSidebar$1!=null&&(u=this._currentSidebar$1.object,u.id===this._currentItem$1.id))return;for(t=[],n=this._initializeSidebar$1(this._currentIndex$1),n!=null&&t.push(n.object),i=1;i>0;i--)n=this._initializeSidebar$1(this._currentIndex$1-i),n!=null&&t.push(n.object),n=this._initializeSidebar$1(this._currentIndex$1+i),n!=null&&t.push(n.object);this._currentSidebar$1=this._sidebars$1[this._currentItem$1.id];this._isInitialWithState$1?this._isInitialWithState$1=false:this.selfPage.refreshObjects(t,null)}}};People.RecentActivity.UI.SelfPage.SelfPagePhotoItem.prototype._renderCurrentItem$1=function(n){var t=this._context$1.dataModel;this._ensureCurrentIndex$1();this._currentIndex$1!==-1&&this._currentIndex$1<t.getChildCount()&&(this._currentItem$1=t.getChildByIndex(null,this._currentIndex$1),n&&this._ensureSidebar$1(),this._viewer$1.render(this._currentItem$1))};People.RecentActivity.UI.SelfPage.SelfPagePhotoItem.prototype._updateCurrentItem$1=function(n){if(n!==this._currentIndex$1){var t=this._context$1.dataModel;n!==-1&&n<t.getChildCount()&&(this._currentIndex$1=n,this._currentItem$1=t.getChildByIndex(null,this._currentIndex$1))}};People.RecentActivity.UI.SelfPage.SelfPagePhotoItem.prototype._ensureSidebar$1=function(){if(this._currentSidebar$1==null&&(this._renderSidebar$1(),this._currentSidebar$1!=null))this.onPropertyChanged("Sidebar")};People.RecentActivity.UI.SelfPage.SelfPagePhotoItem.prototype._ensureCurrentIndex$1=function(){if(this._currentIndex$1===-1)if(Jx.isNonEmptyString(this._currentId$1)){var n=this._context$1.dataModel,t=n.getItem(this._currentId$1);this._currentIndex$1=t!=null?n.getIndexOfChild(null,t):0}else this._currentIndex$1=0};People.RecentActivity.UI.SelfPage.SelfPagePhotoItem.prototype._initializeSidebar$1=function(n){var u,i,t,r;return n<0?null:(u=this.object,i=u.photos,i.count>n)?(t=i.item(n),!Jx.isUndefined(this._sidebars$1[t.id])||(r=new People.RecentActivity.UI.SelfPage.SelfPagePhotoSidebarControl(t),r.render(),this._sidebars$1[t.id]=r),this._sidebars$1[t.id]):null};People.RecentActivity.UI.SelfPage.SelfPagePhotoItem.prototype._onPhotoCollectionChanged$1=function(){this._currentItem$1==null&&this._renderCurrentItem$1(true)};People.RecentActivity.UI.SelfPage.SelfPagePhotoItem.prototype._onPhotoCollectionPropertyChanged$1=function(n){if(n.propertyName==="TotalCount"){var t=n.sender;this._currentIndex$1>=t.totalCount&&(this._currentIndex$1=t.totalCount-1,this._renderCurrentItem$1(true))}};People.RecentActivity.UI.SelfPage.SelfPagePhotoItem.prototype._onPhotoViewerIndexChanged$1=function(n){var t=this;this._updateCurrentItem$1(n);this._isPropertyChangedQueued$1||(this._isPropertyChangedQueued$1=true,window.msSetImmediate(function(){if(t._isPropertyChangedQueued$1=false,!t.isDisposed)t.onPropertyChanged("Sidebar")}))};People.RecentActivity.UI.SelfPage.SelfPagePlainItem=function(n,t){People.RecentActivity.UI.SelfPage.SelfPageEntryItem.call(this,n,t);Jx.addClass(n.element,"ra-selfPagePlain")};Jx.inherit(People.RecentActivity.UI.SelfPage.SelfPagePlainItem,People.RecentActivity.UI.SelfPage.SelfPageEntryItem);People.RecentActivity.UI.SelfPage.SelfPagePlainItem.prototype._content$2=null;People.RecentActivity.UI.SelfPage.SelfPagePlainItem.prototype._name$2=null;People.RecentActivity.UI.SelfPage.SelfPagePlainItem.prototype._container$2=null;People.RecentActivity.UI.SelfPage.SelfPagePlainItem.prototype._publisher$2=null;People.RecentActivity.UI.SelfPage.SelfPagePlainItem.prototype._text$2=null;People.RecentActivity.UI.SelfPage.SelfPagePlainItem.prototype._image$2=null;People.RecentActivity.UI.SelfPage.SelfPagePlainItem.prototype._title$2=null;People.RecentActivity.UI.SelfPage.SelfPagePlainItem.prototype._caption$2=null;People.RecentActivity.UI.SelfPage.SelfPagePlainItem.prototype._description$2=null;People.RecentActivity.UI.SelfPage.SelfPagePlainItem.prototype._time$2=null;People.RecentActivity.UI.SelfPage.SelfPagePlainItem.prototype._annotations$2=null;People.RecentActivity.UI.SelfPage.SelfPagePlainItem.prototype._isUnwrapped$2=false;People.RecentActivity.UI.SelfPage.SelfPagePlainItem.prototype._isSetFocusRequested$2=false;Object.defineProperty(People.RecentActivity.UI.SelfPage.SelfPagePlainItem.prototype,"content",{get:function(){return this._renderContent$2(),this._content$2},configurable:true});Object.defineProperty(People.RecentActivity.UI.SelfPage.SelfPagePlainItem.prototype,"biciPageName",{get:function(){switch(this.entry.entryType){case People.RecentActivity.FeedEntryType.link:return People.RecentActivity.Core.BiciPageNames.selfPageLink;case People.RecentActivity.FeedEntryType.text:return People.RecentActivity.Core.BiciPageNames.selfPageText;case People.RecentActivity.FeedEntryType.video:return People.RecentActivity.Core.BiciPageNames.selfPageVideo}return People.RecentActivity.Core.BiciPageNames.none},configurable:true});Object.defineProperty(People.RecentActivity.UI.SelfPage.SelfPagePlainItem.prototype,"style",{get:function(){return 0},configurable:true});People.RecentActivity.UI.SelfPage.SelfPagePlainItem.prototype.getContentState=function(){if(this._content$2!=null){var n=this._content$2.element;return People.RecentActivity.UI.Core.create_point(n.scrollLeft,n.scrollTop)}return null};People.RecentActivity.UI.SelfPage.SelfPagePlainItem.prototype.setFocusOnContent=function(){this._container$2!=null?this._container$2.setActive():this._isSetFocusRequested$2=true};People.RecentActivity.UI.SelfPage.SelfPagePlainItem.prototype._updateContentAreaSize=function(){var n=this.selfPage.element.querySelector(".ra-selfPageContainer");n.offsetWidth/n.offsetHeight<1?(n.style["-ms-grid-rows"]="auto 1fr",setImmediate(function(){var t=n.querySelector(".ra-selfPageContent"),i=Math.min(t.scrollHeight,n.offsetHeight/2);n.style["-ms-grid-rows"]=i+"px 1fr"})):n.style["-ms-grid-rows"]="100%"};People.RecentActivity.UI.SelfPage.SelfPagePlainItem.prototype.onResized=function(){var t=People.RecentActivity.UI.SelfPage.SelfPageItem.prototype.onResized.call(this),n=this;return t.then(function(){if(!n.isDisposed)return new WinJS.Promise(function(t){setImmediate(function(){n.isDisposed||(n._applyColumnLayout$2(),n._updateContentAreaSize(),t())})})})};People.RecentActivity.UI.SelfPage.SelfPagePlainItem.prototype.onContentRendered=function(n){if(n!=null){var t=n,i=this._content$2.element;i.scrollLeft=t.left;i.scrollTop=t.top}this._updateContentAreaSize();People.RecentActivity.UI.SelfPage.SelfPageEntryItem.prototype.onContentRendered.call(this,n)};People.RecentActivity.UI.SelfPage.SelfPagePlainItem.prototype.onDisposed=function(){this._name$2!=null&&(this._name$2.dispose(),this._name$2=null);this._content$2!=null&&(this._content$2.dispose(),this._content$2=null);this._container$2!=null&&(this._container$2.dispose(),this._container$2=null);this._text$2!=null&&(this._text$2.dispose(),this._text$2=null);this._time$2!=null&&(this._time$2.dispose(),this._time$2=null);this._annotations$2!=null&&(this._annotations$2.dispose(),this._annotations$2=null);this._image$2!=null&&(this._image$2.removeListenerSafe("imagefailed",this._onImageFailed$2,this),this._image$2.removeListenerSafe("imageloaded",this._onImageLoaded$2,this),this._image$2.dispose(),this._image$2=null);this._title$2!=null&&(this._title$2.dispose(),this._title$2=null);this._caption$2!=null&&(this._caption$2.dispose(),this._caption$2=null);this._description$2!=null&&(this._description$2.dispose(),this._description$2=null);this._publisher$2!=null&&(this._publisher$2.dispose(),this._publisher$2=null);People.RecentActivity.UI.Core.TimestampUpdateTimer.unsubscribe(this._onTimerElapsed$2,this);this.network.removeListenerSafe("propertychanged",this._onNetworkPropertyChanged$2,this);People.RecentActivity.UI.SelfPage.SelfPageEntryItem.prototype.onDisposed.call(this)};People.RecentActivity.UI.SelfPage.SelfPagePlainItem.prototype._renderContent$2=function(){var n,t,r,i;this._content$2==null&&(n=People.RecentActivity.UI.Core.HtmlHelper.createElement(People.RecentActivity.UI.Core.Html.selfPagePlainContent),this._content$2=new People.RecentActivity.UI.Core.Control(n),this._name$2=People.RecentActivity.UI.Core.HtmlHelper.findOrCreateControlById(n,"item-contact-name"),t=this.entry,r=t.data,this._publisher$2=new People.RecentActivity.UI.Core.ContactControl(t.publisher.getDataContext()),i=n.children[0],i.appendChild(this._publisher$2.getElement(People.RecentActivity.UI.Core.ContactControlType.name,People.RecentActivity.Imports.create_identityElementContextOptions(t.sourceId),-1)),this._renderBaseContent$2(),this._renderPreview$2(),this._publisher$2.activate(n))};People.RecentActivity.UI.SelfPage.SelfPagePlainItem.prototype._renderBaseContent$2=function(){var i=this._content$2.element,n=People.RecentActivity.UI.Core.HtmlHelper.findElementById(i,"item-content");this._container$2=People.RecentActivity.UI.Core.Control.fromElement(n);var t=this.entry,r=t.data,u=i.children[1];u.appendChild(this._publisher$2.getElement(People.RecentActivity.UI.Core.ContactControlType.tile,People.RecentActivity.Imports.create_identityElementTileOptions(100,null)));this._text$2=new People.RecentActivity.UI.Core.FormattedTextControl(n.children[0],t.sourceId,false);this._text$2.update(r.text,t.entities);this._time$2=People.RecentActivity.UI.Core.Control.fromElement(n.children[3]);this.network.addListener("propertychanged",this._onNetworkPropertyChanged$2,this);this._updateTimeVia$2();this._annotations$2=new People.RecentActivity.UI.Core.AnnotationsControl(t,n.children[2],People.RecentActivity.UI.Core.AnnotationsControlPlacement.oneUp);this._annotations$2.render();People.RecentActivity.UI.Core.TimestampUpdateTimer.subscribe(this._onTimerElapsed$2,this);this._isSetFocusRequested$2&&(this._isSetFocusRequested$2=false,this._container$2.setActive())};People.RecentActivity.UI.SelfPage.SelfPagePlainItem.prototype._renderPreview$2=function(){var f=this.entry,s=f.entryType,i=null,r=null,u=null,e,n,o,t;switch(s){case People.RecentActivity.FeedEntryType.link:n=f.data;i=n.caption;r=n.description;u=n.title;break;case People.RecentActivity.FeedEntryType.text:e=People.RecentActivity.UI.Core.HtmlHelper.findElementById(this._content$2.element,"item-preview");e.style.display="none";return;case People.RecentActivity.FeedEntryType.video:n=f.data;i=n.caption;r=n.description;u=n.title}this._renderPreviewImage$2();o=this._container$2.element;t=o.children[1];t.style.opacity="1";this._caption$2=People.RecentActivity.UI.Core.HtmlHelper.findOrCreateControlById(t,"item-caption");this._caption$2.isVisible=Jx.isNonEmptyString(i);this._caption$2.isHiddenFromScreenReader=true;this._caption$2.text=i;this._description$2=People.RecentActivity.UI.Core.HtmlHelper.findOrCreateControlById(t,"item-description");this._description$2.isVisible=Jx.isNonEmptyString(r);this._description$2.isHiddenFromScreenReader=true;this._description$2.text=r;this._title$2=People.RecentActivity.UI.Core.HtmlHelper.findOrCreateControlById(t,"item-title");this._title$2.attach("click",this._onTitleClicked$2.bind(this));this._title$2.attach("keydown",this._onTitleKeyDown$2.bind(this));this._title$2.isVisible=Jx.isNonEmptyString(u);this._title$2.text=u};People.RecentActivity.UI.SelfPage.SelfPagePlainItem.prototype._renderPreviewImage$2=function(){var n=this._getTileUrl$2();this._image$2=new People.RecentActivity.UI.Core.ImageControl(People.RecentActivity.UI.Core.HtmlHelper.findElementById(this._content$2.element,"item-image"));this._image$2.isDelayed=true;this._image$2.isOneByOneError=true;this._image$2.isVisible=Jx.isNonEmptyString(n);this._image$2.isHiddenFromScreenReader=true;Jx.isNonEmptyString(n)?(this._image$2.addListener("imagefailed",this._onImageFailed$2,this),this._image$2.addListener("imageloaded",this._onImageLoaded$2,this),this._image$2.source=n):this._content$2.addClass("ra-selfPagePlainItemNoImage")};People.RecentActivity.UI.SelfPage.SelfPagePlainItem.prototype._updateTimeVia$2=function(){var i=this.entry.timestamp,n=People.RecentActivity.UI.Core.LocalizationHelper.getTimeString(i),t=this.network.name;Jx.isNonEmptyString(t)&&(n=Jx.res.loadCompoundString("/strings/raItemVia",n,t));this._time$2.text=n};People.RecentActivity.UI.SelfPage.SelfPagePlainItem.prototype._getTileUrl$2=function(){var f=this.entry,t=null,i=null,e=null,n,r,s,u,h,o;switch(f.entryType){case People.RecentActivity.FeedEntryType.link:n=f.data;t=People.RecentActivity.Configuration.linkUrlTransforms;e=n.tile;i=[n.tile];break;case People.RecentActivity.FeedEntryType.video:n=f.data;t=People.RecentActivity.Configuration.videoUrlTransforms;e=n.tile;i=[n.displayUrl,n.sourceUrl]}for(r=0,s=i.length;r<s;r++)for(u=0,h=t.length;u<h;u++)if(o=t[u].createPreviewUrl(i[r]),Jx.isNonEmptyString(o))return this._isUnwrapped$2=true,o;return e};People.RecentActivity.UI.SelfPage.SelfPagePlainItem.prototype._applyColumnLayout$2=function(){var n=People.RecentActivity.UI.Core.HtmlHelper.findElementById(this._content$2.element,"item-preview");this._image$2&&this._image$2.element.naturalWidth>=n.clientWidth/2?this._content$2.removeClass("ra-selfPagePlainItemColumns"):this._content$2.addClass("ra-selfPagePlainItemColumns")};People.RecentActivity.UI.SelfPage.SelfPagePlainItem.prototype._launchUri$2=function(){var n=this.entry,i=n.entryType,t=null;switch(i){case People.RecentActivity.FeedEntryType.link:t=n.data.url;break;case People.RecentActivity.FeedEntryType.video:t=n.data.displayUrl}People.RecentActivity.UI.Core.UriHelper.launchUri(t)};People.RecentActivity.UI.SelfPage.SelfPagePlainItem.prototype._onTimerElapsed$2=function(){this._updateTimeVia$2()};People.RecentActivity.UI.SelfPage.SelfPagePlainItem.prototype._onImageFailed$2=function(){if(this._isUnwrapped$2){this._isUnwrapped$2=false;var n=this.entry;switch(n.entryType){case People.RecentActivity.FeedEntryType.link:this._image$2.source=n.data.tile;break;case People.RecentActivity.FeedEntryType.video:this._image$2.source=n.data.tile}}else People.RecentActivity.Core.EtwHelper.writeUnofficialEvent(People.RecentActivity.Core.EtwEventName.unofficialUILoadLinkTileStop),this._image$2.removeListenerSafe("imagefailed",this._onImageFailed$2,this),this._image$2.removeListenerSafe("imageloaded",this._onImageLoaded$2,this),this._image$2.isVisible=false,this._content$2.addClass("ra-selfPagePlainItemNoImage")};People.RecentActivity.UI.SelfPage.SelfPagePlainItem.prototype._onImageLoaded$2=function(){People.RecentActivity.Core.EtwHelper.writeUnofficialEvent(People.RecentActivity.Core.EtwEventName.unofficialUILoadLinkTileStop);this._image$2.removeListenerSafe("imagefailed",this._onImageFailed$2,this);this._image$2.removeListenerSafe("imageloaded",this._onImageLoaded$2,this);this._applyColumnLayout$2()};People.RecentActivity.UI.SelfPage.SelfPagePlainItem.prototype._onTitleClicked$2=function(){this._launchUri$2()};People.RecentActivity.UI.SelfPage.SelfPagePlainItem.prototype._onTitleKeyDown$2=function(n){switch(n.keyCode){case WinJS.Utilities.Key.enter:case WinJS.Utilities.Key.space:this._launchUri$2()}};People.RecentActivity.UI.SelfPage.SelfPagePlainItem.prototype._onNetworkPropertyChanged$2=function(n){n.propertyName==="Name"&&this._updateTimeVia$2()};People.RecentActivity.UI.SelfPage.SelfPageVideoItem=function(n,t){People.RecentActivity.UI.SelfPage.SelfPageEntryItem.call(this,n,t)};Jx.inherit(People.RecentActivity.UI.SelfPage.SelfPageVideoItem,People.RecentActivity.UI.SelfPage.SelfPageEntryItem);People.RecentActivity.UI.SelfPage.SelfPageVideoItem.isSupported=function(n){var i,t,r,u;if(n.objectType!==People.RecentActivity.FeedObjectType.entry||(i=n,i.entryType!==People.RecentActivity.FeedEntryType.video))return false;if(t=i.data,t.sourceType===People.RecentActivity.FeedEntryVideoType.raw)try{return r=document.createElement("video"),r.autoplay=true,r.controls=true,true}catch(f){return false}return u=People.RecentActivity.UI.SelfPage.SelfPageVideoItem._getEmbeddedPlayerUrl$2([t.displayUrl,t.sourceUrl]),u!=null};People.RecentActivity.UI.SelfPage.SelfPageVideoItem._getEmbeddedPlayerUrl$2=function(n){for(var u=People.RecentActivity.Configuration.videoUrlTransforms,i,e,r,t=0,f=n.length;t<f;t++)for(i=0,e=u.length;i<e;i++)if(r=u[i].createEmbedUrl(n[t]),Jx.isNonEmptyString(r))return r;return null};People.RecentActivity.UI.SelfPage.SelfPageVideoItem.prototype._content$2=null;People.RecentActivity.UI.SelfPage.SelfPageVideoItem.prototype._isHtml5Player$2=false;People.RecentActivity.UI.SelfPage.SelfPageVideoItem.prototype._state$2=null;Object.defineProperty(People.RecentActivity.UI.SelfPage.SelfPageVideoItem.prototype,"content",{get:function(){return this._renderContent$2(),this._content$2},configurable:true});Object.defineProperty(People.RecentActivity.UI.SelfPage.SelfPageVideoItem.prototype,"biciPageName",{get:function(){return People.RecentActivity.Core.BiciPageNames.selfPageVideo},configurable:true});People.RecentActivity.UI.SelfPage.SelfPageVideoItem.prototype.getContentState=function(){if(this._isHtml5Player$2){var n=this._content$2.element;return People.RecentActivity.UI.SelfPage.create_selfPageVideoItemHydrationData(n.paused,n.ended,n.currentTime)}return null};People.RecentActivity.UI.SelfPage.SelfPageVideoItem.prototype.setFocusOnContent=function(){this._content$2!=null&&this._content$2.setActive()};People.RecentActivity.UI.SelfPage.SelfPageVideoItem.prototype.onContentRendered=function(n){this._isHtml5Player$2&&(this._state$2=n,this._content$2.attach("loadedmetadata",this._onVideoMetadataLoaded$2.bind(this)));People.RecentActivity.UI.SelfPage.SelfPageEntryItem.prototype.onContentRendered.call(this,n)};People.RecentActivity.UI.SelfPage.SelfPageVideoItem.prototype.onDisposed=function(){var n;this._content$2!=null&&(this._isHtml5Player$2?(n=this._content$2.element,n!=null&&n.pause()):(n=this._content$2.element,n!=null&&(n.src="about:blank")),this._content$2.dispose(),this._content$2=null);People.RecentActivity.UI.SelfPage.SelfPageEntryItem.prototype.onDisposed.call(this)};People.RecentActivity.UI.SelfPage.SelfPageVideoItem.prototype._renderContent$2=function(){var n,t,r,i;this._content$2==null&&(People.RecentActivity.UI.Core.GlobalProgressControl.add(this),n=this.entry.data,n.sourceType===People.RecentActivity.FeedEntryVideoType.raw?(this._isHtml5Player$2=true,t=document.createElement("video"),t.autoplay=true,t.controls=true,t.className="ra-selfPageVideoPlayer",t.src=n.sourceUrl,this._content$2=new People.RecentActivity.UI.Core.Control(t),this._content$2.attach("play",this._onLoaded$2.bind(this))):(r=People.RecentActivity.UI.SelfPage.SelfPageVideoItem._getEmbeddedPlayerUrl$2([n.displayUrl,n.sourceUrl]),i=document.createElement("x-ms-webview"),i.className="ra-selfPageVideoFrame",r==null?i.src=n.displayUrl:(i.setAttribute("allowfullscreen","allowfullscreen"),i.src=r),this._content$2=new People.RecentActivity.UI.Core.Control(i),this._content$2.attach("MSWebViewNavigationCompleted",this._onLoaded$2.bind(this))))};People.RecentActivity.UI.SelfPage.SelfPageVideoItem.prototype._onVideoMetadataLoaded$2=function(){if(this._state$2!=null){var n=this._content$2.element;n.autoplay=!this._state$2.p&&!this._state$2.s;n.currentTime=this._state$2.o}};People.RecentActivity.UI.SelfPage.SelfPageVideoItem.prototype._onLoaded$2=function(){People.RecentActivity.UI.Core.GlobalProgressControl.remove(this)};People.RecentActivity.UI.SelfPage.SelfPageRefresherState=function(n,t){this.object=n;this.refresher=t};People.RecentActivity.UI.SelfPage.SelfPageRefresherState.prototype.object=null;People.RecentActivity.UI.SelfPage.SelfPageRefresherState.prototype.refresher=null;People.RecentActivity.UI.SelfPage.SelfPageRefresher=function(n){this._errors=new People.RecentActivity.UI.Core.ErrorMessageControl(n,People.RecentActivity.UI.Core.ErrorMessageContext.none,People.RecentActivity.UI.Core.ErrorMessageOperation.read);this._errors.addClass("ra-selfPageBar");this._errors.location=People.RecentActivity.UI.Core.ErrorMessageLocation.messageBar;this._objects={};this._userstates={}};Jx.mix(People.RecentActivity.UI.SelfPage.SelfPageRefresher.prototype,Jx.Events);Jx.mix(People.RecentActivity.UI.SelfPage.SelfPageRefresher.prototype,People.Social.Events);People.RecentActivity.UI.SelfPage.SelfPageRefresher.prototype._objects=null;People.RecentActivity.UI.SelfPage.SelfPageRefresher.prototype._userstates=null;People.RecentActivity.UI.SelfPage.SelfPageRefresher.prototype._errors=null;People.RecentActivity.UI.SelfPage.SelfPageRefresher.prototype.dispose=function(){var r,n,t,u,i;this._errors.dispose();for(r in this._objects){for(n=this._objects[r],t=0,u=n.length;t<u;t++)i=n[t],i.refresher.removeListenerSafe("refreshcompleted",this._onRefreshCompleted,this),People.RecentActivity.UI.Core.GlobalProgressControl.remove(i);n.length=0}People.Social.clearKeys(this._objects);People.Social.clearKeys(this._userstates)};People.RecentActivity.UI.SelfPage.SelfPageRefresher.prototype.refresh=function(n,t){var i=this._getStateId(n);if(Jx.isUndefined(this._objects[i])){switch(n.objectType){case People.RecentActivity.FeedObjectType.photo:this._refreshObject(n,n,t);break;case People.RecentActivity.FeedObjectType.photoAlbum:n.isFakeAlbum||this._refreshObject(n,n,t);break;case People.RecentActivity.FeedObjectType.entry:switch(n.entryType){case People.RecentActivity.FeedEntryType.photo:this.refresh(entry.data.photo,t);break;case People.RecentActivity.FeedEntryType.photoAlbum:this.refresh(entry.data.album,t)}}this._refreshObject(n,n.comments,t);this._refreshObject(n,n.reactions,t)}};People.RecentActivity.UI.SelfPage.SelfPageRefresher.prototype._getStateId=function(n){return n.objectType===People.RecentActivity.FeedObjectType.photoAlbum?n.albumId:n.id};People.RecentActivity.UI.SelfPage.SelfPageRefresher.prototype._refreshObject=function(n,t,i){var r,u,f;r=this._getStateId(n);this._userstates[r]=i;Jx.isUndefined(this._objects[r])&&(this._objects[r]=[]);u=new People.RecentActivity.UI.SelfPage.SelfPageRefresherState(n,t);f=this._objects[r];f.push(u);People.RecentActivity.UI.Core.GlobalProgressControl.add(u);t.addListener("refreshcompleted",this._onRefreshCompleted,this);t.refresh(u)};People.RecentActivity.UI.SelfPage.SelfPageRefresher.prototype._onRefreshCompleted=function(n){var t,i,r,u,f,e;t=n.userState;t==null||Jx.isNullOrUndefined(t.object)||Jx.isNullOrUndefined(t.refresher)||(t.refresher.removeListenerSafe("refreshcompleted",this._onRefreshCompleted,this),People.RecentActivity.UI.Core.GlobalProgressControl.remove(t),i=this._getStateId(t.object),r=this._objects[i],r!==null&&(u=r.indexOf(t),u!==-1&&(r.splice(u,1),r.length||(delete this._objects[i],f=n.result,f.code!==People.RecentActivity.Core.ResultCode.success&&this._errors.show(n.result),e=this._userstates[i],delete this._userstates[i],this.raiseEvent("refreshcompleted",new People.RecentActivity.FeedObjectActionCompletedEventArgs(this,f,t.object,e))))))}})