(function(){var b=WindowsLive.Photo.Viewer.Commanding,d=PhotoViewer.AppBar.Commands;PhotoViewer.NavStack=function(a,c){this._site=a;this._siteNavId=a.getNavId();this._alwaysShowBackButton=c;this._backStack=[];this._queuedNavigateBackCommands=0;this._suspendCount=0;this._navigating=false;this._navigateBackCommandHandler=this._navigateBackCommandHandler.bind(this);a.addCommand(d.navigateBack,c?b.CommandEnableProperties.none:b.CommandEnableProperties.backStackExists,b.CommandEnableProperties.none,b.CommandEnableProperties.viewIsSlideshow,b.ExpectedActionableItems.none,true,this._navigateBackCommandHandler)};var e=PhotoViewer.NavStack,a=e.prototype,c="siteOnly";a.takeNavSnapshot=function(){return this._getComponentTreeEntry(this._site)};a.recordEntry=function(a){var b=a||this.takeNavSnapshot();this._addEntryToBackStack(b)};a.discardLastEntry=function(){var a=this._backStack;if(a.length>0){a.pop();a.length===0&&this._onEmptyStateChanged(true);return true}return false};a.saveStates=function(d,i,g,j){var e,h=20,a=this._backStack,c=a.length;if(j)e=this._getComponentTreeEntry(this._site);else e=a.pop();d.setObject(i,e);if(c>0){var b;if(c>h){b=[a[0]];for(var f=c-h+1;f<c;f++)b.push(a[f])}else b=a;d.setObjectInSegments(g,b)}else d.remove(g)};a.loadStates=function(e,f,h,g){var a,b=e.getObjectInSegments(h),i=this._backStack;if(Boolean(b))for(var d=0,j=b.length;d<j;d++)this._addEntryToBackStack(b[d]);var c=e.getObject(f);if(c)if(g)a=this._restoreComponentTreeState(this._site,c,null);else this._addEntryToBackStack(c);i.length>0&&this._onEmptyStateChanged(false);if(!a)a=WinJS.Promise.wrap(false);return a};a.prepareForRootView=function(c,d){var a,b=this._site;if(b.hasUI())a=this._getComponentTreeEntry(b);else{if(c)a=c.getObject(d);b.forEachChild(function(a){a.clearNavState&&a.clearNavState()},this)}a&&this._addEntryToBackStack(a)};a.removeTemporaryEntries=function(){for(var g=this._site,e=this._siteNavId,b=this._backStack,a=b.length-1;a>=0;a--){var d=b[a],f=d[e];(d[c]||g.isNavStateTemporary(f))&&b.splice(a,1)}};a.ensureLastEntryIsRoot=function(){var e=this._site,d=this._siteNavId,a={};a[d]=e.getRootNavState();a[c]=true;var b=this._backStack;(b.length===0||!e.areNavStatesEquivalent(a[d],b[b.length-1][d]))&&this._addEntryToBackStack(a)};a.suspendNavigations=function(a){this._suspendCount+=a?1:-1;this._suspendCount===0&&this._processQueuedNavigations()};Object.defineProperty(a,"empty",{"get":function(){return this._backStack.length===0}});Object.defineProperty(a,"navigating",{"get":function(){return this._navigating}});a._processQueuedNavigations=function(){if(this._suspendCount===0&&this._queuedNavigateBackCommands>0){var a=this;this._queuedNavigateBackCommands--;window.msSetImmediate(function(){a._navigateBackCommandHandler()})}};a._addEntryToBackStack=function(c){if(c[this._siteNavId]){var b=this._backStack,a=b.length;b[a]=c;a===0&&this._onEmptyStateChanged(false)}};a._navigateBackCommandHandler=function(){if(this._suspendCount>0){this._queuedNavigateBackCommands++;return}var a=this._backStack,e=a.pop(),b=this._site,c=this;if(e){var f=b.mode;this._navigating=true;var d=function(e){return c._restoreComponentTreeState(b,e,f).then(function(b){if(b)return WinJS.Promise.wrap(true);else{e=a.pop();return d(e)}})};d(e).then(function(){c._navigating=false;c._processQueuedNavigations()})}else this._alwaysShowBackButton&&b.shutdown();a.length===0&&this._onEmptyStateChanged(true);return null};a._getComponentTreeEntry=function(d){var b={},c=false,a=this._getComponentStateAndId(d);if(a){b[a.id]=a.state;c=true}d.forEachChild(function(e){var a=this._getComponentTreeEntry(e);if(a)for(var d in a){b[d]=a[d];c=true}},this);return c?b:null};a._getComponentStateAndId=function(a){var b;if(a.getNavState)b=a.getNavState();return b?{id:a.getNavId(),state:b}:null};a._restoreComponentTreeState=function(a,e,g){var b=[];if(a.getNavId){var l=a.getNavId(),i=e[l];if(Boolean(i)||Boolean(e[c])){var d,h=false,j=a.setNavState(i,g).then(function(a){d=a;h=true;return d});if(h&&!d)return WinJS.Promise.wrap(false);b.push(j)}}for(var f=0,k=a.getChildrenCount();f<k;f++)b.push(this._restoreComponentTreeState(a.getChild(f),e,g));return WinJS.Promise.join(b).then(function(b){for(var a=true,d=b?b.length:0,c=0;a&&c<d;c++)a=a&&b[c];return a})};a._onEmptyStateChanged=function(a){this._site.setCommandPropertyState(b.CommandEnableProperties.backStackExists,!a)}})();(function(){var e=PhotoViewer.ViewHelpers,d=PhotoViewer.DataHubHelpers,c=Windows.ApplicationModel.Activation.ApplicationExecutionState;PhotoViewer.AppStateSavingManager=function(b,d){this._site=b;this._dataHub=d;this._filePickerMode=PhotoViewer.Coordinator.filePickerMode;this._appStateStorageIds={stateStack:"stateStack",currentState:"currentState",hasSelection:"hasSelection",lastSuspendTime:"lastSuspendTime",userId:"userId",selectionContainer:"selectionContainer",currentModeOnSuspend:"currentModeOnSuspend",currentlyDeleting:"currentlyDeleting"};var a=PhotoViewer.Coordinator.Mode;this._allowedModes=[a.oneUp,a.openWith,a.slideshow,a.megastrip,a.puzzle,a.importView,a.multiUpSlideshow];var c=b.applicationSettings;this._appStateContainer=c.localAppStateContainer};var b=PhotoViewer.AppStateSavingManager,a=b.prototype;b.returnToRootThreshold=864e5;a.onOnlineIdConnectedStateChange=function(){this._applyFreshStartIfUserHasChanged()};a.onSuspend=function(){PhotoViewer.log.perf("evPhotoViewer_AppStateSaving_Suspend_start",{emptyValue:true});this._appStateContainer.set(this._appStateStorageIds.currentlyDeleting,this.currentlyDeleting);this._dataHub.applicationSuspend();var a=this._site,c=this._allowedModes.indexOf(a.mode)>=0;a.navStack.saveStates(this._appStateContainer,this._appStateStorageIds.currentState,this._appStateStorageIds.stateStack,c);if(!this._filePickerMode){var b=this._dataHub.selection.size>0;this._appStateContainer.set(this._appStateStorageIds.hasSelection,b);if(b)try{this._dataHub.selection.writeTo(this._appStateContainer.container(this._appStateStorageIds.selectionContainer)._adc.values)}catch(d){this._appStateContainer.deleteContainer(this._appStateStorageIds.selectionContainer);PhotoViewer.log.error("AppStateSavingManager: Error thrown while suspending and writing out selection: "+String(d))}else this._appStateContainer.deleteContainer(this._appStateStorageIds.selectionContainer);this._appStateContainer.set(this._appStateStorageIds.currentModeOnSuspend,a.mode);this._appStateContainer.set(this._appStateStorageIds.lastSuspendTime,+new Date)}PhotoViewer.log.perf("evPhotoViewer_AppStateSaving_Suspend_end",{emptyValue:true})};a.onResume=function(a){PhotoViewer.log.perf("evPhotoViewer_AppStateSaving_Resume_start",{emptyValue:true});this._dataHub.applicationResume();if(Boolean(a)&&a.forceRootView||this._isGoToRootViewNeeded())this._returnToRootView();else this._showDeleteSuspendedDialog();this._applyFreshStartIfUserHasChanged();PhotoViewer.log.perf("evPhotoViewer_AppStateSaving_Resume_end",{emptyValue:true})};a.onActivated=function(f,d){PhotoViewer.log.perf("evPhotoViewer_AppStateSaving_Activate_start",{emptyValue:true});var e=this._site,g=e.navStack,b,c=false;this._dataHub.applicationResume();if(this._isFreshStartNeeded(f.previousExecutionState))this._applyFreshStart();else{try{b=this.loadState(true)}catch(h){b=WinJS.Promise.wrap(false);PhotoViewer.log.error("AppStateSavingManager: Error thrown while rehydrating: "+String(h))}var a=this;b.then(function(b){c=!b;a._loadSelection();if(c||Boolean(d)&&d.forceRootView||a._isGoToRootViewNeeded())a._returnToRootView();else a._showDeleteSuspendedDialog();PhotoViewer.log.perf("evPhotoViewer_AppStateSaving_Activate_end",{emptyValue:true})})}this._applyFreshStartIfUserHasChanged()};a.loadState=function(a){return this._site.navStack.loadStates(this._appStateContainer,this._appStateStorageIds.currentState,this._appStateStorageIds.stateStack,a)};a._returnToRootView=function(){var a=this._site;if(this._filePickerMode)this._applyFreshStart();else if(!d.isRootContainer(this._dataHub.contentContainer)){a.navStack.prepareForRootView(this._appStateContainer,this._appStateStorageIds.currentState);a.returnToRootView()}};a._applyFreshStart=function(){var b=this._site,c=b.navStack,a=false;do a=c.discardLastEntry();while(a);this._dataHub.selection.clear();!d.isRootContainer(this._dataHub.contentContainer)&&b.returnToRootView()};a._isFreshStartNeeded=function(a){if(a===c.notRunning||a===c.closedByUser){Jx.log.info("AppStateSavingManager: Applying fresh start -- previous application state: "+String(a));return true}return false};a._isGoToRootViewNeeded=function(){PhotoViewer.log.perf("evPhotoViewer_AppStateSaving_FreshStartCheck_start",{emptyValue:true});var a=false;if(!this._filePickerMode)if(!this._workInProgress()){var c=this._appStateContainer.get(this._appStateStorageIds.lastSuspendTime),d=+new Date;if(Boolean(c)&&d-c>b.returnToRootThreshold){Jx.log.info("AppStateSavingManager: Applying root view -- no selection and last suspend > 24hrs");a=true}}if(!this._dataHub.contentContainer){Jx.log.info("AppStateSavingManager: Applying root view -- contentContainer has not been set");a=true}PhotoViewer.log.perf("evPhotoViewer_AppStateSaving_FreshStartCheck_end",{emptyValue:true});return a};a._workInProgress=function(){var c=this._appStateContainer.get(this._appStateStorageIds.hasSelection);if(c){Jx.log.info("AppStateSavingManager: Work is in progress -- has selection");return true}var a=this._appStateContainer.get(this._appStateStorageIds.currentModeOnSuspend);if(a===PhotoViewer.Coordinator.Mode.importView){Jx.log.info("AppStateSavingManager: Work is in progress -- importing");return true}var b=this._appStateContainer.get(this._appStateStorageIds.currentlyDeleting);if(b){Jx.log.info("AppStateSavingManager: Work is in progress -- deleting");return true}return false};a._applyFreshStartIfUserHasChanged=function(){try{var a=this,b=a._appStateContainer.get(a._appStateStorageIds.userId);e.getUserInfoAsync(Windows.Security.Authentication.OnlineId.CredentialPromptType.doNotPrompt).then(function(d){var c=d.id;if(Boolean(b||c)&&b!==c){Jx.log.info("AppStateSavingManager: Applying fresh start -- User has changed");a._appStateContainer.set(a._appStateStorageIds.userId,d.id);a._applyFreshStart()}},function(c){if(c.number!==-2147023579){Jx.log.error("AppStateSavingManager: Error while checking if user changed: "+String(c));a._applyFreshStart()}else if(Boolean(b)){Jx.log.info("AppStateSavingManager: Applying fresh start -- User has been removed");a._appStateContainer.remove(a._appStateStorageIds.userId);a._applyFreshStart()}})}catch(c){}};a._loadSelection=function(){try{this._appStateContainer.get(this._appStateStorageIds.hasSelection)&&this._dataHub.selection.readFrom(this._appStateContainer.getContainer(this._appStateStorageIds.selectionContainer)._adc.values)}catch(a){}};a._showDeleteSuspendedDialog=function(){if(this._appStateContainer.get(this._appStateStorageIds.currentlyDeleting)){try{new Windows.UI.Popups.MessageDialog(Jx.res.getString("resid-delete-SuspendedBody"),Jx.res.getString("resid-delete-SuspendedTitle")).showAsync().done()}catch(a){}this._appStateContainer.set(this._appStateStorageIds.currentlyDeleting,false);this.currentlyDeleting=false}};a.currentlyDeleting=false;a._appStateStorageIds=null;a._appStateContainer=null})();(function(){var k="coordinator-collections",q="coordinator-oneUp",o="coordinator-playTo",l="coordinator-backButton",m="coordinator-appBar",p="coordinator-status",n="coordinator-import",r="coordinator-print",i="coordinator-multiUpSlideshow",j="viewerFrame-coordinator",e=PhotoViewer.AnimationHelpers,c=WindowsLive.Photo.Viewer.Commanding,d=PhotoViewer.AppBar.Commands,h=PhotoViewer.DataHubHelpers;PhotoViewer.Coordinator=function(f,d,b,e,a){PhotoViewer.log.perf("evPhotoViewer_Coordinator_Construction_Start",{emptyValue:true});this._frame=f;this._windowsUISettings=new Windows.UI.ViewManagement.UISettings;this._postApplicationLaunchWorkItems=[];this._disableInputHandlers=[];this._switchModeCommandHandler=this._switchModeCommandHandler.bind(this);this._importCommandHandler=this._importCommandHandler.bind(this);this._keyUp=this._keyUp.bind(this);this._keyDown=this._keyDown.bind(this);this._ongoingAnimationRefCountedPromise=new PhotoViewer.ViewHelpers.RefCountedPromise;this._dataHub=b;this._plateauScaleManager=new PhotoViewer.PlateauScaleManager;this._displayStateManager=new PhotoViewer.DisplayStateManager(b,this._plateauScaleManager);this._imgCache=new PhotoViewer.ImgCache(b,this._displayStateManager);this._appId=e;this._initializeCommanding();var c=PhotoViewer.Coordinator.Mode.megastrip;if(a){if(a.mode)c=a.mode;this._alwaysShowBackButton=Boolean(a.backButtonCloses);this._disableSelection=Boolean(a.disableSelection)}this._setMode(c,null,null).done();this._photoViewerComponent=[];this.initComponent();d.appendChild(this);PhotoViewer.log.perf("evPhotoViewer_Coordinator_Construction_End",{emptyValue:true})};Jx.augment(PhotoViewer.Coordinator,Jx.Component);var b=PhotoViewer.Coordinator,a=b.prototype;b.Mode={none:"none",megastrip:"megastrip",puzzle:"puzzle",oneUp:"oneUp",openWith:"openWith",slideshow:"slideshow",playTo:"playTo",importView:"importView",multiUpSlideshow:"multiUpSlideshow"};b.Events={shutdown:"shutdown"};b.filePickerMode=false;b.runDirectionalScaleAnimation=false;a.deactivateUI=function(){this._setModeSync(b.Mode.none);if(this._deleteFlyoutControl){this._deleteFlyoutControl.deactivateUI();this._deleteFlyoutControl=null}window.removeEventListener("keyup",this._keyUp,false);window.removeEventListener("keydown",this._keyDown,false);Jx.Component.prototype.deactivateUI.call(this)};a.shutdownComponent=function(){Jx.EventManager.fire(this,b.Events.shutdown);var a=this.getParent();a&&a.removeChild(this);this._photoViewerComponent.length>0&&this._photoViewerComponent.forEach(function(a){if(Boolean(a.deactivate)){a.deactivate();a=null}});this._dataHub=null;this._imgCache.clearCache();if(this._fileOpenPickerExtension){this._fileOpenPickerExtension.shutdown();this._fileOpenPickerExtension=null}this._displayStateManager.shutdown();this._displayStateManager=null;this._plateauScaleManager.shutdown();this._plateauScaleManager=null;PhotoViewer.log=null;Jx.Component.prototype.shutdownComponent.call(this)};a.getUI=function(a){PhotoViewer.log.perf("evPhotoViewer_Coordinator_GetUI_Start",{emptyValue:true});var c=this._getActiveComponents(true),b=[];a.html+='<div id="'+this._id+'">';a.html+='<div class="viewerFrame-print">';a.html+='<div id="'+r+'">';a.html+="</div>";a.html+="</div>";a.html+='<div class="'+j+'">';a.html+='<div id="'+l+'">';this._getUIForComponent("_backButtonComponent",c,a,b);a.html+="</div>";a.html+='<div id="'+p+'">';this._statusComponent&&this._getUIForComponent("_statusComponent",c,a,b);a.html+="</div>";a.html+='<div id="'+k+'">';this._getUIForComponent("_collectionsComponent",c,a,b);a.html+="</div>";a.html+='<div id="'+q+'">';this._getUIForComponent("_oneUpComponent",c,a,b);a.html+="</div>";a.html+='<div id="'+o+'">';this._getUIForComponent("_playToComponent",c,a,b);a.html+="</div>";a.html+='<div id="'+n+'">';this._getUIForComponent("_importComponent",c,a,b);a.html+="</div>";a.html+='<div id="'+i+'">';this._getUIForComponent("_multiUpSlideshowComponent",c,a,b);a.html+="</div>";a.html+='<div id="'+m+'">';this._getUIForComponent("_appBarComponent",c,a,b);a.html+="</div>";a.html+="</div>";a.html+="</div>";b.forEach(function(c){for(var b in c)if(b!=="html")a[b]+=c[b]});PhotoViewer.log.perf("evPhotoViewer_Coordinator_GetUI_End",{emptyValue:true})};a.activateUI=function(){PhotoViewer.log.perf("evPhotoViewer_Coordinator_ActivateUI_Start",{emptyValue:true});var a=this._getActiveComponents(false),h=a.length,c,f=this.disableAnimations;if(!f)for(c=0;c<h;c++)this._getWrapperElementForComponent(a[c]).style.visibility="hidden";Jx.Component.prototype.activateUI.call(this);var e=this._mode;this._informCommandingOfModeSwitch(e);var d=this._getCompleteModeSwitch(e,[],a);if(!f&&a.length!==0)this._animateModeSwitch(a,[],e,b.Mode.none).done(d,d);else d();if(b.filePickerMode){var g=document.querySelector("#"+this._id+" > ."+j);Jx.addClass(g,"filePickerMode")}this._callApplicationLaunched(false);window.addEventListener("keyup",this._keyUp,false);window.addEventListener("keydown",this._keyDown,false);PhotoViewer.log.perf("evPhotoViewer_Coordinator_ActivateUI_End",{emptyValue:true})};a.shutdown=function(){this.shutdownUI();return this.shutdownComponent()};a.handlePlayTo=function(b){if(this.isCommandEnabled(d.launchPlayTo)){this._ensurePlayToLoaded();var a=[];this._getComponent(true,"_playToComponent",PhotoViewer.PlayToComponent,a);var c=a[0];c.handlePlayTo(b)}};a.initSettingsPane=function(a){this._ensureSettingsCreated();this._settingsComponent.populateSettings(a)};a.handleSearch=function(e){if(this._mode===b.Mode.importView&&Boolean(this._importComponent)&&this._importComponent.isImportInProgress())return;if(this._userInputDisabledCount===0){var a;if(!this._dataHub.contentContainer.searchQuery)a=this._takeNavSnapshot(b.Mode.puzzle);var c=this._getSearchContainer();c.searchQuery=e;var d=this;if(this._mode!==b.Mode.puzzle&&this._mode!==b.Mode.megastrip)try{this._switchToSearchInProgress=true;this._dataHub.contentContainer=c;this._setMode(b.Mode.puzzle,null,{suspendNavigations:true}).done(function(){a&&d.navStack.recordEntry(a)})}finally{this._switchToSearchInProgress=false}else{a&&this.navStack.recordEntry(a);this._collectionsComponent.activateMode(PhotoViewer.Collections.SupportedModes.filteredObjectsPuzzle,c)}c.getProperties(["assetCount"],function(f,e){if(d._mode===b.Mode.none){Jx.log.warning("handleSearch_propertiesAvailable async callback after coordinator was shut down");return}var c=h.tryLookupPropertyInMap(e,"assetCount"),a=parseInt(c,10);Jx.isValidNumber(a)&&a===0&&Jx.bici.increment(Microsoft.WindowsLive.Instrumentation.Ids.Photo.searchZeroResults,1);Jx.bici.increment(Microsoft.WindowsLive.Instrumentation.Ids.Photo.searchSomeResults,1)})}};a.handleSearchPaneVisibilityChanged=function(a){var e=this;if(a.visible){var c=this._mode===b.Mode.importView&&Boolean(this._importComponent)&&this._importComponent.isImportInProgress();if(!c){var d=this._getSearchContainer();d.getProperties(["sourceTitle"],function(g,c){if(e._mode===b.Mode.none){Jx.log.warning("handleSearchPaneVisibilityChanged_propertiesAvailable async callback after coordinator was shut down");return}var f=PhotoViewer.DataHubHelpers.tryLookupPropertyInMap(c,"sourceTitle"),d=a.target;d.placeholderText=Jx.res.loadCompoundString("resid-search-placeholderTextFormat",f)})}}};a.handleShare=function(a){PhotoViewer.log.perf("evPhotoViewer_ShareDataPackageCreation_begin",{emptyValue:true});if(this._mode===b.Mode.importView)a.request.failWithDisplayText(Jx.res.getString("resid-import-shareError"));else if(this._mode===b.Mode.multiUpSlideshow)a.request.failWithDisplayText(Jx.res.getString("resid-multiUpSlideshow-NoShareAllowedError"));else{if(b.Mode.slideshow===this._mode)this._oneUpComponent&&this._oneUpComponent.slideshowDisablingCharmInvoked();if(this._appStateSavingManager.currentlyDeleting)a.request.failWithDisplayText(Jx.res.getString("resid-share-DeletingError"));else this.doCommand("Share",c.CommandSurface.charmsBar,null,a)}PhotoViewer.log.perf("evPhotoViewer_ShareDataPackageCreation_end",{emptyValue:true})};a.handlePrint=function(a){this._ensurePrintManagerCreated();this.isCommandEnabled(d.print)&&this._printManager.initializePrintTask(a)};a.launchImport=function(e,f,c){if(this._mode!==b.Mode.importView){var a=!this.hasUI();if(a){this._ensureAppSettingsContainers(this._appId);this._appStateSavingManager.loadState(false)}this._switchModeCommandHandler(d.launchImport,null,{deviceFolder:e,deviceId:f},true);!c&&this.navStack.ensureLastEntryIsRoot();return a}return false};a.navigateToFolder=function(d){try{var a=this._dataHub.getIdFromUri(d,true);if(a){var c=this._dataHub.getObject(a);c.searchQuery="";this._dataHub.contentContainer=c;this._setMode(b.Mode.megastrip,null,{suspendNavigations:true}).done();return true}}catch(e){Jx.log.error("Error navigating to folder, "+e.toString())}return false};a.openAsset=function(e,f){var a=!this.hasUI();if(a){this._ensureAppSettingsContainers(this._appId);this._appStateSavingManager.loadState(false)}var g=this._dataHub,b=g.getObject(e);b.searchQuery="";this._switchModeCommandHandler(d.launchOpenWith,null,{container:b,activeItemId:f},true);var c=this.navStack;c.removeTemporaryEntries();c.ensureLastEntryIsRoot();return a};a.addStatus=function(f,e,c,d,b,a){this._ensureStatusCreated();return this._statusComponent.addStatus(f,e,c,d,b,a)};a.getCommandStateRegistrar=function(a){return this._commandManager.getCommandStateRegistrar(a)};a.doCommand=function(a,d,c,b){if(this._userInputDisabledCount>0){Jx.log.info('Coordinator: user input is disabled. Ignoring command "'+a+'".');return}return this._commandManager.doCommand(a,d,c,b)};a.addCommand=function(f,a,b,c,e,d,g){return this._commandManager.addCommand(f,a,b,c,e,d,g)};a.setCommandStage=function(b,a){return this._commandManager.setCommandStage(b,a)};a.getCommandStage=function(a){return this._commandManager.getCommandStage(a)};a.isCommandAtStage=function(a,b){return this._commandManager.isCommandAtStage(a,b)};a.isCommandEnabled=function(a){return this._commandManager.isCommandEnabled(a)};a.removeCommand=function(a){return this._commandManager.removeCommand(a)};a.setCommandPropertyState=function(a,b){return this._commandManager.setCommandPropertyState(a,b)};a.beginBatchCommandingUpdate=function(){return this._commandManager.beginBatchUpdatingOfCommandState()};a.endBatchCommandingUpdate=function(){return this._commandManager.endBatchUpdatingOfCommandState()};a.showAppBars=function(b,a){if(b)this._appBarComponent.showBars(a);else this._appBarComponent.hideBars(a)};a.registerForCommandingBatches=function(a,b){if(b)this._commandManager.removeEventListener("commandbatch",a);else this._commandManager.addEventListener("commandbatch",a)};a.isAppBarVisible=function(a){return this._appBarComponent.isBarVisible(a)};a.onAppBarInitialized=function(){return this._appBarComponent.onAppBarInitialized()};a.onOnlineIdConnectedStateChange=function(){this._appStateSavingManager.onOnlineIdConnectedStateChange();this._dataHub.executeAsync("refreshCredentials",null)};a.onSuspend=function(){if(!this._suspended){PhotoViewer.log.perf("evPhotoViewer_Frame_Suspend_Start",{emptyValue:true});this._suspended=true;this._applicationLaunched=false;var a=this._getMainComponent();a.lightweightSuspendCleanup&&a.lightweightSuspendCleanup();Boolean(this._appStateSavingManager)&&this._appStateSavingManager.onSuspend();this._mode===b.Mode.importView&&Boolean(this._importComponent)&&this._importComponent.onSuspend();this._imgCache.clearCache();this._imgCache.clearCache();PhotoViewer.log.perf("evPhotoViewer_Frame_Suspend_End",{emptyValue:true})}};a.onResume=function(){if(this._suspended){PhotoViewer.log.perf("evPhotoViewer_Frame_Resume_Start",{emptyValue:true});this._suspended=false;var a=this._getMainComponent();a.onResume&&a.onResume();this._appStateSavingManager.onResume();this._callApplicationLaunched(true);this._mode===b.Mode.importView&&Boolean(this._importComponent)&&this._importComponent.onResume();PhotoViewer.log.perf("evPhotoViewer_Frame_Resume_End",{emptyValue:true})}};a.onActivated=function(a,d){var j=this.hasUI(),c=Windows.ApplicationModel.Activation.ActivationKind;switch(a.kind){case c.launch:case c.search:this._ensureAppSettingsContainers(this._appId);break;case c.fileOpenPicker:var f=a;this._fileOpenPickerUI=f.fileOpenPickerUI;b.filePickerMode=true;this._displayStateManager.updateScaleFactors();this._ensureAppSettingsContainers(this._appId+"FileOpenPicker"+this._fileOpenPickerUI.settingsIdentifier);this._createFileOpenPickerExtension()}this._appStateSavingManager.onActivated(a,d);if(Boolean(d)&&Boolean(d.activeItemId)){var e=this._getMainComponent();e.setActiveItemId&&e.setActiveItemId(d.activeItemId)}if((a.kind===c.launch||a.kind===c.fileOpenPicker)&&this._mode===b.Mode.megastrip&&h.isRootContainer(this._dataHub.contentContainer)){var i=a,g=i.activatedOperation.getDeferral();this._collectionsComponent.onActivatedAtSourcesView(g)}return!j};a.addPostApplicationLaunchWorkItem=function(a){if(this._applicationLaunched)a();else this._postApplicationLaunchWorkItems.push(a)};a.getNavId=function(){return"Coordinator"};a.getNavState=function(){var a=this._dataHub.contentContainer;if(!a)return this.getRootNavState();var c=this._mode;if(c===b.Mode.slideshow)c=b.Mode.oneUp;var d={containerId:a.id,containerShape:a.shape,searchQuery:a.searchQuery,mode:c};return d};a.getRootNavState=function(){return{containerId:"",containerShape:WindowsLive.Photo.Viewer.DataModel.ContainerShape.byAlbum,searchQuery:"",mode:b.Mode.megastrip}};a.isNavStateTemporary=function(a){return a.mode===b.Mode.openWith};a.areNavStatesEquivalent=function(a,b){var c=Jx.isObject(a),d=Jx.isObject(b);if(c!==d)return false;if(!c&&!d)return true;var e=a.containerId===b.containerId&&a.containerShape===b.containerShape&&a.searchQuery===b.searchQuery&&a.mode===b.mode;return e};a.setNavState=function(c){if(c.mode===b.Mode.importView||c.mode===b.Mode.multiUpSlideshow)return WinJS.Promise.wrap(false);var d=this._dataHub,a;try{a=d.getObject(c.containerId);if(a){a.shape=c.containerShape;a.searchQuery=c.searchQuery}d.contentContainer=a}catch(g){a=null}if(!a)return WinJS.Promise.wrap(false);var e=this._setMode(c.mode,null,null);!this.hasChildren()&&this._getActiveComponents(true);return e};a.returnToRootView=function(){Jx.log.info("Coordinator: Applying Fresh Start start");this._setModeSync(b.Mode.none);this._dataHub.contentContainer=this._dataHub.createRootContainer();this._setMode(b.Mode.megastrip,null,{suspendNavigations:true}).done();Jx.log.info("Coordinator: Applying Fresh Start end")};a.disableUserInput=function(e,d){Jx.log.info("Coordinator:: DisableUserInput. (disable: "+String(e)+", allowTouch: "+String(d)+", OldDisableCounterVal: "+String(this._userInputDisabledCount)+")");if(!e){this._userInputDisabledCount--;if(this._userInputDisabledCount===0){Jx.log.info("Coordinator: Re-enabling user input.");for(var h=this._disableInputHandlers.length,g=this._disableInputHandlers,c=0;c<h;c++){var f=g[c];window.removeEventListener(f.event,f.handler,true)}this._disableInputHandlers=[]}}else{if(this._userInputDisabledCount===0){Jx.log.info("Coordinator: Disabling user input.");var b=function(a,b){window.addEventListener(a,b,true);this._disableInputHandlers.push({event:a,handler:b})}.bind(this),a=function(a){a.cancelable&&a.preventDefault();a.stopImmediatePropagation();return true};b("click",a);b("keypress",a);b("keyup",a);b("keydown",a);b("mousewheel",a);if(!d){b("MSPointerDown",a);b("MSPointerUp",a)}}this._userInputDisabledCount++}};a.updateCurrentlyDeleting=function(a){if(this._appStateSavingManager)this._appStateSavingManager.currentlyDeleting=a};a.confirmDelete=function(f){if(this.isCommandEnabled(d.deleteCmd)){this._ensureDeleteFlyout();var e;if(this._mode===PhotoViewer.Coordinator.Mode.oneUp||this._mode===PhotoViewer.Coordinator.Mode.openWith)e=1;else e=this._dataHub.selection.size;var a=null,c=null,b=null;if(this.isAppBarVisible(PhotoViewer.AppBar.Bars.bottom)){a=document.getElementById(PhotoViewer.AppBar.Commands.deleteCmd);c="top";b="center"}if(!a){a=document.body;c="bottom";b="left"}this._deleteFlyoutControl.show(e,f,a,c,b)}};Object.defineProperty(a,"navStack",{"get":function(){var a=this._navStack;if(!a)a=this._navStack=new PhotoViewer.NavStack(this,this._alwaysShowBackButton);return a}});Object.defineProperty(a,"displayStateManager",{"get":function(){return this._displayStateManager}});Object.defineProperty(a,"plateauScaleManager",{"get":function(){return this._plateauScaleManager}});Object.defineProperty(a,"imgCache",{"get":function(){return this._imgCache}});Object.defineProperty(a,"mode",{"get":function(){return this._mode}});Object.defineProperty(a,"applicationSettings",{"get":function(){return this._appSettings}});Object.defineProperty(a,"fileOpenPickerUI",{"get":function(){return this._fileOpenPickerUI}});Object.defineProperty(a,"disableAnimations",{"get":function(){return this._animationsSuspendCount>0||!this._windowsUISettings.animationsEnabled}});Object.defineProperty(a,"animationRefCountedPromise",{"get":function(){return this._ongoingAnimationRefCountedPromise}});a._getUIForComponent=function(d,c,e,f){var a=this[d];if(Boolean(a)&&c.indexOf(a)!==-1){var b=Jx.getUI(a);e.html+=b.html;f.push(b)}};a._initializeCommanding=function(){var a=new c.CommandManager;a.initialize(this._dataHub,true);a.addCommand(d.returnToMegastripFromOneUp,c.CommandEnableProperties.none,c.CommandEnableProperties.viewIs1Up,c.CommandEnableProperties.none,c.ExpectedActionableItems.none,true,this._switchModeCommandHandler);a.addCommand(d.launchOneUp,c.CommandEnableProperties.none,c.CommandEnableProperties.none,c.CommandEnableProperties.viewIs1Up|c.CommandEnableProperties.viewIsOpenWith|c.CommandEnableProperties.viewIsImport,c.ExpectedActionableItems.none,true,this._switchModeCommandHandler);a.addCommand(d.launchOpenWith,c.CommandEnableProperties.none,c.CommandEnableProperties.none,c.CommandEnableProperties.none,c.ExpectedActionableItems.none,true,this._switchModeCommandHandler);a.addCommand(d.launchSlideshow,c.CommandEnableProperties.contentContainsMultipleAssets,c.CommandEnableProperties.viewIs1Up|c.CommandEnableProperties.viewIsMultiUp,c.CommandEnableProperties.viewIsOpenWith|c.CommandEnableProperties.viewIsSlideshow|c.CommandEnableProperties.viewIsImport,c.ExpectedActionableItems.none,true,this._switchModeCommandHandler);a.addCommand(d.launchPlayTo,c.CommandEnableProperties.none,c.CommandEnableProperties.selectionExists|c.CommandEnableProperties.contentContainsAsset,c.CommandEnableProperties.viewIsPlayTo|c.CommandEnableProperties.viewIsImport,c.ExpectedActionableItems.playTo,true,this._switchModeCommandHandler);a.addCommand(d.launchMultiUpSlideshow,c.CommandEnableProperties.none,c.CommandEnableProperties.viewIsMultiUp,c.CommandEnableProperties.viewIs1Up|c.CommandEnableProperties.viewIsOpenWith|c.CommandEnableProperties.viewIsImport,c.ExpectedActionableItems.none,true,this._switchModeCommandHandler);a.addCommand(d.launchImport,c.CommandEnableProperties.none,c.CommandEnableProperties.viewIsMultiUp,c.CommandEnableProperties.viewIs1Up|c.CommandEnableProperties.viewIsOpenWith|c.CommandEnableProperties.viewIsImport,c.ExpectedActionableItems.none,true,this._importCommandHandler);this._disableSelection&&a.removeCommand(d.selectAll);this._commandManager=a};a._switchModeCommandHandler=function(e,h,f,k){var a,j=true,g=this.navStack;switch(e){case d.returnToMegastripFromOneUp:g.discardLastEntry();j=false;a=b.Mode.megastrip;break;case d.launchOneUp:a=b.Mode.oneUp;break;case d.launchOpenWith:a=b.Mode.openWith;break;case d.launchSlideshow:a=b.Mode.slideshow;PhotoViewer.log.perf("evPhotoViewerSlideshow_Launch_begin",{emptyValue:true});break;case d.launchMultiUpSlideshow:this._ensureMultiUpSlideshowLoaded();a=b.Mode.multiUpSlideshow;break;case d.launchPlayTo:if(!h||h.size<=0)return null;this._ensurePlayToLoaded();a=b.Mode.playTo;break;case d.launchImport:this._ensureImportLoaded();a=b.Mode.importView;break;default:throw new Error("Invalid command: "+e)}var c;if(j){c=this._takeNavSnapshot(a);if(Boolean(c)&&k){g.recordEntry(c);c=null}}var i={context:h,additionalData:f,commandName:e};f&&Jx.mix(i,f);var l=this;this._setMode(a,i,{suspendNavigations:true}).done(function(){c&&g.recordEntry(c)});return null};a._importCommandHandler=function(){this._ensureImportLoaded();var a=this;PhotoViewer.ImportHelpers.enumerateAndPickDeviceAsync().then(function(b){a.launchImport(b.folder,b.id,true)});return null};a._takeNavSnapshot=function(c){var a=true;if(this._mode===b.Mode.playTo||this._mode===b.Mode.importView||this._mode===b.Mode.multiUpSlideshow)a=false;if(a&&Boolean(c)&&(c===b.Mode.oneUp||c===b.Mode.slideshow)&&(this._mode===b.Mode.oneUp||this._mode===b.Mode.slideshow))a=false;if(a&&!this._dataHub.contentContainer)a=false;return a?this.navStack.takeNavSnapshot():null};a._getComponent=function(e,a,c,d){if(!this[a]&&e){var b=new c(this,this._dataHub,{disableSelection:this._disableSelection});this.appendChild(b);this[a]=b}this[a]&&d.push(this[a])};a._getClientViewComponent=function(c,a){switch(this._mode){case b.Mode.none:break;case b.Mode.megastrip:case b.Mode.puzzle:this._getComponent(c,"_collectionsComponent",PhotoViewer.Collections,a);break;case b.Mode.oneUp:case b.Mode.openWith:case b.Mode.slideshow:this._getComponent(c,"_oneUpComponent",PhotoViewer.OneUpComponent,a);break;case b.Mode.multiUpSlideshow:this._getComponent(c,"_multiUpSlideshowComponent",PhotoViewer.MultiUpSlideshowComponent,a);break;case b.Mode.playTo:this._getComponent(c,"_playToComponent",PhotoViewer.PlayToComponent,a);break;case b.Mode.importView:this._getComponent(c,"_importComponent",PhotoViewer.ImportComponent,a);break;default:throw new Error("Unexpected mode: "+this._mode)}};a._getMainComponent=function(){var a=[];this._getClientViewComponent(true,a);return a[0]};a._getActiveComponents=function(c){var a=[],e=b.filePickerMode,d=true;switch(this._mode){case b.Mode.none:d=false;break;case b.Mode.oneUp:case b.Mode.openWith:case b.Mode.slideshow:case b.Mode.importView:case b.Mode.multiUpSlideshow:d=false;break;case b.Mode.megastrip:case b.Mode.puzzle:case b.Mode.playTo:break;default:throw new Error("Unexpected mode: "+this._mode)}this._getClientViewComponent(c,a);d&&this._getComponent(c,"_backButtonComponent",PhotoViewer.BackButton,a);!e&&this._getComponent(c,"_appBarComponent",PhotoViewer.AppBar,a);Boolean(this._statusComponent)&&this._getComponent(c,"_statusComponent",PhotoViewer.StatusComponent,a);return a};function t(a){switch(a){case b.Mode.none:return c.CurrentView.none;case b.Mode.megastrip:return c.CurrentView.megaStrip;case b.Mode.puzzle:return c.CurrentView.puzzleView;case b.Mode.oneUp:return c.CurrentView.oneUp;case b.Mode.openWith:return c.CurrentView.openWith;case b.Mode.slideshow:return c.CurrentView.slideshow;case b.Mode.multiUpSlideshow:return c.CurrentView.multiUpSlideshow;case b.Mode.playTo:return c.CurrentView.playTo;case b.Mode.importView:return c.CurrentView.importView}throw new Error("Unexpected mode: "+a)}a._getWrapperElementForComponent=function(a){switch(a){case this._collectionsComponent:return document.getElementById(k);case this._oneUpComponent:return document.getElementById(q);case this._playToComponent:return document.getElementById(o);case this._appBarComponent:return document.getElementById(m);case this._backButtonComponent:return document.getElementById(l);case this._statusComponent:return document.getElementById(p);case this._multiUpSlideshowComponent:return document.getElementById(i);case this._importComponent:return document.getElementById(n)}throw new Error("Unexpected component.")};a._getSearchContainer=function(){var a=this._dataHub;if(this._mode===b.Mode.multiUpSlideshow)return a.getPicturesLibraryContainer();else{var d=a.contentContainer,c=d.id;return c===""||d.sourceType===h.SourceType.storage?a.getPicturesLibraryContainer():a.getObject(c)}};a._informCommandingOfModeSwitch=function(b){var a=this._appBarComponent;a&&a.updateForMode(b);this._commandManager.setCurrentView(t(b))};a._setMode=function(c,l,h){PhotoViewer.log.perf("evPhotoViewer_Coordinator_SetMode_Start",{emptyValue:true});var d,o=Boolean(h)&&h.suspendNavigations,k;try{if(o){k=this.navStack;k.suspendNavigations(true)}if(c!==this._mode||Boolean(h)){Jx.log.info("Coordinator: Beginning Mode Switch to "+c);var b=null,a=-1,e=-1,m=this._getActiveComponents(false),q=this._mode;this._mode=c;var r={mode:c,outgoingMode:q};l&&Jx.mix(r,l);var i=this._getActiveComponents(true);for(a=0,e=i.length;a<e;a++){b=i[a];b.setInitializationParameters&&b.setInitializationParameters(r)}if(!this.hasUI())this._informCommandingOfModeSwitch(c);else{var f=m.filter(function(a){return i.indexOf(a)===-1}),g=i.filter(function(a){return m.indexOf(a)===-1});for(a=0,e=f.length;a<e;a++){b=f[a];b.preDeactivateUI&&b.preDeactivateUI()}var n=this.disableAnimations;for(a=0,e=g.length;a<e;a++){b=g[a];var p=this._getWrapperElementForComponent(b);if(!n)p.style.visibility="hidden";b.initUI(p)}if(this._statusComponent)this._statusComponent.onModeChanged(c);this._informCommandingOfModeSwitch(c);var j=this._getCompleteModeSwitch(c,f,g);if(!n&&(f.length!==0||g.length!==0))d=this._animateModeSwitch(g,f,c,q).then(j,j);else if(Boolean(h)&&h.synchronous)d=WinJS.Promise.wrap(j());else d=WinJS.Promise.timeout(0).then(j)}}}catch(s){Jx.log.error("Unexpected exception in _setMode: "+s.toString());d=WinJS.Promise.wrapError(s)}if(!d)d=WinJS.Promise.wrap(true);o&&d.then(function(){k.suspendNavigations(false)},function(){k.suspendNavigations(false)});PhotoViewer.log.perf("evPhotoViewer_Coordinator_SetMode_End",{emptyValue:true});return d};a._getCompleteModeSwitch=function(c,a,b){var d=this;return function(){Jx.log.info("Coordinator: Completing mode switch to: "+c);var e,d,f;for(d=0,f=a.length;d<f;d++){e=a[d];e.shutdownUI()}for(d=0,f=b.length;d<f;d++){e=b[d];e.postActivateUI&&e.postActivateUI()}return WinJS.Promise.wrap(true)}};a._setModeSync=function(c,b){this._suspendAnimations();try{var a=false;this._setMode(c,b,{synchronous:true}).done(function(){a=true})}finally{this._resumeAnimations()}};a._animateModeSwitch=function(s,C,h,o){var K=this.navStack.navigating,G=this._switchToSearchInProgress;this.disableUserInput(true,false);Jx.log.info("Animations: Triggering Animation Promises.");PhotoViewer.log.perf("evPhotoViewer_Coordinator_InterViewAnimation_Start",{emptyValue:true});var k=null,a=-1,d=-1,z,r=[],m=[],q=null,i=null,v=[],p=null,E=h===b.Mode.oneUp||h===b.Mode.slideshow,H=o===b.Mode.oneUp||o===b.Mode.slideshow,w=false;d=s.length;var c;for(a=0;a<d;a++){k=s[a];if(k.getEntranceAnimationInfo){c=k.getEntranceAnimationInfo(o);if(!c)w=true;if(c){if(k===this._backButtonComponent)q=c;else if(c.isClientView)i=c;else v.push(c);r.push(c)}}}d=C.length;for(a=0;a<d;a++){k=C[a];if(k.getExitAnimationInfo){c=k.getExitAnimationInfo();if(!c)w=true;if(c){m.push(c);if(c.isClientView)p=c}}}var g=[];Boolean(q)&&Boolean(q.orderedElements)&&e.mergeArrays(g,q.orderedElements);Boolean(i)&&Boolean(i.orderedElements)&&e.mergeArrays(g,i.orderedElements);d=v.length;for(a=0;a<d;a++){c=v[a];Boolean(c)&&Boolean(c.orderedElements)&&e.mergeArrays(g,c.orderedElements)}var j=[];d=m.length;for(a=0;a<d;a++){c=m[a];Boolean(c)&&Boolean(c.orderedElements)&&e.mergeArrays(j,c.orderedElements)}z=m.concat(r);d=z.length;for(a=0;a<d;a++){c=z[a];Boolean(c.beginAnimation)&&c.beginAnimation()}var B=false,f=null,F=document.getElementById("application"),D=this._dataHub.activeItem,t;if(D.size===1)t=D.idAt(0);this._ongoingAnimationRefCountedPromise.addRef();var u,A=this,n=function(){d=s.length;for(a=0;a<d;a++){k=s[a];var b=A._getWrapperElementForComponent(k);b.style.visibility="visible"}};if(w)f=WinJS.Promise.wrap(null);else if(j.length===0&&h!==b.Mode.megastrip&&h!==b.Mode.puzzle){n();if(E||h===b.Mode.openWith)f=WinJS.Promise.wrap();else f=WinJS.UI.Animation.enterPage(g);B=true}else if(E&&!K&&Boolean(t)){n();if(b.runDirectionalScaleAnimation){var J=p.actualMode?p.actualMode:o;u=J===b.Mode.puzzle?e.DirectionalItemScalingType.capOutgoingScale:e.DirectionalItemScalingType.standard;f=e.directionalItemScalingAnimation(u,g,j,F,i,p,t)}else f=WinJS.UI.Animation.crossFade(g,j)}else if(H&&(h===b.Mode.megastrip||h===b.Mode.puzzle)&&!G){n();if(b.runDirectionalScaleAnimation){var I=i.actualMode?i.actualMode:h;u=I===b.Mode.puzzle?e.DirectionalItemScalingType.capIncomingScale:e.DirectionalItemScalingType.standard;f=e.directionalItemScalingAnimation(u,g,j,F,i,p,t)}else f=WinJS.UI.Animation.crossFade(g,j)}else if(h===b.Mode.multiUpSlideshow&&o===b.Mode.megastrip||h===b.Mode.megastrip&&o===b.Mode.multiUpSlideshow){n();var y=0,l=[];d=m.length;for(a=0;a<d;a++){c=m[a];if(Boolean(c)&&Boolean(c.runCustomAnimation)){l[l.length]=c.runCustomAnimation(0);if(!y&&Boolean(c.entranceAnimationDelay))y=c.entranceAnimationDelay}}d=r.length;for(a=0;a<d;a++){c=r[a];if(Boolean(c)&&Boolean(c.runCustomAnimation))l[l.length]=c.runCustomAnimation(y)}if(l.length)f=WinJS.Promise.join(l);else f=WinJS.Promise.wrap(null)}else if(h===b.Mode.megastrip||h===b.Mode.puzzle){if(j.length===0)f=WinJS.Promise.wrap();else f=WinJS.UI.Animation.exitPage(j,null);f=f.then(function(){n();g.length!==0&&WinJS.UI.Animation.enterContent(g);i.runCustomAnimation(0)})}if(!f)f=WinJS.UI.Animation.exitPage(j,null).then(function(){n();for(a=0,d=g.length;a<d;a++)g[a].style.opacity=1;var b=function(){A._ongoingAnimationRefCountedPromise.decRef()};A._ongoingAnimationRefCountedPromise.addRef();WinJS.UI.Animation.enterPage(g,null).done(b,b)});var x;if(B)x=WinJS.Promise.wrap(null);else x=f;return x.then(function(){try{Jx.log.info("Animations: Finishing shutdown of deactivating components.");PhotoViewer.log.perf("evPhotoViewer_Coordinator_InterViewAnimation_End",{emptyValue:true})}catch(a){}finally{this.disableUserInput(false,false);this._ongoingAnimationRefCountedPromise.decRef()}return true}.bind(this),function(){try{Jx.log.info("Animations: Error during inter-view animation.")}catch(a){}finally{this.disableUserInput(false,false);this._ongoingAnimationRefCountedPromise.decRef()}return false}.bind(this))};a._suspendAnimations=function(){this._animationsSuspendCount++};a._resumeAnimations=function(){this._animationsSuspendCount--};var s=PhotoViewer.Frame,f=s.viewerScriptRoot,g=s.viewerResourcesRoot;a._ensureMultiUpSlideshowLoaded=function(){if(!this._multiUpSlideshowComponent){this._frame.loadScripts([f+"Components/MultiUpSlideshow/MultiUpSlideshow.js"],null);this._frame.loadStyleSheets([g+"css/MultiUpSlideshow.css"])}};a._ensurePlayToLoaded=function(){if(!this._playToComponent){this._frame.loadScripts([f+"Components/PlayTo/PlayTo.js"],PhotoViewer.PlayToView);this._frame.loadStyleSheets([g+"css/PlayTo.css"])}};a._ensureStatusCreated=function(){if(!this._statusComponent){this._frame.loadScripts([f+"Components/Status/Status.js"],PhotoViewer.StatusModel);this._frame.loadStyleSheets([g+"css/Status.css"]);var b=[];this._getComponent(true,"_statusComponent",PhotoViewer.StatusComponent,b);if(this.hasUI()){var a=b[0],c=this._getWrapperElementForComponent(a);a.initUI(c);a.onModeChanged(this._mode)}}};a._ensureSettingsCreated=function(){if(!this._settingsComponent){this._frame.loadScripts([f+"Components/Settings/Settings.js"],PhotoViewer.SettingsView);this._frame.loadStyleSheets([g+"css/Settings.css"]);this._settingsComponent=new PhotoViewer.SettingsComponent(this,this._dataHub);this._photoViewerComponent.push(this._settingsComponent)}};a._ensureImportLoaded=function(){if(!this._importComponent){this._frame.loadScripts([f+"Components/Import/Import.js"],PhotoViewer.ImportView);this._frame.loadStyleSheets([g+"css/Import.css"])}};a._createFileOpenPickerExtension=function(){this._frame.loadScripts([f+"Extensions/Extensions.js"],PhotoViewer.FileOpenPickerExtension);this._fileOpenPickerExtension=new PhotoViewer.FileOpenPickerExtension(this,this._dataHub)};a._ensureAppSettingsContainers=function(b){if(!this._appSettings){this._appId=b;var a={};a.localAppStateContainer=Jx.appData.localSettings().container("appStateContainer."+b);a.localSettingsContainer=Jx.appData.localSettings().container("settingsContainer");this._appSettings=a;this._appStateSavingManager=new PhotoViewer.AppStateSavingManager(this,this._dataHub)}};a._ensurePrintManagerCreated=function(){this._frame.loadScripts([f+"Components/Print/Print.js"],PhotoViewer.Print);if(!this._printManager){this._printManager=new PhotoViewer.Print(this,this._dataHub,this._imgCache,document.getElementById(r));this._photoViewerComponent.push(this._printManager)}};a._ensureDeleteFlyout=function(){if(!this._deleteFlyoutControl){var a=this;this._deleteFlyoutControl=new PhotoViewer.ConfirmDeleteFlyout(document.getElementById(this._id))}};a._callApplicationLaunched=function(b){var c=this,a=this._getMainComponent();if(a.onFinishedLaunching)WinJS.Promise.any([WinJS.Promise.timeout(3e3),a.onFinishedLaunching()]).done(function(){c._onApplicationLaunched(b)});else this._onApplicationLaunched(b)};a._onApplicationLaunched=function(b){var a=this;window.setTimeout(function(){a._applicationLaunched=true;for(var d=a._postApplicationLaunchWorkItems,c=0,e=d.length;c<e;++c)d[c]();a._postApplicationLaunchWorkItems=[];a._dataHub.onApplicationLaunched(b)},100);!b&&window.setTimeout(function(){try{Jx.launch.startDeferredTasks(null)}catch(a){}},8e3)};a._keyUp=function(a){var b=WinJS.Utilities.Key,c=a.ctrlKey,e=a.keyCode;if(c&&e===b.p){this._ensurePrintManagerCreated();this.isCommandEnabled(d.print)&&Windows.Graphics.Printing.PrintManager.showPrintUIAsync()}};a._keyDown=function(a){var b=WinJS.Utilities.Key,e=a.ctrlKey,g=a.altKey,f=a.keyCode;if(e&&!g&&f===b.d||!e&&!g&&f===b.deleteKey){var h=this;this.confirmDelete(function(){h.doCommand(d.deleteCmd,c.CommandSurface.keyboardShortcut,null,null)})}};a._dataHub=null;a._navStack=null;a._displayStateManager=null;a._plateauScaleManager=null;a._imgCache=null;a._mode=b.Mode.none;a._switchToSearchInProgress=false;a._suspended=false;a._applicationLaunched=false;a._postApplicationLaunchWorkItems=null;a._collectionsComponent=null;a._oneUpComponent=null;a._appBarComponent=null;a._backButtonComponent=null;a._playToComponent=null;a._importComponent=null;a._statusComponent=null;a._multiUpSlideshowComponent=null;a._photoViewerComponent=null;a._settingsComponent=null;a._printManager=null;a._fileOpenPickerUI=null;a._fileOpenPickerExtension=null;a._appStateSavingManager=null;a._appSettings=null;a._appId=null;a._deleteFlyoutControl=null;a._alwaysShowBackButton=false;a._disableSelection=false;a._animationsSuspendCount=0;a._windowsUISettings=null;a._ongoingAnimationRefCountedPromise=null;a._disableInputHandlers=null;a._userInputDisabledCount=0})()