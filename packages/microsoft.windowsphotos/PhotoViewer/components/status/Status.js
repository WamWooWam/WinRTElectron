(function(){var b=window.PhotoViewer;b.StatusComponent=function(a){this.initComponent();this._site=a;this._controller=new b.StatusController(a)};Jx.augment(b.StatusComponent,Jx.Component);var a=b.StatusComponent.prototype;a.activateUI=function(){this._controller.finalizeInitUI();Jx.Component.prototype.activateUI.call(this)};a.deactivateUI=function(){this._controller.shutdown()};a.getUI=function(a){this._controller.getMainViewUI(this._id,a)};a.addStatus=function(f,e,c,d,b,a){return this._controller.createStatus(f,e,c,d,b,a)};a.onModeChanged=function(a){this._controller.onModeChanged(a)}})();(function(){var b=window.PhotoViewer;b.StatusController=function(a){this._coordinator=a;this._view=new b.StatusView(this);this._statusModel=new b.StatusModel};var a=b.StatusController.prototype;a.finalizeInitUI=function(){this._view.initialize(this._statusModel);this._updateStatusTextVisibility()};a.shutdown=function(){this._view.shutdown();this._statusModel.shutdown()};a.createStatus=function(i,d,h,e,g,f){var a={};a.id="status-"+i;a.defaultText=d;a.truncatedText=h;a.type="text.status";a.textDisplayPolicy=e;a.truncatedTextPolicy=g;a.flyoutCallback=f;a.properties=this._createStatusProperties(d);a.getProperties=function(c,b){b(a,a.properties)};var b=this;this._statusModel.addItem(a.id,a,this._coordinator.mode);this._updateStatusTextVisibility();var c={};c.update=function(){};c.remove=function(){b._statusModel.removeItem(a.id,b._coordinator.mode);b._updateStatusTextVisibility();b._view.removeStatusFlyout()};return c};a.onModeChanged=function(a){this._statusModel.onModeChanged(a);this._updateStatusTextVisibility(a)};a._updateStatusTextVisibility=function(a){a=a||this._coordinator.mode;this._view.updateStatusTextVisibility(this._shouldStatusBeActive(a)&&this._statusModel.count>0)};a._shouldStatusBeActive=function(c){var a=b.Coordinator.Mode;switch(c){case a.none:case a.oneUp:case a.openWith:case a.slideshow:case a.multiUpSlideshow:return false;case a.megastrip:case a.puzzle:case a.playTo:case a.importView:return true;default:throw new Error("Unexpected mode: "+c)}return false};a.getMainViewUI=function(a,b){this._view.getMainViewUI(a,b)};a.getDataByItemId=function(a){return this._statusModel.getDataByItemId(a)};a.itemInvoked=function(b){var a=this._statusModel.getDataByItemId(b);a.flyoutCallback&&this._view.createStatusFlyout(a.id,a.flyoutCallback)};a._createStatusProperties=function(d){var a=document.createElement("a");a.innerText=d;a.style.visible="hidden";var b=this._view.statusContent;b.appendChild(a);var c={width:a.offsetWidth+41,height:a.offsetHeight,hasKey:function(a){return a==="width"||a==="height"},lookup:function(a){return this[a]}};b.removeChild(a);return c};a._coordinator=null})();(function(){var b=window.PhotoViewer,d="status-content",c="status-flyout";b.StatusView=function(a){this._controllerCallbacks=a;this._content=null;this.removeStatusFlyout=this.removeStatusFlyout.bind(this);this._itemRendererCallback=this._itemRendererCallback.bind(this)};var a=b.StatusView.prototype;a.getMainViewUI=function(b,a){a.html+='<div id="'+b+'">';a.html+='    <div id="status-container">        <div id="status-content" class="singleLineText" aria-label="status-content"></div>    </div>    <div id="status-flyout"></div>';a.html+="</div>"};a.initialize=function(e){var a=this._content=document.getElementById(d);a.style.width=String(this._content.offsetWidth-140)+"px";var h={fixedHeight:46,useNotificationHandler:false};this._customLayout=new b.FilmstripLayout(e,h);var g=WinJS.UI.simpleItemRenderer(this._itemRendererCallback);this._listView=new WinJS.UI.ListView(a,{itemDataSource:e.dataSource,itemTemplate:g,layout:this._customLayout,selectionMode:WinJS.UI.SelectionMode.none});this._customLayout.setListView(this._listView);var f=this;a.addEventListener("click",function(a){f._controllerCallbacks.itemInvoked(a.srcElement.id)},false);a.addEventListener("keydown",function(a){if(a.keyCode===Jx.KeyCode.enter||a.keyCode===Jx.KeyCode.space){var b=a.target.firstChild;f._controllerCallbacks.itemInvoked(b.id)}},false);this._flyout=new WinJS.UI.Flyout(document.getElementById(c))};a.shutdown=function(){Boolean(this._customLayout)&&this._customLayout.shutdown()};a.createStatusFlyout=function(d,b){var a=document.getElementById(c);a.innerHTML="";a.appendChild(b(this.removeStatusFlyout));var e=this;msSetImmediate(function(){var a=document.getElementById(d);e._flyout.show(a.offsetParent,"bottom")})};a.removeStatusFlyout=function(){this._flyout.hide()};Object.defineProperty(a,"statusContent",{"get":function(){return this._content}});a.refresh=function(){this._listView.forceLayout()};a.updateStatusTextVisibility=function(a){this._content.style.visibility=a?"visible":"hidden"};a._itemRendererCallback=function(c){var b=this._controllerCallbacks.getDataByItemId(c.data),d=document.createElement("div"),a=document.createElement("a");a.id=b.id;a.innerHTML=b.defaultText;a.className="status-text";a.setAttribute("aria-label",c.data);d.appendChild(a);return d};a._content=null;a._listView=null;a._customLayout=null;a._controllerCallbacks=null;a._flyout=null})();(function(){var b=window.PhotoViewer;b.StatusModel=function(){this._disabledItems={};this._itemData={};this._enabledList=new WinJS.Binding.List};var a=b.StatusModel.prototype;a.shutdown=function(){for(var a=this._enabledList,b=a.length-1;b>=0;b--){var c=a.pop().data;this._addToDisabledItems(c)}};a.addItem=function(a,b,c){this._itemData[a]=b;if(this._isItemVisible(a,c))this._addToEnabledItems(a);else this._addToDisabledItems(a)};a.removeItem=function(a,b){if(this._isItemVisible(a,b))this._removeFromEnabledItems(a);else this._removeFromDisabledItems(a);delete this._itemData[a]};a.updateItem=function(){};a.onModeChanged=function(e){var c=[],a;for(a in this._disabledItems)if(this._isItemVisible(a,e)){c.push(a);this._removeFromDisabledItems(a)}for(var d=this._enabledList,b=d.length-1;b>=0;b--){a=String(d.getAt(b));if(!this._isItemVisible(a,e)){this._removeFromEnabledItems(a);this._addToDisabledItems(a)}}var f=c.length;for(b=0;b<f;b++){a=c[b];this._addToEnabledItems(a)}};a.getDataByItemId=function(a){return this._itemData[a]};a.getIdByEnabledItemIndex=function(a){return this._enabledList.getAt(a)};a.isDeactivated=function(){return false};a.indexToObject=function(a){var c=this.getIdByEnabledItemIndex(a),b=this.getDataByItemId(c);return b};a.objectIdToIndex=function(c){for(var d=this.count,a=0;a<d;a++){var b=this.indexToObject(a);if(Boolean(b)&&b.id===c)return a}return-1};Object.defineProperty(a,"count",{"get":function(){return this._enabledList.length}});Object.defineProperty(a,"dataSource",{"get":function(){return this._enabledList.dataSource}});a._addToEnabledItems=function(a){this._enabledList.push(a)};a._addToDisabledItems=function(a){this._disabledItems[a]=0};a._removeFromEnabledItems=function(c){var a=this._enabledList,b=a.indexOf(c);a.splice(b,1)};a._removeFromDisabledItems=function(a){delete this._disabledItems[a]};a._isItemVisible=function(b,a){return this._itemData[b].textDisplayPolicy(a)};a._enabledList=null;a._itemData=null;a._disabledItems=null})()