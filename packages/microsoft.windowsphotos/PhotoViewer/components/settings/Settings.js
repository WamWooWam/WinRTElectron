(function(){var b=window.PhotoViewer;b.SettingsComponent=function(a,c){this._site=a;this._controller=new b.SettingsController(a,c)};var a=b.SettingsComponent.prototype;a.populateSettings=function(a){this._controller.populateSettings(a)};a._site=null;a._controller=null})();(function(){var b=window.PhotoViewer,d=Windows.UI.ApplicationSettings,c=b.DataHubHelpers,e=b.SourcesHelpers,f=b.ViewHelpers;b.SettingsController=function(a,d){this._site=a;this._dataHub=d;this._view=new b.SettingsView(this);var c=a.applicationSettings;this._settingsContainer=c.localSettingsContainer;this._additionalSettings=[];this._setUpAdditionalSettings()};var a=b.SettingsController.prototype;a.populateSettings=function(c){var g=c.request,a=g.applicationCommands,b=this._view,f=new d.SettingsCommand("photo.settings",Jx.res.getString("resid-settings-photoSettingsLabel"),this.photoSettingsPaneInvoked.bind(this));a.append(f);var h=new d.SettingsCommand("general.about",Jx.res.getString("resid-settings-aboutLabel"),b.aboutPaneInvoked.bind(b));a.append(h);var i=new d.SettingsCommand("help.page",Jx.res.getString("resid-settings-helpLabel"),b.helpPaneInvoked.bind(b));a.append(i);if(!!SasManager&&SasManager.addSettingsEntry()){var e=SasManager.getSettingsCommand();a.append(e)}};a.photoSettingsPaneInvoked=function(){this._view.ensureSettingsPaneExists("photoSettings","narrow");this._updateSettingValues();this._view.drawAdditionalSettings(this._additionalSettings);this._updateSources();this._view.photoSettingPaneInvoked()};a.toggleCallBack=function(a,b){this._settingsContainer.set(a,b);if(a==="generateMoGoTiles")if(b)this._dataHub.executeAsync(a,null).then(function(){});else Windows.UI.Notifications.TileUpdateManager.createTileUpdaterForApplication().clear()};a.accountsCheckboxChanged=function(b,d){var a=this,f=this._dataHub.getObject(b);e.hideOrShowSourceAsync(f,!d).then(function(){if(!d)if(!c.doContainersMatch(a._dataHub.contentContainer,a._dataHub.createRootContainer())){var e=["sourceId"];a._dataHub.contentContainer.getProperties(e,function(g,d){var f=c.tryLookupPropertiesInMap(d,e);if(b===f.sourceId){a._site.navStack.prepareForRootView(null,null);a._site.returnToRootView()}})}})};a.userSignOutCompleteCallback=function(){var a=this;this._dataHub.executeAsync("refreshCredentials",null).then(function(){if(!c.isRootContainer(a._dataHub.contentContainer)){a._site.navStack.prepareForRootView(null,null);a._site.returnToRootView()}a._view.updateUserAccountText()})};a._updateSources=function(){var a=this;this._dataHub.executeAsync("getSources",null).then(function(d){for(var e=d.size,c=[],f,b=0;b<e;b++)c.push(a._dataHub.getObject(d[b]));a._view.fillInSourcesSettings(c)})};a._setUpAdditionalSettings=function(){var a={id:"generateMoGoTiles",type:"toggle",defaultVal:true,title:Jx.res.getString("resid-settings-generateMoGoTiles"),options:{labelOn:Jx.res.getString("resid-settings-toggleOn"),labelOff:Jx.res.getString("resid-settings-toggleOff"),checked:null}};this._additionalSettings.push(a)};a._updateSettingValues=function(){for(var a,b,c=0;c<this._additionalSettings.length;c++){a=this._additionalSettings[c];b=this._settingsContainer.get(a.id);switch(a.type){case"toggle":a.options.checked=Jx.isNullOrUndefined(b)?Boolean(a.defaultVal):b}}};a._site=null;a._dataHub=null;a._view=null;a._additionalSettings=null;a._settingsContainer=null})();(function(){var c=window.PhotoViewer,u=c.DataHubHelpers,b=c.ViewHelpers,o=Windows.Security.Authentication.OnlineId;c.SettingsView=function(a){this._callbackController=a;this._settingPanes={about:null,help:null,photoSettings:null};this._currentlyShowingPane="";this._afterHideCallback=this._afterHideCallback.bind(this);this._beforeShowCallback=this._beforeShowCallback.bind(this);this._showMainSettingsPane=this._showMainSettingsPane.bind(this);this._backShortcutsListener=null};var a=c.SettingsView.prototype,q="settings-connected-account",i="settings-account-name",h="settings-account-signoutInfo",k="settings-additional-preferences",m="settings-accounts-toggle",s="settings-privacyAgreement-link",t="settings-serviceAgreement-link",r="settings-endUserAgreement-link",p="http://go.microsoft.com/fwlink/?LinkId=232490",g="settings-help-iframe",l="settings-help-online",j="settings-help-offline",n="settings-help-progressRing",d="settings-subtitle",e="settings-text",f="win-settings-section";a.ensureSettingsPaneExists=function(a,f){if(!this._settingPanes[a]){var c;if(a==="about")c=Jx.res.getString("resid-settings-aboutLabel");else c=Jx.res.getString("resid-settings-"+a+"Title");var b=this._createHTMLPane(a,c);b.className="photoviewer-settings-pane";b.setAttribute("data-win-control","WinJS.UI.SettingsFlyout");var d=new WinJS.UI.SettingsFlyout(b,{width:f}),e=this;d.addEventListener("beforeshow",function(){e._beforeShowCallback(a)},false);d.addEventListener("afterhide",function(){e._afterHideCallback(a)},false);document.body.appendChild(b);this._settingPanes[a]=d}};a.photoSettingPaneInvoked=function(){this._settingPanes.photoSettings.show()};a.aboutPaneInvoked=function(){this.ensureSettingsPaneExists("about","narrow");this._settingPanes.about.show()};a.helpPaneInvoked=function(){this.ensureSettingsPaneExists("help","wide");var e=navigator.onLine,c=document.getElementById(l),b=document.getElementById(j);if(e){b.style.display="none";c.style.display="block";var d=document.getElementById(n);d.style.display="block";var a=document.getElementById(g);a.style.display="none";a.addEventListener("load",function(){a.style.display="block";d.style.display="none"},false);a.src=p}else{c.style.display="none";b.style.display="block"}var f=this._settingPanes.help;f.show()};a.fillInSourcesSettings=function(f){var e=document.getElementById(m);e.innerHTML="";for(var d=["sourceTitle","sourceHidden","sourceType"],b,a,h,g=this,c=0;c<f.length;c++){b=f[c];b.getProperties(d,function(f,c){a=u.tryLookupPropertiesInMap(c,d);e.appendChild(g._createCheckBoxForSource(b.id,a.sourceTitle,a.sourceType,Boolean(a.sourceHidden)))})}};a.drawAdditionalSettings=function(g){this.updateUserAccountText();var f=document.getElementById(k);f.innerHTML="";for(var a,h,j,i,e=0;e<g.length;e++){a=g[e];i="settings-"+a.id+"-control";var b=document.createElement("div"),c=document.createElement("div");c.innerText=a.title;c.className=d;b.appendChild(c);switch(a.type){case"toggle":h=this._createAdditionalSettingToggle(a,i)}b.appendChild(h);f.appendChild(b)}};a.updateUserAccountText=function(){var e=document.getElementById(i),a=document.getElementById(h),c=new o.OnlineIdAuthenticator,d=this;b.getUserInfoAsync(o.CredentialPromptType.doNotPrompt,c).then(function(g){Jx.removeClass(a,"displayNone");e.innerText=g.signInName;if(c.canSignOut){a.innerHTML="";var f=d._createRemoveAccountButton(function(){var f=document.createElement("div"),e=document.createElement("div");e.className="settings-account-confirmationText";e.innerHTML=Jx.res.getString("resid-settings-signOutConfirmationText");f.appendChild(e);var g=d._createRemoveAccountButton(function(){b.signOutUser(c).then(function(){d._callbackController.userSignOutCompleteCallback()})},true);f.appendChild(g);a.innerHTML="";a.appendChild(f)},false);a.appendChild(f)}else a.innerHTML=Jx.res.getString("resid-settings-signOutMessage")},function(){Jx.addClass(a,"displayNone");e.innerText=Jx.res.getString("resid-settings-notSignedInMessage")})};a._createHTMLPane=function(c,d){var b=document.createElement("div");b.id="settings-"+c+"-content";var e=this._getTitleDiv(c,d);b.appendChild(e);var a;switch(c){case"about":a=this._drawAboutContent();break;case"help":a=this._drawHelpContent();break;case"photoSettings":a=this._drawPhotoSettingsContentSkeleton()}Jx.addClass(a,"win-content");b.appendChild(a);return b};a._getTitleDiv=function(f,e){var a=document.createElement("div");a.id="settings-title";a.className="win-ui-dark win-header";var b=document.createElement("button");b.type="button";b.id="settings-"+f+"-backButton";b.className="win-backbutton settings-title-backButton";var g=this;b.addEventListener("click",this._showMainSettingsPane,false);a.appendChild(b);var c=document.createElement("div");c.className="win-label settings-title-text";c.innerHTML=e;a.appendChild(c);var d=document.createElement("img");d.className="settings-title-appIcon";d.src="/ModernPhoto/Images/Icon.png";a.appendChild(d);return a};a._drawAboutContent=function(){var a=document.createElement("div"),g=document.createElement("div");g.className=f;var k=document.createElement("div");k.className=d;k.id="settings-about-appName";k.innerText=Jx.res.getString("resid-app-name");g.appendChild(k);var j=document.createElement("div");j.id="settings-about-publisher";j.className=e;j.innerText=Jx.res.loadCompoundString("resid-settings-publisher",Jx.res.getString("resid-app-publisher"));g.appendChild(j);var l=document.createElement("div");l.id="settings-about-version";l.className=e;var w=Windows.ApplicationModel.Package.current.id,m=w.version,z=b.formatInteger(m.major),A=b.formatInteger(m.minor),y=b.formatInteger(m.build),x=b.formatInteger(m.revision);l.innerText=Jx.res.loadCompoundString("resid-settings-aboutVersion",z+"."+A+"."+y+"."+x);g.appendChild(l);a.appendChild(g);var c="settings-about-block "+e,q=document.createElement("div");q.className=c;var v='<a id="'+t+'" href="http://go.microsoft.com/fwlink/?LinkID=246338">'+Jx.res.getString("resid-settings-serviceAgreementLink")+"</a>";q.innerHTML=Jx.res.loadCompoundString("resid-settings-serviceAgreement",v);a.appendChild(q);var o=document.createElement("div");o.className=c;var u='<a id="'+r+'" href="http://go.microsoft.com/fwlink/?LinkID=252923">'+Jx.res.getString("resid-settings-endUserAgreementLink")+"</a>";o.innerHTML=Jx.res.loadCompoundString("resid-settings-endUserAgreement",u);a.appendChild(o);var p=document.createElement("div");p.className=c;var h=document.createElement("a");h.id=s;h.href="http://go.microsoft.com/fwlink/p/?LinkId=253457";h.innerText=Jx.res.getString("resid-settings-privacyAgreementLink");p.appendChild(h);a.appendChild(p);var i=document.createElement("div");i.id="settings-about-copyright";i.className=c;i.innerText=Jx.res.loadCompoundString("resid-settings-copyrightStatement",Jx.res.getString("resid-app-publishDate"),Jx.res.getString("resid-app-publisher"));a.appendChild(i);var n=document.createElement("div");n.className=c;n.innerText=Jx.res.loadCompoundString("resid-settings-defaultPhotoText","Will Austin");a.appendChild(n);return a};a._drawHelpContent=function(){var c=document.createElement("div");Jx.addClass(c,"settings-help-contents");var b=document.createElement("div");Jx.addClass(b,"settings-help-contents");b.id=l;var k=document.createElement("progress");k.id=n;k.className="win-ring";b.appendChild(k);var o=document.createElement("iframe");Jx.addClass(o,"settings-help-contents");o.id=g;b.appendChild(o);c.appendChild(b);var a=document.createElement("div");a.id=j;var h=document.createElement("div");h.className=d;h.innerText=Jx.res.getString("resid-settings-helpNoInternetTitle");a.appendChild(h);var i=document.createElement("div");i.className=e;i.innerText=Jx.res.getString("resid-settings-helpNoInternetMessage");a.appendChild(i);var q=document.createElement("div");c.className=f;var m=document.createElement("a");m.href=p;m.innerText=Jx.res.getString("resid-settings-helpNoInternetHelpLink");q.appendChild(m);a.appendChild(q);c.appendChild(a);return c};a._drawPhotoSettingsContentSkeleton=function(){var b=document.createElement("div"),a=document.createElement("div");a.id=q;a.className=f;var c=document.createElement("div");c.className=d;c.innerText=Jx.res.getString("resid-settings-connectedAccountTitle");a.appendChild(c);var j=document.createElement("div");j.id=i;a.appendChild(j);var l=document.createElement("div");l.id=h;a.appendChild(l);b.appendChild(a);var g=document.createElement("div");g.id=k;g.className=f;b.appendChild(g);var e=document.createElement("div");e.className=d;e.innerHTML=Jx.res.getString("resid-settings-accountsTitle");b.appendChild(e);var n=document.createElement("div");n.id=m;b.appendChild(n);return b};a._createAdditionalSettingToggle=function(a,d){var c=this,b=function(b){var d=b.currentTarget.winControl;c._callbackController.toggleCallBack(a.id,d.checked)};return this._createToggle(Object(a.options),b,d,["settings-toggle"],a.title)};a._createCheckBoxForSource=function(i,j,f,k){var d=document.createElement("div");Jx.addClass(d,e);var b=document.createElement("input");b.type="checkbox";b.checked=!k;b.id="settings-"+i+"-checkbox";var l=this;b.addEventListener("change",function(a){var b=a.currentTarget;l._callbackController.accountsCheckboxChanged(i,b.checked)},false);d.appendChild(b);var g=document.createElement("label");g.innerHTML=j;g.setAttribute("for",b.id);d.appendChild(g);var h=c.SourcesHelpers.getAppIdForSourceType(f);if(Jx.isNonEmptyString(h)){var a=document.createElement("a");a.href="https://profile.live.com/Services/connect?appId="+h+"&productId=photos";a.id="settings-"+f+"-optionsLink";a.className="settings-accounts-options";a.title=Jx.res.loadCompoundString("resid-settings-manageOnlineLinkTooltipText",f);a.ariaLabel=Jx.res.loadCompoundString("resid-settings-manageOnlineLinkNarratorText",f);a.innerText=Jx.res.getString("resid-settings-manageOnlineLinkText");d.appendChild(a)}return d};a._createToggle=function(g,d,h,f,b){var a=document.createElement("div");a.id=h;a.className=f.join(" ");var c=new WinJS.UI.ToggleSwitch(a,g);c.addEventListener("change",d,false);if(b){var e=c.element.getElementsByClassName("win-switch")[0];e.setAttribute("aria-label",b)}return a};a._createRemoveAccountButton=function(c,d){var a=document.createElement("button");a.className="settings-account-removeButton";var e=d?"resid-settings-signOutConfirmationButtonText":"resid-settings-signOutButtonText";a.innerText=Jx.res.getString(e);a.addEventListener("click",function b(){a.removeEventListener("click",b,false);c()},false);return a};a._afterHideCallback=function(a){this._currentlyShowingPane="";this._backShortcutsListener.removeListeners();a==="help"&&this._helpPaneAfterHideCallback()};a._beforeShowCallback=function(a){var b=this._settingPanes[a];this._backShortcutsListener=new c.BackShortcutsListener(b,this._showMainSettingsPane);this._currentlyShowingPane=a};a._showMainSettingsPane=function(b){b.stopImmediatePropagation();var c=this._currentlyShowingPane;this._settingPanes[c].hide();var a=Windows.UI.ApplicationSettings.SettingsPane;a.show()};a._helpPaneAfterHideCallback=function(){var a=document.getElementById(g);a.src=""}})()