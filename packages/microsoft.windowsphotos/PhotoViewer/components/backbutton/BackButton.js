(function(){var b=WindowsLive.Photo.Viewer.Commanding,d=PhotoViewer.AnimationHelpers,c=PhotoViewer.AppBar.Commands;PhotoViewer.BackButton=function(a){this.initComponent();this._site=a;this._navStack=this._site.navStack;this._onClick=this._onClick.bind(this);this._onKeyboardShortcut=this._onKeyboardShortcut.bind(this);this._onCommandStateChanged=this._onCommandStateChanged.bind(this);this._existsInAppBar=false};var e=PhotoViewer.BackButton;Jx.augment(e,Jx.Component);var a=e.prototype;a.getUI=function(a){a.html+='<div id="'+this._id+'">';var b=this._existsInAppBar?"appBar":"canvas";a.html+='<button id="backButton-button" class="win-backbutton backButton-'+b+'"></button>';a.html+="</div>"};a.activateUI=function(){var d=this._existsInAppBar?"appBar":"canvas",b=this._buttonElement=document.getElementsByClassName("backButton-"+d)[0];b.setAttribute("aria-label",Jx.res.getString("residBack"));b.addEventListener("click",this._onClick,false);this._backShortcutsListener=new PhotoViewer.BackShortcutsListener(window,this._onKeyboardShortcut);var a=this._site.getCommandStateRegistrar(c.navigateBack);a.addEventListener("statechanged",this._onCommandStateChanged);this._commandStateRegistrar=a;var e=this._site.isCommandEnabled(c.navigateBack);this._setEnabled(e);Jx.Component.prototype.activateUI.call(this)};a.deactivateUI=function(){this._backShortcutsListener&&this._backShortcutsListener.removeListeners();this._commandStateRegistrar&&this._commandStateRegistrar.removeEventListener("statechanged",this._onCommandStateChanged);this._enabled=null;Jx.Component.prototype.deactivateUI.call(this)};a.getEntranceAnimationInfo=function(){return d.genericComponentAnimationInfo([this._buttonElement],"BackButton","Entrance",false)};a.getExitAnimationInfo=function(){return d.genericComponentAnimationInfo([this._buttonElement],"BackButton","Exit",false)};a.setExistsInAppBar=function(){this._existsInAppBar=true};a._onClick=function(){this._enabled&&this._navigateBack(this._existsInAppBar?b.CommandSurface.appBar:b.CommandSurface.canvas)};a._onKeyboardShortcut=function(){this._enabled&&this._navigateBack(b.CommandSurface.keyboardShortcut)};a._navigateBack=function(a){if(this._existsInAppBar)this._buttonElement.style.visibility="hidden";this._site.doCommand(c.navigateBack,a,null,null)};a._onCommandStateChanged=function(a){this._setEnabled(a.enabled)};a._setEnabled=function(a){if(a!==this._enabled){var b=this._buttonElement;if(a)b.removeAttribute("disabled");else b.setAttribute("disabled","true");b.setAttribute("aria-disabled",String(!a));this._enabled=a}};a._site=null;a._navStack=null;a._enabled=null;a._commandStateRegistrar=null;a._buttonElement=null;a._backShortcutsListener=null})()