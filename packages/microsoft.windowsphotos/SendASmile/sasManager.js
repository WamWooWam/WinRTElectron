(function(){window.SasManager={_config:null,sasControl:null,_ownPlatform:null};var g=0,d=null,a=null,i="",b=null,f=null,h=null,e=null,c=null;SasManager.init=function(j,e,h){i=j;g=Jx.appId?Jx.appId:0;b=!h&&Jx.root?Jx.root._platform:h;if(!b)try{if(!SasManager._ownPlatform){SasManager._ownPlatform=new Microsoft.WindowsLive.Platform.Client("launch");var d=Jx.activation;d.addListener(d.suspending,SasManager._onSuspending,this);d.addListener(d.resuming,SasManager._onResuming,this)}b=SasManager._ownPlatform}catch(k){Jx.log.exception("Feedback: Platform failed to initialize",k)}var f=document.getElementById(e);if(f){c=f.parentNode;if(c.winControl&&c.winControl.hidden){a=c.winControl.getCommandById(e);a.icon="\ue19d";a.onclick=SasManager.handleFeedbackClick;a.type="button";a.label=Jx.res.getString("/strings/sasSurveyHeader");a.tooltip=Jx.res.getString("/strings/sasSurveyHeader");a.section="global";a.hidden=!SasManager.showInAppBar()}}!SasManager._config&&SasManager._initConfig()};SasManager.handleFeedbackClick=function(){if(!SasManager.sasControl){if(window.$include)$include("$(sasRoot)/sendasmile/sas.js");else{var a=document.createElement("script");a.src="/sendasmile/sas.js";var b=document.getElementsByTagName("head")[0];b.appendChild(a)}SasManager.sasControl=new Jx.Sas(Jx.getAppNameFromId(Jx.appId),i);Jx.root.append(SasManager.sasControl);d=document.createElement("span");d.id="sasFlyoutCtr";document.body.appendChild(d);SasManager.sasControl.setUserInfo(SasManager._getUserId(),SasManager.showInAppBar())}!SasManager.sasControl.hasUI()&&SasManager.sasControl.initUI(d);try{c&&c.winControl.hide()}catch(e){Jx.log.exception("Feedback: Unable to hide appbar",e)}SasManager.sasControl.show.apply(SasManager.sasControl)};SasManager.shutdown=function(){if(SasManager.sasControl){SasManager.sasControl.shutdownUI();SasManager.sasControl=null;d.outerText="";d=null}SasManager=null};SasManager.getSettingsCommand=function(){return new Windows.UI.ApplicationSettings.SettingsCommand("settings.feedback",Jx.res.getString("/strings/sasSurveyHeader"),SasManager.handleFeedbackClick)};SasManager.showInAppBar=function(){try{if(SasManager._config)return SasManager._config.enableFeedback&&SasManager._config.application.lookup(g).addAppBarButton&&Windows.UI.ViewManagement.ApplicationView.value!==Windows.UI.ViewManagement.ApplicationViewState.snapped&&!SasManager._isRetailExperience()}catch(a){Jx.log.exception("Feedback: Error determining whether or not to show SaS in the appbar",a)}return false};SasManager.isMarketSupported=function(){if(f===null)f=SasManager._findMarketInConfig();return f};SasManager._isRetailExperience=function(){var a=Jx.appData.localSettings();return a.get("RetailExperience")};SasManager._findMarketInConfig=function(){var b=SasManager.getMarket();try{var a=SasManager._config.supportedMarkets.market[b.toLowerCase()];if(!a){var c=b.substr(0,b.lastIndexOf("-")+1)+"*";a=SasManager._config.supportedMarkets.market[c.toLowerCase()]}return a}catch(d){Jx.log.exception("Feedback: Error when attempting to find market in configuration",d);return null}};SasManager.getLanguage=function(){if(e===null){var a=SasManager._findMarketInConfig(),c=SasManager.getMarket();if(a&&a.language)e=a.language;else{var b=c.split("-");e=b[0];if(b.length>2)e+="-"+b[1]}}return e};SasManager.addSettingsEntry=function(){try{if(SasManager._config)return SasManager._config.enableFeedback&&SasManager._config.application.lookup(g).addSettingsLink&&SasManager.isMarketSupported()&&!SasManager._isRetailExperience()}catch(a){Jx.log.exception("Feedback: Error in addSettingsEntry",a)}return false};SasManager.enableIssueReporting=function(){return SasManager._config.application.lookup(g).enableLogCollection};SasManager.getConfig=function(){return SasManager._config};SasManager.getMarket=function(){if(h===null)h=Microsoft.WindowsLive.Market.get(Microsoft.WindowsLive.FallbackLogic.language);return h};SasManager._onSuspending=function(){if(SasManager._ownPlatform)try{SasManager._ownPlatform.suspend()}catch(a){Jx.log.exception("Feedback: error suspending",a)}};SasManager._onResuming=function(){SasManager._ownPlatform&&SasManager._ownPlatform.resume()};SasManager._initConfig=function(){SasManager._config={enableFeedback:false,application:{lookup:function(){return{addSettingsLink:false,enableLogCollection:false,addAppBarButton:false,surveyId:null}}},supportedMarkets:"",privacyUrl:"",fmsDomain:""};if(b){var d=Microsoft.WindowsLive.Config.Shared.Feedback.loadAsync(b),c=function(b){SasManager._config=b.target;if(a)a.hidden=!SasManager.showInAppBar();f=null};d.then(function(b){SasManager._config=b;SasManager._config.addEventListener("changed",c,false);if(a)a.hidden=!SasManager.showInAppBar()},function(){Jx.log.error("Feedback: Error loading dynamic config")})}};SasManager._getUserId=function(){var a="Anonymous";try{a=b.accountManager.defaultAccount.userDisplayName}catch(c){Jx.log.exception("Feedback: Issue getting user ID from contacts platform",c)}return a}})()